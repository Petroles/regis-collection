<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.19516</field>
		<field name="filename">2873_Bonet_Luciane_M.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">UNIVERSIDADE ESTADUAL DE CAMPINAS
FACULDADE DE ENGENHARIA MECÂNICA
DEPARTAMENTO DE ENGENHARIA DE PETRÓLEO
Dissertação Apresentada à
Faculdade de Engenharia Mecânica Como Requisito Pardal à Obtenção do Título de Mestre em Engenharia de Petróleo
SIMULAÇÃO NUMÉRICA DE RESERVATÓRIOS UTILIZANDO UM MÉTODO DE IMPLICITUDE AUTO-ADAPTÁVEL
fcfc	o. ffetetVO	íM.	t
ferra. UuMxne. Bídw.T q	j--■
W ...í y u/yO
Ux , mVÁ;'	111 c
53/^0
Autor : Luciane Bonet
Orientador : Fernando Rodriguez de la Garza J
novembro de 1990
UNIVERSIDADE ESTADUAL DE CAMPINAS
FACULDADE DE ENGENHARIA MECÂNICA
DEPARTAMENTO DE ENGENHARIA DE PETRÓLEO
A dissertação “Simulação Numérica de Reservatórios Utilizando um Método de Implicitude Auto-adaptável”, elaborada por Luciane Bonet e aprovada por todos os membros da Banca Examinadora foi aceita pela Sub-Comissão de Pós-Graduação em Engenharia. de Petróleo como requisito parcial a obtenção do título de Mestre em Engenharia de Petróleo.
Campinas, 27 de Novembro de 1990.
Banca Examinadora
Fernando Rodríguez de Ia Garza, Ph, D.
Sidney Stuckenbruck, Pb. D.
4 José Carlos de Souza Cunha, pelo seu carinho e incentivo.
AGRADECIMENTOS
*
A PETROBRAS, pela oportunidade e apoio financeiro.
Aos professores do Mestrado em Engenharia de Petróleo da UNICAMP, pelos excelentes cursos ministrados.
Aos funcionários do Departamento de Engenharia de Petróleo da UNICAMP pelo apoio recebido.
Aos colegas do curso pela boa convivência.
A meu pai e primeiro mestre na iniciação científica Euclides, por ter me transmitido sua curiosidade à respeito do mundo que nos cerca.
A minha mãe Inés, pela dedicação e companheirismo de toda a vida.
Aos meus irmãos Jairo Luís, Lúcia Inés e Carolina pela, amizade, esperança e alegria.
A Celso e Célia Branco, que juntamente com sua filha Ana Luiza, foram minha família em Campinas.
A todos aqueles que colaboraram para a realização deste trabalho, com especial lembrança a Antonio Cláudio de França Corrêa, Pedro Wilson Teixeira, Oswaldo Antunes Pedrosa Jr., aos colegas do CENPES e de Campinas.
RESUMO
Este trabalho descreve o desenvolvimento e a aplicação de um método para simulação numérica de reservatórios que se baseia em uma formulação de implicitude variável e auto-adaptável.
A formulação de implicitude variável empregada fundamenta-se em uma abordagem geral dos métodos de simulação de reservatórios previamente apresentada na literatura. Nesta abordagem mostra-se que existe um nível básico de implicitude em todos os métodos ao qual associa-se uma matriz Jacobiana básica. A passagem então, deste nível básico para níveis mais implícitos dá-se com a adição de “matrizes corretivas”. Á aplicação destas correções a nível local, nas células que constituem a malha de cálculo, é a base da formulação de implicitude variável aqui descrita.
0 método em questão, diferentemente dos demais existentes na literatura, não objetiva diretamente a eliminação das incógnitas, relativas a uma determinada célula, para a composição do problema matricial final. Objetiva sim, o menor grau de implicitude que deve ser localmente fornecido ao sistema de equações nao lineares a ser resolvido, com garantia de estabilidade da solução. Neste método, diversos níveis de implicitude podem ser considerados, admitindo-se desde valores mínimos (IMPES) até valores máximos (Totalmente Implícito).
Implementou-se um critério de troca automática de implicitude que opera a nível de célula ao longo da simulação. Este contempla apenas os níveis extremos de implicitude (IMPES - Totalmente Implícito) e baseía-se na análise de estabilidade para o método IMPES, previamente apresentada na literatura.
Finalizando, são apresentadas duas aplicações do modelo desenvolvido. Através de tabelas especiais mostra-se os graus de ímplicitude em cada célula e como eles mudam no espaço e no tempo durante a simulação. Apresenta-se também informações relativas à economia de tempo computacional quando comparado com um procedimento fixo totalmente implícito.
ABSTRACT
This work presents the development and application of a reservoir simulation method, based on a variable and an to-adaptive implicit formulation.
The variable implicitness formulation is based on a general approach of reservoir simulation methods, already presented in the literature. In such approach a basic level of implicitness for all methods is recognized which yields a basic Jacobian matrix. The change from this basic level to a more implicit one is performed with the addition of “correction matrices”. The local application of these corrections to each gridblock is the basis for the formulation described in this work.
The method here presented difFers from those already given in the literature in that it does not directly focuses on the elimination of grid cell unknowns, to compose the final matrix problem. Rather it focuses on the minimum level of implicitness to be locally given to the non-linear difference equations to ensure stability. Under such approach various levels of implicitness are possible, ranging from IMPES type to Fully Implicit.
A switching criteria for the automatic assignment of implicitness in each cell along the simulation time was implemented. It considers only IMPES and fully implicit type cells and is based on stability analysis previously presented In the literature for the IMPES formulation.
A sparse-matrix method was adapted to solve the resulting linear systems of equations. The method allows an arbitrary ordering of the equations and unknowns. Such capability was particularly useful to take advantage of the matrix-structure of equations that results in applications of the auto-adaptive implicit method.
Finally, two applications are presented. By using special displays we demonstrate the degrees of implicitness in each cell and how they shift in space and time
Conteúdo
1	Introdução	1
2	Equações Diferenciais do Escoamento de Fluidos em Reservatórios	4
3	Solução Numérica Através de um Método de Implicitude Variável	6
3.1	Equações de Diferenças .........................................  6
3.2	Antecedentes : Formulação Geral dos Métodos de Solução do Sistema Não
Linear ......................................................     S
3.3	Aplicação da Formulação Geral a Nível Local: Formulação de Implicitude
Variável....................................................     15
4	Algoritmo de Controle Automático de Implicitude	20
5	Solução do Sistema Matricial Gerado na Utilização de um Método de
Implicitude Auto-adaptável	24
6	Aplicações Práticas	29
6.1	Caso 1.......................................................    29
6.2	Caso 2 . ..................................................      39
7	Conclusões	45
Nomenclatura	47
Referências	51
Apêndice B - Elementos da Matriz Jacobiana : Método Implícito
Apêndice C - “Matrizes Corretivas”
Apêndice D - Rotinas de Montagem e Ordenação
55
59
67
Lista de Figuras
3.1	Exemplo de Aplicação do Método de Implicitude Variável (I-Totalmente
Implícita / E-IMPES).................................................   17
3.2	Estrutura das Diagonais Externas Implícitas (I) e Explícitas (E)....... 18
5.1	Exemplo Bidimensional com um padrão Totalmente-Implícito (I) - IMPES(E) 26
5.2	Matriz J...........................................................     26
5.3	Problema Matricial após Redução de Gauss-Jordan nos Blocos Diagonais . 27
5.4	Problema Matricial Reduzido.........................................    27
6.1	Modelo do Reservatório - Seção Transversal ............................ 30
6.2	Pressão de Fluxo de Fundo de Poço versus Tempo (comparação com o
SIMBEST) ............................................................   34
6.3	Vazão de Oleo versus Tempo (comparação como	SIMBEST)..............  35
6.4	Razão Gás-Óleo versus Tempo (comparação com	o SIMBEST)..............35
6.5	Pressão de Fluxo de Fundo de Poço versus Tempo (Caso 1).................37
6.6	Vazão de Oleo versus Tempo (Caso 1) . . ..............................  38
6.7	Razão Gás-Óleo versus Tempo (Caso 1).................................... 38
6.8	Vazão de Óleo versus Tempo (Caso 2) .... .............................. 40
6.9	Graus de Implicitude versus Tempo (Caso 2 ~ Método de Implicitude Auto-
adaptável) .........................................................    42
6.10	Configuração de Graus de Implicitude para a Abordagem de Implicitude
Variável ................................- -..........................  43
6.11	Vazão de Óleo versus Tempo (Comparação entre Formulações)..............43
Lista de Tabelas
6.1	Descrição do Reservatório	e Dados	Básicos	(Caso	1)......................31
6.2	Funções da Saturação ............................ 32
6.3	Propriedades PVT do	Gás...........................................    32
6.4	Propriedades PVT do	Óleo .......................................      33
6.5	Propriedades PVT da	Água..........................................    33
6.6	Resultados do Caso 1	......... ........................................ 36
6.7	Descrição do Reservatório	e Dados	Básicos	(Caso	2)..................... 39
6.8	Resultados do Caso 2 . .	. ............................................  41
6.9	Parâmetros para a Análise de Desempenho da Formulação de Implicitude
Variável . ............................................................. 44
1 Introdução
Com o aprimoramento da tecnologia de simulação de reservatórios, a tendência tem sido o desenvolvimento de simuladores que ofereçam soluções totalmente implícitas. Historicamente, a evolução dos modelos de simulação de reservatórios progrediu de uma formulação implícita na pressão, explícita na saturação (IMPES) para as assim chamadas solução simultânea, semi-implícita, implícita sequencial e daí para a totalmente implícita [1]. Cálculos implícitos são geralmente necessários para manter a estabilidade da solução, quando as variáveis estudadas sofrem grandes variações ao longo de um passo de tempo. Uma vantagem que pode ser obtida de um simulador de elevada implicitude, além da estabilidade, é que se pode tolerar grandes intervalos de passo de tempo. No entanto, esta vantagem é reduzida por maiores erros de truncamento no tempo, de esforço de processamento e demanda de memória substancialmente mais elevados. A maioria dos simuladores comerciais oferece um nível de implicitude fixo em cada bloco da malha, em cada passo de tempo. Tipicamente, no entanto, somente uma pequena parcela do total de blocos em um modelo de reservatórios sofre mudanças rápidas nas variáveis calculadas para, justificar um alto nível de implicitude. Por exemplo, em um poço que sofre conificação de gás ou água, as mudanças rápidas na pressão e na saturação ocorrem nos blocos próximos da região do poço, enquanto que, nos trechos mais afastados do mesmo, as mudanças são mais suaves. O modelo totalmente implícito maneja adequadamente uma situação como esta, com garantias de estabilidade, mas, obviamente, algum excesso de trabalho é envolvido naquelas células onde as variações são modestas. Por outro lado, um tratamento IMPES de um problema como este pode resultar em um trabalho muito reduzido, com riscos de instabilidade nos blocos próximos ao poço.
Um simulador empregando a técnica de implicitude auto-adaptável, automaticamente seleciona o nível de implicitude, necessário célula a célula, para se garantir uma solução estável. Estes níveis, ou graus de implicitude, podem mudar tanto no espaço quanto no tempo, com o decorrer da simulação. Um conjunto de blocos em uma malha, por exemplo, pode sofrer grandes variações nos níveis de implicitude. Diferentemente de outras abordagens, que fornecem um grau de implicitude fixo em cada bloco da malha, a cada intervalo de tempo, o método de implicitude auto-adaptável envolve o tratamento de níveis mistos de implicitude, que variam automaticamente ao longo do tempo e do espaço. A vantagem é a redução substancial, em certas situações a serem simuladas, do tempo de computação e da memória computacional necessárias quando comparadas com formulações totalmente implícitas, mantendo-se, tal como estas, soluções incondicionalmente estáveis.
Os métodos de implicitude auto-adaptável foram introduzidos na simulação de reservatórios por Thomas e Thurnau em 1983 [20], Desde o trabalho original, outro método com características distintas foi sugerido. 0 método original é referido como AIM (“Adaptive Implicit Method”) [6],[20],[21] e o subsequente é conhecido como IAN (“Inexact Adaptive Implicit Newton Method”) [2].
No método AIM a matriz Jacobiana AIM é obtida a partir da matriz Jacobiana totalmente implícita, desprezando-se nesta as derivadas espaciais relativas às incógnitas explícitas que aparecem tanto no bloco da diagonal principal como nos blocos das diagonais externas. As equações resultantes sao então reduzidas a uma partição implícita e uma explícita, que sao resolvidas separadamente. Como resultado do processo de redução, a matriz de coeficientes torna-se arbitrariamente estruturada, de modo que métodos convencionais de solução iterativa não podem ser usados.
No método IAN, as derivadas com respeito às variáveis declaradas explícitas são zeradas somente se aparecerem nos blocos das diagonais externas da matriz Jacobiana. A matriz resultante é então reduzida como no método AIM convencional. Menciona-se a ocorrência de erros de balanço de material maiores e de dificuldades no método de solução nos diversos artigos que analisam este método.
Uma variação do método IAN é o método de implicitude dinâmica proposto por Vinsome [22]. Se o fluxo através da face de um bloco da malha for menor que um valor sugerido de 0.02 do mínimo volume poroso de dois blocos adjacentes, então tudo menos a coluna de pressão do correspondente bloco diagonal externo da matriz é zerado. Este método não conduz à redução no número de equações resultante, mas ganhos em tempo são alcançados na construção do Jacobiano em um método de solução especial que pode reconhecer os blocos diagonais externos na matriz de coeficientes que foi parcialmente zerada.
E importante ressaltar que os métodos de tratamento de implicitude variável existentes atuam diretamente nas incógnitas (saturações e composições) de um determinado bloco. Ou seja, incógnitas são tornadas explícitas, ou implícitas, o que implica em não se calcular ou se calcular, respectivamente os valores de derivadas em relação a estas incógnitas na matriz Jacobiana.
Aplicações do método AIM e IAN em problemas de simulação de reservatórios tipo “black-oil” estão bem documentadas nas referências [2],[6],[20],[22] e em problemas composicionais/térmicos na referência [19]. A aplicação prática do método AIM em um problema puramente composicional é apresentada na referência [4].
A análise apresentada a seguir se restringirá ao contexto de modelos tipo “black-oil”. As equações básicas utilizadas para simulação “black-oil” consistem nas equações da conservação de massa do óleo, gás e água. As velocidades das fases são dadas pela lei de Darcy [1], 0 modelo “black-oil” admite que a fase água consiste inteiramente do componente água, que o componente óleo é não volátil e que o gás pode estar presente tanto nas fases óleo como gás. Este tipo de modelo é comumente usado para estudos de depleção primária e recuperação secundária (injeção de água).Na aproximação aqui estudada a água é considerada imóvel. A partir das hipóteses acima, resultam as seguintes equações :
Conservação do óleo:
V.{W(VP, - q0VD)] + qo~ ^S0bo) = 0	(2.1)
Conservação do gás:
- 7sVD) + (XaboR,k(VPo - 7pVD)] + qg + q.Ra
- ^sffbg + SoboR9)] = Q	(2.2)
Conservação da água:
= 0	(2.3)
Uma explanação mais detalhada do escoamento no meio poroso apresentada sob o ponto de vista da engenharia de petróleo pode ser encontrada na referência
[1].
(2.4)
As pressões individuais da fase gás e óleo são relacionadas através da pressão capilar Pc
Ps Po d" fcgofêg)
As equações (2.1) a (2.5), em conjunto com as condições inicial e de fronteira, definem de forma única o problema de fluxo no reservatório.
3.1	Equações de Diferenças
A aproximação das equações (2.1) a (2.5) através de um esquema de diferenças finitas implícito, usando diferenças centradas no espaço e regressivas no tempo, conduz ao seguinte conjunto de equações de diferenças não lineares:
equação do óleo:
apXAp. - 7.Aí&gt;)JÍ”+1 ’ + «2”	- WJh = 0	(3.1)
equação do gás:
APi(APí - 7,A£&gt;)](”+1’ + A[7:7?,(APr. - 7.A£&gt;))j”+l’ + ís'”+l1 + (R.?,)!“+'&gt;
-	+ SAH.)),- (‘KSA, + SAa))!"') = 0	(3-2)
equação da água:
íU"+” = sd"’[i -	+&amp;lt;O(rf”+1) - d"’).-!	(3 3)
i = l,2,...,m	m~número de blocos na malha
n = 0,1,2....
Acima, o subescrito i refere-se ao i-ésimo bioco da malha ou célula, e A é um operador de diferenças centradas do tipo, Aiq ~ «i+i/a ~ «í—1/2- Os sobrescritos (n) ou (n + 1) referem-se aos níveis de tempo, conhecido e incógnita, respectivamente.
Note que os termos das equações (3.1) e (3.2), que resultam das aproximações em espaço, são chamados termos de fluxo, enquanto as aproximações em tempo são chamadas termos de acumulação. Note que o termo de acumulação para a célula i contém somente variáveis da célula i, enquanto o termo de fluxo contém variáveis da célula i bem como variáveis dos vizinhos mais próximos da célula i. Este tipo de conectividade entre células origina unia molécula computacional de três pontos em uma dimensão, de cinco pontos em duas dimensões e de sete pontos em três dimensões. Maiores detalhes do método de discretização podem ser achados nas referências [1] e [12].
0 acoplamento das equações (2.4) e (2.5) em (3.1) e (3.2) conduz a um sistema de equações em termos de p0 e como incógnitas em cada nó.
Pode-se resolver o sistema nâo linear de equações constituído pelas equações (3.1) e (3.2) de várias formas. As diversas maneiras dé linearizar estas equações têm originado diversos métodos, conhecidos na literatura como IMPES, Solução Simultânea, Sequenciais, Semi-implícito e Totalmente Implícito.
Rodríguez [13] apresentou em 1988 uma abordagem geral dos métodos empregados na simulação de reservatórios, onde o método de Newton-Raphson é considerado o procedimento geral para solucionar os sistemas de equações não lineares gerados na simulação numérica de reservatórios. Mostrou que os diversos métodos publicados na literatura são casos particulares que resultam da linearização preliminar parcial das equações de diferenças. Conforme essa abordagem é possível distinguir claramente um nível de implicitude mínimo ou base, associado ao método IMPES, e um nível de ini-plicitude máximo, associado ao método totalmente implícito, e uma gama de níveis de implicitude intermediários, alguns dos quais correspondem aos métodos publicados na literatura.
A seguir, revisar-se-á sucintamente este enfoque geral e unificado dos métodos empregados na simulação numérica de reservatórios. Partir-se-á de um método geral que consiste em resolver de maneira totalmente implícita, mediante Newton-Raphson, as equações não lineares de diferenças (3.1) e (3.2) obtidas da aproximação das equações de fluxo multifásico em reservatórios.
Considerando-se, a bem da concisão, um escoamento unidimensional, tem-se que a função de resíduos para o componente óleo, F^, segue da equação (3.1) como:
, s„„) = A[r.(Ap. - 7oAJ9)]í“+,) +&amp;lt;U"+,)
-	- (¿SA)!"’] = 0	(3-4)
A função de resíduo para o gás, Fg[, é similarmente definida da equação (3.2).
SOi+1) = A[Ts(Ap9 - 7sAD)],&lt;"+”
+A|T„/ít(Ap0 - -fcAfl)],1""’ + vj""1 + (/?,Í.Ç‘+"
(3.5)
Generalizando,
, pOi,	, pOi+1 5 ^&gt;+j) — 0
/=óleo,gás
Considerando (iz-f-l) como o nível de iteração desconhecido, durante a solução iterativa das incógnitas no nível de tempo (n + 1), assim uma estimativa do resíduo no nó i, F^+1\ pode ser feita através de uma expansão em série de Taylor deste resíduo em torno de (f), retendo somente os termos inferiores,
ou
i+l
i=»-l
dF^}
dpo.
dst
= -F/t’
(3-6)
i — l,2,...,m
u = 0,1,2...,
m=número de blocos na malha
onde ÓX(í?+1) são as mudanças iterativas da incógnitas X(p0(,SOi), definidas como,
¿X(H-i) __	— XM
_fdri
onde J é a matriz Jacobiana ou a matriz de derivadas. Uma estimativa da solução deve ser feita para se iniciar o processo de iteração; usualmente,
;E(n+1)o) „ ^(n)
e as iterações processam-se até que,
Quando esta condição é satisfeita a solução para o novo nível de tempo (n + 1) é alcançada.
Para o nó i, as equações podem ser escritas como:
r 9F-,	3FO, -i	(ri	r	a/% -i	(ri	r		(ri	L	0 J	i-1 íi/4-11	r	1	
			&amp;amp;Poí				asOi+1		¿Po		Fo
dFv,	3FSi		SF9i				3F91-		xç		F
L	J		. 5po,	aso, J		- ^p°í+i	^í+i J			f 1/4-1 i	L 1 9
O Apêndice A contém a forma expandida das funções de resíduos para óleo e o gás e o Apêndice B contém elementos da matriz Jacobiana.
Antes de entrar em detalhes da abordagem geral, deve-se notar que as não linearidades nas equações de diferenças podem ser classificadas de acordo com sua origem nos termos de fluxo; de acumulação e de fonte/sumidouro, quais são:
•	Não linearidades nos termos de fluxo
T - T(p, 5)
A - Pc(^)
7	= 7ÍP, S)
•	Não linearidades nos termos de acumulação
= ^(p)
b = b(p,S)
•	Não linearidades provenientes dos termos fonte/sumi douro
T = T(p, S)
Eni geral, as funções de resíduos contém não linearidades dos seguintes
tipos:
F {T(p, 5)[AP + AFC(5) + 7Üb *?)],	(T/To)(p, 5)	,	[^(p)ò(p, 5)]	};
1,1	“V1 "	.S	s,
termo de fluxo	termo fonte/sumidouro termo de acumulação
assim, a matriz Jacobiana constituída por derivadas parciais de F com relação as variáveis primárias pode ser decomposta na soma de matrizes particulares como se segue:
[J]tj	PH +		dT' _dp_	+	'dT' dS	+	■^1+1 05]	(	dy dp	4-	d'} dS	}+’.	píTW] dp	+	[d(T/To)l dS
+ (						s &gt;							
	L &amp;amp;P J			L dS									
O Apêndice C mostra as quantidades envolvidas em cada uma destas
matrizes.
Os métodos de solução existentes, conforme a, referencia [13], podem ser vistos como formas particulares do método de solução geral anteriormente descrito. Assim, métodos podem ser deduzidos pela execução, em um primeira etapa, de uma linearização preliminar parcial das funções de resíduos, reduzindo assim a matriz Jacobiana geral a su a correspondente forma:
MÉTODO 1 - MÉTODO IMPES
Este método foi apresentado originalmente por Sheldon et alii [16] e Stone
&amp;amp;	Garder [18] e a linearização preliminar parcial de F, conforme o mesmo, é:
Simpes —*•	S”)[Ap + APC(5") + 7(p”, 5")], (T/TJfp", S"), (&lt;¡AS)}
Segue-se então que,
[J]zAfPES = P] +
íp(&lt;MS)
U
ó(^S)l dS

MÉTODO 2 - MÉTODO DE SOLUCÀO SIMULTÂNEA
0 método de Solução Simultânea foi originalmente descrito por Douglas et alii [5], Posteriormente, novas versões foram apresentadas por Coats et alii [3] e Sheffield [15]. Uma revisão destas é apresentada por Aziz &amp;amp; Settari [1]. A versão aqui descrita encontra-se na referência [1] que considera a seguinte linearização preliminar parcial de F,
{T(p\Sn)[Ap+APC(S) + 7^,S’l)], (T/Tú)^,Sn),(^S)}
Assim,
[J]ss = [T] +
[W				d($bS)'
_dS	•r s	dp	T	dS
ou,

MÉTODO 3 - MÉTODO SEM1-IMPLÍCITO LINEARIZADO 1
Este método foi originalmente apresentado por diversos autores [8],[9],[10].
Neste, a. linearização preliminar parcial de F é como se segue,
{T(p\ S)[ãp 4- APC(S) + 7(p", 5")], (T/T0)(pT 5), (^T)}
Assim,
+
= [T] +
d(T/Toy dS
'&amp;amp;(&lt;/&gt;bsy
dp

ou,
= ¡T]ss +
d(T/T0)'
dS
MÉTODO 4 - MÉTODO SEMI-IMPLÍCITO LINEARIZADO 2
Uma alternativa ao método anterior é proposta na referência [13] na qual as transmíssibílidades são avaliadas semi implicitamente tanto em pressão como em saturação. Desta forma, linearizando preliminarmente F como se segue,
Fsl-2 — Rp, T)[Ap + APC(S) + 7(pn&gt;Sn)L (T/To)(p, S), (&lt;/&gt;bS)}
Tem-se então que,
[J]sL-2 =
farl [arll
4
[apc]
A 4- —A
dS
'9(&lt;i&gt;bS)'	í	'ô(4&gt;bsy
dp	"T	dS
m+{fe]
+
4
ou,
[J]sL-2 =	+
dT		
dp	3	dp
e finalmente,
MÉTODO 5 - MÉTODO TOTALMENTE IMPLÍCITO
F„ {T^ s)[ãp + AFXS) + 7ÍA S)]&gt; (T/T0)(p, 5), (&lt;f&gt;bS)}
Segue-se então que,
	[dT				ppj
P1 +	dp	+	1&amp;amp;S.	+	dS
			'd^bsy		1
1 dp .		í	dS		J
[díT/T^
[ dS
ou,
[J]t/ = [JU-2 + |	+ [^] }
Um aspecto importante da abordagem geral dos métodos apresentada na referência [13] é a identificação de uma matriz Jacobiana básica, associada ao método IMPES, ¿impes*. sendo que a sua transformação às matrizes Jacobianas dos outros métodos dá-se mediante adições de “matrizes corretivas”. Assim, a abordagem geral permite estruturar de maneira simples e direta um simulador multi-formulações com diversos graus de implicitude.
A referência [13] indica que as idéias da abordagem geral são bastante convenientes sob o ponto de vista de uma formulação de implicitude variável ou auto-adaptável; neste caso, as “correções ” devem ser feitas a nível local, em cada nó da malha de cálculo, conforme for preciso. Estas idéias são aqui utilizadas e formara a base deste trabalho.
Como mostrado anteriormente, o enfoque apresentado na referência [13] é bastante conveniente sob o ponto de vista dos métodos de implicitude variável, uma vez que permite ir de um nível de implicitude ao próximo pela adição de “matrizes corretivas” à matriz Jacobiana prévia.
A formulação de implicitude variável aqui proposta resulta da aplicação destas correções a nível local em determinadas células da malha de cálculo. Isto é, os componentes locais da matriz Jacobiana do método totalmente implícito são:

	J»	p7]		ra7i
ds.	i	dp	+	as]/ h J &gt;
d(4&gt;bS) dS
fpUVTJl	. [W)l		1	'd^bsy
.L dp		dS ]	J.+í	. dp .

Á implicitude mínima no nó i é
{Pd/AíFEs}
'd(4&gt;bsy		'd^bsy
dp	4“	ds
Os diversos graus de implicitude requeridos localmente em cada nó da malha são introduzidos com correções operando a nível local.
Um aspecto importante que deve ser considerado na aplicação destas correções é que se deve compatibilizar o tratamento dos termos de fluxo entre as faces dos blocos da malha de cálculo, que possuem graus de implicitude distintos. Objetiva-se com isto evitar a ocorrência de erros de balanço de massa. Considerando-se os nós i e i •+ 1, duas opções podem ser estudadas para resolver este problema.. A primeira, consiste no tratamento do termo de fluxo em (í + 1/2) com o grau de implicitude mínimo entre as
Faz-se então necessário sub-dívidir cada “matriz corretiva”, relativa aos termos de fluxo, em duas outras: uma que relacione os termos provenientes do fluxo de i — 1 para i e vice-versa denominada (í —1/2) e outra que relacione os termos provenientes do fluxo de i para i 4-1 e vice-versa denominada (í + 1 /2). Ou seja,
tn = in_1/2+m,+1/2,
ar dp
&amp;amp;T
dS

A “matriz corretiva” relativa aos termos de fonte/sumidouro é sempre vinculada ao nível de implicitude da, célula á A “matriz de correção” relativa ao termo de acumulação é sempre considerada com nível de implicitude máximo (totalmente implícito).
Para exemplificar o tratamento local será assumido que só existem dois tipos de células. Estas serão Totalmente Implícitas ou IMPES. Suponha agora a situação ilustrada na figura (3.1), para um núcleo de células da malha de cálculo.
I (^1)	I (0	E (í + 1)
Figura. 3.1: Exemplo de Aplicação do Método de Implicitude Variável (¡-Totalmente Implícita / E-IMPES)
Como mencionado anteriormente o termo de fluxo em (¿4-1/2) e (i —1/2) deverá, para efeito de montagem do Jacobiano, ser admitido com a menor implicitude entre as células (i,i + 1) e (ij — 1), respectivamente. Deduz-se com isto que a figura
(3.1)	apresenta uma face implícita (í — 1/2) e outra explícita (i + 1/2). Pode-se ilustrar esquematicamente as equações resultantes para o nó i como
Kn =	- 7oAjD))],-+1/3}/mpks - {[^(Apo ■”7o^jD))]í-i/2}t7
+«« -	- OSA)?0] = 0
e FS1 pode ser obtida semelhantemente.
Para a linha i da matriz Jacobiana tem-se que
HH.H
¿X .
ex r = - [ F ],
¿X
J *4-1
onde,
Í5T1
[o],
farl

		
dp		dS í u J z
Deve-se notar que as sub-matrizes [C]t- e [A]¿ possuem as parcelas (i — 1/2) de todas as “matrizes corretivas” uma vez que o fluxo em (i ~ 1 /2) é considerado da maneira totalmente implícita. Por outro lado, [A]; e [B]¿ possuem as parcelas (z + 1/2) apenas da sub-matriz de transmissibilidades [T];+i/2 de [jT]* pois, o fluxo em (í + 1/2) é considerado do modo IMPES. Existem ainda em [A],- parcelas das “matrizes corretivas” provenientes dos termos de acumulação e de fonte/sumidouro (derivadas em relação a SOt e pOt).
A figura (3.2) ilustra a estrutura matricial das equações para o nó com uma face implícita e outra explícita. Os x’s representam valores não nulos. Notar que os valores nulos, para as derivadas em relação à saturação, na diagonal externa direita sao consequência do tratamento explícito do termo de fluxo na face (i + 1/2).
I	I	E
(í-1)	(0	(i+1)
Diagonal Externa Diagonal Central Implícita	P S
Diagonal Externa
Explícita
X x
X X
X o
X o
x x
x x
Figura 3.2: Estrutura das Diagonais Externas Implícitas (I) e Explícitas (E)
Em resumo, assumindose que são conhecidos os graus de implicitude necessários a cada célula, monta-se o problema matricial, i.e. as funções de resíduos e a matriz Jacobiana, a partir da técnica anteriormente apresentada, o que constitui a formulação de implicitude variável.
Em geral, reconhece-se que graus de implicitude maiores são requeridos em regiões onde as pressões e saturações sofrem variações elevadas em um intervalo de tempo. Tipicamente, isso ocorre nas vizinhanças de um poço ou em processos que geram a formação de frentes, como no caso de injeção de água e/ou gás e segregação gravitacional.
Pode-se fixar o grau de implicitude de duas formas, a saber: 1- manualmente e 2- automaticamente. No primeiro caso, define-se, com base na experiência, um vetor fixo de implicitude que é usado ao longo da simulação. Isto é, em um simulador assim equipado, fornece-se através de simples diretivas de entrada um grau de implicitude fixo a ser invocado em cada célula ativa ou sub-conjunto do número total de células ativas. No segundo caso, Ímplementa-se um algoritmo que permite controlar e modificar automaticamente, no espaço e no tempo, o grau de implicitude em cada célula, conforme as necessidades locais. Este último procedimento dá origem à simulação com implicitude auto- adaptável.
No método de implicitude auto-adaptável, os níveis de implicitude das células são definidos antes de se compor o problema matricial final. Acompanha-se o grau de implicitude em cada bloco da malha através de um vetor especial. 0 simulador toma conhecimento do valor deste vetor para cada bloco da malha quando, a cada momento, constrói o problema matricial a ser resolvido. Claramente, o conteúdo deste poderá mudar de iteração para iteração ou passo de tempo para passo de tempo,a medida que o grau de implicitude em cada célula muda. Desta maneira, na construção de um método de implicitude auto-adaptável, necessita-se da definição de um critério de troca que determine a implicitude adequada. Se este critério não for eficiente na determinação dos graus de implicitude, o método poderá fornecer respostas instáveis, bem como apresentar aumento no número de iterações na resolução de um passo de tempo.
O problema do controle automático de implicitude tem sido estudado em detalhes, como pode-se verificar na análise das referencias [6],[7],[11],[14],[19],[20]. Em geral, os métodos de controle de implicitude operam a nivel de incógnita, urna vez que trabalham acoplados à formulações que atuam também sobre estas. Por exemplo, alguns autores [6],[19],[20] defendem o uso de um critério baseado em mudanças observadas nas incógnitas explícitas (saturações ou composições). Em tal critério, uma vez que uma incógnita mude de mais do que uma quantidade pré-determinada em uma iteração ou passo de tempo, esta incógnita é feita implícita para o resto da simulação, ou pelo menos até a próxima mudança de vazão nos poços.
Este critério, semelhantemente a outros encontrados na literatura, nao poderia ser acoplado diretamente à formulação de implicitude variável aqui apresentada. Neste estudo, o grau de implicitude, ou seja, o tratamento que se deve dar às nao linearidades, tem que ser fixado de acordo com análises de estabilidade das possíveis formas de linearização das equações. Desta maneira, a análise de estabilidade para o método IMPES publicada na literatura [1],[11] foi adaptada e usada no desenvolvimento de um algoritmo de controle automático que contempla dois níveis de implicitude extremos, IMPES e Totalmente Implícito.
A análise de estabilidade para o método IMPES existente na literatura pode ser expressa por:
Ai vx , ----£_ &amp;lt;i ¿ Ax ~ ’
(4.1)
que significa que a frente de avanço (em uma injeção de água, por exemplo) só pode caminhar a distância de um bloco por passo de tempo ou ainda, que o volume de fluido que escoa através de um bloco em um passo de tempo deve ser menor que o volume poroso deste. Em termos de vazão
Este limite de estabilidade considera algumas hipóteses simplificadoras quais sejam:
« fluxo incompressível,
» pressão capilar nula,
* efeitos gravitad onais desprezíveis.
A troca de células totalmente implícitas para células IMPES e vice-versa obedeceu então a um critério que se baseia na expressão (4.2). Ou seja, se o fluxo total através das faces do bloco da malha for maior que um fator,	do volume poroso no
bloco a montante, então, o bloco a montante é considerado implícito; caso contrário o método IMPES é usado. A experiência mostrou que Fcoríe—0.005 volumes porosos é um bom critério e o seu aumento muito acima deste valor faz com que o número de iterações Newtonianas tenda a crescer. Por outro lado, o decréscimo deste valor provoca o aumento do número de células implícitas e consequentemente a elevação do tempo para solução do problema.
Dois outros critérios auxiliares foram também usados: 1- Se a saturação de uma fase em um bloco da malha ultrapassar a saturação crítica durante um dado passo de tempo, a célula é então considerada totalmente implícita neste passo de tempo. Isto é feito, principalmente, para evitar que mudanças rápidas no fluxo de gás livre tornem o processo instável. 2- Uma vez que um bloco tenha sido determinado como exigindo tratamento totalmente implícito, ele fica desta forma em todas as demais iterações Newtonianas daquele passo de tempo.
O critério de mudança de implicitude empregado exige um trabalho adicional mínimo, já que os termos de fluxo, que são parte das funções de resíduos, são
Resumindo, um parâmetro de entrada, i.e. Fcorte, controla o tipo de simulação. Se Fcori/. é zero, a simulação é totalmente implícita. Se Fcorie for elevado, a simulação é IMPES e se for em torno de 0.005 volume porosos, tem-se a escolha do grau de implicitude dos blocos dinamicamente a cada passo de tempo.
O capítulo anterior mostrou como um método de implicitude variável pode ser aplicado em problemas “black-oil”, considerando-se que é sabido os níveis de implicitude de cada célula. Definir o critério de troca que determine a implicitude é um dos principais desafios que deve ser superado em implementações práticas. Se o critério permitir um grau de implicitude baixo em diversas células, a convergência Newtoniana será desacelerada, fornecendo respostas instáveis. Se ele forçar muitas células com elevados graus de implicitude o método irá funcionar, mas o tempo computacional será desperdiçado e dispersão numérica desnecessária irá aparecer. Utilizou-se neste estudo um critério que exige alguma participação do usuário (na determinação de	e que não abrange toda a
gama de graus de implicitude que poderiam ser considerados na formulação de implicitude variável aqui apresentada.
As equações discretizadas do método de implicitude auto-adaptável foram apresentadas nas equações (2.6) e (2.7). Como visto no capítulo (3.2), após alguma manipulação algébrica, estas equações podem ser reduzidas a forma matricial
J.ÓX = -F
A matriz J tem uma estrutura de banda, por blocos sendo, no caso em estudo, cada bloco uma sub-matriz 2x2 correspondente a cada célula ativa da malha. Uma redução de Gauss-Jordán é efetuada nas sub-matrizes ao longo da diagonal principal para reduzi-las a sub-matrizes diagonais [20],[21]. Ou seja, após a construção do sistema Jacobiano, cada linha de bloco da matriz é multiplicada pela inversa correspondente da sub-matriz diagonal principal. Para células IMPES, esta operação efetivamente elimina as variáveis de saturação destas do sistema. A redução do sistema pode ser vista como a seguir. Se a célula i for IMPES, então após a multiplicação pela inversa da diagonal, as únicas entradas não nulas nas colunas correspondentes a	aparecem na diagonal da
sub-matriz diagonal para a célula i. Isto significa que a equação resultante contendo as derivadas dependentes de	podem ser resolvidos em uma segunda etapa, uma vez que
nenhuma outra equação mostra dependência nas derivadas de	Após resolver para
as outras variáveis primárias,	pode ser determinada por substituição regressiva.
Em notação matricial tem-se que J é colocada em uma forma reducívei por operações equivalentes para descobrir uma matriz de permutação P tal que
PJP7
JS1 J12
0	j22
Aqui Jn é uma sub-matriz diagonal constituída de coeficientes modificados das variáveis explícitas, enquanto J12 e J22 são sub-matrizes constituídas dos coeficientes modificados das variáveis implícitas. A ordem de J22 é igual ao número total de variáveis implícitas. Pela partição de ¿X e F similarmente a PJPT, o problema matricial fica
- -Fj	(5.1)
j22¿x2 = -f2	(5.2)
A solução da equação (5.2) para a partição implícita X2 consome a maioria do tempo computacional; no entanto, é significativamente menor do que aquele onde todas incógnitas são implícitas e a equação J.áX = —F é resolvida. Além do mais, neste caso a eliminação Gaussiana torna-se economicamente possível para malhas bastante grandes, o que não ocorre em uma abordagem totalmente implícita. A solução da equação
(5.1)	para a partição explícita ÚXj consome essencialmente um tempo não superior do que uma substituição regressiva em uma eliminação gaussiana. Mais ainda, pode-se economizar memória uma vez que as equações (5.1) e (5.2) são equações matriciais independentes de menor ordem do que a equação J.ÓX — — F. Uma vez que o número total de células implícitas é sujeito a mudar de iteração para iteração (ou passo de tempo para passo de tempo), a ordem de J22 não é fixa,mas pode mudar dinamicamente. Como ilustração considere o sistema bidimensional simplificado de 3x2 com o padrão de células implícitas /IMPES como mostrado na figura (5.1). Admite-se uma ordenação normal para a malha. A estrutura da matriz Jacobiana correspondente a este problema é mostrada na figura
(5.2)	. Os x’s representam valores não nulos - alguns destes podem ser elementos nulos se uma fase em particular tornar-se imóvel. Esta matriz é diagonalizada para alcançar
o problema matricial cuja estrutura é mostrada na figura (5.3). 0 processamento preliminar da matriz para a redução do bloco diagonal a sub-matrizes identidade de 2x2 não altera de nenhuma maneira a estrutura das entradas nulas. Não é necessário calcular as entradas nulas. Assim, existe uma economia de esforço na construção do Jacobiano. Trocas apropriadas de linhas e colunas são então efetuadas para se alcançar o problema reduzido mostrado na figura (5.4).
2
1
1	2	3
I	E	E
I	E	tu
Figura 5.1: Exemplo Bidimensional com um padrão TotalmeateTmpIícito (I) - IMPES(E)
X	X	X	o			X	X				
X	X	X	o			X	X				
X	o	X	X	X	o			X	0		
X	0	X	X	X	0			X	0		
		X	o	X	X					X	o
		X	o	X	X					X	o
X	X					X	X	X	0		
X	X					X	X	X	o		
		X	o			X	o	X	X	X	0
		X	o			X	o	X	X	X	o
				X	o			X	0	X	X
				X	0			X	o	X	X
6Snt
$P&lt;&gt;33.
êpOi2
SSOi2
èSO22
^P&amp;amp;ít
SSQ32
Figura 5,2: Matriz J
1	0	X	0			X	X				
0	1	X	o			X	X				
X	o	1	o	X	o			X	o		
X	o	o	1	X	o			X	o		
		X	o	1	o					X	o
		X	o	o	1					X	o
X	X					1	o	X	o		
X	X					0	1	X	o		
		X	o			X	0	1	o	X	o
		X	o			X	o	o	1	X	o
				X	0			X	o	1	o
				X	o			X	o	o	1
¿SO11
^Po21 fjÇ
èpasi
^Pol2
SSOli
^P°22
SS^2 fyo32
F*
7 ffu
P*
ou
F’
921 F*
»21
F*
531 /?*
aji
F’
912
F*
012
F*
922 p*
022
F*
gs2
F*
032
Figura 5.3: Problema Matricial após Redução de Gauss-Jordan nos Blocos Diagonais
^21 ^al
ssO32 ¿Pon
¿SOll
fy&gt;O21
&amp;amp;PO31
^Pt&gt;12 ¿q
VJO12 $PO22 ^Po^2
F*
021
F»
031
F*
022
F*
032
F*
911
F*
Ou
F*
921 /?*
531
F*
912
F*
012
K1*
522
F*
532
Figura 5.4: Problema Matricial Reduzido
Na implementação do método de implicitude auto-adaptável, não foi necessário programar literalmente as manipulações matriciais formais discutidas anteriormente. No entanto, as mesmas operações numéricas foram efetuadas. Processou-se o Jacobiano após o seu cálculo, para que este alcançasse sua forma final da seguinte maneira. Multiplicou-se cada linha de bloco da matriz, inclusive o termo independente, pela
inversa correspondente da sub-matriz diagonal. Resolveu-se então o sistema resultante com a utilização da subrotina NSPIV [17]. Esta, rotina exige como dado de entrada um vetor que especifique a ordem de eliminação das equações. Este vetor é montado a cada iteração, a depender da. configuração de células IMPES-Implícitas existentes na malha. Nas primeiras posições estão as equações que relacionam as saturações das células IMPES em ordem de numeração da malha. Após estas constam as incógnitas de pressão e saturação das células implícitas intercaladas pelas incógnitas de pressão das células IMPES, utilizando-se o sentido de ordenação da malha. Resumindo, as etapas da figura (5.4) são efetuadas automaticamente pela rotina NSPIV, a partir do fornecimento da matriz da figura. (5.3) e de um vetor de ordenação adequado. Montou-se com isto um eficiente código que combina alguns dos passos formais, tirando-se vantagem da esparsidade das matrizes envolvidas.
6 Aplicações Práticas
Uma comparação entre as abordagens de implícitude variável , auto-adaptável e totalmente implícita foi efetuada através de dois casos-exemplos. A técnica totalmente implícita usa o mesmo método de solução do que na abordagem de implícitude auto-adaptável, exceto que iodos os blocos são implícitos ao longo de toda a rodada. A abordagem de implícitude variável usa o mesmo método de solução do que na abordagem de implícitude auto-adaptável, exceto que o grau de implícitude dos blocos é manualmente escolhido e permanece fixo ao longo de toda a simulação.
6.1	Caso 1
0 caso-exemplo 1 teve como objetivo simular o fluxo radial de um reservatório horizontal produzindo por uni poço. No caso em estudo, o reservatório encontrava-se inicialmente em repouso e contendo óleo subsaturado, não apresentando fluxo através do seu limite externo e produzindo com vazão constante na superfície até o alcance de uma pressão mínima de fluxo. Quando a pressão mínima de fluxo é atingida passa então a produzir com pressão constante de fluxo, até atingir uma vazão mínima de produção. 0 poço está completado no bloco (1,1). Uma vista em seção transversal é apresentada na figura (6.1) e as propriedades do reservatório e outros dados básicos pertinentes estão relacionados na tabela (6.1). Funções da saturação e propriedades PVT estão ilustradas nas tabelas (6.2), (6.3), (6.4) e (6.5).
Figura 6.1: Modelo do Reservatório - Seção Transversal
Este simulador pode também operar com um método de implicitude auto-adaptável (método AIMj. O acionamento desta flexibilidade dá-se através de um simples parâmetro de implicitude que é fornecido como dado de entrada. Este pode variar de 1 a 3. Caso tenha valor idêntico a 1, o SIMBEST resolverá o problema de forma IMPES. Se for igual a 3, o problema será resolvido com um método totalmente implícito. Valores intermediários significam que o problema será resolvido através do seu método de implicitude auto-adaptável. Estes, quando fornecidos, procuram ser atendidos, mas o simulador aumenta ou reduz o valor deste parâmetro de entrada de modo a manter a solução estável. Para que o usuário tome conhecimento de como está sendo efetuada esta variação são emitidos então os valores adotados a cada passo de tempo, bem como o valor médio ao longo de toda a rodada.
Geometria
Extensão radial, m	500
Raio do poço, m	0,1
Número de blocos radiais	10
Número de camadas verticais	10
Angulo de mergulho, grau	0
Profundidade da formação, m	5060
Espessura da formação, m	40
Dados de Rocha e Fluido
Porosidade, fração	0,30
Permeabilidade absoluta na direção x, m2	9,86923xl0~14
Permeabilidade absoluta na direção z^ m2	9,86923xl0”14
Compressibilidadeda rocha, MPa"1	4,4xl0~4
Massa específica do óleo em condições padrão, kg/m3	49,2
Densidade do gás em condições padrão, adimensional	0,79
Condições Iniciais
Profundidade de referência, m	5098
Pressão na profundidade de referência, MPa	33,09
Saturação de água irredutível, fração	0,12
Dados do Poço
Blocos completados	(1,1)
Pressão de fluxo de fundo de poço mínima, MPa	7
Vazão de óleo para abandono, m3/d	30
Histórico de Produção
Vazão máxima de óleo produzida, m3/d	300
Tabela 6.1: Descrição do Reservatório e Dados Básicos (Caso 1)
Funções Gás-Óleo
k
(fração )
W
0,000	0,000	1,0000	0,0
0,020	0,000	0,9970	0,0
0,050	0,005	0,9800	0,00108
0,130	0,025	0,7000	0,00861
0,180	0,075	0,3500	0,02910
0,230	0,125	0,2000	0,06890
0,280	0,190	0,0900	0,13440
0,380	0,410	0,0210	0,36920
0,430	0,600	0,0100	0,55090
0,530	0,720	0,0010	1,07600
0,580	0,795	0,0005	1,25300
0,630	0,870	0,0001	1,43000
0,730	0,940	0,0000	2,36000
0,780	0,960	0,0000	2,94500
0,830	0,980	0,0000	3,53000
0,880	1,000	0,0000	5,03000
Tabela 6.2: Funções da Saturação
Propriedades PVT do Gás
Pressão (MPa)	g (m3CR/m3CS)	Viscosidade (Pa.s)	Massa Específica (kg/m3)
0,11	0,83661	0,0080xl0”3	1,2
7,01	0,01793	0,0140xl0-3	53,9
13,90	0,00905	0,0189xl0"3	106,7
20,79	0,00606	0,0228xl0~3	159,4
27,68	0,00455	0,0268xl0-3	212,3
34,57	0,00364	0,0309xl0"3	265,4
41,46	0,00311	0,0349x1O”3	310,6
48,35	0,00272	0,0389x1O’3	355,1
55,24	0,00241	0,0430xl0”3	400,8
62,13	0,00217	0,0470xl0~3	
69,02	0,00197	0,0510xl0~3	490,3
Tabela 6.3: Propriedades PVT do Gás
Propriedades PVT do Óleo Saturado
Pressão	B«	Viscosidade	Massa Específica	Razão de Solubilidade
(MPa)	(m3CR/m3CS)	(Pa.s)	(kg/m3)	(m3CS/m3CS)
0,11	1,0628	l,0394xl0~3	741,8	0,35
7,01	1,2952	0,8299xl0-3	657,7	66,15
13,90	1,4352	0,6949x10"3	660,5	113,36
20,79	1,5650	0,5940x10”3	605,7	165,59 .
27,68	1,6950	0,5100xl0~3	593,8	226,20
34,57	1,8270	0,4490x10-3	583,7	288,20
41,46	1,9594	0,3875xl0"3	574,2	348,96
48,35	2,0918	0,3261xl0~3	565,9	409,72
55,24	2,2242	0,2646xl0”3	558,6	470,48
62,13	2,3567	0,2032xl0~3	552,1	531,25
69,02	2,4891	0,1417xl0~3	546,3	592,01
Propriedades PVT do Óleo Sub-Saturado
Pressão	Bo	Viscosidade	Massa Específica	Razão de Solubilidade
(MPa)	(m3CR/m3CS)	(Pa.s)	(kg/m3)	(m3CS/m3CS)
27,68	1,695	0,510xl0-3	593,8	226,2
62,15	1,579	0,740xl0"3	637,6	226,2
Tabela 6.4: Propriedades PVT do Óleo
Propriedades PVT da Agua
Pressão (MPa)	(m3CR/m3CS)	Viscosidade (Pa.s)	Massa Específica (kg/m3)
0,10	1,0410	0,310xl0~3	997,0
1,82	1,0403	0,310xl0~3	997,7
3,55	1,0395	0,310xl0~3	998,4
7,00	1,0380	0,310xl0“3	999,8
13,89	1,0350	0,310xl0”3	1002,7
17,34	1,0335	0,310xl0"3	1004,2
20,79	1,0320	0,310xl0~3	1005,7
27,68	1,0290	0,310xl0'"3	1008,6
34,57	1,0258	0,310xl0-3	1011,7
62,15	1,0130	0,310xl0-3	1024,5
Tabela 6.5: Propriedades PVT da Água
Uma comparação dos resultados da simulação (curvas de pressão de fluxo de fundo de poço, vazão de óleo e razão gás*óleo versus tempo) entre as rodadas totalmente implícita e do SIMBEST com parâmetro de implicitude igual a 3 (totalmente implícito) é mostrada nas figuras (6.2),(6.3) e (6.4). Em geral, as diferenças apresentadas entre os resultados obtidos com o simulador numérico desenvolvido e os obtidos com o SIMBEST são desprezíveis.
0 SIMBEST, no seu modo AIM, também foi utilizado na resolução deste problema, tendo alcançada uma economia de tempo de 15% em relação ao tempo gasto no seu modo totalmente implícito. 0 parâmetro de implicitude médio da rodada foi igual a 2,85 (praticamente o método totalmente implícito).
Figura 6.2: Pressão de Fluxo de Fundo de Poço versus Tempo (comparação com o SIMBEST)
/
Figura 6.3: Vazão de Oleo versus Tempo (comparação com o SIMBEST)
Os resultados obtidos com o simulador desenvolvido para este caso sao mostrados na tabela (6.6). Para as rodadas de implícitude auto-adaptável, o bloco do poço e seus vizinhos mais próximos foram considerados totalmente implícitos inicialmente, enquanto que, no resto do reservatório, adotou-se blocos IMPES. Uma economia de tempo de 12% foi alcançada.
	A uto-adaptável	Totalmente Implícito
Número total de passos de tempo	534	533
Número total de iterações	1248	1235
Iterações /Passo de tempo	2,34	2,32
Tempo total (seg)	3016	3432
Tempo/Iteração (seg)	2,42	2,78
Células IMPES (%)	18	0
Tabela 6.6: Resultados do Caso 1
Um primeiro aspecto a ser destacado é a proximidade dos valores encontrados para a economia de tempo do método de implicitude auto-adaptável em relação ao método totalmente implícito nos dois simuladores. Note ainda que se pode fazer uma analogía com o alto valor para o parâmetro de implícitude médio obtido no SIMBEST e a porcentagem relativamente baixa de blocos IMPES no simulador desenvolvido. Ou seja, o problema exige, para sua solução, um nível de implícitude bem alto, próximo do método totalmente implícito. Outro aspecto é que o SIMBEST relata parâmetros de implicitude baixos e próximos de 1 no início da simulação e que se elevam até valores bastante próximos de 3 ao final. Por sua vez, a rodada com o simulador desenvolvido apresenta uma porcentagem de células IMPES bastante elevada no início da simulação, a qual se reduz para aproximadamente zero ao final da rodada. Pode-se notar com isto a concordância no comportamento de ambos os simuladores.
Pode-se ver que o ganho de tempo com o método de implicitude auto-adaptável foi modesto. Existem diversas razões para isto. 0 problema apresenta uma
Este resultado é típico em problemas moderadamente difíceis para difíceis, os ganhos de tempo dos métodos de implídtude auto-adaptável são modestos. Em problemas simples, onde a maioria dos blocos são tratados explícitamente, a economia de tempo é significativa.
Uma comparação dos resultados da simulação (curvas de pressão de fluxo de fundo de poço, vazão de óleo e razão gás-óleo versus tempo) implícita e de implici-tude auto-adaptável é mostrada nas figuras (6.5),(6,6) e (6.7). Como esperado, as duas abordagens produzem resultados praticamente idênticos. Sendo assim, a preferência para uma abordagem sobre a outra baseia-se fundamentalmente no tempo de processamento, exigência de memória e facilidade de aplicações.
Figura 6.6: Vazáo de Oleo versus Tempo (Caso 1)
Figura 6.7: Razáo Gás-Oleo versus Tempo (Caso 1)
6.2	Caso 2
Usualmente a simulação de problemas de conificação de poço requer um nível de implicítude acima do de primeiro grau (método IMPES), devido às acentuadas variações de fluxo nas vizinhanças do poço. A tendência tem sido a de se tratar a coni-ficação de gás com um simulador totalmente implícito. Para determinar os verdadeiros níveis de implidtude exigidos por tais sistemas, investigaremos um problema hipotético no qual um poço sofre uma severa conificação de gás. Outro objetivo é determinar a quantidade de esforço desperdiçada, se houver, envolvida em um tratamento implícito.
O modelo consiste de dez blocos na direção radial, um na direção angular e dez camadas verticais. Um poço central produz da camada 5 com uma pressão de fundo de poço fixa de 22,72 MPa na camada. A queda de pressão média inicial nesta camada é de aproximadamente 5 MPa, dando origem a uma produção de 1085 rrt3/d. Esta cai para 65 m3/d após 12 dias, como mostrado na figura (6.8), A simulação não continuou após 12 dias, uma vez que o cone de gás estabilizou e as mudanças de saturação não foram tão severas. Os dados adicionais para o problema são dados na tabela (6.7).
Espessura das camadas, m	5,4,3,2,2,2,4,5,6,7
Profundidade da primeira camada, m	5040
Profundidade do contato gás/óleo, m	5052
Pressão no contato gás/óleo, MPa	27,68
Raio do poço, m	0,1
Raio do externo, m	500
Permeabilidade absoluta na direção x, m2	9,86923x10’14
Permeabilidade absoluta na direção z, m2	9,86923x10’14
Porosidade, fração	0,30
Compressibilidade da rocha, mPa~l	4,4xl0”4
Saturação de água irredutível , fração	0,12
Massa específica do óleo em condições padrão, kg/rrp	49,2
Densidade do gás em condições padrão, adimensioanal	0,8
Tabela 6.7: Descrição do Reservatório e Dados Básicos (Caso 2)
Figura 6.8: Vazão de Óleo versus Tempo (Caso 2)
A tabela. (6.8) mostra a comparação de desempenho dos métodos de implicitude auto-adaptável e totalmente implícito na solução do problema. Para a rodada de implicitude auto-adaptável, o bloco do poço e seus vizinhos mais próximos foram considerados totalmente implícitos inicialmente, enquanto que, no resto do reservatório, adotou-se blocos IMPES. Note que há proximidade dos resultados obtidos, à exceção daqueles que envolvem o tempo gasto no processamento. Uma economia de tempo de 49% foi alcançada.
Na figura (6.9) ilustra-se os graus de implicitude correspondente a três pontos de tempo ao longo da simulação. Os números de 1 até 10 no topo de cada mapa são os índices dos blocos da malha radial, enquanto os verticais são os números das camadas. Este indica quais blocos estão sendo computados implicitamente, onde I indica bloco totalmente implícito e E indica bloco IMPES. Notar que a 6 e 12 días somente uma parcela dos blocos da malha está sofrendo cálculos implícitos. Obviamente, um modelo totalmente implícito não é necessário para este problema.
	Auto-adaptável	Totalmente Implícito
Número total de passos de tempo	'340	342
Número total de iterações	566	574
Iterações /Passo de tempo	1,66	1,68
Tempo total (seg)	908	1764
Tempo/Iteração (seg)	1,6	34
Células IMPES (%)	49	0
Tabela 6.8: Resultados do Caso 2
Este caso foi também estudado, em uma segunda etapa, por intermédio da abordagem de implicitude variável aqui apresentada. Para tanto, definiu-se o mapa de configuração dos graus de implicitude mostrado na figura (6.10). Este permaneceu constante até o final da simulação. Os números de 1 a 10 no topo deste mapa sao os índices dos blocos da malha radial, enquanto os verticais são os números das camadas. Os diversos graus de implicitude são expressos da seguinte maneira: os valores 1 e 5 correspondem aos níveis básico (método IMPES) e máximo (Totalmente Implícito), respectivamente. Valores intermediários significam níveis de implicitude entre os limites extremos que são, em ordem crescente, relacionados aos métodos conhecidos por Solução Simultânea (grau
2), Semi-implícito Linearizado 1 (grau 3) e Semi-implícito Linearizado 2 (grau 4).
O gráfico de vazão de óleo versus tempo apresentado na figura (6.11) mostra que as diferenças entre os resultados obtidos, considerando-se as formulações totalmente implícita, de implicitude variável e auto-adaptável são, no que diz respeito à estabilidade da solução desprezíveis.
camada	lite-res,										tempo «cumulado (días)
	1	2	3	4	&amp;amp;	6	7	8	9	10	
1	E	E	E	E	E	E	E	E	E	E	
2	E	E	E	E	E	E	E	E	E	E	
3	E	E	E	E	E	E	E	E	E	E	
4	J	E	E	E	E	E	E	E	E	E	
5	1	1	E	E	E	E	E	E	E	E	0,0
6	1	E	E	E	E	E	E	E	E	E	
7	E	E	E	E	E	E	E	E	E	E	
8	E	E	E	E	E	E	E	E	E	E	
9	E	E	E	E	E	E	E	E	E	E	
10	E	E	E	E	E	E	E	E	E	E	
	1	2	3	i	5	0	7	8	9	10	
I	E	E	E	E	E	E	E	E	E	E	
2	E	E	E	E	E	E	E	E	E	E	
3	I	I	I	1	E	E	E	E	E	E	
4	I	I	I	I	E	E	E	E	E	E	
5	I	i	í	1	E	E	E	E	E	E	0,5
6	I	1	1	I	1	E	E	E	E	E	
7	I	1	1	I	E	E	E	E	E	E	
8	J	1	I	I	E	E	E	E	E	E	
9	E	E	E	E	E	E	E	E	E	E	
10	E	E	E	E	E	E	E	E	E	E	
	1	2	3	4	5	6	7	8	9	10	
1	I	1	1	I	I	I	E	E	E	E	
2	J	I	1	I	1	I	E	E	E	E	
3	i	1	I	I	I	I	E	E	E	E	
4	1	I	I	1	I	I	1	E	E	E	
&amp;amp;	1	I	I	1	I	I	1	E	E	E	6,0
6	I	I	1	)	I	I	I	E	E	E	
7	I	J	I	1	I	I	E	E	E	E	
8	I	1	I	I	I	I	I	E	E	E	
9	I	I	1	I	1	1	I	E	E	E	
10	J	I	I	1	1	1	I	E	E	E	
	1	2	3	4	5	6	7	8	9	10	
1	1	I	I	I	1	1	E	E	E	E	
2	I	1	I	I	I	I	E	E	E	E	
3	I	I	I	I	I	I	E	E	E	E	
4	I	I	I	I	I	I	I	E	E	E	
5	I	I	I	I	1	1	I	E	E	E	12,0
6	I	I	I	I	I	I	1	E	E	E	
7	I	I	I	I	I	I	E	E	E	E	
8	I	I	I	I	I	I	1	E	E	E	
9	I	I	I	I	I	1	I	E	E	E	
10	I	I	1	I	1	I	I	E	E	E	
Figura 6.9: Graus de Implicítude versus Tempo (Caso 2 - Método de Implicítude Auto-adaptável)
camada
blocos
	1	2	3
1	5	5	5
2	5	5	5
3	5	5	5
4	5	5	5
5	5	5	5
6	5	5	5
7	5	5	5
8	5	5	5
9	5	5	5
10	5	5	5
4	5	6	7	8	9	10
5	5	5	4	3	2	1
5	5	5	4	3	2	1
5	5	5	4	3	2	1
5	5	5	4	3	2	1
5	5	5	4	3	2	1
5	5	5	4	3	2	1
5	5	5	4	3	2	1
5	5	5	4	3	2	1
5	5	5	4	3	2	1
5	5	5	4	3	2	1
Figura 6.10; Configuração de Graus de Implicitude para a Abordagem de Implicitude Variável
Figura 6.11: Vazão de Óleo versus Tempo (Comparação entre Formulações)
	Implicitude Variável	Totalmente Implícito
Número total de passos de tempo	342	342
Número total de iterações	561	574
Iterações /Passo de tempo	1,64	1,68
Tempo total (seg)	1206	1764
Tempo/Iteração (seg)	2,1	3,1
Células IMPES (%)	10	0
Tabela 6,9: Parâmetros para a Análise de Desempenho da Formulação de Implidtude Variável
A comparação dos valores de tempo encontrados nas tabelas (6.8) e (6.9) mostra que a formulação de implicitude variável forneceu uma economia de 32% no tempo de processamento quando comparada a uma formulação totalmente implícita. Quando confrontada com o método auto-adaptável, apresentou-se mais lenta. Isto deve-se ao fato que se manteve, ao longo de toda a rodada, níveis de implicitude fixos nas células da malha de cálculo. Conclui-se então a importância do desenvolvimento de um critério de troca de implicitude adequado. Ou seja, que objetive a minimização do tempo de processamento sem perda de estabilidade na solução, levando-se em conta os níveis de implicitude intermediários que podem ser invocados pela formulação de implicitude variável apresentada neste estudo.
7 Conclusões
Uma formulação de implicitude variável para a simulação do fluxo mul-tifásico em reservatórios, que permite a atribuição de graus de implicitude que variam de um valor mínimo (IMPES) até um valor máximo (Totalmente Implícito), em cada célula da malha de cálculo, foi apresentada.
Adaptou-se um algoritmo para troca automática do nível de implicitude no espaço e no tempo. Contemplou-se apenas dois níveis extremos de implicitude (IMPES - Totalmente Implícito).
O método de implicitude auto-adaptável resultante do acoplamento do algoritmo de controle automático de implicitude à formulação de implicitude variável foi implementado em um simulador numérico.
Adaptou-se um método de solução de sistemas com matrizes esparsas com capacidade para o ordenamento arbitrário das equações e das incógnitas para a solução do problema matricial obtido. Assim, foi possível tirar vantagem da estrutura particular dos sistemas gerados pelo método de implicitude auto-adaptável desenvolvido.
Os resultados, para um problema de simulação de reservatórios “black-oil”, obtidos através do método proposto foram comparados a resultados provenientes de um simulador comercial, dotado também da facilidade de troca de implicitude. Essa comparação apresentou elevado grau de concordância.
Em problemas de simulação de reservatórios “black-oil*1, o método de implicitude auto-adaptável apresentou significativa redução no tempo de processamento se comparado com o método totalmente implícito, mantendo, tal como este, a estabilidade da solução.
0 método de implicitude auto-adaptável ainda não tira proveito de todos os níveis de implicitude que a formulação de implicitude variável apresentada pode
fornecer. Corno sugestão, seria interessante o desenvolvimento de um critério de escolha de irnplicitude robusto, que contemple uma gama maior de níveis de ímplicitude.
A análise aqui apresentada foi desenvolvida para um modelo “black-oil”. Futuramente, uma investigação de grande interesse seria a extensão desta para modelos com posición ais, que pelo fato de exigirem a solução simultânea de um número muito grande de equações, os ganhos em termos de esforço computacional seriam ainda mais significativos.
N omencla t ura
Símbolos
AIM - “Adaptive Implicit Method”
Bp - fator volume formação da fase p, Jm3C'R/m3CF]
b - fator de encolhimento
bp - 1/BP fator de encolhimento da fase p, [m3CP/m3CR\
CP - condições padrão
CR - condições de reservatório
Cr - compressibilidade da rocha, [MFcT1]
-	compressibilidade da água, [AfRa""1]
D - profundidade, [m]
F - função de resíduos
Fo - função de resíduos do óleo
-	função de resíduos do gás
FCM.te * critério da vazão para escolha de implicitude
IAN - “Inexact Adaptive Newton Method”
J - matriz de coeficientes
k - permeabilidade absoluta, [m2]
krg • permeabilidade relativa ao gás, adimensional
47
krt&gt; - permeabilidade relativa ao óleo, adimensional
P - matriz de permutação
ps - pressão da fase gás, [AíPa]
pa - pressão da fase óleo, [MPa]
P6 - pressão capilar
Pe?o - pressão capilar gás-óleo, [Pa]
q3 - termo fonte/sumidouro para o gás, [m3/dza]
qQ - termo fonte/sumidouro para o óleo, [rrP/dia]
q^ - vazão total na direção x, [m3/día]
Rt - razão de solubilidade gás-óleo, [m3CP/m3CP]
re - raio externo do reservatório, [m]
rw - raio do poço, [m]
Sp - saturação da fase p, fração
T - transmissibilidade
Ts - transmissibilidade do gás
To - transmissibilidade do óleo
t - tempo, [dia]
V - volume de uma célula, [m3]
Vp - volume poroso de uma célula, [m3]
- componente x da velocidade de Darcy
X - vetor solução
x - incógnita x
x ~ coordenada espacial direção x
é - mudança ao longo de uma iteração
Sx - mudança da incógnita x
A - operador de diferença espacial
Aí - intervalo de tempo
Aít - dimensão x de uma célula da malha de cálculo e - tolerância, na convergência do método de Newton 7 - peso específico
-	peso específico da fase óleo, [N/ m3]
75 - peso específico da fase gás, [ÍV/m3]
-	mobilidade da fase gás =I~ro/pfl, [(Pa.s)-1]
-	mobilidade da fase óleo =kT&lt;&gt;/pu, [(Pn-.s)"1]
pp - viscosidade da fase p, [Pu.s]
pP - massa específica da fase p, [è^/cm3]
$ - porosidade, fração
Subescritos
f - fase óleo ou gás
g - fase gás
i - índice na direção x
o - fase óleo
p - qualquer fase
x - índice na direção x
x - incógnita a:
w - fase água
— face na direção do índice decrescente
4- - face na direção do índice crescente
Sobrescritos
n - número do intervalo de tempo
T - transposta de um vetor
v - número da iteração Newtoniana
Referências
[1]	Aziz, K. &amp;amp; Settari, A., Petroleum Reservoir Simulation, London, Applied Science Pub., 1979.
[2]	Bertiger, W.L &amp;amp; Kelsey, F..L, “Inexact Adaptive Newton Methods”, Society of Petroleum Engineers, SPE 13501, 1985.
[3]	Coats, K.H., Nielsen, R.L., Terhune, MAI. &amp;amp; Weber, A.G., “Simulation of three-dimensional, two-phase flow in oil and gas reservoirs”, Trans. SPE of AIMS, Vol. 240, pp. 377-388, 1967.
[4]	Collins, D.A., Nghiem C.X. &amp;amp; Li Y-K, “An Efficient Approach to Adaptive-Implicit Compositional Simulation with an Equation of State” , Society of Petroleum Engineers, SPE 15133, 1986.
[5]	Douglas, J.,Jr., Peaceman, D.W. &amp;amp; Rachford, H.H.,Jr., “A method for calculating multi-dimensional immiscible displacement”, Trans. SPE of AIME, Vol. 216, pp. 297-306, 1959.
[6]	Forsyth, P.A., Jr. &amp;amp; Sammon, P.H., “Practical Considerations for Adaptive Implicit Methods in Reservoir Simulation”, Journal of Computational Physics, Vol. 62, pp. 265-281, 1986.
[7]	Fung, L. S-K, Collins, D.A. &amp;amp; Nghiem, L.X., “An Adaptive-Implicit Switching Criterion Based on Numerical Stability Analysis”, SPE Reservoir Engineering, Vol. 4, No. 1, pp. 45-51, 1989.
[8]	Letkeman, J.P. &amp;amp;: Ridings, R.L., “A numerical coning model”, SPE Journal, Vol. 19, No. 4, pp. 418-424, 1970.
51
[9]	MacDonald, R.C. &amp;amp; Coats, K.H., “Methods for numerical reservoir simulation of water and gas coning”, Trans. SPE of AIME, Vol. 249, pp. 425-436, 1970.
[10]	Nolen, J.S. &amp;amp; Berry, D.W., “Tests of the stability and time-step sensitivity of semi-implicit reservoir simulation techniques”, Trans. SPE of AIME, Vol. 253, pp. 253-266, 1972.
[11]	Peaceman, D.W., “Discussion of An Adaptive-Implicit Switching Criterion based on Numerical Stability Analysis”, SPE Reservoir Engineering, Vol. 4, No. 2, pp. 255-256, 1989.
[12]	Peaceman, D.W., Fundamentals of Numerical Reservoir Simulation, Amsterdam, Elsevier, 1977.
[13]	Rodríguez, F., “Un Enfoque Unificado de Métodos de Simulación Numérica de Yacimientos”, Wokshop das Aplicações da Ciência na Engenharia de Reservatórios de Petróleo, organizado pela CLAF, PUC/RJ e PETROBRÁS, Rio de Janeiro, 15-19 de Agosto, 1988.
[14]	Russell, T.F., “Stability Analysis and Switching Criteria for Adaptive Implicit Methods Based on CFL Condition”, Society of Petroleum Engineers, SPE 18416, 1989.
[15]	Sheffield, M., “Three phase flow including gravitational, viscous, and capillary forces”, Trans. SPE of AIME, Vol. 246, pp. 255-269, 1969.
[16]	Sheldon, J.W., Zondek, B. &amp;amp;; Cardwell, W.T., “One-dimensional, incompressible, non-capillary, two-phase fluid flow in a porous medium”, Trans. SPE of AIME, Vol. 216, pp. 290-296, 1959.
[17]	Sherman, A.H., “NSPIV, A Fortran Subroutine for Sparse Gaussian Elimination With Partial Pivoting”, ACM Trans, Math. Software.
[18]	Stone, H.L. &amp;amp; Gander, A.O.,Jr., “Analysis of gas*cap or dissolved-gas reservoirs”, Trans. SPE of AIME, Vol. 222, pp. 92-104, 1961.
[19]	Tan, T.B., “Implementation of an Improved Adaptive-Implicit Method in a Thermal Compositional Simulator”, SPE Reservoir Engineering, Vol. 3, No. 4, pp. 1123-1128, 1988.
[20]	Thomas, G.W. &amp;amp; Thurnau, D.H., “Reservoir Simulation Using an Adaptive Implicit Method”, Society of Petroleum Engineers, SPE 10120, 1983,
[21]	Thomas, G.W. &amp;amp; Thurnau, D.H., “The Mathematical Basis of the Adaptive Implicit Method”, Society of Petroleum. Engineers, SPE 10495, 1982.
[22]	Vinsome, P.K.W., “Fully Implicit versus Dynamic Implicit Reservoir Simulation”, The Journal of Canadian Petroleum, No. 2, pp. 49-53, 1985.
Apêndice A - Forma Expandida das Funções de Resíduos
Neste apêndice; a forma expandida das funções de resíduos é apresentada. Estas são
necessárias para se encontrar os elementos da matriz Jacobiana.
Oleo
. 1 [Poi-f-í Poí (7oA2?),+1] lo iÍPoí Poi-i *+2 2 ’“2
^{[i + Mp. - p^líW.' ~ (tó)?} = o
(A,l)
Gas
— Ts.+{pOi+1 Poj + Pc3oi+1 -Pcso. (7gAZ))í+i]
“	ÍP°&gt; ~ Poi-l + ^Sl°i ~~	~ (Tj^^)í-|]
+	P&lt;, “ Í^AD),^]
-	(^Rsíi-iü7^ “P^i ” (7oAD)i_i] + qoiltTg/T^ d- Rai]
-	K{[1 + Cr(p0 _ pjjjiyi + S" (Cw, + e,)(p0 - rt),. - S”. - Sn)
+ (Í^AM - (6A + ¡&gt;.B,S„)"} = O	(A.2)
onde
~ Dí
2
AjD^i — Di — -ÍZi-f-i
Apêndice B - Elementos da Matriz Jacobiana : Método Implícito
dFOi
^7	dT
W&gt; + aí?H^) -~
(Bd)

dpOi
dT°i+l
= -7k^(l +	+ [po;+1 - pOi ~ (7oAZ))1+i]^-^-
¿7o i	1
- M1 “ax&gt;h-^)-1*.
o;
’Oí
(B.2)
M, dpOi+1
o.
¿7
= To (1-AP
•+r	2 àp,
-^) + ki+J - Po, ~ (7oAP)í+i]
7+1
dT^
(B.3)

O(
dSOi
8F ■	^°i-í
= ”ho(
- O&lt;
7—1
Oí-3
dTa^	dT°^
[Poi-f-l P®i ~~ Í7o^-^)t+^] Qg	[P°J Poj_l (7oA2?)1_1] qç,
^{[l + ^(?o“P”)í]M
Oi
0,
dFOl
QTO
ÍíWh - Po, ~
(B.4)
(B.5)
(B.6)

^7S. I
5 dpoi-1
dT i-i + Pcgo. ~ Pcs^ ~ (7sAZ))t„l]
4- (OX41 +
2	2 áp^-y
k,- - Po^ + O - K
- ho.- “ Po^ ~	± —
2	'“2 (Jp(
9T0 x	dRs .
A±+T ____
+ M dp^ )
(B.7)
wSl
&amp;amp;Poí
-r9Míi + AP,.+j^ü]
O,
+
dT
[Po¿+1 ~ Poi + Íc9oí+1 ~ -fcSOi ~~ ( 7? A Z))í+1 ] ~0p O i
Ts¡ (1 ™ AP^i-—l~i)
-2	2 dpOi
ar5. 1 [pOí + O. - pc^ - (isAX-lJxX (Wi+i(l + áDi+i-^í)
Of
+
dT^
'o.
[Po.-n -p^ ~ (70AP)í+i](/?5i+,-—
(0X1(1 -ADM-¡^)
2	2 dpOí
dRá,
+W&gt;
dTo ,
—i
+

dRs ,
i&amp;lt;t _______‘r.s. \
-i X M dpQi
9p^¡	’ dpOi }
- P«) - s*' - sOt) + (Rssabo)t]
9b.

ÍP°t Poi-y	(7o AD),_i](ñSi
(d(T3/To){ t dR.
?oít--ã------r
dpoi
Kn - _
Ai
[1 + cX ~Poí)]1^(1 +5" (c^, +Cr)X -PoJ - -SJ t,.s^ + *) + s°h^f‘
•Sí
Oi
Oí
Jí
&gt;0Í
(B.8)
dP^l
+
+
dT boí+l ~Poi + -^90,+ 1 “	“ Í7s^^)¿+i]'^	~
(Wi+Í(l ~ ADMÍ^Ü.)
2	«Po,+1
dT	dR
+
)
(B.9)
dF
9i dSt
0^1
+
dT -boi -Poi-x - (7sAPti + pCaOt -
dP.
T	(—-¥í=± 4. AD, j 
ãs^ +	,-^(sOt_í
ti,
dT0
\poi~Poi_! -
(B.10)
ds.
Oi
^í+i [po¿+l — Po, (T^AD)^! + ^cS°t+i ” -^CgoJ Qg
dPc .	d^i+L
Ts&lt;+ i ( ãSo- + A£&gt;í'-H ~dS^
Oi
dSaí
0,
+

dT
boi P°i-1	(7tfAZ))}‘_l ”t” P^t/o, PcgUi-j ] Qg
dP	&lt;?7g i
àTo
boi+1 ~ Po, - (7oAP)i+i]Ki+i-J~-
dTo
bo. -Poi-í ~ (7oAD),_i]/?s^|-™~i _	K”fH . .. z..	,.Juín	,
&amp;amp;&gt;* dS	âi	^"Cr^ Psídí^o^s ^)i}
(B.ll)
dl^
g-i- U í) O	\P’&gt;i+í
^Oí+l
dT
_P
C9O, 7 C) c
l^í	^CgQi+1 J C9O, / CjC
dPc
+ T^-^ + ADMã^;)
1+1 dTa
[po,'+l ~ Poi ~~


it±
(B.12)
Apêndice C - “Matrixes Corretivas11
Como visto anteriormente, para o nó as equações podem ser escritas como
									¿Po	OH-l)
r &amp;amp;FOi	2íhu 1	(ri	r 9F*.:	1	(ri	r	&amp;amp;fQí n	(ri	.	j	í-l Oh-1)
^í-i			9po¡			^í+i 8FSi	9FS,		6p0 . . 8p0	
L 3po¿„i	J		L.	d$ot J		L fyoi+i	9-%,+1 J			^+3)
									&amp;amp;so	¿4-1
										

ou ainda,
Ci C2
C3 C4
Ai A2
A3 A4
	fyo	(1'4-1)	
	. êS° .	1—1 (p+1)	
	¿Po		r F ■* 0
	òS0		F L 19 J
	¿po	tw-i)	
	JSO	¿4-1	
onde,
Bi

A2
&amp;amp;foí
&amp;amp;sOi
B2~
&amp;amp;FOt
BpOi+i
A3 =
B3 —
A4 ~
B&amp;lt;=
55O,+ J
Cj c2		Ai A?	B4 B2
c3 c4		A A4	B$ B4
C2 - 0
C3 = (Ts + TaRs)^i
c4 = 0
Ai == ~crM+rM)
A2 — 0
A3 = -~(Tg + ToR¿)i_i - (Tg +
A = 0
B2 = O
B3 ~ (Ts + ToRs)í+l
B4 = 0
Cj
c3
C2
c4
Al
A3
B, ■
b4
dT
Ci = 4aPo~7oad]h^±
c2 = o
C3 = -[Ap5-7?AD]i_x^~Al„[Ap£)™7DAD];„x-^-^A
C4 - 0
A,
A2
^3
a4
dTo	QT
-[APo - %AP]i+|-^l - [Ap„ - 7.AP],_{
0
dT	dT
[Ap, -	[Aft ~ ^AP],.^-^
[Ap„ - 7„AO]j+i-í-—2i±i _ [APo _ 7oAB]j+i-^-Aj.
0
5T0
B. = -[Ap. - 7t,A£&gt;],.+17--!iÍ
2	^Pol+J
b2 ~ o
dTs .	d(T0Ra)i+í
B3 = -[Ap^7jAD],+í— -[Aft-%AB],.+j^—1
B4 ~ Q
C.
C3
C4
Aj A2
B1
B2
A3 A4
r
b3
b4
G
C2
C4
0
= 0
= -~[Aps - 7gAD].
- [Ap0 -
99oí-i
Â1 = 0
9TO	dT0
A2 = -[Ap0~70A£].+i-^y^-[Ap0~70AD]¿_i-™
A3 — 0 &amp;amp;Ta. x	d(Ts. .
A4 ----- [Apa -7çA%i^ -[Aps~75AD].„l~õ$ t	d(ToRa}i+±	W).,
[ãPo - loàD]iií}.+ - [Ap0 - 70AP];+i—^-*-
Br = 0
9T
B2 ~ -[Ap0 -70AP]¿+í -
2	aüOi+l
B3 - 0
9Tg	d(T0RX+L
B4 = -[Ap^ -7sAP]!+i^y^- - [Apo ~7&lt;M+i”-----------*•
to	to	to	te
A-	CC	«O
¡Jx
i-L
'afo

¡i ti
¡i ¡i
K] o
O O
se H
T
I	I
n 03	h“*
O Q
* w
t----	1
! ....... i
&lt;c &gt;-
&gt;U
«--•	....i.iuJ
.....»'i
1	1
o
Ci Ca	Ai A2		Bi B2
. c3 c4	A3 A4		b3 b4
C\
C,
C3
c4
&lt;fy0
= (T0AC)(_iT^Í
= 0
=
'°íxl	a 7o. 1
A = (T.AZ))i+1—ÍL + (I;AZ&gt;),._,-^i
+ ’ dpn	'' &gt; dpOi
A? ~ 0
H	$7» i
A, = ^T^D)i+i-^í +
2 dPoi	*	'* 2 dp&amp;amp;t
d/y^	¿7
_(ToKsAP)í+i—+ (UAP^x-^
3	apOi	2 dp,
B, =	= -(T0AD)i+x~Ü 2 ^Oi+1
B’2 -	= 0
B% -	= ~(^),.+| ^U(TAA^,.+^ 07s !
B4 =	(r°AP)¿+iáSOi„l
f W/t.)
] + [^
C*i C2 c3 c4
Ai A2
A3 A4
B1 B2
Bs B4
Cl - 0
c2 = 0
c3 = 0
c4 - 0
Ax = 0
^2
A3
A4
0
. d[(T3/TG)i + RSí] q°‘ aPa
d(T,/Ta\
"»&gt; ao
Bt = Q
B2 = Q
Bs = 0
B.¡ = 0
Ci C2 c3 c4
Ai A%
A3 A$
Bi B2‘
B3 B&lt;
Cl - 0
c2 = 0
c3 - 0
c4 = 0
= -^-{[l + CrtPo-P^MSoí^+CrítAJi}
712 = ^{[i+^(p.-p:).i^}
A3 = ^Kfe,(i + 5;,(c»&amp;lt;+ cr)(p..-p:,)-s” - Sp.) + uw.).] + [1 + ^(P«, ~ of^í1 + s:,(e», +&amp;lt;v)(p., - tf,) - s” - sj
+ bgtSZt^i ++ s°‘b°&lt;~r~ +	¿rH)
™Poi	apQi
A = ^íí + ^-^M-ò^}
Bi =	0
B2 = 0
Bs - 0
B4 = 0
Apêndice D - Rotinas de Montagem e Ordenação
Este apêndice contém algumas das rotinas computacionais que fazem parte do simulador de fluxo bi-fásico de implicitude auto-adaptável desenvolvido.
As rotinas listadas estão agrupadas da seguinte forma:
Grupo 1 - Rotinas para controle automático do grau de implicitude ao longo do passo de tempo e ao longo da iteração (Rotinas CAIM1A e CAIM1B).
Grupo 2 - Rotina para montagem das funções de resíduos e da matriz Jacobiana (Rotina FRGO).
Grupo 3 - Rotinas para inversão do bloco diagonal principal e montagem dos vetores de ordenação a serem fornecidos para a rotina de solução NSPIV (Rotinas P0INT2, INVERT e SOLVE).
67
C SUBBOTINA PARA CONTROLS DA IMPLICITUDE AO LONGO DE UM PASSO DE TEMPO C
C
C VARIAVEIS PRINICIPAIS
C --------------------------
c
c
AIMO - MATRIZ DE IMPLICITUDE INICIAL
C
AIM1X - MATRIZ DE IMPLICITUDE ATUAL
C	QTX
C	QTZ
C	VP
-	VAZAO TOTAL NA DIRECAO X
-	VAZAO TOTAL NA DIRECAO Z
-	VOLUME POROSO
C DELTAT - INTERVALO DE TEMPO
C FIM - FATDR DE CORTE
C
C~-----------------------------------------------------------------------
SUBROUTINE CAIM1A (NITS,FIM,QTX,QTZ)
C
PARAMETER (NTM=1O,NXM=15,NZM=15)
IMPLICIT DOUBLE PRECISION (A~H,O-Z)
REAL*8 XX,KZ,VP(NXM,NZM)
REAL*8 TEPM(NTM),DTM(NTM),DX(NXM),Q0MAX(NTM)
REAL*8 QTX(NXM,NZM),QTZ(NXM,NZM)
INTEGER OPCAO,AIMO(NXM,NZM),AIM1X(NXM,NZM)
C
COMMON /DADOS/PREF,QOMAX,QOMIN,PWFMIN,CTR,PHI(NZM) ,RW,RE,ESP,TEMP,
#	DG,SWI,ZMED,ZTW,ZTE,KX(NXM,NZM),KZ(NXM,NZM) ,DSAT,
#	TSAT,TPRES,DPRES,ITMAX,ITMIN,TMAX,DELTAT,DTMAX,
#	DTMIN,DTIMPR,DTIMPG,IXIMP,NX,NZ,DY,DTINI,AIMO,
#	AIM1X,OPCAO,DX,TEPM,DTM, JICAN, JFCAN,PWFL, JREF
C
COMMON /DMALHA/RAIOI(NXM),RAIOE(NXM),FGX(NXM,NZM),FGZ(NXM,NZM),
#	ZM(O:NXM+1,NZM),WX(NXM),WZ(NZM),VP,DZ(NZM)
C
IF(NITS.EQ.1) THEN
DO 1 I » 1,NX
DO 1 J = i,NZ
AIM1X(I,J)«AIMO(I,J)
1	CONTINUE
ELSE
DO 2 J = 1,NZ~1
AUXI«(QTX(2,J)+QTZ(1,J+1))*DELTAT/(VP(1,J)*86400.DO)
IF(AUXI.GT.FIM) THEN
AIM1X(1,J)*5
ELSE
AIM1X(1,J)-1
ENDIF
2	CONTINUE
DO 3 I ® ltNX-l
AUXI&lt;QTX(l44,i)+QTZ(I,2))*DELTAT/(VP(I,l)*86400.D0) IF(AUXI.GT.FIM) THEN
AIM1X(I,1)«5
ELSE
AIMÍX(I,1&gt;1
ENDIF
3	CONTINUE
DO 4 I = 2.NX-1
DO 4 J = 2,NZ-1
AUXI=(QTX(I+1,J)+QTZ(I,J+1))*DELTAT/(VP(I,J)*86400.DO) IF(AUXI.GT.FIM) THEN
AIM1X(I, J)=5
ELSE
AIM1X(I,J)-1
ENDIF
4	CONTINUE
DO 5 I = 1,NX-1
AUXI=(QTZ(I,NZ)+QTX(I+1,NZ))*DELTAT/(VP(I,NZ) *86400. DO) IF(AUXI.GT.FIM) THEN
AIM1X(I,NZ)=5
ELSE
AIM1X(I,NZ)=1
ENDIF
5	CONTINUE
DD 6 J* 1,NZ~1
AUXI=(QTZ(NX,J+l)+QTX(NX,J))*DELTAT/(VP(NX,J)*86400 . DO) IF(AUXI.GT.FIM) THEN
AIMIX(NX,J)«S
ELSE
AIM1X(NX,J)«l
ENDIF
6	CONTINUE
AUXI=(qTZ(NX,NZ)+QTX(NX,NZ))*DELTAT/(VP(NX,NZ)*86400.D0)
IF(AUXI.GT.FIM) THEN
AIM1X(NX,N2)»5
ELSE
AIM1X(NX,NZ)=1
ENDIF
ENDIF
C
RETURN
END
C
C------------------------:-----------------------------------------'-----
C SUBBOTINA PARA CONTROLE DA IMPLICITUDE AO LONGO DE UMA ITERACAO
C
C VARIAVEIS PRINICIPAIS
C ---------'---------------
c
c	A IMO	- MATRIZ DE IMPLICITUDE INICIAL
c	AIM1X	- MATRIZ DE IMPLICITUDE ATUAL
c	QTX	- VAZAO TOTAL NA DIRECAO X
c	QTZ	- VAZAO TOTAL NA DIRECAO Z
c	VP	- VOLUME POROSO
c	DELTAT	- INTERVALO DE TEMPO
c	FIM	- FATOR DE CORTE
c	SGCR	- SATURACAO DE GAS CRITICA
c
c---------------.------------------------------■.----------------------
SUBROUTINE CAIM1B (FIM^GCR^QTX^TZ)
C
PARAMETER (NTM=10,NXM=15,NZM=15)
IMPLICIT DOUBLE PRECISION (A-H.O-Z)
REAL*8 KX,KZ,VP(NXM,NZM),MIG1,MIG2
REAL*8 TEPM(NTM),DTM(NTM) ,DX(NXM),QOMAX(NTM)
REAL*8 QTX(NXM,NZM),QTZ(NXM,NZM)
INTEGER OPCAO,AIMO(NXM,NZM),AIM1X(HXM,NZM)
c
COMMON /DADOS/PREF^OMAX^OMIN.PWFMIN^TRjPHKNZM) ,RW,RE,ESP,TEMP,
#	DG, SWI, ZMED, ZTW, ZTE ,KX (NXM, NZM) ,KZ(NXM, NZM) , DSAT,
#	TSAT, TPRES, DPRES, ITMAX,ITMIN, TMAX, DELTAT , DTMAX,
#	DTMIN,DTIMPR,DTIMPG,IXIMP,NX,NZ,DY,DTINI ,AIMO,
#	AIM1X &gt; OPCAO, DX ,TEPM,DTM, JICAN, JFCAN ,PWFL , JREF
C
COMMON /DMALHA/RAIOKNXM) ,RAIOE(NXM) ,FGX(NXM,NZM) 5FGZ(NXM,NZM) ,
#	ZM(O :NXM+1 ,NZM) ,WX(NXM) ,WZ(NZM) ,VP,DZ(NZM)
COMMON /Gi/BG1(NXM,NZM),SG1(NXM,»ZM)
C
COMMON /G2/BG2(NXM,NZM),MIG2(NXM,NZM),R0G2(NXM,NZM),SG2(NXM,NZM)
C
DO 1 J = 1,NZ-1
AUXI» (QTX(2, J ) +QTZ (1, J+1) ) *DELTAT/ (VP(1, J ) *86400. DO) IF(AUXI.GT.FIM.OR.(SG2(1,J).GE.SGCR.AND.SGI(1,J).LE.SGCR))THEN AIM1X(1,J)»5
ENDIF
1	CONTINUE
DO 2 I = 1,NX-1
AUXI»(QTX(I+1,1)+QTZ(I,2))*DELTAT/(VP(IJl)*86400.D0)
IF(AUXI.GT.FIM.OR.(SG2(I,1),GE.SGCR.AND.SG1(I,1),LE.SGCR))THEN
AIM1X(I&gt;1)=5
ENDIF
2	CONTINUE
DO 3 I = 2,NX-1
DO 3 J = 2.NZ-1
AUXI=(QTX(I+1,J)+QTZ(I,J+l))*DELTAT/(VP(I,J)*86400.DO) IF (AUXI. GT. FIM, OR. (SG2(I, J) . GE. SGCR.AND,SGI(I,J).LE. SGCR) )THEN AIMlX(I,J)-5
ENDIF
3	CONTINUE
DO 4 I = 1,NX-1
AUXI=(QTZ(I,NZ)+QTX(I+1,NZ))*DELTAT/(VP(I,NZ)*86400.DO)
IF(AUXI.GT.FIM.OR.(SG2(I,NZ).GE.SGCR.AND.SGI(I,NZ).LE.SGCR))THEN AIM1X(IfNZ)=5
ENDIF
4	CONTINUE
DO 5 J - 1,NZ-1
AUXI= (QTZ(NX, J+l)+QTX(NXJ) )+DELTAT/(VP(NX, J)*86400 . DO)
IF(AUXI.GT.FIM.OR.(SG2(NX, J) . GE.SGCR.AND.SGI (NX,J).LE.SGCR))THEN AIM1X(NX,J)=5
ENDIF
5	CONTINUE
AUX1'=(qTZ(NX,NZ)+QTX(NX,NZ))*DELTAT/(VP(NX,NZ)*86400.DO) IF(AUXI,GT.FIM.OR.(SG2(NX,NZ).GE.SGCR.AND.SG1(NX,NZ).LE.SGCR))THEN AIM1X(NX,NZ)=5
ENDIF
RETURN
END
« o
C	SUBROTINA PARA CALCULO DAS FUNCOES DE RESÍDUO DO GAS E DO OLEO E
C	SUAS DERIVADAS (MONTAGEM DO JACOBIANO E TERMO INDEPENDENTE)
C
C VARIAVEIS PRINICIPAIS
C	---------------------
c
c	AIM1X	- MATRIZ DE IMPLICITUDE ATUAL
c	qTx	- VAZAO TOTAL NA DIRECAO X
c	QTZ	- VAZAO TOTAL NA DIRECAO Z
c	DELTAT	- INTERVALO DE TEMPO
c	Al	- MATRIZ JACOBIANA
c	FR	- VETOR COM AS FUNCOES DE RESÍDUOS
C
C----------------------------------------;-------------------------------
SUBROUTINE FRGO (P01,PD2,QTX,QTZ)
C
PARAMETER (NPVT=20,NTM=10,NXM«15,NZM=15)
IMPLICIT DOUBLE PRECISION (A-H.O-Z)
REAL*8 P01(»XM,NZM),P02(0:»X»H,0:NZM+l),VP(NXM,NZM)
REAL*8 MIG2,MID2,MIGFX,MI0FX,MIGFZ&gt;MI0FZ,KX1KZ,KRG2,KR02
REAL*8 TEPM(NTM),DTM(NTM),DX(NXM),QOMAX(NTM)
REAL*8 QTX(NXM,NZM) ,QTZ(NXM,NZM)
INTEGER OPCAO,AIMO(NXM,NZM),AIMtX(NXM,NZM)
C
COMMON /DADOS/PREF,QOMAX.qOMINjPWFMIN.CTR,PHI(NZM),RW,RE,ESP,TEMP,
#	DG,SHI,ZMED,ZTW,ZTE,KX(NXM.NZM),KZ(NXM,NZM),DSAT,
#	TSAT,TPRES,DPRES,ITMAX,ITMIN,TMAX,DELTAT,DTMAX,
#	DTMIN,DTIMPR,DTIMPG,IXIMP,NX,NZ,DY,DTINI,AIMO,
#	AIM1X,OPCAO,DX ,TEPM,DTM,JICAN,JFCAN,PWFL,JREF
C
COMMON /DMALHA/RAIOI(NXM),RAIOE(NXM),FGX(NXM,NZM),FGZ(NXM,NZM),
#	ZM(O:NXM+1,NZM),WX(NXM),WZ(NZM),VP,DZ(NZM)
C
COMMON /G1/BG1(NXM,NZM),SG1(NXM,NZM)
C
COMMON /O1/BO1(NXM,NZM),RSO1(NXM,NZM),SO1(NXM,NZM)
C
COMMON /W1/BW1(NXM,NZM),SW1(NXM,NZM)
COMMON /G2/BG2(NXM,NZM) ,MIG2(NXM,NZM) ,R0G2(NXM,NZM),SG2(NXM,NZM)
C
COMMON /02/B02(NXM,NZM),MI02(NXM,NZM),R002(NXM,NZM),RS02(NXM,NZM),
#	SD2(NXM,MZM)
C
COMMON /W2/BW2(NXM,NZM),CTW(NXM,NZM),SW2(NXM,NZM)
C
COMMON /GFX/BGFX(0:NXM+1,NZM),MIGFX(O:NXM+1,NZM),
#	ROGFX(O:NXM+1,NZM)
C
COMMON /OFX/BOFX(O:NXM+1 ,NZM) ,MIOFX(O ‘.NXM+1 ,NZM) ,
#	ROOFX(O:NXM+1,NZM),RSQFX(O:NXM,NZM)
C
COMMON /GFZ/BGFZ(NXM,NZM+1),MIGFZ(NXM,NZM+1),ROGFZ(»XM,NZM+1)
C
COMMON /DFZ/BDFZ(NXM,NZM+1),MIOFZ(NXM,NZM+1),RO0FZ(NXM,NZM+1),
#	RSOFZ(NXM,NZM+1)
C
#
#
#
#
#
#
#
#
#
#
#
#
COMMON/TRANSP/TGX(NXM+1,NZM),TOX(NXM+1,NZM),
TGZ(NXM,NZM+1),TOZ(NXM,NZM+1),
KRG2(NXM,NZM),KRO2(NXM,NZM),PC2(0:NXM+1,0:NZM+1), TGXOSA(NXM,NZM),TGXOSB(NXM,NZM),
TOXOSA(NXM,NZM),TOXOSB(NXM,NZM),
TGXISB(NXM.NZM),TGX1SC(NXM,NZM), TOX1SB(NXM,NZM),TOX1SC(NXM,NZM), :	TGZOSA(NXM,NZM),TGZOSB(NXM,NZM),
TOZOSA(NXM,NZM),TOZOSB(NXM,NZM),
t	TGZ1SB(NXM,NZM),TGZ1SC(NXM,NZM),
:	TOZ1SB(NXM,NZM),TOZ1SC(NXM,NZM),
■■	DKRGDS (NXM, NZM) , DKRODS (NXM, NZM) ,
i	DPCDS (0*. NXM+1,O:NZM+1)
c
COMMON /DODP/DBODP(O:NXM+1,NZM+1),DMIODP(O:NXM+1,NZM+1), »	DROODP(0:NXM+1,NZM+1),DRSODP(0:NXM+1,NZM+1)
C
COMMON /DGDP/DBGDP(O:KXM+1,NZK+1),DMIGDP(O:NXM+1,NZM+1),
#	DROGDP(0:NXM+1,NZM+1)
C
COMMON /DWDP/DBWDP(O:NXM+1,NZM+1)
C
COMMON /DFRJ/QG(NZM),QO(NZM),DQGDP(NZM),DQGDS(NZM),
#	DqODP(NZM),DQODS(NZM)
COMMON /SIS/AI(NZM*(NXM*(2*NZM+1)-NZM~1),4),FR(NXM*NZM,2),
*	DXJ(NXM*NZM,2),KD(NXM*NZM,1)
C
COMMON /DGDS/DBGDS(O:KXM+1,NZM+1),DMIGDS(O:NXM*1,N2M*1),
*	DROGDS(O:NXM+1,NZM+1)
C
AUXQ=86400.dO
C
-------------------------------------------------------------------'-----
C CÉLULAS 1=1&gt;NX E J=1,NZ
C------------------------------------------------------------------------
C
DO 3 I - 1,NX
DO 3 J - 1,NZ
C
IK=NZ*(I-1)+J
C
IAI=KD(IK,1)
C
C— CALCULO DOS TERMOS DE ACUMULACAO DO OLEO E DO GAS
C
AUX1=1.0D0+CTR*(P02(I,J)-PO1(I,J))
CTW(I,J)=DBWDP(I,J)/BW2(I,J)
AUX2«1.0D0+SWl(I,J)*(CTW(I,J)+CTR)*(P02(I,J)-P01(I,J))
*	-SW1(I,J)-SO2(I,J)
C
ACO=VP(I,J)*(AUX1*BO2(I,J)*S02(I,J)~BO1(I,J)*S01(I,J))/DELTAT ACG=(AUX1*(BG2(I,J)*AUX2+RS02(I,J)*S02(I,J)*B02(I,J))
*	-BG1 (I,J)*(1.ODO-SW1(I, J)-SOÍ(I,J))-RSO1(I,J)*SO1(I,J)
*	*BD1(I,J))*VP(I,J)/DELTAT
C
C— CALCULO DAS DERIVADAS DDS TERMOS DE ACUMULACAO DO OLEO E DO GAS EM
C
C RELACAO A SATURACAQ E A PRESSAO
C
DACODS=VP(I,J)*AUX1*BO2(I, J)/DELTAT
DACGDS~VP(I,J)*AUX1*(RSO2(I,J)*B02(I,J)~BG2(I,J))/DELTAT
*	+VP(I,J)*AUX1*DBGDS(I,J)*AUX2/DELTAT
C
DACODP=VP(I,J)*(CTR*B02(I,J)*S02(I,J)+AUX1*SO2(I,J)*DBDDP(I,J))
*	/DELTAT
DACGDP=(CTR*(BG2(I,J)*AUX2+RSD2(I,J)*SO2(1,15*602(I, J))
*	+AUXl*(DBGDP(I,J)*AUX2+BG2(I,J)*SWl(I,J)*(CTWa,J)+CTR)
*	+S02(I,J)*B02(I,J)*DRSDDP(I,J)+SQ2(I1J)*RS02(I,J)
*	*DBODP(I,J)))*VP(I,Jj/DELTAT
C
A3=0.0D0
A4=0.0D0
A1=O.ODO
A2=0.0D0
C3=0.0D0
04=0.ODO
01=0.ODO
02=0.ODO
C
IF(I.NE.l) THEN
0
C~~ CALCULO DOS POTENCIAIS DO OLEO E DO GAS NO SENTIDO X
0
P0T0Xl=P02(I,J)-P02(I-l,J)-R00FX(I,J)*(2M(I-l,J)-2M(I,J))
POTGX1=PO2(I,J)-P02(I”l,J)-ROGFX(I,J)*(2M(I-1,J)-2M(I,J))
*	+PC2(I&gt;J)-PC2(I-1&gt;J)
C
IF(AIM1XCI,J).LE.AIM1XÍI-1,J)) THEN
IG1»AIM1X(I,J)
ELSE
IG1=AIM1X(I-1,J)
ENDIF
C
C~“~-------------------------------------------------------------------
C METODO #1 : IMPES
C-----------------------------------------------------------------------
C1=TOX(I,J)
c
A1="TOX(I,J)
C
C3=T0X(I,J)*RSOFX(IjJ)+TGX(I,J)
C
A3=~T0X(I,J)*RSOFX(I,J)-TGX(I,J)
C-----------------------------------------------------------------------
C METODO #2 : SOLUCÁO SIMULTANEA
C------------------------------------------------;----------------------
IF(IG1.GE.2) THEN
C4~TGX(I,J)*DPCDS(I~1,J)
C
A4=-TGX(I,I)*DPCDS(I,J)
C
ENDIF
C---------:--------------------------------------------------------------
C MÉTODO #3 : SEMI-IMPLÍCITO LINEARIZADO 1
IF(IG1.GE.3) THEN
C
C2«-POTOX1*TOXOSA(I,J)
C
A2=-POTOX1*TOXOSB(I,J)
C
C4-C4-RS0FX(I,J)*POTDX1*TOXOSA(I,J)-POTGX1*TGXOSA(I,J)
C
A4=A4-P0T0Xl*RS0FX(I,J)*TOXOSB(I,J)-POTGX1*TGXOSB(I,J)
C
ENDIF
C-----------------------_______-----------------------------------------
C MÉTODO #4 : SEMI-IMPLÍCITO LINEARIZADO 2
C----------------------------------------------------------.-------------
IF(IG1.GE.4) THEN
C
C— CALCULO DAS DERIVADAS DAS TRANSMISSIBILIDADES EM RELACAO A PRESSÃO
C
TOXOPA«(WX(I-1)-1.ODO)*TOX(I,J)
*	♦&lt;DMIODP(I-1,J)/MIDFX(I,J)-DBODP(I“1,J)/BOFX(I1J))
TOXOPB=(-WX(I-1)*TOX(I,J)
*	♦(DMODP(I,J)/MIOFX(I&gt;J)-DBODP(I,J)/BOFX(I,J)))
TGXOPA»(WX(I-Í)-1.ODO)*TGX(I,J)
*	*(DMIGDP Cl-1,J)/MIGFX(I,J)-DBGDP(1-1,J)/BGFX(I,J)) TGXOPB=(-WX(I-1)*TGX(I,J)
*	*(DMIGDP(I,J)/MIGFX(I,J)-DBGDP(I,J)/BGFX(I,J)))
C
C1=C1-POTOX1*TOXOPA
c
A1-A1~POTOX1*TOXOPB
C
C3C3-POTOX1* (TOXOPA*RSOFX (I, J)+TOX(I, J) ♦ (1 .ODO-WX (I-1) )
*	*DRSODP(I-1,J))
*	-POTGX1*TGXOPA
C
A3=A3-P0T0Xl*(HSOFX(I &gt; I)*TQX0PB+T0X(I,J)*WX(I-1)*DRSODP(I,J))
*	-POTGX1*TGXOPB
C
ENDIF
C-----------------------------------------------------------------------
C METODO #5 : TOTALMENTE IMPLICITO
C—----------------------------------------------:-----------------------
IFdGÍ.EQ.5) THEN
C
C— CALCULO DAS DERIVADAS DAS DIF, DE POTENCIAL EM RELACAO A PRESSAO
C
POX1PA=(1.0DO-WX(I-1))*DROODP(W,J)*(ZM(I-1,J)-ZM(I,J)) POX1PB=WX(I-1)*DROODP(It J)*(ZM(I-1&gt;J)-ZM(I,J))
PGX1PA=(1,ODO-WX(I-1))*DROGDP(I-1,J)*(ZM(I-1,J)-ZM(I,J)) PGX1PB=WX(I-1)*DRDGDP(I,J)*(ZM(1-1,J)-ZM(I,J))
C
PGX1SA-(Í.ODO-WX(I-1))*DROGDS(I-1,J)*(ZM(I-1&gt;J)’ZM(I,J)) PGX1SB=WX(I-1)*DROGDS(I,J)*(ZM(I-Í,J)-ZM(I,J))
C
C1-C1+POX1PA*TOX(I,J)
C
A1»A1*POX1PB*TOX&lt;I,J)
C
C3=C3+POX1PA*TOX(I,J)*RSOFX(I,J)+PGX1PA*TGX(I,J)
C
A3»A3+POX1PB*TOX(I,J)*RSOFX(I,J)+PGX1PB*TGX(I,J)
C
C4=C4+PGX1SA*TGX(I,J)
C
A4“A4+PGXlSB*TGX(IfJ)
C
ENDIF
C
AI(IAI,1)=A3
AI(IAI,2)*A4
AI(IAIí3)=AÍ
AI(IAI,4)*A2
aKiai-nZ’IX^
AI(IAI-NZ,2)=C4
AI(IAI-NZ,3)«C1.
AI (IAI-NZ,4)=C2
C
C— CALCULO DA FUNCAO DE RESIDUE) DO OLEO
C
FRO«-TDX(I,J)*POTOX1
C
C~~ CALCULO DA FUNCAO DE RESIDUE) DO GAS
C
FRG--TDX(I,J)*RSOFX(I,J)*POTOX 1-TGX(I,J)*POTGX1
C
FR(IK,1)«-FRG
FR(IK,2&gt;-FR0
C
QOl-FRO*AUXq/BOFX(I,J)
QG1=-TGX(I,J)*POTGX1*AUXQ/BGFX(I,J)
QGS1=-TOX(I,J)*RSOFX(I,J)*POTOX1*AUXQ/BGFX(I,J)
QTX(I,J)=DABS(QO1)+DABS(QG1)+DABS(QGS1)
C
END IF
C
A3=0.QD0
A4=O.ODO
A1=0.ODO
A2=O.ODO
B3=O.ODO
B4=O.ODO
B1=0.ODO
B2=O.ODO
C
IF(I.HE.NX) THEN
C
C— CALCULO DOS POTENCIAIS DO OLEO E DO GAS NO SENTIDO X
C
POTOX2=PO2(I+1jJ)~P02(IjJ)-R0OFX(I+1,J)*(ZM(IjJ)-ZM(I+1&gt;J))
P0TGX2=P02(I+l,J)-P02(IfJ)-ROGFX(I+1,J)*(ZM(I,J)-ZM(I+1,J))
*	+PC2(I+1,J)-PC2(I,J)
C
IF(AIM1X(I41,J).LE.AIM1X(I,J)) then
IG1=AIM1X(I+1,J)
ELSE
IG1»AIM1X(I,J)
END IF
C METODO #1 : IMPES
C------------------------------------------------------------------------
Al—TOX(I+1,J)
C
B1=TOX(I+1,J)
C
A3=~T0X(I+l,J)*RSOFX(I+1,J)-TGX(I+1,J)
C
B3=T0X(I+l,J)*RSDFX(I+1,J)+TGX(I+1,J)
C~—-----------------------------------------------------------,---:------
C METODO #2 : SOLUCAO SIMULTANEA
C-~----------------------------------------------------------------------
IF(IG1.GE.2) THEN
C
A4=-TGX(I+1,J)*DPCDS(I, J)
C
B4=TGX(1+1tJ)+DPCDS(1+1,J)
C
ENDIF
C:-----------------------------------------------------------------------
C METODO #3 : SEMI-IMPLICITO LINEARIZADO 1
C------------------------------------------------------------------------
IF(IG1.GE.3) THEN
C
A2=?OTOX2*TOX1SB(I,J)
C
B2^POTOX2*TOX1SC(I,I)
C
A4=A4+P0T0X2*RS0FX(1+1,1)*TOX1SB(I,J)+POTGX2*TGX1SB(I,J)
a
B4-B4+POTOX2*RSOFX(I+i,J)+TOXÍSC(I,J)+POTGX2*TGX1SC(I, J)
c
ENDIF
C------------------------------------------------------------------------
C METODO #4 : SEMI-IMPLICITO LINEARIZADO 2
C------------------------------------------------------------------------
IFCIG1.GE.4) THEN
C
C— CALCULO DAS DERIVADAS DAS TRANSMISSIBILIDADES EM RELACAO A PRESSÃO
C	'
TOX1PB=(WX(I)-1.ODO)*TOX(I+1,I)
*	*(DMIDDP(I,J)/MIOFX(I+1, J)-DBODP(I, J)/BOFX(I+1, J)) TOXIPC--WX(I)*TOX(I+1,J)
*	*(DMIODP(I+1)J)/MIOFX(I+1ÍJ)-DBODP(I+1&gt;J)/BOFX(I+1ÍJ)) TGX1PB=CWX(I)~1.ODO)*TGX(I+1,J)
*	*(DMIGDP(I,J)/MIGFX(I+1,J)-DBGDP(I,J)/BGFX(I+1,J)) TGX1PO-WX(I)*TGX(I+1,J)
*	*(DMIGDP(I+i,J)/MXGFX(I+1,J)-DBGDP(I+1,J)/BGFX(I+1,J)) C
A1=A1+POTOX2*TOX1PB
C
BÍ=B1+PQTOX2*TOX1PC
C
A3=A3+P0T0X2*(RSOFX(1+1,J)*TOX1PB+TDX(I+1,J)*(l.ODO-WX(I))
*	*DRSODP(IÍJ))
*	+POTGX2*TGX1PB
C
B3«B3+P0T0X2*(RSDFX(I+l,J)*T0XlPC+T0X(I+l,J)*WX(I)
*	*DRSODP(I+1,J) )
*	+POTGX2*TGX1PC
C
ENDIF
C------------------------------------------------------------------------
C METODO #5 : TOTALMENTE IMPLICITO
C~----------------------_------------------------------------------------
IFÍIG1.EQ.5) THEN
C
C— CALCULO DAS DERIVADAS DAS DIF. DE POTENCIAL EM RELACAO A PRESSAO
C
P0X2PB=(í.ODO-WX(I))*DROODP(I,J)*(ZM(I,J)"ZM(I+1,J))
POX2PC»WX(I)*DROODP(I+1,J)*(ZM(I,J)-ZM(I+1,J)) PGX2PB-(1.0D0“WX(I))*DR0GDP(I,J)*(ZM(I&gt;J)-ZM(I+ltJ))
PGX2PC=WX(I) *DROGDP(I+1, J) *(ZM(I, J).-ZM(I+1, J))
C
PGX2SB»(1.ODO-WX(I))*DROGDS(I,J)♦(ZM(I,J)-ZM( 1+ í,J))
PGX2SC=WX(I)*DR0GDS(I+l,J)*(ZM(I,J)-ZM(I+1,J))
C
Al=Al-P0X2PB*T0X(1+1,J)
C
Bl»Bl-P0X2PC*T0X(I+l,J)
C
A3=A3-P0X2PB*T0X(I+l,J)♦RSOFX(I+1,J)-PGX2PB*TGX(1+1,J)
B3=B3~POX2PC*TOX(I+1,J)*RSOFX(I+1,J)-PGX2PC*TGX(I+1,J)
C
A4=A4-PGX2SB*TGX(1+1„J)
C
B4=B4~PGX2SC*TGX(I+1,J)
C
ENDIF
C
AI(IAI,1&gt;AI(IAI,1)+A3
AI(IAI,2)=AI(IAIJ2)+A4
AI(IAI,3)»AI(IAI,3)+A1
AI(IAI,4)=AI(IAX,4)+A2
AI(IAI+NZ,1)-AI(IAI+NZ,1)+B3
AX(XAI+NZ,2)=AI(IAI+NZ,2)+B4
AX(IAI+NZ,3)=AX(IAI+NZJ3)+B1
AI(IAX+NZ,4)=AI(IAI+NZJ4)+B2
C
C— CALCULO DA FUNCAO DE RESIDUQ DO OLEO
C
FRO=TOX(1+1,J)*P0T0X2
C
C— CALCULO DA FUNCAO DE RESIDUO DO GAS
C
FRG«T0X(I+l,J)*RS0FX(I+l,J)*P0T0X2+TGX(I+l,J)*P0TGX2
C
FR(IK,1)“FR(IKJ1)-FRG
FR(IK,2)=FR(IK,2)~FR0
C
ENDXF
C
IF(NZ.NE.l) THEN
C
A3=0.0D0
A4®O.ODO
A1=O.ODO
A2=0.0D0
C3=0.0D0
C4-0.ODO
C1=O.ODO
C2=0.0D0
c
IF(J.NE.l) THEN
C
C— CALCULO DOS POTENCIAIS DO OLEO E DO GAS NO SENTIDO Z
C
POTOZ1=PD2(I,J)-P02(I,J-1)+ROOFZ(I,J)*(ZM(I,J)-ZM(I,J-l))
P0TGZl«P02(I,J)-P02(I,J-l)+R0GFZ(I,J)*(ZM(I,J)-ZM(I,J-l))
*	+PC2(I,J)-PC2(I,J-1)
C
IF(AIM1X(I,J).LE.AIM1X(I,J-l)) THEN IG1-AIM1X(I,J)
ELSE
IG1=AIM1X(I,J-i)
ENDIF
C
C------------------------------------------------------------------------
C METODO #1 : IMPES
(J---:-----------------------------------------------:-------------------
C1=TOZ(I,J)
C
A1«-TOZ(I,J)
C
C3=TOZ(I,J)*RSOFZ(I,J)+TGZ(I,J)
C
A3=-T0Z(I,J)*RSOFZ(I,J)-TGZ(I,J)
C------------------------------------------------------------------------
C METODO #2 : SOLUCAO SIMULTANEA
IF(IG1.GE.2) THEN 1	
C4=TGZ(I,J)*DPCDS(I,J-l) 1	
A4=-TGZ(I,J)+DPCDS(I,J) F	
ENDIF [	
C METODO #3 : SEMI-IMPLICITO LINEARIZADO 1
C-------------------------------------------
IF(IG1.GE.3) THEN
C
C2=-P0T0Zl*T0Z0SA(I,J)
c
A2--P0T0Zl*T0Z0SB(l,J)
C4-C4-RS0FZ(I, J) *POTOZ1*TOZOSA(I, J) -POTGZ1*TGZOSA.(I, J)
C
A4=A4-POTOZ1*RSOFZ(I,J)*TOZOSB(I,J)~POTGZ1*TGZOSB(I,J)
C
ENDIF
C------------------------------------------------------------------------
C METODO #4 : SEMI-IMPLICITO LINEARIZADO 2
C------------------------------------------------------------------------
IF(IG1.GE.4) THEN
C
C— CALCULO DAS DERIVADAS DAS TRANSMISSIBILIDADES EM RELACAO A PRESSAO
C
TÜZOPA= (WZ ( J-1) -1 •. ODO ) *TOZ (I, J )
*	*(DMIODP(I,J"1)/MIOFZ(I,J)-DBODP(I,J’1)/BOFZ(I,J))
TOZOPB®(-WZ(J-1)*TOZ(IJJ)
*	*(DMIODP(I,J)/MIOFZ(I,J)-DBODP(I,J)/BOFZ(I,J)))
TGZOPA“(WZ(J-1)-Í.ODO)*TGZ(I,J)
*	*(DMIGDP(I,J-1)/MIGFZ(I,J)-DBGDP(I,J-1)/BGFZ(I,J))
TGZOPB=(-WZ(J-1)*TGZ(I,J)
*	*(DMIGDP(I,J)/MIGFZ(I,J)-DBGDP(I,J)/BGFZ(I,J)))
C
C1=C1“POTOZ1*TOZOPA
C
A1’A1-POTOZÍ*TOZOPB
C
C3®C3~P0T0Zl*(T0Z0PA*RSQFZ(I,J)+TOZ(I,J)*(l.ODO-WZ(J-l))
*	*DRSODP(I,J-1))
*	-POTGZ1+TGZOPA
C
A3=A3-P0T0Zl*(RSQFZ(I,J)+TOZOPB+TOZ(I,J)*WZ(J-1)*DRSODP(I,J))
*	-POTGZ1*TGZOPB
C
ENDIF
C------------------------------------------------------------------------
C METODO #5 : TOTALMENTE IMPLICITO
C------------------------------------------------------------------------
IF(IGl.EQ.S) THEN
C
C— CALCULO DAS DERIVADAS DAS DIF. DE POTENCIAL EM RELACAO A PRESSAO
POZ1PA=-(Í.ODO-WZ(J-1))*DRDODP(I,J-1)*(ZM(IJJ)-ZM(IJJ-1))
POZlPB=-WZ(J-i)*DROODP(I&gt;J)*(ZM(I,J)-ZM(I,J-l))
PGZ1PA«-(1.ODO-WZ(J-1))*DROGDP(I,J-1)*(ZM(I,J)-ZM(I,J-1))
PGZ1PB«“WZ(J“1)*DROGDP(IU)*(ZM(I,J)-ZM(I,J-1))
C
PGZ1SA=“(1.ODO-WZ(J-1))*DROGDS(I,J~1)*(ZM(I,J)-ZM(ItJ-l)) PGZ1SB«-WZ(J-1)*DROGDS(I,J)*(ZM(I,J)~ZM(I,J-1))
C
C1«C1+POZ1PA*TOZ(I,J)
C
A1«A1+POZ1PB*TOZ(I, J)
C
C3=C3+POZ1PA*TOZ(I,J)*RS0FZ(I,J)+PGZ1PA*TGZ(I,J)
C
A3=A3+POZ1PB*TOZ(I,J)*RSOFZ(I,J)+PGZ1PB*TGZ(I, J)
C
C4=C4+PGZ1SA*TGZ(I,J)
C
A4=A4+PGZ1SB*TGZ(I,J)
C
EJÍDIF
C
AIÇIAI,í)=AI(IAIf1)+A3
AI(IAI,2)«AI(IAI,2)+A4
AI(IAI,3)«AI(IAI,3)+A1
AI(IAI,4)«AI(IAI,4)+A2
AI(IAI-1,1)«AI(IAI-1,1)+C3
AI(IAI-1,2)«AI(IAI~Í,2)+C4
AI(IAI-1,3)«AI(IAI-1,3)+C1
AKlAI-l^WKlAI-i^í+CZ
C
C— CALCULO DA FUNCAO DE RESIDUO DO OLEO
C
FRO=-TOZ(I,J)*POTOZ1
C
C— CALCULO DA FUNCAO DE RESIDUO DO GAS
C
FRG=~TOZ(I,J)*RSOFZ(I,3)♦POTOZl-TGZ(I,J)*POTGZ1
C
FR(IK,1)«FR(IK,1)-FRG
FRCIK,2)«FR(IK,2)-FRO
QO1=FRO*AUXQ/BOFZ(I,J)
QG1=-TGZ(1,1)*P0TG21*AUXQ/BGFZ(1,3)
QGS1="TOZ(I,J)*RSOFZ(I,J)*POTDZ1*AUXQ/BGFZ(I, J)
QTZ(ItJ)«DABS(QDl)+DABS(QGl)+DABS(QGSl)
C
ENDIF
C
A3=0.0D0
A4=O.ODO
A1=O.ODO
A2=0.0D0
B3=0.0D0
B4=0.0D0
B1=O.ODO
B2=0,0D0
C
IF(J.NE.NZ) THEN
C
C~~ CALCULO DOS POTENCIAIS DO OLEO E DO GAS NO SENTIDO X
C
P0T0Z2=P02(I,J+l)~P02(I,J)+ROOFZ(I,J+1)*(ZM(I,J+1)-ZM(I,J))
POTGZ2=P02(I,J+1)-P02(I,J)+ROGFZ(I,J+1)*(ZM(I,J+1)-ZM(I,J))
*	+PC2(I,J+1)~PC2(I,J)
C
IF(AIM1X(I,J+l).LE.AIMlXfl,J)) THEN
IG1«AIM1X(I,J+1)’
ELSE
IG1«AIM1X(I,J)
ENDIF
C
C------------------------------------------------------------------------
C METODO #1 : IMPES
C------------------------------------------------------------------------
Ai»-TOZ(I,J+l)
C
B1»TOZ(I,J+l)
C
A3=-T0Z(I,J+1)*RSOFZ(I,J+l)-TGZ(I,J+l)
C
B3=TOZ(I,J+1)*RSOFZ(I,J+1)+TGZ(I,J+l)
C—-----------------------------------------------------------------------
C METODO #2 : SOLUCAO SIMULTANEA
C---------------------------------:--------------------------------------
IF(IG1.GE.2) THEN
C
A4=-TGZ(I,J+1)*DPCDS(I,J)
C
B4=TGZ(I,J+1)*DPCDS(I1J+1)
c
ENDIF
C------------------------------------------------------------------------
C METODO #3 : SEMI-IMPLÍCITO LINEARIZADO 1
C------------------------------------------------------------------------
IF(IG1.GE.3) THEN
C
A2=POTOZ2*TOZ1SB(I,J)
C
B2=POTDZ2*TOZ1SC(I,J)
C
A4-A4+P0T0Z2*RS0FZ(I,J+l)*TOZ1SB(I,J)+POTGZ2*TGZ1SB(I,J)
C
B4=B4+P0T0Z2*RS0FZ(I,J+1)*TDZ1SC(I,J)+PQTGZ2*TGZ1SC(I,J)
C
ENDIF
C------------------------------------------------------------------------
C METODO #4 : SEMI-IMPLICITO LINEARIZADO 2
C------------------------------------------------------------------------
IF(IG1.GE.4) THEN
C
C— CALCULO DAS DERIVADAS DAS TRANSMISSIBILIDADES EM RELACAO A PRESSAO
C
TOZ1PB=(WZ(J)-1.ODO)*TOZ(I,J+l)
*	*(DMIODP(I,J)/MIOFZ(I,J+1)-DBODP(I,J)/BOFZ(I J+l))
TOZ1PC=-WZCJ)*TOZ(I&gt;J+1)
*	* (DMIODP(I, J+l) /MIOFZd, J+l) -DBODP (I, J+l) /BOFZ (I, J+l) ) TGZ1PB®(WZ(J)-1.ODO)*TGZ(I,J+l)
*	*(DMIGDP(I,J)/MIGFZ(IfJ+1)-DBGDP(I,J)/BGFZ(I,J+l)) TGZ1PC=-WZ(J)*TGZ(I,J+l)
*	*(DMIGDP(I,J+1)/MIGFZ(I,J+1)-DBGDPCI,J+1)/BGFZ(I,J+1))
C
A1=A1+POTOZ2*TOZ1PB
C
B1=B1+POTOZ2*TOZ1PC
C
A3=A3+P0TDZ2*(RSOFZÍIJ+l)*TOZ1PB+TOZ(I,J+l)*(1.ODO-WZ(J))
*	*DRSODP(I,J))
*	+PDTGZ2*TGZ1PB
C
B3=B3+P0T0Z2*(RS0FZ(I,J+1)*TOZ1PC+TOZ(I,J+1)*WZ(J)
*	*DRSODP(I,J+l))
*	+POTGZ2*TGZ1PC
C
ENDIF
C-----------:------------------:-----------------------------------------
C METODO #5 : TOTALMENTE IMPLICITO
C------------------------------------------------------------------------
IF(IGl.EQ.S) THEN
C
C— CALCULO DAS DERIVADAS DAS DIF. DE POTENCIAL EM RELACAO A PRESSAO
C
P0Z2PB=-(l,ODO-WZ(J))*DRODDP(ItJ)*(ZM(I,J+1)~ZM(I,J)) POZ2PO-WZ(J)*DROODP(I, J+1)*(ZM(I, J+1)-ZM(I, J)) PGZ2PB=-(1.ODO“WZ(J))*DROGDP(I,J)*(ZM(I,J+1)-ZM(I,J)) PGZ2PO“WZ(J)*DROGDP(IIJ+1)*(ZM(IÍ J+1)-ZM(I, J))
C
PGZ2SB»-(1.0DO"WZ(J))*DROGDS(I,J)*(ZM(I,J+1)"ZM(I,J)) PGZ2SC®~WZ(J)*DR0GDS(I,J+1)*(ZM(I,J+1)-ZM(I,J))
C
A1=A1-POZ2PB*TOZ(I,J+l)
C
B1=B1-POZ2PC*TOZ(I,J+l)
C
A3-A3-P0Z2PB*T0Z(l,J+l) *RSOFZ(I,J+1)-PGZ2PB*TGZ(I,J+l)
C
B3=B3-P0Z2PC*T0Z(I,J+l)*RSOFZ(1,1+1)-PGZ2PC+TGZ(I,J+l)
C
A4=A4~PGZ2SB*TGZ(I,J+l)
C
B4=B4~PGZ2SC*TGZ(I,J+l)
C
ENDIF
C
AI(IAI,1)~AI(IAI,1)+A3
AI(IAI,2)=AI(IAIl2)+A4
AI(IAI,3)=AI(IAI,3)+Al
AI(IAI,4)=AI(IAI,4)+A2
AI(IAI+1fl)=AI(IAI+1,i)+B3
AI(IAI+1,2)«AI(IAI+1,2)+B4
AI(IAI+1,3)=AI(IAI+1,3)+B1
Al(IAI+1,4)=AI(IAI+1,4)+B2
C
C— CALCULO DA FUNCAO DE RESIDUO DO OLEO
C
FRO=TOZ(I,J+1)+PDT0Z2
C
C— CALCULO DA FUNCAO DE RESIDUE) DO GAS
C
FRG-T0Z(I, J+D*RS0FZ(I, J+lJ+POTOZZ+TGZflj J+l)*P0TGZ2
c
FRdK,l)=FRdK1l)"FRG
FR(IK,2)«FR(IK,2)-FR0
C
ENDIF
ENDIF
C
IF(I.EQ.1.AND.(J.GE.JICAN.AND.J.LE.JFCAN)) THEN
Al(IAI,1)=AI(IAI,1)-DACGDP-DQGDP(J)
AldAI, 2)“AI(IAI, 2)~DACGDS~DQGDS( J)
Al(IAI,3)=AI(IAI,3)-DAC0DP-DQ0DP(J)
AI(IAI,4)«AI(IAI,4)-DACDDS-DQODS(J)
c
FR(IKjti)=’FR(IK,l)+QG(J)+ACG
FR(IK,2)»FR(IK,2)+QO(J)+ACO
C
ELSE
C
Al (IAI 11)=AI (IAI,D-DACGDP
Al(IAI,2)=AI(IAI,2)-DACGDS
Al(IAI,3)=AI(IAIa3)-DACODP
Al(IAI34)=AI(IAI,4)“DACODS
C
FR(IK,1)SSFR(IK,1)+ACG
FR(IK,2)=FR(IK,2)+AC0
C
ENDIF
C
3 CONTINUE
C
RETURN
END
C SUBBOTINA DE MONTAGEM DOS VETORES DE PONTEIROS "IA "/’’IA" PARA NSPIV C~----------------------------------------------------------------------
SUBROUTINE P0INT2 (IA,JA)
C
PARAMETER (NTM=10,NXM=15,NZM»15)
IMPLICIT DOUBLE PRECISION (A-H,O~Z)
REAL*8 KX,KZ,TEPM(NTM),DTM(NTM),DX(NXM),QOMAX(NTM)
INTEGER OPCAO,AIMO(NXM,NZM),AIM1X(NXM,NZM)
INTEGER NC(NXM*NZM*2)
INTEGER IA(NXM*NZM*2+1),JA(5*NXM*NZM*4)
C
COMMON /DADOS/PREF, QOMAX, QOMIN, PWFMIN, CTR, PHI(NZM) ,RW,RE,ESP,TEMP, t	DG,SWI,ZMED,ZTW,ZTE,KX(NXM,NZM),KZ(NXM,NZM),DSAT,
»	TSAT,TPRES,DPRES,ITMAX,ITMIN,TMAX,DELTAT,DTMAX,
#	DTMIN,DTIMPR,DTIMPG, IXIMP,NX,NZ,DY,DTINI,AIMO,
#	AIM1X,OPCAO,DX ,TEPM,DTM , JICAN,JFCAN,PWFL,JREF
C
C— VETOR COM NUMERO DE VALORES NAO NULOS POR LINHA
C
K=1
DQ1I= 1(NX
DO 1 J = 1,NZ
KK=1
IF(I.NE.1.AND,(AIMIXÍI,J).EQ.5.AND.AIM1X(I~1,J).EQ.5)) KK-KK+2 IFÍI.NE.1.AND.(AIMIXÍI,J).EQ.1.OR.AIM1XÍI-1,J).EQ.l)) KK=KK+1 IFÍI.NE.NX.AND.(AIMIXÍI,J).Eq.5.AND.AIMlX(I+l,J).Eq.5)) KK=KK+2 IF(I.NE.NX.AND.(AIMIXÍI,J).EQ.1.OR.AIM1X(I+1,J).EQ.l)) KK=KK+1 IF(J.NE.1.AND.(AIMIXÍI,J).Eq.5.AND.AIMIXÍI,J-l).EQ.5)) KK=KK+2 IF(J.NE.1.AND.(AIMIXÍI,J).Eq,1-OR.AIMIXÍI,1-1).EQ.l)) KK=KK+1 IF(J.NE.NZ.AND.(AIM1X(I,J).EQ.5.AND.AIM1X(I,J+l).EQ.5)) KK-KK+2 IF(J.NE.NZ.AND.(AIMIXÍI,D.EQ.l.DR.AIMIXÍI,J+l).EQ.l)) KK=KK+1 NC(K)=KK
NC(K+1)=KK
K=K+2
1 CONTINUE
C
C-“ VETOR COM A POSICAO ACUMULADA DO PRIMEIRO VALOR NAO NULO DE CADA
C LINHA
C
IA(1)»1
KK=1
M 2 I = 1,NX
DO 2 J = 1,NZ
IA(KK+1)-IA(KK)+NC(KK)
IA(KK+2)=IA(KK+1)+NC(KK+1)
KK=KK+2
2	CONTINUE
C
C— VETOR COM A POSICAO DE CADA UM DOS VALORES NAO NULOS DE CADA LINHA
C
KK=O
JB=NZ
DO 3 I - 1,NX
DO 3 J = 1,NZ
KK=KK+1
KM-KK-2+JB
KP=KK+2*JB
KCL=IA(KK)
JA(KCL)=KK
M=1
IF(J.EQ.NZ) GO TO 100
LM=M
JA(KCL+LM)=KK+2
M-M+l
IF(AIM1X(X,J).EQ.1.DR.AIM1X(I,J+l).EQ.1) GO TO 100
JA(KCL+LM+l)-KK+3
M=M+1
100	IF(J.EQ.l) GD TO 101
LM=M
JA(KCL+LM)=KK~2
M=M+1
IF(AIM1X(I,J).EQ.1.OR.AIM1X(I,J-1).EQ.l) GO TO 101
JA(KCL+LM+1)=KK-1
M=M+1
101	IF(I.EQ.l) GO TO 102
LM-M
JA(KCL+LM)=KM
M=M+1
IF(AIM1X(I,J).EQ.l.OR.AIM1X(I-1,J).EQ.l) GO TO 102
JA(KCL+LM+1)=KM+1
M=M+1
102	IF(I.EQ.NX) GO TO 103
103
C
104
105
106
LM-M
JA(KCL+LM)=KP
M=M+1
IF(AIM1X(I,J).EQ. 1.0R. AIMlXQ+l, J).EQ.l) GO TO 103 JA(KCL+LM+1)=KP+1
CONTINUE
KK=KK+1
KM=KK-2*JB
KP=KK+2*JB
KCL=IA(KK)
JA(KCL)=KK
M=1
IF(J.EQ.NZ) GO TO 104
LM=M
JA(KCL+LM)=KK+1
M=M+1
IF(AIM1X(I,J).EQ.l.OR.AIM1X(I,J+1).EQ.l) GO TO 104 JA(KCL+LM+l)=KK+2
M=M+1
IF(J.EQ.l) GD TO 105
LM=M
JA(KCL+LM)=KK-3
M=M+1
IF(AIM1X(I,J)-EQ.l.OR.AIMlX(IfJ-l).EQ.l) GO TO 105 JA(KCL+LM+l)=KK-2
M=M+1
IF(I.Eq.l) GO TO 106
LM=M
JA(KCL+LM)=KM-1
M=M+1
IF(AIM1X(I,J).EQ.l.OR.AIM1X(I-1,J).EQ.l) GO TO 106 JA(KCL+LM+1)=KM
M=M+1
IF(I.EQ.NX) GO TO 107
LM=M
JA(KCL+LM)=KP-1
M=M+1
IFÍAIM1XEQ.l.OR.AIM1X(I+1,J).EQ.l) GO TO 107 JA(KCL+LM+1)=KP
CONTINUE
3	CONTINUE
C
RETURN
END
C
C------------------------------------------------------------------------
C SUBBOTINA PARA INVERSÃO DA MATRIZ BLOCO DIAGONAL PRINCIPAL DA MATRIZ E
C JACOBIANA E MULTIPLICACAD DA RESPECTIVA LINHA DO SISTEMA DE EQUACOES
C
C
C VARIAVEIS PRINICIPAIS
C --------------------------
C
AIM1X - MATRIZ DE IMPLICITUDE ATUAL
C Al
- MATRIZ JACOBIANA
C ER
- VETOR COM AS FUNCOES DE RESÍDUOS
C
O —---------------------------------------------------------------------
SUBROUTINE INVERT
C
PARAMETER (NTM=10iNXM=15&gt;NZM=15)
IMPLICIT DOUBLE PRECISION (A-H,O-Z)
REAL*8 KX,KZ
REAL*8 DTM(NTM),TEPM(NTM),DX(NXM),QOMAX(NTM)
INTEGER OPCAD,AIMO(NXMtNZM),AIM1X(NXM,NZM)
C
COMMON /DADOS/PREF.qOMAX^QOMIN.PWFMIN.CTRjPHKNZM) ,RW,RE»ESP,TEMP,
«	DC,SWI,ZMED,ZTW,ZTE,KX(NXM,NZM),KZ(NXM,NZM)tDSAT,
#	TSAT,TPRES,DPRES,ITMAX,ITMIN,TMAX,DELTAT,DTMAX,
#	DTMIN,DTIMPR,DTIMPG,IXIMP,NX,NZ,DY,DTINI&gt;AIMO,
#	AIM1X,OPCAO,DX,TEPM,DTM,JICAN,JFCAN,PWFL,JREF
C
COMMON /SIS/AI(NZM*(NXM*(2*NZM+1)-NZM-1),4),FR(NXM*NZM,2),
#	DXJ(NXM*NZM , 2),KD(NXM*NZM,1)
C
DO 1 I = 1,NX
DO 1 J = 1,NZ IK=NZ*(I~1)+J IAI=KD(IK,1)
C
C— INVERSA DE ”A(IAI,-—)"
C
DET=AI(IAI,1)*AI(IAI,4)-AI(IAI,2)*AI(IAI,3)
A1=AI(IAI,1)
A2-AI(IAI,2)
A3»AI(IAI,3)
A4=AI(IAI,4)
C
E1=A4/DET
E2=-A2/DET
E3--A3/DET
E4=A1/DET
C
C— MULTIPLICANDO A LINHA "IAI" PELA INVERSA DE "AI(IAI),!
C
c
C— ”AI(IAI-NZ,—)"
C
IF(I.NE.l) THEN
D1«AI(IAI-NZ,1)
D2«AI(IAI-NZ,2)
D3=AI(IAI-NZ,3)
D4=AI(IAI~NZ,4)
C
AI(IAI-NZ,i)=El*Dl+E2*D3
AI(IAI-NZ,3)=E3*D1+E4*D3
IF(AIM1X(I,J).EQ.5.AND.AIM1X(I~1,J).EQ.5) THEN
AI(IAI-NZ,2)=E1*D2+E2*D4
Al(IAI-NZ,4)=E3*D2+E4*D4
END IF
ENDIF
C
C— "Al (IAI+NZ,—-)''
C
IF(I.NE.NX) THEN
D1«AI(IAI+NZ,1)
D2=AI(IAI+NZ,2)
D3=AI(IAI+NZ,3)
D4=AI(IAI+NZ,4)
C
Al(IAI+NZ,1)=E1*D1+E2*D3
AI(IAI+NZ,3)=E3*D1+E4*D3
IF(AIM1X(I,J).EQ.5.AND.AIM1X(I+1,J).EQ.5) THEN
Al(IAI+NZ,2)=E1*D2+E2*D4
AI(IAI+NZ,4)=E3*D2+E4*D4
ENDIF
ENDIF
C
C— ,!AI(IAI-1,---)”
C
IF(J.NE.l) THEN
D1»AI(IAI-1,1)
D2=AI(IAI-1,2)
D3«AI(IAI-1,3)
D4=AI(IAI-1,4)
C
AI(IAI-1,1)-E1*D1+E2*D3
AI(IAI-1,3)=E3*D1+E4*D3
IF(AIM1X(I,J).EQ.S.AND.AIMlXÍI.J-l).EQ.5) THEN
AI(IAI-1,2)=E1*D2+E2*D4
AI(IAI-1,4)=E3*D2+E4*D4
ENDIF
END IF
C
C— "Al(IAI+l,—)"
C
IF(J.NE.NZ) THEN
D1«AI(IAI+1,1)
D2=AI(IAI+1,2)
D3=AI(IAI+1,3)
D4»AI(IAI+1,4)
C
AI(IAI+1,1)=E1*D1+E2*D3
AI(IAI+1,3)«E3*D1+E4*D3
IF(AIMIXCI.J).EQ.5.AND.AIM1X(I,1+1).EQ.5) THEN
AI(IAI+1I2)=E1*D2+E2*D4
AKIAI+1 J4)=E3*D2+E4*D4
ENDIF
ENDIF
C
C— "AI(IAI,—)*'
C
AI(IAI,1)=1.ODO
AI(IAI,4)=1.ODO
C
C— *'FR(IAI,---)"
C
D1~FR(IK,1)
D2»FR(IK,2)
FR(IK,1)«E1*D1+E2*D2
FR(IK,2)=E3*D1+E4*D2
C
1	CONTINUE
C
RETURN
END
C
C------------------------------------------------------------------------
C SUBRDTINA PARA MONTAGEM DO VETOR DE ORDENACAO E SOLUCAO DO SISTEMA
C DE EQUAÇÕES (ESTA SUBBOTINA CHAMA NSPIV)
C
C
C VARIAVEIS PRINICIPAIS
C -------------------------
C
C R,C - VETOR qUE INDICA A ORDEM DE ELIMINACAO DAS EQUACOES DO
C	SISTEMA A SER RESOLVIDO
C
C
C------------------------------------------------------------------------
SUBROUTINE SOLVE (X,FIM)
C
PARAMETER (NTM=10,NXM=15,NZM=15,MAX-100000)
IMPLICIT DOUBLE PRECISION (A-H,O~Z)
REAL*8 KX,KZ,DTM(NTM),TEPM(NTM),DX(NXM),QOMAX(NTM)
INTEGER OPCAD,AIMO(NXM,NZM),AIM1X(NXM,NZM)
DIMENSION A(5*NXM*NZM*4),B(NXM*NZM*2),X(NXM*NZM*2),
#	RTEMP(2*NXM*NZM+MAX)
INTEGER IA(NXM*NZM*2+1),JA(5*NXM*NZM*4),
#	R(NXM*NZM*2)1C(NXM*NZM*2),ITEMP(4+NXM*NZM+MAX+2),
#	IC(NXM*NZM*2)
INTEGER IND(NXM,NZM)
C
COMMON /DADOS/PREF, QOMAX,QOMIN,PWFMIN,CTR, PHI (NZM) ,RW,RE,ESP,TEMP,
#	DG,SWI,ZMED,ZTW,ZTE,KX(NXM,NZM),KZ(NXM,NZM),DSAT,
#	TSAT,TPRES,DPRES,ITMAX,ITMIN,TMAX,DELTAT,DTMAX,
#	DTMIN,DTIMPR,DTIMPG,IXIMP,NX,NZ,DY,DTINI,AIMO,
#	AIM IX,DPCAO,DX,TEPM,DTM,JICAN,JFCAN,PWFL,JREF
C
COMMON /SIS/AI(NZM*(NXM*(2*NZM+1)-NZM-1),4),FR(NXM*NZM,2), #	DXJ(NXM*NZM,2),KD(NXM*NZM,1)
C
CALL P0INT2 (IA,JA,IND,FIM)
C
CALL INVERT
C
C— NUMERO DE EQUAÇÕES E INCÓGNITAS
C
N=2*NX*NZ
C
NPTO=IA(N+1)~IA(1)
DO 1 IZ = 1,NPTO
A(NPTO)=O.ODO
1 CONTINUE
C
KK=O
DD 2 I = Í,NX
DO 2 J = 1,NZ
IK=NZ*(I-1)+J
IAI»KD(IK,1)
KK=KK+1
KCL=IA(KK)
A(KCL)=AI(IAI,1)
M»1
IF(J.EQ.NZ) GO TO 100
LM=M
A(KCL+LM)=AI(IAI+1,1)
M«M+1
IF(AIM1X(I,J).EQ.1-OR.AIM1X(I,J+l).EQ.1) GO TO 100
A(KCL+LM+1)-AI(IAI+1,2)
M=M+1
100	IF(J.EQ.l) GO TO 101
LM-M
A(KCL+LM)=AI(IAI~1,1)
M=M+1
IF(AIM1X(I,J).EQ.l.OR.AIMlX(I.J-l).EQ.l) GO TO 101 A(KCL+LM+1MI(IAI-1,2)
M=M+1
101	IF(I.EQ.l) GO TO 102
LM=M
A(KCL+LM)«AI(IAI-NZ,1)
M=M+1
IF(AIM1X(I,J).EQ.1.OR.AIM1X(I-1,J).EQ.1) GO TO 102
A(KCL+LM+1)=AI(IAI-NZ,2)
M=M+1
102	IF(I.EQ.NX) GO TO 103
LM=M
A(KCL+LM)«AI(IAI+NZ,1)
M=M+1
IF(AlMlX(I,J).EQ.l.DR.AIMiX(I+l,J).EQ.l) GO TO 103 A(KCL+LM+1)«AI(IAI+NZ,2)
103	CONTINUE
B(KK)«FR(IK,1)
C
KK=KK+1
KCL«IA(KK)
A(KCL)«AI(IAI,4)
M=1
IF(J.EQ.NZ) GO TO 104
LM=M
A(KCL+LM)«AI(IAI+1,3)
M=M+1
IF(AIM1X(I,J).EQ.l.OR.AIM1X(I,J+l).EQ.l) GO TO 104 A(KCL+LM+i)=AI(IAI+l,4)
M=M+1
104	IF(J.EQ.l) GO TO 105
LM«M
A(KCL+LM)*AI(IAI-1,3)
M=M+1
IF(AIM1X(I,J).EQ.l.OR.AIMIXÍI,J-l).EQ.l) GO TO 105 A(KCL+LM+1)=AI(IAI-1,4)
M=M+1
105	IF(I.EQ.l) GO TO 106
LM=M
A(KCL+LM)«AI(IAI-NZ,3)
M=M+1
IF(AIM1X(I,J).EQ.l.OR.AIMIX(I-IJ).EQ.l) GO TO 106 A(KCL+LM+1)=AI(IAI-NZ,4)
M-M+l
106	IF(I.EQ.NX) GO TO 107
LM-M
A(KCL+LM)«AI(IAI+NZ,3)
M=M+1
IF(AIM1X(I,J).EQ.1.OR.AIM1X(I+1,J),EQ,1) GO TO 107
A(KCL+LM+1)=AI(IAI+NZ,4)
107	CONTINUE
B(KK)~FR(IK,2)
4
2	CONTINUE
KOR=Q
KK=O
DO 3 I » 1,NX
DO 3 J = 1,NZ
KK=KK+2
IF(AIM1X(I,J).EQ.l) THEN
KOR=KOR+1
R(KOR)=KK
C(KOR)=KK
ENDIF
3	CONTINUE
I
KK=O
D04I= 1,NX
DO 4 J = 1,NZ
KK=KK+1
IF(AIM1X(I,J).EQ.5) THEN
K0R=K0R+l
R(KOR)=KK
C(KOR)=KK
I
KOR=KOR+1
R(KOR&gt;KK+1
C(KOR)=KK+1
KK-KK+1
ELSE
KOR=KQR+1
R(KOR)=KK
C(KOR)~KK
KK=KK+1
ENDIF
4	CONTINUE
DO 5 I - 1,2*NX*NZ
KOR-C(I)
IC(KOR)~I
5	CONTINUE
CALL NSPIV(N,IA,JA,AR,C,IC,X,ITEMP,RTEMP,IERR)
IF(IERR.LE.O) THEN
WRITE(*,*)’IERR=’,IERR
STOP
END IF
RETURN
END</field>
	</doc>
</add>