<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.23287</field>
		<field name="filename">7390_RonaldoBrunoM.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">
UNIVERSIDADE DE SAO PAULO

INSTITUTO DE FisICA DE sAo CARLOS

Departamento de Fisica e Informatica

PESQUISA EM INSTRUMENTACAo ELETRONICA
MICROPROCESSADA PARA A MEDIDA DE

PARAMETROS FISICOS E QUIMICOS DA AGUA

USP / iFQSC j SB!

ill~II~1111111~lllllllllIllllli
6-2-'001f2.9

Disserta&lt;;ao apresentada ao
Instituto de Fisica de Sao Carlos,
da Universidade de Sao Paulo,
para obten&lt;;ao do titulo de Mestre
em Ciencias (Fisica Aplicada).

Sao Carlos
1997



Bruno, Ronaldo
Pesquisa em Instrumentayao Eletronica Microprocessada para a Medida de

Parametros Fisicos e Quimicos da AguaJRonaldo Bruno.-Sao Carlos, 1997.
145p.

1. Instrumentayao
I. Titulo



UNIVERSIDADE
DE sAo PAULO

:-'v. Dr. Carlos Botelho. 1465
CEP 13560-250 - Sao Canos - SP
Brasii

Fone (016) 272-6222
Fax (016) 272-2218

MEMBROS DA COMiSsAo JULGADORA DA DISSERTAc;:Ao DE MESTRADO DE
RONALDO BRUNO APRESENT ADA AO INSTITUTO DE FISICA DE SAG CARLOS, DA
UNIVERSIDADE DE SAG PAULO, EM 28 DE FEVEREIRO DE 1997.



• Ao Prof. Valentin Obac Roda, meu orientador. pelo carMer,
serenidade, apoio e total disponibilidade.

• Aos amigos Maximilian Luppe, Raul Junji Nakashima e Jose Pott, os
quais contribuiram para urn otimo ambiente de trabalho.

• Ao pessoal do Laboratorio de Instrumentayao: Lirio, Bene, Marcos,
Ailton e Ivanilda.

• A Wladerez da seyao de alunos sempre simpatica e atenciosa.

• Ao pessoal do Laboratorio de Hidniulica e Saneamento, Julio Cesar
Trofino e Paulo Fragiacomo pelo inestimavel auxilio no
desenvolvimento do medidor de turbidez.

• Ao Newton da Industria FAC LTDA, pela enorme gentileza em
fomecer 0 sensor de oxigenio dissolvido.

• Ao Mateus (Ressonancia Mag.) pelo auxilio na linguagem Visual
Basic.





Lista de Figuras iv
Lista de Ta belas vi
Res umo vii
Abstract viii
1. Introdu~ao 1
2. Instrumentos 5

2.1. Condutivimetro 5
2.1.1 Introduyao 5
2.1.2 Definiyao e unidades 5
2.1.3 Natureza da Condutividade 6
2.1.4 Considerayoes pniticas 8
2.1.5 Preparo de Soluyao Padrao 9
2.1.6 Medidor de Condutividade 10

2.2. Medidor de pH 14
2.2.1 Introduyao 14
2.2.2 Definiyao 14
2.2.3 0 Sensor 15
2.2.4 Circuito de entrada 17
2.2.5 Medidor de pH 19

2.3. Medidor de Turbidez 22
2.3.1 Introduyao 22
2.3.2 Principio da Medida 23
2.3.3 Aspectos Construtivos 24
2.3.4 Circuito do Turbidimetro 26
2.3.5 Preparo da Soluyao Padrao 27

2.3.5.1 Roteiro para preparayao das soluyoes 28
2.3.6 Calibrayao e Desempenho do Turbidimetro 28

2.4. Termometro 31
2.5. Medidor de Oxigenio 32

2.5.1 Introduyao 32
2.5.2 Principio de Medida 33
2.5.3 Caracteristicas dos Sensores de Oxigenio Dissolvido 35

2.5.3.1 Eletrodo Principal (Catodo) 35
2.5 .3.2 Membrana 36
2.5 .3.3 Temperatura 37
2.5.3.4 Pressao 37

2.5.4 Unidades 37
2.5.5 Preparo das Soluyoes Padrao e Eletr6lito do Sensor. 38

2.5.5.1 Soluyao Padrao 38
2.5.5.2 Eletr6lito 39

2.5.6 Circuito do Medidor de Oxigenio Dissolvido 39
2.5.7 Calibrayao 40

2.6. Medidor de Profundidade 41



2.6.1 Introdu&lt;;ao .f 1
2.6.2 Princi pia de Medida 42
2.6.3 Sistema Medidor 42

3. Circuito PrincipaL 47
3.1. Introduc;ao 47
3.2. Microcontrolador PIC16C84 48

3.2.1 Programa&lt;;ao das Portas 50
3.3. Interface RS232 51
3.4. Conversor AID 53
3.5. Multiplexac;ao da Entrada AnaI6gica 54
3.6. Escalas Automaticas 56
3.7. Interrupc;ao - Medidor de Profundidade 57
3.8. Fontes de Alimentac;ao 58

4. Programa«;ao 60
4.1. Introduc;ao 60
4.2. Programa em Linguagem Montadora do PIC16C84 61

4.2.1 Watch Dog Timer. 68
4.2.2 Interrupyao 69
4.2.3 Rotinas de imp1ementa&lt;;ao da RS232 69

4.2.3.1 Rotina de transmissao 70
4.2.3.2 Rotina de recep&lt;;ao 70

4.3. Programa de Visualizac;ao dos Dissolvido Dados 71
4.3.1 Introduyao 71
4.3.2 Visao Gera1 do Programa Desenvo1vido 72
4.3.3 Jane1a Principal (MAIN) 74

4.3.3.1 Menu 74
4.3.3.2 Botao Power 77
4.3.3.3 Botao Save 77
4.3.3.4 Botao Reset 77
4.3.3.5 Rotina Principal (Main Routine) 78
4.3.3.6 Rotina de Inicializa&lt;;ao (Form) 79
4.3.3.7 VEX da Porta Serial.. 80
4.3.3.8 Timer da Aquisiyao de Dados 80
4.3.3.9 Timer do WatchDog Timer 81

4.3.4 Janela para Manipulayao de Arquivos (FILES) 82
4.3.4.1 Comando "Ok" 83
4.3.4.2 Sub-rotinas Auxiliares 84

4.3.4.2.1 Sub-rotina N_ADF (New Acquisition Data File) 84
4.3.4.2.2 Sub-rotina 0_ADF (Open Acquisition Data File) 84
4.3.4.2.3 Sub-rotina O_CF (Open Calibration File) 84
4.3.4.2.4 Sub-rotina S_CF (Save Calibration File) 85

4.3.5 Janela para Visualizayao de Arquivos de Dados (DATA VIEW) 85
4.3.6 Janela de Ca1ibrayao do Medidor de pH (PHCAL) 86

4.3 .6. 1 B 0tao .,Start" 87
4.3.6.2 Botao "Cancel" 88
4.3.6.3 Timers 1 e 2 (buffers 1 e 2) 88

4.3.7 Janela de Ca1ibrayao do Medidor de Oxigenio Dissolvido (02CAL) 89



4.3.8 Janela de Apresentac;ao do Programa (STARTUP) 89
5. Transmissao dos Dados via Radiofreqiiencia 92

5.1 Introdu~ao 92
5.2 Sistema de Transmissao 92
5.3 Transmissor 93
5.4 Receptor 94
5.5 Desempenho do Sistema 97

6. Conclusao 99
6.1 Introdu~ao 99
6.2 Otimiza~ao do Projeto 100

6.2.1 Medidor de Profundidade ,. 100
6.2.2 Fonte de alimentac;ao 101

6.3 Trabalhos Futuros 101
6.3.1 Sistema com Data Logger , 101
6.3.2 Sistema automatico de medidas 102
6.3.3 Sistema Telemetrico via Radiofrequencia 102
6.3.4 Sistema Telemetrico via Internet 102

Bibliografia 103
Apendices 106

Apendice A - Esquemas dos Circuitos 106
Apendice B - Programac;ao em Linguagem Montadora do PIC16C84 115
Apendice C - Descric;ao das Variaveis do Programa em Visual Basic 123
Apendice D - Programa em Visual Basic 126



Lista de Figuras
Figura 1 - Ilustrayao do principio de uma celula de dois eletrodos 6

Figura 2 - Circuito equivalente de uma celula de dois eletrodos 8

Figura 3 - Dependencia, com relayao ao material dos eletrodos. da faixa de

condutividade utilizavel de uma celula de dois eletrodos 10

Figura 4 - Dependencia, com relayao a freqtiencia, da faixa de condutividade
utilizavel de uma celula de dois eletrodos de ayo inox 11

Figura 5 - Celula de dois eletrodos 12

Figura 6 - Diagrama em blocos do condutivimetro 12

Figura 7 - Principio de medida da condutividade 13

Figura 8 - Sensor de pH integrado 17

Figura 9 - Resposta tipica de urn sensor integrado 18

Figura 10 - Circuito de entrada para 0 sensor de pH integrado 18

Figura 11 - Sinal do sensor de pH modificado pelo circuito de entrada 19

Figura 12 - Esquema basico de urn turbidimetro 25

Figura 13 - Fonte de tensao regulada para a hlmpada do turbidimetro 26

Figura 14 - Circuito de amplificayao e adaptayao do sinal do foto-sensor 27

Figura 15 - Linearizayao da escala de alta sensibilidade do turbidimetro 29

Figura 16 - Linearizayao da escala de baixa sensibilidade do turbidimetro 30

Figura 17 - Circuito de ligayao do LM 35D 32

Figura 18 - Polarograma do sensor de oxigenio dissolvido 34

Figura 19 - Desenho do sensor de oxigenio dissolvido 35

Figura 20 - Sensor de oxigenio com compensayao de pressao 36

Figura 21 - Circuito do medidor de oxigenio dissolvido 40

Figura 22 - Sistema proposto para a medida de profundidade 42

Figura 23 - Sistema do medidor de profundidade 44

Figura 24 - Sinais gerados quando 0 encoder gira no sentido anti-horario 45

Figura 25 - Sinais gerados quando 0 encoder gira no sentido horario 45

Figura 26 - Circuito que gera os sinais de pulso e sentido 45

Figura 27 - Formas de onda dos sinais do foto-transistor. 46

Figura 28 - Diagrama em blocos do circuito da sonda 49



Figura 29 - Esquema de transmissao de dados no padrao RS232 53

Figura 30 - Palavra de 16 bits gerada pelo conversor AID 54

Figura 31 - Protocolo de comunicayao do MAX187 54

Figura 32 - Esquema da multiplexayao do canal ana16gico do MAX187 56

Figura 33 - Diagrama em blocos do circuito da [onte 59

Figura 34 - Fluxograma do programa em assembler do PICI6C84 64

Figura 35 - Fluxograma da rotina que escolhe a escala do condutivimetro 66

Figura 36 - Fluxograma da rotina que escolhe a escala do turbidimetro 67

Figura 37 - Temporizayao da leitura de urn byte recebido pela porta serial. 71

Figura 38 - Janela principal do analisador de agua 75

Figura 39 - Exemplo das janelas da barra de menu 75

Figura 40 - Janela para manipulayao de arquivos 83

Figura 41 - Janela para visualizayao dos dados enviados pela sonda 86

Figura 42 - Janela de calibrayao do medidor de pH 87

Figura 43 - Janela de calibrayao do medidor de oxigenio dissolvido 90

Figura 44 - Tela de Apresentayao do Analisador Virtual de Agua 91

Figura 45 - Transmissor de dados em 3.57MHz 94

Figura 46 - Sinal digital da porta serial e portadora modulada em amplitude 95

Figura 47 - Receptor de dados e audio em 3.57 MHz 96



Tabela 1 - Mobilidade dos ions (cations e anions) em funyao da temperatura 7

Tabela 2 - Condutividade em funyao da concentrayao da soluyao 10

Tabela 3 - Dados do turbidimetro construido. Escala de alta sensibilidade 29

Tabela 4 - Dados do turbidimetro construido. Escala de baixa sensibilidade 30

Tabela 5 - Valores medidos com 0 turbidimetro montado em comparayao com os

padr5es preparados 31

Tabela 6 - Solubilidade do oxigenio em funyao da temperatura 38

Tabela 7 - Seleyao das entradas ana16gicas 51

Tabela 8 - Seleyao das escalas do condutivimetro em funyao dos bits RB 1 e RB5 51

Tabela 9 - Niveis 16gicos das saidas dos transistores comandados pelo CD4028B. .. 55

Tabela 10 - Palavra de 12 bits gerada pelo conversor AID 63

Tabela 11 - Func;:5esda barra de menu 76



o presente trabalho prop5e a construyao de urn instrumento microprocessado
multissensor para a medida de parametros tlsicos e quimicos da agua. As variaveis
medidas sac: temperatura, turbidez, pH, oxigenio dissolvido, condutividade e
profundidade. 0 sistema e composto por uma sonda multissensora e urn micro
padrao IBM/PC que permite a visualizayao e armazenagem dos dados. No circuito da
sonda sac utilizados componentes recentes como 0 microcontrolador PIC16C84 e 0
conversor AID serial de 12 bits MAX187. 0 programa para 0 PC foi desenvolvido na
linguagem Visual Basic 3.0 em ambiente Windows. A comunicayao entre a sonda e 0
PC e feita atraves da porta serial RS232.



The present work proposes the development of a multi sensor microprocessor-
based instrument for the measurement of physical and chemical water parameters.
The water parameters that can be measured are: temperature, pH, dissolved oxygen,
conductivity and depth. The system includes the multisensor instrument and an
IBM/PC microcomputer that allows data recording and viewing. The instrument
circuit is based on recent components such as the microcontroller PIC16C84 and the
12-bit AID converter MAXI8? The PC software was developed in Visual Basic 3.0
for Windows. The multi sensor communicates with the PC by RS 232 serial cable.



1. Introdu~ao

Com 0 crescimento da populayao e 0 consequente aumento das atividades

industriais. a estudo das caracteristicas fisicas e quimicas da agua tern se tornado

cada vez mais importante. Tal estudo tern aplicac;oes em divers as areas, como: no

controle da qualidade das aguas de abastecimento, na caracterizac;ao dos efluentes

liquidos de aguas residuarias industriais au domesticas e na caracterizac;ao de

diferentes corpos de aguas naturais, como rios, lagos, POyOSetc.

A completa caracterizayao de urn corpo de agual32J envolve a medida de

muitos parametros. No entanto, usualmente, a avaliac;ao da qualidade da agua da-se

em func;ao da utilizac;ao da me sma. Assim, selecionam-se apenas as parametros

relevantes a fim de otimizar tanto 0 equipamento como 0 processo de medida. as

parametros mais comuns no estudo de aguas sao a temperatura, a pH. a

condutividade. a concentrac;ao de gases dissolvidos, a turbidez. a car, a penetrac;ao de

luz. entre outras.

Ate pouco tempo atras, e ainda hoje em paises pouco desenvolvidos. essas

medidas eram feitas individualmente, par diferentes instrumentos. atraves da coleta

de amostras. Isso limita 0 numero de medidas. dificulta 0 controle continuo e impede



a automayao do processo de avaliayao da qualidade da agua. Alem disso. certas

propriedades sao interdependentes, variando simultaneamente.

Recentemente, equipamentos de medida com sensores multiplos. que

penn item quantificar simultaneamente algumas variaveis, tern sido desenvolvidos em

diferentes paises e tern contribuido significativamente para a melhoria do processo de

mediyao, bem como oferecendo uma abordagem mais eficiente na soluyao de

diferentes problemas. Como exemplo, as alterayoes de algumas caracteristicas da

agua de urn rio ocasionadas por descargas de poluentes podem ser analisadas com

precisao atraves da utilizayao de sensores multiplos instalados em pontos

eqiiidistantes a partir de uma fonte pontual. Um rio e um fluxo de agua onde a

velocidade das mudanyas e urn problema quando se realizam medidas discretas. Um

outro exemplo e urn lago, 0 qual e urn estoque de agua, que leva mais tempo para ser

limpo ou depurado criando gradientes ou estratos com caracteristicas distintas

levando a uma compartimentalizayao do sistema. 0 esforyo amostraL portanto. e

muito mais intenso para uma caracterizayao dos diferentes compartimentos. Muitos

estudos nesses sistemas ficam prejudicados pela ausencia de uma tccnologia

adequada para as mediyoes das variaveis hidrol6gicas.

Com a utilizayao de microprocessadores e possivel 0 desenvolvimento de

equipamentos bastante versateis e especificos que, alem de coletar dados de maneira

eficiente. permitem urn pre-processamento e armazenamento dos mesmos. Urn

instrumento microprocessado permite, ainda. a transmissao digital do valor da

variavel medida de urn ponto ao outro. Isso evita interferencias causadas por campos

magnericos. campos eletricos e umidade nos cabos, pois 0 sinal digital e muito mais

imune a essas interfcrencias que os debeis sinais anal6gicos gcrados Delos sensorc:o.



No presente trabalho de rnestrado foi desenvolvido urn instrurnento

rnicroprocessado para a rnediyao de parametros fisicos e quirnicos da agua, rnais

especificarnente temperatura, pH, turbidez, condutividade especifica e concentrayao

de oxigenio dissolvido. Esse instrumento consiste em uma sonda multissensora

sustentada por urn cabo de ayo, a qual faz a aquisiyao dos dados e os envia

digitalmente no padrao RS232 a urn microcomputador do tipo lap-top, situado em

uma embarcayao, contendo urn programa de visualizayao e armazenamento de dados.

No circuito eletr6nico da sonda foram utilizados componentes de ultima

gerayao. notadamente 0 rnicrocontrolador PIC16C84 e 0 conversor AID MAXI87. 0

PIC 16C84 pertence a uma familia de microcontroladores RISC, fabricada pela

Arizona Microchip. Os componentes dessa familia saG bastante compactos. cada urn

apresentando urn grupo diferente de recursos. Assim, de acordo com a aplicac;ao,

escolhe-se 0 componente mais adequado. 0 PIC16C84 e dotado de EEPROM

intema, 0 que facilita muito a fase de depurayao do programa. Alem disso, devido ao

fato do microcontrolador possuir poucas instruyoes, 0 aprendizado da linguagem

montadora e muito rapido. 0 MAX187 e urn conversor AID de 12 bits com saida

serial alojado num encapsulamento de apenas 8 pinos. 0 pequeno tamanho do CI

aliado aos circuitos embutidos. tais como uma referencia de tensao e circuito de

sample-hold. sirnplifica a placa de circuito impressa, com 0 conseqtiente aumento da

confiabilidade. Na parte analogica do circuito vale ressaltar a ausencia de resistores

variaveis, que sempre sofrem variayao de valor devido ao envelhecimento.

o sistema como urn todo, baseia-se na tecnica de instrumentac;ao virtual. a

qual utiliza a tela de urn microcomputador para visualizar e controlar graficamente

instrumentos remotos. Para a implementayao desse sistema. construiu-se urn



programa na linguagem Visual Basic. Esta linguagem segue a filosofia atual de

programayao: a programayao utilizando objetos visuais. A abordagem visual permite

a construyao de interfaces graficas de alta qualidade com urn minimo de esforyo na

programayao.

A apresentayao deste trabalho esta dividida em quatro partes principais: 0

capitulo 2 trata do projeto dos instrumentos, 0 capitulo 3 trata do circuito geral da

sonda, no capitulo 4 encontram-se os assuntos relacionados aos programas tanto em

linguagem montadora como em Visual Basic e nos apendices estao os esquemilticos

de todos os circuitos bem como a listagem completa dos programas desenvolvidos.

No capitulo 2 incluiu-se 0 projeto de urn medidor de profundidade, essencial no

levantamento dos panlmetros da agua de urn lago. No capitulo 5 e apresentada uma

altemativa para a transmissao dos dados via cabos: a transmissao via radiofreqih~ncia.



2.1. Condutivimetro

2.1.1 Introdu~ao

Diferentemente da malOna dos metodos de amilise quimica que utilizam

medidas eletricas, a condutividade[IJ e uma medida nao-seletival]J. Ou seja, todos os

ions presentes numa soluc;ao sao detectados. A contribuic;ao de cada ion no valor

total da medida depende da sua mobilidade, carga e concentrac;ao[11. Os sensores

utilizados sao passivos necessitando de uma fonte extema para a gerac;ao de urn sinal

o qual alimenta urn amplificador.

Apesar da nao-seletividade a condutividade tern grande importlncia e e. com

excec;ao da medida de pH, a tecnica eletroquimica mais utilizada no monitoramento

de aguas.

A condutividade K e definida como sendo a condutfmcia G de uma celula de

dois eletrodos pIanos com area de 1cm] distanciados de Iem. Tal tipo de celula po de

ser caracterizado pela sua constante[1] k = d/A de aeordo com a figura 1. Apesar

dessa expressao. 0 valor de k e, na prcitica. calculado com base em soluc;6es com

condutividade eonhecida. Isto e feito pois. como po de ser visto na figura 1. ocorre



Figura 1 - Ilustrac,:ao do principio de uma celula de do is eletrodos. As linhas de campo eletrico nao
terminam na borda dos eletrodos. Logo, a constante k = dJA da celula nao pode ser calculada apenas
com base nas dimensoes geomMricas



Tabela 1[1] - Mobilidade dos ions (cations e anions) em fun&lt;;ao da temperatura em solu&lt;;ao aquosa.
Os valores constantes na tabela foram extrapolados para concentra&lt;;ao zero. Os ions Ht e OH- seguem
urn mecanismo diferente de transporte, baseado em pontes de hidrogenio entre os ions e os dipolos da
agua.

ions oDe 18De 25De 100De
H 225 315 350 637
Li' 19 "" 39 120.J.J
Na- 26 43 50 150
K- 40 64 74 200
Ag " ...• 53 62 180.J.J

1/2Ca2- 31 50 60 187
1/3La)' r 60 70 220~)

OR 105 174 200 446
Cl' 41 66 76 207
r 42 67 77

NO.1' 40 63 71 189
MnOj' 36 53 6"_1
112SO/ 41 69 80 256

Mobilidade }"em n-1.em2



r--------l
I C, l
I f?2 I

Figura 2 - Circuito cquivalente de uma celula de dois eJetrodos. A resistencia de interesse esta
representada por R,. 0 retiingulo pontilhado engloba os componentes que representam as interavoes
dos eletrodos com a soluvao. Os componentes que estao fora do retangulo sao devidos as conexoes
extemas (cabos etc.).



caso C2 Alem disso uma pequena corrente de fuga pode surgir por efeito semelhante

ao que ocorre numa pilha eletroquimica. Neste caso essa corrente indesejavel indica

uma alterayao no valor medido de Rx e no circuito equivalente e representada por R2•

Vale ainda observar que esses efeitos aumentam com 0 valor da condutividade. Logo

eles acabam impondo urn limite superior na faixa de medidas.

Para minimizar os efeitos de polarizayao dois procedimentos basicos sao

tornados: uso de tensao altern ada de freqiiencia adequada e uso de materiais

convenientes na fabricayao dos eletrodos.

Na figura 3 e mostrada a influencia do material usado nos eletrodos no valor

da constante da celula, no caso k = 1.00 cm'l. Note que com 0 aumento da

condutividade a partir de urn determinado valor ocorre urn aumento aparente da

constante k.

Na figura 4 tem-se 0 incremento da constante k inicialmente igual a 1.00 cm,j

com relayao a freqiiencia e ao valor da condutividade.

2.1.5 Preparo de SolU(;ao Padrao

Na definiyao de condutividade fez-se referencia a constante da celula, que

compoe 0 sensor, a qual deve ser obtida experimentalmente atraves de soluyoes com

condutividade conhecida. Urn metodo simples de obtenyao de soluyoes padronizadas

e 0 seguinte: dissolvem-se 74.55lg de KCL seco em 1 litro de agua pura. Essa

soluyao possui concentrayao de 1 mol/L. As concentrayoes de 0.1 e 0.01 mol/L sao

obtidas por diluiyao simples da soluyao de 1 mol/L. As condutividades dessas

soluyoes nas varias temperaturas podem ser vistas na tabela 2.



Temperatura Concentra~ao (Mol/I)
(0C)

0.1 0.05* 0.01 0.005* 0.001 * 0.0005*

15 92.54m IO.48m 5.50m 1.147m 576.311 115.711 58.011
20 102.09m 11.67m 6.13m 1.278m 642.211 129.011 64.611
25 111.80m 12.88m 6.77m 1.4l3m 710.011 142.611 71.411

130
k I
120

100
I I

!

I
1J 20 50 100 200 500 2 5 10 20 50 100 200 500 1000
--(.uS/cm)---+--------(, mS/cm)----

Figura 3[11 - Dependencia, com rela&lt;;ao ao material dos eletrodos. da faixa de condutividade
utilizavel de uma celula de dois eletrodos. A celula, nesse caso. s6 deve ser utilizada na faixa onde
k=I.OOcm,l. (a) a&lt;;o inox; (b) carbono sinterizado; (c) a&lt;;o in ox coberto com uma camada de carbeto
de titiinio; (d) Platina



130

k

120

10 20 50 100 200 500
()-IS I em)

5 10 20 50 100 200 500 1000
---~----(mS/em)

Figura 411] - Dependencia, com relavao it freqiiencia, da faixa de condutividade utilizavcl de uma
celula de dois eletrodos de avo inox. A faixa utilizavel deve ser onde k= 1.OOcm i.

atendendo as especifica&lt;;5es iniciais. Ha diversas geometrias e materiais111 disponiveis



Oscilador
1KHz

Retificador onda
completa

Filtro Passa- Saida
baixa



\ Oscilodor

Figura 7 - Em ambos esquemas tem-se urn amplificador inversor com tres possibilidades de ganho
(tres escalas). 0 ganho e dado pelo quociente do resistor de realimentac;ao pelo resistor de entrada. Se
a amplitude do oscilador e fixa, entao a saida do amplificador e inversamente proporcional ao resistor
de entrada. No caso, a saida e diretamente proporcional it condutividade, pois maior a condutividade
menor a resistencia equivalente da soluc;ao.





o coeficiente de atividade sao a temperatura, a forc;a i6nica, a constante dieletrica, a

carga do ion, 0 tamanho dos ions e a densidade do solvente.

A escala usual para a medida de pH e baseada na constante de dissociac;ao da

agua, Kw = af{+ . aOl/ Em agua pura as concentrac;oes desses ions sao iguais a 10-7 M

a 25°C. Sendo Kw constante, fixada a temperatura, sao, entao, estabelecidos os

limites de 0 a 14 para a medida de pH.

Em soluc;oes fortemente acidas ou alcalinas valores fora dessa faixa podem

ser encontrados. Todavia, em geral, nao ha interesse prMico na medida de pH dessas

soluc;oes.

o sensor[8] para medida de pH funciona atraves da diferenc;a de potencial

gerada por uma celula galvanica[8] (eletrodo + eletrodo de referencia). Esses eletrodos

apresentam, em geral, resistencias internas de ate IGO (l00) e sao muito suscetiveis

a polarizac;ao. Logo, 0 circuito de entrada[9] que capta 0 sinal gerado pelo eletrodo

deve apresentar alta impedancia (&gt;10120) e baixa corrente de off-set «10-12 A).

o potencial produzido pelo eletrodo segue a seguinte expressao:

E = Eo + 2.303 (RT/F) log faf{+J,

conhecida como equac;ao de Nernstl6J, onde:

E = potencial do eletrodo em V/pH

Eo = potencial assimetrico, 0 qual varia com 0 passar do tempo (idade)

R = constante gasosa (8.3144 J KI mol-I)

T = temperatura em Kelvin

aT/= atividade dos ions hidrogenio



Para 0 sensor integrado[5J (eletrodo e eletrodo de referencia), temos,

simplificadamente:

v = tensao produzida nos terminais do sensor

Vo = tensao de off-set variavel com 0 passar do tempo.

T = temperatura em DC

pH = valor do pH da amostra

A tensao Vo teoricamente deveria ser nula. Na pr&lt;itica a mesma apresenta urn

pequeno valor (positivo ou negativo) que varia de acordo com 0 sensor e com 0

passar do tempo (idade do sensor).

Na figura 8 e mostrado urn sensor integrado tipico e na figura 9, a resposta

desse tipo de sensor.

Devido a resposta do sensor vanar com 0 passar do tempo e com a

temperatura, e semprc necessaria uma rotina de calibrayaol'J] antes de serem

realizadas medidas nas quais deseja-se grande precisao. A calibrayao e feita tomando

como referencia soluyoes com valores conhecidos de pH. Podem-se usar uma OU

mais soluyoes padronizadas, normal mente duas ja fornecem boa precisao. No caso de

calibrayao por uma unica soluyao consegue-se apenas 0 "zeramento" do off-set. Ja

com duas soluyoes alem do off-set, ajusta-se, tambem, 0 ganho do sensor. Ainda.

para medidas nas quais deseja-se extrema acuracidade e usual escolher as soluyoes

conhecidas com valores pr6ximos aos que serao lidos.



--10

9

----6
5
4

-3
-2
1

Figura 8 - Sensor de pH integrado. 1, Membrana de vidro; 2, Eletr6lito intemo de referencia; 3, tela
de metal; 4, Sistema de referencia intemo; 5, Conexao intema: 6, Cabe&lt;;a do eletrodo; 7, Conexao
intema; 8. Abertura para recarregamento do eletr6lito; 9, Cabe&lt;;a do eletrodo; 10, Cabo de conexao.



••V(mV)
600 .

500
400

.~
- ~-

678
~

pH100
200 .

300
400
500
600

Figura 9 - Resposta tearica de urn sensor integrado - Eletrodo i eletfodo de refer':ncia. A QGCI
curva apresenta inclinay30 de 54.20mv/oC: a 25°e, 59. 16m V /loC e a lOO°e, 74.04m V /0e.

*-.L----&lt;&gt; G N D AI3

Figura 10 - Circuito de entrada para 0 sensor de pH integrado. 0 primeiro operacional cria a
entrada de alta impedancia. 0 segundo inverte 0 sinal e soma uma componente de tensao continua
fixa. Assim 0 sinal de saida do circuito torna-se unipolar e diretarnente proporcional ao pH.



----~

12 13 14 pH

Figura 11 - Sinal do sensor modificado pelo circuito de entrada. A modificayao aumenta 0 ganho.
toma a correspondencia pH-tensao diretamente proporcional e faz com que 0 sinal seja apenas
positivo (unipolar).



m(T) = -(54.20 + 0.198T) . G(_)

pH=V-V(7)+7.
meT)



T"-V(7)
pH == + 7

meT)

VI-l"c
M==---

pHI- pHc



Ctemp = L1T. G(_). (-0.198),

v - V(7)
pH= . +7.

m(T)



2.3.2 Principio da Medida

A unidade de medida da turbidez e 0 NTU - Nephelometric Turbidity

Units[!O]. 0 metodo escolhido para a medida de turbidez baseia-se na reflexao de luz

pelas particulas em suspensao. A amostra e iluminada convenientemente, como

mostrado mais adiante. e faz-se a detecyao da luz refletida. Existem outros metodos

para esse tipo de medida. Dentre eles 0 que se baseia na intensidade de luz

transmitida.

A atribuiy30 de val ores de NTU e feita atraves da comparayao da intensidade

de luz refletida pel a amostra, sob condiyoes detinidas, com a intensidade de luz

refletida por uma suspens30 padr30 de referencia[JoJ. Quanto maior a quantidade de

luz refletida maior a turbidez.

Alguns fatores[lO]afetam sensivelmente a medida da turbidez:

- particulas flutuantes, podem obstruir a passagem da luz indicando valores

mais baixos de turbidez;

- particulas pesadas, as quais sedimentam rapidamente:

- bolhas de ar. refletem significativamente a luz; logo ocorre uma indicay30

de turbidez maior que a real;

- a presenya de cOlOray30 na soluyao absorve a luz proveniente da fonte

luminosa fazendo 0 turbidimetro indicar baixos valores:

-valores de turbidez maiores que 40 NTU; em medidas nas quais deseja-se

alta acuracidade a amostra deve ser diluida e ser medida novamente. 0 valor da

turbidez da soluy3o original e, entao, calculado com base na proporyao da diluiy30

feita. Esse procedimento so e possivel em amostras analisadas em laboratorio.



Instrumentos de campo de mediyao continua medem diretamente incorrendo em uma

margem de erro maior.

Existem diversas maneiras de construir urn turbidimetro. Urn exemplo esta

mostrado na figura 12. Esse modelo foi usado na construc;ao do turbidimetro do

presente trabalho.

Algumas considerayoes[JOJ devem ser feitas acerca da construyao do

turbidimetro :

- Entre a lfunpada e a entrada do tubo deve haver uma lente para concentrar a

luz proximo ao ponto de detecyao, aumentando a eficiencia e diminuindo 0

espalhamento;

- A distancia, ao longo do tubo, da fonte de luz (lampada) e 0 ponto de

detecyao nao deve ser superior a 1Ocm:

- 0 angulo entre 0 caminho da luz incidente e 0 detector deve ser de 90°;

- 0 detector deve aceitar luz incidente com urn angulo solido de no maximo

- 0 tubo que contem a amostra deve ser construido internamente em vidro

incolor e mantido absolutamentc limpo. Externamente. esse tuba deve ser recoberta

com material (tinta, plastico etc.) preta, a que evita reflexoes internas e interferencia

da luz externa:



r Sensor optico(fototransistor)

~--...
I .me )

~ Tubodevidropreto





o = Baixo sensibilidode
1 ::: Alto sensibilidode

Figura 14 - Circuito de amplifical;:3o e adaptal;:3o do sinal proveniente do foto-sensor do
turbidimetro



Duas soluyoes iniciais devem ser preparadas:

Solucao 1: Dissolver 1.00g de sulfato de hidrazina em agua e diluir ate 100ml

num balao volumetrico.

Solucao 2: Dissolver 10.00g de hexametilenotetramina em agua c diluir ate

100ml num balao volumetrico.

Num terceiro balao volumetrico de 100ml misturar 5ml da soluyao 1 com 5ml

da soluy3.o 2. Diluir ate a marca e agitar. Mantenha a mistura numa

temperatura de 25 ± 3°e e aguarde 24 horas. A soluyao resultante apresenta 0

valor de 400 NTU. Diluindo-se convenientemente essa soluyao chega-se aos

valores desejados de turbidez.

A soluyao de 400 NTU deve ser usada dentro de um meso As soluyoes

derivadas devem ser usadas dentro de uma semana. A nao observfmcia desses

prazos ocasiona erros na leitura da turbidez, pois pode ocorrer aglutinayao das

particulas em suspensao.

Apos a construyao do turbidimetro fez-se um levantamento da sua resposta

em tensao em funy3.o da turbidez das amostras, tanto na escala de baixa sensibilidade

como na de alta. Nas figuras 15 e 16 encontram-se as curvas levantadas e nas tabelas



Turbidimetro (alta sensibilidade)
y = -8E-05x3 + 0,0108x2 + 0,2292x + 0,65

:J 40,00
I-
Z

~ 30,00
"0:e
::l
I-

• Turbidez
__ Polinomio

0,00
0,00

Figura 15 - Linearizayao da escala de alta sensibilidade do turbidimetro, 0 polin6mio de 3° grau
foi calculado atraves dos dados contidos na tabela 3,

Turbidez Tensao(%) 1 Tensao(%) 2 Tensao(%) 3 Media
0,00 0,81 0.46 0.83 0.70
4.00 7.50 7.00 7.00 7.17

20.00 39.50 38.00 37.00 38.17
40.00 64.50 65.80 66.80 65.70
50.00 89.50 91.00 90.00 90.17



Turbidimetro (baixa sensibilidade)
y = -2E-05x4 + 0,0084x3 - 0,2841x2 + 8,8719x + 0,0636

400,00

350,00

300,00

S 250,00I-
~
N 200,00
0&gt;
"0:e 150,00
:l
I-

100,00

50,00

0,00
0,00

• Turbidez
__ Pollnomio

Figura 16 - Lineariza&lt;;:ao da escala de baixa sensibilidade do turbidimetro. 0 polinomio de 4° grau
foi calculado atraves dos dados contidos na tabela 4.

Turbidez Tensao(%11 Tensao(%) 2 Tensao(%) 3 Media
0.00 0.00 0.00 0.00 0.00

50.00 6.76 6.76 6.76 6.76
80.00 12.80 11.56 12.33 12.23

100.00 15.70 15.70 15.14 15.51
200.00 29.00 28.60 27.60 28.40
400.00 38.00 43.50 41.70 41.07



Tabela 5 - Valores medidos com 0 turbidimetro montado em compara~ao COIll os padroes
preparados.

._' ...
Padrao Medida 1 Medida 1 Medida 3 Media Erro
(NTU) Turbidimetro limpo (%)
0 0.5* 0.8* 0.8* 0.7*
4 3.1 * 3.0* 3.0* 3.0* 24.2
20 20.6 20.6 19.3 20.2 0.8
40 41.5 41.7 39.2 40.8 2.0
50 51.6 51.5 50.9 51.3 2.7
50 ** 54 54 52 53.3 6.7
80 82 82 73 79.0 1.3
100 100 102 90 97.3 2.7
200 202 209 173 194.7

"1 ...,
.... I

400 430 448 427 435.0 8.8

* Esses valores san dependentes do ojf~setldrift do amplificador usado no circuito. No momenta da
medida nao estavam disponiveis operacionais com baixo off-set/drift
** Escala de baixa sensibilidade.



Vcc 2K2

I_L_M_3 5_D_I~aid:\/\/\;~-
gnd

+7.5V
II

----~ entrada
(AID)

-- gnd



No presente trabalho, utilizou-se urn sensor comercial no projeto da sonda.

Logo, a abordagem limitou-se a urn breve estudo dos aspectos construtivos a fim de

obter informac;oes acerca do comportamento eletrico e, assim, projetar urn circuito

de condicionamento de sinal, bem como rotinas de calibrac;ao, para esse tipo de

2.5.2 Principio de Medida

A quantidade de oxigenio dissolvido e baseada na medida da corrente eletrica

gerada devido a aplicac;ao de uma tensao em dois eletrodos imersos em uma soluc;ao

eletrolitica[ 12].

Utilizando-se urn eletrodo de metal nobre, ouro ou platina, polarizado

negativamente de 0.6 a 0.8V em relac;ao a urn outro eletrodo de referencia de

Ag/ AgCl ambos imersos numa soluc;ao de KCl isolada por uma membrana[l3] semi-

permeavel. consegue-se a reduc;ao[l4]do O2 no primeiro eletrodo. A reac;ao de reduc;ao

implica num "consumo" de eletrons, que e a corrente eletrica, proporcional it

quantidade de O2 reduzida.

A razao da utilizac;ao de tensoes da ordem de 0.6 a 0.8V e dada pelo grafico

de tensao-corrente conhecido como polarogramd12] mostrado na figura 18. De 0 a

0.6V a corrente aumenta com 0 aumento da tensao. De 0.6 a 0.8V praticamente nao

ha variac;ao da corrente com relac;ao it tensao. A partir de 0.8V a corrente cresce com

o aumento da tensao devido principalmente a eletr6lise da agua. Fixando-se uma

tensao na faixa de 0.6 a 0.8V obtem-se. entao. uma leitura de corrente diretamente

proporcional a quantidade de ions reduzidos.



-~-~----~~--~--~--
-- --------------

I
I
I

Tensao de polariza\(ao = -D.N I
I
I

I
2D

Figura 18 - A esquerda esta a corrente gerada por urn sensor de oxigenio dissolvido em fUny30 da
tens30 aplicada (porcentagern de oxigenio fixa). A dire ita. a corrente em fUny30 da porcentagern de
oxigenio (tensao fixa).



ao Amplificador

+

Figura 19 - Desenho do sensor de oxigenio dissolvido utilizado na avaliayao do desempenho da
sonda proposta.



ao Amplificador

+

Figura 20 - Sensor de oxigenio com compensa&lt;;:ao de pressao. A membrana de compensa&lt;;:ao, nao
permeavel, torna a pressao no eletr6lito igual it pressao extema.



A sensibilidade dos sensores de oxigenio aumenta com a temperatura de

maneira exponencial. Logo, a compensaryao deve ser feita atraves de tabelas que

contem a resposta do sensor para cada temperatura. No caso de instrumentos digitais

essas tabelas podem ser convertidas em curvas e implementadas via software, como

foi feito nesse trabalho.

Alem da variaryao da sensibilidade do sensor com a temperatura, a

solubilidade do O2 tambem varia com a temperatura, 0 que e compensado da mesma

maneira atraves de tabelas. Na tabelal17] 6 esti a solubilidade do 00 nas diversas

A solubilidade[15] do O2 varia tambem com a pressao, sendo essa variaryao

linear e diretamente proporcional a variaryao da pressao. Assim. dependendo da

altitude na qual se faz a medida deve-se corrigir 0 valor da solubilidade do 02'

a) Porcentagem: calibra-se 0 instrumento com base em duas soluryoes uma

sem oxigenio (0%) e uma outra saturada de ar ou oxigenio puro (100%).

b) mg/l ou ppm: com base na porcentagem e tabelas de solubilidade calcula-

se a concentraryao do oxigenio na soluryao. Por exemplo, uma amostra esta a 20DC e a

760mmHg. e a medida acusa 30% de oxigenio. Consultando-se a tabela 6 encontra-sc



8.84mg/l na saturayao. Logo, a concentrayao de oxigenio nessa amostra e 0.3 x 8.84

= 2.65mg/l. E importante observar que se a pressao na qual a amostra se encontra for

diferente da pressao no momento da calibrayao, e necessario fazer a correyao.

Tabela 6[17] - Solubilidade do oxigenio em func;:aoda temperatura.

Temp. 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9
0 14.16 14.12 14.08 14.04 14.00 13.97 13.93 13.89 13.85 13.81
I 13.77 13.74 13.70 13.66 13.63 13.59 13.55 13.51 13.48 13.44
2 13.40 13.37 13.33 13.30 13.26 13.22 13.19 13.15 13.12 13.08
3 13.05 13.01 12.98 12.94 12.91 12.87 12.84 12.81 12.77 12.74
4 12.70 12.67 12.64 12.60 12.57 12.54 12.51 12.47 12.44 12.41
5 12.37 12.34 12.31 12.28 12.25 12.22 12.18 12.15 12.12 12.09
6 12.06 12.03 12.00 11.97 11.94 11.91 11.88 11.85 11.82 11.79
7 11.76 11.73 11.70 11.67 11.64 11.61 11.58 11.55 11.52 11.50
8 11.47 11.44 11.41 11.38 11.36 11.33 11.30 11.27 11.25 11.22
9 11.19 11.16 11.14 11.11 11.08 11.06 11.03 11.00 10.98 10.95

10 10.92 10.90 10.87 10.85 10.82 10.80 10.77 10.75 10.72 10.70
11 10.67 10.65 10.62 10.60 10.57 10.55 10.53 10.50 10.48 10.45
12 10.43 10.40 10.38 10.36 10.34 10.31 10.29 10.27 10.24 10.22
13 10.20 10.17 10.15 10.13 10.11 10.09 10.06 10.04 10.02 10.00
14 9.98 9.95 9.93 9.91 9.89 9.87 9.85 9.83 9.81 9.78
15 9.76 9.74 9.72 9.70 9.68 9.66 9.64 9.62 9.60 9.58
16 9.56 9.54 9.52 9.50 9.48 9.46 9.45 9.43 9.41 9.39
17 9.37 9.35 9.33 9.31 9.30 9.28 9.26 9.24 9.22 9.20
18 9.18 9.17 9.15 9.13 9.12 9.10 9.08 9.06 9.04 9.03
19 9.01 8.99 8.98 8.96 8.94 8.93 8.91 8.89 8.88 8.86
20 8.84 8.83 8.81 8.79 8.78 8.76 8.75 8.73 8.71 8.70
21 8.68 8.67 8.65 8.64 8.62 8.61 8.59 8.58 8.56 8.55
22 8.53 8.52 8.50 8.49 8.47 8.46 8.44 8.43 8.41 8.40
23 8.38 8.37 8.36 8.34 8.33 8.32 8.30 8.29 8.27 8.26
24 8.25 8.23 8.22 8.21 8.19 8.18 8.17 8.15 8.14 8.13
25 8.11 8.10 8.09 8.07 8.06 8.05 8.04 8.02 8.01 8.00
26 7.99 7.97 7.96 7.95 7.94 7.92 7.91 7.90 7.89 7.88
27 7.86 7.85 7.84 7.83 7.82 7.81 7.79 7.78 7.77 7.76
28 7.75 7.74 7.72 7.71 7.70 7.69 7.68 7.67 7.66 7.65
29 7.64 7.62 7.61 7.60 7.59 7.58 7.57 7.56 7.55 7.54
30 7.53 7.52 7.51 7.50 7.48 7.47 7.46 7.45 7.44 7.43
31 7.42 7.41 7.40 7.39 7.38 7.37 7.36 7.35 7.34 7.33
32 7.32 7.31 7.30 7.29 7.28 7.27 7.26 7.25 7.24 7.23
33 7.22 7.21 7.20 7.20 7.19 7.18 7.17 7.16 7.15 7.14
34 7.13 7.12 7.11 7.10 7.09 7.08 7.07 7.06 7.05 7.05
35 7.04 7.03 7.02 7.01 7.00 6.99 6.98 6.97 6.96 6.95



a) Solucao com nivel zero de oxigenio (0%): existem substancias que reagem

com 0 oxigenio dissolvido consumindo-o. Urn exemplo e 0 Sulfito de S6dio

(Na2S03). Este deve ser dissolvido na solw;ao na propon;ao de lOOmg de sulfito por

Sml de soluyao.

b) Solucao saturada de oxigenio (100%): urn metodo simples para obter uma

soluyao com lOO% de oxigenio dissolvido consiste em borbulhar ar ou oxigenio num

recipiente contendo urn liquido, geralmente agua destilada, livre de materia viva que

possa consumir oxigenio. Esse borbulhamento deve durar pelo menos 30min, pois 0

tempo para ocorrer 0 equilibrio e grande.

o tipo de eletr6lito varia muito em funyao do tipo de sensor utilizado. Devido

ao con sumo de ions, 0 eletr6lito deve ser trocado periodicamente. No sensor utilizado

nesse trabalho a composiyao do eletr6lito e a seguinte:

-0.3 Mol de KCI

-0.15 Mol de NaH2P04

-aproximadamente 3 moles de NaOH, que sao adicionados ate obter-se

o circuito de urn medidor de oxigenio deve ser capaz de fomecer uma tensao

fixa entre 0.6 e 0.8V (0.7V nesse trabalho) e de medir a corrente gerada pelo sensor.

A intensidade dessa corrente, como mencionado anteriormente, varia muito em

func;ao da area do eletrodo. Assim, 0 circuito que mede a corrente deve ser proietado



5V6 BK2
III IC

'" '"I()

rGNDAI2



para 90% do valor e 80s para 100% do valor. Vale observar, ainda, que existe urn

tempo relativamente grande, cerca de 5rnin, para 0 sensor estabilizar logo que e

ligado (aplica&lt;;ao dos 0.7V).

Devido a estratifica&lt;;ao que ocorre em aguas com pouca agita&lt;;ao,

notadarnente nos lagos, os parametros fisicos e quimicos da agua variam ao longo da

profundidade. Logo, torna-se indispensavel agregar a um grupo de medidas a

profundidade na qual 0 mesmo e realizado.

Ate pouco tempo atras, media-se a profundidade atraves de marcas no cabo

que sustentava os instrurnentos. Esse metodo e bastante impreciso e incomodo, alem

de nao ser passivel de automa&lt;;ao.

Existem varios rnetodos eletronicos para a medi&lt;;ao de profundidade em

rela&lt;;ao a superficie. 0 rnais adequado para 0 caso de uma sonda microprocessada e

medir a pressao, atraves de um sensor especifico, e, considerando a densidade[18] da

agua, calcular a profundidade.

No presente trabalho, nao se conseguiu um sensor de pressao comercial e

tarnpouco houve interesse na constru&lt;;ao de urn, principalrnente pela cornplexidade

rnecanica de tal instrurnento. Assirn, optou-se par urn outro metodo de rnedida 0 qual

rnede, eletronicamente, 0 cornprirnento do cabo lan&lt;;ado ao lago.





o foto-transistor. Assim sac gerados pulsos eletricos a medida que a polia gira. De

acordo com 0 numero de "dentes" do encoder tem-se a precisao da contagem. Por

exemplo: deseja-se uma precisao de lcm na mediyao da profundidade. Admitindo-se

uma polia de 2.87cm de raio, tem-se urn perimetro de 2m = 2 x 3.14 x 2.87 = 18cm.

Logo, a cada volta da polia sac lanyados ao lago 18cm de cabo. Assim, se 0 encoder

tiver 18 "dentes". urn pulso sera gerado a cada centimetro.

A detecyao do sentido de rotayao da polia vem da analise dos sinais gerados

pelos dois sensores posicionados convenientemente. Na figura 24 estao mostradas as

formas de onda colhidas nos foto-transistores posicionados conforme a figura 23 com

a polia girando no sentido anti-horario. Os sinais sac defasados de 90°, num arranjo

conhecido como quadratura[22J•

Urn dos sinais e tornado como referencia. no caso a borda de subidal do sinal

1. A quantidade de puisos e contada a cada borda de subida do sinal 1. Na figura 25 0

mesmo arranJo da figura 24 e mostrado, porem com a polia girando no sentido

horario.

Comparando-se as formas de onda da figura 24 com as da figura 25, nota-se

que no momenta em que ocarre a borda de subida do sinal 1 0 nivel do sinal 2 varia

em funyao do sentido de rotayao. Se 0 sentido e anti-harario, 0 nivel do sinal 2 e zero

(branco). E, se 0 sentido e horario, 0 nivel do sinal 2 e urn (preto). Desta maneira. a

detecyao do sentido e feita atraves da amostragem do sinal 2 com base na borda de

subida do sinal 1. Na figura 26 esta urn exemplo de circuita que realiza a funyao da

amostragem. Com base nos sinais produzidas pelo circuito da figura 26, 0 contador



Figura 23 - A esquerda, 0 encoder utilizado. A direita, 0 sistema de detecyao optico. Note 0
posicionamento dos sensores, com defasagem de 90°



Preto = 1
Branco = 0

! sentido de
! rotac;;ao

Figura 24 - Sinais gerados quando 0 encoder gira no sentido anti-honirio. Quando 0 sensor I
detecta a passagem do branco para 0 preto 0 sensor 2 esta detectando 0 branco.

Preto = 1
Branco = 0

sentido de
rotac;;aoI

sensor 2 I

I
I
I
I

Figura 25 - Sinais gerados quando 0 encoder gira no senti do horario. Quando 0 sensor I dctecta a
passagem do branco para 0 pre to 0 sensor 2 esta detectando 0 preto.

t Q
Ck

D

O=anti-horario
l=horario



in_--r:'~
~~

I
Ref = O.lV

\

\ Ref = O.lV

Figura 27 - No grMico estao mostradas as formas de onda dos sinais do foto-transistor e da saida
do comparador. A direita. 0 comparador.

2 lnterrup.;ao e uma func;ao dos microprocessadores, em geral ativada por hardware, a qual desvia a
execuc;ao do program a principal para uma subrotina qualquer. A interrupc;ao pode ou nao ser atendida
pelo microprocessador deoendendo da sua programac,;ao



o circuito proposto para a sonda esta dividido basicamente em duas partes: a

unidade central e os circuitos dos instrumentos. Estes ultimos sac descritos em

detalhe no capitulo que trata dos instrumentos. Todos eles entregam it unidade central

urn sinal ana16gico na faixa de 0 a 5V. Apenas 0 medidor de profundidade trabalha

com sinais digitais especificos.

Por motivos de portabilidade e compatibilidade escolheu-se utilizar a porta

serial RS232f23J,padrao nos micros IBM/PC, para realizar a transferencia de dados

entre a sonda eo PC.

Na figura 28, esta 0 diagrama em blocos do circuito, que e composto por urn

microcontrolador RISC (PIC l6C84)f24J, urn conversor AID serial de l2bits

(MAXI 87)[25J.2 chaves anal6gicas (DG20I)126J, urn multiplexador (CD4028B), 4

fontes de alimentavao duplas, 1 adaptador RS232, 5 circuitos de condicionamento e

controle dos sinais dos instrumentos e 0 circuito do me did or de profundidade.

Na figura 1 do apendice A, esta 0 diagrama esquematico que serve de base

para a explicavao das funvoes da unidade central.



3 Host e urn computador que controla outro, geralmente centralizando 0 controle
4 RISe - Reduced instruction Set Computer - Microprocessador com pequeno conjunto de instrw;:oes.
5 EEPROM - Eletric Eraseble Programable Read Only Memory - Memoria na qual se po de gravar
dados os quais SaG retidos mesmo retirando a alimental;:ao. No entanto com a aplical;:ao de sinais
eletricos convenientes pode-se apagar ou mesmo reprogramar 0 conteudo da memoria
6 Bidirecional significa uma porta que pode ser programada para atuar como entrada ou como said"



Medidor de
Turbidez

---··---r- _ -

I

Medidor de
Condutividade

Adaptador
RS232

Medidor de
DO

Chave
Ana16gica

Medidor de
Temperatura

+ 12V extemos

I

Medidor de
Profundidade



3.2.1 Programa~ao das Portas

Porta A

RA2, RAl, RAO: pinos de saida formando uma palavra de 3 bits a qual

endere9a 0 muhiplexador da entrada anal6gica de acordo com a tabela 7.

RA3: pino de saida que comanda a escala automatica do turbidimetro. Assim:

RA3=O --+ baixa sensibilidade;

RA3= 1 --+ aha sensibilidade.

RA4: pino de entrada 0 qual Ie 0 sentido do deslocamento do medidor de

profundidade.

Porta B

RBO: pino de entrada de interrup9ao utilizado para a contagem de pulsos do

medidor de profundidade.

RBI, RB5: pinos de saida que comandam, de acordo com a tabela 8, a escala

automatica do condutivimetro.

RB2: pino de entrada que recebe os dados do conversor AID.

RB3: pino de saida que envia 0 sinal de clock para a comunica9ao serial

sincrona com 0 conversor AID.

RB6: pino de saida que envia os dados pel a RS232

RB7: pino de entrada que recebe os dados pela RS232



Entradas anaLOgicas RA2 RAi RAO
AIO 0 0 0
All 0 0 1
AI2 0 1 0
AI3 0 1 1
AI4 1 0 0

RBi
o
o
1
1

RB5
o
1
o
1

Sensibilidade
Alta

Media
Pequena

X



7 Transistor no corte significa que 0 mesmo nao esta conduzindo, ou seja apresentando alta
impediincia entre coletor e emissor.
8 Transistor na satura~ao significa que 0 mesmo esta conduzindo, ou seja apresentando baixa
impediincia entre coletor e emissor.
y A comunica~ao serial assincrona nao utiliza sinal de clock. Esse tipo de comunica&lt;;:ao baseia-se em
temporiza&lt;;:ao pre-determinada. 0 sincronismo e feito no inicio da transmissao, quando 0 start-bit e
recebido, e, a partir dai. cada dispositivo conta seu proprio tempo para realizar a transmissao e
recep&lt;;:ao dos dados.
10 Baud = bits s



....................... ---------------:0; :2;3:4:5:6:7:

Figura 29 - Esquema de transmissao de dados no padrao RS232. No meio fisico (cabo) esse sinal e
invertido.



Figura 30 - Palavra de 16 bits colocada no registrador de deslocamento ao final de cada conversao.
o primeiro bit e 0 sinalizador de fun de conversao (EOC).

cs ~S SS...---------------'
SCLl( ----fL--ss S
OOJT~~

• ~Eoe
INTERFACE OCIOSA __ I 4 E~~:~R~S~"I •... Eoe •..• 1

12 x 0.250115' 3.25j!s

TOTAl. 12.2S1ts

--1--ll\1S--I~1
(Ies) .. ,



Tabela 9 - Niveis logicos das saidas dos transistores comandados pelo CD4028B em funyao do
endereyamento.

D C B A SO Sl S2 S3 S4
0 0 0 0 0 1 1 1 1
0 0 0 1 1 0 1 1 1
0 0 1 0 1 1 0 1 1
0 0 1 1 1 1 1 0 1
0 1 0 0 1 1 1 1 0

II Chave analogica e urn dlspositivo eletronico que atua de maneira similar a urn rele. Com 0 rnesrna
pode-se controlar dig:italmente a conexao de urn sinal analoQ.icC'



Sinol~
AI0



o processo de como e feita a sele~ao automatica esta no capitulo 4 que trata

da descri~ao do programa em linguagem montadora do PICI6C84.

o medidor de profundidade, descrito no capitulo 2 item 2.6, gera dois sinais:

urn sinal tipo transi~ao referente aos pulsos do encoder e urn outro sinal de nivel

referente ao sentido de rota~ao. 0 sinal de transi&lt;;ao ativa a interrupc,:ao atraves da

entrada de interrup&lt;;ao RBO/INT. 0 sinal de nivel e lido pelo pino de entrada RA4. 0

processo de rnedic;:aoda profundidade pode ser visto nos capitulos 2 e 4, que tratam

dos instrurnentos e do programa em linguagem montadora respectivarnente.

o PIC 16C84 atende a interrupc;:ao depois de 5 cicJos de clock. Com urn crista]

de 4MHz cada cicJo dura 1flS (0 clock internamente e dividido por 4). Assim, atende-

se a intcrrupc,:ao em 5fls. A rotina de contagem gasta aproximadamente 13fls. Logo.

tem-se 18flS na contagem de urn pulso do encoder. No medidor proposto a precisao

desejada e de 1cm. Considerando-se 5m/s como a velocidade maxima de descida da

sonda, 0 que e bastante rapido, tem-se a gera&lt;;ao de 500 pulsos por segundo. ou

pulso a cada 2000fls.

As (micas rotinas que dependem de temporizac;:ao preCIsa, e poderiam

eventual mente sofrer com a interrup9ao, sao as rotinas que implementam a interface

serial RS232. A transmissao de urn byte a 2400 bauds leva 4.166ms e cada bit leva

416.6flS. Se 0 periodo das interrupc;:oes e no minimo 2000fls. entao no pior caso um

byte sofreria duas interrup90es atingindo a transmissao de dois hits distintos. Cada hir

atingido teria seu tempo de durac,:ao aumentado em 18flS. Como a RS232 Ie 0 nivel

do sinal no meio do periodo, ou seja a 208.3flS do inicio, esse acrescimo nao causa



problema. Se, em todo caso, houver urn erro na transmissao serial, este e detectado

pOlS, como explicado no capitulo 4 (descric;ao do programa em linguagem

montadora), juntamente com os bytes de informac;ao sao enviados bytes de

verificac;ao. Nesse caso, 0 grupo de bytes com erro e desprezado.

A fim de simplificar a alimentac;ao do circuito e preyer 0 uso de bateria, 0

sistema foi projetado para ser alimentado com tensao extern a simples de + 12Y. No

entanto, internamente ha a necessidade de outras tens5es, inclusive com fontes

isoladas galvanicamente. Para os circuitos digitais foi escolhida a tensao de +5V,

derivada diretamente dos + 12Y. 1a os circuitos anal6gicos necessitam de fontes

simetricas de tensao, isto e, fonte positiva e negativa. Alem disso, devido aos

instrumentos trabalharem simultaneamente no mesmo fluido (agua), os circuitos dos

medidores de pH. de oxigenio dissolvido e de condutividade nao podem ter fontes

com terra comum, caso contrario ocorre interferencia devido a corrente i6nica que

flui de urn sensor ao outro.

Desta maneira para obter as fontes requeridas, construiu-se uma fonte

chaveada baseada em urn transformador com quatro enrolamentos secundarios

isolados. Tres deles formam as fontes para os medidores de pH, de oxigenio

dissolvido e de condutividade. A quarta fonte tern 0 OV aterrado servindo aos

circuitos restantes da sonda.

De acordo com a figura 33, a fonte e constituida por urn CI especifico para

fontes chaveadas (SG3524), 0 qual gera uma onda quadrada na frequencia de 40KHz.



Retificacao +7.5V
Filtragem -7.5V pH
Estabilizacao 0V

+1 Y Retificacao +7.5V
Filtragem -7.5V 02
Estabilizacao 0V

'&lt;t
N Retificacao +7.5VL[)
to Filtragem -7.5V Condutividade()
(f) Estabilizocoo 0V

Retificacao +7.5V
Filtragem -7.5V Gerol
Estabilizacao 0V



4. Programa~ao

o sistema de medidas proposto e composto por dois equipamentos distintos: a

sonda e urn micro padrao IBM/PC. As funyoes de aquisiyao e transmissao dos dados

da sonda sao controladas por urn microcontrolador PIC 16C84, 0 qual possui urn

programa em linguagem montadora[24]na sua memoria interna EEPROM de 1Kbytes.

A listagem completa do programa esta no apendice B.

No micro IBM/PC, alem da comunicayao serial, encontram-se as funyoes de

visualizayao, gravayao e analise dos dados bem como as rotinas de calibrayao dos

instrumentos que requerem tais procedimentos.

Devido a grande variedade de linguagens e programas que a plataforma

IBM/PC permite utilizar, no inicio do trabalho houve uma certa duvida na escolha da

linguagem que seria utilizada para a construyao do programa para 0 Pc. 0 requisito

basico na escolha foi a apresentayao grafica, a qual deveria ser no padrao Windows.

Tentou-se, inicialmente, 0 uso do Visual C++, 0 qual cria programas executaveis

bastante rapidos em Windows. No entanto, dado ao pouco conhecimento na area de

programayao, e nao sendo esse 0 objeto principal do trabalho, nao se conseguiram

resultados imediatos. Partiu-se, entao, para uma linguagem mais simples mas que

ainda atendesse as exigencias iniciais. Nao havendo necessidade de velocidade de



12 Toda a programayao em Visual Basic foi baseada no proprio help do Visual Basic e no livro
indicado na referencia.



Canal AN4 (Temperatura) 1) MSB
2)LSB
3) Byte de verificac;ao

Canal AN3 (pH) 4) MSB
5) LSB
6) Byte de verificac;ao

Canal AN2 (Oxigenio dissolvido) 7) MSB
8) LSB
9) Byte de verificac;ao

Canal ANt (Turbidez) 10) MSB
11) LSB
12) Byte de verificac;ao

Canal ANO (Condutividade) 13) MSB
14) LSB
15) Byte de verificac;ao

Profundidade 16) MSB
17) LSB
18) Byte de verificac;ao

Escalas 19) Escala do Condutivimetro
20) Escala do T urbidimetro



bits 7 6 5 4 3
,.,

1 0..
MSB 1 BII BIO B9 B8 B7 B6 B5
LSB B4 B3 B2 BI BO 0 0 0

OOh ~ sensibilidade baixa
Olh ~ sensibilidade alta

OOh ~ sensibilidade alta
Olh ~ sensibilidade media
02h ~ sensibilidade baixa



1 ransmlle para 0 PC os dados da conversao
+h\'le de verifica~ao (XOR)

l sim
Transmlle valor da profundidade +hrle de

veritica~ao

I ransmite escala, do condutivimetro c 0
tllrbidirnetw

Figura 34 - Fluxograma do program a em assembler do PIC 16C84. Por questoes de c1areza alguns
blocos sao explicados a parte e referenciados atraves dos simbolos Rot I. Rot2. Rot3. Rot4 e RotS.



Rotl- Rotina de inicializacao

Nessa parte do programa 0 microcontrolador realiza as seguintes tarefas:

-Programa 0 Watch Dog Timer, detalhado mais adiante, para Iseg.;

-Zera 0 contador da profundidade;

-Configura a interrupc;;ao, habilitando-a;

-Programa pinos da porta B de acordo com 0 descrito no capitulo 3;

-Atribui nivel inicial dos sinais SCLK e CS do conversor AID;

-Seleciona escala de alta sensibilidade do condutivimetro;

-Seleciona escala de alta sensibilidade do turbidimetro;

-Programa pinos da porta A de acordo com 0 descrito no capitulo 3;

-Zera contador do seletor de escalas do condutivimetro:

-Desabilita todas as entradas analogicas.

Rot2- Selecao da porta analo!!ica

Existe urn contador (reg. F ISh) que conta de 5 a 1. Atraves da rotina

P_ANALG, apendice B, faz-se a relac;;aoentre 0 numero do contador e 0 enderec;;o da

porta analogica. Assim, conforrne 0 contador vai sendo diminuido as portas

analogicas vao sendo selecionadas. Quando 0 comador chega a zero. significa que

todas as portas ja foram acessadas e 0 programa, entao, reinicia. Vale observar que e

necessario aguardar urn tempo entre a selec;;aoda porta e a conversao AID. Devido a

multiplexac;;ao da entrada analogica ter sido feita de maneira discreta, existe urn

tempo de acomodac;;ao do sinal quando 0 mesmo e chaveado. Aproveitando 0 tempo



~
I

Aguarda OAs para
cstabi Iiza~ao da lcnsao do
condutivimetro cm fun~ao
da tmea de eseala.

~ Diminui scnsibilidadc

~ Aumenta scnsibilidadc ~



~ Diminui sensibilidade

i•Rctorna



qual, na realidade, dura apenas 8.5/ls. E chamada, entao, uma outra rotina

(RECDADO) a qual Ie 0 byte mats significativo da palavra de 16 bits que 0

conversor gera. Esse byte e armazenado no registrador f13h. A rotina RECDADO e

chamada uma segunda vez, retirando , desta vez, 0 byte menos significativo. Esse

byte e armazenado em f12h.

Em resumo, a cada chamada de LECONV uma conversao e feita retomando

nos registradores f13h e f12h os bytes correspondentes ao valor convertido.

o TYatch Dog Timer, ja mencionado no capitulo 3, e uma funyao muito

interessante, encontrada em toda a linha PIC, a qual reinicializa 0 microcontrolador

toda vez que este, por um motivo qualquer, tern a execuyao do seu programa

interrompida.

o funcionamento do Watch Dog Timer (WDT) baseia-se num oscilador RC

intemo independente do clock, 0 qual aumenta urn contador que pode ser zerado por

software. Quando ocorre transbordamento nesse contador 0 microcontrolador e

reinicializado. 0 tempo para ocorrer transbordamento pode ser programado dentro de

aproximadamente 18ms a 2.3s. Quando se habilita 0 funcionamento do WDT e

necessario inserir, nos layos do programa, uma instruyao que zera 0 registrador do

WDT num periodo men or que 0 tempo programado para ocorrer transbordamento.

Assim quando a execuyao e interrompida nao ocorre 0 zeramento e. ap6s 0 tempo



No caso presente 0 WDT foi programado para 1s. A instruyao que zera 0

WDT e a CLRWDT, a qual pode ser vista em varios pontos do programa mostrado

no apendice B.

Como ja descrito no capitulo 2 a medida da profundidade da sonda utiliza a

funyao de interrupyao do microcontrolador. Essa funyao, estando habilitada, permite

interromper a execuyao do programa em qualquer ponto transferindo-a para 0

endereyo 0004h, no caso do PIC16C84. Nesse endereyo existe urn jump para uma

sub-rotina (ROTINT) que executa as funyoes de aumentar ou diminuir 0 valor de

uma palavra de 16bits, a qual corresponde ao valor da profundidade.

Nos PIC's a interrupyao pode ser programada para ser ativada tanto por uma

borda de subida como por uma borda de descida. No caso presente, essa foi

programada para ser sensivel a borda de descida.

Alguns microcontroladores possuem intemamente, implementada em

hardware, uma interface serial RS232. No entanto, 0 PIC16C84 nao possui tal

recurso. Assim, foi necessarIO implementar a interface serial via programayao.

Criaram-se duas rotinas: uma para transmissao (TXPIC) e outra para recepyao

(RXPIC). Ambas trabalham com taxa de transmissao fixa, em 2400 bauds. Essa taxa

e baseada em temporizayoes derivadas de atrasos inseridos na execuyao do programa.

Como esses atrasos dependem do clock, as rotinas apresentadas aqui operam em

2400 bouds apenas, para urn clock de 4MHz num microcontrolador PIC 16C84. Se



houver mudan~a no clock ou no microcontrolador a temporiza~ao precisani ser

revista.

Escolheu-se operar a 2400 bauds, 8 bits de dados 1 stop bit e urn start bit.

Desta mane ira, a transmissao de urn byte corresponde a 10 bits. Cada bit dura, entao,

1/2400=416.6/-1s. A leitura de urn bit da-se no meio de seu periodo. Isto e, a leitura e

feita a 208.3/-1s a partir do inicio do bit. Para auxiliar as rotinas de transmissao e

recep~ao foram criadas duas rotinas de temporiza~ao: a DELA Yl, a qual gera 208/-15

e DELA Y2. a qual gera 416/-1s.Esses valores sao aproximados.

Essa rotina Ie bit a bit 0 registrador f20h que deve conteI' 0 byte a ser

transmitido. 0 pino RB6, saida da serial, e entao posto em nivel zero ou nivel urn de

acordo com os bits do registrador f20h. Os bits VaGsendo colocados em sequencia.

do menos significativo para 0 mais significativo. na porta RB6 aguardando-se 416/-1s

entre a mudan~a dos mesmos. Alem disso, no inicio e colocado 0 start bit (=0) e no

final 0 stop bit (=1). A figura 29 do capitulo 3 exemplifica essa sequencia.

4.2.3.2 Rotina de recep~ao

Quando a RS232 esta ociosa 0 nivel do sinal fica em 1 (nivellogico). 0 inicio

da transmissao e detectado quando 0 start bit e enviado (nivel=O). Assirn. para

detectar 0 inicio de uma transmissao a rotina RXPIC permanece 0 tempo todo lendo

o nivel do pino RB7, destinado a recep~ao da RS232. Quando 0 nivel cai a zero.

aguarda-se 416/-1s. 0 que significa a passagem do start bit. Em seguida, inicia-se urn

contador para nortear a leitura dos 8 bits e aguarda-se 208/-1s.Este e 0 ponto medio

do primeiro bit (hitO). Faz-se, entao, a leitura do nivel do pino RB7 e armazena-se c'



208ets Stop bit ~\
I \,

416~s I 416~s 416flS
..----.~!+----++-----+' \

- - -'. - - - - ~ - - .- - - - - - - - - - - - - - - - - ------
:0:1 '2:3:4:5:6:7

byte



o Visual Basic tern 0 seu funcionamento baseado em janelas e elementos

(objetos) graficos. Cada elemento gratico, que pode ser urn desenho, urn texto, uma

imagem capturada etc, esta associado a urn conjunto de sub-rotinas. Assim, conforme

esse elemento e ativado, atraves do mouse, por exemplo, os comandos contidos nas

sub-rotinas sac executados.

o programa desenvolvido possui os seguintes recursos:

• comunica((ao serial pela RS232 a 2400 bauds tendo como op((ao as portas

• rotinas para a calibra((ao dos instrumentos que medem oxigenio

dissolvido e pH;

• grava((ao em arquivo padrao dos dados recebidos em dais modos:

automatico, com interval a de 1s a 60s, e manual;

• visualiza&lt;;ao digital e anal6gica dos dados recebidos com mudan((a

automatica de escalas;

• visualiza((ao e impressao de arquivos ja gravados;

• grava((ao dos parametros da calibra((ao.

Para tanto, a programa conta com 6 janelas as quais sao chamadas de acordo

com as comandos dados pel a uswirio. Ha uma janela de apresentayao, janela

principal a qual fica ativa 0 tempo todo, uma janela para a visualizayao do arquivo no

qual sao gravados os dados recebidos, uma janela para selecionar arquivos para



13 Na realidade, intemarnente ao rnicrocornputador cada cornando e processado em serie em ordern
determinada pelo proprio software. No entanto, 0 usmirio tern a irnpressao do paralelisrno. Vale



oDservar. ainda. que deve-se ter aten&lt;;:ao quando ha ocorrencIa de rotmas concorrentes ocm e difll: I
saDer qUal sera exccutao&lt;1 nnmelr



• receiving data

eom.Port: 4
Calibration FileflllIIllll: c:\virt-_\iritcal_ca1
Data Acquisition FileN-= c:\Yirt .•••••\dat.l_dat
N••••be. 01 AcquititioM done: 7

, A"'l- Node: M••••••• aquiaition

Sit'Itl I
D~elTme

01-14-1!r.17
14:57:30

ffi
'7 8 1:kaltne

. p 12
14

'Help
Manual AcqUisitiOn
Automatic Acquisition
Set Acquisition Step ...

Comm F'ort ~

" pH Temp Conection 0 n
" Condutivimerer Temp Correction On

Comm1 DaComrn2
Comrn3 Date

Time
~ Cornm4



Titulo na barra
File

Save Calibration
Print

pH
turbidimeter

Manual Acquisition
Automatic Acquisition
Set Acquisition Step

Comm Port
pH Temp. Corr.
(on/off)
Condutiv. Temp.
Corr. (on/off)

Abre urn novo arquivo para a grava~ao
dos dados recebidos da sonda
Abre urn arquivo de uma calibra~ao ja
feita
Salva a calibra~ao atual
Chama a janela de visualizac;:ao dos
dados, na qual se encontra 0 comando

. ..
para lmpnmlr
Salva a configura~ao atual e sai do
programa

Chama a janela de calibra~ao do pH
Chama a janela de calibra~ao do
turbidimetro
Chama a janela de calibra~ao do
medidor de oxigenio dissolvido

Chama a janela que mostra 0 arquivo
de dados atual ou gravado

Seleciona aquisi~ao manual
Seleciona aquisir;:ao automatica
Chama uma caixa de dialogo na qual 0
usuario coloca 0 periodo das
aquisi~6es
Seleciona porta serial (l,2.3 ou 4)
Habilita ou nao a corre~ao automatica
de temperatura (nao implementado)
Habilita ou nao a corre~ao automatica
de temperatura (nao implementado)

Help Topics Nao implementado
About Water Analizer Nao implementado



o botao Power serve para ligar e desligar 0 analisador. Existe uma variavel

PowerOn que tern 0 seu valor booleano (true/false) trocado a cada vez que 0 botao e

pressionado. Alem disso, a sub-rotina verifica 0 valor de PowerOn; se for True a

rotina principal (r6tulo Main Routine) e chamada. A rotina principal fica ativa

enquanto Power On =True.

Esse botao somente e mostrado quando a gravayao dos dados e manual -

Menu Options Manual Acquisition. A cada vez que e pressionado 0 conjunto de

medidas atual (no momenta do pressionamento) e gravado no disco. Alem dos dados

enviados pela sonda SaDinseridas, tambem, a data e a hora.

o botao de Reset tern a funyao de zerar 0 contador que armazena 0 valor da

profundidade. Esse contador nao e implementado no PC mas sim no

microcontrolador. Desta manelra, e necessario enVIar urn comando ao

microcontrolador PIC16C84 para que 0 mesmo possa realizar 0 zeramento do

contador. A cada vez que 0 botao de Reset e acionado, urn byte (A7h) e enviado ao



2)imprime na tela mensagens acerca do andamento do
processamento;

3)indica, atraves de retulos, 0 tipo de calibrac;;ao usada nos
medidores de pH e oxigemio dissolvido ("Uncalibrated", "Calibrated
by 1pt" e "Calibrated by 2pt")';

4 )inicializa a porta serial escolhida com os parametros: 2400
bauds, sem paridade, palavra de 8 bits e 1 stop bit;

5)implementa um objeto visual (imitando um led quadrado), 0
qual plsca enquanto ha transferencia de dados na porta serial. Se
por algum motivo ocorrer interrupc;;ao na comunicac;;ao 0 objeto
para de piscar;

6)testa se 0 botao de Reset do contador da profundidade foi
pressionado; se foi envia 0 byte A7h para 0 microcontrolador;

7)envia 0 byte OAh requisitando ao microcontrolador um grupo
de medidas;

9)aguarda a chegada de 20bytes, correspondente ao grupo de
medidas;

10)se apes 0 envio do byte OAh 0 grupo de medidas nElO
chegar dentro de 1 seg, a func;;ao Watch Dog Timer implementada
em Visual Basic e acionada. Esta func;;ao e explicada adiante em
detalhes;

11japes a chegada dos 20 bytes 0 buffer da serial e lido e, ao
mesmo tempo, esvaziado;

13)os 20 bytes sao, entao, separados a fim de extrair a
informac;;ao neles contida. 0 valor das medidas, 0 qual e enviado
por 2 bytes, e concatenado numa unica palavra e convertido para
uma escala de 0 a 100%. Assim, as rotinas sUbsequentes tratam
com valores padronizados;

14)a fim de obter uma leitura mais confiavel os valores
mostrados na tela e/ou arquivados em disco sac decorrentes da
media de 4 valores medidos



15)alem dos valores medidos sac retirados do grupo de 20
bytes as informac;:oes da profundidade e das escalas do
turbidfmetro e do condutivfmetro;

16)mostra 0 valor da temperatura num r6tulo e num painel
anal6gico (Gauge);

17)mostra 0 valor do pH num r6tulo e num painel anal6gico
(Gauge). Para cada tipo de calibrac;:ao existe um conjunto de
expressoes que 0 programa seleciona com base em variaveis
globais atualizadas pelas rotinas de calibrac;:ao;

18)mostra a porcentagem de oxigenio dissolvido num r6tulo e
num painel anal6gico (Gauge);

19)mostra 0 valor da turbidez num r6tulo e em um painel
anal6gico (Gauge). Como a turbidez e medida em duas escalas 0
programa seleciona 0 fator de escala e escolhe tanto a unidade
que aparece no r6tulo como 0 fundo do painel anal6gico;

20)mostra 0 valor da condutividade num r6tulo e num painel
anal6gico (Gauge) A condutividade e medida em tres escalas
Assim, 0 programa determina a unidade a ser mostrada no r6tulo e
no painel anal6gico;

23)se a opc;:aode aquisic;:ao automatica e selecionada, entao a
rotina que grava 0 grupo de medidas e acionada;

24 )volta para 0 item 2) enquanto 0 botao Power nao for
pressionado novamente:

26)implementa as rotinas de tratamento de erro. mostrando
caixas de mensagens indicando 0 erro ocorrido. Foram previstas 3
possibilidades:

-"Device unavailable", erro normalmente causado par
problemas na comunicac;:ao serial;

-"Overflow", erro causado por calibrac;:ao mal feita:
-"Division by zero", erro causado, tambem, par calibrac;:ao mal

feita;



2)Estabelece 2s. como periodo de gravar;:ao dos dados
adquiridos, caso a opr;:ao Aquisir;:ao Automatica seja selecionada;

4)Se 0 arquivo de gravar;:ao dos dados nao tem nome, 0 nome
NONAME.OAT e atribufdo, eo mesmo e mostrado na tela;

5)Prepara 0 arquivo de gravar;:ao dos dados, escrevendo 0 seu
caber;:alho;

6)Le 0 arquivo de configurar;:ao (CFG.OAT) e inicializa as
variaveis com base nas informar;:oes gravadas;

7)Le 0 arquivo de calibrar;:ao (NOME.OAT) e inicializa as
variaveis com base nas informar;:oes gravadas;

8)Mostra na tela 0 tipo de calibrar;:ao utilizada nos medidores de
pH e oxigenio dissolvido;

9)lmplementa as rotinas de tratamento de erro, que neste caso
referem-se a erros na abertura de arquivos. Uma caixa de
mensagem e mostrada indicando 0 erro e a possivei solur;:ao;

1)Aumenta um contador, 0 qual e mostrado na tela para
informar ao usuario quantos grupos de dados ja foram gravados;



2)Concatena numa string todas as variaveis que serao
gravadas;

3)Grava essa string no arquivo NOMEDAT, incluindo-a junto
aos dados ja gravados;

4)lnclui a string na variavel usada pela janela (form) que mostra
os dados gravados em disco;

1)0 objeto visual (imitando um led quadrado) tem a sua cor
trocada de verde piscante para vermelha continua. Esse estado
perdura ate que a comunicar;ao seja recuperada;



2)duas mensagens sac mostradas de maneira alternada em
substitui9aO da mensagem "receiving data ... ": "Communication
error." e "Trying to recover. .. ";

4)esvazia 0 buffer da serial. Isto e necessario pois 0 buffer
pode conter alguns dados colocados em ordem errada devido ao
defeito na comunica9ao;

5)requisita a sonda, enviando 0 byte OAh, um novo grupo de
medidas;

6)implementa as rotinas de tratamento de erro. Estas sac as
mesmas da rotina principal, ja descritas;



:iIeName: c:\virt-wa\cal1.cal
itic- c;l~al __ ~· r.U'IDT h'A,aloalAUC ..1_.

IOepth:O

File Names:
Idata2.dat

cfg.dat
datal.dat
noname.dat

Ok .. ]

Cancel J

L 7ift04de~

3)verifica qual 0 comando que chamou a janela de files e, de
acordo com a origem, chama a sub-rotina adequada;

4)implementa as rotinas de tratamento de erro. Sao 5
possibilidades de erro, todas relacionadas com 0 acesso ao disco:

4.1) "File not found";
4.2) "I/O error";
4.3) "Disk not ready";
4.4) "Path not found";
4.5) "Bad file name";

Ao ocorrer 0 erro uma caixa de mensagem e mostrada na tela
indicando 0 erro ocorrido;



1)verifica se a usuario digitou a nome do arquivo com a
extensao apropriada (.dat). Se a usuario nao colocou, a sub-rotina
a insere automaticamente;

3)abre um arquivo com a nome especificado e escreve a
cabec;alho no mesmo;

1)Abre a arquivo, atribuindo as dados contidos no mesmo a
uma variavel tipo string;



2)a string elida caractere a caractere. A separac;:ao dos dados
e feita atraves de espac;:os, e 0 final de arquivo e marcado com a
palavra EOF. Um vetor e criado, sendo cada elemento um dado;

3)os elementos do vetor sac atribufdos as variaveis envolvidas
na calibrac;:ao;

1)verifica se 0 usuano digitou 0 nome com a extensao
apropriada (.cal). Se nao digitou, a extensao e inserida
automaticamente;

2)concatena em uma variavel tipo string as variaveis envolvidas
na calibrac;:ao, separando-as por espac;:os e marcando 0 fim de
arquivo com a palavra EOF;



;e
[nt TemplC) pH 02(%) TuINTU) CdlluS) Prof(m) Hora Dala
iOI 25.4 8.25 8.06 14.4 313.8 0 14:59:38 01-14-1997 =1:q, 25.4 8.25 8.06 14.4 313.8 0 14:59:38 01-14-1997
0 25.4 8.25 8.06 14.4 313.8 0 14:59:38 01-14-1997

ld, 25.4 8.25
8.06 14.4 313.7 0 14:59:38 01-14-1997

25.4 8.25 8.06 14.4 313.7 0 14:59:38 01-14-1997

• 25.4 8.25 8.06 14.4 313.9 0 14:59:39 01-14-1997-_. 25.4 8.25 8.06 14.4 313.9 0 14:59:39 01-14-1997..-
25.4 8.25 8.06 14.4 313.9 0 14:59:39 01-14-1997
25.4 8.25 8.06 14.6 3137 0 14:59:39 01-14-1997
25.4 8.25 8.06 14.6 313.7 0 14:59:39 01-14-1997

;:: 25.4 8.25 8.06 14.6 313.7 0 14:59:39 01-14·1997
25.4 8.25 8.06 14.5 313.8 0 14:59:40 01-14-1997

r
25.4 8.25 8.06 14.5 313.8 0 14:59:40 01-14·1997
25.4 8.25 8.06 14.5 313.8 0 14:59:40 01-14-1997
25.3 8.25 8.06 14.6 313.7 0 14:59:40 01-14-1997
25.3 8.25 8.06 14.6 313.7 0 14:59:40 01-14-1997
25.3 8.25 8.06 14.6 313.7 0 14:59:40 01-14-1997
25.4 8.25 8.06 14.6 313.8 0 14:59:41 01-14-1997
25.4 8.25 8.06 14.6 313.8 0 14:59:41 01-14-1997 .:J

)tE

&lt;;&gt; Current data
'load~FIIet I'-'-"~'-'~"--"1

~

Print .... ,
t' File data

L....~~: ...::.i __ .i.

---- -

Figura 41 .. Janela para visualizayao dos dados enviados pela sonda.



pH Calibr alion a

Buffer 1 1708 I

~f 12504C 1
J

'Cancel j

h::·..·B·.·.·.·.·u·.-•.. ~~f·.·~·~I·.·.·.·.~~·.··.·.·.?.:. .... 1J. 1 c= n.) 1 ~U!ferx~ J

1)Verifica se 0 analisador esta ligado. Se nao estiver uma
caixa de mensagem e mostrada na tela instruindo 0 usuario a ligar
o analisador;



2)Verifica qual foi 0 buffer selecionado, testando 0 r6tulo que
indica 0 buffer selecionado. Se foi 0 buffer1, e habilitado 0 timer1.
Se foi 0 buffer2, e habilitado 0 timer2;

2)Cancela 0 buffer selecionado, atualizando a variavel global
que indica se um determinado buffer foi ou nao utilizado;

3)Envia mensagem a tela dizendo que a calibrac;:ao do buffer
em questao foi cancelada;

4)Atualiza a informac;:ao de status que indica 0 tipo de
calibrac;:ao utilizado ("uncal", "1 pt" ou "2pt");

1)Cria-se uma variavel local a sub-rotina que guarda 0 valor do
pH num determinado instante (pH local);

2)Calcula-se a diferenc;:a entre 0 valor do pH local e 0 ph atual -
aquele que esta vindo constantemente da sonda;

3)Cada vez que a diferenc;:a e menor que 0.02 um contador e
aumentado;



4)0 indicador de pregresso e alimentado com 0 valor do
contador;

5)Quando 0 contador chega a 10, 0 processo de calibrac;ao e
paralisado, pois significa que a medida esta estavel e, portanto,
valida para ser armazenada;

6)A variavel global, que indica se um buffer foi utilizado ou nao,
e atualizada;

7)0 valor do buffer, a temperatura do mesmo e 0 valor do pH
lido sac associados as variaveis (globais) que armazenam os
parametres da calibrac;ao;



1udiu 0-

ft&lt;mto. a

de!t

~

~a

~tU1t4

da~

~

'Pe:tfflite M

~

~ C()ffl

O-~da
attit«de f/
~

-- 00 Calibration !IS £1

____Tref 125_4

Altitude 1850

~elect 0% or 100% and press ··Start" ... - -

II 0% 100%

-i

eancel J

0% j Close 1,100% J

/
s~o- /
ft&lt;mto. a de!t

~



Virtual Water Analyzer
r-d ™

" "'" {~'\,,- .~ V . •~~ ~.,U



5. Transmissao dos Dados via Radiofreqiiencia

Ao longo do projeto da sonda, cogitou-se a possibilidade de realizar a

transmissao dos dados sem fazer uso de cabos eletricos. Uma alternativa e a

transmissao via radiofrequencia com a sonda sendo alimentada par bateria.

Par questoes de limita9ao de tempo e conhecimento. e dada a abardagem

quase que total mente experimental, os dispositivos de transmissao e recep9ao nao

faram agregados formalmente ao projeto da sonda. No entanto, fez-se a inclusao

deste capitulo uma vez que urn transmissor e um receptor de dados foram

desenvolvidos e testados, contudo separadamente da sonda.

A propaga9ao de ondas eletromagneticas na agua[30] encontra muitas

dificuldades devido aos altos valares de condutividade e de constante dieletrica da

mesma. A sonda multissensora e sustentada par um cabo metalico, 0 qual vai da

sonda ate a superficie externa da agua . Valendo-se de sse fato. a ideia do sistema



)4 Portadora e urn sinal de alta freqliencia 0 qual tern urn parametro (freqliencia, amplitude ou fase)
variado segundo urn outro sinal de menor freqliencia. 0 sinal de menor freqliencia (sinal modulante)
pode ser recuperado mediante it detec~ao do parametro variado.



C2
10n

T RlXl 1M
3.57MHzD.I

Cl
0.1U'I

t1~'""
8lK

i3cC3-.L9P
C4

~P

C7
I10n



I
I

1 0 1 1 0 0 1 0 1

~



• l&lt;et.,."ciO VonCMll em runcoo do ,..ewoel do I-'ortodoro."DA 1ge1&lt;

i C7 ----l.....

I"'I
I -

i~\,-
\

Detector
de env.

C6

T'&lt;f

+: U1:A~~FF~'"R16 _'I
1~

H."
'"

C2
22r.F

I

C15
21uf D6

• ( , I~ ,

D
-7 * ---22uF
l LC16



o comparador converte 0 sinal de pequena intensidade da saida do detector de

envolt6ria para os niveis compativeis com a interface RS232. 0 mesmo ocorre com 0

amplificador de audio, caso 0 modo audio seja utilizado.

A interface RS232 exige sinais positivos e negativos na faixa de -12 a + 12V,

sendo que a mesma funciona tambem na faixa de -5 a +5V. A fim de permitir que 0

circuito funcione a partir de uma unica bateria, incluiu-se urn circuito gerador de

tensao negativa, como mostrado na figura 47.

Por motivos de viabilidade pr:itica 0 teste do sistema foi dividido em duas

partes: teste de transmissao de urn tom de audio com 0 transmissor submerso e teste

de transmissao de dados (de urn PC para outro PC) fora d' agua.

o primeiro teste foi realizado a uma profundidade de 3 metros em agua doce

com 0 transmissor alimentado por urn bateria de 9V e urn sinal de audio de onda

quadrada na frequencia de 1KHz. Com 0 receptor alimentado tambcSm por uma

bateria de 9V foi possivel a detec((ao do sinal de 1KHz. Como cabo de sustenta((ao.

utilizou-se urn cabo elcStricoflexivel de bitola 1.5mm2•

o segundo teste foi realizado entre dois micros do tipo IBM/PC localizados

em salas diferentes distanciados de aproximadamente 6 metros. 0 transmissor foi

alimentado com urn bateria de 9V e sua entrada de dados foi conectada it saida da

porta serial RS232 de urn dos PC's. 0 receptor foi alimentado tambcSm por uma

bateria de 9V e sua saida de dados foi conectada it entrada da porta serial RS232 do

outro Pc. A saida do transmissor conectou-se urn cabo flexivel, 0 qual foi estendido



ate ficar proximo do receptor, sem conexao eletrica. Com dois softwares bastante

simples escritos em Visual Basic, urn para transmissao e outro para recepyao, fez-se a

transmissao, de caracter a caracter, de urn micro para outro. de urn texto de

aproximadamente 10000 caracteres em diversas taxas de transmissao (de 1200 a

o desempenho do sistema foi extremamente satisfatorio. Para uma utilizayao

real sera necessario implementar urn algoritmo de detecyao de erros e fazer a

transmissao dos dados em grupos de bytes.



6. Conclusao

6.1 Introdm;ao

o presente trabalho teve como objetivo 0 desenvolvimento de urn

instrumento microprocessado para a medida de parametros fisicos c quimicos da

agua. 0 projeto envolveu 0 uso de componentes recentes e tecnicas modemas de

programac;ao. 0 microcontrolador PIC 16C84 e 0 conversor AID MAX 187

permitiram a confecc;ao de uma placa de circuito impressa bastante compacta, pois

possuem urn numero reduzido de pinos e requerem poucos componentes extemos. Ja

a programac;ao em Visual Basic mostrou-se plenamente adequada ao

desenvolvimento do sistema, uma vez que nao exige muito conhecimento do

programador e produz programas de alta qualidade e de facil expansao.

o circuito da sonda juntamente com 0 programa em Visual Basic

apresentaram urn desempenho bastante satisfat6rio. A operac;ao e a visualizac;ao dos

instrumentos virtuais ficaram bem facilitadas devido aos recursos graficos

disponiveis.

Infelizmente, por falta de recursos a montagem completa da sonda nao foi

possive!, uma vez que a mesma implicaria em gastos com oficina mecanica e compra

de sensores especificos como 0 de pH e 0 de oxigenio dissolvido. Na avaliac;ao dos

circuitos utilizaram-se sensores de laborat6rio.



6.2 Otimiza~ao do Projeto

6.2.1 Medidor de Profundidade

o medidor de profundidade sugerido no projeto apresenta urn desempenho

satisfatorio, podendo ser implementado sem nenhum problema. No entanto, 0

metodo proposto traz alguns inconvenientes de ordem pnitica na manipulac;ao da

sonda:

• 0 cabo de sustentac;ao da sonda po de nao descer perpendicularmente a

superficie da agua, como no caso de urn rio com correnteza. Neste caso, 0

medidor indicaria uma profundidade maior que a real;

• 0 medidor deve ser zerado na superficie da agua, ja que 0 mesmo mede 0

comprimento relativo de cabo que passa pela polia;

• E necessario haver, na superficie da agua, urn aparato medinico e

eletronico a fim de implementar 0 medidor.

Uma altemativa para a medic;ao de profundidade e a medida indireta, atraves

de urn sensor de pressao. Esse sensor seria alojado junto aos outros instrumentos e

seu sinal seria enviado, tambem, junto com os sinais dos outros instrumentos. A

pressao e proporcional a profundidade e a densidade do liquido. Assim, conhecendo-

se a pressao e a densidade, pode-se calcular a profundidade. 0 problema da diferenc;a

de densidade de uma agua para outra pode ser resolvido considerando-se 0 valor da

condutividade, pois a quantidade de sais na agua influencia diretamente esse ultimo

panlmetro. 0 sensor de pressao nao foi implementado devido a falta de recursos para

a compra do mesmo.



6.2.2 Fonte de alimenta~ao

As fontes de alimentayao isoladas galvanicamente sao de fundamental

importancia para evitar layos de terra entre os instrumentos. 0 sistema de fonte

sugerido funcionou de maneira razoavel. Contudo, restaram, ainda, algumas

pequenas interferencias devido ao transformador. A construyao desse componente e

critica e nao houve tempo suficiente para urn desenvolvimento mais criterioso do

o sistema proposto preve 0 uso de urn lap-top como unidade de visualizayao

e armazenamento de dados. No entanto, 0 uso de urn lap-top em campo pode trazer

problemas, pois esses equipamentos sao, ainda, pouco robustos. Uma soluyao para

esse problema seria a construyao de urn microcomputador dedicado, baseadoem urn

microcontrolador PICou INTEL 8031, que faria a comunicayao com a sonda,

mostraria os dados de forma resumida num display de cristal liquido e armazenaria

os dados numa memoria nao volcitil. Posteriormente, essa unidade microprocessada

seria conectada a urn PC, via porta serial RS232, transferindo os dados para analise.



Tanto 0 sistema com lap-top como 0 sistema com data logger podem ser

evoluidos para urn sistema automatico de medidas, 0 qual nao necessita de urn

operador. 0 cabo da sonda seria acoplado a uma polia motorizada, a qual faria os

movimentos de descida e subida da sonda. Assim, de pedodo a pedodo 0 lap-top ou

o data logger seria retirado e seus dados transferidos para urn pc.

Unindo a ideia do sistema automatico de medidas com a ideia de transmissao

dos dados via radiofreqiiencia, urn sistema de telemetria poderia ser feito com poucas

modificac;:oes no projeto original. 0 sistema de polia motorizada ficaria em uma b6ia,

na superficie da agua, juntamente com 0 transmissor/receptor e a antena. 0

microcomputador PC situado a distancia receberia os dados enviados pela sonda.

Para isso ser possivel seria necessario apenas aumentar a freqiiencia do

transmissor/receptor sugeridos no capitulo 5, de modo a obter urn tamanho de antena

mais adequado.

o Visual Basic oferece recursos de comunicac;:ao via rede de computadores

bastante simples de serem implementados. Com poucas modificac;:oes no programa e

possivel estabelecer uma comunicac;:ao atraves da rede mundial Internet entre

computadores conectados a mesma. Assim, pode-se receber instantaneamente os

dados da sonda, mesmo que esta esteja a milhares de quilometros de distancia.



Bibliografia

[1] OEHME, F. - Liquid Electrolyte Sensors: Potenciometry, Amperometry, and

Conductometry. IN: GOPEL, W.; HESSE, l; ZEMELlN., Sensors: A

comprehensive survey. New York, VCH, 1991. V.2 p.3l4 -339

[2] COVINGTON, A. K. - Introduction: Basic Electrode Types, Classification, and

Selectivity Considerations. IN: COVINGTON, A. K .. Ion Selective Electrode

Methodology. Florida, CRC Press, 1979. VI p.1 - 18

[3] MILLMAN, J.; HALKIAS, C. C. - Eletronica: Dispositivos e Circuitos. Sao

Paulo, McGraw Hill do Brasil, 1981. V2 p.635 - 639

[4] MILLMAN, J.; HALKIAS, C. C. - Eletronica: Dispositivos e Circuitos. Sao

Paulo, McGraw Hill do Brasil, 1981. V2 p.561 - 593

[5] COLE-PARMER INSTRUMENT COMPANY - Catalogo 1989-1990 - USA

[6] OEHME, F. - Liquid Electrolyte Sensors: Potenciometry, Amperometry, and

Conductometry. IN: Gapel, W.; Hesse, 1.; Zemel,lN., Sensors: A comprehensive

survey. New York. VCH, 1991. V.2 p.24l- 268

[7J WESTCOTT, c.c. - Principles of pH Measurements. IN: Westcott, C.c. - pH

Measurements. New York, Academic Press, 1978. p.1-16

[8] WESTCOTT, c.c. - Electrodes. IN: Westcott, c.c. - pH Measurements. New

York, Academic Press, 1978. p.41-78

[9] WESTCOTT, C.c. - The pH Meter. IN: Westcott. c.c. - pH Measurements.

New York, Academic Press, 1978. p.17-39



[10] U.S. ENVIRONMENTAL PROTECTION AGENCY - Manual for Methods

for Chemical Analysis of Water and Wates - Washington DC 1974. p.29S-298

[11] NATIONAL SEMICONDUCTOR DATA BOOK - Data Acquisition Linear

Devices - 1989. P.6-12 a 6-17

[12] LEE, YOUNG H.; TSAO, GEORGE T. - Dissolved Oxygen Electrodes

[13] KORYTA, JIRl. - Ions, electrodes and membranes. - Membranes. New York,

John Wiley &amp;amp; Sons, 1982. p.12S-lS0

[14] ATKINS, P. W. - General Chemistry. - Redox Reactions. New York, Scientific

American Books, 1989. p. 96-109

[15] ATKINS, P. W. - General Chemistry. - The Properties of Solutions. New York,

Scientific American Books, 1989. p. 400-420

[16] MANUAL DE INSTRUc;OES - FAC 204A O2 Analyzer. Industria FAC

LTDA. Sao Carlos

[17] HUTCHINSON - A Treatise on Limnology - Oxygen in Lake Waters. New

York, John Wiley &amp;amp; Sons, 1957. p. 580

[18] HUTCHINSON - A Treatise on Limnology - The Properties of Water. New

York, John Wiley &amp;amp; Sons. 1957. p. 206 a 208

[19] AN ENGINEERING HANDBOOK - DC Motors Speed Controls Servo

Systems. Electro-Craft Corporation. Hopkins, 1980. p. 7-1 a 7-18

[20] MILLMAN, J.; HALKIAS, C. C. - Eletronica: Dispositivos c Circuitos.

Caracteristicas de urn Diodo de Jun9aO. Sao Paulo, McGraw Hill do Brasil. 1981. VI



[21] MILLMAN, J.; HALKIAS, C. C. - Eletronica: Dispositivos e Circuitos. -

Caracteristicas do Transistor. Sao Paulo, McGraw Hill do Brasil, 1981. VI p.144 -

145

[22] GAYAKWAD, R.; SOKOLOFF, L. - Analog and Digital Control Sytems -

Control Systems Components. New Jersey, Prentice-Hall. Inc., 1988. p. 83 a 87.

[23] RS232 Interfacing: Manual de Referencia.

[24] MICROCHIP DATA BOOK - Arizona, 1992

[25] MAXIM - New Releases Data Book - Volume IV.

http://www.maxim-ic.com - arquivos em formato PDF

[26] INTERSIL DATA BOOK - 1988. p.8-32 a 8-35

[27] TEXAS INSTRUMENT - The TTL Data Book. Dallas, 1973. p.274 a 277.

[28] TAUB, HERBERT - Circuitos Digitais e Processadores - Flip-flops,

Registradores e Contadores. Sao Paulo, McGraw-HilL 1984. p.150 a 155.

[29] HOLZNER, STEVEN - Visual Basic for Windows - Rio de Janeiro, Campos,

1994.

[30] COLIN, ROBERT E. - Antennas and Radiowave Propagation - Radiowave

Propagation. USA, McGraw-Hill, 1985. p.434 a 444.

[31] The ARRL Handbook for Radio Amateurs - Modulation and Demodulation.

Newington, American Radio Realy League, 1992. p 9-8 a 9-10

[32] BLACK, E. PETER - Watershed Hydrology - Water in the Hydrosphere.

Syracuse, Prentice Hall, 1991. p 233 a 246.

http://www.maxim-ic.com


Apendices

o apendice A e composto pelos esquemliticos dos circuitos desenvolvidos.
Esses esquematicos foram impressos diretamente pelo programa Tango-Schematic 0
qual possui formato proprio de impressao. Nas paginas seguintes encontram-se os
esquemas relacionados abaixo:

Esquema 1 - Unidade Central
Esquema 2 - Fontes de Alimentayao
Esquema 3 - Condutivimetro
Esquema 4 - Medidores de Temperatura, Turbidez, pH e Oxigenio Dissolvido
Esquema 5 - Medidor de Profundidade
Esquema 6 - Transmissor de Dados e Audio em CW/AM 3.57 MHz
Esquema 7 - Receptor de Dados e Audio em CW/AM 3.57 MHz



L it'Jl [ ~,~'(' I 111" :F,
,

1 c-,intJ; /\10~- [11 ['.
':,1 14

~
~.;

-V 1 ''vt
=, ';1,1[1 \/Pp

---2..L

-LL
~- [ 54 c 3

r~;i'J [i AI~' - 1(0 elm AID[14 [, ?i
p,

Iin
0

IN4

-:::h-
- ..--f- S4
'81 .t,Ie -

U4

--.l2..-

11

u'
VCC~"1 S~

L S~~' S3 15

, 14SC\ C 1

~ 1 ,~i B
, 17

C
..--£..-

-,;,-) D ~
~ 10 -S6 A

~ eNe' S5 ~-
,:fl40:?E.B

" F'L4

+5~ MCl"'

~VSS

F: Rae II~T

REO'
,----£- RC;

11,1, ' :: il f

~FI Il'~

RAI ~

I' AQ --..22.-,

CLeclUT
I .. t SV

VD[)~

" ~A 8
COt JC'I-.!TI\il f,.i E1 RO



\/1 G VO

W7805CTB

+ 12\.'

100uH
L1

+ C' 9

INV +5 REF 15 ..I:our
NI VCC 15

3 EB 14
4 CB 13 R30

1 K

5 12 R31GND CA
I K

6 RT EA 11

CT 10 IKR2j
2.2nF 8 9COMP

'" 47KSGj524 "us
'"':Eo 1 uF

i S\

p, (, rneljldc,r de oXlqenlo dlssolvldo

~5129f

MAXS02

Drown bv
Sheet of

D



R21

~.

C'B
5f&lt;f

+
+

AlTA
l.tEOIA

PEOU[NA.

Date 2S 1296
fCilenome PICMAXS03



~C'!i[iAI2

"Sc R48 82K
R49 22K
R50 8K:

::

+7 ~v-'-"""'----.l"'.""'---_c&gt;-s'NAl AI4

~ 2ZtI

Medldores de 'J emperaturu, 1UI bide:. pH
e Oxigen1o Dissolvido



3 eLF'
u

4093
U l1A

0 20
S[T

U 2f.-..

25 1296

F'ICMA\ S05



(, 1(~l~~FI

17089f,

PICMAX 506



~

"r~1
J3pF
(I

Ih
p,

1708.9(;

PICMAX.s0~

Drown bv
Sheet 7

D



START

ORG 0
GOTO INICIO

ORG 4
GOTO ROTINT

ORG 5
INICIO

MOVLW OXBE
MOVWF OXBl

MOVViJ OXO
MOVWF OX2A
MOVWF OX2B

MOVLW OX90
MOVWF OXOB

MOVLW OXBS
TRIS OX6

BCF OX6,3
BSF OX6,4

BCF OX6,1

BCF OX6,S

MOVViJ OXI
t-10VWF OX22

BSF OXS,3

MOVLvJ OXIO
TRIS OXS

CLR~ OXIO

MOVLW OXFF

MOVWF OXS

;Nivel inicial do SCLK
;Nivel inicial do CS

;Programa condutivimetro com alta
;sensib

;Registrador que guarda escala do
;Turbidimetro
;Programa turbidimetro com alta
;sensibilidade

;Zera contador do seletor autm.
;(alta sens.)
;Desabilita todas as entradas
;analogicas



i-------------------------------------------------------------------
iRotina principal: recebe dado serial enviado pelo hOSL.

Inicia as S conversoes, transmit indo 3 byLes a cada
conversao. 2 bytes da palavra de dados de I6bits e
1 byte de verificacao composto por OU EXCLUSIVO dos
byLes de dados.
Ordem de envio: MSB, LSB e Byte de verificacao.
Ordem de envio dos dados das entradas analogicas:
AN4, AN3, AN2, ANI, ANO, Prof

iNo final, saG transmitidos dois bytes que contem a escala do
icondutivimetro e do turbidimetro

MOVWF
CALL

MOVWF
MOVF
ANOLI'J
IORWF

~10VWF

L7 CALL

MOVF

SUBLW
BTFSC
CALL

MOVF
SUBLW
BTFSC
GOIO

GOTO

LI
t-10VF

SUBL;!
STFSS
GOTO
CALL

GOTO

L4 t-10VF

SUBUJ
BIFS:"
GOTO
CI.LL

GeT

OXIS
P ANALG

OX2F
OXS,O
OXB
OX2F,O

OXA7
OX3,2
ZERAPROF

OX20,O
OXP.
OX3,2

O:C
OX3,2
L4
CON OUT

LS
TURBID

ilnicia contador (FISH) das portas
ianalogicas

iConverLe contador em bits de 0 a 4 na
iporta A (selecao de entradas analg.;
i flS=S indica porta 4, flS=4 indica
;porta 3

;Operacoes de AND e OR para manter
;0 bit A3 inalterado

;Testa se byte recebido
;valor aa profundidade

;TesLa se byte recebido = OAh
;Se for, inicia processo de conversac

;Se byte recebido nao e A7 e neD OA,
;aguarda nova comunicacac

;Coloca numero da porLa seleclonada
;para teste

;Verific2 58 por~a anal.
;selecionada=conduci '.-.(fI5=1·

;Rotina para escolher a escala
;adequacia

;Coloca numero da porta seleclonacia
;para
ites-ce
;Test2 S::?: p=,r~L2 ~.:~=- (t'Jrt&lt;~_j. ~ I':=J~.
;selecionada (fIS=2)
;Rotina para escolner a escala
;adequad2



L5 CALL LECONV

L6 DECF OX15,1
MOVF OX15,O

CALL P ANALG

MOVWF OX2F
tvlOVF OX5,O
ANDLW OX8
IORWF OX2F,O

MOVWF OX5

MOVF OX13,O
MOVWF OX20
CALL TXPIC

MOVF OX12,O
MOVWF OX20
CALL TXPIC

MOVF OX13,O
XORWF OX12,O
tvlOVWF OX20
CALL TXPIC

MOVF OX15,O
BTFSS OX3,2
GOTO Ll

MOVF OX2B,O
MOVWF OX20
CALL TXPIC

MOVF OX2A,O
MOVWF OX20
CALL TXPIC
MOVF OX2B,O
XORvJF OX2A,O
MOVWF OX20
CALL TXPIC

MOVF OXI0,O
~10VWF OX20
CALL TXPIC

MOVF OX22,O
MOVWF OX20
Cp"LL TXPIC

GOTO L3

;Decrementa F15 de uma unidade
;Carrega W corn 0 numero da proxima
porta analogica

;Converte contador ernbits de 0 a 4 na
;porta A (selecao de entradas analg.)

;Operacoes de AND e OR para manter
;0 bit A3 inalterado

;Gera byte de verificacao
;Byte de verificacao = f13 XOR f12

;Transmi~e by~e MSB do valor da
;Profundidade

;Transmite byte LSB do valor da
;Profundidade

;Rotina que converte 0 numero do contador de en~rada analogica e~
;bits aa por~a p,
P ANALG

ADDWf
RETLW

2,1
OX4 ;numero adicional para ajuste do

;contado::



RETLW
RETLW
RETLW
RETLW
RETVil

OXO
OXI
OX2
OX3
OX4

iRotina que escolhe a escala adequada para 0 Turbidimetro
TURBID
Kl CLRWDT ;Reset WatchDogTimer

CALL LECONV

MOVF OX13,O
SUBLW OXFE
BTFSC OX3,O
GOTO K2

BTFSS OX22,O
GOTO K3

BCF OX22,O
BCF OX5,3
GOTO Kl

MOVF OX13,O
SUBLvl OX86
BTFSS OX3,O
GOTO K3

BTFSC OX22,O
GOTO K3

BSF OX22,O
BSF OX5,3
GOTO Kl

RETURN

iRotina que escolhe a escala adequada para 0 condu~ivime~rc
CONDUT
H2 CALL LECONV iFaz conversao

MOVF
SIJBLW
BTFSC

MOVF
SIJBLW
BTFSC

INCF
CALL

MOVF
SUBLW
BTFSS

OX13,O
OXFE
OX3,O

OXIO,O
OX2
OX3,2

OXIO,l
PROG SEL

OX13,O
OX82
OX],

iTesta se valor lido&gt;98,4 . Se nao for
ivai para HI

iTesta se contador=2 (pequena
isensibilidade)

iPrograma 0 seletor, diminuindo a
isensib.



GOTO
MOVF
BTFSC

GOTO

DECF

CALL

GOTO

H3 RETURN

;Ratina para
PROG SEL

MOVF
BTFSS
GOTO
BCF
BCF
GOTO

H3
OXI0,1
OX3,2 ;Testa se cantadar=O (alta

;sensibilidade)

;Pragrama a seletar, aumentanda a
;sensib.

MOVF
SUBLW
BTFSS
GOTO
BCF
BSF
GOTO

MOVF
SUBLW
BTFSS
GOTO
BSF
BCF

MOVLW
MOVWF
CALL
CALL
CALL
CALL

DECFSZ
GOTO

OXI0,1
OX3,2
Jl
OX6,1
OX6,5
J3

OXI0,0
OXI
OX3,2
J2
OX6,1
OX6,5
J3

OXI0,0
OX2
OX3,2
J3
OX6,1
OX6,5

OXFF
OX23
DELAY2
DELAY2
DELAY2
DELAY2

OX23,1
J4

;Recebe byte serial, par RB7 a 2400 baud, e a armazena em F20h
RXPIC
Cl CLRWDT ;Zera WatchDagTimer

BTFSC
GOTO

OX6,7
Cl



CALL DELAY2 ;Insere delay de 416us
CALL DELAYl ;Insere "1/2" delay de 208us

MOVLW OX8 ;Carrega contador (fl4H)
MOVWF OX14

C7 BTFSS OX6,7 ;Le bit em RB7
GOTO C4
BSF OX3,0 ;Coloca "1" no Carry
GOTO C5

C4 BCF OX3,O ;Coloca "0" no Carry

C5 RRF OX20 ;Posiciona bit lido

CALL DELAY2 ;Insere delay de 416us

DECFSZ OXI4,1 ;Testa fim da contagem (1-8)
GOTO C7

C8 BTFSS OX6,7 ;Confirma "Stop Bit"
GOTO C8

RETURN

;Le byte em F20h e envia, serialmente, por RB6 a 2400 baud
TXPIC

BCF OX6,6 ;Envia "Start Bit"
CALL DELAY2 ;Insere delay de 416us

MOVLW OX8 ;Carrega contador (f14H)
MOVWF OX14

B5 RRF OX20 ;Posiciona, no Carry, 0 bit
;a ser lido

BTFSS OX3,0 ;Le bit a-craves do Carry
GOTO B2
BSF OX6,6 ;Envia "1 " na saida serial
GOTO B3

B2 BCF OX6,6 ;Envia "0" na saida serial
B3 CALL DELAY2 ;Insere delay de 416us

DECFSZ OXI4,1 ;Testa fim da contagern (1-8)
GOTO B5

BSF OX6,6 ;Envia "Stop Bit"
CALL DELAY2 ;Insere delay de 416t.:s

RETURN

;------Rotina para ler dados do conversor MAXI8~--------------------
o conversor MF~187 trabalha com palavras de 16bits
As palavras sac recebidas a 2 bytes por palavra
Palavra de dados: F13h (MSB) E F12h (LSB)

Fl3
Fl2

lXXX XXXX
XXX X xooo

As palavras sac recebidas serialmente
Dados: (recebida do conversor) porta RB2



A rotina LECONV coloca os dados lidos do conversor ern F13h e
F12h

A conversao eh feita assirn que 0 sinal de CS vai para nivel
baixo(CS=O)

LECONV
BCF

CALL
MOVF

CALL
MOVF

BSF
RETURN

RECDADO
OXOF,O

RECDADO
OXOF,O

;Recebe 1st byte de dados e guarda ern
;f13h

;Recebe 2nd byte de dados e guarda ern
;f12h

RECDADO
MOVLW
MOVWF

BTFSS
BCF

NOP
NOP
NOP
NOP
NOP
NOP

DECFSZ
GOTO
RETURN

OX8
OX14

OX6,2
OXOF,O

OX14,1
E1

;Rotaciona reg OFh (posiciona bitO pi
;escrita)
;Seta bitO=l, se bit em DOUT=O entao 0
;proximo BFC faz a troca
;Le dado na porta RB2 (DOUT conversor)
;Coloca bit lido na posicao bit=O
;do registrador fOFn

;Acerta 0 "duty cycleU do clock
;em aproximadamente 50

DELAY 1
MOVLW
MOVWF

Gl DECFSZ
GOTO
RETURN

OX44
OX2l
OX21,1
Gl



DELAY2
MOVLW
MOVWF

G2 DECFSZ
GOTO
RETURN

OX88
OX21
OX21,1
G2

DELAY3
IvJOVLW
MOVWF

G3 DECFSZ
GOTO
RETURN

OXOF
OX21
OX21,1
Gl

ROTINT
CLRWDT
MOVLW
MOVWF

GOTO
INCF
BTFSC
INCF
RETFIE

DECREM
MOVF
BTFSC
DECr
DECr

OXI0
OXOB

DECREM
OX2A
OX3,2
OX2B

OX2A,1
OX3,2
OX2B
OX2A

;Zera valor da profundidade
ZERAPROF

MOVLloi
MOVWr
MOVWF
RETURN

OXO
OX2.n.
OX2B

;Zera WatchDogTirne~
;Reabilita interrupcao

;Testa se deve incrernentar ou
;decrernentar

;Incrernenta LSB
;Testa se LSB=O (overflow)
;Incrernenta MSB (vai urn)

;Testa se LSB ja eh zero
;Se for decrernenta MSB e LSB
;Se nao, decrernenta apenas LSB





STU: String que contem 0 valor instantaneo da turbidez

SCOND: String que contem 0 valor instantaneo da condutividade

SOX: String que contem 0 valor instantiineo da % de 02 dissolvido

SPROF: String que contem 0 valor instantiineo da profundidade

STIME: String que contem 0 valor instantiineo da hora

SDATE: String que contem 0 valor instantaneo da data

TEMP: Valor instantiineo da temperatura

PH: Valor instantiineo do pH

TV: Valor instantiineo da turbidez

COND: Valor instantiineo da condutividade

OX: Valor instantiineo da porcentagem de oxigenio dissolvido

PROF: Valor instantiineo da profundidade

AC_Num: lnteiro LONG que totaliza 0 numero de aquisi~oes gravadas

V(5): Array que guarda os valores de tensao (%) correspondentes a:

V(O)=TEMP

V(l)=PH

V(2)=OX

V(3)=TU

V(4)=COND

PHWINDOW: Guarda 0 estado do foco dajanela de calibra~ao. Variavel

usada para redesenhar a janela quando 0 botao de

D_Reset: Variavel global que e igualada a urn a cada vez que se deseja zerar
o contador de profundidade.

DAF _NAME.DAT: Contem os dados da aquisi~ao no seguinte formato abaixo.

Os dados sao colocados em linha separados por espa~os. A primeira

linha contem 0 titulo de cada coluna.

CALF _NAME.CAL: Contem os dados da calibra~ao. Cada linha possui os pariimetros

de urn instrumento separados por espa~os. A seqUencia e pH, Turbidez e 02.

PH_CALIPH_CAL2VPHIPHITPHIVPH2PH2TPH2VTUITUIVTU2

TU2 DO CALO DO CAll 00 VDOO VDOIOO TDOO TDOlOO- -



00000000

1 0 VPH 1 PH 1 TPH 1 0 0 0

o 1 0 0 0 VPH2 PH2 TPH2

Sem calibrac;:ao

Calibrac;:ao por 1 ponto

Sem calibrac;:ao

o 0 VDOO VDO 100 TDOO TDO 100
1 0 VDOO VDO 100 TDOO TDO 100

o 1 VDOO VDO 100 TDOO TDO 100
1 1 VDOO VDO 100 TDOO TDO 100

Sem calibrac;:ao

Sem calibrac;:ao

Sem calibrac;:ao

Calibrado

CFG.DA T: Contem a ultima configurac;:ao do menu feita pelo uswirio. Cada vez

que 0 program a e carregado a configurac;:ao e restaurada. Os dados saD
colocados em uma (mica linha separados por espac;:os.

CALF_NAME: ultimo nome do arquivo de calibrac;:ao usado pelo uswirio

ACQUISITION: Manual/Auto

COMM PORT: 1/2/3/4

PH TEMP CORR: On/Off- -



Sub New_DA_Click 0
Files.Ext.Text = "'.dat"
Files.File1.Pattern = Files.Ext.Text
Files.Caption = "New Acquisition Data File"
Files.Show

End Sub

Sub Open_CF _Click 0
Files.Ext.Text = "'.cal"
Files.File1.Pattern = Files.Ext.Text
Files.Caption = "Open Calibration File"
Files.Show

End Sub

Sub Save_C_Click 0
Files.Ext.Text = "'.cal"
Files.File1.Pattern = Files.Ext.Text
Files.Caption = "Save Calibration File"
Files.Show

End Sub

Sub Print_Click 0
Data_A_Click

End Sub

Sub Exit_Click 0
PowerOn = False

'Grava a configurayElo atual do programa
'Inicia a concatenayElo da vari,'lVel Config

Config = CALF_Name &amp;amp; Space(1) 'Grava 0 arquivo de calibrayElo
Config = Config &amp;amp; ACQUISITION &amp;amp; Space(1) 'Grava 0 modo de aquisiyElo
Config = Config &amp;amp; COMM_PORT &amp;amp; Space(1) 'Grava a numero da porta serial
Config = Config &amp;amp; PH_TEMP _CORR &amp;amp; Space(1) &amp;amp; COND_TEMP _CORR &amp;amp; Space(1) 'Grava 0 modo de

correyElo de temperatura (pH e Cond)
Config = Config &amp;amp; "EOF" &amp;amp; Space(1)

'Atualiza 0 arquivo Config.dat
Open CurDir$ &amp;amp; "\Cfg.dat" For Output As #1

Print #1, Config
Close
End



Sub pHCAL_Click 0
PH_CAL_ WINDOW.Show
PHWINDOW = "Active"

End Sub

Sub Dissolved_O_Click 0
DO_CAL_WINDOW.Show
DOWINDOW = "Active"

End Sub

Sub Data_A_Click 0
DataView.Show

End Sub

Sub ManuaLA_Click 0
Manual_AChecked = True
Automatic_AChecked = False
ACQUISITION = "Manual"
Manual_Ac_PaneI.Visible = True

de dados
Manual_Ac_Save.Visible = True
Samples_Number.Text = "Manual aquisition"

End Sub

'Seleciona 0 tipo de aquisiyao desejada (auto/manual)
'Mostra a janela que permite 0 usuario gravar manual mente um grupo

Sub Automatic_A_Click 0
AutomaticAChecked = True 'Atribui valores as variaveis que indicam a opyao selecionada no menu
Manual_AChecked = False
ACQUISITION = "Auto" 'Seleciona 0 tipo de aquisiyao desejada (auto/manual)
Manual_Ac_PaneI.Visible = False 'Esconde a janela que permite 0 usuario gravar manualmente um grupo

de dados
Manual_Ac_Save.Visible = False
Samples_Number.Text = "Automatic acquisition (1 save every" &amp;amp; AcquJrequency &amp;amp; "sec.)" 'Mostra a

opyao selecionada na janela de status
Acquisition_Timer. Interval = Acqu_Frequency * 1000 'Seleciona 0 intervalo das aquisiyoes

End Sub

Sub SetAS_Click 0
Msg = "Saves an acquisition every ... seconds (min=1 max=60)"
Title = "Acquisition Saving Step"
ACF = 10 'Default

'Verifica a faixa de 1 to 60 seg
Again:

ACF = Val(lnputBox$(Msg, Title))
If ACF &amp;lt;1 Then AcquJrequency = 1
If ACF &gt; 60 Then Acqu_Frequency = 60



AcquJrequency = ACF
'Mostra a 0P9ao selecionada na janela de status

Call Automatic_A_Click
End Sub

Sub Comm1_Click 0
COMM_PORT = 1
Comm1.Checked = True
Comm2.Checked = False
Comm3.Checked = False
Comm4.Checked = False
CommPortNum.Text = COMM_PORT

End Sub

Sub Comm2_Click 0
COMM_PORT = 2
Comm1.Checked = False
Comm2.Checked = True
Comm3.Checked = False
Comm4.Checked = False
CommPortNum.Text = COMM_PORT

End Sub

Sub Comm3_Click 0
COMM_PORT = 3
Comm1.Checked = False
Comm2.Checked = False
Comm3.Checked = True
Comm4.Checked = False
CommPortNum.Text = COMM_PORT

End Sub

Sub Comm4_Click 0
COMM_PORT = 4
Comm1.Checked = False
Comm2.Checked = False
Comm3.Checked = False
Comm4.Checked = True
CommPortNum.Text = COMM_PORT

End Sub

Sub pH_ TC_Click 0
pH_ TC.Checked = Not pH_ TC.Checked
If pH_ TC.Checked = True Then PH_TEMP _CORR = "On" Else PH_TEMP _CORR = "Off'

End Sub

Sub Condutivimeter_ TC_Click 0
Condutivimeter_ TC.Checked = Not Condutivimeter_ TC.Checked
If Condutivimeter_ TC.Checked = True Then COND_ TEMP _CORR = "On" Else COND_ TEMP _CORR = "Off'

End Sub

Sub Power_Click 0
If SerialComm.PortOpen = True Then SerialComm.PortOpen = False
PowerOn = Not PowerOn
If PowerOn = True Then PowerLight.BackColor = &amp;amp;HFF Else PowerLight.BackColor = &amp;amp;HCOCOCO
If PHWINDOW = "Active" Then PH_CAL_ WINDOW.SetFocus



If DOWINDOW = "Active" Then DO_CAL_WINDOW.SetFocus
If PowerOn = True Then Call MainRoutine_Click
WdgTimer.Enabled = False
RdataLed.BackColor = &amp;amp;HCOCOCO
Messages.Text = "Off'
Acquisition_ Timer.Enabled = False

End Sub

Sub Manual_Ac_Save_Click 0
Acquisition_Num.Text = AC_Num
TB = Chr$(9)

'Constr6i uma string que contem todos os valore atuais
DA_ Var = STEMP &amp;amp; TB &amp;amp; SPH &amp;amp; TB &amp;amp; SOX &amp;amp; TB &amp;amp; STU &amp;amp; TB &amp;amp; SCOND &amp;amp; TB &amp;amp; SPROF &amp;amp; TB &amp;amp; STIME &amp;amp; TB

&amp;amp; SDATE &amp;amp; TB
'Grava 0 grupo atual de dados

Open DAF _Name For Append As #1
Print #1, DA_ Var

Close
AC_Num = AC_Num + 1 'Conta 0 numero de aquisic;oes feitas
DataView.DataTextCur.Text = DataView.DataTextCur.Text &amp;amp; DA_Var &amp;amp; Chr$(13) &amp;amp; Chr$(10)

End Sub

Sub Command1_Click 0
'Seta uma variavel que permite 0 envio ao PIC do byte que zera 0 contador de profundidade

D_Reset = True
End Sub

Sub MainRoutine_Click 0
'Se ocorrer algum erro a execuc;ao e transferida para 0 r6tulo Erro

On Error GoTo Erro
'Mostra mensagens

Messages.FontSize = 10
Messages.Text = "Starting Analizer ..."

'VtempO: valores recebidos do PIC16C84 - VO: Media de VtempO
Static Vtemp(5), AVERG(10), TOO As Single
Static Rdata, N_MED, N, Com Error As Integer

'Mostra 0 modo de calibrac;ao do medidor de pH: uncal, 1pt or 2pt
If PH_CAL 1 = 1 And PH_CAL2 = 1 Then

pH_Status. Text = "Calibrated by 2pt"
Elself PH_CAL 1 = 1 Then
pH_Status.Text = "Calibrated by 1pt"
Else
pH_Status.Text = "Uncalibrated"

End If
'Mostra 0 modo de calibrac;ao do medidor de DO: uncal or calibrated

If DO_CALO = 1 And DO_CAL 100 = 1 Then
DO_Status.Text = "Calibrated"
Else



DO_Status.Text = "Uncalibrated"
End If

'Numero de medidas para 0 calculo da media
N_MED = 4

'Inicializa a porta serial
SerialComm.CommPort = COMM_PORT
SerialComm.Settings = "2400,N,8, 1"
SerialComm.PortOpen = True
For T = 1 To 10000: Next T
SerialComm.PortOpen = False
For T = 1 To 10000: Next T
SerialComm.PortOpen = True

'Mostra mensagens
Messages.ForeColor = &amp;amp;HCOOOOO
Messages.Text = "receiving data"

'Inicia comunica9ao com a sonda (PIC16C84)
While PowerOn = True

'Implementa um led piscante
Rdata = Not Rdata
If Rdata = True Then RdataLed.BackColor = &amp;amp;HFFOO&amp;amp; Else RdataLed.BackColor = &amp;amp;HO

'Retorna de um erro na comunica9ao
CE:
'La90 para 0 calculo da media

For N = 1 To N_MED
'Se 0 botao de reset for pression ado, entao um byte (A7h) e enviado ao PIC para zerar 0 contador de
profundidade

If D_Reset = True Then SerialComm.Output = Chr$(167): D_Reset = False
'Envia um byte ao PIC16C84 para 0 infcio da conversao (OAh)

SerialComm.Output = Chr$(10)
'Habilita 0 Watch Dog Timer. Se os dados nao vierem dentro de 1 segundo 0 sistema
'e reinicializado tentando uma nova comunica9ao

WdgTimer.Enabled = True
'Aguarda a chegada dos dados enviados pelo PIC16C84

Do
dummy = DoEventsO

Loop Until SerialComm.lnBufferCount &gt;= 20
'Desabilita Watch Dog Timer

WdgTimer.Enabled = False
Messages.Text = "receiving data"

'Le 0 buffer da porta serial, esvaziando-o
DataBlock = SerialComm.lnput

'Agrupa numa palavra de 16bits os dois bytes enviados pelo PIC e verifica 0 byte XOR
'Converte todos os valores recebidos para a faixa de 0 a 100%

For i = 0 To 4
If (Asc(Mid(DataBlock, 1 + 3' i, 1)) Xor Asc(Mid(DataBlock, 2 + 3' i, 1))) = Asc(Mid(DataBlock, 3 + 3 *

i, 1)) Then
Vtemp(i) = (32!' (Asc(Mid(DataBlock, 1 + 3 * i, 1)) -128) + (Asc(Mid(DataBlock, 2 + 3 * i, 1)) / 8)) /

AVERG(i) = AVERG(i) + Vtemp(i)
Else

GoTo CE 'Se ocorrer erro, reinicializa comunica9ao
End If

Next i
Next N

'Calcula a media dos valores
Fori=OT04

V(i) = AVERG(i) / N_MED
AVERG(i) = 0

Next i



'Extrai 0 valor da profundidade
V(5) = 255# * Asc(Mid(OataBlock, 16, 1)) + Asc(Mid(OataBlock, 17, 1))
V(5) = V(5)' 165280 * 100

'Extrai a escala do Condutivimetro
Cond_Scale = Asc(Mid(OataBlock, 19, 1))

'Extrai a escala do Turbidimetro
Turb_Scale = Asc(Mid(DataBlock, 20,1))

'Mostra 0 valor da temperatura
TEMP = 4.096 * V(O)
STEMP = Format$(TEMP, "0.0")
Gauge_Temp.Value = TEMP * 10
Oigi_ Temp.Caption = STEMP &amp;amp; " C"
PH_CAl_WINDOW.Temp_PH_Ref.Text = STEMP &amp;amp; "C" 'mostra 0 valor da temperatura do buffer

'Mostra 0 valor do pH
If PH_CAl1 = 1 And PH_CAl2 = 1 Then

CTEMP = (TEMP - (TPH 1 + TPH2) 1 2) * .1259
MR = (VPH1 - VPH2) 1 (PH1 - PH2)
PH = (V(1) - (7 - PH1) * MR - VPH1) 1 (CTEMP + MR) + 7

Eiself PH_CAl1 = 1 Then
MR = 3.448 + .01259 * TEMP
PH = (V(1) - (3.448 + .01259 * TPH1) * (7 - PH1) - VPH1) 1 MR + 7

Else
PH = (V(1) - 32.61) 1 (3.448 + .01259 * TEMP) + 7

End If
SPH = Format$(PH, "0.00")
Gauge_pH.Value = PH * 100 'Ajuste da escala
Digi_pH.Caption = SPH

'Mostra 0 valor da concentra9ao de oxigenio dissolvido
TOO = (TO0100 + TOOO) 1 2
IfTDO &amp;lt;17.5 Then

SOlUB = .0063 * TOO * TOO - .3875 * TOO + 14.158
Else

SOlUB = -3,2192 * log(TOO) + 18.478
End If
SOlUB = (Pressure 1760) * SOlUS
If DO_CAlO = 1 And DO_CAl100 = 1 Then

MR = 100 1 (VD01 00 - VOOO)
ox = MR * (V(2) - VDOO)
Conc_OX = OX * SOLUB/100
SOX = Format$(Conc_OX, "0.00")
Gauge_02.Value = Conc_OX * 100
Digi_02.Captlon = SOX &amp;amp;" mg/l"

Else
OX = V(2)
SOX = Format$(OX, "0.00")
Gauge_02.Value = OX * 100
Digi_02.Caption = SOX &amp;amp;" mg/l"

End If
'Mostra 0 valor da turbidez

Select Case Turb_Scale
Case 0

TU = -.00002 * V(3) "4 + .0084 * V(3) " 3 - .2841 * V(3) " 2 + 8.8719 * V(3) + .0636
STU = Format$(TU, "0")
Gauge_ Turb2Value = TU
Gauge_ Turb2.Visible = True
Gauge_ Turb1.visible = False

Case 1
TU = -.00008 * V(3) " 3 + .0108 * V(3) " 2 + .2292 * V(3)
STU = Formal$rTU, "0.0")



Gauge_ Turb1. Value = TU * 10
Gauge_ Turb2Visibie = False
Gauge_ Turb1.Visible = True

End Select
Digi_ Turb.Caption = STU &amp;amp; " NTU"

'Mostra 0 valor da condutancia especifica
Select Case Cond_Scale
Case a

COND = V(4) * .734 - .7 'Ajuste de off-set e ganho
SCOND = Format$(COND, "0.0")
Gauge_CondO.Value = COND * 10
Gauge_CondO.Visible = True
Gauge_Cond1Visible = False
Gauge_Cond2.Visible = False
Digi_Condut.Caption = SCOND &amp;amp; " uS/em"

Case 1
COND = (V(4) - .0001) * 8.85 'Ajuste de off-set e ganho
SCOND = Format$(COND, "0.0")
Gauge_Cond1.Value = COND
Gauge_CondO.Visible = False
Gauge_Cond1.Visible = True
Gauge_Cond2Visible = False
Digi_Condut.Caption = SCOND &amp;amp; " uS/em"

Case 2
COND = V(4) * .08771 'Ajuste de off-set e ganho
SCOND = Format$(COND, "0.00")
Gauge_Cond2.Value = COND * 100
Gauge_CondOVisible = False
Gauge_Cond1.Visible = False
Gauge_Cond2.Visible = True
Digi_Condut.Caption = SCOND &amp;amp; " mS/cm"

End Select
'Mostra a profundidade

PROF = V(5)
SPROF = Format$(PROF, "0")
Depth.Text = SPROF

'Mostra a data e a hora
STIME = TimeS
SDATE = Date$
DispTime = STIME
DispDate = SDATE

'Inicia a gravay80 dos dados adquiridos
If ACQUISITION = "Auto" Then Acquisition_ Timer.Enabled = True Else Acquisition_ Timer.Enabled = False
dummy = DoEventsO

Wend
'Termina a gravayao dos dados adquiridos

Acquisition_ Timer.Enabled = False
'Fecha porta serial

If SerialComm.PortOpen = True Then SerialComm.PortOpen = False
Go T0 NoError
Erro:

CommError = "Communication falilure. Check if the selected Comm number matchs the hardware conection"
CalError = "Calibration failure. Runs Calibration again."
Select Case Err

Case 68 'Device unavailable, causado por erro na comunicayElo
MsgBox CommError, 16

Case 6 'Overflow, causado principalmente por erro na calibrayao
MsgBox CalError, 16

Case 11 'Division by zero. causado principalmente por erro na calibrayElo



MsgBox CalError, 16
End Select
PowerOn = False
PowerLighl.BackColor = &amp;amp;HCOCOCO

Resume NoError
NoError:
End Sub

Sub Form_Load 0
On Error GoT 0 Erro3
'Rotinas de Inicializac;:ao

PHWINDOW = "Closed"
DOWINDOW = "Closed"
Static CF _Menu(1 OJ, CAL_ Var_Sub(19) As String
AcquJrequency = 2 'Seta intervalo default como sendo 2 seg
PowerOn = False 'Inicializa 0 botao de On/Off
TB = Chr$(9}

'Inicializac;:ao
STEMP = "0"
SPH = "0"
STU = "0"
SCOND = "0"
SOX = "0"
SPROF = "0"
STIME = "0"
SDATE = "0"
AC_Num = 0
Pressure = 760

'Se 0 usuario nao da um nome ao arquivo de aquisic;:ao de dados, entao os dados SEW gravados num arquivo de
nome NONAME.DAT

DAF _Name = CurDir$ &amp;amp; "\NONAME.dat"
AcquFileName.Text = DAF _Name 'Mostra 0 nome do arquivo de aquisic;:ao

'Escreve 0 cabec;:alho on arquivo
Open DAF _Name For Output As #1

Print#1, "Temp(C)" &amp;amp; TB &amp;amp; "pH" &amp;amp; T8 &amp;amp; "02(%)" &amp;amp; TB &amp;amp; "Tu(NTU}" &amp;amp; T8 &amp;amp; "Cdt(uS)" &amp;amp; T8 &amp;amp; "Prof(m)" &amp;amp;
TB &amp;amp; "Hora" &amp;amp; TB &amp;amp; "Data"

Close
'Abre 0 arquivo de configurac;:ao (Config.dat)

Open CurDir$ &amp;amp; "\Cfg.dat" For Input As #1 'Carrega a ultima configurac;:ao do programa
Config = Input$(LOF(1), #1)

Close #1
'Le a string Config e a separa em substrings relacionadas com a configurac;:ao do menu do programa

j = 1
k = 1
i = 1
Do

i = InStr(k, Config, " ")
CF _MenuU) = Mid$(Config, k, i - k)
j = j + 1
k = i + 1

Loop Until CF _MenuU - 1) = "EOF"
'Faz a atribuic;:ao das variaveis do Menu e dos arquivos

CALF_Name = CF _Menu(1)
ACQUISITION = CF _Menu(2)
COMM_PORT = Val(CF _Menu(3))
PH.TEMP.CORR = CF. Menu(4)



COND_ TEMP _CORR = CF _Menu(5)
'Restaura a ultima configura9ao do Menu

Select Case ACQUISITION
Case "Manual"

Call Manual_A_Click
Case "Auto"

Call Automatic_A_ Click
End Select
Select Case COMM_PORT
Case 1

Call Comm1_Click
Case 2

Call Comm2_ Click
Case 3

Call Comm3_Click
Case 4

Call Comm4_Click
End Select
If PH_TEMP _CORR = "On" Then pH_ TC.Checked = True Else pH_ TC.Checked = False
If COND_ TEMP _CORR = "On" Then Condutivimeter_ TC.Checked = True Else Condutivimeter_ TC.Checked =

False
'Inicializa as variaveis de calibra9ao com 0 ultimo arquivo de calibra9ao utilizado

Open CALF_Name For input As #1
CAL_VAR = Input$(LOF(1), #1)

Close #1
CalFileName.Text = CALF_Name 'Mostra 0 nome do arquivo de calibra9ao

'Le a string CAL_VAR e a separa em substrings relacionadas com a configura9ao do menu do programa
j = 1
k = 1
i = 1
Do

i = InStr(k, CAL_ VAR, " ")
CAL_Var_SubU) = Mid$(CAL_VAR, k, i - k)
j = j + 1
k = i + 1

Loop Until CAL_Var_SubU -1) = "EOF"
'Faz a atribui9ao das variaveis de calibra9ao

PH_CAL 1 = Val(CAL_Var_Sub(1))
PH_CAL2 = Val(CAL_Var_Sub(2))
VPH1 = Val(CAL_Var_Sub(3))
PH1 = Val(CAL_Var_Sub(4))
TPH1 = Val(CAL_Var_Sub(5))
VPH2 = Val(CAL_ Var_Sub(6))
PH2 = Val(CAL_Var_Sub(7))
TPH2 = Val(CAL_Var_Sub(8))
VTU1 = Val(CAL_Var_Sub(9))
TU1 = Val(CAL_Var_Sub(10))
VTU2 = Val(CAL_ Var_Sub(11))
TU2 = Val(CAL_Var_Sub(12))
DO_CALO = Val(CAL_Var_Sub(13))
DO_CAL 100 = Val(CAL_Var_Sub(14))
VDOO = Val(CAL_ Var_Sub(15))
VD0100 = Val(CAL_Var_Sub(16))
TOOO = Val(CAL_Var_Sub(17))
TO0100 = Val(CAL_Var_Sub(18))

'Mostra 0 modo de calibra9ao do medidor de pH: uncal, 1pt or 2pt
If PH_CAL 1 = 1 And PH_CAL2 = 1 Then

pH_Status.Text = "Calibrated by 2pt"
Elself PH_CAL 1 = 1 Then



pH_Status. Text: "Calibrated by 1pt"
Else
pH_Status. Text : "Uncalibrated"

End If
'Mostra 0 modo de calibrayEio do medidor de DO: uncal, calibrated

If DO_CALO: 1 And DO_CAL 100: 1 Then
DO_Status.Text: "Calibrated"
Else
DO_Status.Text: "Uncalibrated"

End If
Press_Status: "P:" &amp;amp; Pressure &amp;amp; "mmHg"

GoTo NoError3
Erro3:

FE : "First time running. Before exiting give a name to the Calibration File and save it"
Select Case Err

Case 53, 57, 71, 76, 52 'Erro de arquivo
MsgBox FE, 48

End Select
CALF_Name: ""

Resume NoError3
NoError3:

Startup. Present Timer.Enabled : True
End Sub

Sub Acquisition_ Timer_Timer 0
AC_Num : AC_Num + 1 'conta 0 numero de aquisiyoes feitas
Acquisition_Num.Text: AC_Num
TB: Chr$(9)

'Constr6i uma string que contem todos os valores atuais
DA_ Var : STEMP &amp;amp; T8 &amp;amp; SPH &amp;amp; T8 &amp;amp; SOX &amp;amp; T8 &amp;amp; STU &amp;amp; T8 &amp;amp; SCOND &amp;amp; T8 &amp;amp; SPROF &amp;amp; T8 &amp;amp; STIME &amp;amp; T8

&amp;amp; SDATE &amp;amp; T8
'Grava em disco 0 grupo de dados atual

Open DAF _Name For Append As #1
Print #1, DA_ Var

Close
'Adiciona 0 novo grupo de valores na janela de visualizayEio dos dados (DataView)

DataViewDataTextCur.Text: DataViewDataTextCur.Text &amp;amp; DA_ Var &amp;amp; Chr$(13) &amp;amp; Chr$(10)
End Sub

Sub WdgTimer_ Timer 0
Static toggle As Integer

'Mud a 0 led piscante para um led com cor vermelha continua
RdataLed.8ackColor: &amp;amp;HFF

'Alterna as mensagens de status
toggle: Not toggle
Select Case toggle
Case True

Messages.Text: "Communication Error."
Case False

Messages.Text: "Trying to recover ..."
End Select

'Trata erros



On Error GoTo Erro2
'Esvazia 0 buffer da porta serial

Lixo = SerialComm.lnput
'Envia ao PIC16C84 um outro byte

SerialComm.Output = Chr$(10)
GoTo NoError2
Erro2:

CommError = "Communication falilure. Check if the selected Comm number matchs the hardware conection"
CalError = "Calibration failure. Runs Calibration again.

Select Case Err
Case 68 'Device unavailable, causado por erros na comunicayao

MsgBox CommError, 16
Case 6 'Overflow, causado principalmente par erro na calibrayao

MsgBox CalError, 16
Case 11 'Division by zero, causado principalmente por erro na calibrayao

MsgBox CalError, 16
End Select
PowerOn = False
PowerLight.BackColor = &amp;amp;HCOCOCO
WdgTimer.Enabled = False

Resume Next
NoError2:
End Sub

Sub Command1_Click 0
'Trata erro

On Error GoTo Erro
'Define 0 caracter TAB

TB = Chr$(9)
'Pae um "\" se 0 caminho nao tem

If Dir1.Path = "c:\" Then
File_Name.Text = Dir1.Path + File_Name.Text

Else
File_Name.Text = Dir1.Path + "\" + File_Name.Text

End If
'Seleciona a vari&lt;3vel para receber 0 nome do arquivo e grava os parametros da calibrayao

Select Case Files.Caption
Case "New Acquisition Data File"

N_ADF 'Chama sub-rotina
Case "Open Acquisition Data File"

O_ADF 'Chama sub-rotina
Case "Open Calibration File"

O_CF 'Chama sub-rotina
Case "Save Calibration File"

S_CF 'Chama sub-rotina
End Select
Files.Hide 'Esconde a janela de arquivos (Files)
Main.AcquFileName.Text = DAF _Name ' Mostra 0 nome do arquivo de dados

GoTo NoError
Erro:

FNF = "File not found"
10 = "I/O error. Try Again"
DNR = "Disk not readY"



PNF = "Path not found"
BFN = "Bad file name"
Select Case Err

Case 53 'File Not Found
MsgBox FNF, 16

Case 57 'I/O error
MsgBox 10,16

Case 71 'Disk not ready
MsgBox DNR, 16

Case 76 'Path not found
MsgBox PNF, 16

Case 52 'Bad file name'
MsgBox BFN, 16

End Select
Call Command2_Click 'Cancela

Resume NoError
NoError:
End Sub

Sub N_ADF 0
Static DA_File As String

OAF_Name = File_Name.Text
'Procura a extensao ".dat". Se nao ha, uma e colocada.

If InStr(1 , OAF_Name, ".") = a Then OAF_Name = OAF_Name &amp;amp; ".dat"
AC_Num = a 'Zera 0 numero de aquisir;6es feitas
Main.Acquisition_Num.Text = AC_Num 'Atualiza a janela de status

'Escreve 0 caber;alho
Open OAF_Name For Output As #1

Print #1, "Temp(C)" &amp;amp; TB &amp;amp; "pH" &amp;amp; TB &amp;amp; "02(%)" &amp;amp; TB &amp;amp; "Tu(NTU)" &amp;amp; TB &amp;amp; "Cdt(uS)" &amp;amp; TB &amp;amp;
"Prof(m)" &amp;amp; TB &amp;amp; "Hora" &amp;amp; TB &amp;amp; "Data"

Close
Main.Enabled = True 'Habilita 0 controle na janela principal
Main.SetFocus
DataView.Enabled = True

End Sub

Sub O_ADF 0
Static DAJile As String

OAF_Name_Load = File_Name.Text
Open OAF _Name_Load For Input As #1

DAJile = Input$(LOF(1), #1)
Close #1

DataViewDataTextFile.Text = DAJile 'Mostra todo 0 arquivo carregado
DataViewDataTextFile.Visible = True
Main.Enabled = True 'Habilita controle na janela principal
DataView.Enabled = True 'Habilita controle na janela de visuaiizar;ao dos dados (DataView)
DataView.SetFocus
DataView.FileData.Value = True
DataView.Caption = "Data View - " &amp;amp; OAF _Name_Load



Sub O_CF 0
Static CAL_Var_Sub(19) As String

CALF_Name = File_Name.Text
Open CALF _Name For Input As #1

CAL_ Var = Input$(LOF(1), #1)
Close #1
Main.CaIFileName.Text = CALF_Name 'Mostra 0 nome do arquivo de calibra9ao

'Le a string CAL_ Var e a separa criando as substrings relacionadas a ultima configura9ao do menu
j = 1
k = 1
i = 1
Do

i = InStr(k, CAL_ Var, II ")
CAL_Var_SubU) = Mid$(CAL_Var, k, i - k)
j = j + 1
k = i + 1

Loop Until CAL_Var_SubU -1) = "EOF"
'Faz a atribui9ao das variaveis de calibra9ao

PH_CAL 1 = Val(CAL_ Var_Sub(1))
PH_CAL2 = Val(CAL_ Var _Sub(2))
VPH1 = Val(CAL_Var_Sub(3))
PH1 = Val(CAL_Var_Sub(4))
TPH1 = Val(CAL_Var_Sub(5))
VPH2 = Val(CAL_ Var_Sub(6))
PH2 = Val(CAL_Var_Sub(7))
TPH2 = Val(CAL_ Var_Sub(8))
VTU1 = Val(CAL_Var_Sub(9))
TU1 = Val(CAL_Var_Sub(10))
VTU2 = Val(CAL_Var_Sub(11))
TU2 = Val(CAL_ Var_Sub(12))
DO_CALO = Val(CAL_Var_Sub(13))
00_ CAL 100 = Val(CAL_ Var_Sub(14))
VDOO = Val(CAL_Var_Sub(15))
VD0100 = Val(CAL __Var_Sub(16))
TOOO = Val(CAL_Var_Sub(17))
TD0100 = Val(CAL_Var_Sub(18))

Main.Enabled = True 'Habilita controle na janela principal (Main)
DataView.Enabled = True
Main.SetFocus

Sub

Sub S_CF 0
CALF _Name = File_Name.Text

'Procura pela extensao II .cal". Se nao ha, uma e colocada
If InStr(1 , CALF_Name, ".") = a Then CALF_Name = CALF_Name &amp;amp; ".cal"

'F az a concatena9Eto da variavel CAL_ Var, juntando todas as variaveis de calibra9Eto
CAL_ Var = PH_CAL 1 &amp;amp; Space(1) &amp;amp; PH_CAL2 &amp;amp; Space(1) &amp;amp; VPH1 &amp;amp; Space(1) &amp;amp; PH1 &amp;amp; Space(1) &amp;amp;

TPH1 &amp;amp; Space(1) &amp;amp; VPH2 &amp;amp; Space(1) &amp;amp; PH2 &amp;amp; Space(1) &amp;amp; TPH2 &amp;amp; Space(1) &amp;amp; VTU1 &amp;amp; Space(1) &amp;amp; TU1 &amp;amp;



Space(1) &amp;amp; VTU2 &amp;amp; Space(1) &amp;amp; TU2 &amp;amp; Space(1) &amp;amp; DO_CALo &amp;amp; Space(1) &amp;amp; DO_CAL 100 &amp;amp; Space(1) &amp;amp; VDOo &amp;amp;
Space(1) &amp;amp; VD0100 &amp;amp; Space(1) &amp;amp; TOOo &amp;amp; Space(1) &amp;amp; TO01oo &amp;amp; Space(1) &amp;amp; "EOF" &amp;amp; Space(1)

Open CALF _Name For Output As #1
Print #1, CAL_ Var

Close
Main.CaIFileName.Text = CALF_Name 'Mostra 0 nome do arquivo de calibray80

Main.Enabled = True 'Habilita contrale na janela principal (Main)
DataView.Enabled = True
Main. SetFocus

Sub

Sub Command2_ Click 0
Files.Hide
Main.Enabled = True
DataView.Enabled = True
Main.SetFocus

Sub

Sub Dir1_Change 0
File1.Path = Dir1.Path 'Atribui 0 caminho do diret6rio a lista de arquivo
Label3.Caption = Dir1.Path 'Mostra 0 caminho do diret6rio

Sub

Sub Drive1_Change 0
Dir1.Path = Drive1.Drive 'Muda 0 drive na lista de diret6rio

Sub

Sub Ext_Change 0
Files.File1.Pattern = Files.Ext.Text 'Muda a extens80 dos arquivos mostrados

Sub

Sub File1_Click 0
File_Name.Text = File1.FileName 'Mostra 0 nome do arquivo selecionado

Sub

Sub Form_Load 0
Main.Enabled = False
DataView.Enabled = False

Sub

D3. Sub-Rotinas da Janela de Visualiza.;ao dos Dados
(DATAVIEW)

Sub Command1_Click 0
Files.Ext.Text = "'.dat"
Files.File1.Pattern = Files.Ext.Text
Files.Caption = "Open Acquisition Data File"
Files.Show

End Sub



Sub Command2_Click 0
Select Case CurData.Value
Case True

Printer. Print TextHeader. Text
Printer. Print DataTextCur.Text

Case False
Printer. Print Data TextFile. Text

End Select
End Sub

Sub Command3_Click 0
DataView.Hide

End Sub

Sub CurData_ Click (Value As Integer)
DataTextCur.Visible = True
DataTextFile.visible = False
DataView.Caption = "Data View - " &amp;amp; DAF _Name

End Sub

Sub FileData_Click (Value As Integer)
DataTextCur.Visible = False
DataTextFile.Visible = True
DataView.Caption = "Data View - " &amp;amp; DAF _Name_Load

End Sub

Sub Form_Load 0
DataView.Caption = "Data View - " &amp;amp; DAF _Name
tb = Chr$(9)
Header = "Temp(C)" &amp;amp; tb &amp;amp; "pH" &amp;amp; tb &amp;amp; "02(%)" &amp;amp; tb &amp;amp; "Tu(NTU)" &amp;amp; tb &amp;amp; "Cdt(uS)" &amp;amp; tb &amp;amp; "Prof(m)" &amp;amp; tb &amp;amp;

"Hora" &amp;amp; tb &amp;amp; "Data" &amp;amp; Chr$(13) &amp;amp; Chr$(1 0)
TextHeader. Text = Header
CurData.Value = True

End Sub

Sub Command1_Click 0
'Verifica se 0 analisador esta Iigado

If PowerOn = False Then
MsgBox "Turn first the analizer on". 16



Else
'Inicia a calibrayao do padrao selecionado

Cal_Message.ForeColor = &amp;amp;HFFOOOO
Cal_Message = "Wait. .."
Select Case Disp_Buffer.Caption
Case "Buffer 1"

Timer1.Enabled = True
Case "Buffer 2"

Timer2.Enabled = True
End Select

End If
End Sub

Sub Command4_Click 0
'Termina 0 processo de calibrayao

Timer1. Enabled = False
Timer2.Enabled = False
Progress_Meter. Value = 0

'Cancela a calibrayao do padrao selecionado
Select Case Disp_Buffer.Caption
Case "Buffer 1"

PH_CAL 1 = 0
Buffer_Value.Text = 4
Cal_Message.ForeColor = &amp;amp;HFF
Cal_Message,Caption = "Buffer 1 calibration canceled"

Case "Buffer 2"
PH_CAL2 = 0
Buffer_Value.Text = 10
Cal_Message.ForeColor = &amp;amp;HFF
Cal_Message.Caption = "Buffer 2 calibration canceled"

End Select
'Atualiza a mensagem de status do pH

If PH_CAL 1 = 1 And PH_CAL2 = 1 Then
Main.pH_Status.Text = "Calibrated by 2pt"

Eiself PH_CAL 1 = 1 Then
Main.pH_Status,Text = "Calibrated by 1pt"

Else
Main.pH_Status.Text = "Uncalibrated"

End If
End Sub

Sub Timer1_ Timer ()
Static LOCAL_ VPH, DIF As Single
Static k As Integer

'Calcula a diferenya entre 0 valor atual do pH e 0 anterior
DIF = Abs(LOCAL_VPH - V(1))
LOCAL_VPH = V(1)

'Cada vez que a diferenya e menor que 0.02 0 contador k e incrementado
If DIF &amp;lt;.02 Then k = k + 1

'Quando k=1 0 0 processo de calibrayao termina
If k = 10 Then VPH1 = LOCAL_ VPH: PH1 = Val(Buffer_ Value.Text): Cal_Message.Caption = "1st Point

Calibrated": Timer1.Enabled = False: PH_CAL 1 = 1: TPH1 = TEMP k = 0
Progress,Meter.Value = k



Sub Timer2_ Timer ()
Static LOCAL_ VPH, DIF As Single
Static k As Integer

'Calcula a diferen9a entre 0 valor atual do pH e 0 anterior
DIF = Abs(LOCAL_VPH - V(1))
LOCAL_VPH = V(1)

'Cad a vez que a diferen9a e menor que 0.020 contador k e incrementado
If DIF &amp;lt;.02 Then k = k + 1

'Quando k=1 0 0 processo de calibra9ElO termina
If k = 10 Then VPH2 = LOCAL_ VPH: PH2 = Val(Buffer_ Value.Text): Cal_Message.Caption = "2nd Point

Calibrated": Timer2.Enabled = False: PH_CAL2 = 1: TPH2 = TEMP: k = 0
Progress_Meter.value = k

End Sub

D4.5 Sub-rotinas dos objetos restantes

Sub BuffeU_Click ()
Disp_Buffer.Caption = "Buffer 1"
Buffer_ Value.Text = PH1
Temp_PH_Ref.Text = TPH1

End Sub

Sub Buffer_2_Click ()
Disp_Buffer.Caption = "Buffer 2"
Buffer_ Value. Text = PH2
Temp_PH_Ref.Text = TPH2

End Sub

Sub Command3_Click ()
PH_ CAL_ WINDOW. Hide
PHWINDOW = "Closed"

'Atualiza a mensagem de status do pH
If PH_CAL 1 = 1 And PH_CAL2 = 1 Then

Main.pH_Status.Text = "Calibrated by 2pt"
Eiself PH_CAL 1 = 1 Then

Main.pH_Status.Text = "Calibrated by 1pt"
Else

Main.pH_Status.Text = "Uncalibrated"
End If

End Sub

Sub Form_Load ()
'Inicializa a janela de calibra9ElO com 0 Buffer 1

Disp_Buffer = "Buffer 1"
Buffer_Value.Text = PH1

End Sub



Sub Command1_Click ()
'Verifica se 0 analisador esta ligado

If PowerOn = False Then
MsgBox "Turn first the analizer on", 16

Else
'inicia a calibra9ElO do ponto selecionado

Cal_Message.ForeColor = &amp;amp;HFFOOOO
Cal_Message = "WaiL"
Select Case Disp_DO.Caption
Case "0%"

Timer1.Enabled = True
Case "100%"

Timer2.Enabled = True
End Select

End If
'Mostra a temperatura de refencia

Temp_DO_Ref.Text = STEMP
End Sub

Sub Command4_Click ()
'Paralisa 0 processo de calibra9Elo

Timer1.Enabled = False
Timer2.Enabled = False
Progress_Meter.Value = 0

'Cancela 0 ponto de calibra9ElO selecionado
Select Case Disp_DO.Caption
Case "0%"

DO_CALO = 0
Cal_Message.ForeColor = &amp;amp;HFF
Cal_Message.Captlon = "0% calibration canceled"

Case "100%"
DO_CAL 100 = 0
Cal_Message,ForeColor = &amp;amp;HFF
Cal_Message.Caption = "100% calibration canceled"

End Select
'Atualiza a mensagem de status do medidor de ox. dissol.

If DO_CALO = 1 And DO_CAL 100 = 1 Then
MainDO_Status.Text = "Calibrated"

Else
MainDO_StatusText = "Uncalibrated"

End If
End Sub



Sub Timer1_ Timer 0
Static LOCAL_ VDO, DIF As Single
Static k As Integer

'Calcula a diferenya entre 0 valor atual da concentrayao de DO e 0 anterior
DIF = Abs(LOCAL_ VDO - V(2))
LOCAL_ VDO = V(2)

'Cad a vez que a diferenya e men or que 0.02 0 contador k e incrementado
If DIF &amp;lt;.02 Then k = k + 1

'Quando k=1 00 processo de calibrayao termina
If k = 10 Then VDOO = LOCAL_ VDO: Cal_Message.Caption = "0% Point Calibrated": Timer1.Enabled = False:

DO_CALO = 1: TOOO = TEMP: k = 0:
Progress_MeterValue = k

End Sub

Sub Timer2_ Timer 0
Static LOCAL_ VDO, DIF As Single
Static k As Integer

'Calcula a diferenya entre 0 valor atual da concentrayao de DO e 0 anterior
DIF = Abs(LOCAL_VDO - V(2))
LOCAL_ VDO = V(2)

'Cad a vez que a diferenya e menor que 0.02 0 contador k e incrementado
If DIF &amp;lt;.02 Then k = k + 1

'Quando k=10 0 processo de calibrayao termina
If k = 10 Then VD0100 = LOCAL_VDO: Cal_Message.Caption = "100% Point Calibrated": Timer2.Enabled =

False: DO_CAL100 = 1: T00100 = TEMP: k = 0
Progress_Meter. Value = k

End Sub

D4.5 Sub-rotinas dos objetos restantes

Sub Command3_Click 0
DO_CAL_WINDOWHide
DOWINDOW = "Closed"

'Atualiza a mensagem de status do medidor de oxig. dissol.
IfDO_CALO = 1 And DO_CAL100 = 1 Then

Main.DO_Status.Text = "Calibrated"
Eiself PH_CAL 1 = 1 Then
Else

Main.DO_Status.Text = "Uncalibrated"
End If

End Sub

Sub Form_Load 0
'Inicializa a janela de calibrayao do ox. dis. com 0 ponto de 0%

Disp_DO = "0%"
End Sub
Sub Ponto_O_Click 0

Disp_DO.Caption = "0%"
Temp_DO_Ref.Text = TOOO

End Sub



Disp_DO.Caption = "100%"
Temp_DO_Ref.Text = TD0100

End Sub

Sub Ponto_O_Click 0
Disp_DO.Caption = "0%"
Temp_DO_Ref.Text = STEMP

End Sub

Sub Ponto_100_Click ()
Disp_DO.Caption = "100%"
Temp_DO_Ref.Text = STEMP

End Sub

Sub Press_Sox_Change ()
Altitude = Val(Press_Box.Text)
If Altitude&gt; 0 And Altitude &amp;lt;5000 Then

Pressure = -.08 * Altitude + 760
Else
End If
Main.Press_Status = "P=" &amp;amp; Pressure &amp;amp; "mmHg"

End Sub

Sub Form_Load ()
Load Main

End Sub

Sub Present_ Timer_Timer ()
Main.Show
Present Timer.Enabled = False

End Sub




</field>
	</doc>
</add>