<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.25011</field>
		<field name="filename">9548_RafaelTrevisanutoGuiraldello_revisada.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">
U
N

IV
ER

SI
D

A
D

E 
D

E 
SÃ

O
 P

A
U

LO
In

st
it

u
to

 d
e 

C
iê

n
ci

as
 M

at
em

át
ic

as
 e

 d
e 

C
o

m
p

u
ta

çã
o

Multiscale methods for oil reservoir simulation

Rafael Trevisanuto Guiraldello
Tese de Doutorado do Programa de Pós-Graduação em Ciências de
Computação e Matemática Computacional (PPG-CCMC)





SERVIÇO DE PÓS-GRADUAÇÃO DO ICMC-USP

Data de Depósito:

Assinatura: ______________________

Rafael Trevisanuto Guiraldello

Multiscale methods for oil reservoir simulation

Thesis submitted to the Institute of Mathematics
and Computer Sciences – ICMC-USP – in
accordance with the requirements of the Computer
and Mathematical Sciences Graduate Program, for
the degree of Doctor in Science. FINAL VERSION

Concentration Area: Computer Science and
Computational Mathematics

Advisor: Prof. Dr. Roberto Federico Ausas

USP – São Carlos
February 2019



Ficha catalográfica elaborada pela Biblioteca Prof. Achille Bassi 
e Seção Técnica de Informática, ICMC/USP, 

com os dados inseridos pelo(a) autor(a)

                                       Bibliotecários responsáveis pela estrutura de catalogação da publicação de acordo com a AACR2: 
                                       Gláucia Maria Saia Cristianini - CRB - 8/4938 
                                       Juliana de Souza Moraes - CRB - 8/6176

G965m
Guiraldello, Rafael Trevisanuto
   Multiscale methods for oil reservoir simulation
/ Rafael Trevisanuto Guiraldello; orientador
Roberto Federico Ausas. -- São Carlos, 2019.
   128 p.

   Tese (Doutorado - Programa de Pós-Graduação em
Ciências de Computação e Matemática Computacional) --
 Instituto de Ciências Matemáticas e de Computação,
Universidade de São Paulo, 2019.

   1. Porous Media. 2. Darcy Flows. 3. Robin
boundary conditions. 4. Multiscale Methods. I.
Ausas, Roberto Federico, orient. II. Título. 



Rafael Trevisanuto Guiraldello

Métodos multiescala para simulação de reservatórios de
petróleo

Tese apresentada ao Instituto de Ciências
Matemáticas e de Computação – ICMC-USP,
como parte dos requisitos para obtenção do título
de Doutor em Ciências – Ciências de Computação e
Matemática Computacional. VERSÃO REVISADA

Área de Concentração: Ciências de Computação e
Matemática Computacional

Orientador: Prof. Dr. Roberto Federico Ausas

USP – São Carlos
Fevereiro de 2019





To Ana Maria and Antonio with all the love of my heart.





ACKNOWLEDGEMENTS

I would like to thank all the people who have somehow contributed to the development of
this thesis. Firstly, I would like to thank Dr. Felipe Pereira for accepting me in this postgraduate
program and for introducing me to this research area, which was the motivation for all the
academic research that is part of this thesis. I would also like to thank my academic advisor
Dr. Roberto Ausas for all the cooperative work, always friendly and helpful with feedback and
insightful ideas in the development of this research.

In order to develop this work a range of basic knowledge was essential, and in this sense
I thank Dr. Gustavo Buscaglia, Dr. Roberto Ausas and Dr. Fabricio Sousa for all the knowledge
transmitted in the graduate disciplines. Here a special thanks to Dr. Gustavo Buscaglia for the
care to direct my studies on related topic to my research project whenever possible within these
disciplines.

I would like to thank the Institute of Mathematical and Computer Sciences (ICMC) and
the University of São Paulo (USP) for all the resources and facilities offered for the developments
of this research. Thanks also to the University of Texas at Dallas (UT-Dallas) for making its
facilities available, where part of this work was developed in an internship under the supervision
of Dr. Felipe Pereira, which I thank for the academic collaboration during this period and for
contributing immensely in my stay in the city of Dallas.

I would also like to thank the Center for Applied Mathematical Sciences for Industry
(CEPID - CeMEAI) through Dr. José Cuminato for the financial support in my participation in
international congresses, thus contributing to the dissemination of my results.

I had the opportunity to work in collaboration with Dr. Felipe Pereira, Dr. Roberto Ausas,
Dr. Fabricio Sousa and Dr. Gustavo Buscaglia through the development of this project and in the
development of academic articles whom I thank for the scientific collaboration, always with a
friendly and cooperative atmosphere, contributing to my development as a scientist.

Finally, I would like to thank my parents, Ana Maria and Antonio, and also my lifemate
Vanessa for all the love and support, without you none of this would be possible.





“Therefore the problem is not so much, to see what nobody has yet seen,

but rather to think concerning that which everybody sees, what nobody has yet thought..”

(Arthur Schopenhauer)





RESUMO

GUIRALDELLO, R. T. Métodos multiescala para simulação de reservatórios de petróleo.
2019. 130 p. Tese (Doutorado em Ciências – Ciências de Computação e Matemática Computaci-
onal) – Instituto de Ciências Matemáticas e de Computação, Universidade de São Paulo, São
Carlos – SP, 2019.

Nesta tese é proposto um método misto multiescala visando a aproximação precisa de campos
de velocidade e pressão em meios porosos altamente heterogêneos, o método Multiscale Robin
Coupled Method (MRCM). Este procedimento é baseado em um novo método de decomposição
de domínio no qual os problemas locais são definidos com condições de contorno de Robin. O
método permite a definição independente de espaços de interface para pressão e fluxo sobre
o esqueleto da decomposição que pode ser escolhida com grande flexibilidade para acomodar
características locais dos campos de permeabilidade subjacentes. Simulações numéricas são
apresentadas visando ilustrar várias características do novo método. Ilustramos a possibilidade
de recuperar a solução multiescala de dois métodos bem conhecidos da literatura, a saber, o Mul-
tiscale Mortar Mixed Finite Element Method (MMMFEM) e o Multiscale Hybrid-Mixed (MHM)
Finite Element Method por escolhas adequadas do parâmetro ? nas condições da interface de
Robin. Os resultados mostram que a precisão do MRCM depende da escolha deste parâmetro
algorítmico, bem como da escolha dos espaços de interface. Uma extensa avaliação numérica do
MRCM é conduzida com dois tipos de espaços de interface, os usuais espaços polinomiais por
partes e os espaços informados, este último obtidos a partir da redução de dimensionalidade de
conjutos de espaços de snapshots. Diferentes distribuições de incógnitas entre pressão e fluxo
são exploradas. Os resultados mostram que ? , adequadamente adimensionalizado, pode ser
fixado em unidade para evitar qualquer indeterminação no método. Além disso, com ambos
os tipos de espaços, observa-se que uma distribuição equilibrada de incógnita entre pressão
e fluxo nas interfaces torna o MRCM bastante atraente tanto em precisão quanto em custo
computacional, competitivo com outros métodos multiescala da literatura. As soluções MRCM
são, em geral, apenas globalmente conservativas. Dois procedimentos de pós-processamento são
propostos para recuperar a conservação local dos campos de velocidade multiescala. Investiga-
mos a aplicabilidade de tais métodos em campos de permeabilidade altamente heterogêneos na
modelagem do transporte de contaminantes na subsuperfície. Esses métodos são comparados a
um procedimento padrão da literatura. Os resultados indicam que os métodos propostos têm o
potencial de produzir resultados mais precisos do que o método padrão com custo computacional
similar ou reduzido.

Palavras-chave: Meio porosos, Fluxos de Darcy, Condições de fronteira de Robin, Aproximação
multiescala, Simulação de reservatórios.





ABSTRACT

GUIRALDELLO, R. T. Multiscale methods for oil reservoir simulation. 2019. 130 p.
Tese (Doutorado em Ciências – Ciências de Computação e Matemática Computacional) – Insti-
tuto de Ciências Matemáticas e de Computação, Universidade de São Paulo, São Carlos – SP,
2019.

In this thesis a multiscale mixed method aiming at the accurate approximation of velocity and
pressure fields in heterogeneous porous media is proposed, the Multiscale Robin Coupled Method
(MRCM). The procedure is based on a new domain decomposition method in which the local
problems are subject to Robin boundary conditions. The method allows for the independent
definition of interface spaces for pressure and flux over the skeleton of the decomposition
that can be chosen with great flexibility to accommodate local features of the underlying
permeability fields. Numerical simulations are presented aiming at illustrating several features
of the new method. We illustrate the possibility to recover the multiscale solution of two well-
known methods of the literature, namely, the Multiscale Mortar Mixed Finite Element Method
(MMMFEM) and the Multiscale Hybrid-Mixed (MHM) Finite Element Method by suitable
choices of the parameter ? in the Robin interface conditions. Results show that the accuracy
of the MRCM depends on the choice of this algorithmic parameter as well as on the choice of
the interface spaces. An extensive numerical assessment of the MRCM is conduct with two
types of interface spaces, the usual piecewise polynomial spaces and the informed spaces, the
latter obtained from sets of snapshots by dimensionality reduction. Different distributions of
the unknowns between pressure and flux are explored. The results show that ? , suitably non-
dimensionalized, can be fixed to unity to avoid any indeterminacy in the method. Further, with
both types of spaces, it is observed that a balanced distribution of the interface unknowns between
pressure and flux renders the MRCM quite attractive both in accuracy and in computational
cost, competitive with other multiscale methods from the literature. The MRCM solutions are
in general only global conservative. Two postprocessing procedures are proposed to recover
local conservation of the multiscale velocity fields. We investigate the applicability of such
methods in highly heterogeneous permeability fields in modeling the contaminant transport in
the subsurface. These methods are compared to a standard procedure. Results indicate that the
proposed methods have the potential to produce more accurate results than the standard method
with similar or reduced computational cost.

Keywords: Porous media, Darcy Flow, Robin boundary conditions, Multiscale approximation,
Reservoir simulation.





LIST OF FIGURES

Figure 1 – Computational domain, meshes used for discretization and relevant notation
to implement the MRCM. The blue dots are only used to visualize a possible
partition TH of the skeleton ?. They might or not be nodes to which an
interface degree of freedom is associated. . . . . . . . . . . . . . . . . . . . 47

Figure 2 – Problem setting and permeability field K(x) for the quarter of a 5–spot problem. 51

Figure 3 – Pressure and flux basis functions of local indices 1,6,11 and 16 corresponding
to subdomain ?7 when using as interface spaces UH,1 and PH,1. The velocity
field arrows are drawn without any scale applied to them in order to simply
illustrate the trend of the flow field. The maximum (red) and minimum (blue)
values of the ?’s and vector magnitude of the ?’s are also indicated. . . . . 52

Figure 4 – L2(?) norm of the difference between the MRCM solution and the MMM-
FEM and MHM solutions as a function of the algorithmic parameter ? for
the quarter of a 5-spot problem. . . . . . . . . . . . . . . . . . . . . . . . . 53

Figure 5 – Contours of pressure error and arrows of velocity error of the MRCM solution
with respect to the fine grid solution for different values of the Robin condition
parameter ? of Eq. (2.65) and different coarse interface spaces UH and PH
in the quarter of a 5-spot problem. . . . . . . . . . . . . . . . . . . . . . . 54

Figure 6 – L2(?) error norm of pressure ?p?ph?L2(?) as a function of the characteristic
coarse interface mesh size H for the second numerical example maintaining
the ratio H/h constant and considering different combinations of coarse
interface spaces UH and PH . Solution norm: ? p ?L2(?)= 1/2. . . . . . . . 56

Figure 7 – L2(?) error norm of flux ?u?uh?L2(?) as a function of the characteristic
coarse interface mesh size H for the second numerical example maintaining
the ratio H/h constant and considering different combinations of interface
spaces UH and PH . Solution norm: ? u ?L2(?)=

?
2 ? . . . . . . . . . . . . 57

Figure 8 – L2(?) error norms of pressure and flux as a function of the characteristic
coarse interface mesh size H for the second numerical example with fine
grid size h maintained constant and using UH,1 and PH,1 as interface spaces.
Solution norm: ? p ?L2(?)= 1/2, ? u ?L2(?)=

?
2 ? . . . . . . . . . . . . . . 58

Figure 9 – L2(?) error norms of pressure and flux as a function of the polynomial order
of the discrete interface spaces UH and PH . Solution norm: ? p ?L2(?)= 1/2,
? u ?L2(?)=

?
2 ? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59



Figure 10 – Relative L2(?) errors for pressures (top) and fluxes (bottom), computed
using the fine grid solution of SPE10 as a reference. Each curve shows the
results of a different slice, depicted in the right-hand side. Note that the errors
associated with the MRCM for intermediate values of ? are considerably
smaller than those associated with the MMMFEM and MHM. . . . . . . . . 61

Figure 11 – Relative pressure and flux error profiles for slice 36 as a function of ?
parameter, for different computations of the Robin condition parameter. . . 62

Figure 12 – Relative pressure and flux error profiles for slice 36 as a function of ?
parameter, for different number of subdomains. . . . . . . . . . . . . . . . 63

Figure 13 – Relative pressure and flux error profiles for slice 36 as a function of ?
parameter. The inserts show the permeability field and the subdomains
colored by the local norm L2(?i) for each subdomain ?i. . . . . . . . . . . 64

Figure 14 – Relative pressure and flux error profiles for slice 36 as a function of ?
parameter, or different permeability contrast Kmax/Kmin. . . . . . . . . . . 66

Figure 15 – Computational domain decomposition and oversampling regions. . . . . . . 75

Figure 16 – Effect on ? position for L = h (solid lines) and L = H (dashed lines) for a
sequence of fine mesh refinement. . . . . . . . . . . . . . . . . . . . . . . 79

Figure 17 – Relative pressure errors (top) and relative flux errors (bottom) for a collection
of SPE10 layers with L = H. . . . . . . . . . . . . . . . . . . . . . . . . . 80

Figure 18 – Relative pressure error as function of ? for layers 33,46,42 and 45 with 5
dof ’s. Solid lines: polynomial spaces; Dashed lines: informed spaces, for the
MRCM formulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81

Figure 19 – Relative flux error as function of ? for layers 33,46,42 and 45 with 5 dof ’s.
Solid lines: polynomial spaces; Dashed lines: informed spaces, for the
MRCM formulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 82

Figure 20 – Pressure solution for the optimal global ? and interface spaces with 5 dof ’s
for polynomials and the fine pressure solution for layer 36. . . . . . . . . . 83

Figure 21 – Streamlines for the optimal global ? and interface spaces with 5 dof ’s for
polynomials and the fine solution for layer 36. . . . . . . . . . . . . . . . . 83

Figure 22 – Relative pressure error as function of ? for layers 30,63,67 and 75 with 4
dof ’s. Solid lines: polynomial spaces; Dashed lines: informed spaces, for the
MRCM formulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84

Figure 23 – Relative flux error as function of ? for layers 30,63,67 and 75 with 4 dof ’s.
Solid lines: polynomial spaces; Dashed lines: informed spaces, for the
MRCM formulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85

Figure 24 – Absolute pressure error for the optimal global ? and interface spaces with 5
dof ’s for polynomial and informed interface spaces for layer 36. . . . . . . 86

Figure 25 – Absolute flux error for the optimal global ? and interface spaces with 5 dof ’s
for polynomial and informed interface spaces for layer 36. . . . . . . . . . . 87



Figure 26 – Relative pressure and flux error for all the SPE10 layers considering k = 4
and polynomial functions to build the interface spaces. . . . . . . . . . . . . 88

Figure 27 – Relative pressure and flux error for all the SPE10 layers considering k = 4
and informed functions to build the interface spaces. . . . . . . . . . . . . . 88

Figure 28 – Relative pressure and flux error for all the SPE10 layers considering k = 5
and polynomial functions to build the interface spaces. . . . . . . . . . . . . 89

Figure 29 – Relative pressure and flux error for all the SPE10 layers considering k = 5
and informed functions to build the interface spaces. . . . . . . . . . . . . . 89

Figure 30 – Number of GMRES iterations to convergence for all the SPE10 layers with
k = 5. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90

Figure 31 – Relative pressure and flux errors and number of GMRES iterations, indi-
cated below the labels, to convergence for different domain decomposition
geometries,indicated at top of each graph with the number of unknowns being
solved in parenthesis, for the layer 36 with k = 5. . . . . . . . . . . . . . . 91

Figure 32 – Permeability field used to illustrate the behavior of the multiscale method. . 96

Figure 33 – Multiscale solutions produced by the MRCM method considering different
values of the Robin condition parameter: ? = 10?6 (top), ? = 1 (middle),
? = 106 (bottom). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 97

Figure 34 – The computational domain along with the fine grid discretization and the
domain decomposition adopted. . . . . . . . . . . . . . . . . . . . . . . . . 99

Figure 35 – The Patch method. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104

Figure 36 – Examples of patch definitions for the Stitch method. Overlapping domains
with non-simplicial mesh (left) and non-overlapping domains with simplicial
mesh (right). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106

Figure 37 – The Stitch method. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 107

Figure 38 – Concentration at time t = 0.5 for the fine solution and multiscale solution
with k = 2. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 111

Figure 39 – Relative concentration errors for k = 2,3,4 and two domain decomposition:
4×4 (left column) and 8×8 (right column) for the downscaling schemes,
the Mean (red line), the Patch (green line) and the Stitch (blue line). . . . . 112

Figure 40 – Relative errors of the Patch (left) and the Stitch (right) for different patch
sizes and the relative error of the Mean scheme (red line). . . . . . . . . . . 113

Figure 41 – Relative velocity field error to the maximum absolute velocity value of the
fine solution w/o downscaling. . . . . . . . . . . . . . . . . . . . . . . . . 113

Figure 42 – Examples of permeability fields generated by the log-conductivity functions
with different seeds. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114

Figure 43 – Relative mean error µ at each time t for the permeability fields K j(x), j =
1,...,100, and the maximum standard deviation ? over t. Shaded area
denotes the maximum and minimum error region. . . . . . . . . . . . . . . 115



Figure 44 – Examples of permeability fields from SPE10 project: layer 20 (top) and layer
36 (bottom). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 116

Figure 45 – Concentrations at breakthrough time for the fine solution (top) and the multi-
scale solution with k = 4 and the Stitch scheme (bottom) for layer 36. . . . . 117

Figure 46 – Maximum relative error over t of the downscaling schemes, the Mean (red
line), the Patch (green line) and the Stitch (blue line) for all layers of the
SPE10 project. The dashed line indicates where the layers with channels
begins. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 117

Figure 47 – Maximum relative errors over time t of the MRCM, MMMFEM and MHM
for the log-normal field (left column) and the Layer 36 (right column) for
enriched interface spaces. . . . . . . . . . . . . . . . . . . . . . . . . . . . 119



LIST OF TABLES

Table 1 – Expected convergence rates of the L2(?) norm of the error for the MMMFEM
and MHM formulations when polynomial spaces of degree ` = 0 or 1 are used
on the skeleton ?. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55

Table 2 – Order reduction for the multiscale solutions of the first numerical experiment. 110
Table 3 – Mean µ errors and the standard deviation ? of the SPE10 layers. . . . . . . . 116
Table 4 – Order reduction obtained by the multiscale method by enriching the interface

spaces. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118
Table 5 – Convergence order on concentration for the multiscale methods in two types

of permeability fields. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 120





LIST OF ABBREVIATIONS AND ACRONYMS

2LM Two-Lagrange Multiplier Method

MHM Multiscale Hybrid-Mixed Finite Element Method

MMMFEM Multiscale Mortar Mixed Finite Element Method

MRCM Multiscale Robin Coupled Method

MsFEM Multiscale Finite Element Method

MuMM Multiscale Mixed Method

VMM Variational Multiscale Method





CONTENTS

1 INTRODUCTION . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
1.1 The Darcy flow problem . . . . . . . . . . . . . . . . . . . . . . . . . . 26
1.2 Multiscale methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
1.2.1 Domain decomposition schemes . . . . . . . . . . . . . . . . . . . . . 29
1.2.2 Fine mesh discretization schemes . . . . . . . . . . . . . . . . . . . . . 31
1.2.3 A multiscale method . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
1.3 Outline . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33

2 THE MULTISCALE ROBIN COUPLED METHOD FOR FLOWS
IN POROUS MEDIA . . . . . . . . . . . . . . . . . . . . . . . . . . 35

2.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36
2.2 Numerical scheme . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38
2.2.1 The domain decomposition formulation . . . . . . . . . . . . . . . . . 38
2.2.2 The multiscale formulation . . . . . . . . . . . . . . . . . . . . . . . . 43
2.2.3 The multiscale implementation . . . . . . . . . . . . . . . . . . . . . . 44
2.2.3.1 Multiscale basis functions and the interface linear system . . . . . . . . . . 46
2.3 Numerical experiments . . . . . . . . . . . . . . . . . . . . . . . . . . . 48
2.3.1 The quarter of a 5-spot - Relation between methods . . . . . . . . . 50
2.3.2 Problem with a manufactured solution - Convergence assessment . 52
2.3.3 The importance of the Robin condition parameter . . . . . . . . . . 58
2.4 Concluding remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65

3 INFORMED SPACES FOR THE MULTISCALE ROBIN COUPLED
METHOD IN RESERVOIR SIMULATION . . . . . . . . . . . . . . 69

3.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69
3.2 The Multiscale Robin Coupled Method . . . . . . . . . . . . . . . . . 72
3.2.1 Discrete variational formulation . . . . . . . . . . . . . . . . . . . . . . 72
3.3 Interface spaces: Polynomial and informed . . . . . . . . . . . . . . . 74
3.4 Numerical experiments . . . . . . . . . . . . . . . . . . . . . . . . . . . 77
3.4.1 The characteristic length scale . . . . . . . . . . . . . . . . . . . . . . 78
3.4.2 Comparison of multiscale mixed methods . . . . . . . . . . . . . . . . 78
3.5 Concluding remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 88



4 VELOCITY POSTPROCESSING SCHEMES FOR THE MULTISCALE
ROBIN COUPLED METHOD FOR CONTAMINANT TRANSPORT
IN SUBSURFACE FLOWS . . . . . . . . . . . . . . . . . . . . . . . 93

4.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 93
4.2 The Multiscale Robin Coupled method . . . . . . . . . . . . . . . . . 98
4.3 The velocity postprocessing schemes . . . . . . . . . . . . . . . . . . 103
4.3.1 The Patch method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104
4.3.2 The Stitch method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106
4.4 Numerical set-up . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108
4.5 Numerical Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 109
4.5.1 First approach . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 110
4.5.2 Robustness . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114
4.5.3 Comparison of multiscale methods . . . . . . . . . . . . . . . . . . . . 117
4.6 Concluding remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118

5 MAIN RESULTS AND FUTURE WORK . . . . . . . . . . . . . . . 121
5.1 Main contributions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 121
5.1.1 Future work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 122
5.1.1.1 New informed spaces - LOD . . . . . . . . . . . . . . . . . . . . . . . . . . 122
5.1.1.2 A Multilevel MRCM . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123
5.1.1.3 3D HPC implementation . . . . . . . . . . . . . . . . . . . . . . . . . . . 123

BIBLIOGRAPHY . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 125



25

CHAPTER

1
INTRODUCTION

The computational modeling of transport phenomena in porous media still presents
major mathematical and numerical challenges and is, therefore, a current research topic of
interest both in academia and industry. Such type of problems have a remarkable complexity
that requires multiphysics and multiscale approach. Among the relevant phenomena that need
to be considered are: (i) the fluid flow includes various phases such as oil, gas, and water, (ii)
the presence of chemical reactions and phase transitions in which thermodynamics, energy,
and mass transport must be considered, (iii) the heterogeneity on the properties of the porous
medium such as permeability, porosity as well as mechanical properties such as geological faults
and fractures at different scales need to be taken into account, (iv) the coupling between fluid
transport and rock deformation, (v) the spatial and temporal multiscale nature of the phenomena
being considered, ranging from the micropore scale to kilometer scales spatially and from the
scale of the few seconds, due to rapid geological events or production, due to human intervention,
to scales of many years temporally. On top of everything mentioned, (vi) the high uncertainty
on the physical and material properties of the porous medium and the initial and the boundary
conditions to be applied in order to solve the problem. The uncertainty in the determination of
the coefficients of the governing equations on reservoir flow problems implies that deterministic
predictions for this class of problems are of limited use. In general, the properties of the medium
can be characterized statistically, defining quantities like the mean and covariance (GELHAR,
1993; GELHAR, 1989; ZHANG; LU, 2004) to carry out uncertainty quantification studies
(SMITH, 2013; LAW; STUART; ZYGALAKIS, ; GINTING; PEREIRA; RAHUNANTHAN,
2014) which are the key concept to realistically estimate the expected error in the numerical
predictions. However, in these studies, thousands of individual simulations typically involving
several million or even billions of unknowns each need to be performed. It is clear here the need
for the development of high-performance simulators together with robust and accurate numerical
methods to allow such simulations to be made in a feasible time with high precision.

Depending on each of the above mentioned cases, different mathematical models are



26 Chapter 1. Introduction

needed to describe the different physical phenomena. Among these, the Darcy model is a basic
ingredient and the development and analysis of efficient numerical schemes to approach this
model is the central theme of this thesis. The solution to the porous media problem is not
only relevant in the simulation of oil and gas reservoirs, but also in other applications such as
contaminant transport in aquifers, the capture of CO2, the storage of nuclear waste and also in
resin injection processes in industry, just to name a few.

Excellent references that describes in detail the mathematical and numerical treatment of
the above themes can be found in (CHAVENT; JAFFRÉ, 1986; TRANGENSTEIN; BELL, 1989b;
TRANGENSTEIN; BELL, 1989a; CHEN, 2007; CHEN, 2005; CHEN; HUAN; MA, 2006;
COUSSY, 2010; HOU; WU, 1997; EFENDIEV; HOU, 2008; DURLOFSKY; GERRITSEN,
2006) among others.

In the next sections we introduce the mathematical problem to be handled as well as the
key concepts for a multiscale approximation of the problem.

1.1 The Darcy flow problem
Consider the single-phase incompressible case with no effects of gravity, for simplicity

(see (CHEN; HUAN; MA, 2006)). The problem for the pressure p and the velocity u based on
Darcy’s law is given by:

? ·u = f in ? (1.1)

u =?K ?p in ? (1.2)

p = gD on ?D (1.3)

u ·n = gN on ?N (1.4)

?? u ·n + p = gR on ?R (1.5)

where ? ?Rd , d = 2 or 3 is the problem’s domain, K is a symmetric, uniformly positive definite
tensor with components in L?(?), u is the fluid velocity, p is the pressure, f ? L2(?) the
source/sink terms, gD, gN and gR are the pressure boundary data, the normal velocity data and the
Robin boundary condition data, respectively, where ? is positive function defined on ?R and n is
the outer normal vector to ? ?. Eq. (1.1) is the mass conservation equation and Eq. (1.2) is the
Darcy law. The extension to the multiphase case, i.e., problems in which two or more fluids are
present can be seen, for example, in (CHAVENT; JAFFRÉ, 1986; CHEN; HUAN; MA, 2006).

Consider now the following spaces

W = L2(?), V = H(div,?) e VgN ={v ? V; v·n = gN on ?N}

where
H(div,?) =

{
q ? L2(?)d ; ?·q ? L2(?)

}
.



1.2. Multiscale methods 27

The mixed variational formulation of problem (1.1-1.5) is given by: Find u ? VgN and p ?W ,
such that:?

?

K?1u·v +
?
?R

? (u·n)(v·n)?
?

?

p?·v = ?
?

?D

gDv·n?
?
?R

gR v·n ?v ? V0?
?

?·u w =
?

?

f w ?w ?W,
(1.6)

where we assume that gD and gR are regular enough so that problem (1.6) is well posed
(see (KöNNö; SCHOETZAU; STENBERG, 2011)). Note that the pressure and Robin boundary
condition happens to be introduced in a natural way in formulation (1.6), that is why in the
context of finite elements these conditions are called the natural boundary conditions. On the
other hand, the flux boundary condition needs to be included in the test space VgN and is called
an essential boundary condition. Formulation (1.6) involves the divergence of the solution and
test functions, but not arbitrary first order derivatives. This allow us to work with H(div,?), i.
e., a space spanned by polynomial vectors by parts that are only required to have their normal
components to be continuous, an important fact for the finite element approximation of this
problem.

1.2 Multiscale methods

The direct simulation of the three-dimensional problem (1.6) in the reservoir scale taking
into account the spatial scales of permeability K can result in very large discrete problems,
involving up to billions of unknowns to produce a consistent approximation. To resolve this issue
and incorporate the fine-scale information in the numerical simulations, in the context of methods
based on variational formulations, two lines of work have appeared: The multiscale finite element
methods (MsFEM) and variational multiscale methods (VMM). Although the methods have
been introduced separately, similarities, and in some cases equivalences, are observed.

The basic idea in the multiscale finite element method was introduced by Babuska and
Osborn in (BABUSKA; OSBORN, 1983). In this work, the concept of generalized basis functions
was introduced, where local problems are solved at element level and fine-scale information is
introduced into the solution. From here, the idea was generalized and extended to numerous
problems.

As mentioned by Aarnes in (AARNES, 2006), the work of Hou and Wu (HOU; WU,
1997) was one of the first to recognize the potential on these methods to solve two and three-
dimensional elliptic problems with coefficients that exhibit high spatial variations, both in the
context of Darcy’s problem and compositive material problems in solid mechanics. In the case of
an elliptic problem with 2D periodic coefficients the multiscale solution was proved to converge
to the solution of the problem according to the homogenization theory. In the linear case, the
solution of local problems can be done in an offline stage and the basis functions used a posteriori



28 Chapter 1. Introduction

to solve a global problem. In the nonlinear case, this can not be done in principle, but the
methodology still has advantages because the solution of all local problems can be performed
much more efficiently (e.g., in parallel) when compared to the complete solution of the problem
in the fine mesh.

Similarly, multiscale variational methods were introduced for the purpose of capturing
fine scale phenomena. The method was originally proposed by Hughes in (HUGHES, 1995;
HUGHES et al., 1998). Considering an abstract problem L (u) = f (+ boundary conditions),
the idea to separate the scales in the associated variational problem is to split the search and
test spaces as direct sum of the function space for the large scales V? and a space for the fine
scales V ?. The solution is then written as the sum of a part that will be solved numerically via
a finite element method plus a part that will be solved "analytically" (or in practice by some
localization process) to incorporate the effect of fine scales, i.e., the solution u ?V = V? ?V ?,
u = u? + u?, u? ? V? , u? ?V ?. The problem to be solved for u? in the fine scale uses the residual of
the differential equation in the large scale given by L (u?)? f . From here the method has been
applied and extended to several areas. A full and detailed description of this type of method
can be found in the references cited above. One of the interesting aspects to be considered is
the relation of the method with several formulations of stabilized finite elements, providing a
general and formal framework for its development.

Applications of the mixed and mixed-hybrid forms were studied later in both cases as
can be seen, for example, in (CHEN; HOU, 2003; ARBOGAST et al., 2007; ARBOGAST,
2004) among others. Extension for the finite volume formulations were also considered (see
(JENNY; LEE; TCHELEPI, 2003; LUNATI; JENNY, 2006; LEE; ZHOU; TCHELEPI, 2009;
HAJIBEYGI; TCHELEPI, ; BOSMA et al., 2017)). It is worth mentioning here the interesting
work of (KIPPE; AARNES; LIE, 2008) where these and other methods are compared in terms
of accuracy.

The focus of this thesis is on the multiscale finite element methods based on domain
decomposition (DD) schemes in which the domain ? is decomposed into non-overlapping
subdomains ?i,i = 1,...,m and local problems are solved in each ?i, due to their potential
to solve efficiently elliptic problems with rapidly varying coefficients in parallel multi-core
computers.

To describe such type of MsFEM, consider problem (1.1-1.5) but now, for simplicity,
with only pressure boundary conditions, given by

?·u = f in ?
u = ?K ? p in ?
p = gD in ? ?

. (1.7)

To produce a multiscale approximation of the above problem one need:

? A domain decomposition scheme;



1.2. Multiscale methods 29

? A discrete solver for the Darcy problem.

In the next sections we recall these concepts, then we use then to produce an example of
a multiscale method.

1.2.1 Domain decomposition schemes

In the study of transport in porous media a consistent approximation of the solution
of differential equations, such as (1.7), usually requires a fine enough mesh to capture the
spatial variation in small scales of the coefficient K, leading to large linear systems involving
several millions or even billions unknowns, as mentioned earlier. Solving such a type of system
directly implies an extremely high computational cost and/or processing time. To reduce such a
computational burden, domain decomposition methods becomes an interesting alternative. The
domain decomposition methods are a set of "divide and conquer" schemes used to find numerical
solutions of partial differential equations, mainly elliptic and parabolic, that can be classified
according to the choice of the domain partition as overlapping and non-overlapping methods.
In (QUARTERONI; VALLI, 1999) and (MATHEW, 2008) there is a complete discussion on
such type of methods. In this work we focus on non-overlapping methods due to its natural
parallelization. In such type of methods, the domain ? is decomposed into non-overlapping
subdomains {?i}, i = 1,...,m and local problems are solved in each ?i. At the so-called skeleton
? of the partition (the union of all internal interfaces ?i, j = ?i ?? j) compatibility conditions
need to be satisfied, i.e.,

ui ·ni + u j ·n j = 0 , (1.8)

pi ? p j = 0 , (1.9)

for the collection of local solutions {ui, pi} to be a solution of (1.7).

By restricting problem (1.7) to the subdomains ?i results in the domain decomposition
problem given by: Find ui ? V? and pi ?W?

?·ui = f in ?i
ui = ?K ?pi in ?i
pi = gD on ? ?i ?? ?

pi = p j
.
= pi j on ?i j

ui ·ni =?u j ·n j .= Ji j on ?i j

, (1.10)

where V? and W? are adequate spaces. We assume that f is regular enough such that problems
(1.7) and (1.10) are equivalent.

We now want to formulate a set of local problems in ?i equivalent to problem (1.10). For
this we must satisfy two conditions. Firstly, the restrictions of ui and pi must satisfy each local



30 Chapter 1. Introduction

problem. Secondly, every local problem should be well posed. We now need to define a coupling
strategy between subdomains. Different subdomain coupling strategies were extensively studied
during the last years. An overview of these studies is described, for example, in (LIONS, 1990;
CHEN et al., 2011; COWSAR; WHEELER, 1991).

Consider the following strategy: Find ui ? V? , pi ?W? and ? ? M, for i = 1,..,m, such
that

? ·ui = f i in ?i
ui = ?K ? pi in ?i
pi = gD on ? ?i ?? ?
pi = ? on ?i

(1.11)

that satisfy
ui ·ni + u j ·n j = 0 on ?i j,i ?= j. (1.12)

where ?i = ? ?i ?? and M is a suitable interface space. That is, we have defined the
local problems (1.11) by given a unique pressure boundary condition ? defined over ?. Note
that, by doing so, we are automatically satisfying condition (1.9) and is left for us to a find the
unique pressure in ? that satisfy condition (1.8), i.e., the jump on the normal component of the
velocity in ?, as described in Eq. (1.12).

If one choose appropriate function spaces, we can multiply the above equations by test
functions (including the jump restriction) and obtain the following variational problem: Find
ui ? V? , pi ?W? and ? ? M, for i = 1,..,m, such that

?
?i

K?1ui ·v?
?

?i
pi?·v +

?
?i

? v·ni =
?

? ?i??D gDv·n
i ?v ? V??

?i
? ·ui w =

?
?i

fi w ?w ?W?
?

m
i=1
?

?i
µ ui ·ni = 0 ?µ ? M

, (1.13)

which is a mixed-hybrid variational formulation that is well posed if the involved spaces are

V? =
n?
i

Vi, W? =
n?

i=1

L2(?i),

M =
{

µ ? H1/2(?), µ|? ? (Vi ·ni)?
}
,

where
Vi = H(div; ?i),

where (·)? denotes the dual space.

This formulation was originally proposed by (GLOWINSKI; WHEELER, 1988) as a
domain decomposition method combined with mixed finite elements and is the basis for the
multiscale formulation of (ARBOGAST et al., 2007; GANIS; YOTOV, 2009). Other possible



1.2. Multiscale methods 31

options using the compatibility Eq.(1.8) - (1.9) is to define local problem with flux boundary
conditions leading to the problem of satisfy the pressure jumps in ?. This method is explored
in (BERNARDI; MADAY; PATERA, 1994; BELGACEM, 1999) for the primal variational
formulation and is the basis of the multiscale method of (HARDER; PAREDES; VALENTIN,
2013; ARAYA et al., 2013). One can also consider a linear combination of the compatibility
conditions, leading to local problems defined with Robin boundary conditions type, a possibility
explored in (DOUGLAS et al., 1993; LOISEL, 2013) that is the basis of the multiscale method
of (FRANCISCO et al., 2014; GUIRALDELLO et al., 2018b).

1.2.2 Fine mesh discretization schemes

We are interested in numerical approximations of Darcy problems like (1.7), i.e., to
approximate a pressure p and a velocity u with the requirement that the velocity field preserves
the property of being continuous on every element of the triangulation and has continuous normal
component between adjacent elements. A velocity field of this type is called a mass conservative
and is appropriate to solve the governing transport equations of different scalar fields, such as
concentrations of passive tracers in the linear case to saturation fields in nonlinear cases.

Mass conservative formulations are essential to avoid the spurious creation/destruction of
fluid, and thus, to accurately predict the long-term evolution (days or even years of physical time)
of a reservoir. For problem (1.7), we have this property when we consider its mixed variational
formulation and ask for its solution in discrete subspace of V = H(div,?), i.e., given a regular
mesh Th of ?? in T elements, an approximation in finite elements consist in choose discrete
subspaces Vh ? H(div,?) and Wh ?W = L2(?) and solve the following problem:
Find uh ?Vh ? V and ph ?Wh ?W such that:?

?

K?1uh ·vh ?
?

?

ph? ·vh = ?
?

?D

gDvh ·n ?vh ? Vh?
?

? ·uh wh =
?

?

f wh ?wh ?W
. (1.14)

The most popular discrete spaces that satisfy this property are the Raviart-Thomas
(RT) (RAVIART; THOMAS, 1977) and Brezzi-Douglas-Marini (BDM) (BREZZI; DOUGLAS;
MARINI, 1985) spaces. Different formulations using these discrete spaces can be found in
(RAVIART; THOMAS, 1977; NEDELEC, 1980; BREZZI et al., 1987b; BREZZI et al., 1987a;
ARBOGAST et al., 2000; DOUGLAS et al., 1993) and their citations, and the books of (BREZZI;
FORTIN, 1991; ROBERTS; THOMAS, 1991; QUARTERONI; VALLI, 1999).

In addition to finite element methods, finite volume methods are of interest because
they are very popular in the industry and there is a complete range of codes available that can
solve complete problems, including the multiphase nonlinear case, which can be used in the
development of multiscale methods. The equivalence between these methods can be established
for several cases (see (CHAVENT; JAFFRÉ, 1986; EYMARD; GALLOUËT; HERBIN, 2000;



32 Chapter 1. Introduction

RUSSEL; WHEELER, 1983; ARBOGAST; WHEELER; YOTOV, 1997; VOHRALÍK, 2006;
BARANGER; MAITRE; OUDIN, 1996) and references therein).

1.2.3 A multiscale method

Now we put together the above ingredients and describe a multiscale method to approxi-
mate problem (1.7). Let us start by recalling the domain decomposition variational formulation
(1.13) given by: Find ui ? V? , pi ?W? and ? ? M, for i = 1,..,m, such that

?
?i

K?1ui ·v?
?

?i
pi?·v +

?
?i

? v·ni =
?

? ?i??D gDv·n
i ?v ? V??

?i
? ·ui w =

?
?i

fi w ?w ?W?
?

m
i=1
?

?i
µ ui ·ni = 0 ?µ ? M

. (1.15)

To discretize this problem, consider a triangulation Th of ? ? Rd,d = 2,3, into d-
dimensional simplexes. From this, consider a conform partition of ? into m subdomains ?i,
such that each simplex T ? Th belong to one and only one subdomain and define Th,i as the
triangulation correspondent to ?i.

For each ?i, consider the lowest-order Raviart-Thomas spaces for velocity and pressure
given by Vih = RT0(?i) and W

i
h =

{
w ? L2(?i),w(x)|T ?P0)

}
. As we have a global conform

mesh, it naturally induces a unique partition in the skeleton ?. Consider the space given by

Fh(Sh) ={ f : Sh ?R | f |e ? P0 , ?e ? Sh}, (1.16)

in which Sh is any set o faces/edges of Th. Notice that Fh(? ?i) is the space of normal traces of
Vih. Let ?h be the set of all faces/edges over ? and define Mh = Fh(?h).

The multiscale method reads as: Find uih ? V
i
h, p

i
h ? W

i
h and ?H ? MH ? Mh for each

i = 1,...,m, such that:

?
?i

K?1uih ·v?
?

?i
pih ?·v +

?
?i

?H v·ni = ?
?

? ?i??D gD v·ni ?v ? V
i
h?

?i
?·uih w =

?
?i

f w ? w ?W ih
?

m
i=1
?

?i
uih ·n

i
µ = 0 ?µ ? MH

. (1.17)

The above multiscale method is nothing but a particular case of the MMMFEM (see
(ARBOGAST et al., 2000; ARBOGAST et al., 2007)). Notice that the first two equation of (1.17)
accounts for the local problem in {?i} where the local meshe Th,i are fine enough to capture the
small scale variations in the permeability without any approximation (or upscaling) of K. These
are small problems when compared to the global problem in ? and are usually solved in parallel.
By choosing a low-dimensional space MH ? Mh, all local problems can be uncoupled, leaving us
to find the interface pressure ?H ? MH that solves the third equation of (1.17), which accounts
for the flux jump between subdomain in a weak sense and couples the subdomain solutions,
reducing the number of unknowns to NP, the dimension of MH = span{?1,...,?NP}. If one take



1.3. Outline 33

MH = Mh, we retrieve the domain decomposition method of (GLOWINSKI; WHEELER, 1988)
in which for the above defined spaces has a unique solution equivalent to the non-decomposed
problem (m = 1).

1.3 Outline
This thesis is mainly composed of scientific articles co-authored by the thesis’s author

produced in the development of this doctoral project and organized as chapters. Thus, each
chapter contains its own introduction and conclusion regarding the scope of the article. In
addition, the thesis has an introductory chapter and a closing chapter highlighting the main
contributions and is organized as follows:

? Chapter 1 describes the background and purpose of this thesis.

? In Chapter 2 a multiscale mixed method aiming at the accurate approximation of velocity
and pressure fields in heterogeneous porous media is proposed. This chapter is based on
the publication "The Multiscale Robin Coupled Method for porous media flows"(MRCM)
(GUIRALDELLO et al., 2018b).

? Chapter 3 presents an extensive numerical assessment of the MRCM, exploring the
flexibility of the method in order to increase its accuracy. This chapter is based on the
following publication "Interface spaces for the Multiscale Robin Coupled method in
reservoir simulation" (GUIRALDELLO et al., 2018a).

? Chapter 4 presents two new downscaling (or postprocessing) procedures to recover local
conservation and compatibility of the velocity field at fine grid level. These new procedures
are compared with an usual procedure in multiscale solutions produced by global con-
servative multiscale methods and evaluated in the case of passive tracers. This chapter is
based on the manuscript "Velocity postprocessing schemes for the Multiscale Robin Cou-
pled method for contaminant transport in subsurface flows" submitted to the a renowned
international journal.

? Chapter 5 summarizes the main result obtained and discuss future works.





35

CHAPTER

2
THE MULTISCALE ROBIN COUPLED

METHOD FOR FLOWS IN POROUS MEDIA

A multiscale mixed method aiming at the accurate approximation of velocity and pressure
fields in heterogeneous porous media is proposed. The procedure is based on a new domain
decomposition method in which the local problems are subject to Robin boundary conditions. The
domain decomposition procedure is defined in terms of two independent spaces on the skeleton
of the decomposition, corresponding to interface pressures and fluxes, that can be chosen with
great flexibility to accommodate local features of the underlying permeability fields. The well-
posedness of the new domain decomposition procedure is established and its connection with the
method of Douglas et al., Numer. Math., 65(1):95–108, 1993, is identified, also allowing us to
reinterpret the known procedure as an optimized Schwarz (or Two-Lagrange-Multiplier) method.
The multiscale property of the new domain decomposition method is indicated, and its relation
with the Multiscale Mortar Mixed Finite Element Method (MMMFEM) and the Multiscale
Hybrid-Mixed (MHM) Finite Element Method is discussed. Numerical simulations are presented
aiming at illustrating several features of the new method. Initially we illustrate the possibility of
switching from MMMFEM to MHM by suitably varying the Robin condition parameter in the
new multiscale method. Then we turn our attention to realistic flows in high-contrast, channelized
porous formations. We show that for a range of values of the Robin condition parameter our
method provides better approximations for pressure and velocity than those computed with either
the MMMFEM and the MHM. This is an indication that our method has the potential to produce
more accurate velocity fields in the presence of rough, realistic permeability fields of petroleum
reservoirs.



36 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

2.1 Introduction
Multiscale formulations of the porous media equations have been developed over the last

twenty years motivated by the practical needs of the energy and environmental sectors. High-
resolution permeability data are generated by geologists and hydrologists from seismic data,
pointwise sampling and statistical models. These data are highly heterogeneous, with no scale
separation, so that simplifications of the model by rigorous homogenization techniques cannot
be applied. Reservoir simulators thus resort to numerical multiscale methods to obtain coarsened
models (with much fewer degrees of freedom) that nevertheless incorporate the fine-grid details
of the permeability field.

Consider the single-phase porous media problem

u = ?K ?p in ? (2.1)

?·u = f in ? (2.2)

p = g on ? ?p (2.3)

u·n = z on ? ?u (2.4)

where ? ?Rd , d = 2 or 3 is the problem’s domain, K is a symmetric, uniformly positive definite
tensor with components in L?(?), u is the fluid velocity, p is the pressure, f ? L2(?) the source,
g ? H

1
2 (? ?p) the pressure boundary data, z ? H?

1
2 (? ?u) the normal velocity data and n is the

outer normal to ? ?.

Of the multiscale formulations available in the literature, the focus here is on those
based on domain decomposition (DD) techniques, in which the domain ? is decomposed into
non-overlapping subdomains {?i}, i = 1,...,m and local problems are solved in each ?i. At
the so-called skeleton ? of the partition (the union of all interfaces ?i, j = ?i ?? j) compatibility
conditions need to be satisfied, i.e.,

ui ·n?i + u j ·n? j = 0 , (2.5)

pi ? p j = 0 , (2.6)

for the collection of local solutions {ui, pi} to be a solution of (2.1)-(2.4).

The finite element literature shows two main DD-based multiscale formulations: MMM-
FEM and MHM.

The first one, introduced by Arbogast and co-authors (ARBOGAST et al., 2007), is
based on the mixed formulation of (2.1)-(2.4) and its discretization by div-stable elements
in each subdomain. It is known as MMMFEM, for Multiscale Mortar Mixed Finite Element
Method. The local problems have pressure boundary conditions at each ? ?i ??. The Lagrange
multiplier ? that enforces the continuity of fluxes across ? is nothing but the interface pressure
p|?. This procedure is turned into a multiscale formulation by restricting ? to belong to a suitable
low-dimensional space ?H , where H refers to the size of the partition. Inside each subdomain,



2.1. Introduction 37

velocity and pressure are approximated with fine-grid spaces Vih ×Q
i
h, where h is the size of the

fine grid, assumed much smaller than H. In MMMFEM the pressure compatibility condition
(2.6) is satisfied (weakly) at the fine-grid level, whereas the flux compatibility condition (2.5) is
relaxed to ?

?

(
ui ·n?i + u j ·n? j

)
µH = 0 , ?µH ? ?H . (2.7)

As a consequence, there is a lack of accuracy in flux conservation at ? that takes place even if
the numerical scheme inside each subdomain is exactly conservative (such as RTk or BDMk
finite elements (RAVIART; THOMAS, 1977; BREZZI; DOUGLAS; MARINI, 1985), or finite
volume schemes). Cures for this crucial problem have been sought through post-processing
(SILVA; LOULA, 2002; CORREA; LOULA, 2007) or downscaling techniques (JENNY; LEE;
TCHELEPI, 2003; FRANCISCO et al., 2014).

The Multiscale Hybrid-Mixed Finite Element Method (MHM), on the other hand, was
introduced by Harder et al in 2013 (HARDER; PAREDES; VALENTIN, 2013; ARAYA et
al., 2013) and starts from the mortar formulation as introduced by Bernardi and co-workers in
(BERNARDI; MADAY; PATERA, 1994) and Belgacem in (BELGACEM, 1999). In MHM the
local problems have flux boundary conditions, i.e., ui ·n?i is assigned the value of an unknown
Lagrange multiplier ? at ? ?i ??. A fine-grid is used in each subdomain as in the MMMFEM,
but in the case of the MHM formulation it is the flux ? that is restricted to belong to a coarse
space ?H , yielding a field ?H that approximates the flux across ?. As a consequence, (2.5) is
(weakly) satisfied with fine-grid accuracy, whereas pi ? p j is only enforced to satisfy?

?

(pi ? p j)?H = 0 , ??H ? ?H . (2.8)

The drawback is a lack of accuracy in the pressure compatibility condition (2.6).

The MHM formulation is more involved than the MMMFEM formulation because
one has to deal with the non-existence of solution of the local problems unless the imposed
boundary flux values at each ? ?i exactly balance the source term integrated over ?i. The
practical implementation adds one global unknown per subdomain, a constant-pressure mode,
increasing the dimension of the global interface problem to dim(?H)+ m.

In this context it is natural to look for methods that combine the good properties of
the two formulations described above, in which the error in satisfying (2.5)-(2.6) is distributed
over the two equations, trying to find a convenient compromise between the flow conservation
properties of the MHM method and the simplicity of the MMMFEM.

In this article, we elaborate on the formulation known as Multiscale Mixed Method
(MuMM) (FRANCISCO et al., 2014), which is based on a domain decomposition technique
introduced by Douglas et al (DOUGLAS et al., 1993). The local problems are subject to Robin
boundary conditions on ?, which are generally written as

??i ui ·n?i + pi = gR (2.9)



38 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

where ?i is the Robin condition parameter and gR the prescribed value. As in the original
MuMM, we assume that a global fine mesh Th exists and that the subdomains are obtained
by partitioning Th into m regions {?i} of size H, much larger than h. A discrete multiscale
variational formulation is introduced for the MuMM allowing its generalization to arbitrary
interface spaces, a possibility that was not studied in the original publication. The proposed
method, named Multiscale Robin Coupled Method (MRCM) is then compared to the MMMFEM
and MHM, which are shown to be limit cases of the MRCM as ? ? 0 and ? ? ?, and suitable
values of the Robin condition parameter are identified.

2.2 Numerical scheme

Domain decomposition methods are usually presented by first introducing the formulation
at the continuous level and then approximating it by a finite-dimensional counterpart arising, for
example, from finite elements. In the case of Robin interface conditions, as noted by Douglas et al
(DOUGLAS et al., 1993), the trace spaces of the continuous problem are unclear so that interface
integrals can only be written formally, without rigorous justification. To avoid this theoretical
setback, we present the new domain decomposition formulation directly in the discrete case,
assuming a structured fine mesh of lowest-order Raviart-Thomas element RT0 and a diagonal
mobility tensor, which up to a quadrature error is equivalent to the most popular cell-centered
finite volume method. This domain decomposition formulation is interesting in itself, especially
due to its connections with Douglas et al’s iterative scheme (DOUGLAS et al., 1993) and with
the Optimized Schwarz and Two-Lagrange-Multiplier methods (LOISEL, 2013).

2.2.1 The domain decomposition formulation

Let Th be a subdivision of the domain ? ?Rd into a Cartesian mesh of d-dimensional
rectangles. From this mesh, a partitioning of ? is made into subdomains {?i}i=1,...,m, such
that each rectangle K ? Th belongs to one and only one of the subdomains. The submesh
corresponding to ?i is denoted by T ih .

On each ?i we define the lowest-order Raviart-Thomas spaces for velocity and pressure,

Vih = {v ? H(div,?i) , v j(x)|K = p j1(x1)p j2(x2)... ,?K ? T
i

h ,

with p jk ? P1 if j = k , p jk ? P0 if j ?= k } (2.10)

Qih = {q ? L
2(?i) , q(x)|K ? P0} , (2.11)

where Pk is the space of polynomials of degree ? k. Because the submeshes are a partition of a
unique div-conformal mesh, the space of normal traces of {Vih} onto the skeleton ? is uniquely
defined. Let Sh be any subset of edges/faces of Th (e.g., ?), then we define

Fh(Sh) ={ f : Sh ?R | f |e ? P0 , ?e ? Sh} . (2.12)



2.2. Numerical scheme 39

Notice that Fh(? ?i) is the space of normal traces of Vih. We assume that ? ?u and ? ?p coincide
with subsets of Th ?? ? and introduce

Vihy = {v ? V
i
h , v·n? = y on ? ?i ?? ?u} , (2.13)

where we have assumed that y belongs to Fh(? ?u) (if not, it should be replaced by its projection).
Now, let Eh be the set of all faces/edges of Th contained in ?. On each face/edge e ? Eh we also
introduce a unique normal n?, which is the exterior normal to ? ? if e ? ? ?, and if e belongs to
some ?i, j ? ? then it is defined as the unit normal exterior to the subdomain with smallest index,
min{i, j}.

We need to define spaces for pressure and fluxes at subdomain interfaces:

Ph = Fh(Eh) (2.14)

Uh = {Vh ? Fh(Eh) | Vh = 0 on Rh} (2.15)

where Rh is the set of edges in Eh which have ? = 0 on both sides. When discussing matters not
connected to the boundary conditions, the discrete spaces Vihz and V

i
h0 will be denoted generically

by Vih. The (global) direct product of the subdomain spaces V
i
h and Q

i
h will be denoted by Vh

and Qh, respectively,
Vh = ?mi=1 V

i
h , Qh = ?

m
i=1 Q

i
h . (2.16)

The discrete variational formulation we consider is the following: Let U and P be
arbitrary subspaces of Uh and Ph, respectively. Find (uih, p

i
h) ? V

i
hz×Q

i
h, for i = 1,...,m, and

(U,P) ? U ×P such that

(K?1uih,v)?i ?(p
i
h,?·v)?i +(P??iU n?

i ·n? + ?i uih ·n?
i,v·n?i)? ?i?? = ?(g,v·n?

i)? ?i?? ?p ,

(2.17)

(q,?·uih)?i = ( f ,q)?i , (2.18)
m

?
i=1

(uih ·n?
i,M)? ?i?? = 0 , (2.19)

m

?
i=1

(?i (uih ·n?
i ?U n?·n?i),V n?i ·n?)? ?i?? = 0 , (2.20)

hold for all (v,q) ? Vih0 ×Q
i
h , ?i = 1,...,m , for all M ? P and for all V ? U . A weak

imposition of the boundary flux conditions on ? ?u could also be considered.

Let us explain the conceptual basis for this formulation. Notice first that, if ?i = 0 for all
i, then (2.20) reduces to 0 = 0 and the formulation is simply the Mortar Mixed Finite Element
Method (GLOWINSKI; WHEELER, 1988; ARBOGAST et al., 2000), P being the Lagrange
multiplier on ?, which has the physical interpretation of a pressure. Clearly, the unknown U is
completely undetermined if all ?i’s are zero. Now consider ?i &gt; 0. Considering P and U known,
Eq. (2.17) is a discretization of (2.1) in subdomain ?i with Robin boundary condition

p??i u·n?i = P??i U n?·n?i . (2.21)



40 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

With respect to the case ?i = 0, we have a new unknown U , so that the problem is not closed
by adding just the flux-continuity equation (2.19). The required additional equation, that in fact
determines U , comes from requiring pressure continuity weakly. From (2.21) we see that

p? i
def
= P??i U n? ·n?i + ?i uih ·n?

i (2.22)

is a recovered boundary pressure for ?i. It is then natural to impose pressure continuity weakly
at an interface ?i, j as

(P??i U n?·n?i + ?i uih ·n?
i,V n? ·n?i) = (P?? j U n? ·n? j + ? j u

j
h ·n?

j,V n?·n?i) , ?V ? U . (2.23)

Cancelling out P, and using n? j =?n?i one arrives at (2.20). It is interesting to notice that (2.20)
implies

U|?i, j = ?U
?iuih ·n? + ? ju

j
h ·n?

?i + ? j
, (2.24)

where ?U stands for the L2-projection onto U . A connection may be established with the
decomposition methods proposed in (LEIVA; BLANCO; BUSCAGLIA, 2010; BLANCO;
LEIVA; BUSCAGLIA, 2013) which also introduce two unknown fields per interface for the
coupling.

Proposition 1. The solution ({uih, p
i
h},U,P) to the discrete formulation (2.17)-(2.20) is unique

in ?mi=1(V
i
hz ×Q

i
h)×U ×P.

Proof. Assume g = z = f = 0, take v = uih in (2.17), q = p
i
h in (2.18), M = ?P in (2.19) and

V =?U in (2.20). Adding up all the resulting equations one gets
m

?
i=1

[
(K?1uih,u

i
h)?i +?

?
?i (uih ·n??U)?

2
? ?i??

]
= 0 . (2.25)

From this one concludes that uih = 0 for i = 1,...,m, and that U = 0. We are thus left with

(pih,? ·v)?i = (P,v·n?
i)? ?i?? , ?v ? V

i
h0 , ?i , (2.26)

to prove that pih = 0 and that P = 0. Take v such that v · n?
i = 0 on ? ?i and such that ? ·v =

pih ?Di, where Di is the mean of p
i
h over ?i. Then

?
?i

pih(p
i
h ?Di) = 0 which implies that

pih = Di, constant per subdomain. Inserting this into (2.26) and integrating by parts one gets
(Di ?P,v · n?i)? ?i?? = 0, which implies Di = P on ? ?i ?? because (since P ? Ph) P|? ?i??
belongs to the normal trace space of V ih0. The fact that P is constant over each ? ?i ?? for all i
implies that P = C, a constant over the whole of ?. This then allows to conclude that pih = C for
all i. Going back once again to (2.26), now with P = pih = C, taking v as the restriction to ?i of
any w ? Vh0 ?H(div,?) and then adding over all subdomains one finally obtains

C
?

? ?p

w·n? = 0 , ?w ? Vh0 ?H(div,?) .

If ? ?p consists of at least one edge of Th this implies C = 0.



2.2. Numerical scheme 41

Remark 1. It is noteworthy that the well-posedness of the MRCM formulation does not require
any compatibility condition between the spaces U and P. In fact, U does not even need to be a
subspace of Uh. The situation for P is different, since in the proof one needs a compatibility
condition between P and Vih to conclude, from (Di ?P,v · n?

i)? ?i?? = 0, that Di = P. This
compatibility condition is nothing but the usual inf-sup condition of the mixed mortar method,

inf
0?=P?P

sup
v?Vih0

(
P,v·n?i

)
? ?i??

&gt; 0 ,

which in the proposed formulation is automatically satisfied because P ? Ph.

We now show that the proposed formulation is indeed a domain decomposition method,
i.e., it yields the same solution as the non-decomposed formulation if U = Uh and P = Ph.

Proposition 2. Let ({uih, p
i
h},Uh,Ph) be the solution of the discrete formulation (2.17)-(2.20)

with U = Uh and P = Ph, and let (uh, ph) ? (Vhz ?H(div,?))×Qh be the solution of the
non-decomposed discrete problem (m = 1), which satisfies

(K?1uh,v)? ?(ph,?·v)? = ?(g,v·n?)? ?p , (2.27)

(q,?·uh)? = ( f ,q)? , (2.28)

for all v ? Vh0 ?H(div,?) and all q ? Qh.

Then, assuming ?i to be constant on each edge of Eh ?? ?i,

uih = uh|?i (2.29)

pih = ph|?i (2.30)

Uh = uh ·n? on ??Rh (2.31)

Proof. Let us show that (uh, ph), restricted to each subdomain, satisfies (2.17)-(2.20). Because
uh ? H(div,?) we know that u?ih

def
= uh|?i satisfies (2.19). This implies, from the assumption on

?i, that U?h
def
= u?ih ·n? satisfies (2.20) and the two terms containing ?i cancel out in (2.17).

Because (u?ih, p?
i
h) is the restriction to ?i of the global solution (uh, ph), there exists a

unique P?ih in the restriction of Ph to ? ?i ?? such that

(K?1u?ih,v
i)?i?(p?

i
h,?·v

i)?i +(P?
i
h,v

i·n?i)? ?i?? =?(g,v
i·n?i)? ?i?? ?p , ?v

i ? Vih0 . (2.32)

Adding over subdomains we get
m

?
i=1

[
(K?1u?ih,v

i)?i ?(p?
i
h,? ·v

i)?i +(g,v
i ·n?i)? ?i?? ?p

]
+

m

?
i=1

(P?ih,v
i ·n?i)? ?i?? = 0 . (2.33)

Take now vi = v|?i , with v ? Vh0 ?H(div,?) an element of the unbroken global velocity space.
From the definition of u?ih such v

is make the first sum in (2.33) to vanish, and so

(
vi ·n?i + v j ·n? j = 0 , ? ?i, j

)
?

m

?
i=1

(P?ih,v
i ·n?i)? ?i?? = 0 .



42 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

This can only happen if P?ih = P?
j

h on every ?i, j, and thus a single-valued P?h ? Ph can be defined
that makes (2.17) to hold. The uniqueness of solution for (2.17)-(2.20) makes uih = u?

i
h, p

i
h = p?

i
h,

Uh = U?h and Ph = P?h.

Remark 2. If all ?i are positive, then Ph = Uh = Fh(Eh). Denoting

?
i
h = Ph|? ?i?? ??i Uh|? ?i?? n?·n?

i , (2.34)

then one has, for any ?i, j ? ?,

Ph =
? j?

i
h + ?i?

j
h

?i + ? j
, Uhn? ·n?i =

?
j

h ??
i
h

?i + ? j
. (2.35)

Using this, formulation (2.17)-(2.20) can be rewritten as: Find (uih, p
i
h,?

i
h) ? V

i
hz×Q

i
h×

Fh(Eh ?? ?i), for i = 1,...,m, such that

(K?1uih,v)?i ?(p
i
h,?·v)?i +(?i u

i
h ·n?

i,v·n?i)? ?i?? +(?
i
h,v·n?

i)? ?i?? = ?(g,v·n?
i)? ?i?? ?p ,

(2.36)

(q,? ·uih)?i = ( f ,q)?i , (2.37)
m

?
i=1

(uih ·n?
i,Mh)? ?i?? = 0 , (2.38)

m

?
i=1

(?i uih ·n?
i + ? ih,Vh n?

i ·n?)? ?i?? = 0 , (2.39)

hold for all (v,q) ? Vih0 and for all (Mh,Vh) ? Fh(Eh)×Fh(Eh).

This can be identified as the variational formulation that underlies the domain decom-
position algorithm proposed by Douglas et al (DOUGLAS et al., 1993). In fact, their iterative
algorithm assumes a red-black colouring of the subdomains with an initial value of ? ih for all red
?i’s. This allows to solve (2.36)-(2.37) for uih and p

i
h. Then (2.38)-(2.39) are considered at all

interfaces ?i, j, where ? j is a black subdomain, which yield the update formula for ?
j

h as

?
j

h = ?
i
h + ?i u

i
h ·n?

i ?? ju
j
h ·n?

j = ? ih +(?i + ? j)u
i
h ·n?

i .

The process can then be iterated switching the roles of the black and red subdomains.

Remark 3. Equations (2.36)-(2.39) also provide the variational formulation of the so-called Two-
Lagrange-Multiplier (2LM) method, or Optimized Schwarz method (LOISEL, 2013; LOISEL;
NGUYEN; SCHEICHL, 2015; MADAY; MAGOULÈS, 2006). The ? ih, of which there exist
two at each edge of each internal interface ?i, j, are the two Lagrange multipliers that give the
method its name (notice that in our formulation there is no unknown shared by more than two
subdomains).

The 2LM formulation (2.36)-(2.39) may be seen as more concise, and perhaps more
elegant, than the proposed (equivalent if U = P = Fh(Eh)) formulation (2.17)-(2.20). The latter



2.2. Numerical scheme 43

is however more powerful, since the separate roles of the interface pressure Ph and of the interface
flow Uh can be clearly identified. As explained in the next section, this allows for the design of
multiscale formulations with different spaces for P and U , which is not possible if the start
point is (2.36)-(2.39).

2.2.2 The multiscale formulation

Multiscale variants of domain decomposition formulations, such as the MMMFEM and
the MHM method, follow the strategy of creating two discretization scales by restricting the
Lagrange multiplier space, which roughly speaking is Fh(Eh) in the fine grid, to a much coarser
space defined at a scale H ? h. Usually, H is the size of the individual subdomains.

Take for example the Mortar Mixed Finite Element Method (GLOWINSKI; WHEELER,
1988; ARBOGAST et al., 2000), which is nothing but our DD formulation (2.17)-(2.20) with
P = Ph and ?i = 0 for all i. In this case, one obtains the fine grid solution, whereas taking
P = PH (a coarse subspace of Ph) one obtains its multiscale version, the MMMFEM. Similarly,
the MHM method is obtained from the Mortar Method (BELGACEM, 1999) by taking a coarse
subspace UH for the Lagrange multiplier, which in this case is U . Notice that the Mortar Method
is (intuitively) the limit of our DD formulation when ?i ?+?, which makes the unknown P to
disappear.

Following the same strategy, the multiscale approach we propose simply consists of
taking coarse spaces U = UH and P = PH in (2.17)-(2.20) while keeping the fine-scale
spaces Vih for velocity and Q

i
h for pressure inside each ?i. Let us follow the tradition and give

a name to the proposed method. Be it Multiscale Robin Coupled method, MRCM, which as
shown in Prop. 1 yields a well–posed discrete problem with the sole condition that PH ? Ph
(see Remark 1).

When the interface spaces are coarsened, the computational cost is greatly alleviated
in both calculations and message passing operations. The solution is certainly quite different
from that computed on the fine mesh, unless the interface subspaces happen to approximate very
well the fine mesh solution. A unique feature of MRCM is that coarse spaces for both interface
pressure and flux can be chosen arbitrarily, while MMMFEM only allows the user to select PH
and MHM only allows to select UH .

Piecewise polynomial interface spaces were the first to be explored in multiscale formu-
lations (GANIS; YOTOV, 2009; HARDER; PAREDES; VALENTIN, 2013) and are the ones
implemented in this work, since they are easy to code and allow for rigorous analysis. More
precisely, our interface spaces UH and PH are projections of piecewise polynomial spaces
onto Fh(Eh). For highly heterogeneous media a convenient alternative to piecewise polynomial
spaces are informed spaces, in which fine-mesh solutions are precomputed at some neighborhood
(oversampling) of each interface ?i, j, and from them some reduction technique is applied to



44 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

build PH and/or UH . This alternative has been explored recently by Chung et al (CHUNG;
FU; YANG, 2016) for the MMMFEM, while it remains unexplored for the MHM method. The
assessment of the MRCM with informed spaces is however left for future work.

2.2.3 The multiscale implementation

This section provides details on the implementation of the Multiscale Robin Coupled
Method. The way followed to describe our implementation shares similarities to that used by
Ganis and Yotov for the Multiscale Mortar Mixed Finite Element method in (GANIS; YOTOV,
2009). Referring to Fig. 1, let us consider a non-overlapping domain decomposition of ? into
subdomains ?i, i = 1,...,m. Also consider associated to the skeleton ? of this decomposition,
a partition denoted by TH (see Fig. 1 to visualize a possible partition of the skeleton) and to
this partition coarse–scale spaces UH and PH for fluxes and pressure, respectively. Though
not strictly necessary (see Remark 1), both UH and PH are taken as subspaces of Fh(Eh). This
simplifies the coding and garantees, because PH ? Ph = Fh(Eh), that the discrete problem is
well posed. As said, the size of the partition H is typically much larger than h, therefore the
dimension of these subspaces is small as compared to that of Fh(Eh) as depicted in Fig. 1.

In order to explain the implementation, let us suppose at this stage (UH,PH)? UH ×PH
known. This way, we can rewrite the local problems on each subdomain as: Find (uih, p

i
h) ?

Vihz ×Q
i
h, for i = 1,...,m, such that

(K?1uih,v)?i ?(p
i
h,?·v)?i +(?i u

i
h ·n?

i,v·n?i)? ?i?? = ?(PH ??iUH n?
i ·n?,v·n?i)? ?i??

?(g,v·n?i)? ?i?? ?p , (2.40)

(q,? ·uih)?i = ( f ,q)?i , (2.41)

hold for all (v,q) ? Vih0 ×Q
i
h , ?i = 1,...,m . Now, we perform an additive decomposition of

the solution (uih, p
i
h) as

uih = u?
i
h + u?

i
h, (2.42)

pih = p?
i
h + p?

i
h. (2.43)

On the one hand, (u?h, p?h)? Vihz×Q
i
h satisfies the subdomain problems with interface values UH

and PH equal to zero and nonzero forcing terms, that is

(K?1u?ih,v)?i ?(p?
i
h,?·v)?i +(?i u?

i
h ·n?

i,v·n?i)? ?i?? = ?(g,v·n?
i)? ?i?? ?p , (2.44)

(q,?·u?ih)?i = ( f ,q)?i , (2.45)

hold for all (v,q) ? Vih0 ×Q
i
h , ?i = 1,...,m . On the other hand, (u?

i
h, p?

i
h)? V

i
h0 ×Q

i
h satisfies

the subdomain problems with forcing terms f and g identically equal to zero

(K?1u?ih,v)?i ?(p?
i
h,?·v)?i +(?i u?

i
h ·n?

i,v·n?i)? ?i??, = ?(PH ??iUH n?
i ·n?,v·n?i)? ?i??

(2.46)

(q,?·u?ih)?i = 0, (2.47)



2.2. Numerical scheme 45

hold for all (v,q) ? Vih0 ×Q
i
h , ?i = 1,...,m .

The local problems above, like (2.40)–(2.41) or any other considered in the rest of the
article can be solved by choosing any standard discrete spaces for Vih0 and Q

i
h. In this article

we restrict ourselves to the two dimensional case and the lowest order Raviart-Thomas space
RT0 on quadrilateral cartesian grids of uniform cell size h (see Fig. 1). As known, the choice of
this space and a combination of the midpoint and the trapezoidal rules for numerical integration
produces a discrete system which only involves pressure unknowns and that is equivalent to a
classical cell–centered finite volume method (see (ARBOGAST; WHEELER; YOTOV, 1997)
for instance).

Let us provide some details of the final algebraic equations that are generated by problem
(2.40)–(2.41) for our choice of finite element and mesh. We denote the pressure unknowns,
located at the cell centers, by ph,I,J and the flux unknowns, located at the faces midpoints, by
uh,I±1/2,J (for horizontal faces) or uh,I,J±1/2 (for vertical faces). Assuming K to be elementwise
constant, Eq. (2.40) translates into the following two-point formulas for any internal edge of the
mesh:

uh,I+1/2,J =?K?I+1/2,J
ph,I+1,J ? ph,I,J

h
, uh,I?1/2,J =?K?I?1/2,J

ph,I,J ? ph,I?1,J
h

,

uh,I,J+1/2 =?K?I,J+1/2
ph,I,J+1 ? ph,I,J

h
uh,I,J?1/2 =?K?I,J?1/2

ph,I,J ? ph,I,J?1
h

.

(2.48)

The indices I and J above run through all fine scale cells of the local problems, and the K?’s
are the harmonic means of the permeabilities at interelement faces, for example, K?I+1/2,J =
2 KI,J KI+1,J/(KI,J + KI+1,J). Turning to Eq. (2.41), for each fine scale cell it translates into

h
(
uh,I+1/2,J ?uh,I?1/2,J + uh,I,J+1/2 ?uh,I,J?1/2

)
= h2 fI,J. (2.49)

As for the treatment of boundary conditions, those of the flux type are imposed directly by
replacing the right hand side of the corresponding flux expression (Eq. (2.48)) by the prescribed
value at boundary edges, which is consistent with the definition of V ihy in Eq. (2.13).

For boundary edges subject to pressure conditions Eq. (2.48) can be rewritten as

uh,I?1/2,J =?KI,J
pI,J ??I?1/2,J

h/2
(2.50)

where ?I?1/2,J is a face pressure which is set to the prescribed value. The case of a Robin
boundary condition, given as in (2.9), also leads to Eq. (2.50), but with the value of ?I?1/2,J now
replaced by

?I?1/2,J = gR + ?i uh ·n?
i = gR ??i uh,I?1/2,J (2.51)

Though Eqs. (2.50) and (2.51) are specific to a West boundary, they readily extend to the others.

Inserting Eqs. (2.48) or (2.50) into (2.49) one ends up with a linear system only involving
pressure unknowns. Suitable modifications of the scheme that deal with anisotropic (tensorial)



46 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

permeability coefficients can be found in (ARBOGAST; WHEELER; YOTOV, 1997). More
sophisticated finite volume methods, known as Multipoint Flux Approximations (MPFA) are
discussed in, for example, (VOHRALÍK, 2006).

Let us now turn to the next ingredient of the implementation, namely the construction
of the coarse discrete spaces UH and PH . Their respective finite element basis are denoted by
{? j}1? j?nU and {?

j}1? j?nP , so that the unknowns UH and PH are written as

UH =
nU

?
`=1

XU` ?
`, PH =

nP

?
`=1

X P` ?
` , (2.52)

where nU = dim(UH) and nP = dim(PH). By considering Eqs. (2.19)-(2.20) that corresponds to
weak flux and pressure continuity on ?, now posed on the coarse scale H, we may simultaneously
solve for all fields and subdomains. However, it is possible to eliminate the internal subdomain
degrees of freedom, thus solving a relatively small system for the interface unknowns alone. This
is accomplished by building multiscale basis functions on the different subdomains as explained
next.

2.2.3.1 Multiscale basis functions and the interface linear system

We define multiscale basis functions by solving certain local problems in each subdomain.
First, we need to introduce some notation. Let us define the global vector of interface unknowns
X ? Rn, n = nU + nP, X =

(
XU ,X P

)T
, XU =

(
XU1 ,...,X

U
nU

)
and X P =

(
X P1 ,...,X

P
nP

)
. For sub-

domain ?i, i = 1,...,m, let us also define J i as the set of indices of global interface degrees of
freedom associated to basis functions for UH and PH whose support is on the boundary ? ?i??.
The multiscale basis functions in ?i, denoted here as {?ik j ,?

i
k j
}1?k j?ni , being ni = |J

i| (the
number of elements in J i) and k j = 1,...,ni a local subdomain numbering of the unknowns
corresponding to global indices j ? J i, are obtained as solutions of problem (2.46)-(2.47) as
follows. For j ? J i, if 1 ? j ? nU , basis function k j of subdomain ?i is obtained by solving the
local problem with boundary data UH = ? j, PH = 0, i.e., find (?ik j ,?

i
k j
) ? Vih0 ×Q

i
h, such that

(K?1?ik j ,v)?i ?(?
i
k j ,? ·v)?i +(?i ?

i
k j ·n?

i,v·n?i)? ?i?? = (?i?
jn?i ·n?,v·n?i)? ?i??,

(2.53)

(q,?·?ik j )?i = 0, (2.54)

hold for all (v,q) ? Vih0 ×Q
i
h, whereas, if nU &amp;lt;j ? nU + nP, subdomain basis function k j

is obtained by solving the local problem with boundary data UH = 0, PH = ? j?nU , i.e., find
(?ik j ,?

i
k j
) ? Vih0 ×Q

i
h, such that

(K?1?ik j ,v)?i ?(?
i
k j ,?·v)?i +(?i ?

i
k j ·n?

i,v·n?i)? ?i?? = ?(?
j?nU ,v·n?i)? ?i??,

(2.55)

(q,? ·?ik j )?i = 0, (2.56)



2.2. Numerical scheme 47

? = ?0(p)? Uh ? F(Eh) p ?Pk(e)

Exterior to ?i

n?

n?i

Exterior to ?min{i, j}

Th

? ?

?

TH(?)

?1

? j=5

n?i

n?i

n?i

n? n?

n?

n?
? j=7

n?i

h

H

?i, j
?8

?9

?3 ?4? j=2

? j=10

e ? TH(?)

I ?1/2,J I + 1/2,J

I,J?1/2

I,JI ?1,J I + 1,J

I,J + 1

I,J?1

I,J + 1/2

uh, K?

ph, f (x), K(x)

? f

?i? j

?i=6

Source: Elaborated by the author.

Figure 1 – Computational domain, meshes used for discretization and relevant notation to implement the
MRCM. The blue dots are only used to visualize a possible partition TH of the skeleton ?.
They might or not be nodes to which an interface degree of freedom is associated.

hold for all (v,q) ? Vih0 ×Q
i
h. Computation of these basis functions can be done off–line and is

naturally parallelizable.

Now, we are ready to build the interface linear system. To this end, first note that by the



48 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

linearity of the problem, the local solutions on each subdomain can be written as

u?ih = ?
j?J i

X j?
i
k j , p?

i
h = ?

j?J i
X j?

i
k j . (2.57)

Recalling the decomposition (2.42)-(2.43) and the weak flux and pressure continuity Eqs.
(2.19)-(2.20) on the coarse scale, we write

m

?
i=1

(
u?ih ·n?

i,MH
)

? ?i??
= ?

m

?
i=1

(
u?ih ·n?

i,MH
)

? ?i??
, (2.58)

m

?
i=1

(?i (u?ih ·n?
i ?Uhn?i ·n?),VH n?i ·n?)? ?i?? = ?

m

?
i=1

(?i (u?ih ·n?
i),VH n?i ·n?)? ?i??. (2.59)

Finally, by substituing (2.57) and testing with all basis functions of UH and PH we end up with
the linear system

A X = b. (2.60)

If a matrix–free method is used to solve the linear system, such as the Biconjugate Gradient
or the GMRES method, no explicit computation of the matrix coefficients becomes necessary,
otherwise, the entries of matrix A =

[
a` j
]
?Rn×n are, for j = 1,...,n

a` j =

??
??

m
i=1(?i (?

i
k j
·n?i ?? jn?i ·n?),? ` n?i ·n?)? ?i??, for 1 ? `? nU

?
m
i=1

(
?

i
k j
·n?i,?`?nU

)
? ?i??

, for nU &amp;lt;`? n
(2.61)

where ? j = ? j if 1 ? j ? nU and zero otherwise and recalling that for the i-th subdomain and for
each k j, j must belong to the set J i for the corresponding term to make sense in (2.61). As for
the right hand side vector b = [b`]?Rn, computing its entries involves the particular solutions
u?ih previously found by solving (2.44)-(2.45), yielding

b` =

??
???

m
i=1(?i (u?

i
h ·n?

i),? ` n?i ·n?)? ?i??, for 1 ? `? nU
??mi=1

(
u?ih ·n?

i,?`?nU
)

? ?i??
, for nU &amp;lt;`? n

(2.62)

Computing the integrals above is straightforward once all functions are piecewise constant on
the set of edges of Th contained in ?. Also notice that, as pointed out by Ganis and Yotov
(GANIS; YOTOV, 2009), during the resolution of the interface problem, storing the whole set
of subdomain basis functions values may lead to an unnecessary memory burden, being that
in this step only the fluxes and recovered pressure values at the edges lying on ? are required.
Consequently, the authors recommend to store only those values and after solving (2.60) perform
a last subdomain solve to find (u?ih, p?

i
h) so the final global solution can be reconstructed.

2.3 Numerical experiments
This section presents a numerical assessment of the Multiscale Robin Coupled method

and its comparison in some classical benchmark problems to the Multiscale Mortar Mixed and



2.3. Numerical experiments 49

Hybrid-Mixed Finite Element methods previously introduced. We aim to illustrate the possibility
of switching from one method to the other by suitably varying the Robin condition parameter
in the MRCM formulation and also show the possibility of choosing different (coarse) spaces
UH and PH for flux and pressure on the interface. Three test examples are addressed. First,
the classical quarter of a 5–spot problem is studied by considering a random (log normal)
permeability field of moderate variability. Second, a problem with a manufactured solution
proposed in (HARDER; PAREDES; VALENTIN, 2013) is presented in order to assess the
convergence properties of the scheme. Finally, the MRCM formulation is assessed by solving
several sections of the SPE10 benchmark with high contrast permeability fields that exhibit
channelized regions. All numerical results are restricted to the two dimensional case assuming
an isotropic diagonal permeability tensor. As for the construction of the discrete spaces UH and
PH on the interface, we will restrict ourselves in this article to the following spaces for flux and
pressure

UH = {VH, VH|e = ?0(q),q ?P`U (e), e ? TH}, (2.63)

PH = {MH, MH|e = ?0(q),q ?P`P(e), e ? TH}, (2.64)

where Pk, k = `U or `P is the space of polynomials of degree k and ?0 is the L2–projection of a
function of Pk(e) onto the space Fh(e), e ?TH , i.e., UH and PH are made up of the elementwise
constant fine grid representation of polynomials of degree k over the interface elements. These
spaces will be denoted by UH,k and PH,k from now on. In most of the numerical examples
below k is made either equal to 0 or 1. For simplicity, in the first two numerical experiments TH
is built by taking only one element per interface ?i, j between subdomains. In the third numerical
experiment we also consider the possibility of performing a simple refinement of the skeleton
partition to better illustrate the properties and versatility of the scheme. More sophisticated
choices for these spaces and other interface refinements of TH are certainly possible and
relatively easy to handle, but these are left for future work.

As for the Robin condition parameter, from dimensional analysis we can see that the
value of ?i on subdomain i in our discrete formulation should be chosen as:

?i(x) =
?(x)L
K(x)

, (2.65)

where L is a characteristic length scale that in line with (FRANCISCO et al., 2014) is chosen to
be equal to the mesh size h. The non-dimensional function ? and the permeability K are tunnable
algorithmic parameters to be selected. Different choices are possible for this parameter, such as
discontinuous or continuous functions at subdomain interfaces. A natural choice for K that is
adopted in the first two numerical examples corresponds to using the local permeability Ki(x) in
(2.65), which yields in general different parameters for each subdomain. In the third numerical
example, other options are explored, e.g., using the harmonic mean of the permeabilities between
neighboring subdomains. A comprehensive survey on the choice of ?i and the possibility of
selecting it adaptively is the subject of ongoing works.



50 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

2.3.1 The quarter of a 5-spot - Relation between methods

This first example intends to illustrate the behavior of the MRCM formulation as the
Robin condition parameter ? introduced in Eq. (2.65) is increased from very small values, where
the method behaves as the MMMFEM formulation, up to very large values, where the MRCM is
expected to behave as the MHM formulation. To this end, we consider the classical quarter of a
5-spot problem. The computational domain ? = [0,1]×[0,1] is considered with a point source
located at the top left corner and a point sink located at the bottom right corner as displayed in
Fig. 2. Boundary conditions correspond to no flow on ? ?. A heterogeneous permeability field
given by

K(x) = e? ? (x), (2.66)

is used, where ? controls the permeability contrast Kmax/Kmin which is taken to be 2455.8
in this numerical example and ? (x) is a self similar Gaussian distribution with zero mean
and covariance function C(x,y) = |x?y|?1/2. Figure 2 shows a particular realization of this
permeability field used in the simulations with a logarithmic color scale to better appreciate
the permeability contrast. The domain is decomposed into 4×4 subdomains also indicated in
the figure, each one discretized by a 16×16 (fine) grid, thus having H = 1/4 and h = H/16.
From this decomposition, subdomain basis functions {?ik j ,?

i
k j
} are computed according to the

numerical procedure explained in the previous section. At this point, it is interesting to illustrate
the behavior of such functions. Let us consider, for instance, the interface spaces UH,1 and PH,1.
For this case, Fig. 3 shows plots of four (out of sixteen) local flux and pressure basis functions for
subdomain ?7, setting the Robin condition parameter ? equal to 1. To enhance the visualization,
the velocity field arrows have been plotted without any scale applied to them in order to simply
appreciate the trend of flow field. The shape of these functions clearly reflects the complexity of
the flow as a consequence of the random permeability field being considered.

We aim now to study the behavior of the MRCM method as the Robin condition parameter
? in Eq. (2.65) is varied continuously and report the L2(?) norm of the difference between the
MRCM solution and those obtained by the MMMFEM and MHM methods, both, implemented
into independent codes as explained in (ARBOGAST et al., 2000) and (HARDER; PAREDES;
VALENTIN, 2013) respectively. For the MMMFEM, the corresponding Lagrange multiplier µH
is chosen in the coarse interface space PH,k, whereas for the MHM method, the corresponding
Lagrange multiplier ?H is chosen in UH,k.

We report pressure and flux errors using UH,0, PH,0 and UH,1, PH,1 as coarse interface
spaces in this experiment. As mentioned, a single element per interface between neighboring
subdomains is used to create the partition TH of the skeleton ?. Results are shown in Fig. 4.
This figure shows the difference between the MRCM and the MMMFEM formulations goes to
zero as the algorithmic parameter ? is reduced. Conversely, as ? is increased the solution of
the MRCM formulation becomes closer to that obtained by the MHM method. This numerical
evidence indicates the MRCM formulation changes continuously from the MMMFEM to the



2.3. Numerical experiments 51

MHM method as the Robin parameter is varied. As commented, a rigorous proof of this fact,
however, is out of the scope of the article. Figure 4 indicates that asymptotically the MRCM
approaches the MMMFEM (as ? ? 0) and the MHM (as ? ? ?) linearly with respect to the
Robin condition parameter ? . In order to further illustrate the behavior of the method, Fig. 5
shows the pressure error and arrows of the velocity field error for the MRCM formulation with
respect to the fine grid solution, for three different values of the parameter ? and the same coarse
interface spaces previously used. Clearly, results that correspond to UH,0 and PH,0 exhibit the
larger errors. Notice this error is somewhat more concentrated near subdomain boundaries in all
cases, as can be expected once the discretization has been weakened precisely at the interfaces
between subdomains. At least in this case, the MRCM method shows improved accuracy as
the Robin condition parameter is increased. However, this is not always the case as we will see
later on in the following numerical examples, which motivates the possibility of selecting ?i
adaptively in the different regions so as to switch between methods according to their accuracy
or improved performance at particular locations.

? = [0,1]×[0,1]

K(x) = e2.5 ? (x)

? (x)? Gaussian

?7

Source: f (h/2,1?h/2) = 1

Sink: f (1?h/2,h/2) =?1
Source: Elaborated by the author.

Figure 2 – Problem setting and permeability field K(x) for the quarter of a 5–spot problem.



52 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

?
7
11: min =?5.2×10

?1, max = 5.02×10?1
?

7
11: min = 9.05×10

?3, max = 1.03×101

?
7
16: min =?1.47×10

?2, max = 5.89×10?3
?

7
16: min = 7.03×10

?5, max = 3.87×10?1

?
7
6: min =?1.91×10

?2, max =?7.79×10?5
?

7
6: min = 6.07×10

?4, max = 8.28×10?1

?
7
1: min = 4.87×10

?3, max = 8.51×10?3
?

7
1: min = 1.35×10

?1, max = 4.67×101

UH = 0, PH ? constant

U
H
=

0,
P H

=
?

0
(q

1
),

q 1
?

li
ne

ar U
H
=

?
0 (q

1 ),
q

1
?

linear,
P

H
=

0

UH ? constant, PH = 0

Source: Elaborated by the author.

Figure 3 – Pressure and flux basis functions of local indices 1,6,11 and 16 corresponding to subdomain
?7 when using as interface spaces UH,1 and PH,1. The velocity field arrows are drawn without
any scale applied to them in order to simply illustrate the trend of the flow field. The maximum
(red) and minimum (blue) values of the ?’s and vector magnitude of the ?’s are also indicated.

2.3.2 Problem with a manufactured solution - Convergence assess-
ment

The second problem we consider corresponds to taking as computational domain the unit
square, the following manufactured solution for the pressure

p = cos(2? x1) cos(2? x2) (2.67)



2.3. Numerical experiments 53

L
2 (

?
)

no
rm

10?10

10?8

10?6

10?4

10?2

10?6 10?4 10?2 100 102 104 106
?

UH,0, PH,0

?p MHMh
?

p MRCh ?

?u MHMh
?u MRCh ??u

MM
MF

EM

h

?u
MR

C

h
?

?p
MM

MF
EM

h

?p
MR

C

h
?

L
2 (

?
)

no
rm

10?10

10?8

10?6

10?4

10?2

10?6 10?4 10?2 100 102 104 106
?

UH,1, PH,1

?u MHMh
?u MRCh ??u

MM
MF

EM

h

?u
MR

C

h
?

?p
MM

MF
EM

h

?p
MR

C

h
?

?p MHMh ?p MRCh ?

Source: Elaborated by the author.

Figure 4 – L2(?) norm of the difference between the MRCM solution and the MMMFEM and MHM
solutions as a function of the algorithmic parameter ? for the quarter of a 5-spot problem.

and an uniform scalar permeability field K = 1, for which f = 8 ? 2 cos(2? x1) cos(2? x2) must
be given as the source term in (2.1)-(2.4). The solution satisfies homogeneous flux boundary
conditions at all boundaries and has zero mean. From this problem we aim to assess the conver-
gence properties of the MRCM method as the algorithmic parameter ? in Eq. (2.65) is increased.
First, mesh refinement is performed such that the ratio H/h is maintained constant, this is, by
increasing the number of subdomains in each direction and simultaneously the number of fine
grid cells in the same proportion. This way, the number of fine mesh cells in each subdomain
is maintained constant. The first mesh in the sequence consists of 3×3 subdomains, each one
subdivided into a fine mesh consisting of 20×20 elements, i.e., H = 1/3 and h = H/20. The rest



54 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

UH,0, PH,0 UH,1, PH,1

? = 108

(MHM–like)

? = 1

? = 10?8

(MMMFEM–like)

Source: Elaborated by the author.

Figure 5 – Contours of pressure error and arrows of velocity error of the MRCM solution with respect to
the fine grid solution for different values of the Robin condition parameter ? of Eq. (2.65) and
different coarse interface spaces UH and PH in the quarter of a 5-spot problem.

of the meshes in the sequence are obtained by successively halving H and h. We report the L2(?)
error norms for pressure and velocity denoted respectively by ?p? ph?L2(?) and ?u?uh?L2(?)



2.3. Numerical experiments 55

as functions of the partition characteristic size H. In the limiting cases, corresponding to ? ? 0
and ? ? ?, we expect to recover respectively the convergence rates of the MMMFEM method
(ARBOGAST et al., 2000; ARBOGAST et al., 2007) and those corresponding to the MHM
method (HARDER; PAREDES; VALENTIN, 2013). These rates are summarized in table 1 for
the particular cases that interest us in this article. A few comments are in order regarding these
convergence rates: first, they assume that polynomial spaces are used on the mesh skeleton,
although it is worth recalling that we are not using polynomials, but their projections onto F(Eh),
as previously discussed. Second, for the MMMFEM formulation, the order H 2 for pressure
is a superconvergence result obtained by a duality argument in (ARBOGAST et al., 2000)
precisely when the L2(?)–norm is used to measure the errors, that is the natural norm in our
implementation. Finally, regarding the approximation properties of the local solvers, for the
MMMFEM the estimates in (ARBOGAST et al., 2000) consider a mixed formulation and for
instance RTk spaces (here, k = 0), whereas for the MHM method, according to (HARDER;
PAREDES; VALENTIN, 2013), the convergence properties of the scheme are assessed by using
an elliptic solver at the local level with a one element submesh and polynomial interpolation of
degree `+ 1 (here, `?{0,1}).

Table 1 – Expected convergence rates of the L2(?) norm of the error for the MMMFEM and MHM
formulations when polynomial spaces of degree ` = 0 or 1 are used on the skeleton ?.

Pressure Flux
Method ` = 0 ` = 1 ` = 0 ` = 1

MMMFEM (see (ARBOGAST et al., 2000)) - O(H 2) - O(H)
MHM (see (HARDER; PAREDES; VALENTIN, 2013)) O(H 2) O(H 3) O(H) O(H 2)

Results are displayed in Fig. 6 and 7 that show the error norms corresponding to different
combinations of the coarse interface spaces, namely, UH,`U –PH,`P with `U and `P in {0,1}.
Lack of convergence is observed for the MMMFEM method for any combination of interface
spaces where PH = PH,0. Conversely, the best results are obtained by taking moderate to
large values of ? and any combination of interface spaces where PH = PH,1. In the limiting
case, that corresponds to taking ? = 10?8, the error exhibits the expected convergence rate
of the MMMFEM method, i.e., O(H 2) for pressure and O(H) for flux. In the other limiting
case, that corresponds to taking ? = 108 the error exhibits the expected convergence rate of the
MHM method, i.e., the error converges either with O(H 2) for pressure and O(H) for flux if
the velocity space is UH,0, whereas if the velocity space UH,1 is used, the convergence rate is
O(H 3) for pressure and O(H 2) for flux. We see that for all combinations of spaces considered,
the error and convergences properties of the MRCM formulation improves as we increase the
value of the Robin condition parameter, with one exception that corresponds to using UH,0 and
PH,1 (see third column of Figs. 6 and 7), in which the method exhibits the same convergence
rate irrespective of the value of ? taken. In this case, we also note the error does not change
monotonically with respect to ? and that for ? = 108 (MHM-like solution) it exhibits greater



56 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

errors both for pressure and flux. Finally, for the choice of interface spaces UH,1 and PH,1 we
observe that for low to intermediate values of the Robin condition parameter (tipically, . 10 for
pressure and . 30 for flux) the convergence rate of the MRCM method never exceeds O(H 2)
for pressure and O(H) for flux, but it reaches the MHM rates rapidly as we further increase ?
from those values, indeed coinciding with the values at which the MRCM begins to approach the
MHM formulation linearly with respect to ? as observed in the first numerical experiment (see
Fig. 4).

? ?

? H 2

0.001

0.01

0.1

1

0.01 0.1 1
H

UH,0, PH,0

?
p
?

p h
? L

2 (
?
)

? ?

? H 3

10?5

0.0001

0.001

0.01

0.1

1

0.01 0.1 1
H

UH,1, PH,0

? H 2

0.0001

0.001

0.01

0.1

1

0.01 0.1 1
H

UH,0, PH,1

? H 3

? ?? H 2

0.0001

0.001

0.01

0.1

0.01 0.1 1
H

UH,1, PH,1

10?5

MMMFEM–like MHM–like

? = 1
? = 5

? = 10

? = 20
? = 50

? = 100

? = 200
? = 500

? = 1100
? = 108? = 10?8

Source: Elaborated by the author.

Figure 6 – L2(?) error norm of pressure ?p? ph?L2(?) as a function of the characteristic coarse inter-
face mesh size H for the second numerical example maintaining the ratio H/h constant and
considering different combinations of coarse interface spaces UH and PH . Solution norm:
? p ?L2(?)= 1/2.

The previous refinement procedure brings insight on the convergence properties of the
method as the number of subdomains is increased, but the size of the local problems is left
unchanged. From a HPC perspective, these results becomes thus relevant if we are interested
in weak scaling speedup. A different refinement approach, consists in keeping the global fine
grid partition Th fix and then increase the number of subdomains, such that the local problems



2.3. Numerical experiments 57

? ?

? H

0.1

1

10

0.01 0.1 1
H

UH,0, PH,0
?

u
?

u h
? L

2 (
?
)

? ?

? H 2

0.001

0.01

0.1

1

10

0.01 0.1 1
H

UH,1, PH,0

? H

0.01

0.1

1

10

0.01 0.1 1
H

UH,0, PH,1

? H

? H 2

? ?

0.001

0.01

0.1

1

0.01 0.1 1
H

UH,1, PH,1

MMMFEM–like MHM–like

? = 1
? = 5

? = 10

? = 20
? = 50

? = 100

? = 200
? = 500

? = 1100
? = 108? = 10?8

Source: Elaborated by the author.

Figure 7 – L2(?) error norm of flux ?u?uh?L2(?) as a function of the characteristic coarse interface mesh
size H for the second numerical example maintaining the ratio H/h constant and considering
different combinations of interface spaces UH and PH . Solution norm: ? u ?L2(?)=

?
2 ? .

become smaller at each refinement step. This may be relevant if we are interested in strong
scaling speedup. To illustrate the convergence properties in this case, Fig. 8 shows the L2(?)
norm of the errors for pressure and flux using UH,1 and PH,1 as interface spaces. In contrast
to the previous refinement study, now we observe a smoother increase of the convergence rate
towards the MHM estimates, both for pressure and flux as we move to larger values of ? .
Interestingly, the MRCM asymptotically exhibits a significantly larger convergence rate and
similar error for pressure (? H 2.72) for the intermediate value ? = 5 as compared to the case
with ? = 108 (MHM–like), whose convergence rate deteriorates to something lower than O(H).

As a final convergence experiment, consider a fixed domain decomposition of ? con-
sisting of 4×4 subdomains (i.e., H = 1/4) and take as coarse interface spaces for flux and
pressure UH,` and PH,` with ` = 0,1,...,6. For this experiment we adopt the value ? = 100 and
report results for different fine grid discretizations, namely h = H/20, h = H/40 and h = H/80.
Figure 9 shows the L2(?) error norms of pressure and flux. Consider for example the curves
corresponding to h = H/20. The pressure error decreases as ` is increased from 0 to 2 and
then becomes essentially constant for ` &gt; 2. A similar behavior is observed for the flux error
for ` &gt; 3. This means that taking ` = 3 (6 unknowns per interface ?i, j, 3 for UH and 3 for PH )
one gets results with the same accuracy as that of the fine grid solution. Considering that the
fine grid solution involves 20 unknowns per interface (using Mortar or Mortar Mixed domain
decomposition) the reduction in dimensionality is evident. For the case h = H/80 the reduction
is even larger, since taking ` = 5 (10 unknowns per interface) yields the same accuracy as that
obtained with the 80 unknowns per interface of the fine grid.



58 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

? ?

? H 3.22
? H 2.37

? H 2.13

? H 2.72 ? H 0.86

0.0001

0.001

0.01

0.1

0.01 0.1 1

?p
?

p h
? L

2 (
?
)

H

? H 1.97

? H 1.51

? ?

? H 1.21

? H 0.97

0.001

0.01

0.1

1

0.01 0.1 1

?u
?

u h
? L

2 (
?
)

H

MHM–likeMMMFEM–like ? = 50

? = 10?8 ? = 108
? = 1
? = 5

Source: Elaborated by the author.

Figure 8 – L2(?) error norms of pressure and flux as a function of the characteristic coarse interface mesh
size H for the second numerical example with fine grid size h maintained constant and using
UH,1 and PH,1 as interface spaces. Solution norm: ? p ?L2(?)= 1/2, ? u ?L2(?)=

?
2 ? .

2.3.3 The importance of the Robin condition parameter

Next we focus on two aspects of the MRCM. Through numerical experiments we will
show that for a range of values of the Robin condition parameter the MRCM provides better
approximations for pressure and velocity than those computed with the MRCM with extreme
values of the Robin condition parameter. These extreme values produce numerical solutions close
the the ones produced by the MMMFEM and MHM. Moreover, we perform a comprehensive
number of tests aiming in illustrating the accuracy and robustness of the generalized MRCM
formulation.

In the study reported here we use the permeability field provided by the SPE10 project
(http://www.spe.org/web/csp), that is commonly employed to test subsurface codes. Released
by the Society of Petroleum Engineers (SPE), it has become a recurrent benchmark in this field
(CHRISTIE; BLUNT, 2001; FRANCISCO et al., 2014). The original data contains 220×60×85
cells and its physical dimensions are 2200×1200×170 (ft). In our experiments the permeability
contrast is Kmax/Kmin ? 107. For the purpose of our simulations and further investigations about
the choice of the Robin condition parameter, 2D computations are performed in selected slices in
the z direction. It is worth noting that most of the selected slices contains channelized structures
that are particularly challenging for current multiscale methods. Moreover, if not stated otherwise,
results were computed using linear spaces PH,1 and UH,1 for the underlying interface problems.



2.3. Numerical experiments 59

10?5

0.0001

0.001

0.01

0.1

1

0 1 2 3 4 5 6

?p
?

p h
? L

2 (
?
)

`

10?5

0.0001

0.001

0.01

0.1

1

10

0 1 2 3 4 5 6

?u
?

u h
? L

2 (
?
)

`

h = H40h =
H
20 h =

H
80

Source: Elaborated by the author.

Figure 9 – L2(?) error norms of pressure and flux as a function of the polynomial order of the discrete
interface spaces UH and PH . Solution norm: ? p ?L2(?)= 1/2, ? u ?L2(?)=

?
2 ? .

For all slices, the computational domain is set to be a rectangle ? = [0,11/3]× [0,1],
and boundary conditions are no-flow at the top and bottom boundaries (y = 0 and y = 1), along
with an imposed flux on the left (x = 0) and right (x = 11/3) boundaries.

As previously stated, the Robin condition parameter ?i appearing in the variational for-
mulation (2.17)-(2.20), is computed as in Eq. (2.65), i.e. ?i = ? h/K, where ? is a dimensionless
parameter and K is the permeability field, that can be calculated on the interfaces ?i, j ? ? in
different ways. Although an optimal choice for the computation of this parameter demands a
more thorough investigation, we consider here four simple choices for the evaluation of the per-
meability field aiming at showing the robustness and flexibility of our formulation. We consider
the following options:

1. Discontinuous: The most obvious choice, since permeability fields are discontinuous
along the grid edges/facets, is to compute

?`(x) =
? h

K`(x)
, `?{i, j}, x ? ?i, j (2.68)

so that ? is constant by parts and different on each side of ?i, j (an illustration is provided
in the insert of figure 1).

2. Harmonic: Another approach is to take the same value on both sides of ?i, j as the



60 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

harmonic average of permeability values, i.e.

?`(x) =
? h
K

, K =
2Ki(x)K j(x)

Ki(x)+ K j(x)
, `?{i, j}, x ? ?i, j . (2.69)

3. One-sided: Consists in setting ? to zero in one side of ?i, j, and the other side dependent
on a given parameter ? . Thus

?`(x) =

???
??

0, if K`(x) &amp;lt;max
{

Ki(x),K j(x)
}

? h
K`(x)

, otherwise.
(2.70)

with `?{i, j} and x ? ?i, j.

4. Extreme: Consists in setting the Robin condition parameter ? as the extreme values (0 or
?) in each side of the interface, such as

?`(x) =

??
? 0, if K`(x) &amp;lt;max

{
Ki(x),K j(x)

}
?, otherwise.

(2.71)

with `?{i, j} and x ? ?i, j.

We performed a series of numerical studies for a number of different slices, using the
Discontinuous Robin condition parameter (Eq. (2.68)), varying the parameter ? from 10?6

(where the MRCM behaves like the MMMFEM) to 106 (where the MRCM behaves like the
MHM). For these studies, the domain is decomposed in 11×3 sub-domains of size H = 1/3,
each containing 20×20 cells, so that h = 1/60. The L2(?) errors are computed based on a
reference fine grid solution of 220×60 grid cells. Figure 10 shows the behavior of the errors
for pressure (top) and fluxes (bottom), alongside the (log-scaled) permeability field for a set of
slices of the SPE10 model.

The first eye-catching conclusion that can be drawn from these results is that there is a
range of alpha (? ? [1,100]) values in which the errors for pressure and fluxes attain a minimum
value. These errors are smaller than the errors of the MMMFEM-like and the MHM-like results,
for all slices, using the standard discontinuous computation of ? .

We have chosen slice number 36 to perform additional tests, in order to assess how the
errors are affected by the choice of the Robin condition parameter and on the way the domain
decomposition is performed. Figure 11 shows the error profiles obtained in this slice, for different
computations of the Robin condition parameter. The results show that for the Discontinuous
and Harmonic approaches we observe a similar behavior of the errors as we move from small
values of ? (MMMFEM-like solutions) to large values of this parameter (MHM-like solutions),
with a small flux error improvement in the Harmonic approach for small values of ? . For the
One-sided and Extreme cases, distinct behaviors are observed, with no real improvement over



2.3. Numerical experiments 61

MHM-likeMMMFEM-like

MHM-likeMMMFEM-like

6
27

33

36
37,

40

44

48
42

47

6,

27
33,
36

37

40

44

48
42
47

6

27

33

36

37

40

44

48

42

47

?2.6 4.3log10(K)

?

10?1

100

10?6 10?4 10?2 100 102 104 106?
pM

R
C

h
?

pF
in

e
h
? L

2
(?

)/
?p

F
in

e
h
? L

2
(?

)

10?2

?

100

10?6 10?4 10?2 100 102 104 106?u
M

R
C

h
?

uF
in

e
h
? L

2
(?

)/
?u

F
in

e
h
? L

2
(?

)

10?1

Source: Elaborated by the author.

Figure 10 – Relative L2(?) errors for pressures (top) and fluxes (bottom), computed using the fine grid
solution of SPE10 as a reference. Each curve shows the results of a different slice, depicted in
the right-hand side. Note that the errors associated with the MRCM for intermediate values of
? are considerably smaller than those associated with the MMMFEM and MHM.

previous choices. In the One-sided case, the minimum pressure error happens for a different
? value, as compared to the ? value leading to a minimum in the flux error. For the Extreme
case, the error sensitivity to the variation of ? parameter is less pronounced, with no significant
error improvement. Nonetheless, these two cases illustrate the robustness of our formulation: the
Robin condition parameters may be set in an arbitrary manner, with acceptable results produced
by the MRCM formulation.

Another factor affecting the error profiles is the number of subdomains used to decompose
the whole domain. The error profiles for different domain decompositions can be seen in figure
12, where pressure and flux erros for the 36th slice of SPE10 are shown. We consider subdivisions
with 11×3 subdomains, yielding H = 1/3 and 20×20 fine grid cells inside each subdomain,
22×6 subdomains, with H = 1/6 and 10×10 fine grid cells per subdomain, and finally 44×12



62 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

?

10?2

10?1

Discontinuous
100

10?6

One-sided

10?4 10?2

Extreme

100 102 104 106

?p
M

R
C

h
?

pF
in

e
h
? L

2
(?

)/
?p

F
in

e
h
? L

2
(?

)

Harmonic

?

0.2

0.3
Discontinuous

0.4

0.5

One-sided

0.6

0.7

Extreme

0.8

10?6 10?4 10?2 100 102 104 106

?u
M

R
C

h
?

uF
in

e
h
? L

2
(?

)/
?u

F
in

e
h
? L

2
(?

)

Harmonic

Source: Elaborated by the author.

Figure 11 – Relative pressure and flux error profiles for slice 36 as a function of ? parameter, for different
computations of the Robin condition parameter.

subdomains, with H = 1/12 and subdomains containing only 5×5 fine grid cells. The simulations
were performed using the discontinuous computation of the Robin condition parameter. While
the main trend is preserved throughout all simulated cases, one can easily see that the minimum
for both pressure and flux is shifted towards the position ? = 1 by increasing the number of
subdomains.

Following the ideas in (FRANCISCO et al., 2014), we also test the introduction of
an intermediate length scale H such that h &amp;lt;H &amp;lt;H. While H still refers to the size of the
subdomains, H is the size of a subdivision of each interface ?i, j and defines a new partition TH
of ?. The piecewise polynomial spaces on TH are denoted by PH,k and UH,k. Notice that ?
does not depend on H, so that PH,k is a refinement of PH,k and UH,k is a refinement of UH,k.



2.3. Numerical experiments 63

?p
M

R
C

h
?

pF
in

e
h
? L

2
(?

)/
?p

F
in

e
h
? L

2
(?

)

?

10?3

H = 1/610?2

10?1

H = 1/12

100

10?6

H = 1/3,H = 1/12

10?4 10?2
H = 1/6,H = 1/12

100 102 104 106

H = 1/3

?

0

0.1

H = 1/60.2

0.3

H = 1/12

0.4

0.5

H = 1/3,H = 1/12

0.6

0.7

H = 1/6,H = 1/12

0.8

10?6 10?4 10?2 100 102 104 106

?u
M

R
C

h
?

uF
in

e
h
? L

2
(?

)/
?u

F
in

e
h
? L

2
(?

)

H = 1/3

Source: Elaborated by the author.

Figure 12 – Relative pressure and flux error profiles for slice 36 as a function of ? parameter, for different
number of subdomains.

Results of two additional simulations with interface spaces PH,1 and UH,1 can be seen
in figure 12 (in dashed lines). One is computed by setting H = 1/3 and H = 5h = H/4 while the
other is computed with H = 1/6 and H = 5h = H/2. We remark on two of the main advantages
resulting from the introduction of the intermediate length scale H. First, pressure and flux errors
are somewhat smaller as compared to the results obtained with the linear spaces PH,1 and VH,1.
Second, and most importantly, the introduction of H scale alleviates the dependence of the
minimum error location on the domain decomposition, as they are all near the value ? = 1.

We now focus on the results reported in figure 13, where one can see the error profiles for
pressure and flux, for the computations performed with permeability field given by the 36th slice
of the SPE10 field. We show details of the error distribution as inserts in this figure. These inserts



64 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

0.8

1

10?6 10?4 10?2 100 102 104 106
?

0

0.2

0.4

0.6
MMMFEM

MRC ? = 18

?u
M

R
C

h
?

uF
in

e
h
? L

2
(?

)/
?u

F
in

e
h
? L

2
(?

)

MHM
1.0

0.8

0.5

0.2

0

?p
M

R
C

h
?

pF
in

e
h
? L

2
(?

)/
?p

F
in

e
h
? L

2
(?

)

MHM
MMMFEM

MRC ? = 18

101

102

10?6 10?4 10?2 100 102 104 106
?

10?3

10?2

10?1

100

2.5

1.9

1.2

0.6

0

Source: Elaborated by the author.

Figure 13 – Relative pressure and flux error profiles for slice 36 as a function of ? parameter. The inserts
show the permeability field and the subdomains colored by the local norm L2(?i) for each
subdomain ?i.



2.4. Concluding remarks 65

show the domain decomposition used (corresponding to H = 1/3) and the permeability field
superimposed by the local errors, i.e., errors computed inside each domain ?i using a L2(?i)
norm. We display the local errors for the MMMFEM and MHM methods, as well as the MRCM
with a choice for ? that minimizes the flux errors. For this selected slice of SPE10 and the chosen
subdomain division (H = 1/3), the minimum flux happens around ? = 18, while the minimum
pressure error is attained around ? = 6. Once in porous media flows minimizing flux errors is
typically preferred over minimizing pressure errors, we show only detailed results for ? = 18.
These results bring some insights about the error distribution in each method. Pressure errors are
well-behaved, and small errors are obtained in all subdomains, for both MMMFEM and MRCM
with small values of ? . Large pressure errors are obtained for large ? , including the result from
the MHM method, with increasing pressure errors towards the fluid production (right) boundary.
Flux errors are more insightful. One can easily see that for all methods, errors are concentrated
around the channelized structures of the permeability field, with larger values attained for the
MMMFEM and MHM methods. The choice ? = 18 brings the local flux errors down by a factor
of at least 2, especially in the vicinity of the channelized structures.

We close this section with a study of the error for pressure and fluxes that result from
distinct contrasts Kmax/Kmin in the permeability field of slice number 36. We set this ratio from
105 until 109. The results displayed in figure 14 indicate robustness of the MRCM also in terms
of this ratio. The errors for flux show only mild dependence on it, even for very heterogeneous
formations.

2.4 Concluding remarks

We have introduced a new multiscale mixed finite element method, the Multiscale Robin
Coupled method (MRCM), aiming at the accurate approximation of subsurface flows. The new
method is based on a domain-decomposition procedure in which the subdomains are coupled
by the Robin boundary condition. There appear two independent spaces on the skeleton of the
decomposition, corresponding to interface pressures and fluxes, that can be chosen with great
flexibility to accommodate local features of the underlying permeability fields. Initially the
well-posedness of the proposed domain decomposition procedure is established and it is shown
that it generalizes an existing domain decomposition procedure based on the Robin boundary
condition. In fact, it allows one to interpret the existing procedure as a Two-Lagrange-Multiplier
method. The multiscale property of the proposed domain decomposition method is discussed
and its relation with existing multiscale mixed methods is pointed out.

Numerical experiments are presented and discussed. Initially we compare the numerical
solutions of the MRCM to existing ones. We show that as the parameter in the Robin condition
of our method is set to extreme values we recover results from two known methods (MMMFEM
and MHM) as well as their convergence rates. Then we focus on the simulation of realistic flow



66 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media

Kmax/Kmin

Kmax/Kmin

102 104 106

106

?p
M

R
C

h
?

pF
in

e
h
? L

2
(?

)/
?p

F
in

e
h
? L

2
(?

)

?

107

10?2

10?1

108

100

10?6
109

10?4 10?2 100

105

?

0

0.1

1060.2

0.3

107

0.4

0.5

108

0.6

0.7

109

0.8

10?6 10?4 10?2 100 102 104 106

?u
M

R
C

h
?

uF
in

e
h
? L

2
(?

)/
?u

F
in

e
h
? L

2
(?

)

105

Source: Elaborated by the author.

Figure 14 – Relative pressure and flux error profiles for slice 36 as a function of ? parameter, or different
permeability contrast Kmax/Kmin.



2.4. Concluding remarks 67

in high-contrast channelized porous formations by considering several layers of the classical
SPE10 permeability field. Two aspects of the MRCM are considered. First we show that for a
range of values of the Robin condition parameter our method provides better approximations for
pressure and velocity than those computed with the new procedure with extreme values of the
Robin condition parameter. This is an indication that our method has the potential to produce
more accurate velocity fields in the presence of rough, realistic permeability fields of petroleum
reservoirs. Moreover, by selecting different expressions for the calculation of the Robin condition
parameter, we indicate the robustness of the MRCM formulation.





69

CHAPTER

3
INFORMED SPACES FOR THE MULTISCALE
ROBIN COUPLED METHOD IN RESERVOIR

SIMULATION

The Multiscale Robin Coupled Method (MRCM) is a recent multiscale numerical method
based on a non-overlapping domain decomposition procedure. One of its hallmarks is that the
MRCM allows for the independent definition of interface spaces for pressure and flux over the
skeleton of the decomposition. The accuracy of the MRCM depends on the choice of these
interface spaces, as well as on an algorithmic parameter ? in the Robin interface conditions
imposed at the subdomain boundaries. This work presents an extensive numerical assessment
of the MRCM in both of these aspects. Two types of interface spaces are implemented: usual
piecewise polynomial spaces and informed spaces, the latter obtained from sets of snapshots by
dimensionality reduction. Different distributions of the unknowns between pressure and flux are
explored. Two non- dimensionalizations of ? are tested. The assessment is conducted on realistic,
high contrast, channelized permeability fields from a SPE benchmark database. The results
show that ? , suitably non-dimensionalized, can be fixed to unity to avoid any indeterminacy
in the method. Further, with both types of spaces it is observed that a balanced distribution
of the interface unknowns between pressure and flux renders the MRCM quite attractive both
in accuracy and in computational cost, competitive with other multiscale methods from the
literature.

3.1 Introduction

Multiscale domain decomposition methods have received considerable attention from
the scientific community due to their potential to solve efficiently elliptic problems with rapidly
varying coefficients in parallel multi-core computers. This class of methods approximates the
exact solution by solving uncoupled local problems on non-overlapping subdomains, along with



70 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

one global problem (or interface problem) associated with the coupling between subdomains
through their boundaries. In fact, consistency conditions require the imposition of some form
of continuity of fluxes and of pressures at interfaces between neighbor subdomains. Different
methods have been developed based on distinct approaches to address the continuity issue.
We mention, for instance, the Multiscale Mortar Mixed Finite Element Method (MMMFEM)
(ARBOGAST et al., 2007) and the Multiscale Hybrid-Mixed Method (MHM) (ARAYA et al.,
2013; HARDER; PAREDES; VALENTIN, 2015), as some well known procedures of this type.
In the MMMFEM, the pressure continuity is weakly satisfied in the fine-grid scale (the scale of
the local grid of each subdomain, usually denoted by h), while normal flux continuity is ensured
in a much larger scale (H ? h), usually associated with the size of the subdomains. Conversely
in the MHM, continuity of the normal fluxes is satisfied at the fine-grid h scale, while pressure
continuity is only imposed at the larger H scale.

The design of accurate multiscale domain decomposition methods for channelized, high-
contrast porous media, remains as an important challenge because in typical problems posed by
the oil industry existing multiscale methods may produce inaccurate numerical approximations
(GUIRALDELLO et al., 2018b).

In our search for more accurate procedures, here we investigate an improved version
of the recently proposed Multiscale Robin Coupled method (MRCM) (GUIRALDELLO et al.,
2018b). This method is based on the domain decomposition of Douglas et al. (DOUGLAS et al.,
1993) and on the Multiscale Mixed Method (MuMM) of Francisco et al. (FRANCISCO et al.,
2014), and ensures weak continuity of both normal fluxes and pressures through the imposition
of Robin-type boundary conditions, namely

??iui ·n?i + pi = ? ju j ·n? j + p j, (3.1)

at the interface ?i j between subdomains (identified by i and j), usually in a scale that is larger
than the fine-grid scale. In Eq. (3.1) pi and ui are pressure and velocity of subdomain i at the
interface, and n?i =?n? j is the outwards unit normal. The MRCM can be seen as a generalization
of the above mentioned methods depending on the parameter ?i: the MMMFEM (respectively,
the MHM) is recovered as ?i ? 0 (respectively, ?i ?+?) for all i.

The accuracy and cost of multiscale domain decomposition methods are mainly deter-
mined by the choice of the interface space, i.e., the space on which the global problem is posed.
This space consists of functions defined on the collection of interfaces between subdomains, or
skeleton of the partition, ? =?i ?= j?i j, where ?i j denotes the interface between nearest-neighbor
subdomains. For the MMMFEM the interface space is a pressure space PH , while for the MHM
it is a flux space UH . A salient feature of the MRCM, with ?i different from 0 and +?, is that
its global interface problem is posed on the direct product PH ×UH of a pressure space and a
flux space, both defined on the skeleton and which can be chosen independently. This allows
us to explore an interesting question: Assume that one decides to allocate k unknowns at each



3.1. Introduction 71

interface ?i j of the skeleton. How does their distribution between pressure unknowns and flux
unknowns affect the accuracy and cost-effectiveness of the method?

Of course the approximation capabilities of the interface space depends not just on its
dimension (i.e., number of unknowns) but also on the functions it consists of. The first reported
implementations of MMMFEM, MHM and MRCM adopted piecewise polynomial spaces over
the interfaces, which are the simplest to code and analyze. It is however accepted nowadays that
polynomial spaces are not optimal for highly heterogeneous problems, and different kinds of
problem-dependent approximation spaces (informed spaces, in short) have been proposed for
multiscale finite element (BABUSKA; OSBORN, 1983; CHUNG; EFENDIEV; HOU, 2016)
and finite volume (JENNY; LEE; TCHELEPI, 2003) methods. The latter was extended to several
nonlinear complex cases, including the compressible and compositional cases as well as fractures
(LUNATI; JENNY, 2006; LEE; ZHOU; TCHELEPI, 2009; HAJIBEYGI; TCHELEPI, ; BOSMA
et al., 2017). The combination of informed spaces with the MMMFEM has recently been studied
by Chung et al. (CHUNG; FU; YANG, 2016), while it remains unexplored for the MHM. In line
with this trend, this work explores a strategy for building informed spaces at the interfaces for
the MRCM. In this way, we explore the question of optimal allocation of unknowns between
pressure and flux not just with polynomials but also with spaces that are more suitable for highly
heterogeneous media. Moreover, once the MHM is a particular case of the MRCM, a first study
of combining the MHM with informed spaces is also produced.

Our numerical results indicate that, typically, the optimal accuracy is attained somewhere
in between the MMMFEM (all unknowns for pressure) and the MHM (all unknowns for flux). In
other words, the solution of minimal error is produced by the MRCM for some specific choice
of its algorithmic parameters. Further, it is shown that through appropriate dimensional analysis
it is possible to fix all parameters of the MRCM automatically, resulting in a fully-determined
method that is competitive with known ones. In particular, it is recommended that the number of
unknowns for interface pressure is equal to (or slightly smaller than) the number of unknowns
for interface flux. In this way we arrive at a method that is effective for all layers in the SPE10
database. The construction of the informed spaces needs however to be improved, since the
method exhibits comparable overall accuracy with polynomial and informed interface spaces.
There exist multiscale iterative methods, that include global information on the multiscale basis
functions and show improvements in terms of accuracy (see e.g. (CHUNG; EFENDIEV; LEUNG,
2018; HAJIBEYGI et al., 2008)). The development and dicussion of such procedures for the
MRCM is out of the scope of this article and is left for future work. However, we remark that
informed interface spaces do show improved approximation of fluxes in regions of the domain
with high-contrast formations.

The plan of this article is as follows: The MRCM is briefly recalled in Section 2, adopting
a fine grid discretization consisting of lowest order Raviart-Thomas finite elements RT0 and
general spaces PH and UH at the skeleton ?. The reader should recall that the RT0 elements are



72 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

equivalent to the popular cell-centered finite volume method with two-point flux approximation.
The strategy adopted for building the interface spaces is described in Section 3. It is similar to
strategies proposed by other authors, such as the empirical interpolation technique used by Calo et
al. (CALO et al., 2014; CALO et al., 2016) in the context of multiscale finite elements. With these
elements at hand, Section 4 is then devoted to numerical experiments addressing the questions
of selection of optimal algorithmic parameters and of optimal allocation of interface unknowns
between pressures and fluxes. The geological data used in the experiments are two-dimensional
slices of the SPE10 benchmark database, with different degrees of channelization.

3.2 The Multiscale Robin Coupled Method

3.2.1 Discrete variational formulation

Let us consider a fine grid Th, i.e., a subdivision of the domain ? ? Rd consisting
of d-dimensional cuboids of size h, and a decomposition of ? in subdomains {?i}i=1,...,m, of
characteristic size H ? h, such that each element K ? Th belongs to one and only one of the
subdomains. Moreover, let ? be the skeleton of the domain decomposition, as the union of all
interfaces ?i, j = ?i ?? j. The discrete variational formulation of the MRCM is written over the
discrete lowest order Raviart-Thomas spaces for velocity and pressure, defined as

Vih = {v ? H(div,?i) , v j(x)|K = p j1(x1)p j2(x2)... ,?K ? T
i

h ,

with p jk ? P1 if j = k , p jk ? P0 if j ?= k } , (3.2)

Vihy = {v ? V
i
h , v·n? = y on ? ?i ?? ?u} , (3.3)

Qih = {q ? L
2(?i) , q(x)|K ? P0} , (3.4)

with y being a piecewise constant function defined on the edges of ? ?u and Pk the usual space
of polynomials of degree up to k.

We denote by Eh the set of all edges/faces of Th in the skeleton ?. A unique normal n? is
defined as

n?(e) .= exterior normal to ? ?min{i, j} , if e ? ?i, j (3.5)

for every e in Eh. The spaces for pressures and fluxes at subdomain interfaces that will be
considered here consist of functions that are constant on each e of Eh, i.e., they are subsets of

Fh(Eh) ={ f : Eh ?R | f |e ? P0 , ?e ? Eh} . (3.6)

To finally state the variational formulation of the MRCM, consider low-dimensional
subspaces UH and PH of Fh(Eh). The MRCM consists in finding (uih, p

i
h) ? V

i
hz ×Q

i
h, for



3.2. The Multiscale Robin Coupled Method 73

i = 1,...,m, and (UH,PH)? UH ×PH such that(
K?1uih,v

)
?i
?
(

pih,?·v
)

?i

+
(
PH ??iUH n?i ·n? + ?i uih ·n?

i,v·n?i
)

? ?i??
=?

(
g,v·n?i

)
? ?i?? ?p

(3.7)(
q,? ·uih

)
?i

= ( f ,q)
?i

(3.8)

m

?
i=1

(
uih ·n?

i,MH
)

? ?i??
= 0 (3.9)

m

?
i=1

(
?i (uih ·n?

i ?UH n?i ·n?),VH n?i ·n?
)

? ?i??
= 0 (3.10)

hold for all (v,q) ? Vih0 ×Q
i
h , ?i = 1,...,m , for all MH ? PH and for all VH ? UH . Above,

the symbol (·,·)A denotes the scalar product of L2(A).

The existence and uniqueness of the solution of this variational formulation is proved in
(GUIRALDELLO et al., 2018b). It only requires that

m

?
i=1

(?iVH,VH) &gt; 0 , ?VH ? UH , VH ?= 0 . (3.11)

This condition is easy to check, since

m

?
i=1

(?iVH,VH) =
m

?
i=1

?
? ?i??

?iV
2
H =

?
?

(
?
+ + ??

)
V 2H , (3.12)

where the plus and minus superscript refer to the two sides of ?. If the functions ?i, assumed
non-negative, are not identically zero on both sides of ? and on the whole support of some VH ,
then the solution is unique. In the extreme case that all ?i’s are identically zero, then UH must be
zero for the problem to be well-posed. This reduces the formulation to the MMMFEM.

Remark 4. Actually, the variational formulation also holds without the conditions PH ? Fh(Eh),
UH ? Fh(Eh). The necessary and sufficient conditions are, in fact, (3.12) together with the same
inf-sup compatibility of the MMMFEM, namely that for each nonzero MH ? PH there exists i
(1 ? i ? m) such that

sup
v?Vih0

(
v·n?i,MH

)
? ?i??

&gt; 0 (3.13)

For the case of the RT0 velocity approximation, this is equivalent to

sup
Ah?Fh(Eh)

(Ah,MH)? &gt; 0 ,

which is automatically satisfied if PH ? Fh(Eh). Otherwise condition (3.13) must be checked
independently.

The implementation performed here strictly follows the one presented in (GUIRALDELLO
et al., 2018b), sharing similarities with the works of Ganis &amp;amp; Yotov (GANIS; YOTOV, 2009)



74 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

and Francisco et al. (FRANCISCO et al., 2014). Note that the linear system associated with Eqs.
(3.7)-(3.10) is of a size comparable to that of the original, undecomposed problem. However, the
solution to the problem written in terms of Eqs. (3.7)-(3.10) can be, locally, expressed in terms
of linear combinations of multiscale basis functions. The construction of such basis functions is
naturally parallelizable.

By assuming that the interface variables (UH,PH) are known, one can uncouple Eqs. (3.7)-
(3.8) from Eqs. (3.9)-(3.10). The first set of equations will produce local problems for the
computation of the multiscale basis functions. The set of multiscale basis functions is then used
on Eqs. (3.9)-(3.10) to generate a global linear system to be solved for the interface variables,
coupling the local solutions while ensuring the compatibility conditions between subdomains.
The final solution is then obtained by linear combination of the previously computed multiscale
basis functions. The interested reader is referred to Guiraldello et al. (GUIRALDELLO et al.,
2018b) for a thorough explanation of the implementation of this numerical scheme.

3.3 Interface spaces: Polynomial and informed
The original implementation of the MRCM used piecewise polynomial spaces over the

skeleton ? of the domain decomposition, both for pressure PH and flux UH . More precisely,
we have considered spaces made up of the elementwise constant fine grid representation of
polynomials over the interface elements

UH = U
pol,`U +1

H ={VH, VH|e = ?0(q),q ?P`U (e), e ? TH}, (3.14)

PH = P
pol,`P+1
H ={MH, MH|e = ?0(q),q ?P`P(e), e ? TH}, (3.15)

where Pk, k = `U or `P, is the space of polynomials of degree ? k and ?0 is the L2–projection
of a function of Pk(e) onto the space Fh(e), e ? TH . The superscript added to the symbol for
each space contains the class of functions adopted (“pol” for polynomials, “inf” for informed)
followed by the number of degrees of freedom on each edge of TH . Notice that UH and PH are
defined independently at each edge (face in 3D), with no continuity at corner points.

One alternative to polynomial spaces is, as previously mentioned, informed spaces,
whose construction is a two-step process: (i) construction of the so called snapshot space by
solving local problems on regions containing the interfaces ?i, j of the domain decomposition
(i.e., oversampling) and considering some parameterisation (for example, on the boundary
conditions of these local problems) and (ii) selection of the final informed space by applying
a dimensionality reduction technique (SVD, POD, etc.) to end up with a coarsened interface
problem of affordable size and whose solution appoximates well the fine grid solution.

By oversampling, we associate to each subdomain ?k a new region ?k that contains it.
Figure 15 shows a few examples of the oversampling regions ?k for an interior subdomain and
for a subdomain that intersects the boundary of ?. This way, the ?k’s clearly contain the whole



3.3. Interface spaces: Polynomial and informed 75

?

TH(?)Th

? ?

?h(e)

ph

h

H

?i, j

I,J

? j?i

Ue =?KI,J
?h(e)? ph,I,J

h/2

?i ? j

?i ? j

?k

Source: Elaborated by the author.

Figure 15 – Computational domain decomposition and oversampling regions.

of ? ?k ??. This decomposition essentially follows the original domain decomposition of ? by
slightly augmenting the size of the local problems by just a few layers of fine grid cells that are
now shared by several processes. This is expected to be efficient in terms of message passing and
avoids dealing with more than one decomposition of ?. Although in the linear case this would
not be a serious drawback since this stage of the computation is done offline, in the non-linear
case periodic recomputation of the basis functions is needed and switching dynamically between
very distinct domain decompositions would lead to an undesirable computational burden.

Consider interface ?i, j and corresponding subdomains ?k, k = i, j. Their boundaries
are formed by a collection of fine grid faces em ? Th, m = 1,2,...,Nk. In order to build the
snapshot space for interface ?i, j we solve NK local Darcy problems on each oversampling region



76 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

?k (k = i, j), i.e.,
uk,mh = ?K?p

k,m
h in ?k

? ·uk,mh = Ck,m in ?k
B(uk,mh , p

k,m
h ) = ?m(x) on ? ?k

(3.16)

The function ?m(x) takes the value 1 if x ? em and 0 otherwise. In (3.16), B is a boundary
operator which enforces either pressure boundary conditions on ? ?k, i.e.,

B(uk,mh , p
k,m
h ) = p

k,m
h (3.17)

in which case the source term Ck,m is identically equal to zero, or flux boundary conditions on
? ?k, i.e.,

B(uk,mh , p
k,m
h ) = u

k,m
h ·n?? ?k (3.18)

and the source term Ck,m satifies the compatibility condition?
?k

Ck,m =
?

? ?k

?m . (3.19)

After solving these problems, we retrieve the corresponding fluxes through the faces e ? ?i j as

U k,me = u
k,m
h (e)·n?(e) . (3.20)

We also retrieve the corresponding pressure at ?i j, but since for the RT0 element the
pressure nodes are located at the center of the computational cells, face pressure values must be
recovered by using Darcy’s law. This amounts to compute a face pressure at each fine grid cell
that intersects the boundary ?i, j. For instance, for an east boundary and fine grid cell I,J (see
Figure 15), we obtain the face pressure ? k,mh (e) by solving

U k,me =?KI,J
?

k,m
h (e)? p

k,m
h,I,J

h/2
. (3.21)

In this way we end up, for each ?i, j, for each k = i or j, and for each m = 1,...,Nk, with
two column arrays U? k,m and P?k,m, each of dimension Mi j (the number of fine grid faces in ?i, j),
whose components are U k,me and ?

k,m
h (e), respectively. We define new column arrays denoted by

U k,m and Pk,m by substracting the constant component of U? k,m and P?k,m which are finally used
to build the snapshot matrices

A?i jU =
[
U i,1,...,U i,Ni, U j,1,...,U j,N j

]
A?i jP =

[
Pi,1,...,Pi,Ni, P j,1,...,P j,N j

]
The next step is to perform the SVD decomposition on the two matrices above. The SVD

decomposition of a given matrix A?Rm×n reads

A = X?YT



3.4. Numerical experiments 77

where X ? Rm×m and Y ? Rn×n are orthogonal matrices and ? ? Rm×n is a diagonal matrix
given by

? = diag(?1,..,?q,0,..,0) (3.22)

where ?1 ? ?2 ? ...? ?q &gt; 0 are the singular values of the decomposition and q is the
rank of matrix A. This procedure is executed on both A?i jU and A

?i j
P .

Finally, the informed space U inf,kH (respectively, P
inf,k
H ) is defined locally on each ?i, j

as the space of linear combinations of the first k?1 right singular vectors of A?i jU (respectively,
A?i jP ) augmented with the constant function on the corresponding interface.

Two comments are in order for the procedure just described. First, the number of local
problems of type (3.16) to be solved can be reduced significantly by adopting a different strategy
to parameterize the solution, for instance, by grouping together several fine grid faces on ? ?
on which some specified boundary conditions can be applied. Also randomly sampling these
fine grid faces is a possibility (CALO et al., 2016). Second, in the proposed approach, the
solutions of the local problems are considered all equally probable prior to computing the SVD
decomposition. However, some strategy could be devised to discard solutions of small norm on
the interface. These topics will be the subject of future studies.

3.4 Numerical experiments

We have performed a series of numerical experiments in a quarter of a 5-spot geometry
in a rectangular 2D region with dimensions [0,11/3]× [0,1]. We consider no-flow boundary
conditions with an injection (production) well positioned at the top left (bottom right) corner
of the computational region. For the absolute permeability we take distinct layers of the SPE10
project (http://www.spe.org/web/csp) (CHRISTIE; BLUNT, 2001). These are realistic, very
heterogeneous fields typical of petroleum reservoirs.

The interface spaces are either polynomials or informed spaces obtained with oversam-
pling of size h. We consider the flux boundary operator given by Eq. (3.18) and the average
pressure is set to zero. The results are given in the form of graphs that display the relative
L2(?) error norm (computed with respect to the fine grid solution) for the pressure and flux
variables. We first investigate the adequate characteristic length scale for the adimensionalization
of the numerial parameter ? , and then explore the accuracy of the MRCM compared with the
MMMFEM and the MHM with same number of interface unknowns. Finally, we perform an
exhaustive comparison study covering all the SPE10 layers.



78 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

3.4.1 The characteristic length scale

Dimensional analysis indicates that the Robin coefficient of subdomain i can be written
in terms of a dimensionless ? as

?i (x) =
? (x)L
K (x)

.

In (GUIRALDELLO et al., 2018b), we set L = h, h being the mesh size. Here we show that a
better choice is L = H, where H is the size of ?i j = ? ?i ?? ? j. To see this we fix the decom-
position of the computational region and perform a mesh refinement study inside subdomains.
Although ? could in general depend on x, we adopt a fixed value for it that holds for all x and
all i. For the choice L = H the value of ? for which the MRCM yields minimum error remains
essentially unaltered under the refinement study. In order to illustrate our findings, we consider
layer 36 (that contains a high contrast channel) divided into 22×6 rectangular subdomains with
size H ×H, being H = 1/6. For this domain decomposition we consider a sequence of mesh
refinements inside each subdomain starting with 10×10 (mesh size h = H/10) and increase
each direction by a factor of 2 until we reach h = H/80. For the interface spaces we consider
here polynomials of degree one, i.e., UH = U

pol,2
H and PH = P

pol,2
H .

As can be seen in Fig. 16, where we report the errors against the parameter ? , if one sets
L = h (solid lines) the optimal value for ? increases for both pressure and fluxes as the mesh is
refined. On the other hand, if one sets L = H (dashed lines) the value of ? for which the error
is minimal turns out to be quite independent of h, with ? ? 0.3 to minimize pressure error and
? ? 1 to minimize flux error. This suggests that one could simply assign a fixed value to ? .

To further confirm this, we solve the same problem with another decomposition given
by 11×3 subdomains (H = 1/3) and a fixed mesh of 20×20 elements per subdomain (i.e.,
h = H/20). Further, we consider several permeability fields taken from different layers of the
SPE10 data. As before, the interface spaces are U pol,2H and P

pol,2
H (piecewise linear polynomials).

In Fig. 17 we illustrate the relative errors for pressure and flux as functions of ? . Note that the
minimum error remains close to ? = 1, especially for the flux error, in all cases.

Given the results reported above, from now on we adopt L = H in the definition of the
Robin parameter.

3.4.2 Comparison of multiscale mixed methods

Here we focus on numerical solutions computed with the MRCM, in comparison to those
provided by the MMMFEM and the MHM. Through numerical simulations we have shown (see
(GUIRALDELLO et al., 2018b)) that as ? ?+0 the flux interface space UH becomes irrelevant
and the MRCM produces results that tend to those of the MMMFEM with the interface space
PH . On the other hand, as ? ?+?, PH becomes irrelevant and the MRCM produces results
that tend to those computed with the MHM with the interface space UH . In conclusion, one can
view the MRCM as a generalization of the two other known procedures.



3.4. Numerical experiments 79

Source: Elaborated by the author.

h = H/10, H/20, H/40, H/80.

Figure 16 – Effect on ? position for L = h (solid lines) and L = H (dashed lines) for a sequence of fine
mesh refinement.

The comparison among the three methodologies will be conducted as follows: For each
numerical study we fix a number k of degrees of freedom (dof ’s) per interface ?i, j to be employed
in solutions computed with all methods. For the MMMFEM we set PH = P

pol,k
H in the case of

piecewise polynomial spaces, and PH = P
inf,k
H in the case of informed spaces. Similarly, for the

MHM we set UH equal to either U
pol,k

H or U
inf,k

H . For the MRCM we take the interface spaces
to be P pol,kPH (or P

inf,kP
H in the informed case) and U

pol,kU
H (or U

inf,kU
H ), with kU + kP = k.

Initially we set k = 5 dof ’s per interface and take some representative layers of the
SPE10 database. We select layer 33 that does not exhibit a strong channelized structure, layer 36
with one well defined channel, and layers 42 and 45 with an intricate channel structure. In our
studies we set Kmax/Kmin ? 106. In Figs. 18 and 19 we display the relative L2(?) error norms for
pressure and flux variables, respectively, as functions of ? . When comparing the MRCM pressure
with that of the MMMFEM (left dots) and that of the MHM (right dots) it is clear that one can
always find a combination of (kP,kU ) and ? such that the MRCM produces a more accurate
result than MMMFEM and MHM for both polynomial (solid lines) and informed (dashed lines)
interface spaces. This observation is valid except for layer 45, for which the MMMFEM solution
for the polynomial space is superior. This conclusion remains the same when comparing the
flux errors. Exceptions to this finding occur on layers 33 and 42, for which the MHM produces
the most accurate results for the case of informed spaces. In order to exhibit the quality of the



80 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

Source: Elaborated by the author.

Figure 17 – Relative pressure errors (top) and relative flux errors (bottom) for a collection of SPE10 layers
with L = H.

solution, Figs. 20 and 21 display the pressure solution and the streamlines for the best global ?
compared to the fine solution for layer 36 for the polynomial case. In Figs. 22 and 23 we illustrate
the relative L2(?) error norms for pressure and flux variables, respectively, as a function of ? for
the case of k = 4 with layers 30, 63, 67 and 75, which were selected using the same criterion as
adopted above, although none of the fields with channelized structure (layers ? 63) present one
well-defined channel as in layer 36. In the numerical studies just discussed, that focus on global
errors, we have shown that one can often find a combination of kP, kU and ? for the MRCM that
produces a better numerical solution than that provided by MMMFEM and MHM.

Next, we investigate how the error is distributed aiming at assessing the importance
of informed spaces in approximating the velocity field in high-contrast realistic channelized
formations. We take the permeability field with the most pronounced channel (layer 36), k = 5,
and the best combination of (kP,kU ) and ? for polynomial and informed spaces that minimize
the corresponding global error, as depicted on Figs. 18 and 19.

In Figs. 24 and 25 we show the pointwise absolute errors for pressure and flux, respec-
tively. From these results one can see that both strategies provide comparable approximations
for the pressure field (see Fig. 24). However, Fig. 25 indicates that informed spaces produce a
better approximation of the flux variable than its polynomial counterpart. Moreover, the error is
larger on the main channel structure of the permeability field for the polynomial compared to the
informed case. Thus, informed spaces show great potential to be applied in reservoir simulation.



3.4. Numerical experiments 81

(kP,kU ) = (4,1),(3,2),(2,3), (1,4). N Pol ? Inf

Source: Elaborated by the author.

Figure 18 – Relative pressure error as function of ? for layers 33,46,42 and 45 with 5 dof ’s. Solid lines:
polynomial spaces; Dashed lines: informed spaces, for the MRCM formulation.



82 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

(kP,kU ) = (4,1),(3,2),(2,3), (1,4). N Pol ? Inf

Source: Elaborated by the author.

Figure 19 – Relative flux error as function of ? for layers 33,46,42 and 45 with 5 dof ’s. Solid lines:
polynomial spaces; Dashed lines: informed spaces, for the MRCM formulation.



3.4. Numerical experiments 83

Layer 36 pressure solution

(kP,kU ) = (4,1) ? = 6.527×10?2 Fine Sol.

Source: Elaborated by the author.

Figure 20 – Pressure solution for the optimal global ? and interface spaces with 5 dof ’s for polynomials
and the fine pressure solution for layer 36.

Layer 36 streamlines

(kP,kU ) = (3,2) ? = 1.035×100 Fine Sol.

Source: Elaborated by the author.

Figure 21 – Streamlines for the optimal global ? and interface spaces with 5 dof ’s for polynomials and
the fine solution for layer 36.

The studies discussed above illustrate that the accuracy of results produced by the
MRCM depend on the choice of (kP,kU ) and ? . They also confirm, as noted by Guiraldello et
al (GUIRALDELLO et al., 2018b), that intermediate values of ? are “safe”, in the sense that
they lead to errors that are never larger, and usually smaller, than the errors produced by the
extreme values ? = 0 (MMMFEM) and ? = +? (MHM). In order to avoid the need of selecting
(kP,kU ) and ? at each run of the MRCM, we adopt the following strategy that has worked well
in numerous tests:

? If k is even, we take kP = kU = k/2;

? if k is odd, we take kP = (k?1)/2 and kU = kP + 1 = k?kP;



84 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

(kP,kU ) = (3,1),(2,2), (1,3). N Pol ? Inf

Source: Elaborated by the author.

Figure 22 – Relative pressure error as function of ? for layers 30,63,67 and 75 with 4 dof ’s. Solid lines:
polynomial spaces; Dashed lines: informed spaces, for the MRCM formulation.



3.4. Numerical experiments 85

(kP,kU ) = (3,1),(2,2), (1,3). N Pol ? Inf

Source: Elaborated by the author.

Figure 23 – Relative flux error as function of ? for layers 30,63,67 and 75 with 4 dof ’s. Solid lines:
polynomial spaces; Dashed lines: informed spaces, for the MRCM formulation.



86 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

Absolute pressure error

Pol : (kP,kU ) = (4,1) ? = 6.527×10?2

In f : (kP,kU ) = (2,3) ? = 4.391×10?1

Source: Elaborated by the author.

Figure 24 – Absolute pressure error for the optimal global ? and interface spaces with 5 dof ’s for
polynomial and informed interface spaces for layer 36.

? set ? = 1.

In this way there are no free parameters for the MRCM. To justify such choices we perform an
exhaustive comparison of MRCM, MHM and MMMFEM, with the same number k of dof ’s per
interface for all methods, considering all SPE10 layers. Both polynomial and informed spaces
are considered and the three methods can be compared on an equal footing. Figures 26 and 28
show, respectively, the results for k = 4 and k = 5 for polynomial interface spaces. Note that that
when a curve corresponding to any of the methods appears in the shadowed region of another
curve with a larger error, the color gets darker. For this choice of parameters the MHM is the
least accurate method in the pressure variable for the channelized layers (layer number &gt; 35),
the MMMFEM being the most accurate. For the flux variable, however, the most accurate is the
MRCM, while the MMMFEM behaves quite poorly for some of the layers around layer 40. The
corresponding study for informed spaces is given in Figs. 27 and 29. For these spaces the MHM
is again the least accurate procedure in the pressure variable (especially in layers 65-75), while
the MMMFEM and MRCM behave similarly. For the flux variable the MHM and MRCM yield



3.4. Numerical experiments 87

Absolute flux error

Pol : (kP,kU ) = (3,2) ? = 1.035×100

In f : (kP,kU ) = (1,4) ? = 1.004×102

Source: Elaborated by the author.

Figure 25 – Absolute flux error for the optimal global ? and interface spaces with 5 dof ’s for polynomial
and informed interface spaces for layer 36.

similar accuracy, better than that of the MMMFEM, which again is considerably worse than the
others for the layers around layer 40.

Although the focus of previous experiments is accuracy, another equally important aspect
is the efficiency of the numerical methods. In order to illustrate this aspect, Figure 30 displays
the number of GMRES iterations to convergence to solve the interface problem for each method
with k = 5 for all the SPE10 layers with polynomial functions for the MMMFEM and MRCM
and informed functions for the MHM. The GMRES was set with a relative tolerance of 10?9

and an ILU preconditioner with a drop tolerance of 10?4. From the results one can observe
that the MMMFEM and the MRCM have comparable number of GMRES iterations, with a
slight advantage for the MRCM, and converge with half of the iterations required for the MHM.
In these experiments the linear systems being solved have 260 unknowns. Another important
point is that all of the above experiments are based on a fixed domain decomposition of 11×3
subdomains. In order to explorer other configurations, Figure 31 displays the relative error to
convergence for many different domain decomposition geometries with k = 5 for layer 36. Notice



88 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

that, as the global fine mesh is fixed and each subdomain is a collection of fine elements, the
number of elements for each domain decomposition geometry are different, e.g., each subdomain
of the 5×6 domain decomposition geometry has a fine mesh of 44×10 elements.

The results shown in Figs. 26-31 allow us to conclude that the proposed MRCM is a
competitive alternative to MMMFEM and MHM, both with polynomial and informed interface
spaces. It should however be noted that the error obtained with informed spaces is roughly the
same as that obtained with polynomial spaces. The only salient effect is the reduction of the
pressure error, and just for the MHM.

Overall, the numerical results reported here indicate that the MRCM, with suitable
choices for the spaces and parameters, is able to produce more accurate solutions than the other
two procedures for problems defined for realistic, very heterogeneous permeability fields.

Source: Elaborated by the author.

Figure 26 – Relative pressure and flux error for all the SPE10 layers considering k = 4 and polynomial
functions to build the interface spaces.

Source: Elaborated by the author.

Figure 27 – Relative pressure and flux error for all the SPE10 layers considering k = 4 and informed
functions to build the interface spaces.

3.5 Concluding remarks
We have reviewed the recently introduced Multiscale Robin Coupled Method and de-

scribed its implementation with informed spaces (or empirical interpolation spaces, obtained by
oversampling) for the interface variables. We have compared the accuracy of the solutions of



3.5. Concluding remarks 89

Source: Elaborated by the author.

Figure 28 – Relative pressure and flux error for all the SPE10 layers considering k = 5 and polynomial
functions to build the interface spaces.

Source: Elaborated by the author.

Figure 29 – Relative pressure and flux error for all the SPE10 layers considering k = 5 and informed
functions to build the interface spaces.

two well known multiscale methods, the Multiscale Mortar Mixed Finite Element Method and
the Mixed Hybrid Method, with that of the MRCM in realistic, very heterogeneous permeability
fields given by layers of the SPE10 project. The comparison was carried out with the same
number of unknowns for all methods, with interface spaces given by polynomial and informed
functions. It should be mentioned that no such comparison is available even if restricted to
MMMFEM and MHM, and that no previous implementation or assessment of the MHM with
informed spaces has been reported in the literature.

Our numerical results indicate that the MRCM, fixing its algorithmic parameter ? to
the value 1 and with a balanced distribution of the unknowns between interface pressures and
interface fluxes, is a competitive alternative to the two previous methods. In fact, it is more
accurate than MHM (which behaves better than MMMFEM) for the flux variable in highly
channelized cases, without the large pressure errors produced by MHM.

Further work is needed to establish new, effective strategies for the construction of
informed spaces. The simple procedures explored in this work have been useful for studying the
optimal distribution of unknowns between interface pressures and fluxes, but the reduction in
the solution global error was not significant, although it shows improved local approximations
for the fluxes in channelized formations. Moreover, it was also shown that the MHM, when the



90 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation

Source: Elaborated by the author.

Figure 30 – Number of GMRES iterations to convergence for all the SPE10 layers with k = 5.

interface spaces are switched from polynomial to informed (with the specific spaces proposed),
exhibits essentially the same flux error but with a noticeable decrease of the pressure error. The
identification of informed spaces with similar positive effects on the MRCM are left for future
studies.



3.5. Concluding remarks 91

Domain decomposition geometries

Source: Elaborated by the author.

Figure 31 – Relative pressure and flux errors and number of GMRES iterations, indicated below the labels,
to convergence for different domain decomposition geometries,indicated at top of each graph
with the number of unknowns being solved in parenthesis, for the layer 36 with k = 5.





93

CHAPTER

4
VELOCITY POSTPROCESSING SCHEMES
FOR THE MULTISCALE ROBIN COUPLED

METHOD FOR CONTAMINANT
TRANSPORT IN SUBSURFACE FLOWS

We propose two postprocessing procedures (Patch method and Stitch method) to re-
cover local conservation of velocity fields produced by multiscale approximations that are only
conservative in coarse scales. These procedures operate on small overlapping regions and are
designed to be implemented in parallel, that makes them relatively inexpensive. We investigate
the applicability of such methods when tested on single-phase flow problems using the Multiscale
Robin Coupled Method (MRCM) in highly heterogeneous permeability fields for modeling the
contaminant transport in the subsurface. Numerical simulations are presented aiming to illustrate
and compare the performance of the new methods with a standard procedure, the Mean method,
in terms of accuracy in contaminant concentration. We show that for a collection of permeability
fields taken as log-normal fields the new postprocessing procedures provide similar or better
accuracy than the Mean method. Then we turn our attention to flows in high-contrast channelized
porous formations, where the new methods robustly yield more accurate results and should thus
be favored.

4.1 Introduction

We are concerned with flows in porous media. The model problem that we consider
consists on the one hand of the second order elliptic Darcy model, whose mixed form is: find u



94
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

and p such that ??????
?????

u = ?K ?p in ?
?·u = f in ?

p = g on ? ?p
u·n?? ? = z on ? ?u

(4.1)

where ? ? Rd , d = 2 or 3 is the computational domain, K is a symmetric, uniformly positive
definite tensor with components in L?(?), u is the Darcy velocity, p is the pressure, f ? L2(?)
the source, g ? H

1
2 (? ?p) the pressure boundary data, z ? H?

1
2 (? ?u) the normal velocity data

and n?? ? is the outer normal to ? ?. On the other hand, given the fluid velocity u as obtained
from (4.1) we solve the transport of a passive tracer or contaminant which is governed by the
scalar hyperbolic conservation law

????
???

? C

? t
+ ? ·(u C ) = 0 in ?

C (x,t = 0) = C0(x) in ?
C (x,t) = CD(x,t) in ? ??

(4.2)

where C is the concentration of the pollutant species, C0 its initial condition and CD the
concentration at the inlet boundaries ? ?? ={x ? ? ?, u·n?? ? &amp;lt;0}.

Nowadays applications of fluid flow in subsurface problems governed by (4.1)-(4.2) or
some variant of it, such as those involving oil and gas production, compositional flow in oil
reservoirs and pollutant transport in aquifers, may require over a billion computational cells to
predict with reasonable accuracy the flow variables. Besides this enormous challenge, uncertainty
quantification studies are necessary to deal with the stochastic nature of the permeability field
and estimate relevant quantities with statistical significance. Multiscale domain decomposition
methods for the simulation of transport in porous media, aiming for high performance and
scalability, have been the focus of intensive research over the last years. The underlying idea is
to decompose the computational domain into non-overlapping subdomains in which local small
problems are solved. This is naturally done in parallel. Recently, in (GUIRALDELLO et al.,
2018b) and (GUIRALDELLO et al., 2018a), we have proposed a new method named Multiscale
Robin Coupled Method (MRCM) as a generalization to the Multiscale Mixed Method (MuMM)
(FRANCISCO et al., 2014), based on a domain decomposition technique introduced originally
by Douglas et al (DOUGLAS et al., 1993), in which the local problems are subject to Robin
type boundary conditions. In the new method we introduce two unknown fields on the so called
skeleton of the domain decomposition, namely, a flux UH and a pressure PH , belonging to some
function spaces of low dimension UH and PH defined over the skeleton, such that continuity of
pressure and flux are weakly enforced. This in turn leads to a system of equations of intermediate
size that couples the solutions over the domains of the decomposition. In a multiscale formulation
like ours, the compatibility conditions are only satisfied at some coarse scale H ? h in order
to alleviate the computational burden. Denoting the skeleton of the decomposition by ? and by



4.1. Introduction 95

(u, p) the multiscale solution, this means that?
?

(
u+?u?

)
·n? MH d? = 0 , ?MH ? PH , (4.3)?

?

(p+? p?)VH d? = 0 , ?VH ? UH , (4.4)

where the + and ? superscripts refer to the two-sided limits approaching ? and n? is a unit vector
normal to ?. In the limit case when H = h we recover the global fine grid solution and continuity
of flux and pressure is satisfied pointwise. Two well known methods, the Multiscale Mortar
Mixed Finite Element Method (MMMFEM) (ARBOGAST et al., 2007) and the Multiscale
Hybrid-Mixed Finite Element Method (MHM) (HARDER; PAREDES; VALENTIN, 2013) can
be obtained as particular cases of the MRCM by suitably defining a parameter ? in the Robin
boundary condition that couples the subdomain solutions, i.e.,

?
? H

Ki(x)
uih ·n?

i + pi =?
? H

Ki(x)
UH n?·n?i + PH (4.5)

where uih is the flux multiscale solution on subdomain ?i and n?
i is the exterior normal to

? ?i. We can move from one method to the other in different parts of the domain without any
implementation effort. Also, there is considerable freedom to select the numerical schemes to
solve the local problems in the subdomains as well as to choose the interface spaces UH and
PH independently from each other. All these features give the possibility of producing more
accurate solutions as compared to other available techniques, as we have numerically shown in
(GUIRALDELLO et al., 2018b; GUIRALDELLO et al., 2018a). The drawback of course is that
fluxes are only conservative at the coarse scale given by the size of the subdomains H, i.e., for
each interface ?i j between subdomains ?i and ? j the following holds?

?i j

uih ·n? d? =
?

?i j

u jh ·n? d?. (4.6)

Fluxes are not in general continuous at the fine level of the discretization on interfaces between
adjacent domains. The velocity field produced by such methods is unsuitable to be used in the
transport equation (4.2). Therefore, some post-processing or downscaling procedure becomes
necessary.

Let us illustrate this with an example. Consider the highly heterogeneous permeability
field displayed in Figure 32. This field exhibits a contrast Kmax/Kmin ? 105 and corresponds
to a log-normal field plus a central channelized region that has been inserted by hand to make
the problem more challenging. In this example, the domain ? = [0,1]× [0,1] is discretized
into 100 × 100 fine grid cells and decomposed into 2 × 2 subdomains.The skeleton of the
decomposition is denoted by ?, which in this particular case is made of the four internal
interfaces between the subdomains. Figure 33 shows the multiscale solution (velocity and
pressure) produced by our method in three different situations, considering interface spaces PH
and UH of very low dimension made up of functions that are constant by parts on each interface.



96
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

Source: Elaborated by the author.

Figure 32 – Permeability field used to illustrate the behavior of the multiscale method.

In the first case (top subfigure), we take the Robin condition parameter very large (? = 106). In
this situation the MRCM retrieves the MHM solution, in which continuity of fluxes is enforced
pointwise, as observed in the insert, whereas continuity of pressure is weakly satisfied according
to (4.4). This leads to a significant pressure jump at the interfaces, also clearly noticeable in
the figure. In the second case we take ? = 1 (middle part). For such intermediate value of the
Robin condition parameter neither flux nor pressure satisfy pointwise continuity. As a result, a
small jump is observed at the interfaces in both multiscale velocity and pressure. For instance,
this is clearly noticed in the right insert, where we have also plotted the flux jump along ?13
which is one of the critical interfaces crossing the high permeability channel. Finally, we take
the algorithmic parameter very small (? = 10?6), such that the method retrieves the MMMFEM
solution, in which the pressure field is continuous, as observed at the bottom of Figure 33, while
the velocity field exhibits very large jumps at the interfaces, also highlighted in the right insert
that shows the flux jump along interface ?13. It becomes evident that in the last two cases some
downscaling or postprocessing procedure on the velocity field is mandatory prior to its use in the
resolution of the transport equation, be it in a multiphase (non-linear) problem or in the linear
case of a passive tracer. This is addressed in this article where two new simple and relatively
inexpensive procedures are proposed, namely the Patch method and the Stitch method, that are
compared to the standard technique of computing the average velocity at interfaces between
subdomains.

After this introduction, the plan of the article is as follows. First, we recall the MRCM



4.1. Introduction 97

MHM - ? = 106

Pressure field

Velocity field

MRCM - ? = 1

-15

-10

-5

0

5

10

15

0 0.2 0.4 0.6 0.8 1

F
lu

x
ju

m
p

Distance along interface ?13

Pressure field

Velocity field

MMMFEM - ? = 10?6

-30

-25

-20

-15

-10

-5

0

5

10

0 0.2 0.4 0.6 0.8 1
Distance along interface ?13

F
lu

x
ju

m
p

Pressure field

Velocity field

Source: Elaborated by the author.

Figure 33 – Multiscale solutions produced by the MRCM method considering different values of the
Robin condition parameter: ? = 10?6 (top), ? = 1 (middle), ? = 106 (bottom).



98
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

method by explaining with some level of detail how the previous example was actually computed.
In section 4.3 the proposed downscaling methods are presented. In the numerical results section
we extensively assess and compare them by solving the transport of a passive tracer by means
of a finite volume method in highly heterogeneous permeability rock formations. Finally, some
conclusions are drawn.

4.2 The Multiscale Robin Coupled method
In this section we recall the main ingredients and some implementation aspects of the

Multiscale Robin Coupled Method method. For further details, such as well-posedness results,
implementation in a variational setting and the possibility of using informed functions to build
up the interface spaces UH and PH the reader is referred to (GUIRALDELLO et al., 2018b;
GUIRALDELLO et al., 2018a).

We begin by introducing some notation. The key ingredient is the discrete solution of
local Darcy problems. Let us consider a rectangular domain ? ?Rd, d = 2,3 and a subdivision
Th made of d-dimensional rectangles. We refer to this partition as the fine grid. The permeability
K and source term f are functions belonging to the space P0(Th), i.e., functions that are constant
by parts on this fine grid. In general, the boundary of ? can be divided into disjoint parts denoted
by ?u,?p,?r in which flux, pressure and Robin boundary conditions are imposed. The problem
reads: Find (uh, ph) such that????????

???????

uh = ?K ? ph in ?
?·uh = f in ?

ph = gp on ?p
uh ·n = gu on ?u

?? uh ·n + p = gr on ?r

. (4.7)

The domain ? can be the domain in which the global problem being considered is posed or
any subdomain made of a collection of fine grid cells, as it will be the case later on when
describing the downscaling procedures. Figure 34 shows the computational domain, the fine
grid discretization and the domain decomposition. For the solution of the Darcy problems we
adopt a standard cell-centered finite volume scheme on rectangular cartesian grids in which we
solve for the cell pressure unknowns pI,J by eliminating the edge flux unknowns uI±12 ,J±

1
2
. A

complete description can be found in (GUIRALDELLO et al., 2018b). For further details and
possible generalizations see e.g. (ARBOGAST; WHEELER; YOTOV, 1997). As mentioned,
there is considerable freedom to choose the local solvers. In principle any finite volume, finite
element or finite difference scheme that delivers the edge fluxes at subdomain interfaces, when
requested by the multiscale method to be described below, can be used.

A non-overlapping domain decomposition of ? into subdomains ?i, i = 1,...,N is
considered. Let us denote by n?i the outer normal to ? ?i and by n? a unique normal to interface



4.2. The Multiscale Robin Coupled method 99

?23

?56

?89

? j ?i

Exterior to ?i

n?

n?i

Exterior to ?min{i, j}
Fine grid Th

? ?

Skeleton ?

?14 ?36?25

n?i

n?i

n?i

n? n?

n?

n?

n?i

I ?1/2,J I + 1/2,J

I,J?1/2

I,JI ?1,J I + 1,J

I,J + 1

I,J?1

I,J + 1/2

Cell pressure pI,J

Edge pressure

?12

?45

?78
?47 ?69

Edge flux uI±12 .J±
1
2

Hh

?58

?1

?i=5

?2

?7

?3

?6

?9?8

?4

Source: Elaborated by the author.

Figure 34 – The computational domain along with the fine grid discretization and the domain decomposi-
tion adopted.

?i j defined such that it points out from the domain with smallest index (i.e., n? = n?min(i, j)).

Our multiscale method can be written as: Find subdomain solutions (uih, p
i
h), i = 1,...,N

and interface fields (UH,PH) satisfying the local problems

????????
???????

uih = ?K ? p
i
h in ?i

?·uih = f in ?i
pih = gp on ? ?i ??p

uih ·n?
i = gu on ? ?i ??u

??iuih ·n?
i + pih = ??iUH n?·n?

i + PH on ? ?i ??

(4.8)

in which the differential operators are replaced by suitable discrete approximations, together



100
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

with the compatibility conditions on the skeleton ????????
??????

N

?
i=1

?
? ?i??

(
uih ·n?

i)
? d? = 0 ,

N

?
i=1

?
? ?i??

?i
(
uih ·n?

i ?UH n?i ·n?
)

? n?i ·n? d? = 0 ,
(4.9)

which must hold for all functions ? ? PH and ? ? UH . The interface flux UH and interface
pressure PH are functions belonging to these spaces which are contained in Fh(Eh) defined as

Fh(Eh) ={ f : Eh ?R | f |e ? P0 , ?e ? Eh} , (4.10)

where Eh is the set of all edges (in 2D) or faces (in 3D) of Th contained in ?. These spaces are
made up at least of the constant function over ?. Equation (4.9) in such case is nothing but the
statement that fluxes and pressures are continuous over ? in the mean sense. A smart definition
of the interface spaces is essential for the resulting accuracy and convergence of the method.
In this article we restrict ourselves to polynomial spaces for simplicity, however some better
strategies were recently devised in (GUIRALDELLO et al., 2018a). As for the Robin condition
parameter ?i on each subdomain, several choices are possible. Based on our previous experience
(see (GUIRALDELLO et al., 2018a)), we adopt

?i(x) =
? H

Ki(x)
(4.11)

where ? is a dimensionless algorithmic parameter that is taken equal to 1 in the numerical
experiments below, H is the characteristic size of the subdomains and Ki(x) is a local permeability.
By changing ? we retrieve the MMMFEM method (? ? 0) and the MHM method (? ? ?).
This has been numerically shown in the authors’ article (GUIRALDELLO et al., 2018b).

Let us explain how the example of the previous section was actually computed by using
the MRCM formulation. First, to solve the problem efficiently we must segregate the resolution
of the subdomain problems from the resolution of the interface unknowns. To that end, on each
subdomain ?i, the solution (uih, p

i
h) of the Darcy problem is decomposed as the sum of two parts

uih = u?
i
h + u?

i
h, p

i
h = p?

i
h + p?

i
h, (4.12)

satisfying the following problems????????
???????

u?ih = ?K ?p?
i
h in ?i

?·u?ih = f in ?i
p? ih = gp on ? ?i ??p

u?ih ·n?
i = gu on ? ?i ??u

??iu?ih ·n?
i + p? ih = 0 on ? ?i ??

, (4.13)



4.2. The Multiscale Robin Coupled method 101

????????
???????

u?ih = ?K ? p?
i
h in ?i

? ·u?ih = 0 in ?i
p? ih = 0 on ? ?i ??p

u?ih ·n?
i = 0 on ? ?i ??u

??iu?ih ·n?
i + p? ih = ??iUH n?·n?

i + PH on ? ?i ??

. (4.14)

It is useful to think the solution u?ih as a function of the interface data (PH,UH). Abusing notation
this will be denoted later on as u?ih(PH,UH). In the example above, the skeleton ? in which the
Robin boundary conditions are being imposed is made of the four internal interfaces as shown in
Figure 32, which are numbered ?12,?34,?13 and ?24.

Now, consider PH = span{?1,...,?NP} and UH = span{?1,...,?NU}, where NP and NU
are the dimensions of the interface spaces. In general, we choose kU and kP degrees of freedom
per interface, therefore the dimensions of these spaces are NP = kP ×NI and NU = kU ×NI ,
being NI the number of elements in the skeleton mesh. The simplest case corresponds to taking
kP = kU = 1 and one element per interface between subdomains, as we have done in the example
above. In such case, the interface spaces are made up of functions that are constant on each
interface ?i j. Let us write the interface fields as linear combinations of the basis functions

PH =
NP

?
k=1

Pk ?k, UH =
NU

?
k=1

Uk ?k. (4.15)

This leads to the linear system of equations to be satisfied by the vector of interface unknown
coefficients X = (P1,...,PNP,U1,...,UNU )

?. This system consists of two blocks of rows and
columns

A X = b ?

?
?? A

PP APU

AU P AUU

?
??
?
??P

U

?
?? =

?
??b

P

bU

?
??. (4.16)

The first block of rows is obtained by taking ? = ?`, ` = 1,...,NP in the first equation of (4.9),
i.e.,

N

?
i=1

?
? ?i??

(
uih ·n?

i)
?` = ?

i j
i&amp;lt;j

?
?i j

(
uih ·n?

i + u jh ·n?
j
)

?` =

= ?
i j

i&amp;lt;j

?
?i j

[(
u?ih(PH,UH)+ u?

i
h
)
·n?i +

(
u? jh(PH,UH)+ u?

j
h

)
·n? j
]

?` =

= ?
i j

i&amp;lt;j

?
?i j

(
u?ih(PH,UH)?u?

j
h(PH,UH)

)
·n? ?` + ?

i j
i&amp;lt;j

?
?i j

(
u?ih ?u?

j
h

)
·n? ?` = 0, (4.17)

where we have emphasized the dependence of u?ih with respect to (PH,UH) and omitted the



102
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

differential d? for conciseness. Using (4.15) we obtain

NP

?
k=1

Pk ?
i j

i&amp;lt;j

?
?i j

Ji j(u?h(?k,0))?`

? ?? ?
APP
`k

+
NU

?
k=1

Uk ?
i j

i&amp;lt;j

?
?i j

Ji j(u?h(0,?k))?`

? ?? ?
APU
`k

=

=??
i j

i&amp;lt;j

?
?i j

Ji j(u?h)?`

? ?? ?
bP
`

, (4.18)

where the symbol Ji j(·) stands for the jump operator at ?i j and is defined for any vector
field v as Ji j(v) = (vi ?v j) · n?. The second block of rows is obtained similarly by taking
? = ?`, ` = 1,...,NU in the second equation of (4.9), i.e.,

N

?
i=1

?
? ?i??

?i
(
uih ·n?

i ?UH n?i ·n?
)

?` n?i ·n? =

= ?
i j

i&amp;lt;j

?
?i j

(
?i uih + ? j u

j
h

)
·n? ?`??

i j
i&amp;lt;j

?
?i j

(
?i + ? j

)
UH ?` =

= ?
i j

i&amp;lt;j

?
?i j

(
?i u?ih(PH,UH)+ ? j u?

j
h(PH,UH)

)
·n? ?` +

+?
i j

i&amp;lt;j

?
?i j

(
?i u?ih + ? j u?

j
h

)
·n? ?`??

i j
i&amp;lt;j

?
?i j

(
?i + ? j

)
UH ?` = 0. (4.19)

Again, inserting (4.15) yields

NP

?
k=1

Pk ?
i j

i&amp;lt;j

?
?i j

(
?i u?ih(?k,0)+ ? j u?

j
h(?k,0)

)
·n? ?`

? ?? ?
AU P
`k

+

+
NU

?
k=1

Uk ?
i j

i&amp;lt;j

?
?i j

[(
?i u?ih(0,?k)+ ? j u?

j
h(0,?k)

)
·n??

(
?i + ? j

)
?k

]
?`

? ?? ?
AUU
`k

=??
i j

i&amp;lt;j

?
?i j

(
?i u?ih + ? j u?

j
h

)
·n? ?`

? ?? ?
bU
`

. (4.20)

Remark 5. Two remarks can be made about (4.18) and (4.20):

i. The functions u?ih(?k,0) and u?
i
h(0,?k) are the solutions to the subdomain problems (4.14)

taking as Robin boundary data (PH,UH) = (?k,0) and (PH,UH) = (0,?k), respectively.
These are, in fact, the so called multiscale basis functions that we have described before in
(GUIRALDELLO et al., 2018b).



4.3. The velocity postprocessing schemes 103

ii. Although not necessary, in this article each of the basis functions ?l and ?` that span
PH and UH is chosen to have as support one single interface ?i j of the mesh skeleton ?,
greatly simplifying the system assembly and leading to a sparse matrix A. Moreover, such
choice for the space PH allows us to obtain a conservative solution at the coarse scale H
for ? &amp;lt;+?, a fact easily verified through expression (4.18).

4.3 The velocity postprocessing schemes
First, let us recall that the multiscale solutions produced by the MRCM are mass-

conserving at the coarse scale of the domain decomposition, i.e., for each interface ?i j between
subdomains ?i and ? j, it holds ?

?i j

(
uih ·n??u

j
h ·n?
)
= 0, ? i, j. (4.21)

The solution is, however, discontinuous at the fine level, except when the algorithmic parameter
? is taken very large as we have illustrated (see Figure 33). Some postprocessing or downscaling
procedure on the velocity field becomes thus essential if transport of any quantity such as a fluid
saturation or the concentration of a passive tracer is to be solved. A natural and simple way to
deal with such discontinuous field is to take the average value of the two-sided solution at the
interfaces between subdomains so as to define a unique flux on the fine grid over the skeleton
of the domain decomposition. Given the multiscale solutions uih, i = 1,...,N, this amounts to
computing in a first step for each ?i j a new interface field defined as

U?i jh
.
=

1
2

(
uih|?i j + u

j
h|?i j

)
. (4.22)

Notice that the new velocity U?i jh transfers the same mass through the interfaces as the two-sided
multiscale solution, i.e., ?

?i j

uih ·n? =
?

?i j

u jh ·n? =
?

?i j

U?i jh ·n?. (4.23)

Once the flux values on every ?i j are updated, we proceed to the second step: for each subdomain
?i, solve ??????

?????
u?ih = ?K ?p?

i
h in ?i,

?·u?ih = f in ?i,
u?ih ·n?

i = uih ·n?
i on ? ?i ?? ?,

u?ih ·n?
i = U?ikh ·n?

i on ?ik,?k,

(4.24)

where index k above runs over all subdomain neighbors to ?i. After these two steps we end
up with a flux field which is conservative on the fine grid and therefore suitable for transport.
We refer to this method as the Mean method. Notice in (4.24) that along ? ?i ?? ? the original
velocity multiscale solution is being imposed as boundary condition. This approach is quite
simple to implement and relatively cheap. The only operation that involves some additional cost
is the solution of subdomain problems (4.24), which can clearly be done in parallel.



104
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

The question considered here is whether alternative methods can be designed that have
complexity similar to that of the Mean method while exhibiting better accuracy. The aim of this
article is precisely to propose two new alternatives to the Mean method, namely, the Patch and
the Stitch methods, which are now explained and later on assessed in the results section.

4.3.1 The Patch method

Let us consider oversampling regions around each interface ?i j covering the skeleton of
the domain decomposition. These regions are called patches and they are made up of a collection
of fine grid cells of the underlying discretization. In our implementation each one covers one
single interface ?i j and has a thickness in the directions perpendicular to ?i j tipically formed by
1 to 3 layers of fine cells, as illustrated in Figure 35. Notice, these regions may intersect each
other. The idea is to solve local Darcy problems on these patches so as to define a unique velocity

u24h ·n?24 = u
4
h ·n?24

u24h ·n?24 = u
2
h ·n?24

u13h ·n?13 = u
3
h ·n?13

u13h ·n?13 = u
1
h ·n?13

?13

u1
2 h
·n?

12
=

u1 h
·n?

12

?24

?34

?12

Steps 1 &amp;amp; 2 - Patch problems and Restriction:

?13

?24

?4 : u4h?3 : u
3
h

u3
4 h
·n?

34
=

u3 h
·n?

34

u3
4 h
·n?

34
=

u4 h
·n?

34

?34

Step 3 - Subdomain problems:

?2 : u?2h?1 : u?
1
h

?3 : u?3h ?4 : u?
4
h

?1 : u1h ?2 : u
2
h?12

u1
2 h
·n?

12
=

u2 h
·n?

12

U?13h ? u
13
h U?

24
h ? u

24
h

U?
12 h
?

u1
2 h

U?
34 h
?

u3
4 h

U?13h

U?12h

U?34h

U?24h

Source: Elaborated by the author.

Figure 35 – The Patch method.

field on each interface ?i j. The procedure can be divided into three steps:



4.3. The velocity postprocessing schemes 105

Step 1 - Patch problems: For each ?i j define a patch ?i j that encloses the interface, formed by a
collection of fine grid elements of ?i and ? j and solve:??????

?????
ui jh = ?K ?p

i j
h in ?i j

?·ui jh = f in ?i j

ui jh ·ni j =

{
uih ·ni j if x ? ?i
u jh ·ni j if x ? ? j

on ? ?i j

, (4.25)

where ni j is the exterior normal vector to ? ?i j.

Step 2 - Restriction: For each interface define a new interface field as the restriction of ui jh to ?i j,
i.e.,

U?i jh
.
= ui jh |?i j . (4.26)

Step 3 - Subdomain problems: Foreach ?i, solve:??????
?????

u?ih = ?K ?p?
i
h in ?i,

?·u?ih = f in ?i,
u?ih ·n?

i = uih ·n?
i on ? ?i ?? ?,

u?ih ·n?
i = U?ikh ·n?

i on ?ik,?k,

(4.27)

where index k above runs over all subdomain neighbors to ?i. This is exactly the same as in
(4.24) with U?i jh replaced by U?

i j
h . After steps 1-3, we end up with a mass-conserving flux field.

The extension to three dimensions is straightforward. One can easily check that the new interface
velocity satisfies ?

?i j

uih ·n? =
?

?i j

u jh ·n? =
?

?i j

U?i jh ·n?, (4.28)

since the solutions of the local problems are obtained by a mass-conserving method and satisfies
the compatibility condition ?

? ?i j

ui jh ·ni j =
?

?i j

f . (4.29)

Also notice that problems (4.25) and (4.27) are undefined up to a pressure constant. The indeter-
minacy is in practice removed by imposing the average pressure field to be zero.

Interestingly, this method can be turned into an iterative scheme by repeating the process
and taking in equation (4.25) (in Step 1) the last computed u?ih instead of the multiscale solution
uih. A few iterations have shown to provide a more accurate result when compared to the fine
grid solution, however, based on our numerical experimentation we have concluded the benefit
brought by such iterative method does not justify the additional computational cost involved.

In the Mean method, the only necessary operation to define a unique flux at the interfaces
is the averaging of the original multiscale flux solution, whereas in the Patch method this is
acomplished by executing Steps 1 and 2, that obviously involve an additional cost. However, the



106
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

local patch problems are in general small as compared to the subdomain problems, whose resolu-
tion is part of both methods and dominates the overall computational cost of the downscaling
procedures. All these tasks can always be executed efficiently in parallel.

4.3.2 The Stitch method

We propose another method based on the idea of solving local problems on patches
around the interfaces of the domain decomposition. Informally speaking, in this method, instead
of recomputing the solutions over the subdomains, we simply “stitch" the local patch solutions
to the global multiscale solution. In order to proceed we must first distinguish two situations:
(i) Overlapping patches; and (ii) Non-overlapping patches. The first case, is the one to be
adopted if using non-simplicial grids for discretization in the subdomains, as is the case in our
implementation that uses rectangular cartesian grids. The second case is feasible when using
simplicial grids for discretization. These two situations are illustrated in Figure 36.

?3 ?4

?1 ?2

?3 ?4

?1 ?2

Non-simplicial mesh - Overlapping domains Simplicial mesh - Non-overlapping domains

?34

?12

?34

?12

?13 ?24?13 ?24

Source: Elaborated by the author.

Figure 36 – Examples of patch definitions for the Stitch method. Overlapping domains with non-simplicial
mesh (left) and non-overlapping domains with simplicial mesh (right).

Let us consider the first case of overlapping patches. In such case, in order to produce
a mass-conserving solution, the local patches need to be separated into disjoint sets. This can
in principle be done in an arbitrary way. In our implementation, for the sake of simplicity we
separate into two sets: the sets of horizontal and vertical patches, as displayed in Figure 37. In
this case, the downscaling method proceeds as follows:

Step 1 - Horizontal patch problems: For each horizontal interface ?i j define a patch ?Hi j that
encloses the interface, formed by a collection of fine grid elements of ?i and ? j and solve:??????

?????
ui j,Hh = ?K ? p

i j,H
h in ?

H
i j

?·ui j,Hh = f in ?
H
i j

ui j,Hh ·ni j =

{
uih ·ni j if x ? ?i
u jh ·ni j if x ? ? j

on ? ?Hi j

, (4.30)

where ni j is exterior normal vector to ? ?Hi j.



4.3. The velocity postprocessing schemes 107

u?ih = u
i
h in ?i??

H
ik

u?ih
.
= ui j,Hh in ??i??

H
ik

u?ih = u?
i
h in ?i??

V
ik

u?ih
.
= ui j,Vh in ??i??

V
ik

Step 1 - Solve horizontal patches:

u13,Hh ·n?13 = u
3
h ·n?13

?
H
13

?2 : u2h?1 : u
1
h

?
H
24

?3 : u3h ?4 : u
4
h

Step 3 - Solve vertical patches:

?2 : u?2h?1 : u?
1
h

Step 4 - Stitch vertical solutions:

?3 : u?3h

?4 : u?4h?
V
34

?2 : u?2h

Step 2 - Stitch horizontal solutions:

u1
2,

V
h
·n?

12
=

u?1 h
·n?

12

u13,Hh ·n?13 = u
1
h ·n?13

?1 : u?1h ?
V
12

u3
4,

V
h
·n?

34
=

u?3 h
·n?

34

u3
4,

V
h
·n?

34
=

u?4 h
·n?

34

?
H
13

?
H
24

?3 : u?3h

?4 : u?4h

?
V
34

?
V
12

u1
2,

V
h
·n?

12
=

u?2 h
·n?

12

u24,Hh ·n?24 = u
4
h ·n?24

u24,Hh ·n?24 = u
2
h ·n?24

?
V
12

?
V
34

?
H
13 ?

H
24

Source: Elaborated by the author.

Figure 37 – The Stitch method.

Step 2 - Stitch horizontal solutions: For each subdomain ?i, take:

u?ih
.
= uih in ?i??

H
ik,

u?ih
.
= ui j,Hh in ??i ??

H
ik,
?k (4.31)

where index k runs over all horizontal patches that intersect with ?i.

Step 3 - Vertical patch problems: For each vertical interface ?i j define a patch ?Vi j that encloses
the interface, formed by a collection of fine grid elements of ?i and ? j and solve:??????

?????
ui j,Vh = ?K ?p

i j,V
h in ?

V
i j

?·ui j,Vh = f in ?
V
i j

ui j,Vh ·ni j =

{
u?ih ·ni j if x ? ?i
u? jh ·ni j if x ? ? j

on ? ?Vi j

, (4.32)

Step 4 - Stitch vertical solutions: For each subdomain ?i, take:

u?ih
.
= u?ih in ?i??

V
ik,

u?ih
.
= ui j,Vh in ??i ??

V
ik,
?k (4.33)



108
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

where index k runs over all vertical patches that intersect with ?i. After steps 1-4 we end up
with a velocity field u?ih which is mass-conserving on the fine grid and continuous at subdomain
interfaces. The extension to three dimensions is straightforward.

In the second aforementioned situation of non-overlapping patches the computation can
be done all at once, i.e., in a first step all patches are solved simultaneously and, in a second step,
the solutions are stitched in order to produce a mass-conserving global solution. This last case
has not been implemented and its assessment is left for future works.

This method is perhaps the most attractive one in regards to computational cost, since it
does not require solution of the subdomain problems, but only resolution of local small patch
problems around the interfaces.

4.4 Numerical set-up

In order to compare the downscaling schemes under the same conditions we consider
the transport of a passive tracer in highly heterogeneous permeability fields K(x). Two types
of absolute permeability fields are considered here, the first being the log-normal, K(x) =
exp(? ? (x)), in which ? (x) is a Gaussian field and ? a constant value chosen that controls the
contrast, i.e., Kmax/Kmin. Here, ? (x) is characterized by its mean value µ? and an exponential
anisotropic covariance function given by

C? (r) = ?
2
?

e(?r),

where ?? is a constant variance and r =
?

r21/Ix + r
2
2/Iy with Ix and Iy being correlation lengths

and r1 and r2 the two-point separation distance in longitudinal and transverse direction, respec-
tively. To generate these log-conductivity fields we have used the Hydro-Gen package (BELLIN;
RUBIN, 1996). The second type considered are the layers of the SPE10 project that is highly
heterogeneous and presents channelized structures.

In all the numerical experiments the domain is a 2D region ? = [0,Lx]×[0,Ly]. For the
Darcy problem no-flow boundary conditions are considered at y = 0 and y = Ly and inflow-
outflow boundary conditions are imposed at x = 0 and x = Lx, respectively.

For the MRCM we have considered piecewise polynomial functions both for the pressure
space PH and for the flux space UH . In fact, we use elementwise constant fine grid representation
of polynomials over the interface elements

UH = {VH, VH|e = ?0(q),q ?PkU?1(e), e ? TH},

PH = {MH, MH|e = ?0(q),q ?PkP?1(e), e ? TH},

where Pl , is the space of polynomials of degree ? l and ?0 is the L2–projection of a function Pl(e)
onto the space Fh(e), e ? TH . In the numerical results section the experiments are performed



4.5. Numerical Results 109

by choosing a total number of degrees of freedom per interface k = kU + kP. Although not
mandatory, this number will be the same for all interfaces. Also, for simplicity, the number of
fine grid elements per interface N f is chosen to be the same for all interfaces. In such case the
order reduction obtained by our multiscale method is simply computed as 100×(N f ?k)/N f .

For the transport problem we assume a water saturated field (C (x,t0) = 0,x ? ?) with a
passive tracer injected on x = 0 at time t = t0, carried by the flow for t &gt; t0. In order to solve the
transport equation a classical upwind scheme combined with a TVD Runge-Kutta of second order
in time is adopted for discretization. Let us provide some details about the scheme. Given the fine
grid partition Th of ?, a cell-centered finite volume scheme is considered for the concentration
unknowns. For each fine grid element of Th, Vi, i = 1,...,m, the discrete concentration field Ch
satisfies

d
dt

?
Vi

Ch dV =? ?
E??Vi

?
E
Ch|E u?h ·? dS, (4.34)

where u?h is the postprocessed multiscale velocity field, which is already given at the edges of
Vi and ? is the outer normal to ?Vi. As mentioned, for the edge concentration Ch|E the upwind
value is taken. This leads to the semi-discrete system

d
dt

C = F (C),

where C ? Rm and Ci = 1|Vi|
?

Vi
Ch dV . Applying a TVD Runge-Kutta scheme of second order

((GOTTLIEB; SHU, 1998)) a fully-discrete system is obtained. Defining the time step ? t, the
unknown vector at time level n + 1 is obtained from

C(n+1) =
1
2

Cn +
1
2

C*+
1
2

? t F (C*), (4.35)

where
C* = Cn + ? t F (Cn). (4.36)

4.5 Numerical Results
We begin this section by assessing the coupling between the multiscale solution of the

MRCM and the postprocessing schemes. Two types of domain decomposition are considered in
combination with different interface spaces. These results allow us to define the MRCM parame-
ters and evaluate the error produced by increasing the size of the patches in the postprocessing
schemes. Based on these results, we choose a patch size and repeat the previous experiment for a
collection of permeability fields with the same covariance function as well as for permeability
fields taken from the SPE10 project. From these we obtain some metrics for the error of the
schemes. Finally, we evaluate the error and the convergence order of downscaling schemes
coupled with the MMMFEM, the MHM, and the MRCM with enriched interface spaces for
permeability fields with and without channel structures.



110
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

In this section the downscaling methods are assessed in terms of the L2(?) relative error
norm of the tracer concentration, defined as

Ec(t?) =
?Cmsc(x, t?)?C f ine(x, t?)?L2(?)

?C f ine(x, t?)?L2(?)
,

in which Cmsc(x,t) is the result obtained by using the postprocessed flux multiscale solution and
C f ine(x,t) is the result obtained by using the fine grid flux solution.

4.5.1 First approach

We start by considering a domain ? with dimensions Lx = Ly = 1 and square fine
elements of size h = 1/120. For the absolute permeability field K(x) = exp(? ? (x)), we set ? (x)
with Ix = 5×h, Iy = 12×h, µ? = 0 and ?? = 1 and take ? = 2, leading to a contrast of order
Kmax/Kmin ? 106. The domain is decomposed into 4×4 and 8×8 square subdomains of size
H = 30h and H = 15h, respectively. For the interface spaces we have considered k = 2,3,4.
Table 2 displays the order reduction obtained by the multiscale method for the above cases.

# of dof’s per interface k
2 3 4

4×4 93.3% 90.0% 86.7%
8×8 86.7% 80.0% 73.3%

Table 2 – Order reduction for the multiscale solutions of the first numerical experiment.

Source: Elaborated by the author.

The degrees of freedom (dof ’s) are distributed in the possible combinations such that
kP + kU = k and the patches’ thicknesses are taken as two fine elements in the downscaling
schemes. The transport equation is solved with ? t = 10?5, that satisfies a CF L condition for all
the problems considered here, from t0 = 0 to tMAX = 1. Figure 38 displays the concentration
transported by the fine solution and the concentration transported by the multiscale solution with
k = 2 and the downscaling schemes at time t = 0.5 for the 4×4 decomposition. The relative
errors from t0 to tMAX are shown in Figure 39. One can note in the considered cases that the
Patch scheme consistently has the smallest errors when compared to the other two schemes.
Also, the Stitch scheme presents larger errors when the multiscale method has kP = kU = 1 for
the 4×4 domain decomposition and kU &gt; kP and presents similar errors to the Mean scheme in
all other cases.

From our experience, the precision of the postprocessing schemes depends on the
accuracy of the multiscale solution. With this observed we set the MRCM with kP = kU = 2
and a 4×4 domain decomposition, where the schemes have similar errors and the multiscale
solution has a reduced computational cost, to further assess the downscaling schemes.

Now we evaluate the impact of the patch thickness on the error of the Patch and Stitch
schemes. We take the problem defined above and increase the thickness from 2 fine elements to



4.5. Numerical Results 111

Fine Sol.

Msc. Sol.
+ Patch

Msc. Sol.
+ Mean

Msc. Sol.
+ Stitch

Source: Elaborated by the author.

Figure 38 – Concentration at time t = 0.5 for the fine solution and multiscale solution with k = 2.

10 fine elements. Results are shown in Figure 40. Larger patches lead to smaller errors in both
schemes, but the gain in accuracy is not significant after about 6 fine elements. To keep the patch
problems small relative to the subdomain problems, we set patches with 4 elements.

Figure 41 displays the relative error of the flux field for the multiscale solution and the
relative errors after the postprocessing schemes. As is well known, multiscale methods based on
non-overlapping domain decomposition have larger errors at the interfaces between subdomains,
where the coupling is done through low order spaces, as shown in the left top of Figure 41.
From this experiment we observed that the Mean scheme, despite generating a continuous field,
maintains existing errors at the interfaces. The scenario is different for the Patch and Stitch
schemes, in which the patches include information from within the subdomains. The errors are
greatly reduced at the interfaces and only remain concentrated at the corners of the domain
decomposition.



112
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

Source: Elaborated by the author.

Figure 39 – Relative concentration errors for k = 2,3,4 and two domain decomposition: 4×4 (left column)
and 8×8 (right column) for the downscaling schemes, the Mean (red line), the Patch (green
line) and the Stitch (blue line).



4.5. Numerical Results 113

Source: Elaborated by the author.

Figure 40 – Relative errors of the Patch (left) and the Stitch (right) for different patch sizes and the relative
error of the Mean scheme (red line).

Msc. Sol.

Msc. Sol.
+ Patch

Msc. Sol.
+ Mean

Msc. Sol.
+ Stitch

Source: Elaborated by the author.

Figure 41 – Relative velocity field error to the maximum absolute velocity value of the fine solution w/o
downscaling.



114
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

4.5.2 Robustness

To check the robustness of the downscaling schemes we generate new log-conductivity
fields, ? j(x), j = 1,...,100, with the same properties described in the last section for different
seeds, thus generating fields with similar structures distributed in spatially distinct patterns. With
that we define new permeability fields K j(x), also taking ? = 2 and redo the last experiment
from the previous section for each j = 1,...,100. In Figure 42 we show some examples of these
fields. Figure 43 displays the mean error of all these simulations for each time t as well as the

Source: Elaborated by the author.

Figure 42 – Examples of permeability fields generated by the log-conductivity functions with different
seeds.

maximum and minimum errors and the maximum standard deviation over all the time steps.

The Patch scheme still displays smaller errors than the other two schemes for all error
measures. Similar errors in average for the Stitch and the Mean schemes are observed, although
the Stitch has larger maximum errors and a standard deviation almost 1.5 times larger than the
other schemes.



4.5. Numerical Results 115

Source: Elaborated by the author.

Figure 43 – Relative mean error µ at each time t for the permeability fields K j(x), j = 1,...,100, and
the maximum standard deviation ? over t. Shaded area denotes the maximum and minimum
error region.

For the next numerical experiment we take 2D layers of the SPE10 project (CHRISTIE;
BLUNT, 2001) as permeability fields in a rectangular domain with dimensions Lx = 11/3
and Ly = 1. There are 85 highly heterogeneous layers in the SPE10 project. Layers 1 to 35
have structures similar to those of the fields previously explored and layers 36 to 85 have high
correlation channels that pose realistic challenges and are commonly used for the evaluation
of numerical methods in oil reservoir simulation. In Figure 44 we show two examples of these
layers, with and without channel structures.

These fields are defined in a fine mesh with 220×60 elements. For the multiscale method
the domain is decomposed into 11×3 subdomains, each one with a fine mesh of 20×20 square
elements of size h = 1/60. In this case the order reduction of the multiscale method is 80%.
Figure 45 shows the solution of the transport equation at the breakthrough time for the fine



116
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

Source: Elaborated by the author.

Figure 44 – Examples of permeability fields from SPE10 project: layer 20 (top) and layer 36 (bottom).

solution and for the multiscale solution with the Stitch scheme. Figure 46 shows the maximum
relative error among all time steps, to to tMAX for each layer.

By looking at the concentration error it is easy to note the transition from layers without
channels, where errors stay between 5% and 10%, to layers with channels, where errors range
from 10% to 30%, as displayed in Figure 46. For the downscaling schemes, the Patch shows the
smallest errors and the Stitch provides intermediate errors between the Patch and Mean for all
layers, although the errors for layers with channelized structures are similar. In Table 3 we show
the mean error and the standard deviation for the cases with and without channels.

Layers ? 35 Layers ? 36
µ ? µ ?

Patch 0.0330 0.0104 0.1245 0.0479
Stitch 0.0488 0.0137 0.1438 0.0486
Mean 0.0855 0.0170 0.1958 0.0467

Table 3 – Mean µ errors and the standard deviation ? of the SPE10 layers.

Source: Elaborated by the author.



4.5. Numerical Results 117

Source: Elaborated by the author.

Figure 45 – Concentrations at breakthrough time for the fine solution (top) and the multiscale solution
with k = 4 and the Stitch scheme (bottom) for layer 36.

Source: Elaborated by the author.

Figure 46 – Maximum relative error over t of the downscaling schemes, the Mean (red line), the Patch
(green line) and the Stitch (blue line) for all layers of the SPE10 project. The dashed line
indicates where the layers with channels begins.

4.5.3 Comparison of multiscale methods

As mentioned earlier, the MRCM generalizes a family of multiscale methods and among
them are the MMMFEM (? = 0) and the MHM (? ?+?). Taking advantage of this fact, we now
compare the concentration errors of the postprocessing schemes when combined with the above
multiscale methods for a collection of k values. From these results we will estimate a convergence



118
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

order of the schemes when combined with these multiscale methods. Although the MHM
multiscale solution has naturally a continuous flux field without the need of a postprocessing
scheme, we apply them in order to assess whether there is an improvement in terms of accuracy.
Note that the Mean scheme does not change the MHM multiscale solution.

For the MRCM, we choose to keep the equidistribution of degrees of freedom between
pressure and flux interface spaces, i.e., if we take k = 4, both pressure and flux interface spaces
have linear functions per interface. On the other hand, the MMMFEM and the MHM with
k = 4 are defined with cubic functions by interfaces in the pressure interface space and in the
flux interface space, respectively. The experiment is performed using two types of permeability
fields. For the first we use ? (x) with ? = 2 to define the permeability field K(x) = exp(? ? (x))
in ? = [0,1]× [0,1] decomposed into 8×8 subdomains, each subdomain with a fine mesh of
15×15 square elements of size h = 1/120. For the second type we take layer 36 of the SPE10
project and use the same configuration as the last experiment of the previous section. Figure
47 shows the maximum concentration error over time from k = 2 until k = 10 for the above
permeability fields. Table 4 displays the order reduction obtained by the multiscale methods.

# of dof’s per interface k
2 4 6 8 10

Log-normal 86.7% 73.3% 60.0% 46.7% 33.3%
Layer 36 90.0% 80.0% 70.0% 60.0% 50.0%

Table 4 – Order reduction obtained by the multiscale method by enriching the interface spaces.

For the log-normal field (left column on Fig.47) the smallest errors are obtained by
the MMMFEM with all the downscaling schemes followed by the MRCM, with similar errors
for k = 2 in all multiscale methods. In this type of permeability field the MMMFEM shows a
quadratic convergence order when combined with the Patch and Stitch schemes that drops to 1.5
when combined with the Mean scheme. On the other hand, the MRCM shows a 1.5 convergence
order when combined with the Patch and Stitch schemes that drops to linear when combined
with the Mean scheme and the MHM shows a convergence order of 0.5 when combined with all
the downscaling schemes.

For layer 36 (right column of Fig.47) the MMMFEM shows a quadratic numerical
convergence when combined with the Patch scheme, that drops to 1.5 with the Stitch scheme
and again drops to 0.5 when combined with the Mean scheme. The convergence order for the
MRCM drops to 0.5 in combination with all the downscaling schemes, the same convergence
order obtained for the MHM. A summary of convergence orders are depicted in Table 5.

4.6 Concluding remarks
We have started by recalling the main ingredients and implementation aspects of the

recently proposed Multiscale Robin Coupled Method (MRCM). After that, we have proposed



4.6. Concluding remarks 119

Source: Elaborated by the author.

Figure 47 – Maximum relative errors over time t of the MRCM, MMMFEM and MHM for the log-normal
field (left column) and the Layer 36 (right column) for enriched interface spaces.

two postprocessing methods to recover mass-conserving velocity fields from multiscale solutions
that are only conservative in coarse scales. The new methods were compared with a standard
method of the literature in terms of accuracy of the transport of contaminant in subsurface.
Two types of very heterogeneous permeability fields were considered, the ones generated with
the Hydro-Gen package and the fields given by the SPE10 project. Initially, the comparison
was carried out with solutions produced by the MRCM with a set of predefined parameters.
Thereafter, by suitable choices of the parameter ? , we have compared the performance of the
postprocessing procedures with solutions produced by the MMMFEM, the MRCM and the
MHM with the same order reduction.

The numerical results indicate that the Patch method consistently has the smallest errors,



120
Chapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant

transport in subsurface flows

Log-normal Layer 36
Patch Stitch Mean Patch Stitch Mean

MRCM O(k?1.5) O(k?1.5) O(k?1.0) O(k?0.5) O(k?0.5) O(k?0.5)
MMMFEM O(k?2) O(k?2.0) O(k?1.5) O(k?2.0) O(k?1.5) O(k?0.5)

MHM O(k?0.5) O(k?0.5) O(k?0.5) O(k?0.5) O(k?0.5) O(k?0.5)
Table 5 – Convergence order on concentration for the multiscale methods in two types of permeability

fields.

Source: Elaborated by the author.

followed by the Stitch method (which is the least expensive of the three) and then the Mean
method. These results were very robust for the two types of permeability fields considered.
Furthermore, the new methods have reduced the velocity error at subdomain interfaces of the
multiscale approximations, a task not accomplished by the Mean method.

Combining the Patch method with the MMMFEM proved to be the most accurate proce-
dure in channelized fields, although significant differences in accuracy with other postprocessing
schemes were only attained for multiscale solutions with order reduction less than or equal to
65%. In the more interesting cases with order reduction above 75% the Stitch method provides
comparable accuracy and thus provides the best compromise between computational cost and
precision.



121

CHAPTER

5
MAIN RESULTS AND FUTURE WORK

In this section the main result obtained are summarized and future works are discussed.

5.1 Main contributions
The main contributions of this project can be summarized as:

? A new multiscale mixed method was proposed, the Multiscale Robin Coupled Method for
subsurface flows.

– Formal well-posedness is proved;

– Provides a variational formulation for the Two-Lagrange-Multiplier domain decom-
position method;

– Allows for independent choices for interface spaces;

– Generalize existing multiscale methods of the literature;

– First assessment of the MHM with H(div) subelement grid discretization;

– Suitable choice of the parameter ? produces more accurate results when compared
to existing methods in realistic high-channelized porous formations.

? The accuracy of the MRCM is assessed for two types of interface spaces: piecewise
polynomial and informed spaces.

– Provides a strategy to build-up the informed spaces;

– Show improved local approximations for fluxes in channelized formations;

– First comparison of the MMMFEM, MRCM and MHM in terms of accuracy with
polynomial and informed spaces;

– First assessment of the MHM with informed spaces;



122 Chapter 5. Main results and future work

– Fully defines the parameters of the MRCM (? ,PH,UH ) given a multiscale reduction,
k dof ’s in this case, leading to a competitive method when compared to similar
methods of the literature.

– MRCM shows less iterations of GMRES to attain a given tolerance when compared
to the MMMFEM and the MHM.

? Two new strategies to recover local mass conservation of multiscale solution that are only
conservative on coarse scales were proposed and compared with a standard method of the
literature in terms of accuracy in contaminant transport.

– New methods reduce the flux error between subdomains of the multiscale approxi-
mations;

– Improved precision compared to the Mean method with similar/reduced computa-
tional cost.

5.1.1 Future work

Recently, in (GUIRALDELLO et al., 2018b) and (GUIRALDELLO et al., 2018a), an
exhaustive assessment of the MRCM has been presented. However, several improvements are
still under investigation, some of them we intend to address in a postdoc project. The main topics
we are concerned are: (i) improved choices of interface spaces; (ii) extension of the method to a
multilevel/multigrid context so as to accelerate convergence of iterative methods; (iii) 3D HPC
implementation of the MRCM. In what follows we provide an overview of what we intend to
survey and some of the expected results.

5.1.1.1 New informed spaces - LOD

In the original implementation of the MRCM (see (GUIRALDELLO et al., 2018b)), we
have considered piecewise polynomial spaces over the skeleton ? of the domain decomposition,
both for pressure PH and flux UH . This choice is standard for a first exploration of a multiscale
method, since it allows rigorous analysis. For highly heterogeneous media an alternative are
informed spaces, in which fine-mesh solutions are precomputed at some neighborhood (oversam-
pling) of the subdomain and/or the interface between subdomains. From these solution, some
dimensionality reduction technique is applied to build PH and UH . The MRCM with informed
spaces was first explored in (GUIRALDELLO et al., 2018a).

We intend to study and establish new strategies for the construction of informed spaces
by exploring new regions of oversampling, new strategies to compute the offline spaces and basis
reduction methods, seeking for accuracy improvements for the 2D case and possibly extending
to 3D.



5.1. Main contributions 123

The informed spaces described above are constructed in an offline stage. Recently in the
literature the concept of online spaces has been explored (CHUNG; EFENDIEV; LEUNG, 2018)
where the informed spaces are constructed from multiscale solutions of low computational cost,
so as to include global information as boundary condition in the oversampling problem. This in
turn leads to procedures that allow to enrich the interface spaces iteratively.

5.1.1.2 A Multilevel MRCM

The size of the interface linear system involved in the MRCM depends on the dimensions
of the coarse interface spaces UH and PH . A reasonable multiscale approximation to the true
(fine grid) solution can be obtained by suitably choosing the interface spaces to be of sufficiently
large dimension (see (ARBOGAST; XIAO, 2015)). In the three dimensional case this may end up
leading to a linear system of intermediate size whose resolution still requires an efficient linear
solver. Available linear algebra packages, generally provides several preconditioned Krylov
based iterative methods that can be used for such purpose.

We intend to explore other alternatives that have the potential to solve the problem more
efficiently, namely

(i) Multilevel/Multigrid linear solvers based on successive refinements/coarsening of the
interface spaces UH and PH ;

(ii) Use of the MRCM as a preconditioner of the fine grid problem into a Krylov based iterative
solver.

5.1.1.3 3D HPC implementation

In (GUIRALDELLO et al., 2018b) and (GUIRALDELLO et al., 2018a) the implementa-
tion has been restricted to the two dimensional case. An important point is the extension of these
methods to three-dimensional case into a high-performance environment aiming to solve large
size reservoirs, containing up to 1 billion computational cells, so as to deal with the unusual thick
Brazil’s reservoirs in the pre-salt layer and capture the severe heterogeneity of the permeability
field.





125

BIBLIOGRAPHY

AARNES, J. E. On the Use of a Mixed Multiscale Finite Element Method for Greater Flexibility
and Increased Speed or Improved Accuracy in Reservoir Simulation. SIAM Multiscale Model.
Simul., v. 2, n. 3, p. 421–439, 2006. Citation on page 27.

ARAYA, R.; HARDER, C.; PAREDES, D.; VALENTIN, F. Multiscale hybrid-mixed method.
SIAM J. Numer. Anal., v. 51, n. 6, p. 3505–3531, 2013. Citations on pages 31, 37, and 70.

ARBOGAST, T. Analysis of a Two-scale, Locally Conservative Subgrid Upscaling for Elliptic
Problems. SIAM J. Numer. Anal., v. 42, p. 576–598, 2004. Citation on page 28.

ARBOGAST, T.; COWSAR, L. C.; WHEELER, M. F.; YOTOV, I. Mixed finite element methods
on nonmatching multiblock grids. SIAM J. Numer. Anal., v. 37, n. 4, p. 1295–1315, 2000.
Citations on pages 31, 32, 39, 43, 50, and 55.

ARBOGAST, T.; PENCHEVA, G.; WHEELER, M. F.; YOTOV, I. A multiscale mortar mixed
finite element method. SIAM Multiscale Model. Simul., v. 6, n. 1, p. 319–346, 2007. Citations
on pages 28, 30, 32, 36, 55, 70, and 95.

ARBOGAST, T.; WHEELER, M. F.; YOTOV, I. Mixed finite elements for elliptic problems
with tensor coefficients as cell-centered finite differences. SIAM J. Numer. Anal., v. 34, n. 2, p.
828–852, 1997. Citations on pages 31, 32, 45, 46, and 98.

ARBOGAST, T.; XIAO, H. Two-level mortar domain decomposition preconditioners for het-
erogeneous elliptic problems. Computer Methods in Applied Mechanics and Engineer-
ing, v. 292, p. 221 – 242, 2015. ISSN 0045-7825. Special Issue on Advances in Simula-
tions of Subsurface Flow and Transport (Honoring Professor Mary F. Wheeler). Available:
&lt;http://www.sciencedirect.com/science/article/pii/S0045782514004198&gt;. Citation on page 123.

BABUSKA, I.; OSBORN, E. Generalized finite element methods: Their performance and their
relation to mixed methods. SIAM J. Numer. Anal., v. 31, p. 510–536, 1983. Citations on pages
27 and 71.

BARANGER, J.; MAITRE, J.-F. c.; OUDIN, F. Connection between finite volume and mixed
finite element methods. ESAIM: Mathematical Modelling and Numerical Analysis - Modéli-
sation Mathématique et Analyse Numérique, Dunod, v. 30, n. 4, p. 445–465, 1996. Available:
&lt;http://www.numdam.org/item/M2AN_1996__30_4_445_0&gt;. Citations on pages 31 and 32.

BELGACEM, F. The mortar finite element method with Lagrange multipliers. Numer. Math.,
v. 84, n. 2, p. 173–197, 1999. Citations on pages 31, 37, and 43.

BELLIN, A.; RUBIN, Y. Hydro_gen: A spatially distributed random field generator for correlated
properties. Stochastic Hydrology and Hydraulics, v. 10, n. 4, p. 253–278, Nov 1996. ISSN
1435-151X. Available:&amp;lt;https://doi.org/10.1007/BF01581869&gt;. Citation on page 108.

BERNARDI, C.; MADAY, Y.; PATERA, A. T. A new nonconforming approach to domain
decomposition: The mortar element method. In: Nonlinear Partial Differential Equations

http://www.sciencedirect.com/science/article/pii/S0045782514004198
http://www.numdam.org/item/M2AN_1996__30_4_445_0
https://doi.org/10.1007/BF01581869


126 Bibliography

and their Applications. Collège de France Seminar, volume XI. Lectures presented at the
weekly seminar on applied mathematics, Paris, France, 1989-1991. [S.l.]: Harlow: Longman
Scientific &amp;amp; Technical; New York: John Wiley &amp;amp; Sons, Inc., 1994. p. 13–51. ISBN 0-582-23800-
5/pbk; 0-470-23367-2/pbk. Citations on pages 31 and 37.

BLANCO, P.; LEIVA, J.; BUSCAGLIA, G. C. A black-box decomposition approach for coupling
heterogeneous components in hemodynamics simulations. Int. J. Numer. Method. Biomed.
Eng., John Wiley &amp;amp; Sons, Ltd, v. 29, n. 3, p. 408–427, 2013. ISSN 2040-7947. Available:
&lt;http://dx.doi.org/10.1002/cnm.2519&gt;. Citation on page 40.

BOSMA, S.; HAJIBEYGI, H.; TENE, M.; TCHELEPI, H. Multiscale finite volume method
for discrete fracture modeling on unstructured grids (MS-DFM). Journal of Computational
Physics, v. 351, p. 145 – 164, 2017. ISSN 0021-9991. Available:&amp;lt;http://www.sciencedirect.
com/science/article/pii/S0021999117306927&gt;. Citations on pages 28 and 71.

BREZZI, F.; DOUGLAS, J.; DURÁN, R.; FORTIN, M. Mixed finite elements for second order
elliptic problems in three variables. Numerische Mathematik, v. 51, n. 2, p. 237–250, 1987.
ISSN 0945-3245. Available:&amp;lt;http://dx.doi.org/10.1007/BF01396752&gt;. Citation on page 31.

BREZZI, F.; DOUGLAS, J.; FORTIN, M.; MARINI, L. D. Efficient rectangular mixed finite
elements in two and three space variables. ESAIM: Mathematical Modelling and Numerical
Analysis - Modélisation Mathématique et Analyse Numérique, Dunod, v. 21, n. 4, p. 581–
604, 1987. Available:&amp;lt;http://eudml.org/doc/193515&gt;. Citation on page 31.

BREZZI, F.; DOUGLAS, J.; MARINI, L. D. Two families of mixed finite elements for second
order elliptic problems. Numer. Math., v. 47, p. 217–236, 1985. Citations on pages 31 and 37.

BREZZI, F.; FORTIN, M. Mixed and Hybrid Finite Elements Methods. Springer-Verlag,
1991. (Springer series in computational mathematics). ISBN 9780387975825. Available:&amp;lt;https:
//books.google.com.br/books?id=yYwZAQAAIAAJ&gt;. Citation on page 31.

CALO, V. M.; EFENDIEV, Y.; GALVIS, J.; GHOMMEM, M. Multiscale empirical interpolation
for solving nonlinear pdes using generalized multiscale finite element methods. arXiv preprint
arXiv:1407.0103v1, 2014. Citation on page 72.

CALO, V. M.; EFENDIEV, Y.; GALVIS, J.; LI, G. Randomized oversampling for generalized
multiscale finite element methods. SIAM Multiscale Model. Simul., v. 14, n. 1, p. 482–501,
2016. Citations on pages 72 and 77.

CHAVENT, G.; JAFFRÉ, J. Mathematical Models and Finite Elements for Reservoir Simu-
lation - Single phase, Multiphase and Multicomponent Flows through Porous Media. [S.l.]:
North-Holland, 1986. (Studies in Mathematics and its Applications). Citations on pages 26, 31,
and 32.

CHEN, W.; GUNZBURGER, M.; HUA, F.; WANG, X. A Parallel Robin-Robin Domain Decom-
position Method for the Stokes-Darcy System. SIAM J. Numer. Anal., v. 49, n. 3, p. 1064–1084,
2011. Citation on page 30.

CHEN, Z. Finite Element Methods and Their Applications. Springer Berlin Heidelberg,
2005. (Scientific Computation). ISBN 9783540240785. Available:&amp;lt;https://books.google.com.
br/books?id=DEGlOJ1KZOwC&gt;. Citation on page 26.

http://dx.doi.org/10.1002/cnm.2519
http://www.sciencedirect.com/science/article/pii/ S0021999117306927
http://www.sciencedirect.com/science/article/pii/ S0021999117306927
http://dx.doi.org/10.1007/BF01396752
http://eudml.org/doc/193515
https://books.google.com.br/books?id=yYwZAQAAIAAJ
https://books.google.com.br/books?id=yYwZAQAAIAAJ
https://books.google.com.br/books?id=DEGlOJ1KZOwC
https://books.google.com.br/books?id=DEGlOJ1KZOwC


Bibliography 127

. Mathematical Techniques in Oil Recovery. [S.l.]: Siam, 2007. (Reservoir Simulation).
Citation on page 26.

CHEN, Z.; HOU, T. Y. A Mixed Multiscale Finite Element Method for Elliptic Problems with
Oscillating Coefficients. Math. Comp, v. 72, p. 541–576, 2003. Citation on page 28.

CHEN, Z.; HUAN, G.; MA, Y. Computational Methods for Multiphase Flows in Porous
Media. [S.l.]: Computational Science &amp;amp; Engineering. Society for Industrial and Applied Mathe-
matics (SIAM), Philadelphia, PA, 2006. Citation on page 26.

CHRISTIE, M.; BLUNT, M. Tenth SPE comparative solution project: A comparison of upscaling
techniques. SPE-66599-MS,Society of Petroleum Engineers, 2001. Citations on pages 58, 77,
and 115.

CHUNG, E. T.; EFENDIEV, Y.; HOU, T. Adaptive multiscale model reduction with generalized
multiscale finite element methods. J. Comp. Phys., v. 320, p. 69–95, 2016. Citation on page 71.

CHUNG, E. T.; EFENDIEV, Y.; LEUNG, W. T. Fast online generalized multiscale finite element
method using constraint energy minimization. Journal of Computational Physics, v. 355, p.
450 – 463, 2018. ISSN 0021-9991. Available:&amp;lt;http://www.sciencedirect.com/science/article/pii/
S0021999117308604&gt;. Citations on pages 71 and 123.

CHUNG, E. T.; FU, S.; YANG, Y. An enriched multiscale mortar space for high contrast flow
problems. arXiv preprint arXiv:1609.02610, 2016. Citations on pages 44 and 71.

CORREA, M.; LOULA, A. F. D. Stabilized velocity post-processings for Darcy flow in hetero-
geneous porous media. Commun. Numer. Methods Eng., John Wiley &amp;amp; Sons, Ltd., v. 23, n. 6,
p. 461–489, 2007. ISSN 1099-0887. Available:&amp;lt;http://dx.doi.org/10.1002/cnm.904&gt;. Citation
on page 37.

COUSSY, O. Mechanics and Physics of Porous Solids. [S.l.]: Wiley, 2010. ISBN 978-0-470-
72135-3. Citation on page 26.

COWSAR, L. C.; WHEELER, M. F. Parallel Domain Decomposition Method for Mixed Finite
Elements for Elliptic Partial Differential Equations. Fourth International Symposium on
Domain decomposition methods for partial differential equations, Philadelphia, PA, p. 358–
372, 1991. Citation on page 30.

DOUGLAS, J.; PAES-LEME, P. J.; ROBERTS, J.; WANG, J. P. A parallel iterative procedure
aplicable to the approximate solution of second order partial differential equations by mixed
finite element methods. Numer. Math., v. 65, n. 1, p. 95–108, 1993. Citations on pages 31, 37,
38, 42, 70, and 94.

DURLOFSKY, L. J.; GERRITSEN, M. G. Modeling Fluid Flow in Oil Reservoirs. Annu. Rev.
Fluid Mech, v. 37, n. 37, p. 211–238, 2006. Citation on page 26.

EFENDIEV, Y.; HOU, T. Multiscale Finite Element Methods. Theory and Applications.
[S.l.]: Springer, 2008. Citation on page 26.

EYMARD, R.; GALLOUËT, T.; HERBIN, R. Finite Volume Methods. [S.l.]: Elsevier Science
B.V., Amsterdam, 2000. 713-1020 p. (Handbook of Numerical Analysis, 7). Citations on pages
31 and 32.

http://www.sciencedirect.com/science/article/pii/ S0021999117308604
http://www.sciencedirect.com/science/article/pii/ S0021999117308604
http://dx.doi.org/10.1002/cnm.904


128 Bibliography

FRANCISCO, A.; GINTING, V.; PEREIRA, F.; RIGELO, J. Design and implementation of a
multiscale mixed method based on a nonoverlapping domain decomposition procedure. Math.
Comput. Simul., v. 99, p. 125–138, 2014. Citations on pages 31, 37, 49, 58, 62, 70, 74, and 94.

GANIS, B.; YOTOV, I. Implementation of a mortar mixed finite element method using a
multiscale flux basis. Comput. Methods Appl. Mech. Engrg., v. 198, p. 3989–3998, 2009.
Citations on pages 30, 43, 44, 48, and 73.

GELHAR, L. W. Flow and Transport in Porous Formations. [S.l.]: Springer, New York, 1989.
Citation on page 25.

. Stochastic Subsurface Hydrology. [S.l.]: Prentice-Hall, Englewood Cliffs, NJ, 1993.
Citation on page 25.

GINTING, V.; PEREIRA, F.; RAHUNANTHAN, A. A Prefetching Technique for Prediction of
Porous Media Flows. Computa. Geosci., v. 18, n. 5, p. 661–675, 2014. Citation on page 25.

GLOWINSKI, R.; WHEELER, M. F. Domain decomposition and mixed finite element methods
for elliptic problems. First international symposium on domain decomposition methods for
partial differential equations, p. 144–172, 1988. Citations on pages 30, 33, 39, and 43.

GOTTLIEB, S.; SHU, C.-W. Total variation diminishing runge-kutta schemes. Math. Comput.,
American Mathematical Society, Boston, MA, USA, v. 67, n. 221, p. 73–85, Jan. 1998. ISSN
0025-5718. Available:&amp;lt;http://dx.doi.org/10.1090/S0025-5718-98-00913-2&gt;. Citation on page
109.

GUIRALDELLO, R. T.; AUSAS, R. F.; SOUSA, F. S.; PEREIRA, F.; BUSCAGLIA, G. C.
Interface spaces for the multiscale Robin coupled method in reservoir simulation. Math. Comput.
Simul., 2018. Citations on pages 33, 94, 95, 98, 100, 122, and 123.

. The multiscale Robin coupled method for flows in porous media. J. Comput. Phys.,
v. 355, p. 1–21, 2018. Citations on pages 31, 33, 70, 73, 74, 78, 83, 94, 95, 98, 100, 102, 122,
and 123.

HAJIBEYGI, H.; BONFIGLI, G.; HESSE, M. A.; JENNY, P. Iterative multiscale finite-volume
method. Journal of Computational Physics, v. 227, n. 19, p. 8604 – 8621, 2008. ISSN 0021-
9991. Available:&amp;lt;http://www.sciencedirect.com/science/article/pii/S002199910800332X&gt;. Ci-
tation on page 71.

HAJIBEYGI, H.; TCHELEPI, H. A. Compositional Multiscale Finite-Volume Formulation.
Society of Petroleum Engineers, v. 19, n. 2. Citations on pages 28 and 71.

HARDER, C.; PAREDES, D.; VALENTIN, F. A family of multiscale hybrid-mixed finite element
methods for the Darcy equation with rough coefficients. J. Comput. Phys., v. 245, p. 107 – 130,
2013. Citations on pages 31, 37, 43, 49, 50, 55, and 95.

. On a multiscale hybrid-mixed method for advective-reactive dominated problems with
heterogeneous coefficients. SIAM Multiscale Model. Simul., v. 13, n. 2, p. 491–518, 2015.
Citation on page 70.

HOU, T. Y.; WU, X. H. A Multiscale Finite Element Method for Elliptic Problems in Composite
Materials and Porous Media. J. Comput. Phys., v. 134, p. 169–189, 1997. Citations on pages
26 and 27.

http://dx.doi.org/10.1090/S0025-5718-98-00913-2
http://www.sciencedirect.com/science/article/pii/ S002199910800332X


Bibliography 129

HUGHES, T. Multiscale Phenomena: Green’s Functions, the Dirichlet-to-Neumann Formulation,
Subgrid Scale Models, Bubbles and the Origins of Stabilized Methods. Comput. Methods Appl.
Mech. Engrg., v. 127, p. 387–401, 1995. Citation on page 28.

HUGHES, T.; FEIJOO, G.; MAZZEI, L.; QUINCY, J. The Variational Multiscale Method - A
Paradigm for Computational Mechanics. Comput. Methods Appl. Mech. Engrg., v. 166, p.
3–24, 1998. Citation on page 28.

JENNY, P.; LEE, S. H.; TCHELEPI, H. A. Multi-scale finite-volume method for elliptic problems
in subsurface flow simulation. J. Comput. Phys., v. 187, p. 47–67, 2003. Citations on pages 28,
37, and 71.

KIPPE, V.; AARNES, J. E.; LIE, K. A Comparison of Multiscale Methods for Elliptic Problems
in Porous Media Flow. Comput Geosci., v. 12, n. 3, p. 377–398, 2008. Citation on page 28.

KöNNö, J.; SCHOETZAU, D.; STENBERG, R. Mixed finite element methods for problems with
Robin boundary conditions. SIAM J. Numerical Analysis, v. 49, p. 285–308, 2011. Citation
on page 27.

LAW, K.; STUART, A.; ZYGALAKIS, K. Data Assimilation: A Mathematical Introduction.
[S.l.]: Springer. (Texts in Applied Mathematics, 62). Citation on page 25.

LEE, S. H.; ZHOU, H.; TCHELEPI, H. A. Adaptive multiscale finite-volume method for non-
linear multiphase transport in heterogeneous formations. Journal of Computational Physics,
v. 228, n. 24, p. 9036 – 9058, 2009. ISSN 0021-9991. Available:&amp;lt;http://www.sciencedirect.com/
science/article/pii/S002199910900494X&gt;. Citations on pages 28 and 71.

LEIVA, J.; BLANCO, P.; BUSCAGLIA, G. C. Iterative strong coupling of dimensionally
heterogeneous models. Int. J. Numer. Methods Eng., John Wiley &amp;amp; Sons, Ltd., v. 81, n. 12, p.
1558–1580, 2010. ISSN 1097-0207. Available:&amp;lt;http://dx.doi.org/10.1002/nme.2741&gt;. Citation
on page 40.

LIONS, P. L. On the schwars alternating method iii: A variant for nonoverlapping subdomains.
In: . Third International Symposium on Domain Decomposition Methods for Partial
Differential Equations. Society for Industrial and Applied Mathematics, 1990. (Domain de-
composition methods - international symposium), chap. 11, p. 202–223. ISBN 9780898712537.
Available:&amp;lt;https://books.google.com.br/books?id=_GJ1DXrAyJ8C&gt;. Citation on page 30.

LOISEL, S. Condition number estimates for the nonoverlapping optimized Schwarz method and
the 2-Lagrange multiplier method for general domains and cross points. SIAM J. Numer. Anal.,
v. 51, n. 6, p. 3062–3083, 2013. Citations on pages 31, 38, and 42.

LOISEL, S.; NGUYEN, H.; SCHEICHL, R. Optimized Schwarz and 2-Lagrange multiplier
methods for multiscale elliptic PDEs. SIAM J. Sci. Comput., v. 37, n. 6, p. A2896–A2923,
2015. Citation on page 42.

LUNATI, I.; JENNY, P. Multiscale finite-volume method for compressible multiphase flow
in porous media. Journal of Computational Physics, v. 216, n. 2, p. 616 – 636, 2006. ISSN
0021-9991. Available:&amp;lt;http://www.sciencedirect.com/science/article/pii/S0021999106000039&gt;.
Citations on pages 28 and 71.

MADAY, Y.; MAGOULÈS, F. Absorbing interface conditions for domain decomposition meth-
ods: A general presentation. Comput. Methods Appl. Mech. Engrg., v. 195, p. 3880–3900,
2006. Citation on page 42.

http://www.sciencedirect.com/science/article/pii/ S002199910900494X
http://www.sciencedirect.com/science/article/pii/ S002199910900494X
http://dx.doi.org/10.1002/nme.2741
https://books.google.com.br/books?id=_GJ1DXrAyJ8C
http://www.sciencedirect.com/science/article/pii/ S0021999106000039


130 Bibliography

MATHEW, T. Domain Decomposition Methods for the Numerical Solution of Partial Differ-
ential Equations. Springer Berlin Heidelberg, 2008. (Lecture Notes in Computational Science
and Engineering). ISBN 9783540772095. Available:&amp;lt;https://books.google.com.br/books?id=
9n9PTTvimG4C&gt;. Citation on page 29.

NEDELEC, J. C. Mixed finite elements in r3. Numerische Mathematik, v. 35, n. 3, p. 315–341,
1980. ISSN 0945-3245. Available:&amp;lt;http://dx.doi.org/10.1007/BF01396415&gt;. Citation on page
31.

QUARTERONI, A.; VALLI, A. Domain Decomposition Methods for Partial Differential
Equations. [S.l.]: Clarendon press - Oxford, 1999. Citations on pages 29 and 31.

RAVIART, P. A.; THOMAS, J. M. A mixed finite element method for 2nd order elliptic problems.
In: Mathematical Aspects of the Finite Elements Method. [S.l.]: Springer, Berlin, 1977,
(Lecture Notes in Mathematics, 606). p. 292–315. Citations on pages 31 and 37.

ROBERTS, J. E.; THOMAS, J. M. Mixed and hybrid methods. In: CIARLET, P.; LIONS, J.
(Ed.). Handbook of Numerical Analysis, Vol. II. [S.l.]: North-Holland, Amsterdam, 1991. p.
523–639. Citation on page 31.

RUSSEL, T. F.; WHEELER, M. F. Chapter II: Finite Element an Finite Difference Methods
for Continuous Flows in Porous Media. [S.l.]: SIAM, 1983. (The Mathematics of Reservoir
Simulation). Citations on pages 31 and 32.

SILVA, R. C. C.; LOULA, A. F. D. Local residual error estimator and adaptive finite element
analysis of poisson problems. Comput. Struct., v. 80, p. 2027 – 2034, 2002. ISSN 0045-7949.
Available:&amp;lt;http://www.sciencedirect.com/science/article/pii/S0045794902002602&gt;. Citation
on page 37.

SMITH, R. C. Uncertainty Quantification: Theory, Implementation, and Applications.
[S.l.]: Siam, 2013. (Computational Science and Engineering). ISBN 978-1611973211. Ci-
tation on page 25.

TRANGENSTEIN, J. A.; BELL, J. B. Mathematical Structure of Compositional Reservoir
Simulation. SIAM J. Appl. Math., v. 10, n. 5, p. 817–845, 1989. Citation on page 26.

. Mathematical Structure of the Black Oil Model for Petroleum Reservoir Simulation. SIAM
J. Appl. Math., v. 49, n. 3, p. 749–783, 1989. Citation on page 26.

VOHRALÍK, M. Equivalence between lowest order mixed finite element and multipoint finite
volume methods on simplicial meshes. ESAIM, v. 40, n. 2, 2006. Citations on pages 31, 32,
and 46.

ZHANG, D.; LU, Z. An Efficient, High-order Perturbation Approach for Flow in Random Porous
Media via Karhunen-Loéve and Polynomial Expansions. J. Comput. Phys., v. 194, p. 773–794,
2004. Citation on page 25.

https://books.google.com.br/books?id=9n9PTTvimG4C
https://books.google.com.br/books?id=9n9PTTvimG4C
http://dx.doi.org/10.1007/BF01396415
http://www.sciencedirect.com/science/article/pii/ S0045794902002602


U
N

IV
ER

SI
D

A
D

E 
D

E 
SÃ

O
 P

A
U

LO
In

st
it

u
to

 d
e 

C
iê

n
ci

as
 M

at
em

át
ic

as
 e

 d
e 

C
o

m
p

u
ta

çã
o


	Title page
	Title page
	Dedication
	Acknowledgements
	Epigraph
	Resumo
	Abstract
	List of Figures
	List of Tables
	List of abbreviations and acronyms
	Contents
	Introduction
	The Darcy flow problem
	Multiscale methods
	Domain decomposition schemes 
	Fine mesh discretization schemes
	A multiscale method

	Outline

	The Multiscale Robin Coupled Method for flows in porous media
	Introduction
	Numerical scheme
	The domain decomposition formulation
	The multiscale formulation
	The multiscale implementation
	Multiscale basis functions and the interface linear system


	Numerical experiments
	The quarter of a 5-spot - Relation between methods
	Problem with a manufactured solution - Convergence assessment
	The importance of the Robin condition parameter

	Concluding remarks

	Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation
	Introduction
	The Multiscale Robin Coupled Method
	Discrete variational formulation

	Interface spaces: Polynomial and informed
	Numerical experiments
	The characteristic length scale
	Comparison of multiscale mixed methods

	Concluding remarks

	Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant transport in subsurface flows
	Introduction
	The Multiscale Robin Coupled method
	The velocity postprocessing schemes
	The Patch method
	The Stitch method

	Numerical set-up
	Numerical Results
	First approach
	Robustness
	Comparison of multiscale methods

	Concluding remarks

	Main results and future work
	Main contributions
	Future work
	New informed spaces - LOD
	A Multilevel MRCM
	3D HPC implementation



	Bibliography

</field>
	</doc>
</add>