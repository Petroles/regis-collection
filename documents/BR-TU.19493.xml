<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.19493</field>
		<field name="filename">2850_Silva_WellingtonDioliceFelixda_M.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">Universidade Estadual de Campinas
Faculdade de Engenharia Elétrica e de Computação
Departamento de Engenharia da Computação e Automação Industrial
Processamento, Análise e Visualização de Dados Tomográficos Multidimensionais de Rocha
Por
Wellington Diolice Felix da Silva
Orientador Prof. Dr. Roberto de Alencar Lotufo
Dissertação submetida à Faculdade de Engenharia Elétrica da Universidade Estadual de Campinas, para o preenchimento dos pré-requisitos parciais para obtenção do Título de Mestre em Engenharia Elétrica.
22 de Agosto 1997
cu ; aponde a reddção4inU dá I
Unentâdor

[s¡38p
ÜNI0ADE.„ZO;........
N.’ CHAMADA:
V.....................
TCM30 BQZ..^ZpAl„...
PROC.	.......
C □ .	0 |yj
preço^c^mlLz......
DATA....Vrz£uihi3.
N’ CPD............
CM-0O1O4?93-1
FICHA CATALOGRÁHCA ELABORADA PELA BIBLIOTECA DA ÁREA DE ENGENHARIA - BAE - UNICAMP
Silva, Wellington Diolice Felix da
Si38p	Processamento, análise e visualização de dados tomográficos
multidimensionais de rocha / Wellington Diolice Felix da Silva. -Campinas, SP: [s.n.], 1997.
Orientador: Roberto de Alencar Lo tufo.
Dissertação (mestrado) - Universidade Estadual de Campinas, Faculdade de Engenharia Elétrica e de Computação.
Resumo
Este trabalho aborda o desenvolvimento de ferramentas computacionais que auxiliam o estudo e a visualização do comportamento dinâmico do escoamento de fluidos em um meio poroso. O objetivo principal é calcular e visualizar a saturação de óleo no interior da amostra de rocha nos diversos instantes de tempo durante os ensaios de escoamento.
Os dados volumétricos são adquiridos por tomografia computadorizada enquanto a amostra de rocha é submetida a ensaios de escoamento. Estes dados são processados utilizando o modelo voxel através das ferramentas desenvolvidas. Estas ferramentas estão divididas em cinco grandes grupos: entrada de dados, pré-processamento, processamento, visualização e visualização analítica.
Na fase de leitura da fita, as fatias tomografadas, armazenadas em dispositivos seqüenciais, são recuperadas através da reconstrução do volume da amostra no modelo voxel. Na fase de pré-processamento, o volume é tratado de modo a reduzir os dados armazenados, eliminando regiões que não contenham dados de interesse. Além disso, são feitas correções na imagem de modo a eliminar eventuais problemas de alinhamento e de variações de escala ocorridos na varredura da amostra pelo to mó grafo. Na fase de processamento, foi escolhido como exemplo de utilização destas ferramentas, o cálculo da porosidade e da saturação de fluidos de um meio poroso. Estes cálculos são definidos a partir de operações aritméticas de volumes to mo gráficos. Na fase de visualização, são apresentadas três formas de visualização volumétrica que proporcionam várias perspectivas de análise: a visualização dos volumes através da concatenação lado a lado das fatias, de cortes ortogonais da amostra e da visualização 3D. Através da associação de uma tabela dinâmica de pseudo cores é aumentado o contraste dos dados, enfatizando a visualização dos dados dentro de um intervalo de intensidade de interesse. Na fase da visualização analítica, os dados são analisados através de cálculos estatísticos aplicados ao volume e às fatias da amostra.
Todas estas operações estão implementadas dentro do software Khoros e são aplicadas ao problema exemplo do cálculo da porosidade (dados estáticos) e da saturação de fluidos no meio poroso (dados dinâmicos) através de dados obtidos por tomografia.
Abstract
The volumetric data are acquired by computer tomography of the sample rock submitted to flowing off trials. These data are processed using the voxel model and the tools developed are divided in five main groups: data input, pre-processing, processing, visualization and analytical visualization.
In the tape reading stage, the slices produced by tomography, stored in sequential devices, are recovered through the volumetric reconstruction of the sample using the voxel model In the pre-processing stage, the volume is treated to reduce the amount of stored data, eliminating regions that contain non-interesting data. Besides that, some corrections are done to the image to eliminate eventual problems of size incompatibility and misalignment. In the processing stage, the calculus of the porosity of a porous media and the calculus of the saturation of fluids in that media were chosen as examples of the application of these tools. These computation processes are defined from arithmetic operations of tomographic volumes. In the visualization stage, three ways of volumetric visualization which provide various perspectives of analysis are presented: the visualization of volume through placing all the slices side by side, the visualization of orthogonal sections of the sample, and the 3D visualization of the volume. A dynamic pseudo color table is used to enhance the data within a specified intensity interval. In the analytical visualization stage, the data are analyzed through statistical calculus applied to the volume and to the slices of the sample.
All of these operations are implemented under the Khoros software and are applied to the sample problem of the porosity calculus (statistical data) and the saturation calculus (dynamic data) from the data obtained by tomography.
Agradecimentos
E um agradecimento todo especial:
Aos meus pais Diolice e Aparecida, e a minha irmã Isla, por me encorajarem a enfrentar este desafio, acreditando e me fazendo acreditar em meu sonho e por estarem ao meu lado em todos meus momentos;
A minha noiva Andrea, que mesmo separada pela distância, sempre esteve ao meu lado com seu carinho, amor e afeto, vivendo comigo as minhas vitórias e derrotas durante estes dois anos;
Ao meu orientador Lotufo, pelo apoio, pela confiança e pelo crédito que me tem dado desde meu ingresso na Unicamp.
Ao Adilson, por ter sido meu companheiro durante o desenrolar desta dissertação, ajudando na compreensão do problema;
Ao Fábio e ao Mauro pela companhia de todas as horas em nossa republica;
Aos amigos da FEEC e de toda Unicamp, principalmente ao Guilherme, pelo amigo que se mostrou ser durante estes meses e pelas grandes ajudas nas revisões e traduções de meus textos;
Ao CNPq pelo apoio financeiro.
Aos meus pais, Diolice Felix da Silva e Aparecida de Oliveira Felix, e a minha noiva Andréa Brandão Tramonte.
índice
RESUMO
ABSTRACT
AGRADECIMENTOS......................................................      IV
ÍNDICE......................................................              VI
LISTA DE FIGURAS

1.	INTRODUÇÃO
1
2.	CONCEITOS BÁSICOS
9
2.1	Porosidade e Saturação
9
2,7.7	Porosidade............................................................................
9
2.1.2	Saturação................................................................................................7 7
2.2	Tomografia Computadorizada........................................................................................12
2.3	Modelo de Estrutura de Dados para Processamento, Análise e Visualização de
Dados Multidimension ais.................................................................................................16
2.3.1	Image Understanding Environment..........................................................................18
2.3.2	Modelo Polimórfico de Dados do Khoros...................................................................	19
2.3.2.1	Segmentos............................................................................................................  19
2.3.2.1.1	Segmento Value.  20
2.3.2.1.2	Segmento Map........................................................................................................21
2.3.2.1.3	Segmento Mask  .22
2.3.2.1.4	Segmento Location .................................................................................................22
2.3.2.1.5	Segmento Time.23
2.3.2.2	Novos Segmentos........................................................................................24
2.3.2.3	Ambiente de Desenvolvimento.............................................................24
2.3.2.3.1	Cantata...........................................................................24
2.3.2.3.2	Craftsman.......................................................................  25
2.3.2.3.3	Compose...........................................................................26
2.3.3	Modelo MMachLib........................................................................    28
2.3.3.1	Estrutura MMachLib..................................................................    30
2.4	Visualização 3D..................................................................................30
2.4.1	VSDtools.................................................................................  31
2.5	Aquisição dos Dados.............................................................................  32
2.5.1	Preparação da Amostra.......................................................................32
2.5.1.1	Efeito de Endurecimento de Feixe.....................................................................................33
2.5.2	Aquisição de Imagem.........................................................................35
3.	PROCESSAMENTO, ANÁLISE E VISUALIZAÇÃO DE DADOS.......................................................36
3.1	Recuperação das Imagens...........................................................................37
3.1.1	Manipulação e Leitura da Fita ..............................................................37
3.1.2	Conversão de Formatos de Armazenamento de Imagem............................................38
3.1.3	Representação de um Volume Tomográfico.....................................................39
3.2	Pré-Processamento.................................................................................39
3.2.1	Seleção da Região Mínima de Interesse,,.................................................    40
3.2.2	Correção do Alinhamento...................................................................  41
3.2.3	Normalização das Dimensões..................................................................42
3.2.4	Mascarando Regiões de Não Interesse.........................................................43
3.2.5	Representação Matemática do Pré-processamento .................................................. 44
3.3	Processamento...................................................................................  45
3.4	Visualização....................................................................................  46
3.4.1	Mosaico...................................................................................................................46
3.4.2	Projeção Ortogonal..................,.............................................................................. 49
3.4.3	Tabela de Pseudo Cores Dinâmica ............................................................50
3.4.4	Visualização 3D.............................................................................53
3.5	Visualização Analítica............................................................................53
4.	IMPLEMENTAÇÃO..............................................................................          55
4.1	Leitura da Fita.................................................................................  57
4.2	Pré-Processamento.................................................................................59
4.3	Processamento..................................................................  61
4.3.1	Cálculo da Porosidade e da Saturação ...........................................................61
4.4	Visualização.....................................................................62
4.4, l Montage.....................................................................  63
4.4.2	Operador Orthogonal Projection..............................................................    65
4.4.3	Tabela de Pseudo Cores Dinâmica.................................................................66
4.4.4	Visualização 3D...........................................................  67
4.4.5	Visualização Dinâmica dos Dados...............................................................  69
4.5	Visualização Analítica.............................................................................  70
5.	RESULTADOS............................................................................................  73
6.	CONCLUSÕES................................................................          84
7.	REFERÊNCIAS BIBLIOGRÁFICAS........................................................................      87
viu
Lista de Figuras
Figura 1-1 - Imagem Tomográfica Original de um Corte de um Meio Poroso Cilíndrico.3
Figura 1-2 - Diagrama Geral.......................................................3
Figura 1-3 - Leitura e Conversão das Imagens Tomográficas.........................4
Figura 1-4 - Ilustração do Problema da Manipulação de Fatias Não Alinhadas e Com
Dimensões Diferentes.........................................................5
Figura 1-5 - Mosaico..............................................................7
Figura 1-6 - Projeção Ortogonal...................................................7
Figura 1-7 - Visualização 3D......................................................7
Figura 2-1 - Representação dos Pixels e Voxels...................................12
Figura 2-2 - Princípio da Radiografia Convencional.............................  13
Figura 2-3 - Princípio da Tomografia Computadorizada...........................  13
Figura 2-4 - Tomógrafo de 1a. Geração............................................15
Figura 2-5 - Tomógrafo de 2a. Geração..........................................  15
Figura 2-6 - Tomógrafo de 3a. Geração............................................15
Figura 2-7 - Tomógrafo de 4a. Geração............................................15
Figura 2-8 - Porção da Hierarquia da Classe Base do Modelo IUE...................18
Figura 2-9 - Modelo Poumórfico (Figura extraída de Khor9 1)......................20
Figura 2-10- Segmento de Valor (Figura extraída de Khor9 1)....................  21
Figura 2-11- Segmento de Mapa (Figura extraída de Khor9 1).....................  21
Figura 2-12- Segmento Mask (Figura extraída de Khor9 1)...........................22
Figura 2-13- Segmento Location (Figura extraída de Khor9 1)....................  23
Figura 2-14- Segmento de Tempo (Figura extraída de Khor9 1).......................24
Figura 2-15- Workspace Desenvolvido no Ambiente Gráfico de Programação do Cantata. . 25 Figura 2-16- Painel de Controle Principal do Craftsman...........................26
Figura 2-17 - Painel de Controle Principal do Compose .......................................................... 27 Figura 2-18- Painel de Controle Principal do Guise...............................28
Figura 2-19 - Modelo de Interface MMachLib...................................................29
Figura 2-20 - Modelo Esquemático da Estrutura de Dados MMachLib..............................30
Figura 2-21 - Modelo Esquemático da Visualização 3D..........................................31
Figura 2-22 - Workspace da Visualização 3D...................................................31
Figura 2-23 - Preparação da Amostra..........................................................33
Figura 2-24 - Modelo Esquemático do Deslocamento dos Fluidos pela Amostra....................33
Figura 2-25 - Diagrama Ilustrativo do Efeito de Endurecimento de Feixe.......................34
Figura 3-1 - Modelo Geral de Processamento de Imagens Tomográficas...........................36
Figura 3-2 - Modelo Esquemático de Recuperação das Imagens Gravadas em Fita..................37
Figura 3-3 - Representação Genérica de um Volume Tomográfico.................................39
Figura 3-4 - Modelo Esquemático do Pré-processamento.........................................40
Figura 3-5 - Modelo Esquemático da Seleção da Região Mínima..................................40
Figura 3-6 - Ilustração Demonstrando o Problema do Alinhamento...............................41
Figura 3-7 - Modelo Esquemático Demonstrativo da Normalização das Fatias da Amostra43
Figura 3-8 - Modelo Esquemático de Mascaramento de uma Imagem................................44
Figura 3-9 - Modelo Esquemático do Mosaico de uma Imagem...................................  47
Figura 3-10 - Modelo Esquemático do Escalonamento do Mosaico de uma Imagem...................48
Figura 3-11 - Modelo Esquemático de Identificação da Fatias..................................48
Figura 3-12- ^Modelo Esquemático da Personalização do Display................................49
Figura 3-13- Modelo Esquemático de Escolha de um Subconjunto.................................49
Figura 3-14 - Organização dos Planos de Cortes da Projeção Ortogonal.........................50
Figura3-15 - Modelo Esquemático da Tabela de Cores Dinámica..................................51
Figura 3-16 - Tabela de Cores Senoidal.......................................................51
Figura 3-17 - Tabela de Cores Genérica.......................................................53
Figura 4-1 - Operador Multiplicação..........................................................56
Figura 4-2 - Pane do Operador Tape-in ....................................................................................... 56
Figura 4-3 - Workspace do Cálculo da Porosidade..............................................57
Figura 4-4 - Modelo Esquemático Tape-in......................................................57
Figura 4-5 - Ilustração do Problema da Manipulação de Imagens Não Alinhadas..................60
Figura 4-6 - Modelo Esquemático Normalezed Crop..............................................61
Figura 4-7 - Workspace do Cálculo da Porosidade..............................................62
Figura 4-8 - Modelo Esquemático do Operador Montage ........................................................ 63
Figura 4-9 - Exemplo de Relatório Produzido pelo Montage.....................................64
Figura 4-10 - Modelo Esquemático OrthogonalProjection.................................................... 65
Figura 4-11- Saturação de Óleo com Escala de Cores Gerada pelo Operador Montage 66
Figura 4-12- Saturação de Óleo com Escala de Cores Gerada pelo Operador Orthogonal
Projection ................................................................ 67
Figura 4-13 - Workspaceda Visualização 3D.......................................68
Figura 4-14 - Modelo Esquemático Visualização 3D.............................  69
Figura 4-15- Animação Vista Através da Sobreposição de Imagens..................70
Figura 4-16- Saturação Média de Óleo em 8 Diferentes Instantes de Tempo.........71
Figura 4-17- Média de uma Imagem Com Máscara (Esquerda) e Sem Máscara (Direita).72
Figura 5-1 - Primeira Fatia do Volume Tomográfico de uma Amostra Saturada de Óleo,
Submetida À Injeção de água...............................................74
Figura 5-2 - Volume da Figura 5-1 Visualizado pelo Operador Montage sem Tabela de
Pseudo Cores............................................................  74
Figura 5-3 - Operador Normauzed Crop Aplicado ao Volume Representado na Figura 5-1.. 75
Figura 5-4 - Operador Orthogonal Projection Aplicado ao Volume Anterior, X=128, Y=128
E Z=4; MIN= 1600 E Max=2050.............................................  76
Figura 5-5 - Porosidade Referente a Primeira Fatia da Amostra...................77
Figura 5-6 - Saturação de Óleo Referente a Primeira Fatia da Amostra............77
Figura 5-7 - Porosidade Visualizada pelo Operador Montage com Redução de 50% das
Dimensões de c.ada Fatia com Tabela de Pseudo Cores Aplicada ao Intervalo [0,30].. 78
Figura 5-8 - Projeção Ortogonal da Porosidade, com Cortes nos Planos X-128, y=128, Z=0 e Tabela de Pseudo Cores Aplicada ao Intervalo [0,30].....................79
Figura 5-9 - Saturação Visualizada pelo Operador Montage. com Redução de 33% das Dimensões de cada Fatia, com 5 Fatias por Linha da Imagem com Tabela de Pseudo Cores Aplicada ao Intervalo [0,100].......................................80
Figura 5-10 - Projeção Ortogonal da Saturação, com Cortes nos Planos X=200, Y=30, Z=8 e Tabela de Pseudo Cores Aplicada ao Intervalo [0,100]....................80
Figura 5-11- Visualização 3D da Saturação Evidenciando as Regiões Cuja Saturação é
Interior a 50%............................................................81
Figura 5-12 - Sobreposição de Três Diferentes Instantes Visualizados pela Técnica
Visualização 3D com Saturação Inferior a 50%..............................81
Figura 5-13 - Porosidade Média da Amostra a Cada Fatia.......................  82
Figura 5-14 - Saturação Média de Óleoem 8 Diferentes Instantes de Tempo na Amostra
Anterior..................................................................83
1.	Introdução
Com o desenvolvimento computacional emergindo rapidamente nos últimos anos, análises deslumbradas somente em sonhos, estão sendo viáveis na atualidade. Cálculos volumosos, imagens e gráficos de qualidade, agora podem ser conseguidos sem grandes investimentos, proporcionando a obtenção de resultados bastante precisos.
Nesta sociedade capitalista e industrializada, o petróleo mostra-se como uma das principais fontes energéticas para o ser humano. Sua aplicabilidade como matéria-prima vai desde o combustível usado nos automóveis, a fabricação de plástico, o aquecimento de caldeiras, até o óleo usado por alguns países na geração de energia elétrica.
Estudos recentes informam que as reservas mundiais de petróleo devem se esgotar até o final do próximo século. A procura de fontes energéticas alternativas e de formas mais eficientes de extração estão sendo pesquisadas de modo a adiar este problema, enquanto um substituto para o petróleo não é encontrado. O Brasil, como um grande detentor de reservatórios de petróleo, também tem estas preocupações. A Petrobrás, como empresa centralizadora destas atividades em nosso país, investe parte de seus recursos na melhoria das metodologias de análise das propriedades petrofísicas usadas no julgamento da viabilidade ou não da extração em uma bacia petrolífera!.
Recursos como a tomografia computadorizada têm provocado grandes saltos no estudo e no modelamento do escoamento de fluidos em meios porosos. Através dela, é possível visualizar internamente o comportamento temporal do deslocamento do fluido injetado, calculando propriedades do meio poroso como um
Bacia Petrolífera: Extensa região onde é encontrado uma alta concentração de petróleo em seu subsolo. O maior exemplo brasileiro é a bacia petrolífera de Campos, localizada em alto mar no litoral do Rio de Janeiro.
Esta dissertação aborda o desenvolvimento de ferramentas computacionais [SLG97] que auxiliam os engenheiros de petróleo a determinar características petrofísicas de um poço [AmBaóO], bem como a visualização do comportamento dinâmico do escoamento dos fluidos pela amostra, usando para isto, um conjunto de imagens obtidas por tomografía computadorizada.
Estes problemas motivaram esta dissertação devido as dificuldades encontradas na manipulação e visualização de grandes volumes de dados [Falc93] [Lupp94], Para ilustração da potencialidade destas ferramentas, foram abordados os cálculos da porosidade e da saturação por intermédio de imagens tomográficas [Holl93] [Silv94] [Gome97].
As imagens tomográficas utilizadas neste trabalho (Figura 1-1) fazem parte da tese de doutorado de Gomes [Gome97], responsável pela parte laboratorial, envolvendo desde a preparação das amostras, até a aquisição tomográfica de suas imagens. A metodologia utilizada nos cálculos da porosidade e da saturação estão fundamentadas nos estudos e conclusões fornecidos por ele e sua equipe do Departamento de Engenharia de Petróleo da Faculdade de Engenharia Mecânica da UNICAMP. Nesta dissertação somente serão apresentadas as informações laboratoriais e petrofísicas necessárias à caracterização e compreensão dos problemas abordados, onde serão usadas imagens tomográficas de meios porosos2 saturados pelos seguintes fluidos: ar, água, solução aquosa de Kl (iodeto de potássio) e óleo, necessárias aos cálculos das propriedades.
2 Meio Poroso: No contexto da engenharia de petróleo, meio poroso trata-se de uma amostra, uma porção de rocha do terreno a ser estudado.
Figura 1-1 - Imagem Tomográfica Original de um Corte de um Meio Poroso Cilíndrico
O cálculo dos resultados através das fatias obtidas por tomografias da amostra, pode ser dividido em cinco grandes grupos (Figura 1-2) que resumem as fase inerentes ao processo de determinação das propriedades escolhidas: recuperação de imagens, pré-processamento, processamento, visualização e visualização analítica.
Figura 1-2 - Diagrama Geral
• Recuperação das Imagens
Um dos principais problemas encontrados durante este trabalho, está relacionado ao volume de dados processados. Como o número de imagens geradas em um exame tomográfico é tipicamente elevado, estes dados são armazenados em dispositivos com grande capacidade de armazenamento tais como fitas DAT, discos ópticos, etc.. Nos ensaios feitos neste trabalho, foram utilizadas fitas DAT de 4mm para o armazenamento e transporte dos dados tomográficos para o computador usado no processamento.
Como os dados armazenados em fita não podem ser diretamente processados, necessitou-se criar um dispositivo eficiente de manipulação e leitura das fitas de modo a copiar as imagens da fita para a memória do computador, permitindo o processamento.
Por não seguir uma padronização dos formatos das imagens, os formatos dos arquivos de armazenamento das imagens adquiridas por tomografía são diferenciados para cada marca e modelo de tomógrafo. Deste modo, a maioria dos softwares de processamento de imagens não reconhecem a padronização usada, implicando na necessidade da existência de um conversor de tipos de imagens para cada modelo de tomógrafo.
Sendo assim, para que uma sequência de imagens seja recuperada e esteja pronta para o processamento, isto é, formando um volume de dados no modelo voxel representado pelo encadeamento das fatias de um exame, serão necessárias duas etapas seqüenciais a serem seguidas: leitura e manipulação da fita e conversão dos formatos das imagens, como mostra a Figura 1-3.
Figura 1~3 - Leitura e Conversão das Imagens Tomográficas
• Pré-processamento
Uma fatia típica obtida nos ensaios tomográficos (Figura 1-1) possui grandes regiões contendo informações que não são relevantes ao problema abordado. As informações pertinentes ao problema normalmente estão localizadas no centro das
Visando a redução do espaço de armazenamento e do processamento das imagens, uma forma de seleção automática da região de interesse baseada nas intensidades dos pixels é implementada. Através da escolha de um intervalo de valores de interesse, ajustam-se as dimensões de cada fatia da imagem, de modo que o resultado seja a sub-imagem definida pelo retângulo mínimo englobador de todos os pontos cujas intensidades pertencem ao intervalo selecionado.
Devido aos problemas com o posicionamento da amostra na mesa do tomógrafo, decorrentes da manipulação para a injeção dos diferentes fluidos, as regiões de interesse das imagens normalmente não possuem as mesmas dimensões, diferindo uma da outra por alguns poucos pixels: tipicamente de 1 a 4, para uma região de aproximadamente 270 x 270. Assim, o processo to mo gráfico acaba gerando seções elípticas, quando o esperado seriam seções circulares decorrentes da geometria cilíndrica e do posicionamento longitudinal das amostras na mesa do tomógrafo.
Para que seja possível a manipulação algébrica dos pontos das imagens, necessário no cálculo da porosidade e da saturação, precisa-se da equivalência espacial dos pixels de um exame e de outro, ou seja, as fatias das imagens devem estar alinhadas e normalizadas para uma mesma dimensão comum. A Figura 1-4 mostra, de forma exagerada, a problemática ao se manipular algébricamente os pixels de duas fatias não alinhadas e com dimensões diferente.
Imagem 1
Imagens
Iniciais
Imagem 2
Resultado
Esperado
Figura 1-4 - Ilustração do Problema da Manipulação de Fatias Não Alinhadas e Com Dimensões Diferentes
Esta problemática pode ser resolvida com a técnica de replicação de pixels, onde são gerados pontos intermediários aos encontrados na amostra original.
Esta abordagem mostra-se eficiente para pequenos ângulos, onde o ângulo formado entre o eixo de deslocamento da mesa do tomógrafo e o eixo da amostra, é aproximadamente zero.
Outro ponto a ser destacado é que apesar de selecionar o retângulo mínimo contendo todos os pontos de interesse, pontos indesejados continuam a existir. Devido a forma circular das regiões de interesse e a forma retangular de representação adotada pela maioria dos softwares de processamento de imagens, não é possível conciliar um ajuste da imagem de modo a eliminar os pontos inconvenientes, sem que ocorra a perda de sub-regiões de interesse. Para contornar este problema, usa-se um recurso chamado máscara, onde uma imagem binária com as mesmas dimensões da original indica se um ponto é representativo ou não. Sendo assim, antes de qualquer processamento de um ponto, verifica-se se ele está ou não mascarado. Estando mascarado, o ponto é ignorado. A importância deste recurso fica clara quando abordado o problema dos cálculos estatísticos efetuados nas imagens.
•	Processamento
Tendo as fatias das imagens alinhadas, suas dimensões normalizadas e com as máscaras devidamente definidas, pode-se calcular qualquer propriedade representada pela combinação de operações aplicadas às imagens. Para efeito ilustrativo serão abordados os cálculos da porosidade e da saturação que se limitam a operações algébricas simples, aplicadas pontualmente.
•	Visualização
Tão importante quanto o cálculo das propriedades são a visualização e a avaliação estatística dos dados em qualquer uma das etapas do processamento. Para a visualização são implementadas três formas de visualização de dados volumétricos: o mosaico das fatias (Figura 1-5), onde as fatias da amostra são organizadas lado a lado; a projeção ortogonal (Figura 1-6), onde se visualiza as três seções ortogonais da amostra; e a visualização 3D (Figura 1-7), que através de recursos de shading e de iluminação possibilita a visualização da superfície de interesse em perspectiva.
Figura 1-5 - Mosaico
Figura 1-6 - Projeção Ortogonal
Figura 1-7 - Visualização 3D
Para agilizar o processo de análise visual de um volume de dados, as operações de visualização mosaico e projeção ortogonal permitem a geração de uma imagem relatório contendo informações gráficas e textuais relacionadas a amostra visualizada.
O baixo contraste normalmente encontrado nas imagens tomográfícas de rochas inspirou a criação de uma pseudo tabela de cores dinâmica que evidencia um dado intervalo de intensidade, realçando as regiões de interesse da imagem. A tabela de cores, baseada em funções senoidais, é concebida sobre o modelo RGB, proporciona uma escala crescente de luminâncía, saindo do azul, passando pelo verde e chegando ao vermelho.
• Visualização Analítica
Além da análise visual dos resultados obtidos, a análise estatística é uma forte aliada nos estudos realizados. Medidas como a média, desvio padrão, moda, etc. fornecem informações preciosas, difícilmente visualizadas diretamente na imagem. Os cálculos estatísticos podem ser feitos em cada fatia, refletindo o comportamento local da amostra, ou em todo o volume, refletindo o comportamento global.
A presença da máscara incluída no pré-processamento das imagens, garante que somente os pontos de interesse irão contribuir para o resultado. Sem ela, todos os pontos, inclusive os indesejados, participariam da avaliação estatística.
O software freeware de processamento de imagens, Khoros [Khor91] foi utilizado para o desenvolvimento destas novas ferramentas e para o processamento das imagens tomo gráficas. Sua escolha deve-se ao seu grande potencial de prototipação de soluções, ao seu código fonte encontrar-se disponível e pelo seu reconhecimento como um dos principais softwares usados no processamento de imagens.
Esta dissertação está organizada da seguinte forma: Neste capítulo, apresenta-se uma introdução ao problema estudado, bem como a linha de raciocínio seguida na solução do problema. No segundo capítulo trata-se de uma coletânea de teorias dos diversos assuntos diretamente ligados ao problema. Nele são encontradas explicações sobre Porosidade e Saturação; Tomografia Computadorizada; Modelo de Estrutura de Dados para Processamento, Análise e Visualização de Dados Multidimensionais e Aquisição dos Dados. No terceiro capítulo, resolve-se genericamente o problema do cálculo da porosidade e da saturação usando imagens tomográficas. Para isto, divide-se o problema em cinco grandes etapas: Recuperação das Imagens, Pré-Processamento, Processamento, Visualização e Visualização Analítica. No quarto capítulo apresenta-se a forma com que cada etapa do capítulo anterior foi implementada, usando a plataforma Khoros em conjunto com a biblioteca de funções MMachLib. No quinto capítulo mostram-se alguns dos resultados obtidos utilizando este conjunto de ferramentas desenvolvidas. No sexto apontam-se as conclusões encontradas, bem como algumas sugestões de continuidade do trabalho. Finalmente no sétimo capítulo lista-se a bibliografia utilizada no trabalho.
2.	Conceitos Básicos
Este capítulo introduz os principais conceitos necessários ao bom entendimento do problema abordado. Em suas seções encontram-se os conceitos de Porosidade e Saturação; Tomografia Computadorizada; Modelo de Estrutura de Dados para Processamento, Análise e Visualização de Dados Multidimensionais; Visualização 3D; e Aquisição dos Dados.
2.1	Porosidade e Saturação
Geralmente as rochas são permeáveis a fluidos como a água, o óleo, os gases ou uma combinação destes. A engenharia de reservatórios concentra seus objetivos em quantificar o volume de fluidos existente numa rocha [AmBaóO], como eles fluem, além de outras propriedades.
Como as ferramentas desenvolvidas nesta dissertação atuam sobre os voxel de uma imagem, escolheu-se duas das principais propriedades utilizadas pelos geólogos para ilustrar os resultados obtidos: a porosidade e a saturação, cujos cálculos podem ser obtidos em decorrência da manipulação algébrica de um conjunto específico de imagens. A porosidade é uma propriedade estática a qual não varia com o tipo e quantidade de fluido em seu interior; a saturação, é uma propriedade dinâmica, variante no tempo de acordo com a ocupação de seus poros por um determinado fluido.
2.1.1	Porosidade
volume dos poros
&lt;D = 100 x---------~----
volume poroso
(I)
A determinação da porosidade [Holl93][Silv94] através de imagens tomográficas tem como base o fato de que, para uma fonte mo no-energética de Raios-X, o componente de atenuação linear devido a matriz da rocha é independente dos fluidos que ocupam o espaço poroso da amostra. Portanto, para um determinado elemento do volume (voxel) de uma amostra totalmente saturada por um único fluido, o coeficiente de atenuação linear pode ser calculado pela equação:
(a z) = (1 - O(a A z))Tv (a	(a Az)o(x, y, z)(II)
Onde, x,y,z são as coordenadas de um dado voxel, TRÍ é o coeficiente de atenuação da rocha completamente saturada com o fluido 1, Tm é o coeficiente de atenuação linear da rocha matriz, é o coeficiente de atenuação linear do fluido 1 e é a porosidade da rocha matriz.
Escrevendo a equação para um fluido 2, tem-se:
tS2 =(i-a&gt;)YM +&gt;p2a&gt;
Combinando as equações, tem-se:
fi, -t2)
(III)
(IV)
Escrevendo a equação anterior em unidades Hounsfíeld3, tem-se:
(V)
3 Unidade Hounsfíeld: O grau de atenuação do feixe de Raios-X é quantificado e expresso em termos de unidades de Hounsfíeld (Hus), nome dado em homenagem ao inventor da tomografia computadorizada, Godfrey Newbold Hounsfíeld. Este número é também conhecido como número CT. Hounsfíeld escolheu arbitrariamente o valor de CT igual a zero para a água, -1000 para o ar e 1000 para o osso.
Conclui-se que para a determinação da porosidade de uma amostra de rocha são necessários quatro conjuntos de imagens tomográfícas, obtidas em instantes diferentes: amostra de rocha totalmente saturada com o fluido 1, amostra de rocha totalmente saturada como o fluido 2, amostra do fluido 1 e amostra do fluido 2.
seguinte
(VI)
(VII)
2.1.2	Saturação
Entende-se como saturação de um dado fluido, a quantidade deste existente no interior de um meio poroso. O cálculo da saturação em meios porosos contendo dois fluidos em um determinado instante pode ser feito pela equação:
Em unidades Hounsfíeld:
/ , __ (CT«i á.y.z)-	(*.y.z))
2	X'y’Z ~&amp;lt;J&gt;(x,y,zXC7](x,y,z)-CT2(x,y,z))
Assim, para o cálculo da saturação do fluido 2 em um meio poroso, em um determinado instante, são necessários os números Hounsfíeld da rocha com fluidos 1 e 2, os números Hounsfíeld da rocha completamente saturada com o fluido 1 e 2 e a porosidade da amostra do meio poroso.
Formas alternativas e laboratoriais para o cálculo da saturação podem ser encontradas em [AmBaóOJ. No entanto, estas técnicas não serão abordadas aqui por fugir ao escopo desta dissertação.
2.2	Tomografia Computadorizada
A tomografia computadorizada de Raios-X é uma técnica não destrutiva de avaliação da estrutura interna de objetos. Uma imagem tomográfica é formada devido a atenuação dos Raios-X que atravessam um determinado volume de interesse. As diferenças de densidades, inerentes a um corpo heterogêneo, provoca diferentes graus de atenuação que são traduzidos em diferentes níveis de cinza na imagem final.
As imagens, formadas devido a passagem dos Raios-X, são coletadas em detetores, reconstituídas por um computador e exibidas na forma de uma seção transversal. Cada uma delas é representada por uma matriz quadrada cujo tamanho escolhe-se de acordo com o equipamento disponível, objeto a ser analisado e demais parâmetro do exame. Nessa matriz cada elemento quadrado é chamado de pixeL Uma seção transversal representa as médias das medidas em uma fatia cuja espessura é também definida pelo usuário. Cada unidade de volume de uma fatia recebe o nome de voxel (Figura 2-1).
Figura 2-1 - Representação dos Pixels e Voxels
A principal diferenciação entre um radiografia convencional e uma tomografia esta na forma com que as imagens são formadas. Para uma radiografia convencional (Figura 2-2), a imagem resultante é a projeção do volume radiografado em uma placa de chumbo que é bombardeada por diferentes intensidades de Raios-X. As regiões do corpo radiografado absorvem mais ou menos radiação de acordo com suas características físicas, ou seja, a composição física do objeto determina o coeficiente de atenuação do feixe emitido.
Figura 2-2 - Princípio da Radiografia Convencional
Em uma tomografia, cada feixe de Raio-X, /0, é emitido (Figura 2-3) segundo um ângulo G que atravessa o corpo em estudo que o atenua e este é coletado pelo receptor posicionado do lado oposto, resultando numa intensidade I. Esta medição é feita em diferentes direções até completar uma rotação completa de 360° na amostra. A intensidade dos feixes de Raios-X atenuados pode ser relacionada aos coeficientes de atenuação // do objeto ao longo do percurso do feixe pela seguinte equação:
Devido ao grande problema em se inverter esta equação de modo a recuperar /zÇr, v), a grande maioria dos tomógrafos utilizam de métodos numéricos para a obtenção destes valores. Maiores detalhes podem ser obtidos em [Silv94].
Emissor de Raios-X			-►	Tomógrafo Câmara Tomográfica Região Útil de Varredura
		1	-&gt;	Detetores
Raío-X	— —	ç...			Amostra
				
				
Figura 2-3 - Princípio da Tomografia Computadorizada
A quantidade de feixes de Raíos-X que passa através do corpo determina os níveis de cinza nas imagens. Por convenção, feixes de Raios-X que atravessam livremente o corpo são representados como uma área negra na imagem final. Ao contrário, quando um feixe de Raios-X é totalmente impedido de atravessar o corpo, ou seja, é completamente atenuado, será representado por uma área branca na imagem final. As atenuações intermediárias são representadas por vários graus de cinza.
A quantidade de Raios-X que atravessa um material é determinada pela densidade da área exposta. A densidade de um material é determinada por sua estrutura molecular. Elementos com maiores números atômicos, possuem mais elétrons circulando e o núcleo mais pesado. Quanto maior o número de partículas atômicas de um elemento, mais compacta será sua estrutura molecular implicando em uma maior densidade.
Atualmente podemos identificar quatro gerações distintas de tomógrafos, sendo que os de terceira geração são os mais utilizados na atualidade. A transição de uma geração para outra pode ser determinada pela criação de técnicas que aumentaram pouco a pouco a velocidade de varredura de uma amostra. Na Tabela 1 são apresentados os principais fatores a serem considerados na evolução dos tomógrafos:
1a. Geração (Figura2-4)	â*. Ger^çãã (Figura 2-5) : ■ \	3a. Geração j ó f (Figura 2-6)	A 4a. Geração &amp;lt;’’(Figurai-^ -A
• Um feixe linear de Raios-X e um detetor.	• Um feixe linear de Raios-X em “forma de leque” e um conjunto de	vários detetores	• Um feixe linear de Raios-X em “forma de leque” que cobre toda seção	da amostra e uma bateria maior de detetores	• Um feixe linear de Raios-X em “forma de leque” e uma bateria de detetores distribuídos de forma	a circundar toda a amostra
• Rotação de 180° com passos de fO	• Rotação de 180° com passos de 10°	• O feixe gira juntamente com os detetores	• Somente o feixe gira
Tabela 1 - Características Determinantes de cada uma das Gerações de Tomógrafos
Tubo de
Raios-X
Vetor de
Detetores
Figura 2-5 - Tomógrafo de 2a. Geração
Figura 2-4 - Tomógrafo de la. Geração
Figura 2-6 - Tomógrafo de 3a. Geração
Figura 2-7 - Tomógrafo de 4a. Geração
Dentro dos tomógrafos de terceira geração, utilizados nas aquisições das imagens apresentadas nesta dissertação, podemos diferenciar a forma de aquisição segundo duas metodologias distintas: a varredura axial e a helicoidal.
A técnica mais antiga e mais utilizada atualmente é a aquisição axial, onde o objeto é “cortado” axialmente, gerando uma imagem que representa uma fatia. Cada imagem é obtida com um giro de 360° do tubo e dos detetores, em seguida, a mesa é deslocada por uma distância escolhida a priori para que seja iniciado o próximo corte.
A técnica mais recente, disponível somente em alguns tomógrafos é conhecida também como tomografía helicoidal, que envolve a aquisição contínua de dados através do deslocamento ininterrupto da mesa do tomógrafo, enquanto a fonte de Raios-X é rotado nada. Intuitivamente, nota-se que este método de obtenção de imagens é muito mais rápido que o axial, pois com alguns poucos giros helicoidais, toda amostra é varrida.
No estudo de análise dinâmica dos deslocamentos de fluidos em amostra porosas é essencial que o tempo de aquisição seja baixo, pois em poucos segundos, o líquido injetado em uma das extremidade da amostra, começa a ser coletado na outra. Para que fosse possível acompanhar o deslocamento do líquido injetado ao longo da amostra foi necessário escolher um tomógrafo helicoidal. Sendo assim, foi utilizado o to mó grafo Helicoidal Hi Speed GE do hospital Beneficência Portuguesa da cidade de São Paulo, para a aquisição dos dados.
2.3	Modelo de Estrutura de Dados para Processamento,
Análise e Visualização de Dados Multidimensionais
A escolha adequada do modelo de representação dos dados é de vital importância para o bom andamento do projeto [DoLe91] [Shap79]. A procura de uma estrutura completa e de eficiente manipulação mostra-se necessária para que as operações com dados 3D sejam ágeis e transparentes ao usuário.
Os modelos de representação de imagens podem ser classificados em duas categorias distintas: modelos geométricos e modelos voxels. Nos modelos geométricos existe a preocupação de armazenar os dados levando-se em conta suas propriedades geométricas, enquanto no modelo voxel a representação dos dados é feita através de um conjunto de pontos que formam a imagem. Como exemplo ilustrativo, no modelo geométrico um círculo pode ser representado por um ponto que define seu centro e por seu raio. No modelo voxel, um círculo é representado por uma imagem discreta de pontos.
De forma simplificada, a área de computação gráfica utiliza mais a representação geométrica enquanto a área de processamento de imagens está baseada em sua maioria em modelos voxels. A tendência atual é procurar tratar indistintamente estes dois modelos em ambas as áreas.
A abordagem adotada neste trabalho esta fundamentada no modelo voxel que mostrou-se o mais apropriado para o processamento e análise dos dados, pois os dados tomográficos tratados no problema são originalmente voxel e as propriedades a serem analisadas estão fundamentadas em manipulações pontuais ou regionais das imagens.
Quanto a visualização volumétrica dos dados, tanto o modelo geométrico como o modelo voxel são comumente utilizados. Por conveniência e simplicidade foi adotado o modelo voxel de modo a aproveitar o mesmo modelo de estrutura de dados e a experiência dos trabalhos de Falcão [Falc93] e de Luppi [Lupp94].
Algumas formas de representação, voltadas ao processamento de imagens, foram analisadas: o Image Understanding Environment (IUE) [KLHL95], o Modelo Polimórfico Khoros [Khor91] e a biblioteca de fimções MMachLib [BBLH97], de forma a escolher uma que se adequasse às necessidades deste problema.
Por ser um modelo bastante completo, a utilização do software freeware Image Understanding Environment (IUE) desenvolvido pelo grupo Amerinex Artificial Intelligence, INC.. supera as necessidades exigidas neste projeto. O conjunto de facilidades disponibilizadas pelo IUE prevê situações que não fazem parte do domínio do problema. Sua utilização acarretaria em um overhead desnecessário que prejudicaria o desempenho na obtenção das soluções, seu código fonte não se encontra disponível para estudos, além da falta de experiência anterior.
Um dos modelos de representação adotados neste projeto, trata-se do Modelo Polimórfico Khoros (seção 2.3.2), software, desenvolvido pela Khoral Research Inc. e University New México, conhecido internacionalmente e utilizado no DCA-FEEC-Unicamp desde 1992.
Mesmo sendo um modelo menos abrangente que o IUE, o Modelo Polimórfico do Khoros é bastante completo e sua estrutura de dados volta-se a problemas de processamento de imagens. Embora mais simples, ainda existe o problema de aumento desnecessário da complexidade, pois os recursos oferecidos normalmente extrapolam a necessidade. No entanto, diferentemente do modelo IUE, este overhead é admissível quando considerado a facilidade oferecida na prototipação de novas soluções e dos operadores e toolboxes que permitem a utilização de funções pré-definidas.
Devido às instabilidades e às mudanças de versões do Khoros, usamos também neste trabalho a estrutura de dados da MMachLib (seção 2.3.3) que tem como principais características a simplicidade e a portabilidade. Com uma estrutura de dados compacta, o manuseio dos recursos por seus usuários passa a ser uma tarefa mais fácil e agradável. Os campos de sua estrutura são diretamente indexados pelo programador, proporcionando o aumento de desempenho de suas funções. Em contrapartida, algumas situações específicas, como o manipulação de imagens mascaradas, ainda não implementada, ficam prejudicadas.
A biblioteca de funções MMachLib mostra-se bastante portável por ser feita exclusivamente com código ANSI C e não possuir código de entrada e de visualização de dados próprios, tornando-se independente do sistema de janela usado. A MMachLib funciona em qualquer sistema que possua um compilador ANSI C de 32 bits.
A seguir, é feito uma descrição sucinta de cada modelo de dados analisados, apontando suas principais virtudes e limitações.
2.3.1	Image Understanding Environment
O Image Understanding Environment (IUE) [KLHL95] é um projeto concebido para desenvolver um ambiente orientado a objeto capaz de representar qualquer tipo de imagem, provendo uma estrutura de software contendo uma hierarquia de classes, ferramentas para criação de interfaces para usuários e algoritmos de Image Understanding (IU).
A portabilidade oferecida por seu ambiente, propõe facilitar o intercâmbio de resultados entre os pesquisadores. Nesta representação de dados (Figura 2-8), não se espera prover antecipadamente todos os recursos que alguém necessitaria, mas prover implementações de classes com as quais os usuários possa se especializar para produzir novas representações e procedimentos enquanto mantém-se a total compatibilidade e interoperabilidade com o restante da estrutura hierárquica.
Set
Relation
Ordered-Relatíon
Function	Binary-Relation
Tuple	Array	Matrix	Graph
Sequences	Tree List
Figura 2-8 ~ Porção da Hierarquia da Classe Base do Modelo IUE
O grande mérito deste tipo de abordagem estrutural é procurar fornecer uma estrutura universal capaz de representar qualquer problema envolvendo imagens, garantindo a sua portabilidade para outros sistemas. No entanto, seu grande demérito
2.3.2	Modelo Polimórfico de Dados do Khoros
O modelo polimórfico de dados [Khor91 ] está baseado no fato de que os conjuntos de dados são usualmente adquiridos ou gerados para modelar fenômenos do mundo real. O modelo polimórfico possui uma base de dados capaz de representar imagens do espaço tridimensional e tempo unidimensional , isto é, uma seqüência de volumes variando no tempo.
Baseado no conceito de programação orientada a objeto, ele não permite que nenhuma função criada pelo usuário tenha acesso direto a sua estrutura de dados. Toda manipulação deve ser feita através de funções que proporcionam o manuseio dos itens desejados, garantindo uma maior integridade de seus dados.
O modelo de representação do Khoros pode ser identificado como o ramo composto pelos nós array e sequences da hierarquia da classe base do modelo IUE (Figura 2-8). Intuitivamente, conclui-se que o modelo polimórfico do Khoros trata-se de urna forma de representação bastante simples, quando comparada com o modelo IUE. Entretanto, o problema proposto neste trabalho pode ser modelado totalmente por sua estrutura de dados.
2.3.2.1 Segmentos
Dentro da estrutura de dados do Khoros, uma seqüência de volumes variando no tempo é representada por cinco diferentes segmentos de dados (Figura 2-9): valué, location, time, mask e map, onde cada um tem um significado específico de acordo com sua interpretação. Os segmentos do modelo polimórfico são opcionais; um objeto de dados pode conter qualquer combinação destes, os quais são usados no desenvolvimento do conjunto de operadores padrões fornecidos com o software.
A idéia de dividir a base de dados em segmentos independentes permite ao programador a utilização somente dos recursos desejados. Por exemplo, se não for conveniente mascarar uma imagem, nenhuma informação referente a máscara será armazenada, permitindo que a imagem fique mais simples e compacta. Por outro lado, qualquer operador criado deve verificar a existência dos segmentos conhecidos, mesmo que estes não sejam necessários ao processamento. Esta verificação deve ser feita para que se possa garantir a consistência dos resultados gerados, acarretando um
esforço computacional adicional, muitas vezes sem trazer benefícios adicionais à aplicação desenvolvida.
O segmento valué e o segmento de dados primário, consiste de vetores de elementos de dados organizado implicitamente dentro de uma série de volumes no tempo. O segmento valué pode ser explícitamente posicionado no espaço e tempo com os segmentos de location e time, respectivamente. Os dois segmentos restantes são oferecidos por conveniência. O segmento de mask é usado para marcar os pontos válidos do segmento de valué. O segmento de map é oferecido uma extensão do segmento value\ o segmento valué pode ser usado para indexar os dados de um mapa.
yvJumas ihryuyh ilins
Figura 2-9 - Modelo Polimórfico (Figura extraída de Khor91)
2.3.2.1.1 Segmento Value
O segmento value é o segmento primário de armazenamento dos pixels no modelo de dados polimórfico (Figura 2-10). Trata-se do segmento mais importante


otenfért hss grt tmpkc# -pasübn ft-tâe-uttbâ data : (w,h,0,t.r . Q
t/um ■
Figura 2-10 - Segmento de Valor (Figura extraída de KhorOl)
2.3,2.1.2 Segmento Map
Em casos onde são encontrados vetores redundantes contendo dados que estão duplicados em diferentes posições do segmento value, o segmento map (Figura
2-11) pode ser usado. Este recurso é explorado de modo a implementar uma pseudo tabela de cores que auxilia na visualização e na identificação das regiões de interesse dentro da imagem originalmente em níveis de cinza.
rafee ckra
va/ue pofràs Índex mío thé
¡nep height
■ Z .
• ♦ «
Figura 2-11 - Segmento de Mapa (Figura extraída de Khor?l)
2.3.2.1.3 Segmento Mask
Devido a facilidade de manipulação de matrizes, a maioria dos sistemas visuais trabalham com imagens retangulares (2D) paralelepípedos (3D), etc. No entanto, nem toda região de interesse obedece esta convenção. Em cálculos estatísticos, englobar a imagem por um hipercubo e então fazer os cálculos não seria uma saída apropriada. Pontos que não pertencem efetivamente a imagem e que foram inseridos com a conversão para o sistema hipercúbico de representação, passam a contribuir para o resultado, alterando deste modo os valores obtidos.
O segmento de mask (Figura 2-12) tem a tarefa de resolver este problema. Uma outra matriz binária com a mesma dimensão da imagem contendo zeros e uns indica os pixels válidos e os não válidos. Assim, pontos rotulados com o valor zero deixam de participar da operação e somente são considerados os rotulados com o valor um.
Figura 2-12 - Segmento Mask (Figura extraída de Khor91)
2.3.2.1.4 Segmento Location
A maioria das imagens utilizadas em processamento de imagens fazem parte do mundo real, as quais possuem dimensões físicas definidas que acabam sendo perdidas ao serem digitalizadas. Desta forma deixa de existir uma correspondência das dimensões do objeto real com sua imagem digitalizada.
A maneira com que o Khoros preserva a relação ese alar-espacial entre a imagem digital e a real é feita através do segmento de location (Figura 2-13) que relaciona cada pixel com sua correspondente coordenada do mundo real. Um sistema de coordenadas é associado a imagem, permitindo a utilização de coordenadas negativas e reais.
FnfZre Va/tce-Vector fcpositioned VkLUrrDsñd by a Location Vector (X,Y^)
This position holds for, the vector over sittime
Figura 2-13 - Segmento Location (Figura extraída de Khor91)
2,3.2.1.5 Segmento Time
Como o próprio nome sugere, o segmento de time (Figura 2-14) é o responsável por representar uma sequência de imagens tomadas em vários instantes de tempo. A cada elemento deste segmento, encontramos uma imagem associada a um instante de tempo í(. Desta forma, torna-se possível um acompanhamento dinâmico da evolução da sequência de imagens por um dado intervalo de tempo, fazendo com que características dinâmicas possam ser representadas por uma sequência de imagens estáticas.
Mesmo com a existência do segmento time, um recurso bastante aplicado é a utilização de uma das dimensões do segmento valué como coordenada representativa da evolução temporal da imagem. Isto é possível devido as imagens normalmente processadas não superarem a terceira dimensão. Para evitar o aumento da complexidade ao gerenciar um novo segmento, estas coordenadas são usadas como índice associado ao tempo de cada imagem.
■VALUÉ Wh
Figura 2-14 - Segmento de Tempo (Figura extraída de Khor91)
2.3.2.2	Novos Segmentos
Adicionalmente aos segmentos padrões, existe a possibilidade do programador definir seu próprio segmento e suas características, personalizando a base de dados. A personalização de um novo segmento não é uma opção muito praticada devido a problemática gerada ao se criar um operador dependente de um item não padrão. Todo conjunto de funções de manipulação do novo segmento deve ser criado e anexado a base padrão, além disso, as funções padrões não suportam o novo segmento, o que não garante a integridade do mesmo após a execução de um operador padrão em uma imagem com o novo segmento.
2.3.2.3	Ambiente de Desenvolvimento
Uma das grandes qualidades encontradas no software Khoros é possuir uma ambiente gráfico para a prototipação de soluções denominado cantata e uma ambiente de desenvolvimento de novos operadores denominado craftsman.
2.3.2.3.1 Cantata
Com sua interface gráfica que proporciona um alto nível de abstração, o cantata proporciona um ambiente de programação visual simples e eficiente graças a sua linguagem orientada a fluxo de dados. Fluxo de dados é uma abordagem a qual o programa é descrito como um grafo, onde cada nó representa uma operação e cada arco representa o caminho a ser percorrido pelo fluxo de dados de uma operação para
a outra (Figura 2-15). Os programas desenvolvidos no cantata, através do encadeamento de operadores (glyphs), são denominados workspaces.
Uma das vantagens apresentadas pela abordagem de fluxo de dados representados por grafos, é a grande potencialidade deste tipo de ambiente para a rápida prototipação de soluções. Pequenas alterações no grafo, sejam nos nós, nos arcos ou nas opções de cada operador geram resultados diferentes.
file Edit Workspace Options Control Glyphs
Help

Figura 2-15 - Workspace Desenvolvido no Ambiente Gráfico de Programação do Cantata
2.3.2.3.2 Craftsman
O pacote Khoros é organizado como um conjunto de subsistemas independentes chamados toolboxes. Cada toolbox armazena um conjunto de operadores que normalmente estão associados a uma classe de operação comum. A aritmética, por exemplo.
O ambiente de desenvolvimento oferecido pelo craftsman possibilita a criação e a manipulação destas toolboxes, atuando como um gerente organizacional. Recursos como a geração automática da árvore de diretórios de uma nova toolbox,
i
i
[õpticns v|
■ :'V
I bootstrap
datasanip dataserv design dip envision geometry i mage kr.i»_KC-rk kmnach
Toolboxes (21)
1
CBíPES&amp;lt;all: 11)	?
kcatpixíviff kcrcp
kF&lt;m_ interpolate
kn;in_cr thoprcject ion kmn^rctate knorwcrop ktapein
KviFfSeatpix
Icenpes ldepfinachlib
Toolbox Operations
zl
Object Operations
a
Figura 2-16 - Painel de Controle Principal do Craftsman
2.3.2.3.3	Compose
O programa compose, (Figura 2-17) tem uma função análoga a efetuada pelo craftsman. Enquanto o craftsman controla as atividades de criação e edição relacionados as toolboxes, o programa compose é o responsável pela criação e edição dos objetos dentro de uma toolbox: operadores, bibliotecas, panes, etc* É ele o responsável pelo cadastro dos arquivos de código fonte e das especificações que caracterizam o operador, além da geração de código fonte quando um novo objeto da toolbox é criado.
|.^’Ccmp0$er:;edÍtlng kmm montage In toolbox ceM
I	.	..........-..-	■ ■ ...........-	- ■

•líét-.Fílsã
		U1S ■	
		-Sttó-	
			kw-UFGitf.agc.h	|
		ilüi.	r'.PIft_rr.ontãge,hlp	i
88#		CONFIG	k™...nontjS5.i	j
	■Mti	INFO	
i.T„			krasjoitdgs.tadú	j
		hlK	age.change loo	j
I		nu	C?iS	■
			Trr.àkefile	¡
			Ih	:
			Fils Operation?	’Ç
CENDES; i ¡y ws .tncntage 4krout i re}
■	":'f
I swT~ 1
Figura 2-17 - Painel de Controle Principal do Compose
O programa guise é outra ferramenta de auxílio do pacote Khoros. Com ele pode-se desenvolver ou modificar a interface do painel de configuração, entrada e saída de dados de um operador. Assim, o usuário deixa de ter sua preocupação a interface, podendo se concentrar no objetivo real de sua programação.
Entre os recursos oferecidos pelo guise destacam-se as entradas e saídas de dados feitas por arquivos, a entrada numérica de dados, a seleção de opções através de uma lista, etc.; recursos previamente implementados e disponibilizados automaticamente ao programador quando feita a geração de código básico de um operador. Desta forma, conhecendo a estrutura de dados usada pela interface gráfica dos painéis, o programador tem total acesso aos dados de entrada fornecidos pelo usuário, sem ter a preocupação da criação ou gerenciamento desta interface gráfica. A seguir, na Figura 2-18 é apresentado o painel de controle principal do programa guise:
Figura 2-18 - Painel de Controle Principal do Guise
2.3.3	Modelo MMachLib
De 1990 a 1992, a Khoral ofereceu a toda comunidade o software Khoros 1.0 e para o ano de 1992 foi prometida a versão 2.0 que traria várias inovações, fazendo com que a versão 1.0 fosse abandonada para o desenvolvimento da nova versão. No entanto, a versão 2.0 não ficou pronta na data esperada, deixando usuários da plataforma Khoros desamparados de atualizações. A versão 2.0 só foi concluída em 1994 e em sua versão inicia], o conjunto de programas mostrou-se muito instável. Além disso, o código produzido para a versão 1.0 tornou-se obsoleto devido a mudanças no modelo de representação dos dados.
A demora na estabilização dos inúmeros problemas gerados pela introdução de um produto totalmente novo, incentivou a união de pesquisadores da USP e Unicamp, que utilizam o Khoros como ferramenta básica para suas pesquisas em processamento de imagens, a criarem uma ferramenta mais simples, que permitisse o desenvolvimento de novos operadores portáveis, sem toda a complexidade inerente aos segmentos do modelo polimórfíco.
Desta forma, foi criado um grupo de desenvolvimento de uma ferramenta que deveria ser simples, rápida, portável e que oferecesse os recursos mais usados do software Khoros. Nasceu então a MMachLib, uma biblioteca de operadores feita em
C que permite a manipulação, processamento e análise de imagens, primordialmente na área de morfologia matemática.
Para a utilização da MMachLib existe a necessidade de uma interface apropriada (Figura 2-19) para a conversão de uma imagem genérica para a estrutura MMachLib e vice-versa, além de um dispositivo para a visualização das imagens resultado. Nesta dissertação utiliza-se a interface Khoros com funções especialmente desenvolvidas que permitem a conversão e a visualização dos dados.
Figura 2-19 - Modelo de Interface MMachLib
Com a adoção de uma representação dos pixels através de um arranjo, além da permissão controlada da manipulação direta da base de dados, o modelo MMachLib mostra-se bastante simples, deixado a cargo do programador a responsabilidade pela integridade dos dados. Toda a manipulação é feita através de ponteiros que endereçam diretamente a estrutura de dados.
Tendo a liberdade de manipulação direta dos dados através de ponteiros, conseguiu-se uma forma interessante de agilização das operação sobre a base de dados. No entanto, a responsabilidade pela integridade resultados é deixada a cargo do programador dos novos operadores. Desta forma, é assumido o risco de ter um resultado eventualmente corrompido por um operador mal projetado, em virtude da agilização do processamento.
Deve-se observar que para os usuários dos operadores, não existe a possibilidade de corromper as imagens, a menos da execução de operações inválidas não previstas pelo operador utilizado.
Toda portabilidade da MMachLib fica garantida pelo fato dela ser uma biblioteca que não possui um dispositivo de display, tornando-se independente do tipo de interface gráfica adotada. Cada operador assume que todo os atributos necessários ao processamento são passados como parâmetro e que as imagens que serão processadas encontram-se em memória no formato da estrutura de dados da biblioteca. De modo análogo, o resultado obtido pelo processamento do operador retorna no formato da estrutura MMachLib.
Atualmente, além da plataforma Khoros™, estão sendo desenvolvidas as interfaces necessárias para a manipulação da base de dados MMachLib na plataforma Windows®.
2.3.3.1 Estrutura MMachLib
A estrutura de dados usada no armazenamento dos pixels da imagem (Figura 2-20) é um arranjo unidimensional o qual é acessado através de três coordenadas width (largura), height (altura) e depth (comprimento), respectivamente. Desta forma, através de uma função bijetora pode-se acessar os dados vetoriais como uma matriz tridimensional, através da seguinte relação:
f(x, y, z) = x 4- y X width + z x width x height
Onde x, y e z são as coordenadas do ponto procurado e f é a função transformação do espaço tridimensional para o unidimensional.
Width
Figura 2-20 - Modelo Esquemático da Estrutura de Dados MMachLib
2.4	Visualização 3D
As estruturas de dados citadas anteriormente, apresentam como modelo de representação de um objeto tridimensional, a aproximação feita através de planos de cortes paralelos obedecendo um certo espaçamento fixo entre as fatias. O objetivo da visualização 3D é fornecer ao usuário uma maneira mais realística de visualização dos objetos 3D, através da projeção 2D de suas superfícies por um dado ângulo de visualização (Figura 2-21).
Figura 2~21 - Modelo Esquemático da Visualização 3D
Nesta dissertação, utiliza-se a toolbox V3Dtools [Falc93] [Lupp94] [V3DT93] como ferramenta para a obtenção destes resultados.
2.4.1	V3Dtools
Além de suas várias aplicações, a toolbox V3DTooIs oferece um conjunto de operadores, que ao serem combinados de forma adequada (Figura 2-22), são capazes de reconstruir um objeto representado a partir de cortes 2D, de forma a oferecer uma visualização “contínua” do objeto.
Figura 2-22 - Workspace da Visualização 3D
Como pode ser observado na Figura 2-22, a partir de um volume em níveis de cinza obtido na saída o operador reorient, o encadeamento dos operadores
ray casting, voxel space normais, texture e shading, pertencentes a toolbox VSDTools, geram a projeção 2D da superfície tridimensional do volume binário voxel.
A geração desta projeção esta baseada na emissão de raios sobre os pontos dos volume, admitindo-se que a superfície a ser visualizada é contínua. A partir do conjunto de raios “refletidos”, calcula-se as normais a cada ponto da superfície. Com os raios emitidos e as normais pontuais calculadas, aplica-se um algoritmo de textura e em seguida, o algoritmo de shading. Desta forma, chega-se a projeção 2D da superfície do volume binário desejado.
2.5	Aquisição dos Dados
Uma técnica não destrutiva mostrou-se necessária na aquisição dos dados, pois como apresentado anteriormente, o cálculo da porosidade e da saturação incluem várias imagens da mesma amostra saturadas por fluidos diferentes. Para amostrar-se imagens em condições e tempos diferentes, recorreu-se a tomografía que garantiu a integridade da amostra além da boa precisão nas imagens amostradas.
Em seu estado natural, não seria possível injetar um fluido na amostra, de modo a mantê-la saturada e depois submetê-la a injeção direcionada de um fluido, de modo permitir o acompanhamento do deslocamento da frente formada. A baixa pressão nas regiões periféricas invalidariam o experimento, pois preferencialmente o fluido injetado sairia pela periferia ao invés de se propagar pelo meio poroso. Para evitar o problema de baixa pressão nas regiões mais externas, foi adotado o modelo de preparação do meio poroso descrito na seção a seguir.
2.5.1	Preparação da Amostra
Após a retirada da amostra cilíndrica do bloco de arenito, esta é vedada por uma resina, juntamente com seus difusores (Figura 2-23). Os difusores foram usados nas duas extremidades da amostra para proporcionar um espalhamento uniforme do fluido injetado. Um tubo de PVC serviu de molde para garantir a forma cilíndrica da amostra preparada. Foi escolhido o formato cilíndrico, com a amostra centrada no interior do tubo, para que fosse possível minimizar o efeito de endurecimento de feixe (seção 2.5.1.1), pois o feixe projetado na amostra sempre percorre a mesma espessura de resina e do tubo PVC, independente da direção do feixe, deixando de influenciar o resultado.
&gt; TubodePVC&amp;lt;
&gt; Resina&amp;lt;
Figura 2-23 - Preparação da Amostra
Concluída a preparação física da amostra, satura-se a rocha através da injeção contínua de óleo. Em seguida leva-se a amostra a mesa do tomógrafo, onde passa-se a injetar a solução salina de Kl (Iodeto de Potássio) (Figura 2-24). Ao iniciar o processo de injeção de Kl, começa-se a tomografar a rocha de modo a obter o comportamento do deslocamento dos fluidos pela rocha. São feitas tomadas em vários instantes de tempo possibilitando caracterizar o comportamento temporal de escoamento da amostra.
Figura 2-24 - Modelo Esquemático do Deslocamento dos Fluidos pela Amostra
2.5.1.1 Efeito de Endurecimento de Feixe
O efeito de endurecimento de feixe ou Hard Beam é uma anomalia causada na região periférica das seções tomográficas (Figura 2-25), provocando um aumento dos valores CT da amostra. Este efeito é causado pela absorção do feixe de radiação pela amostra.
Figura 2-25 - Diagrama Ilustrativo do Efeito de Endurecimento de Feixe
Apesar das tentativas de gerar feixes puramente monocromáticos, estes feixes contém uma pequena quantidade de luz em outras freqüências. Baixas frequências passam a ser absorvidas pela amostra fazendo com que o tomógrafo receba uma menor quantidade de radiação que a esperada, causando alterações nas intensidades dos pixels. Como a absorção é mais intensa na região periférica, a anomalia mostra-se mais evidente nesta região, onde os pixels acabam assumindo valores maiores que os esperados.
Mesmo sendo a principal causa do efeito de endurecimento de feixe, o problema com a luz monocromática não é o único causador deste efeito, a calibração do tomógrafo pode agravá-lo. Devido a tradição da utilização médica dos recursos tomográfícos em humanos e animais, os tomógrafos normalmente se encontram calibrados com tecidos que contém grande quantidade de água (63% da composição de uma pessoa). Ao se trabalhar com rocha, formada por quartzo na sua maioria, o tomógrafo deveria estar calibrado com quartzo. Como os custos de manutenção de um tomógrafo são bastante altos e a calibração exige a presença de um técnico especializado, normalmente são utilizados tomógrafos calibrados com tecidos humanos, aproveitando recursos de algum hospital ou clínica, diminuindo os custos e agravando o efeito de endurecimento de feixe.
Uma metodologia corretiva via software foi implementada em [Silv94], onde foi encontrado uma função de correção obtida pela média dos cortes radiais da amostra. Percebemos que tal correção trata a imagem globalmente, causando uma
suavização índesejada das fatias da amostra, pois propriedades locais acabam sendo perdidas devido a globalidade da função de correção.
Estudos mais recentes [Gome97] tem mostrado que a utilização de tomógrafos mais modernos como o Helicoidal Hi Speed GE diminuem significativamente este efeito. Além disso, a própria natureza do cálculo da porosidade e da saturação acabam por cancelar boa parte deste, devido a aritmética dos cálculos das propriedades. Isto pode ser observado ao se fazer a subtração de duas imagens de acordo com as fórmulas para o cálculo da porosidade e da saturação.
2.5.2	Aquisição de Imagem
Para que fosse possível efetuar ensaios dinâmicos, verificando o comportamento temporal da propagação do fluido injetado, foi necessário escolher um tomógrafo rápido, que varresse uma amostra de 40cm em 4 ou 5 segundos, permitindo que esta fosse varrida algumas vezes durante a mesma seção de injeção. O tomógrafo axial, que efetua um giro de 180° a cada fatia tomografada, mostrou-se ineficiente ao problema devido ao tempo gasto na varredura da amostra. O tomógrafo helicoidal varre toda amostra em poucos giros helicoidais, tornando possível o acompanhamento da frente de propagação do fluido injetado e possibilitando a pesquisa de ensaios dinâmicos através da utilização de imagens tomográficas.
Nos experimentos apresentados nessa dissertação foi usado o tomógrafo de 3a geração Helicoidal Hi Speed GE, onde foram geradas imagens com a resolução 0.5mm e matriz de 512x512 pixels e 40 cortes reconstruídos a cada lOmm, onde os valores dos pixels variam tipicamente entre -1000 e 3000 CT. Estes dados foram gravados em fitas DAT de 4mm, sendo que as imagens encontram-se seqüencialmente armazenadas, no formato proprietário da GE.
3.	Processamento, Análise e Visualização de Dados
Neste capítulo é definido um conjunto de ferramentas, que atuam sobre imagens no formato voxels, obtidas através de tomografia de amostras de meios porosos cilíndricos, bem como algumas técnicas de manipulação, de análise e de visualização dos dados.
De modo geral, o problema de calcular experimentalmente uma propriedade qualquer de um meio poroso utilizando imagens CT pode ser dividido em: Recuperação das Imagens, Pré-Processamento, Processamento, Visualização e Visualização Analítica, como mostra a Figura 3-1. Na fase de recuperação das imagens, resgata-se as imagens armazenadas em algum dispositivo de alta capacidade de armazenamento convertendo-as para o formato do programa de processamento; na fase de pré-processamento, é feita a escolha da região de interesse, o alinhamento das fatias, a normalização geométrica e o mascaramento das imagens, deixando a imagem preparada para o processamento; no processamento é feito o cálculo das propriedades desejadas; na fase de visualização os resultados são apresentados através de uma saída gráfica; e em paralelo, na fase de análise dos resultados são feitas medidas estatísticas sobre os dados calculados.
Figura 3-1 - Modelo Geral de Processamento de Imagens Tomográfkas
3.1	Recuperação das Imagens
O objetivo desta fase é obter um algoritmo capaz de recuperar as imagens tomográficas das fitas DAT para a memória e então convertê-las do padrão proprietário do tomógrafo, para o formato reconhecido pelo processador, ou seja, a fase de recuperação das imagens pode ser subdividida em duas novas etapas (Figura
3-2): manipulação e leitura da fita; e conversão da imagem tomográfica.
Figura 3~2 - Modelo Esquemático de Recuperação das Imagens Gravadas em Fita
3.1.1	Manipulação e Leitura da Fita
Exames tomográficos consistem de uma sequência de imagens, tipicamente variando entre 5 e 50 fatias, exigindo dispositivos com alta capacidade de armazenamento para guardá-las: fitas DAT, CDROM, discos ópticos, etc. Nesta dissertação, aborda-se a situação em que o tomógrafo gera as imagens armazenando-as em dispositivos de acesso sequencial, como por exemplo, uma fita.
Vários exames4 podem ser armazenados em uma mesma fita, também na forma seqüencial. Um sistema de leitura é necessário para resgatar as imagens armazenadas em fita.
Uma série de transformações devem ser efetuadas na fase de manipulação da fita, antes que a leitura seja feita. É necessário especificar cada um dos seguintes dados para o controle da fita: a escolha entre a leitura das imagens em uma máquina local ou remota, o deslocamento a ser efetuado para o posicionamento da fita na primeira fatia do exame, o número de fatias a serem lidas e o momento de rebobinar a fita.
4 Exame: No contexto de tomografía, exame trata-se de uma amostragem efetuada sobre o corpo tomografado, neste caso, um meio poroso. Um exame tomogr ático procura capturar as informações internas de um corpo, sem que este seja destruído ou penetrado por algum instrumento tísico.
Como as imagens estão gravadas em fita e nem toda a máquina de uma rede possui um dispositivo local de leitura de fita, a leitura da pode ser local ou remota, possibilitando que um número maior de usuários utilize o sistema, independente de se possuir ou não uma unidade local de leitura de fita.
Tendo a fita posicionada na primeira fatia do exame, seqüencialmente lêem~se as fatias para a memória, empilhando-as em uma única imagem 3D. Esta operação reconstrói o volume da amostra no modelo voxel. Opcionalmente, após a reconstrução do volume em memória, este pode ser armazenado um disco rígido, evitando futuras repetições do processo de manipulação e de leitura de fita que é bastante moroso, permitindo a rápida recuperação do volume em manipulações futuras.
3.1.2	Conversão de Formatos de Armazenamento de Imagem
Como o software de processamento de imagem não reconhece os diversos formatos de arquivo gerados pelos tomógrafos, as imagens armazenadas na memória ou no disco rígido, devem passar por um processo de conversão, para serem reconhecidas. Para isto, deve-se fornecer a identificação do tomógrafo utilizado na aquisição dos dados, para que seja selecionado o algoritmo correto de conversão a ser utilizado.
Na conversão são extraídas informações referentes as condições a qual o exame foi feito: número e identificação do exame, horário da aquisição, número de fatias do exame, etc.; além dos valores de cada pixel convertido para o formato de armazenamento de imagem que seja compatível com o software de processamento. Estes dados são armazenados de acordo com as capacidades oferecidas pelo formato de imagem oferecido pelo software de processamento.
Embora exista uma padronização para o formato de arquivo de imagens to mo gráficas (DICOM), os fabricantes de tomógrafo co mu mente adotam padrões particulares. A criação de um padrão de escrita dos dados que fosse seguido pelas empresas fabricantes de tomógrafo faria com que este algoritmo fosse único, diminuindo a complexidade e a quantidade de rotinas. Enquanto esta padronização não se concretiza, a cada modelo de tomógrafo cadastrado, uma rotina de conversão deve ser criada e adicionada. Desta forma, somente os tomógrafos cadastrados são reconhecidos, permitindo a leitura e a conversão dos arquivos por ele gerados, para um dos formatos aceitos pelo programa de processamento.
3.1.3	Representação de um Volume Tomográfico
Define-se um volume tomográfico discreto (Figura 3-3) como um conjunto de voxels representados por /(x,y,z)que é o valor CT do ponto (x,y,z) onde x,y,zeW. O valor CT é um número inteiro pertencente ao intervalo [— 1000,3095]. O domínio de fé dado por:
f =&gt; Ej [(0,0,0), (W - 1, H - 1, D - 1)]
onde W representa a largura, H a altura e D a profundidade da imagem.
Width
Figura 3-3 - Representação Genérica de um Volume Tomográfico
3.2	Pré-Processamento
Apesar de serem reconhecidas pelo programa responsável pelo processamento, as imagens que vieram da fase de leitura da fita ainda não se encontram prontas para serem efetivamente utilizadas. Problemas devido ao grande volume de dados desnecessariamente armazenado nas imagens originais e imprecisões vindas da fase de aquisição dos dados: imagens não alinhadas e com dimensões não normalizadas, devem ser corrigidas.
Para que as fatias da imagem estejam prontas para 0 processamento, alguns passos devem ser seguidos (Figura 3-4): a redução do volume de dados através
da seleção da região mínima de interesse; a correção do alinhamento das fatias; a normalização das dimensões do volume, de modo que estas sejam fixadas; e a inserção de máscara, caso o modelo de representação não consiga representar adequadamente a geometria da amostra.
Mascaramento i
das Regiões	i imagem ¡
Externas à	i Pré~Processada |
Amostra
Figura 3-4 - Modelo Esquemático do Pré-processamento
Imagem !

J
3.2.1	Seleção da Região Mínima de Interesse
A facilidade de seleção automática da região de interesse aplica-se às imagens tomográfícas, pois nas periferias de cada fatia da amostra, normalmente encontram-se regiões que não fazem parte do domínio de interesse (Figura 3-5), ou seja, um conjunto de pontos adjacentes que estão fora do intervalo de intensidades CT selecionado. Ao selecionar um intervalo de valores de interesse em CT, pode-se determinar o retângulo mínimo que engloba todos os pontos pertencentes a este intervalo, descartando uma parte dos pontos fora deste intervalo.
De forma exagerada, a Figura 3-4 mostra situações típicas onde pode-se reduzir as dimensões das fatias sem que ocorra a perda das informações de interesse.
Figura 3-5 - Modelo Esquemático da Seleção da Região Mínima
Como o volume de dados se reduz, o processamento torna-se mais rápido, pois o número de pontos a ser manipulado é menor que na imagem original.
3.2.2	Correção do Alinhamento
Devido a imprecisões no posicionamento das amostras sobre a mesa do to mó grafo, a cada exame feito, corre-se o risco da amostra não estar precisamente na mesma posição de um exame anterior. Inclinações indesejadas acabam resultando em seções diferentes das esperadas, implicando na perda da correspondência dos pixels de uma mesma fatia feita em instantes de tempo distintos. Além disso, não existe a garantia que o conjunto de imagens necessárias ao cálculo das propriedade, tenha sido adquirido em um mesmo dia. Problemas físicos como a dilatação da amostra devido a mudança de temperatura, também influem nos resultados do exame. Na Figura 3-6 é mostrada a diferença dos cortes obtidos quando a amostra muda de posição em relação ao plano de corte.
Amostra
Seção Elíptica
Amostra
Alinhamento do Tomógrafo
&gt; Alinhamento da Amostra
	k y
y‘\	
líc A	X'
	
	\ ■' Av.-r
	S r4—
Planos de Corte do Tomógrafo
Figura 3-6 - Ilustração Demonstrando o Problema do Alinhamento
Para minimizar este problema, uma metodologia de alinhamento deve ser utilizada de modo a explorar as características geométricas das amostras. A geometria cilíndrica e o pequeno ângulo Q , formado entre o eixo de alinhamento do to mó grafo e o da amostra permitem ignorar tal problema, assumindo que as fatias estão alinhadas quando completada a fase de extração do retângulo mínimo de interesse. Considerando que a amostra estudada possui 5cm de diâmetro, 40cm de comprimento e que cada seção circular possui em média 266 pixels, verifícou-se que o des alinhamento entre a primeira e a última fatia é em média de 4 pixels, aproximadamente 0.56mm. Desta forma, tem-se que o ângulo 0 médio é 0.0802 graus, ou seja, o erro provocado pelo não tratamento do alinhamento é pequeno, podendo ser ignorado, pois sen(ó )= sen (0.0802)= 0.0014 ~ 0.035 = 25 x sen(6 )= ô (Figura 3-6).
3.2.3	Normalização das Dimensões
Ao se escolherem os retângulos que selecionam as regiões de interesse, estes freqüentemente não possuem dimensões iguais, diferenciando uns dos outros por alguns poucos pixels. Além disso, devido a pequenas rotações na amostra, cortes que deveriam produzir seções circulares acabam produzindo seções elípticas. Para corrigir estes inconvenientes, a normalização das dimensões dos retângulos (Figura 3-7) se faz necessária.
Vale ressaltar que para outros tipos de geometria não se pode garantir a eficiência desta metodologia, pois as simplificações conseguidas usufruem da simetria encontrada nas fatias circulares, possibilitando ignorar pequenas rotações. Uma geometria irregular da amostra inviabiliza o método e uma forma alternativa de normalização se faz necessária, cabendo ao usuário pesquisar e desenvolver novas alternativas de alinhamento para amostras com seções não circulares.
Após a escolha prévia das dimensões das fatias de saída, largura e altura, cada retângulo é normalizado para estas dimensões. Normalmente para manter a característica circular dos cortes da amostras, escolhe-se um retângulo onde a largura e a altura são iguais formando um quadrado.
Normalização
Figura 3-7 - Modelo Esquemático Demonstrativo da Normalização das Fatias da Amostra
Ao escolher as dimensões finais das fatias de saída, pontos não existentes na imagem original acabam sendo incluídos quando a imagem resultante possui dimensões maiores que a original; ou os pontos em excessos são descartados quando a imagem resultante possui dimensões menores que a original. Para que as intensidades destes pontos se aproximem dos valores reais encontrados na amostra, um algoritmo baseado em interpolações (caso a dimensão da imagem de saída seja maior que a original) ou sub-amostragem (caso a dimensão da imagem de saída seja menor que a original) deve ser utilizado.
Para a manutenção da qualidade da amostra, procura-se escolher as dimensões o mais próximo possível da original, evitando, dentro do possível, a inclusão ou o descarte de pontos na imagem final.
3.2.4	Mascarando Regiões de Não Interesse
Pelo fato das imagens utilizadas pela grande maioria dos programas de manipulação e processamento de imagens serem retangulares, baseadas em representações matriciais, imagens com uma geometria diferente devem ser tratadas de forma diferenciada, fazendo com que somente a região real da imagem seja representativa quando submetida a algum tipo de operação, desconsiderando qualquer outra que tenha sido incluída de modo a completar o modelo matricial.
Mesmo selecionando o retângulo mínimo contendo toda a região de interesse, devido a geometria circular, pontos que não pertencem a este intervalo
ainda continuam a fazer parte da imagem resultante, isto é, pontos externos a amostra, mas dentro do retângulo mínimo selecionado (Figura 3-8).
Figura 3-8 ~ Modelo Esquemático de Mascaramento de uma Imagem
Para que estes pontos extras não contribuam nos resultados calculados, usa-se o artifício de mascarar os pixels fora do intervalo de interesse. Mascarar ou não um pixels é equivalente a indicar se ele pertence ou não a imagem de interesse. Com isto, mesmo existindo fisicamente na estrutura de dados, pontos mascarados serão desconsiderados no processamento.
O artifício normalmente usado para a criação de um máscara é associar a imagem original, uma outra imagem binária possuindo as mesmas dimensões. A cada um dos ponto da imagem binária é atribuído zero ou um indicando que o seu correspondente na imagem original é um ponto de não interesse ou de interesse, respectivamente. Antes de qualquer operação envolvendo a imagem original, a imagem binária é consultada, verificando se o ponto em questão deve ser operado ou não.
3.2.5	Representação Matemática do Pré-processamento
As operações envolvidas na fase de pré-processamento são descritas na Equação VIII, onde a cada fatia do volume fk é extraído o retângulo mínimo contendo os pontos com intensidade dentro do intervalo de interesse através do operador janela J e finalmente, aplicando a operação NORM. as dimensões de cada fatia são normalizadas para um tamanho comum previamente definido.
cfci1 = NORMM1íN(4,)(/,)), fc = 0,l,...,P-l
(VIII)
A colocação da máscara através da operação p , pode ser efetuada em qualquer uma das fases do pré-processamento. No entanto, para diminuir o esforço
computacional envolvido na verificação dos pontos mascarados ou não, é aconselhável inserir a máscara após os outros passos do pré-processamento terem sido completados.
Fazendo com que a imagem de entrada seja trabalhada fatia a fatia, temos:
fk (x,y) = f(x,y,k), k = 0,1,..., D ~ 1
Definimos o operador janela ./. por:
x0 = min(x')\fk (x\ y') g [¿qè] )o =min(y)\fk(x\ y')e[a,b] Xj = max(x')I fk (xy') e [e.é J ys = max(y)\ fk (Z, y') e [a,b]
XG	0, Xj - x0
y G	-y0
k e[0,£&gt;- 1]	
Onde a e b definem os limites inferior e superior do intervalo de intensidades de interesse dos pontos, respectivamente.
Define-se NORM MxN [/ (.v. y)] como uma função de normalização responsável pelo escalonamento das fatias da imagem, explorando os recursos de interpolações, replicação de pixels e sub-amostragens, gerando as imagens resultado com as dimensões desejadas. Onde M e N são as novas dimensões da fatia redimensionada.
Define-se a função máscara u , como sendo:
1,
0,

se/(x, v,z)g [a,b] caso contrário
Onde aeb possuem o mesmo significado usado na definição do operador janela J, ou seja, os limites inferior e superior do intervalo de intensidades de interesse dos pontos, respectivamente.
3.3	Processamento
Uma vez que os dados estão normalizados, é possível processar pontualmente, isto é, voxel a voxeL os volumes adquiridos em tempos diferentes.
CTR2^
(CT^CT,)
Saturação
Porosidade
3.4	Visualização
Devido a bidimension alidade dos dispositivos computacionais de apresentação: monitor, impressora, etc., a visualização de dados volumétricos nunca é possível a partir de uma única imagem. Em geral, são utilizadas diversas técnicas de transformações geométricas para visualizar os dados em diversas formas e perspectivas. Neste trabalho, foram implementadas três destas técnicas: o mosaico das fatias, a projeção ortogonal e a visualização 3D,
Mesmo tendo sido inspiradas em problemas de engenharia de petróleo, estas técnicas de visualização podem ser utilizadas em outros contextos onde se possui uma imagem digital formada por uma seqüência de cortes bi-dimensionais, formando um volume no formato voxeL
3.4.1	Mosaico
Através do recurso de visualização de imagens 3D proporcionada pela técnica de mosaico, uma seqüência de imagens 2D pode ser visualizada uma ao lado da outra, possibilitando uma visão global de todo volume (Figura 3-9). A vantagem desta técnica é que todos os voxels são apresentados, porém sua desvantagem é a perda da informação espacial tridimensional dos dados.
Imagem
3D
Imagem
Figura 3-9 - Modelo Esquemático do Mosaico de uma Imagem
A modelagem matemática da técnica de mosaico pode ser descrita pelas equações apresentadas a seguir, onde / representa a imagem 3D de entrada equivalente a descrita na seção 3.1.3 e # a imagem resultante, definida por:

z x Ílí = x + (z mod A) x IV [V = y + (z dlV A)xH 0, caso contrário
(IX)
Onde A representa o número de imagens por linha, P div Q a divisão inteira de P por Q e P mod Q é definida como o resto da divisão inteira de P por Q.
A dimensão da imagem resultante são dadas por (WA - 1, H y ceil(D / A)), onde ceil(D / A) representa o menor inteiro, maior ou igual a divisão real de D por A.
Ao se utilizar visualização de imagens 3D pela técnica de mosaico, um problema comum é o rápido aumento das dimensões da imagem resultante. O concatenamento das fatias em seu tamanho original muitas vezes inviabiliza a visualização de todos os dados. O recurso utilizado para minimizar este inconveniente é agregar a função geradora do mosaico, a possibilidade de escalonamento da imagem resultante (Figura 3AO), onde é possível reduzir as dimensões das fatias concatenadas.
Figura 3-10 - Modelo Esquemático do Escalonamento do Mosaico de uma Imagem
Uma forma de identificação visual imediata de cada fatia é um recurso de grande valia num sistema de visualização do tipo mosaico. Localizar uma dada fatia dentro de um conjunto numeroso de elementos (Figura 3-11). passa a ser uma tarefa desagradável quando não se dispõe de uma forma de localização. Portanto, um sistema de identificação pode ser implantado no algoritmo para facilitar uma pesquisa na imagem.
Imagem
Figura 3-11 - Modelo Esquemático de Identificação da Fatias
Outro artifício que pode ser utilizado para aumentar o número de fatias visualizadas em uma mesma tela, é manipular o número de fatias apresentadas por linha da imagem mosaico. As dimensões da imagem resultante pode ser variada de acordo com as necessidades de visualização (Figura 3-12), ou seja, o número de fatias adjacentes por linha da imagem mosaico, dada por A na equação IX, passa ser uma outra variável. A inclusão desta opção possibilita a personalização das dimensões do display final.
Imagem
Figura 3-12 - Modelo Esquemático da Personalização do Display
Quando considerada uma imagem com uma numerosa quantidade de fatias, mas com um subconjunto reduzido de fatias de interesse, a possibilidade de se visualizar somente este subconjunto mostra-se uma opção valiosa (Figura 3-13) que possibilita a valorização somente dos dados de interesse, além disso, o processamento direcionado as fatias de não interesse deixa de ser feito, proporcionando maior rapidez no processamento e na visualização.
Imagem 3D
Imagem
Figura 3-13 - Modelo Esquemático de Escolha de um Subconjunto
Para o aproveitamento total destes recursos, estas opções devem ser apresentadas ao usuário de modo que este possa escolher a combinação de opções que possibilite a melhor visualização dos dados de interesse.
3.4.2	Projeção Ortogonal
Outra ferramenta de visualização de imagens 3D desenvolvida é a projeção ortogonal. Como o próprio nome sugere, trata-se da apresentação de cortes ortogonais da amostra (Figura 3-14). Selecionando as coordenadas de cada plano de
corte, pode-se determinar quais as seções, planos de corte XY, XZ e YZ, devem ser apresentadas.
^'1
Figura 3-14 - Organização dos Planos de Cortes da Projeção Ortogonal
A visualização baseada no modelo de projeção ortogonal pode ser descrita matematicamente através do seguinte conjunto de equações que modelam o algoritmo:
x'6[o,I¥- 1],
/r(i,z)=/(x,Ú y'e[0,/7-l], /z(Jt’&gt;’)=r(x-y-z)&gt; z'e[o,£)-l],
se plano de projeção for YZ se plano de projeção for XZ se plano de projeção for XF
(X)
Onde X, Y e Z definem os planos de cortes relativos a cada eixo de orientação, representados segundo a Figura 3-14.
Em virtude do pequeno número de pixels obtidos normalmente na dimensão profundidade da amostra quando comparado a largura e a altura, um algoritmo de interpolação pode ser associado ao operador projeção ortogonal de forma a apresentar as projeções de forma mais “contínua”.
3.4.3	Tabela de Pseudo Cores Dinâmica
A visualização das informações através de imagens níveis de cinza, normalmente não possuem o contraste desejado entre as regiões de interesse e as demais. A tabela de pseudo cores dinâmica, combina a associação de uma tabela de pseudo cores à imagem, juntamente com o aumento de contraste, evidenciando somente o intervalo de interesse dinamicamente selecionado (Figura 3-15).
Figura 3-15 - Modelo Esquemático da Tabela de Cores Dinâmica
A tabela de pseudo cores dinâmica, permite que o usuário defina o intervalo de interesse dos pixels. A geração desta pode ser feita através de funções senoidais definidas para os canais R, G e B conforme a Figura 3-16, permitindo uma melhor visualização do intervalo de interesse. Aos pixels com intensidades externas ao intervalo de interesse é atribuído uma única cor não pertencente a tabela de cores gerada, tornando fácil a distinção entre as duas regiões: a de interesse e a de não interesse.
Figura 3-16 - Tabela de Cores Senoidal
As equações de geração da tabela de cores dinâmica são apresentadas a seguir:
, V i, i e [min, max ]
Onde gR ,gG ,gB correspondem aos canais R, G ou B da tabela de cores,
a e b os extremos delimitadores do intervalo de abrangência final da tabela de cores; e min e max representam os valores de máximo e mínimo que delimitam o intervalo de interesse dos pixels da imagem original e i é uma determinada intensidade de pixel pertencente ao intervalo de interesse [min, max].
gG^k gB =lp
\ global min &amp;lt;i &amp;lt;min ou max &amp;lt;i &amp;lt;global max
Onde global min e global max representam os mínimos e máximos
globais da imagem, respectivamente e k representa uma cor constante, em níveis de cinza, selecionada pelo usuário e que não pertence ao conjunto de cores geradas pelas seno ides, desta forma, pixels com intensidades externas ao intervalo de interesse selecionado não prejudicam a visualização dos pontos escolhidos. Para imagens que representam os valores CT de uma amostra, os voxels tipicamente assumem valores inteiros entre d 000 e 3095.
A seguir, na Figura 3-17, é apresentado o gráfico representativo de uma tabela de cores:
0
Intensidade
Min Min Global
Max Max
Global
Figura 3-17 - Tabela de Cores Genérica
3.4.4	Visualização 3D
A proposta deste tipo de visualização é apresentar a iso~superfície de rendering de modo a ser visualizado uma dada região do volume no formato voxel, segundo um ângulo de projeção selecionado (Figura 2-21). A região a ser apresentada é selecionada por threshold, esta é determinada através o intervalo de interesse a ser apresentado. Esta técnica é descrita em detalhes em [Falc93J.
3.5	Visualização Analítica
A análise dos dados está intrinsecamente ligada à aplicação abordada. Recursos numéricos operados sobre as imagens pré-processadas podem ser aplicados de modo a retornar as informações desejadas: média, desvio padrão, máximo, mínimo, moda, etc. Toda limitação desta fase resume-se a potencialidade das ferramentas de análise do software utilizado.
Recursos como a avaliação estatística das imagens feita fatia a fatia ou volumétricamente, proporcionam informações descritivas das propriedades da amostra analisada. Os resultados obtidos nesta fase são apresentados normalmente na forma de tabela ou gráficos, dependendo dos recursos oferecidos pelo software de análise.
Nestes cálculos envolvendo as intensidades dos pixels da amostra, fica evidente a grande importância da máscara criada na fase de pré-processamento. Para os sistemas em que não é possível a representação fiel das diversas formas de imagens: retangular, circular, triangular e outras, acaba sendo necessário a inclusão de pontos na imagem original para possibilitar a representação retangular, normalmente adotada pelos sistemas de processamento. Estes pontos adicionados artificialmente à imagem de modo a completar o retângulo de representação, podem influir nos resultados.
Cálculos baseados em informações de vizinhança de pixels, produzem resultados diferenciados quando consideradas imagens mascaradas ou não. Somente operações exclusivamente pontuais não sofreram com os problemas de limitação de representação das imagens. A análise estatística somente é feita nas imagens mascaradas, para os pontos cuja máscara possui valor um. Os pontos cuja máscara é zero são ignorados.
4.	Implementação
A partir da descrição do problema e do equacionamento da solução genérica, a primeira questão foi escolher a melhor maneira de implementá-lo. Pensou-se na opção de criação de um pacote dedicado a sua resolução, opção abortada devido ao esforço a ser direcionado para a criação de todo o conjunto de operações preexistentes em alguns softwares: geradores de imagens, visualizado res, operações aritméticas, análise estatística, etc.; esforço este que extrapolava os objetivos traçados para esta dissertação. Assim surgiu a idéia de aproveitar os recursos de algum programa preexistente e desenvolver somente os módulos que não se encontravam disponível no produto e que pudessem agilizar alguma etapa do processo.
Com a utilização das ferramentas do Khoros em conjunto a biblioteca de funções MMachLib, criou-se uma toolbox contendo um conjunto de operadores capazes de resolver o problema do cálculo de porosidade e saturação de fluidos em meios porosos a partir de dados tomográficos. Toolbox é o recurso criado pelo Khoros para agrupar operadores que possuem funcionalidades semelhantes. Por exemplo: os operadores add, subtraction, multiply, etc. fazem parte da Toolbox Data Manipuladora todos eles estão relacionados com operações aritméticas.
Nesta dissertação os programas foram executados em uma Sparc Station 20 da Sun, com o sistema operacional Solaris, juntamente com a versão 2.1 do pacote Khoros e o compilador gcc 2.7.2 da GNU.
Um conjunto de funções agregadas é denominado operador (Figura 4-1), no contexto do Khoros. Para cada operador desenvolvido existe um painel de controle associado, denominado pane (Figura 4-2), onde são encontradas as opções que determinam a forma do operador agir, isto é, trata-se da interface responsável por coletar os dados de entrada e especificar onde serão colocados os dados de saída. Workspace (Figura 4-3) é o recurso, em forma de grafo, adotado pelo Khoros para o encadeamento dos seus operadores, indicando a seqüência das operações para o cálculo dos resultados.
Figura 4-1 - Operador Multiplicação
Read tomographic images form Tape
!
i
Tomografa
Petrobras

	Nome do Drive	V	Aiev/rmt1.1
	Ler Remotamente		
	[ Maquina Remota		
	Deslocamento ao arquivo inicial : 0		
	Numero de arquivos a serem lidos :		
			
	Reholjinar		Nao
|~j| Arquivo
| ~| [ - Aupriwo ife En1 nd ia ■
I f
Arquive de Saida
■'""J /tmp/iol 05D.24
Figura 4-2 - Pane do Operador Tape-in
Figura 4-3 - Workspace do Cálculo da Porosidade
4.1	Leitura da Fita
O operador tape-in é o responsável pela manipulação e leitura da fita; e pelas conversões necessárias a manipulação dos dados pelos operadores do Khoros. A aquisição de dados, feita pelo operador tape-in, converte os dados vindos do tomo grafo para o formato KDF (Khoros Data Format). Atualmente o operador tape-in reconhece o formato do tomógrafo GE helicoidal. A Figura 4-4 apresenta o modelo esquemático de funcionamento do operador tape-in:
- Operador Tape-in —			&lt;- Imagem KDF—-&gt;				
	-	Deslocamento Inicial -	Número de Fatias -	Tipo de Tomógrafo -	Nome da Máquina (Leitura Remota) -	Drive do Tape -	Quando Rebobinar					1 - i 		—&gt;
&gt;				I	0	í -	
Cabeçalhos Agrupados
Reconstrução
3D (Voxel)
Figura 4-4 - Modelo Esquemático Tape-in
O conjunto de operações descritas na seção 3.1 é implementado no operador tape-in. Em seu pane (Figura 4-2) encontram-se implementadas cada uma
das opções descritas anteriormente para a manipulação da fita: a escolha entre a leitura local ou remota da fita, o deslocamento para o posicionamento da fita no primeiro arquivo do exame, o número de imagens a serem lidas pelo operador e o momento de rebobinar a fita.
Os pixels das imagens convertidas pelo operador tape-in são armazenados em formato short ( inteiro de 16 bits), que varia entre -32.768 a 32.767, que é o tipo de dados mais adequado para representar os valores CT de cada pixel. No problema abordado, os valores CT variaram aproximadamente de -1000 à 2500. Uma imagem típica de 40 fatias de dimensões 512x512, ocupa cerca de 20MB antes de sofrer qualquer processamento por outros operadores.
A seleção do tomógrafo usado na geração das imagens é feita pelo usuário dentre uma lista de tomó grafo s cadastrados. Sua identificação é a chave para a determinação do algoritmo correto de conversão dos arquivos contendo as fatias tomografadas.
O parâmetro de deslocamento para o posicionamento da fita na primeira fatia da amostra pode ser positivo ou negativo. Um valor positivo indica o avanço da fita, enquanto um valor negativo representa o retrocesso. A especificação deste parâmetro mostra-se necessária pelo fato da fita ser um dispositivo de acesso sequencial, onde o posicionamento de ve ser feito antes de qualquer operação de leitura.
Após especificação dos dados, o operador tape-in efetua a leitura fatia a fatia, convertendo e extraindo as informações pertinentes e as armazena em um único arquivo no formato KDF, contendo todas as fatias amostradas. A partir daqui, qualquer operador do pacote Khoros está apto a reconhecer e processar este arquivo, que compõe o volume de dados tomográficos, onde cada elemento deste é denominado voxel e endereçado pelas coordenadas: width, height e depth\ indicando respectivamente sua posição na largura, altura e profundidade dentro do volume.
Os comandos mt e dd, usados pelos sistemas operacionais Unix na manipulação de dispositivos de acesso seqüencial, são acessados através de chamadas system da linguagem C permitindo que o trabalho de posicionamento e leitura dos dados seja feito por estes comandos.
O arquivo KDF gerado possui em seu cabeçalho, informações sobre o tamanho da matriz tridimensional: {WIDTH, HEIGHT, DEPTH) largura, altura e profundidade. No cabeçalho são armazenadas informações que identificam cada fatia adquirida: número e identificação do exame, horário da aquisição, número da fatia no exame, etc. A conversão do arquivo para o formato KDF, o encadeamento das fatias e a extração de informações relativas a cada fatia da amostra são feitos através do
processamento dos arquivos temporários gerados a cada fatia recuperada através de chamadas do comando dd.
4.2	Pré-Processamento
Concluída a fase de leitura dos dados, a atenção passa a ser voltada a fase de pré-processamento que está condensada no operador Normalized Crop. Este operador implementa várias funções descritas na seção 3.2: redução do volume; o alinhamento das fatias; a normalização das dimensões dos volumes e a inserção da máscara.
Como os materiais usados nos experimentos: ar, óleo, solução salina de Kl e rocha, possuem CT médios bastante diferenciados (Tabela 2), com um simples limiar é possível selecionar o retângulo mínimo que conterá os pontos que estão dentro do intervalo de interesse. Regiões externas ao retângulo são eliminadas reduzindo o volume de dados armazenados e o tempo de processamento associado à imagem.
Substância	CT médio
Ar	-1000
Óleo	-200
Rocha	1200
Solução Salina de Kl	1300
Tabela 2 - Número de Hounsfíeld Médio para cada Material
Ao se calcular propriedades que envolvem a mesma amostra saturada com fluidos diferentes, cada varrida na amostra é feita em um instante diferente. A cada ensaio tomográfico a amostra é submetida a um processo de limpeza ou de troca de fluido, além disso, outras medidas tais como pressão, vazão, etc. são colhidas durante a seção tomográfica. A abertura e o fechamento de válvulas são atividades freqüentes, antes e após uma seção, fazendo com que a amostra esteja sujeita a pequenos deslocamento em relação a uma varrida anterior, fato que acaba provocando o desalinhamento das fatias (Figura 3-6).
O correto alinhamento se faz necessário para o processamento da amostra, pois este exige operações aritméticas envolvendo duas imagens em situações distintas (saturada com óleo e outra com ar, por exemplo). Se estas não estiverem alinhadas, todo processamento é comprometido pois não existirá uma correspondência espacial dos pixels (Figura 4-5).
Imagem 1
Imagens Iniciais
Imagem 2
Resultado
Esperado
Figura 4-5 - Ilustração do Problema da Manipulação de Imagens Não Alinhadas
Procurando explorar a geometria circular das fatias, conforme sugerido na seção 3.2.2, o operador Normalized Crop contorna a problemática relativa ao alinhamento, assumindo que o ângulo de inclinação formado pelo eixo da amostra e o eixo de deslocamento da mesa tomográfica é próximo a zero, podendo desta forma ser ignorado,
A normalização das dimensões das fatias é tratada segundo a seção 3.2.3. O operador normalized crop assume que as fatias originaram-se de uma amostra cilíndrica, onde os cortes produzidos formam uma seção. O processo utilizado para o redimensionamento das fatias na normalização foi a replicação de pixels oferecida pelo operador normalize da toolbox datamanip do Khoros. Algoritmos como o de interpolação linear, spline e outros poderiam ser utilizados no problema. A escolha do algoritmo de replicação deve-se ao fato já tê-lo implementado no software Khoros.
Dentro do Khoros, o recurso de mascarar uma imagem está disponível no segmento mask (seção 2.3.2.1.3). A obtenção da máscara (seção 3.2.4) é feita através da escolha de dois limiares, um inferior e outro superior, logo após, é criada uma imagem binária que armazena a máscara e esta é associada à imagem original. A cada ponto cuja intensidade pertence ao intervalo definido pelos limites inferior e superior, é associado o valor um na imagem máscara, e o valor zero para os pontos fora do intervalo especificado.
A Figura 4~6 mostra o modelo esquemático do funcionamento do operador normalized crop.
- Normalized Crop
-	Intervalo de
interesse
-	Colocar máscara?
(Sim/Não) *
-	Valor do pixel fora
do intervalo de interesse.
-	Dimensões da
imagem de saída
Novas
Dimensões
Máscara
Região de Interesse
Figura 4-6 - Modelo Esquemático Normalized Crop
Após o processamento do operador Normalize d Crop em uma imagem típica de 40 x512 x 512 x \6bits (20Mb) esta se reduz para uma imagem de 40x256x256 com aproximadamente 5Mb sem a máscara. Com a máscara, esta passa a ocupar cerca de 10MB.
4.3	Processamento
A etapa de processamento depende diretamente do tipo de problema a ser resolvido. Nesta dissertação, escolheu-se o cálculo de porosidade e saturação, propriedades tipicamente analisadas em amostras de rocha para analisar o comportamento dinâmico de fluidos em meios porosos, de modo a solucionar o problema proposto. Deve-se ressaltar que outras propriedades que possam ser definidas através dos operadores disponíveis no Khoros podem ser calculadas nesta etapa.
4.3.1	Cálculo da Porosidade e da Saturação
Reproduzindo as fórmulas apresentadas anteriormente na seção 2, construiu-se workspaces utilizando os operadores desenvolvidos e os padrões do ambiente Khoros, que possibilitaram calcular os resultados desejados. Alguns dos operadores usados para cálculo da porosidade (Figura 4-7), por exemplo, são os seguintes: subtract (subtração), divide (divisão), multiply (multiplicação) e outros que auxiliaram na conversão de tipos, visualização, etc.
É importante lembrar que o processamento destas propriedades normalmente requer um grande volume de dados, o que implica em uma grande demanda computacional. A título ilustrativo o cálculo da porosidade de uma amostra de 40 fatias, que ocupa 10 Mb, usando o workspace da Figura 4-7, exige a criação de arquivos temporários intermediários que totalizam aproximadamente 150 Mb. Em uma Sparc 20 da Sun, com 106 de memória com o sistema operacional Solaris, são necessários na média, cerca de 5 minutos para totalizar o cálculo da porosidade e 6 minutos para o cálculo da saturação. Em ambos os casos, não são considerados os tempos de leitura e de pré-processamento.
Figura 4-7 - Workspace do Cálculo da Porosidade
4.4	Visualização
Apesar do Khoros fornecer ferramentas para a visualização de dados volumétricos, como o operador animate, não era possível obter perspectivas convencionais de análise de uma amostra usadas por engenheiros de petróleo: projeção ortogonal, o mosaico das fatias, etc. Procurando aumentar o número de ferramentas de visualização oferecidas pelo Khoros, foram criados os operadores montage e orthogonal projection capazes de visualizar dados 3D.
4.4.1 Montage
Ao implementar as características descritas na seção 3.4.1, o operador montage é capaz de gerar a imagem mosaico. Além disso, ele também pode gerar um relatório colorido usufruindo dos recursos disponibilizados pelo método de geração de uma tabela de pseudo cores dinâmica (seção 3.4.3), proporcionando maior contraste dos pixels da amostra (Figura 4-8).
Por ser um operador genérico, funcionando com qualquer tipo de imagem no formato voxel, ele pode ser usado para visualizar uma animação e tornar possível a análise de todas as fatias em uma única imagem.
Imagem
3D
- Montage —.......
-	Fator de
redução
-	Os outros
parâmetros são opcionais
Relatório X I
Mosaico
	
	
v-9	u
*
Figura 4-8 - Modelo Esquemático do Operador Montage
O fator de escalonamento implementado neste operador permite a redução da imagem de saída por valores inteiros. O valor padrão 1, indica que as imagens são agrupadas sem sofrer um fator de escala, a menos que este parâmetro seja alterado pelo usuário.
A implementação da identificação das fatias é feita a partir da numeração sequencial a começar da primeira fatia, a qual é associado a identificação de fatia 0. Esta identificação é inserida imediatamente abaixo de cada fatia, fazendo com que as identificações passem a fazer parte da imagem gerada.
As legendas inseridas pelo operador inset, na imagem relatório são produzidas pelo operador mm_text, gerado especialmente para auxiliar no processo de converter uma string em uma imagem texto. Esta string é inserida na imagem em regiões previamente reservadas para a identificação de cada fatia.
Outra opção fornecida pelo operador montage é a que possibilita a escolha de um subconjunto do número total de fatias para ser apresentadas. A determinação deste subconjunto e feita através da determinação da primeira e do número de total de fatias a serem apresentadas. A omissão do primeiro parâmetro indica que a fatia número 0 será a primeira, e a omissão do segundo parâmetro indica que o número de fatias a ser apresentado é definido pela diferença entre a posição da última fatia da imagem 3D e a da primeira fatia a ser apresentada.
O operador montage, oferece a opção de geração de uma imagem contendo o mosaico das fatias com a intensidade dos pixels representando os valores CT, o que propicia a continuidade do processamento ainda em níveis de cinza; e oferece também a opção da criação de uma imagem relatório (Figura 4-9) contendo: o mosaico das fatias; uma tabela de pseudo cores evidenciando uma dada faixa de intervalo de interesse dos pixels, marcadores e legendas agregadas diretamente a imagem relatório de modo a facilitar as análises visuais das fatias. Na imagem relatório, apropriadas para impressão, deixa de existir a correspondência dos valores CT com as intensidades dos pixels. A imagem passa do modelo níveis de cinza para o RGB.
Figura 4-9 - Exemplo de Relatório Produzido pelo Montage
Através do operador supported formats o relatório pode ser exportado em um dos formatos suportados pelo Khoros, convertido para um outro formato, se necessário, através de um software alternativo, XV por exemplo, e então adicionado em qualquer documento através de um editor de texto, Word®, por exemplo.
4.4.2	Operador Orthogonal Projection
A abordagem adotada pelo operador orthogonal projection tem como objetivo, proporcionar a análise da amostra através de cortes perpendiculares, estrategicamente escolhidos pelo usuário (Figura 4-10), permitindo o acompanhamento longitudinal das propriedades estudadas.
Devido ao número de pontos do eixo Z ser proporcionalmente inferior aos eixos X e ¥ na maioria dos casos, para a obtenção de imagens mais “contínuas”, lança-se mão de interpolações para a geração das fatias intermediárias as reais. Para a geração dos valores intermediários das fatias reais foi utilizada interpolação linear.
A interpolação usada na geração dos dados entre as fatias reais, não é um processo de alto custo, pois ela não é feita para toda amostra, mas somente para a região pertencente ao plano de projeção selecionado.
Figura 4-10 - Modelo Esquemático Orthogonal Projection
O operador orthogonal projection pode gerar um relatório, contendo uma tabela de pseudo cores equivalente ao operador montage, onde todas as projeções são agrupadas em uma única imagem contendo uma legenda com informações das
posições de corte. Além da escala de cores definida pela identificação dos pontos inicial e final delimitadores do intervalo de interesse escolhido e da identificação de cada um dos cortes.
4.4.3	Tabela de Pseudo Cores Dinâmica
Nesta dissertação, a tabela de cores e anotações usadas nas imagens níveis de cinza é criada da seguinte forma. São usadas 256 cores no total para que o pixel armazenado seja do tipo unsigned byte. Das 256 cores, 7 são reservadas para anotações: valores de 249 à 255. As cores de 0 à 248 são usada para indicação dos valores dos pixels da imagem. Esta alocação é feita segundo as equações apresentadas na seção 3.4.3, com o intervalo [a,b] fixado em [o, 24S]. Aos identificadores são atribuídas cores diferenciadas das geradas na tabela de pseudo cores aplicada a imagem, evitando a confusão de cores e destacando as anotações.
A cada um dos operadores implementados com a opção de geração de relatório: montage e orthogonal projection, é oferecida a opção do usuário visualizar uma escala de cores representativa da distribuição das cores segundo o intervalo de interesse selecionado. Quando esta é apresentada juntamente com a imagem relatório, por convenção, encontra-se posicionada no canto superior direito como apresentado na Figura 4-11 pelo operador montage e na Figura 4-12 pelo operador orthogonal projection.
Figura 4-11 - Saturação de Óleo com Escala de Cores Gerada pelo Operador Montage
Houve uma dificuldade no uso do segmento map, pois o intervalo de dados CT normalmente continha valores negativos que não podem ser representados devido a representação através de vetores da linguagem C, onde os índices de cada posição serviam como indexadores. Como em C não existe um vetor com índices negativos, este problema teve que ser contornado. Esta dificuldade é superada através da normalização dos dados para o intervalo de 0 a 255. Esta solução tem a desvantagem de perder a correspondência da intensidades dos pixel com os valores CT dos dados quando a imagem relatório é mostrada.
4.4.4	Visualização 3D
Além destes operadores, desenvolveu-se workspaces (Figura 4-13) para a visualização 3D dos resultados através da visualização de uma iso-superfície do objeto em perspectiva.
Para a visualização 3D de um volume, deve-se previamente determinar qual a faixa de valores	a	ser	visualizada. Como por exemplo, os	pontos cujas
intensidades variam de 0	a 50.	A escolha deste intervalo serve como	limiar para a
binarização do volume, onde estar no intervalo significa que o ponto deve ser considerado pelo processo	de	visualização, enquanto que estar fora	do intervalo
especificado significa que	o	ponto deve ser descartado do processo de	visualização.
Desta forma, a escolha deste limiar é um fator decisivo no para o sucesso da imagem final apresentar as informações desejadas.
Figura 4-13 - Workspace da Visualização 3D
Gerou-se imagens renderizadas 3D (Figura 4-14), produzidas com a ajuda da toolbox V3Dtools, o qual permitiu a visualização tridimensional da amostra a partir do conjunto de fatias interpoladas do volume original.
A operação de geração das fatias intermediárias interpoladas é feita através da utilização do operador Interpólate, que através de interpolações lineares gera um novo conjunto de fatias. A geração destas fatias intermediárias (cerca de 10 fatias interpoladas a cada duas fatias reais adjacentes) faz com que haja uma passagem “suave” de uma fatia para a outra, fazendo com que a impressão de continuidade da amostra fique mais evidente.
Figura 4-14 - Modelo Esquemático Visualização 3D
4.4.5	Visualização Dinâmica dos Dados
Utilizando os recursos disponibilizados pelo operador anímate consegue-se visualizar o comportamento dinâmico da amostra. Várias situações podem ser analisadas em relação as animações geradas. A frente se propagando pela amostra vista através do encadeamento das projeções ortogonais, a frente das reconstruções 3D e das próprias fatias da amostra, em diferentes tempos. Na Figura 4-15, observa-se a sobreposição de três instantes de amostragem, proporcionando uma idéia do processo de animação. Este tipo de visualização permite o acompanhamento da frente de água se propagando pela amostra em diferentes instantes.
O operador anímate pertence ao conjunto de toolboxes padrões do Khoros e possui a função de apresentar um volume no formato voxel como um filme, onde as imagens formam a seqüência de movimento e durante a apresentação estas são comutadas de forma sequencial. Ou seja, a primeira fatia é apresentada e após um dado intervalo de tempo esta é substituída pela próxima, e assim continua o processo, até que a última fatia seja apresentada e o processo se reinicie.
Figura 4-15 - Animação Vista Através da Sobreposição de Imagens
4.5	Visualização Analítica
A grande potencialidade das ferramentas desenvolvidas está na flexibilidade na obtenção das imagens e das estatísticas dos resultados, permitindo ao técnico uma análise bastante detalhada do processo. Como ilustração é apresentado na Figura 4-16 os perfis médios de saturação de água em 8 tempos diferentes de uma amostra de rocha saturada com óleo submetida a um teste injeção de água. Nesta análise foi usado basicamente o operador Statistics, selecionado para calcular a saturação média em cada fatia. Os resultados obtidos podem ser visualizados através do operador Plot2D do Khoros ou exportado para o ambiente Microsoft Windows e visualizado pelo software Excel ®. A exportação dos resultados para o Microsoft Windows é feita em formato AS CU, pelo operador supported formats e importado pelo Excel ®. Desvio padrão, moda, máximo, mínimo, etc. são algumas das outras medidas oferecidas pelo operador Statistics.
90
Comprimento (cm)
Estado inicial
Corrida 2
Corrida 4
— Corrida 6
Corrida 1
Corrida 3
Corrida 5
Estado Finai
Figura 4-16 - Saturação Média de óleo em 8 Diferentes Instantes de Tempo
Ao aplicar uma operação estatística a uma imagem, evidencia-se a grande importância da máscara gerada pelo operador Normalized Crop. Com a máscara, pontos fora da região de interesse foram descartados e não influíram nos resultados estatísticos calculados. A ausência da máscara faria com que todos os pontos da imagem, inclusive os que não pertenciam a região de interesse, colaborassem com o resultado. A seguir apresentamos a mesma imagem (Figura 4-17) submetida ao cálculo da média estatística. A esquerda, encontra-se a imagem com máscara e na direita a imagem sem máscara.
Figura 4-17 - Média de uma Imagem Com Máscara (Esquerda) e Sem Máscara (Direita)
5.	Resultados
Concluída as fases de apresentação das metodologias, da definição e da implementação da solução, são apresentados alguns resultados obtidos com o auxílio destas ferramentas desenvolvidas.
Para melhor compreensão do leitor, parte-se da fase em que a imagem do exame está no formato KDF do Khoros, mas ainda não sofreu nenhum tipo de pré-processamento. Isto é, admite-se que o operador tape-in tenha sido aplicado as fatias gravadas em fita e que o volume tenha sido reconstruído e convertido para o formato KDF.
• Leitura da Fita
Os volumes possuem inicialmente as seguintes características:
Atributo	Valor
width	512 pixels
height	512 pixels
depth	14 fatias
tamanho	7MB
máscara	não
intensidade dos pixels	Valores CT 16 bits
Como ilustração, apresenta-se a Figura 5-1 que representa a primeira fatia de um volume de uma amostra saturada de óleo submetida a injeção de água, recuperada a partir de uma fita DAT de 4mm gerada pelo tomógrafo Helicoidal High Speed da GE. A Figura 5-2 apresenta o volume com o auxílio do operador montage escalonando as fatias para metade do seu tamanho real, ou seja, cada fatia é reduzida a dimensão de 128 x 128. Nesta imagem não foi associada nenhuma tabela de pseudo cores. Os outros volumes necessários nos cálculos das propriedade desejadas, sofrem o mesmo processo de aquisição
Figura 5-2 - Volume da Figura 5-1 Visualizado pelo Operador Montage sem Tabela de Pseudo Cores
• Pré-processamento
A cada um dos volumes envolvidos nos cálculos deve-se aplicar o operador Normalized Crop de modo a fazer o pré-processamento. A seguir a Figura 5-3 apresenta a primeira fatia do resultado da aplicação do operador Nonnalized Crop ao volume saturado de óleo submetido a injeção de óleo mostrado na Figura 5-1. A Figura 5-4, apresenta a mesma amostra visualizada pelo operador orthogonal projection com a tabela de cores definida para atuar no intervalo de min = 1600 à max = 2050 e como os cortes com X = 128, F= 128e Z = 4. Neste exemplo, usa-se como limiares para a determinação do retângulo de interesse os limiares mínimo igual a 300 e máximo igual a 3000, ou seja, a = 300 e b - 3000. As dimensões finais de cada fatia de saída são de 256x256, ou seja, M-N-256. E a imagem resultante contém uma máscara para os pontos com intensidades externas ao intervalo [a,h], preservando os pixels deste intervalo com seus valores em CT.
Figura 5-3 - Operador Normalized Crop Aplicado ao Volume Representado na Figura 5-1
2283
2050
1600
Figura 5-4 - Operador Orthogonal Projection Aplicado ao Volume Anterior, X-128. Y=128 e Z~4; min=1600 e max=20i
Na imagem relatório também pode ser observado os limites inferior e superior globais da imagem, apresentados nos dois extremos da escala de cores.
Após efetuada a operação normalized crop, os volumes passam a ter as seguintes características:
Atributo	Valor
width	256 pixels
height	256 pixels
depth	14 fatias
tamanho	3.5MB
máscara	sim
intensidade dos pixels	valores CT 16 bits
• Processamento
Através de workspaces gerados por uma combinação de operadores aritméticos do Khoros são aplicadas as fórmulas apresentadas na seção 2.1 aos volumes resultantes da operação Normalized Crop, obtendo-se as imagens representativas aos cálculos da porosidade (Figura 5-5) e da saturação de óleo (Figura 5-6) da amostra. Nestas imagens, as intensidades de pixel deixam de ser valores CT e
passam a representar a porcentagem de porosidade ou de saturação associada ao respectivo ponto.
Figura 5-5 - Porosidade Referente a Primeira Fatia da Amostra
Figura 5-6 - Saturação de Óleo Referente a Primeira Fatia da Amostra
Desta forma os volumes relativos a porosidade e a saturação possuem as seguintes características:
Atributo	Valor
width	256 pixels
height	256 pixels
depth	14 fatias
tamanho	3.5MB
máscara	sim
intensidade dos pixels	Valores em porcentagem 16 bits
• Visualização
Concluída a fase de processamento, inicia-se a fase de visualização e de análise dos resultados. Abordando a etapa de visualização, observa-se que os operadores de visualização montage e orthogonal projection apresentam de forma eficiente qualquer imagem no formato voxel independentemente da etapa do processo, como visto nas Figura 5-2 e Figura 5-4.
A seguir na Figura 5-7 são apresentados os perfis de porosidade da amostra, segundo o operador montage em sua configuração padrão e com um fator de redução de 50% do tamanho das fatias apresentadas. Na Figura 5-8 são apresentados os perfis de porosidade segundo o operador orthogonal projection com os cortes posicionados em: X=128, ¥=128 e Z=0. Ambos operadores ajustados para apresentação dos resultados segundo os valores gerados pela tabela de pseudo cores ajustada ao intervalo de intensidades onde min = 0 e max - 30.
Figura 5-7 - Porosidade Visualizada pelo Operador Montage com Redução de 50% das Dimensões de cada Fatia com
Tabela de Pseudo Cores Aplicada ao Intervalo [0,30]
Figura 5-8 - Projeção Ortogonal da Porosidade, com Cortes nos Planos X=128, ¥=128, Z=0 e Tabela de Pseudo Cores Aplicada ao Intervalo [0,30]
De modo análogo, na Figura 5-9 são apresentados os perfis de saturação da amostra, segundo o operador montage em sua configuração padrão, com um fator de redução para 1/3 do tamanho das fatias e com a apresentação configurada para 5 fatias por linha. Na Figura 5-10 são apresentados os perfis de saturação segundo o operador orthogonal projection com os cortes posicionados em: X=200, ¥=30 e Z=8. Ambos operadores ajustados para apresentação dos resultados segundo os valores gerados pela tabela de pseudo cores ajustada ao intervalo de intensidades de min = 0 a max~lQ0. Em complemento apresenta-se na Figura 5-11 o resultado obtido pelo workspace responsável pela visualização 3D onde pode ser observada a iso-superfície a qual a saturação de óleo é inferior a 50%, com 10 fatias interpoladas entre cada duas fatias reais.
Figura 5-9 - Saturação Visualizada pelo Operador Montage, com Redução de 33% das Dimensões de cada Fatia, com
Fatias por Linha da Imagem com Tabela de Pseudo Cores Aplicada ao Intervalo [0,100]
Figura 5-10 - Projeção Ortogonal da Saturação, com Cortes nos Planos X=200, Y=30, Z=8 e Tabela de Pseudo Cores Aplicada ao Intervalo [0,100]

Figura 5-11 - Visualização 3D da Saturação Evidenciando as Regiões Cuja Saturação é Interior a 50%
Comutando o conjunto temporalmente ordenado de visualizações 3D gerados para os diferentes instantes de aquisição, é possível gerar uma animação tornando possível o acompanhamento da frente no decorrer do tempo. Para a visualização desta animação nesta dissertação é utilizado na Figura 5-12 a técnica de sobreposição de imagens onde é visualizada a propagação da frente de água no decorrer do tempo. As corridas observadas são as de número 1, 2 e 3.
Figura 5-12 - Sobreposição de Três Diferentes Instantes Visualizados pela Técnica Visualização 3D com Saturação Inferior a 50%
• Visualização Analítica
A seguir, na Figura 5-13, é apresentado o gráfico representativo da porosidade média calculada para cada fatia da amostra, que possui 40cm. Como os cortes tomográficos são efetuados a cada centímetro, chega-se a um total de 40 valores médios para a porosidade.
Figura 5-13 - Porosidade Média da Amostra a Cada Fatia
A seguir, na Figura 5-14 é mostrado a saturação média de água em 6 diferentes instantes de tempo, além dos instantes inicia] e final. O instante tomado como exemplo para as imagens anteriores deste capítulo são referentes à corrida 2 do gráfico. As discrepâncias observadas ao final do gráfico, na última fatia, estão relacionadas aos efeitos produzidos pelo difusor incorporado a amostra para o melhor espalhamento dos fluidos pela amostra.
100
90 -
80 -
10 -
Comprimento (cm)

20 ””
Estado Iniciai
Corrida 2
Corrida 4
Corrida 6
Corrida 1
Corrida 3
Corrida 5
Estado Final
Figura 5-14 - Saturação Média de Óleo em 8 Diferentes Instantes de Tempo na Amostra Anterior
6.	Conclusões
Com a criação de uma nova toolbox, contendo novos operadores otimizados para a manipulação de imagens tomográfícas, resolveu-se o problema do cálculo e da visualização da porosidade e da saturação de meios porosos amostrados por tomografia, usando o ambiente Khoros. Além disso, tornou-se possível o estudo do comportamento estático (porosidade) e dinâmico (saturação) no interior das amostras, sem que estas fossem destruídas durante o processo.
Através das facilidades da plataforma de desenvolvimento do software Khoros e da biblioteca de funções MMachLib, foram desenvolvidas rotinas eficientes, que manipulam grandes amostras de dados 3D, expandindo o número de operadores para dados tridimensionais disponibilizados pelos dois softwares.
A leitura de fita em conjunto com a conversão automática de um arquivo vindo de um tomógrafo para o formato Khoros, facilita e agiliza as operações de recuperação das imagens em seu estado bruto, tornando-as disponíveis para o processamento. A reconstrução do volume permite que os dados sejam processados e visualizados volumétricamente, diminuindo o tempo de processamento e aumentando os recursos visuais do usuário, que pode analisar os dados como informações 3D (volumétricas) ou 2D (fatia a fatia).
Os recursos de pré-processamento, tais como a extração automática da região de interesse, que contém os pontos dentro de um intervalo específico de valores; o alinhamento das fatias e a normalização espacial do volume; se encontram disponíveis no operador normalized crop. Este é responsável por preparar a imagem “bruta” vinda do tomógrafo, de modo que ela possa ser operada conjuntamente a outras, sem que ocorram problemas como os de dimensionamento ou alinhamento incompatíveis. Além disso, geometrias irregulares (não retangulares) são tratadas com o recurso de máscara, de modo que pontos incluídos a imagem para que esta se transforme em uma imagem retangular, não participem das operações as quais ela for submetida.
Conclusões
Além disso, foram adicionadas duas novas formas de visualização de dados tridimensionais através dos operadores: montage que proporciona a visualização global de todas as fatias da amostra em uma única imagem e orthogonal projection que visualiza o volume através de cortes perpendiculares, possibilitando a visualização longitudinal de um dado plano de corte selecionado. A ambas funções de visualização, está agregado o recurso de geração de relatórios voltados a impressão, o qual apresentam de forma destacada as regiões selecionadas. Este destaque é conseguido através da associação de uma tabela de pseudo cores dinâmica que valoriza o intervalo de intensidade selecionado, aumentando o contraste dos pontos de interesse e “ocultando” os de não interesse.
Outras ferramentas implementadas foram usadas para gerar um relatório de análise diário para ser usado pelos geologistas. Isto requereu a capacidade de desenhar texto e linhas para serem usadas como anotações na imagem. Estas ferramentas adicionais também estão disponíveis aos usuários, podendo ser usadas em outros projetos. Além disso, a interpolação linear das fatias, efetuada pelo operador interpólate^ faz com que os cortes apresentados pelo operador orthogonal projection e a iso-superfície apresentada como resultado do workspace de visualização 3D, tenham uma aparência de continuidade.
Esta aplicação de calcular as propriedade porosidade e saturação, requereu o uso das várias facilidades oferecidas pelo modelo polimórfico do Khoros. O segmento valué usado para representar dados 4D (volume e tempo); o segmento mask foi usado para adequar o modelo retangular de representação das imagens, à amostra cujos cortes analisados foram circulares, evitando resultados errôneos quando efetuadas operações estatísticas. O segmento location foi usado para facilitar o entendimento do geologistas da real dimensão do dados sob análise, mapeando as coordenadas discretas da imagens com as coordenadas do mundo real. Finalmente, o segmento map foi amplamente usado para armazenar as informações referentes a tabelas de cores falsas, associadas aos relatórios produzidos pelos operadores montage e orthogonal projection.
Vários workspaces desenvolvidos dentro do ambiente de programação gráfica do cantata possibilitam a determinação das propriedades estáticas e dinâmicas relatadas nos estudos de dinâmica de fluidos em meios porosos. O cálculo e a visualização da dinâmica do comportamento da frente de água dentro da amostra de rocha foram intensivamente utilizados para o melhor entendimento do fenômeno de fluxo sob analise.
Entre as sugestões para continuidade deste projeto estão o reconhecimento de outros modelos de tomógrafo permitindo a leitura de imagens de outros modelos e marcas de tomógrafo; a inclusão da rotina de alinhamento das fatias da amostra de forma que por menor que seja o erro provocado pelo falta de alinhamento seja corrigido antes de qualquer processamento; o desenvolvimento de
Conclusões
novas técnicas de visualização 3D; a criação de novas tabelas de pseudo cores dinâmicas que proporcionem a visualização privilegiada de regiões de interesse; e a implementação de outros algoritmos de interpolação das fatias tais como os algoritmos de interpolação por splines.
7.	Referências Bibliográficas
[AmBa60]	AMYX, James W. - BASS Jr., Daniel M. - WHITING, Robert L. “Petroleum reservoir engineering - physical properties” Me Graw-Hill Book Company - 1960
[BBLH97]	BARRERA, Junior - BANON, Gerald J. F. - LOTUFO, Roberto A. ~ HIRATA, Roberto Jr. “MMach: A Mathematical Morphology Toolbox for the KHOROS System” -submitted, 1997
[DoLe91]	DOB IE, M.R. - LEWIS, P. H. “Data structures for image processing in C”, Pattern Recognition Letters 12 - pp.457-466- 1991
[Falc93]	FALCÃO, Alexandre Xavier - “Visualização de volume aplicada à área médica” Tese de Mestrado em Engenharia Elétrica; Faculdade de Engenharia Elétrica - DCA - Unicamp, 1993
[Gome97]	GOMES, José Adilson Tenório.: “Caracterização da permeabilidade relativa e geometria de fluxo em deslocamentos imiscíveis instáveis” - Tese de doutorado (em andamento) em Engenharia de Petróleo: Faculdade de Engenharia Mecânica - Cepetro - Unicamp, 1997
[Holl93]	HOLLEBEN, C.R.: “Determinação de porosidade e saturação de fluidos através da tomografia computadorizada de Raio-X” - Tese de mestrado em Engenharia de Petróleo; Faculdade de Engenharia Mecânica - Cepetro - Unicamp, 1993
[Khor91]	KHOROS GROUP, “Khoros Manual” - USA, Department of Electrical and Computer Engineering, University of New Mexico, 1991
[KLHL95]
[Lupp94]
[Shap79]
[Silv94]
[SLG97]
[V3DT93]
KOHL, Charles A. - LERNER, Richard A. - HOUGH, Alfred A. -LOUISELLE, Cynthia L. - DOLAN, John - FRIEDMAN, Michael B. - ROUBENTCHIK, Mark “A stellar application of the IUE: solar feature extraction” Amerinex Artificial Intelligence, Inc. - 409 Main Street -Amherst, MA 01002- 1995
Luppi, Renato M. S. ~ “Conjunto de operadores básicos para a visualização, manipulação e análise de dados 3D” - Tese de Mestrado em Engenharia Elétrica; Faculdade de Engenharia Elétrica - DCA - Unicamp, 1994
SHAPIRO, Linda G. “Data structures for picture processing: a survey” - Computer Graphics and Image Processing 11, pp. 162-184, 1979
SILVA, Arlindo da Costa e: “Análise de reprodutibilidade de digitações viscosas em meios porosos naturais consolidados” - Tese de mestrado em Engenharia de Petróleo; Faculdade de Engenharia Mecânica - Cepetro -Unicamp, 1994
SILVA, Wellington D. E; LOTUFO, Roberto A. &amp;amp; GOMES, José A. T. - “Analysis of oil-water flow in porous media from CT data” - Khoros Symposium ’97 Proceedings, Khoral Research, Inc. ~ pp. 26-40, 1997
V3DTOOLS TOOLBOX, “Help on Line”, Departamento de Engenharia. Computação e Automação Industrial, Universidade de Campinas, UNICAMP - 1993, Brasil</field>
	</doc>
</add>