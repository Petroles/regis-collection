<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.06769</field>
		<field name="filename">11345_348508.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">FEDERAL UNIVERSITY OF SANTA CATARINA GRADUATE PROGRAM IN SYSTEMS AND AUTOMATION ENGINEERING
Thiago Lima Silva
CONTRIBUTIONS TO MODELING AND OPTIMIZATION OF OIL PRODUCTION SYSTEMS
Thiago Lima Silva
CONTRIBUTIONS TO MODELING AND OPTIMIZATION OF OIL PRODUCTION SYSTEMS
Thesis presented to the Graduate Program in Systems and Automation Engineering in partial fulfillment of the requirements for the degree of Doctor in Systems and Automation Engineering.
Advisor: Prof. Eduardo Camponogara, Ph.D. Co-advisor: Prof. Bjarne Anton Foss, Dr.
Ficha de identificação da obra elaborada pelo autor, através do Programa de Geração Automática da Biblioteca Universitária da UFSC.
Silva, Thiago Lima
Contributions to Modeling and Optimization of Oil Production Systems / Thiago Lima Silva ; orientador, Eduardo Camponogara, coorientador, Bjarne Anton Foss, 2017.
157 p.
Tese (doutorado) - Universidade Federal de Santa Catarina, Centro Tecnológico, Programa de Pós Graduação em Engenharia de Automação e Sistemas, Florianópolis, 2017.
Inclui referências.
1. Engenharia de Automação e Sistemas. 2. Mixed Integer Programming. 3. Production Optimization. 4. Gas-Lift Systems. 5. Reservoir Management. I. Camponogara, Eduardo. II. Foss, Bjarne Anton. III. Universidade Federal de Santa Catarina. Programa de Pós-Graduação em Engenharia de Automação e Sistemas. IV. Título.
Thiago Lima Silva
CONTRIBUTIONS TO MODELING AND OPTIMIZATION OF OIL PRODUCTION SYSTEMS
This Thesis is recommended in partial fulfillment of the requirements for the degree of “Doctor in Systems and Automation Engineering”, which has been approved in its present form by the Graduate Program in Systems and Automation Engineering.
Florianópolis, April 19th 2017.
Prof. Daniel Coutinho, Dr. Graduate Program Coordinator Coordinator
Dissertation Committee:
Prof. Eduardo Camponogara, Ph.D.
Advisor
Prof. Bjarne Anton Foss, Dr. Co-advisor
Prof. Denis José Schiozer, Dr.
Prof. Regis Kruel Romeu, Dr.
Prof. Erlon Cristian Finardi, Dr.
Prof. Ubirajara Franco Moreno, Dr.
Prof. Juliano de Bem Francisco, Dr.
Prof. Fábio Luis Baldissera, Dr.
To my dear parents ...
To those who believed ...
ACKNOWLEDGEMENTS
I would like to thank the Federal University of Santa Catarina (UFSC) and the Norwegian University of Science and Technology (NTNU) for hosting me in a friendly and engaging environment through the course of theses years. I also thank Petrobras, Statoil, CNPq and Capes for the financial support which have allowed me to fulfill my dream of achieving a PhD degree.
Firstly and foremost, i would like to express my sincere gratitude to my supervisor and friend professor Eduardo Camponogara. Without his guidance, inspiration, and support, this dissertation would not have been possible. Thank you for believing in me and keeping me motivated at every obstacle and challenge that appeared in the way.
I would also like to thank my co-supervisor professor Bjarne Foss for the opportunity to pursue my doctoral internship at NTNU under his supervision. Bjarne gave me freedom to follow my own path, while contributing to improve the work quality in crucial moments. I will not forget the amazing experience of living in Trondheim and changes that came with it.
Someone who deserves a special acknowledgement is my friend Andrés Codas, who was a close collaborator and technical advisor during my internship at NTNU. Every time i was stuck, Andrés kept me motivated and challenged me to do my best. I also thank Milan Stanko and Mathias Bellout for their collaboration, discussions and motivation during the internship.
To my family Ruy, Lúcia, Paula, and Mácio for their support and unconditional love, which kept me motivated to reach the end. To ítala for her love, daily care, and partnership in every step of the PhD, including the move to Norway.
To my colleagues and fellows from the Group of Systems Optimization (GOS), specially Agustinho (in memoriam), Caio, Leonardo, Marco, Hulse, Lauvir, Ricardo, Benetti, Bryant, Jean, Igor and Amanda, i am very grateful for the collaboration, discussions and for making the working environment so enjoyable.
At last but not least, to my true friends, in particular Vanderlei, Shirlei, Rattus, Leo, Larissa, Mário, Sidnea, Vitória for their companionship in special moments of my life.
“Mathematics, rightly seen, possesses not only truth but supreme beauty“, Bertrand Russell.
RESUMO ESTENDIDO
A abordagem tradional para operar uma plataforma de petróleo consiste na tomada de decisão com base em análises de sensibilidade usando ferramentas de simulação e heurísticas. Entretanto, esta estratégia pode tem um custo computacional elevado em circunstâncias não usuais, além de não assegurarem um modo de operação ótimo para a plataforma. Ao invés disso, especialmente com alta variação dos preços do petróleo nos mercados internacionais, as indústrias petrolíferas estão investindo no desenvolvimento de estratégias ótimas com o intuito de melhorar as margens de ganho econômico. Uma alternativa que tem ganhado aceitação na indústria é a otimização baseada em modelo, a qual pode ser vista como a integração de modelos matemáticos e algoritmos para a obtenção de ferramentas efetivas de otimização. Esta tese propõe modelos e metodologias para a otimização da produção de campos de petróleo no curto- e longo-prazo.
No curto-prazo, as contribuições são um estudo compreensivo de modelos lineares por partes multidimensionais para otimização da produção diária e a modelagem da divisão de fluxos em redes de escoamento submarinas de sistemas de produção em alto-mar. A primeira consiste de um framework unificado de modelos de linearização por partes para a aproximação de funções não-lineares multidimensionais relacionadas a processos de produção petróleo. Com o uso destes modelos, o problema não-linear de otimização da produção se torna um problema de programação linear inteira-mista, para o qual algoritmos especializados e solvers comerciais conseguem obter soluções ótimas de forma eficiente. Foram realizadas análises computacional e de simulação para avaliar a eficiência e qualidade de aproximação dos modelos em um campo de petróleo sintético construído em um simulador de escoamento multifésico comercial.
A segunda contribuição consiste de um modelo para divisão de fluxos em redes de escoamento submarinas. Apesar de se tratar de uma prática recorrente em operações em alto-mar, onde os poços podem estar conectados às unidades de processamento por múltiplas rotas, modelos de otimização dispomveis na literatura assumem rotas únicas. Um modelo de roteamento automático que decide sobre rotas únicas ou múltiplas foi desenvolvido e validado contra o processo simulado. O modelo foi empregado na otimização de um campo de petróleo sintético, onde as estratégias ótimas com roteamento múltiplo induziram maior produção do que as estratégias com roteamento único.
No longo-prazo, a contribuição é uma metodologia que trata restrições referentes à rede de escoamento nos problemas de gerenci-
amento de reservatórios, particularmente em processos recuperação avançada por inundação de água. Restrições referentes à rede de escoamento e unidade de processamento são tipicamente limitadas ou desconsideradas nas políticas de gerenciamento de reservatórios. O presente trabalho propõe a otimização do problema integrado com uma formulação de múltiplos tiros, o qual é um método de controle adequado para problemas com múltiplas restrições em variáveis de saída de simulações. A metodologia foi empregada na otimização de um reservoir bifásico produzindo para uma rede de escoamento com restrições não-lineares referentes à operação de bombas submersíveis elétricas. A capacidade do método de lidar com as restrições de rede foi avaliada comparando-se os resultados obtidos com a abordagem que considera restrições de rede com os resultados das abordagens tradicionais, as quais negligenciam o sistema de escoamento em rede. As contribuições do trabalho, vistas sob a ótica de operações integradas, podem dar suporte a engenheiros de produção e reservatório em processos de tomada de decisão em campos de petróleo do mundo real.
Palavras-chave: Otimização da produção no curto-prazo e longo-prazo. Modelos Lineares por Partes Multidimensionais. Divisão de Fluxos em Redes de Escoamento. Restrições de Rede em Gerenciamento de Reservatórios.
ABSTRACT
The traditional approach for the operation of an oil platform has been to make decisions based on sensitivity analysis using simulation software and heuristics. However, this strategy can be rather timeconsuming and does not necessarily ensure an optimal production policy. Instead, oil companies are investing towards the development of optimal strategies in order to improve economic margins. An alternative that is gaining acceptance in the industry is model-based optimization, which may be seen as the integration of mathematical models with algorithms into effective optimization tools. This dissertation proposes models and optimization tools for production optimization of oil fields in the short-term and long-term horizons.
In the short-term, the contributions are a comprehensive study of multidimensional piecewise-linear models for daily production optimization and the modeling of flow splitting in subsea gathering networks. Because much of the literature was scattered, the first contribution consists of a common framework with the existing multidimensional piecewise-linear models for nonlinear function approximations appearing in oil production processes. Such models allow to transform the nonlinear production optimization problem into a mixed-integer linear program, for which off-the-shelf solvers can obtain optimal solutions. Computational and simulation analyses are performed to evaluate the efficiency and approximation quality of these models for a realistic oil field built in a commercial multiphase flow simulator. The second contribution consists of a model for flow splitting in subsea gathering networks. Despite being a common practice in offshore operations, where the wells can be connected to processing facilities by multiple routes, previous optimization models assumed single routes. An automatic routing model which decides upon single or multiple routing was developed and validated against simulation software. The model was further employed in the optimization of a synthetic oil field, where the optimal strategies with flow splitting yielded higher production rates than single-routed ones.
In the long-term, the contribution is a methodology to handle network output constraints in reservoir management problems, particularly in water-flooding processes. Since full-field implicit simulations are prohibitively costly, reservoir management policies are typically developed with standalone reservoir models, while the constraints regarding the network are limited or fully disregarded. We propose to optimize the integrated problem with a multiple shooting formulation, which is a control method suitable for problems with numerous output constraints.
The methodology is employed in the optimization of a two-phase blackoil reservoir producing to a gathering network with nonlinear constraints regarding the operation of electrical submersible pumps. The method’s capability to handle network constraints is assessed by constrasting its results against conventional approaches which neglected the gathering network system. These contributions, seen from the integrated operations perspective, may support production and reservoir engineers in decision making processes of real-world fields.
Keywords: Short- and Long-term Production Optimization. Multidimensional Piecewise-Linear Models. Flow Splitting in Gathering Networks. Network Constraints in Reservoir Management.
LIST OF FIGURES
1.1	The field life cycle and typical cumulative cash flow [1].	30
1.2	Multilevel control hierarchy. Adapted from [2]................ 32
2.1	Gas-lifted production system with multiple well-manifold
routes........................................................ 39
2.2	Structure of the production network........................... 42
2.3	Nonlinear functions involved in the oil production process. 44
2.4	One-dimensional PWL Function.................................. 46
2.5	Two-dimensional PWL function.................................. 47
2.6	J1 triangulation domain....................................... 47
2.7	Production system network with gas-lifted wells............... 59
3.1	Flow splitting illustration................................... 71
3.2	Gas-lifted well in pipesim.................................... 76
3.3	Illustrative Scenario Modeled with	Pipesim.................... 77
3.4	Splitting simulation analysis................................. 78
3.5	Illustrative offshore gas-lifted field........................ 80
3.6	Production system network with gas-lifted wells............... 89
3.7	Procedure to refine piecewise-linear functions................ 91
4.1	ESP-lifted well [3]...........................................106
4.2	ESP operating envelope........................................107
4.3	Illustrative gathering network................................109
4.4	Software Architecture ........................................120
4.5	Reservoir Model...............................................122
4.6	Production gathering network..................................123
4.7	Well control refinement.......................................127
4.8	Output of heuristic for p5....................................128
4.9	Optimal NPV values network unconstrained and constrained scenarios......................................130
4.10	ESP constraints of well p5...................................131
4.11	Optimal NPVs for the network unconstrained and constrained scenarios......................................132
4.12	ESP constraints of well p5...................................133
A.1	Network unconstrained: injection profile	of wells i1 and i2.141
A.2	Network	unconstrained:	production profile of well	p1.	.	.	142
A.3	Network	unconstrained:	production profile of well	p2.	.	.	142
A.4	Network	unconstrained:	production profile of well	p3.	.	.	143
A.5	Network	unconstrained:	production profile of well	p4.	.	.	143
A.6	Network	unconstrained:	production profile of well	p5.	.	.	144
A.7 Network constrained: injection profile of wells i1 and i2.	144
A.8 Network constrained: production profile of well p1. ... 144
A.9 Network constrained:	production	profile	of	well p2.	.	.	.	145
A.10 Network constrained:	production	profile	of	well p3.	.	.	.	145
A.11 Network constrained:	production	profile	of	well p4.	.	.	.	146
A.12 Network constrained:	production	profile	of	well p5.	.	.	.	146
A.13 Greedy strategy: injection profile of wells i1 and i2. . . . 146
A.14 Greedy strategy:	production	profile	of	well pl........147
A.15 Greedy strategy:	production	profile	of	well p2........147
A.16 Greedy strategy:	production	profile	of	well p3........148
A.17 Greedy strategy:	production	profile	of	well p4........148
A.18 Greedy strategy:	production	profile	of	well p5........149
LIST OF TABLES
2.1	Well parameters............................................ 60
2.2	Formulation Size........................................... 61
2.3	Hypercube Approximation: High Gas-Compression Capacity ............................................... 62
2.4	Hypercube Approximation: Medium Gas-Compression Capacity ............................................... 62
2.5	Hypercube Approximation: Low Gas-Compression Capacity ............................................... 63
2.6	Simplex Approximation: High Gas-Compression	Capacity	63
2.7	Simplex Approximation: Medium Gas-Compression Capacity ............................................... 64
2.8	Simplex Approximation: Low Gas-Compression	Capacity	64
2.9	Hypercube Approximation............................. 65
2.10	Simplex Approximation.............................. 66
2.11	Optimal solution per well with a fine simplex resolution	66
2.12	Optimal solution per well with a fine hypercube	resolution	67
3.1	Simulation Analysis of Splitting.................... 79
3.2	Sets of automatic routing MILP model................ 81
3.3	Parameters of automatic routing MILP model.......... 82
3.4	Variables of automatic routing MILP model........... 82
3.5	Functions of automatic routing MILP model........... 83
3.6	Well parameters for flow splitting analysis......... 89
3.7	Well-production approximations...................... 92
3.8	Jumper pressure drop approximations................. 92
3.9	Pressure drop approximations in the flowlines....... 92
3.10	Computational results.............................. 94
3.11	Optimal solution per well for the single and automatic
routing models with high gas-lift availability. ........... 94
3.12	Optimal flow distribution in the single and automatic
routing models with high gas-lift availability. ........... 95
4.1	Network Graph Sets.........................................108
4.2	Network simulation variables ..............................109
4.3	Oil Relative Permeabilities................................121
4.4	Reservoir parameters.......................................122
4.5	Pipeline features..........................................123
4.6	NPVs obtained with long-term and greedy strategies . . 132
AD Automatic Differentiation ..............................106
AMPL A Mathematical Programming Language................ 48,	81
BHP Bottom-Hole Pressure....................... 119, 120, 126
CC Convex Combination....................... 39, 49-52, 64, 79
CLRM Closed-Loop Reservoir Management...................... 86
DCC Disaggregated Convex Combination .	36, 37, 49-52, 64, 79
DLog Logarithmic Disaggregated Convex Combination . 37, 38, 49-52, 64
EOS Equation of State ..................................... 92
ESP Electrical Submersible Pump .... ix, 88, 93-95, 103-105, 108-114, 116-119, 121, 122, 124, 126
FD Finite Differences......................................106
FDP Field Development Plan................................. 19
FP Feasibility Pump........................................114
FPSO Floating Production	Storage and Offloading............ 68
GLR Gas-Liquid Ratio ....................... 59-61, 65, 76, 77
GOR Gas-Oil Ratio.......................................... 48
HIPPS High-Integrity Pressure Protection System ....	70, 74
ID Inner Diameter................................... 47,	48, 76
IMPES IMplicit Pressure-Explicit Saturation................ 91
Inc incremental........................... 43,	45, 49, 51, 52, 64
IO Integrated Operations................................... 17
Log Logarithmic Convex Combination . 40, 41, 49, 51, 52, 55, 64, 125
MC Multiple Choice.......................... 41, 42, 49-52, 64
MILP Mixed-Integerar Linear Programming xi, 25, 31, 33, 34, 36,
47-49, 55-58, 61, 62, 65, 69-73, 81, 83, 84, 125
MINLP Mixed-Integer Nonlinear Programming 26, 31, 33, 56, 125
MPWL Multidimensional Piecewise-Linear 25, 26, 56, 84, 123-126
MRST Matlab Reservoir Simulator Toolbox.................. 90,	91
MS Multiple Shooting.............. 87, 88, 100, 102, 122, 125, 126
NPV Net Presente Value . ix, xi, 85, 86, 100, 101, 113, 114, 118, 120, 122, 123
ODE Ordinary Differential Equation . . . 105, 106, 108, 122, 126
PI Productivity Index........................................ 65
PWL Piecewise-Linear ix, 33-36, 42, 49, 50, 53, 66, 70-72, 74, 75,
78, 79, 84
R Roughness....................................... 47, 48, 76
REMSO REduced Multiple Shooting Optimizer ....	108, 115
rSQP reduced Sequentially Quadratic Programming 102, 115, 121, 122, 126
SOS2 Special Ordered Sets of Type 2 33, 35, 40, 45, 46, 49-51, 55,
62, 63, 70, 71, 79, 81, 125
SQP Sequentially Quadratic Programming ................ 117,	126
SS Single Shooting.......................................86,	100
WCUT Water Cut................................ 48,	60, 65, 76, 77
CONTENTS
1	Introduction	29
1.1	Motivation......................................... 29
1.2	Research Objectives................................ 33
1.3	Outline of Contributions and Organization.......... 33
2	Piecewise-Linear Approximation for Short-Term Produc-
tion	Optimization	37
2.1	Introduction....................................... 37
2.2	Problem Context.................................... 38
2.3	Problem Formulation................................ 40
2.4	Literature Review.................................. 43
2.5	Piecewise-Linear Approximation..................... 45
2.5.1	Brief Introduction to Piecewise-Linear Models	46
2.5.2	Disaggregated Convex Combination Models	.	48
2.5.3	Multiple Choice Model..................... 53
2.5.4	Incremental Model ........................... 55
2.5.5	SOS2 Model................................ 57
2.6	Modeling and Analysis.............................. 59
2.6.1	Production System......................... 59
2.6.2	Computational Analysis ...................... 60
2.6.3	Simulation Analysis....................... 64
2.6.4	Discussion................................ 66
2.7	Summary and Synthesis of Contribution.............. 67
3	Modeling of Flow Splitting in Gathering Networks	69
3.1	Introduction....................................... 69
3.2	Flow Splitting Modeling and Validation ............ 70
3.2.1	Nonlinear Model........................... 71
3.2.2	Piecewise-Linear Approximation............ 73
3.2.3	Simulation-Based Validation............... 76
3.3	Application to Production Optimization............. 80
3.3.1	Mixed-Integer Linear Programming Model .	.	81
3.4	Model Synthesis and Computational Analysis ....	88
3.4.1	The Gas-Lifted Oil Production System ....	88
3.4.2	Model Synthesis.............................. 90
3.4.3	Computational Analysis ...................... 93
3.5	Summary and Synthesis of Contribution.............. 95
4	Network Constrained Reservoir Optimization	97
4.1	Introduction....................................... 97
4.2	Brief Literature Review............................100
4.3	Petroleum Production Process.......................100
4.3.1	Reservoir Model..............................101
4.3.2	Network Model................................103
4.4	Reservoir Control Optimization.....................112
4.4.1	Multiple Shooting Formulation................112
4.4.2	Network Constraints.........................114
4.4.3	Pressure Drop Sensitivities.................117
4.4.4	Adjoint Sensitivity Analysis................118
4.5	Numerical and Simulation Analysis..................120
4.5.1	Reservoir Description.......................121
4.5.2	Production Gathering Network ...............122
4.5.3	Optimization Problem Statement..............125
4.5.4	Heuristic for a Feasible Start..............126
4.5.5	Case Studies................................129
4.6	Concluding Remarks.................................133
4.7	Summary and Synthesis of Contribution..............134
5	Concluding Remarks	135
5.1	Summary of Contributions...........................136
5.2	Further Developments ..............................138
Appendix A - Detailed results of	Chapter 4	141
References	151
1	INTRODUCTION
1.1	MOTIVATION
Although technological advances have increased the diversity of energy resource alternatives, fossil energy remains a primal source of energy in the modern world. Over the past decades, petroleum companies have fostered advances on monitoring tools and data sensoring technology to provide means to calibrate process models and support engineers in decision making processes. However, with high oil prices, the margins were large and companies had limited incentives to invest towards the development of optimal strategies. The current decrease in oil prices should drive oil companies to apply advanced methods, in particular mathematical optimization, in order to improve long term and short term margins.
A host of innovations have been considered to improve operations and the ultimate recovery of oil fields including advanced simulation, downhole sensors, remote control devices, and real-time information systems which are collectively referred to as Smart Fields [4, 5]. These modern fields are being deployed with the aim to drive production and economic gains by effectively integrating subsea equipment with the technology available in the platforms in order to develop efficient plans and reduce operational costs. Because Smart Fields is an evolving technology, engineers still rely on sensitivity analysis using simulation software and heuristics to decide upon the operational plans and respond to unanticipated events, such as compressor failure and pipeline clogging. However, this strategy can be rather time-consuming and does not necessarily ensure a mode of operation that enhance oil production and therefore the value of assets.
An alternative that is gaining acceptance in the industry is model-based optimization, which may be seen as the integration of mathematical models with algorithms into effective optimization tools. These approaches can be effective provided that process models are routinely updated with field data to reflect the prevailing system conditions. Although recent technology has enabled frequent model updates, the practical use of model-based optimization demands integrated decisions for processes with different time-scales and complexities. For instance, while reservoir engineers make decisions using mathematical models governed by partial differential equations, which simulate the dynamics of fluids in porous media, production engineers typically adopt mixed-integer programming models to decide daily operational plans for the platform. Therefore, the challenge today is on the development of models and optimization tools for Integrated Operations (IO) that can conciliate different processes and technologies.
The impact of mathematical models and tools in IO decisions may be seen from the broader perspective of the field life cycle. The life cycle of a petroleum field can be divided in several multi
disciplinary activities carried out at the various stages of field development, as depicted in Figure 1.1. The figure depicts the typical
o
E «3
5
p
cn
cd
o
0)
Z5
E
Z5
o
500
400
300
200
100
0
-100
-200
-300
-400
-500
Time (years)
! 10 11 12 13 14 15 16 17 18 1920 21 2:
1 2 3 4 5
Figure 1.1: The field life cycle and typical cumulative cash flow [1].
cumulative cash flow in each phase of the field life cycle. Notice that initially the cash flow is negative, and only after the production phase starts it becomes positive. The field life cycle can be divided in the following phases:
1.	Gaining Access.
The first step taken by an oil company is the decision about what regions are worth for production and exploration of hydrocarbons. For this decision, an evaluation of technical, political, economic, and environmental aspects of the regions under consideration need to be performed to decide upon the acquisition of the rights for exploration of the reserves. Some important issues related to this decision are determining the potential size of hydrocarbons to found and produced in the region and technical challenges for exploration and production of hydrocarbons. If the risk analysis indicates that the region has a good potential to make profit for the company, the licensing contract is signed with the local government to explore the area for a certain amount of time and the fiscal regime are also defined in this phase.
2.	Exploration Appraisal.
The exploration phase is a high-risk activity that starts after licensing and gaining access of a region of interest. In this phase, geological and seismic surveys are developed and contrasted against the political and fiscal conditions of the country to determine the probability of success of exploration ventures. Once the presence of hydrocarbons has been confirmed by an
exploration well, an appraisal program is carried out with the drilling of further wells with the aim of a better description and accurate estimation of the resources in place. The appraisal continues until enough information and data is gathered to develop a feasibility study in order to determine if at least one development plan is profitable, or to conclude that the area is not economically viable.
3.	Development.
Based on the feasibility study, if the area is economically viable, a Field Development Plan (FDP) is put in practice. The main goal of this phase is to design the project specification for the subsurface and surface facilities, the operational plans, and a proposal for the required investments. Once the FDP is approved, a detailed design, fabrication, installation of the facilities follows, procurement of the materials of construction, even as the commissioning of all plant and necessary equipment.
4.	Production.
This phase starts when the first commercial quantity of hydrocarbons flows through the well-head. It marks a turning point in the cash flow since now some profit is made with oil selling on the market to pay back the prior investments. Based on all information gathered up to the first oil appears, development planning and production are developed based on the expected production profile of the field, which typically depends on the mechanism providing the driving force in the reservoir. The production profile is characterized by three phases:
•	Build-up period: as the facilities are progressively installed, recently drilled wells start to produce to the stream going to the platform.
•	Plateau period: when the installations are complete, a plateau production is reached and the field produce to its maximum capacity, ideally for as long as possible.
•	Decline period: as the field matures, field production starts to decline and the field remains active until the cash flow is not favorable anymore.
5.	Decommissioning.
The field is decommissioned when the net cash flow becomes permanently negative, i.e., the incomes are not sufficient to cover operating costs. In this phase, the facilities are disposed so that the environmental impact is minimized and unnecessary expenditures are avoided. In some cases, opportunities may be available to explore nearby reserves using the existing
infrastructure, but management the decommissioning costs is an issue that most companies will have to face at some point.
Although each stage may look independent, the decisions of each phase impact significantly in the next phases. The decisions of the development phase, for instance, may impact in the reservoir recovery strategy. These decisions are traditionally supported by numerical reservoirs simulators, which are used to forecast recovery processes of given production schemes and the impact of changes in well operating conditions. However, once the development phase is finished, the reservoir recovery optimization is limited by the facilities that are already installed in the field.
The decisions of the field life cycle can be conceptually divided in several layers depending on the time frame, as shown in Figure 1.2. The top layer concerns the asset management decisions which focus on reducing investments and minimizing risks of the field operation for the life cycle of the reservoir. Reservoir management decisions
Figure 1.2: Multilevel control hierarchy. Adapted from [2].
Data aquisition Control inputs system
seek to improve the recovery factor in the medium and long-term horizons, which extend from months to a couple of years. Such decisions involve drainage strategies, infrastructure development plans, well design and placement in the reservoir, production and injection target rates for the wells. Production optimization is the layer below which seeks for platform settings on daily or weekly operations that maximize the field performance while the operational constraints are satisfied. Shorter-term operational decisions regarding the control and automation of the platform aim to keep operations stable and mitigate disturbances. This requires feedback control of field pressures, flow rates and temperatures in a range from seconds to hours, being performed automatically without human intervention.
1.2	RESEARCH OBJECTIVES
The decisions regarding the operation of the wells are disputed since they are performed by both reservoir and production engineers, often with rather different operational strategies. On the one hand, reservoir engineers seek for optimized well controls that maximize the reservoir oil recovery for the long-term horizon, while production engineers typically have the goal to produce as much as possible in every depletion state of the reservoir. To this end, this dissertation focuses on the interface between reservoir management and production optimization layers, considering the impact that operational constraints, on the gathering network and surface facilities, will have on reservoir and daily production optimization. The main challenge lies on the integration of these two different layers given their different time scales and heterogeneous simulation tools.
The research objective of this dissertation is to develop optimization models and methodologies for short-term and long-term production optimization of oil fields. In the short-term, the dissertation presents a comprehensive study of multidimensional piecewise-linear models for daily production optimization and the modeling of flow splitting in production gathering networks of offshore systems. In the long-term, a methodology is proposed to consider network constraints in reservoir management problems, particularly in water-flooding processes. These results, seen from the standpoint of integrated operations, may be used to support production and reservoir engineers in decision making processes of real-world fields.
1.3	OUTLINE OF CONTRIBUTIONS AND ORGANIZATION
An outline and main contributions of this dissertation follows:
•	Chapter 2 contains a unified framework for piecewise-linear approximation of nonlinear functions with application to shortterm production optimization. This contribution was motivated by the need of standard representation of multidimensional piecewise-linear models, allowing their application and comparative analysis in short-term production optimization. Much of the literature was scattered and not presented under a common framework. The unified framework for piecewise-linear approximation considered all the existing multidimensional models.
•	Chapter 3 presents a nonlinear model of flow splitting in pipelines and suitable approximations for mathematical optimization. Splitting of flows have become common practice in the industry, particularly in offshore operations in which wells are connected to processing equipment by multiple routes. Despite
this common practice, the previous optimization models available in the literature assumed single routes. Piecewise-linear proxy models were proposed for modeling flow splitting and further validated against simulation models.
•	Chapter 4 proposes a methodology for network-constrained reservoir production optimization. To date, the existing methodologies for long-term reservoir production optimization rely on simple models to account for network constraints. The deployment of modern inflow control devices creates degrees of freedom in the production gathering network, enabling the use of methodologies that ensure reservoir control policies that feasible with respect to the network and processing facilities. A multiple-shooting strategy to optimize oil reservoirs was extended to simultaneously account for network constraints. Effectively, the reservoir equations, the network flow and pressure constraints, and the well-inflow models were explicitly represented in the multiple shooting formulation.
At the end, Chapter 5 presents a conclusion for this dissertation with a summary of achievements and perspectives for future research. Chapters 2, 3, and 4 are based on the following selected publications:
•	Silva, T. L.; Codas, A.; Camponogara, E. (2012): “A Computational Analysis of Convex Combination Models for Multidimensional Piecewise-Linear Approximation in Oil Production Optimization”. In: Proceedings of the IFAC Workshop on Automatic Control in Offshore Oil and Gas Production, Trondheim, Norway, 2012.
•	Silva, T. L.; Camponogara, E.; Teixeira, A. F.; Sunjerga, S. (2013): “A Mixed-Integer Linear Programming Model for Automatic Routing Decisions in Oil Production Optimization”. In: Proceedings of IEEE International Conference on Automation Science and Engineering (CASE), Madison, USA, 2013.
•	Silva, T. L.; Camponogara, E. (2014): “A Computational Analysis of Multidimensional Piecewise-Linear Models with Applications to Oil Production Optimization"". European Journal of Operational Research, v. 232 (3), pp. 630-642.
•	Silva, T. L.; Camponogara, E.; Teixeira, A. F.; Sunjerga, S. (2015): “Modeling of Flow Splitting for Production Optimization in Offshore Gas-Lifted Oil Fields: Simulation Validation and Applications”. Journal of Petroleum Science and Engineering, v. 128, pp. 630--642.
•	Silva, T. L.; Codas, A.; Stanko, M.; Camponogara, E.; Foss, B. A. (2016): “Network Constrained Reservoir Optimization"".
1.3.	Outline of Contributions and Organization
35
Submitted to SPE Reservoir Evaluation Engineering Journal on June 2017.
In addition to the publications that form the basis of this dissertation, the author has contributed in other publications during the PhD studies:
•	Aguiar, M. A. S. ; Camponogara, E. ; Silva, T. L. “A Mixed-Integer convex formulation for production optimization of gas-lifted oil fields with routing and pressure constraints. In: Brazilian Journal of Chemical Engineering (print version), v. 31, p. 439-455, 2014.
•	Neto, L. R.; Camponogara, E.; Hardt, R. ; Silva, T. L. ""A piecewise linear-quadratic approximation for production optimization of gas-lifted oil fields. In: IEEE International Conference on Automation Science and Engineering (CASE), Gothenburg, p. 793-798, 2015.
•	Camponogara, E. ; Teixeira, A. F.; Hulse, E. O.; Silva, T. L.; Sunjerga, S.; Miyatake, L. K. “An integrated methodology for production optimization from multiple offshore reservoirs in the Santos Basin"". In: IEEE Transactions on Automation Science and Engineering, v, 14 (2), p. 669-680, 2017.
2	PIECEWISE-LINEAR APPROXIMATION FOR SHORT-TERM PRODUCTION OPTIMIZATION
Production optimization of gas-lifted oil wells under facility, routing and pressure constraints is a challenging problem, which has attracted the interest of operations engineers aiming to drive economic gains and scientists for its inherent complexity. The hardness of this problem rests on the non-linear characteristics of the multidimensional well production and pressure drop functions, as well as the discrete routing decisions. To this end, this Chapter develops several Mixed-Integerar Linear Programming (MILP) formulations using Multidimensional Piecewise-Linear (MPWL) models to approximate the non-linear functions. Computational and simulation analyses are performed considering a synthetic but realistic oil field modeled with a multiphase-flow simulator. The purpose of the analyses is to assess the relative performance of the MILP formulations and their impact on the simulated oil production. Most MPWL approximations and the computational analyses which are discussed in this Chapter were developed in the master’s dissertation of Silva[6]. During the Ph.D. studies, the main contribution was the multidimensional approximation based on the Incremental model and a simulation analysis of all MPWL approximations against a commercial multiphase flow simulator. Further, a journal paper compiling all results was written during the first year of the doctoral studies. This Chapter is based on the following papers:
•	Silva, T. L.; Codas, A.; Camponogara, E. (2012): “A Computational Analysis of Convex Combination Models for Multidimensional Piecewise-Linear Approximation in Oil Production Optimization’’. In: Proceedings of the IFAC Workshop on Automatic Control in Offshore Oil and Gas Production, Trondheim, Norway, 2012.
•	Silva, T. L.; Camponogara, E. (2014): “A Computational Analysis of Multidimensional Piecewise-Linear Models with Applications to Oil Production Optimization’’. European Journal of Operational Research, v. 232 (3), pp. 630-642, 2014.
2.1	INTRODUCTION
In response to the increasing demand for petroleum and highly competitive markets, oil companies have been investing in innovative technologies to increase production and cut operational costs. Today, offshore platforms are being equipped with remote measuring sensors and real-time control, optimization and information systems. The oilfields that employ these technologies are often referred to as Smart Fields [7]. Smart Fields technologies provide field data that are valuable for tunning simulation models to reproduce the
observed behavior. With reliable simulation models, production engineers can develop daily operational plans and respond effectively to unanticipated contingencies. However, significant challenges in science and technology should be overcome before Smart Fields becomes a widely applied technology.
In existing oil fields, operational plans are reached promptly often based on a sensitivity analysis that uses simulation tools and heuristics. Even though these methods can obtain good operational plans, they do not necessarily ensure a mode of operation that maximizes the daily production, which may incur losses to the company. On the other hand, mathematical programming methods can be used to help production engineers to reach optimal daily operational plans.
The optimization of offshore production units entails modeling and solving MINLPs that represent the underlying complex phenomena involved in oil production, flow and processing. Owing to the complex nonlinear functions and discrete variables, the direct solution of MINLPs that arise in oil production optimization is not effective, giving rise to the need of computationally tractable approximations. This dissertation investigates at great length the approximation of such nonlinear functions with multidimensional piecewise-linear models. In order to assess the implications and performance of the multidimensional models, a representative simulation scenario is considered for the computational and approximation analysis.
This Chapter begins by stating the MINLP that consists in defining the lift-gas injection rates of the wells and the routing of wells to manifolds, while meeting physical and technological constraints. In the sequence, a brief literature review of mathematical programming methods for short-term production is presented. Then, a review of existing MPWL models is developed for general functions, in particular, for two-dimensional well production curves. The results of computational and simulation analyses are then reported. Finally, it is presented a synthesis of the contribution of this Chapter to the modeling and optimization of production units of oil fields.
2.2	PROBLEM CONTEXT
A typical offshore gas-lifted production system consists of: (i) a reservoir which is the porous media containing the hydrocarbons to be produced; (ii) production wells which transfer the fluids from the reservoir to gathering network; (iii) a subsea manifold which is responsible for gathering and transferring the well flows to the surface facilities; (iv) the flowlines and pipelines; (v) processing facilities which separate the multiphase flow in oil, gas and water; and (vi) compressors which pressurize the gas to be used as an artificial
lift method. Figure 2.1 depicts a production system with a reservoir, five production wells, manifolds, and the processing facilities. The
Processing system
Compressor	f
Separated gas
Manifolds
)il-Watejr
Routing valves
—eSh—
—
—e5&lt;k---bb+i
Oil + Water + Gas

Gfs-lift
Water treatment unit	O
—-cSb
—
---c3=b
—&gt;b}
Injection chokes
o o o o o
Reservoir
Figure 2.1: Gas-lifted production system with multiple wellmanifold routes.
routing valves in between the wells and the manifolds are on-off control valves which are used to select fluid routes. The production entering the separator is processed and the outlet gas is pressurized by the compression unit before gas-lift injection. The gas-lift rates are controlled through valves, namely the injection chokes. The oil is stocked in tanks before exportation and the water is sent to a treatment unit for disposal.
The production is limited by the pressure in the reservoir, the productivity of the wells and by the capacities in the processing facilities such as compression limits, water treatment capacity, and liquid handling capacity. Along the daily operation, a set of decisions should be taken by the operators while honoring such limitations in order to maximize the oil production. Among such decisions are the choke openings, the well-manifold routings and the gas-lift rate delivered to each well. Although sensitivity analyses may help engineers in the decision making, mathematical programming tools are suitable to optimize the production system even under unusual operating conditions.
2.3	PROBLEM FORMULATION
The problem of optimizing the daily production of a gas-lifted oil field taking into account constraints on lift-gas availability, separation capacity, well-manifold routing, and pressure constraints can
formulated as a mixed-integer non-linear program:	
POP : max f =	g(qm) -	c(q¡n)	(2.1a)
	
S.t. :	qn	q	'	(2.1b)
n\in\scrN	
For all n \scrN :	
n.min	n	n.max q ,	yn	q\mathrm{i}	yn	(2.1c)
zn,m	yn	(2.1d)
	
\bfqn,m = qn&gt;m(pm,qn)zn,m, \forallm	\scrMn	(2.1e)
Zn,mqn,L	\bfqn,m	Zn,mqn’U, \forallm	\scrMn	(2.1f)
\bfqm =	\bfqn’m	\scrM	(2.1g)
	
pm = pm’s + Apm(qm), \forallm \in\scrM	(2.1h)
pm,min	pm	pm,max	(2.1i)
yn	{0,1}, \foralln \in\scrN	(2.1j)
Zn,m	\{0, 1}, \foralln	\scrN, \forallm \scrMn	(2.1k)
with decision variables for optimization being:
•	q™ is the lift-gas rate injected into well n;
•	yn takes on value 1 when well n is producing and 0 otherwise.
•	zn,m assumes value 1 if the production of well n is directed to manifold m, and 0 otherwise;
•	qh’m is the flow of phase h \in\scrH directed from well n to manifold m, and qn,m = (qh'm : h \scrH) is the vector of all phase flows;
•	=	£ qn’m is the total flow received by manifold m;
•	pm is the pressure of manifold m;
with parameters:
•	N is the number of oil wells, \scrN = {1,..., N}, and \scrNm \subseteq \scrN is the subset of wells whose production can be directed to manifold m;
•	M is the number of manifolds, \scrM = \{1,..., M} and \scrMn \subseteq \scrM is the subset of manifolds that can receive production from well n. The production of each manifold is processed by a dedicated separator;
•	\scrH = {o, g, w} has the phase flows, namely oil (o), gas (g), and water (w);
•	q;max models the lift-gas that can be delivered by the compression station;
•	q”’mm and q”,max are bounds on the lift-gas injection for well n typically used to ensure production stability, avoid slugging, and follow a recovery policy for the reservoir;
•	pm,s is the operational pressure of the separator connected to manifold m;
•	q”,L and qn,u are vectors with lower and upper bounds on the production of well n;
•	qm,s is the processing capacity of the separator of manifold m;
•	pm,mm (pm,max)	m\mathrm{i}n\mathrm{i}mum (maximum) operational pres-
sure for manifold m;
and with functions:
•	f is a function composed by a function g that represents the economic benefit from oil production and a function c which represents the lift-gas injection cost, however any other continuous function can be considered such as the total oil production;
•	qh’m(pm, q?)	fl°w °f phase h sent by well n to manifold
m given as a function of the manifold pressure and lift-gas injection, and \bfqn,m(pm,q?) = (q?,m(pm,q?) : h \scrH) is the vector of all phase flows;
•	Apm(qm) represents the pressure drop in the pipeline connecting manifold m to its adjoint separator.
Among the decision variables for optimization, the ones that are actually controlled in the oil field are the well activation decisions yn, the routing decisions zn,m, and the lift-gas rates qf.
The nonlinearity in the production optimization problem arises from the nonlinear nature of the well production function qf,m and the pressure drop \Deltapm in pipelines, which later will be approximated with piecewise-linear models. This problem extends the work of [8] by explicitly modeling pressure drops and considering pressure constraints.
The gas compressing capacity and the bound on lift-gas injection for the wells are defined by constraints (2.1b) and (2.1c) respectively.
The well-manifold routing constraints (2.1d)-(2.1e) ensure that the production of each well will be sent to precisely one manifold when the well is producing, i.e. yn = 1. The production of well n sent to manifold m is zero if not routed to this manifold, i.e. zn,m = 0, however the production becomes bounded by q”,L and qn,u if well n is routed to manifold m.
The operational limits for well production, the mass balance equations, and separation capacity are established by constraints (2.1f) and (2.1g), while the pressure balance between manifolds and separators are given by constraints (2.1h) and (2.1i).
Figure 2.2: Structure of the production network.
Figure 2.2 illustrates the structure of the oil production system and the semantics of the decision variables. The available liftgas rate (q\mathrm{m}ax) is distributed to the active wells (qf : n \scrN)
which in turn yield multiphase flows that are directed to manifolds (qn,m : n , m \scrMn) and then to the separators (qm). These flows induce pressure drops in the pipelines (Apm(qm)) which are limited by the separator’s capacity (qm,s).
The Mixed-Integer Nonlinear Programming (MINLP) problem given above is a conceptual formulation because the well production and pressure drop relations are not known explicitly. An MINLP approximation may be obtained by fitting nonlinear models to sample data provided by a simulator or real measurements from the oil field. However, the synthesis and validation of such models are themselves a challenge, motivating the development of piecewise-linear models directly from the sample data to yield an MILP approximation. Since the true MINLP is not known, this dissertation will compare the predictions induced by the piecewise-linear schemes against to the corresponding values provided by a simulator. This means that a solution close to the global optimum may be reached by solving the MILP formulation considering a sufficiently high number of sample points.
The inherent nonlinearity of the well production curve and the pressure drop function combined with the presence of discrete variables complicates significantly the optimization of daily production problems in oil platforms. From sampled data collected in a commercial multiphase flow simulator, such functions are depicted in Figures 2.3(a) and 2.3(b) respectively. The well production curve represents the liquid flow rate produced by the well as a function of the well-head pressure and the gas-lift rate injected at the bottom of the well. The pressure drop is a function of the phase flows in the pipeline. Both functions are nonconvex and smooth, but might change with different fluid properties and features of well tubings and flowlines of the gathering system.
2.4	LITERATURE REVIEW
Although several works have applied mathematical programming methods to obtain optimal production plans [9, 10, 11, 12, 8], only a limited number of works considered pressure drop in pipelines which cannot be neglected when the operating conditions vary due to routing operations and equipment failure, for instance.
Beggs and Brill [13] were among the first to study the representation of pressure in oil production systems, who proposed correlations between the pressure drop and flow in pipelines. Litvak and Darlow [14] developed analytic and piecewise-linear models for representing pressure equations. The first represents more precisely the physical phenomenon and is routinely used in software for simulating flows in oil production systems. The second technique approximates pressure drops as a function of the outlet pressure and the oil, gas, and water flows.
5
WCUT = 10%
(b) Pressure Drop Function
Figure 2.3: Nonlinear functions involved in the oil production process.
More recent works in oil production optimization considering complex operations, such as routing and pressure drop, can be roughly divided in MINLP and MILP methods. Kosmidis et al. [15] and Kosmidis et al. [16] presented an MINLP optimization formulation of a production network with naturally producing and gas-lifted wells. The MINLP problem is solved by a sequence of MILP problems following a sequential linear programming strategy. On the other hand, Gunnerud and Foss [17] presented an MILP formulation for oil fields structured in clusters of independent wells, manifolds, and pipelines while the separation facilities are centralized in a platform. Piecewise linearization techniques based on Special Ordered Sets of Type 2 (SOS2) constraints are used to approximate nonlinear functions.
Because the complex behavior of well production and pipeline pressure drop are not explicitly known, the synthesis of an MINLP problem will entail fitting sample data from a simulator to nonlinear models, a task that itself is challenging and dependent on the space of models considered. On the other hand, piecewise-linear models have the advantage of not needing the synthesis of such relationships, being defined directly from the sample points, a property that motivates the dissertation herein.
Although some works have represented pressure drops with piecewise-linear models, a comprehensive analysis of the existing models for piecewise linearization in oil production optimization is lacking. To this end, this dissertation presents a computational and simulation analysis of piecewise-linear models for hypercube- and simplex-based approximations of the function domains, considering an oil field modeled with a standard multiphase-flow simulator.
2.5	PIECEWISE-LINEAR APPROXIMATION
The formulation of the gas-lift optimization problem presented in the previous section is non-convex due to the non-linear nature of the well production curves and the flow-line pressure drops. The feasible space for well production can be non-convex regardless of the well production function being concave. Further, the flow-line pressure-drop functions are multidimensional relationships available in phenomenological simulators, making it a challenge to be modeled and used in optimization software even when the relationships are univariate.
However, non-convex piecewise-linear models can be used to approximate such complex non-linear functions, allowing the resulting MILP formulations to be solved by specialized algorithms and off-the-shelf solvers. Usually, the latter approach takes advantage on the first since it benefits from the state-of-the-art technology implemented in the solvers [18]. In this dissertation, we approximate the non-linear functions with Piecewise-Linear (PWL) models and
solve the gas-lift distribution problem with an MILP solver.
This section starts with a brief introduction to the existing MILP models for multidimensional piecewise-linear approximation and then presents the corresponding MILP approximation formulations of problem P.
2.5.1	Brief Introduction to Piecewise-Linear Models
The definition of piecewise-linear function is borrowed from [18] who review existing MILP models for piecewise linearization. According to Vielma et al. [18], a continuous function f : T&gt; —&gt; R with compact domain T&gt; C Rd is piecewise-linear if, and only if, there exists a family of polytopes P, such that UpepP = P, {mp}pep C Rd, and {cp}pep, where:
/(x) = m'pX + cp, Vx G P, P G P	(2.2)
Let V(P) be the set of vertices of polytope P and V(P) = Upep V(P) be the set of all vertices.
Figures 2.4 and 2.5 show one-dimensional and two-dimensional illustrative PWL functions respectively. The domain of the first one is D = [0,4], which is represented by a family of polytopes P = {P!,P2,P3,P4}, where Px = [0,1], P2 = [1,2], P3 = [2,3], and P4 = [3,4], and V(Px) = \{0,1}, V(P2) = \{1,2}, V(P3) = \{2,3},
Figure 2.5: Two-dimensional PWL function.
2
1	\ Ps Pi \	P12 / /P13	\ P21 -?20	^28 /	P29	
0	P3 / J/ Ps	\P14 P11V	Pio/ P22	\p30 -T27 \	
-1		■Uo/h / "15	^\P23 -Pl 8		
-2	Pl / / Ps	\-P16 P9 \	Pit/ /P24	^\P32 P25\	
	-2	-1	0	1	2
Figure 2.6: J1 triangulation domain.
and V(P4) = {3,4}, with the graph points \scrG = {(x, f (x)) : x \scrD} being \{(0,8), (1,28), (2,14), (3,25), (4,21)}.
The two-dimensional PWL function approximates the non-convex function f (x, y) = e-y + e-x — x2 + xy — 2y depicted in Figures 2.5 and 2.6. Its domain \scrD = [—2, 2]2 is partitioned in a set of polytopes \scrP = \{P1,P2, . ..,P|\scrP|} which can be hypercubes or simplexes. According to [19], the J1 (Union Jack) triangulation yields a subdivision of the domain space which is compatible with all PWL models, except the SOS2 model. Figure 2.6 shows the J1 triangulation for the two-dimensional PWL function depicted in Figure 2.5.
The MILP models available to approximate multidimensional functions can represent the PWL functions of many different ways: convex combination of the vertices of one single polytope, set of hyperplane equations and linear inequalities, and incrementally from a set of ordered polytopes (simplexes) and vertices.
2.5.2	Disaggregated Convex Combination Models
These formulations split the domain of the function in a set of polytopes P \scrP. Each polytope P has a set of vertices V(P), and for each vertex v V(P) of this polytope, there is an associated continuous variable \lambdaP\bfv. The representation of a graph point of the function is described as the convex combination of the vertices of each polytope.
Disaggregated Convex Combination
The Disaggregated Convex Combination (DCC) model does not require any special property for its polytopes. This model was studied by [20], [21], [22], and [23]. The MILP reformulation of the production function \bfqn,m(pm, q") using the DCC model is given by following set of equations:
For all n \scrN :
q = o"	(2.3“)
m\in\scrMn P\inPn-m (q\mathrm{i},p\mathrm{r}) \inV(P)
pm	Pp\mathrm{r},	\in\scrM"	(2.3b)
p\in\scrPn,m (q\mathrm{i},p\mathrm{r})\inV(P)
Pm E E	PP\mathrm{r} + pm’maX(1 - Zn,m),
P\in\scrPn,m (q\mathrm{i},p\mathrm{r})EV(P)	(2.3c)
\forallm \scrMn
A"i’Z’P \bfqn,m(qpp\mathrm{r}) =	' ,
p\inpn.m (qi,p\mathrm{r})\inv(P)	(2.3d)
\forallm \scrMn
zn,m\bfqn,L	\bfqn’\mathrm{U}zn,m, \forallm Mn	(2.3e)
\lambdapm;P	0, \forallm Mn, P	(qi,pr) V(P)	(2.3f)
= ynpm,	\in\scrMn,P \scrPn,m	(2.3g)
(qi,pr)ev (P)
y",m = zn,m, \forallm Mn	(2.3h)
P r- pn,m
ypm e {0,1}, \forallm eMn,P e \scrPn’m
(2.3i)
having the following extra parameters:
•	\scrKn,m and \scrRn,m are the sets of breakpoints for the lift-gas rate injected in well n and pressure of manifold m;
•	\scrPn,m is the set of polytopes in the production function domain for well n when its production is directed to manifold m, and the set of vertices \scrV(\scrPn,m) := \scrKn,m \scrRn,m is defined by the Cartesian product of set of breakpoints for the lift-gas rate and manifold pressure;
and extra variables:
•	\scrMs	weighting variable of a breakpoint pair in \scrKn,m
\scrRn,m \forallhat belongs to a polytope P \scrPn,m. When manifold m receives the production of well n, zn,m takes on value 1 and the respective convex combination becomes active;
•	ypm is \bullet binary variable associated to each polytope P \scrPn,m which assumes value 1 when the convex combination is limited to polytope P. According to constraint (2.3g), only the vertices of P can be part of the convex combination that defines the lift-gas injection qf into well n and the manifold pressure pm;
\bullet \scrKn,m \scrMs	piecewise-linear approximation of \scrKn,m.
In the same way, the pressure drop functions Ap(qm) are piecewise linearized with each model. For simplicity, we show only the reformulation for the well production curves. Then, the objective function given in Equation (2.1a) is recast as a piecewise-linear form:
max f=	g(\scrKm) - ^2 c(q")
(2.4)
Logarithmic Disaggregated Convex Combination
The Logarithmic Disaggregated Convex Combination (DLog) model aims to reduce the binary variables and extra constraints of the DCC model. In this formulation, each polytope P \scrP is represented with a binary vector y \{0,1} \lceillog2 \scrP\rceil using an injective function B : \scrP \rightarrow \{0,1} \lceillog2 \scrP\rceil. Some binary variables are required to enforce	(P) Xp,v to be one when y = B(P). Let B(P) be
the value in position l of the binary code associated to polytope P.	(B,l) is the set of polytopes whose binary codes have value
j G {0,1} in position l, and L(\scrP) is the set of indexes for the entries of a binary code B(P):
(B, l) := {P G \scrP : B(P) = j}, j G {0,1}
L(\scrP) := {v.^	. i\scrPi\rceil}.
Based on the works of [24, 25, 26], the well performance curve qn,m is then approximated with a piecewise-linear function using the DLog model as follows:
For all n G :
\lambdaPPtp * = «"
minscrMn p(qi,pI)in_V(p)
\lambdan-m:ppmathrm{r}	pm, \forallm e
(qi,pr)eV (p )
E	\lambdan^m,ppmathrm{r} + pm,maX(1 - Zn,m) &gt; pm,
(q\mathrm{i},p\mathrm{r})inV (p )
E
p pn,m
E
p pn,m
(2.5a)
(2.5b)
(2.5c)
\forallm G \mathrm{r}n
E
p pn,m
mathrm{r}n,m(qin,pmathrm{r}) = ~n,m,
(q\mathrm{i},p\mathrm{r})inV (p )
(2.5d)
\forallm G Mn
Zn,mmathrm{r}n,L	mathrm{r}n,m	qn,UZn,m
\lambdan-mf	0, \forallm G \mathrm{r}n, P G \scrPn,m, (qi,pr) G V(P)
= zn,m, \forallm G
(qi,pr)eV (p )
yin,m,\forallm e\mathrm{r}n, pinpl,n,m (b,l) (qi,p\mathrm{r})inV(p)
''qiyPr
p pn,m
(2.5e)
(2.5f)
(2.5g)
(2.5h)
l G \scrL(\scrPnm)
(1 - y?,m),\forallm eMn, pinpO,n,m(B,l) (q\mathrm{i},p\mathrm{r})inV(P)
l G	nm)
y?,m G {0,1},\forallm G \mathrm{r}n,l G \scrL(\scrPn’m)
(2.5i)
(2.5j)
having the additional variable:
• yn,m i\sum a binary variable associated with the lth entry of the binary code of each polytope, which induces the branching scheme in the weighting \lambda variables.
and extra parameters:
•	scrP1,P,m(B,l) and scrP0,P,m(B,l) are the polytope sets associated to the injective function B which maps polytopes to binary vectors, grouping polytopes according to the index l and its binary representation B, where scrPj,P,m(B,l) := {P in scrPP,m : B(P)i = j}, j in {0,1};
•	scrL(scrPn,m) := {1,..., Plog2 |scrPP,m|rceil} is the set of indexes mapped by the binary vectors to represent each polytope P in scrPn,m.
Convex Combination
The production function qP,m(pm,qP) of well n depends on the pressure of the manifold m to which it is connected, pm, and the lift-gas injection rate, q”. This curve is represented by a piecewise-linear function using the Convex Combination (CC) model as follows:
For all n in scrN :
q” =	\lambdanm q	(2.6a)
minscrMn (qi,pI)inV(scrP)
\lambdanm p. leq pm leq	\lambdans. p\mathrm{r}
(qi,pr)eV(scrP)	(gi,pr)eV(scrP)	(2.6b)
+pm,max(1 _ Zn,m), forallm in scrM,
\bfqP,m =	\lambdapm q”’m(qi,p\mathrm{r}), forallm in Mn	(2.6c)
(gi,pr)escrV (scrP)
z„,mq”,L leq \bfqP,m leq q”,Uz„,m, forallm in scrMp	(2.6d)
A”’X geq 0, forallm in , (q\mathrm{i},p\mathrm{r}) in scrV(scrP)	(2.6e)
\lambdaPm = zn,™, forallm in	(2.6f)
(gi,pr)escrV(scrP)
\lambdanp™r leq	y”,m, forallm inscrMn, (qi,pr) inscrV(scrP) (2.6g)
p inscrP n,rn(q.,pr )
yP,m = zn,m, forallm in Mn	(2.6h)
p n,m
y”,m in {0,1}, forallP inscrP”,™	(2.6i)
where scrPP,m(q\mathrm{i},p\mathrm{r}) = {P in scrPP,m : (q;,pr) in V(P)} and ypm chooses the polytope.
Logarithmic Convex Combination
New concepts are introduced to implement the branching scheme proposed by [26]. Let \scrSe = {so,..., sn} be the set of breakpoints on axis e and \scrIe := \{[s0, si],..., [sn-1, sn]} be the intervals of breakpoints. Let \scrIe(s) :=	\scrIe : s \scrI} be the intervals
containing s. Let \Xie([si, si+1]) = i +1 be the index of an interval [si ,si+1] \scrIe. Let B : \{1,..., |\scrIe|\} \rightarrow \{0,1} \lceillo\mathrm{g}2(|\scrIe|)i be a SOS2 compatible function, meaning that B(i) and B(i + 1) differ only in one bit according to the Gray code property. The vertices of the domain is \scrV(\scrP) = S1	Sd and d is the dimension. The first
phase of the branching scheme uses the sets J+B l := \{s \scrSe : B(\Xie(\scrI))i = 1,\forall\scrI Te(s)}1 and := \{s \in\scrSe : B(Se(\scrI))&amp;lt;= 0, \forall\scrI \scrIe(s)} where l \Phi(Se) = \{1, 2,..., \lceillog2(|Se| — 1)\rceil\} is the position of the binary code used to represent the intervals on axis e. Notice that the number of intervals is precisely one less the number of breakpoints.
The second phase selects a simplex of the hypercube obtained in phase one using the sets \scrLr,s = {v \scrV(\scrP) : \bfvr is even and vs is odd} and \scrRr,s = {v \scrV(\scrP) : vr is odd and vs is even, \forallr, s D = \{1,..., d}, such that r &amp;lt;s.
To piecewise linearize \bfqn,m(pm, q.n), the Logarithmic Convex Combination (Log) model builds the \mathrm{J}1 triangulation and restricts the convex combination to a single simplex implicitly through the branching scheme. This is achieved with the following equations:
For all n \scrN, m \scrM„, l	\Phi(\scrKn’m) :
En,m
q J +	PrE\scrRn’m
qi\inJ axis(\scrKn&gt;m) ,B ,l
sum
En,m
Aqi'Pr
Jaxis(\scrKn&gt;m) ,B ,l	"
For all n	\scrN, m	\scrMn, l	\Phi(\scrRn,m) :
sumsum
qi\in\scrKn,m
n,m AQi,Pr
n,m
xl ,
,m
xl ’
J{xis(\scrRn,m),B,i
sum
sum
q.t\scrK	P\mathrm{r}EJa.xis(\scrRn,m),B,l
n,m AQi,Pr
n,m (1 — xl,
(2.7a)
(2.7b)
(2.7c)
(2.7d)
&lt;
&lt;
&lt;
(1—*r)
)
1J+b l	se\mathrm{t} breakpoints s on axis e such that the binary
code of all intervals that contain s has value 1 at the lth position of the code.
For all n \scrN, m \scrMn, (r, s) rn’m :
(2.7e)
n,m (qi,Pr)\in\scrLr’s
\lambdanm \leq	(1 - ynm	(2.7f)
.	{0,1}, \foralln	\in\scrN,m	\scrMn, l	\Phi(\scrKn’m)	(2.7g)
xnm	\{0,1}, \foralln	\scrN, m	\scrMn, l	\in \Phi(\scrRn’m)	(2.7h)
y”’am \in \{0,1}, n	\scrN, m	\scrMn, (r, s) \in Tn’m	(2.7i)
having the following extra parameters:
•	\Phi(\scrS) = {l,•••, M\scrSI- 1)_l};
•	axis(Q) is the axis that contains the breakpoint set \scrQ;
•	rn’m := \{(r, s)	D \times D : r &amp;lt;s};
•	\scrLnsm = \{v \scrV(\scrPn,m) : \bfvr \forall\Phi \lambda\v\lambda\leq and vs is odd} and \scrR"’m = {v \scrV(\scrPn,m) : \bfvr is odd and vs is even}, \forallr, s D such that r &amp;lt;s;
and extra variables:
•	x^m and x?m are binary variables that induce the first phase
of Log branching, for each entry l	\Phi(\scrKn,m) and l	(\scrRn,m)
respectively;
•	y^’™ \forall\Phi a binary variable that induces the second phase of the Log branching for each (r, s) \Gamman,m.
The complete Log model for the piecewise-linear approximation of the well-production functions consists of the Equations (2.6a)-(2.6f) and (2.7). A complete example of the Log model for a 2dimensional function is found in [27].
2.5.3	Multiple Choice Model
The Multiple Choice (MC) model approximates the original function using hyperplane equations for each polytope function. The domain is divided into a set of polytopes P \scrP, which are described by a set of linear inequalities APxP bPyP. A domain point x is represented by the summation of all domain variables xP. For each polytope there is an associated hyperplane function that linearizes the original function inside that polytope. Finally, only one polytope
can be active, which has an active domain point and its corresponding function value. This formulation was studied in [28], [20], and [21]. The non-convex function \bfqn,P(pP, q”) is approximated with a PWL function using the MC model as follows:
For all n \scrN :
n,p
Qi ’
En,p,P q” ,
p r- pn,m
,p,P	n.max n,p
q”
En,p
qn
P\in\scrMn
Pm	JZ P”’m’P,	Mn
p p pn,m
pm
pn’P,P+pp,max(i -
Pp pn,m
\bfq”,p = sum	MP,P
P pn,m
n.rn.P
P’ ,-npn,P . P\mathrm{r}
zn,p), Vm	^\scrMn
n,p n, + \bfcP yP	,
(2.8a)
(2.8b)
(2.8c)
(2.8d)
(2.8e)
(2.8f)
0
\forallm \scrMn
z	an’L &amp;lt;a”,P &amp;lt;an’uz&amp;lt;/n,^H	— H	— H	&lt;/n,p			(2.8g) (2.8h)
n,P \bfAP	n,P,P Q , , pn,P,P	\bfbP,Py”,P, \forallm \in\scrMn ,P \scrP”,p	
sum	y”,P = Z”,P, \forallm	\scrMn		(2.8i)
Ppp n,m			
pn,P,P pr	0, \forallm	\scrMn, P	\scrP”,p		(2.8j)
y”,P	{0,1}, \forallm	\scrMn, P \scrP”,P	(2.8k)
with additional variables:
• q”,P,P is the lift-gas injection rate for well n when it belongs to polytope P	\scrPn,P;
\bullet p”,p,P	manifold m pressure in polytope P \scrPn,P;
•	yP&gt;,P	a binary variable that takes on value 1 when polytope
p \scrPn,p	active, and 0 otherwise;
and extra parameters:
•	M”,P	with the coefficients of the hyperplanes that
approximate the vector function qn,P within the polytope P \scrP n,p;
• is a vector of constants for the hyperplanes that approximate qn,m within P in scrPn,m;
bullet \bfApm and bpm describe the linear inequalities that define polytope P in scrPn,m. Since the matrix \bfAP’m may not be full rank, Equation (2.8b) is needed to force	to zero when yP’m
takes on value zero. In this case, the pressure pf’m’P does not need to be driven to zero because pm will become a free variable, bounded by other wells connected to manifold m.
2.5.4	Incremental Model
The incremental (Inc) approximates the original function incrementally with an ordered set of simplexes and vertices, which must induce a triangulation of the domain of the function. When approximating multivariate functions, this model requires the set of polytopes scrP to be a triangulation scrT with special ordering properties:
O1: The simplexes in scrT must be ordered as T,...,such that Ti cap Ti+i = emptyset for i in {1,..., |scrT| - 1}.
O2: The vertices of each simplex Ti must be ordered as v0,..., v|V(Ti)|-1 suc\bfc	viV(Ti)|-1 = v0+1 for i in {1,..., |scrT| — 1}.
These properties ensure a total ordering among the simplexes and vertices in the domain, which is required to incrementally represent the graph of the function, scrG = {(x, f (x)) : x in dom(f)}. [29] showed that such conditions are met by several triangulations, inclusive the J1 (“Union Jack”). [30, 31, 32, 29, 33] have studied the Inc model which is also referred to as the delta method. More recently, [18, 20, 32] began calling it the incremental model. Below, the equations based on the incremental model are presented to approximate the non-convex function q"’"in
For all n
inscrN :
n,m
q ’
|Tn-m| |V(Tj)|-1
n,m	n,m n,m n^my
qi’1’0Zn’m +	\deltaj’k	q\mathrm{i}’j’k — qi’j’0 ,
j = 1 k=1
(2.9a)
forallm in scrMn
\scrTn,ml |V (Tj )|_1
m	n,m
p geq P\mathrm{r}’1’0Zn,m
j=1
n,m n,m n,m \
+ X X j [pr’j’k — PT’jfi) ,
k=i
(2.9b)
forallm in scrMn
\Tn’m | |V (T, )|-1
p" &amp;lt;n,rn z	.	\delta-,m /pn,m_ pn,m\
P	pr,1,0Z-,m ' 2.^	2.^ j \P\mathrm{r},j,k	Pr,j,0) (2 9c)
j=1	k=1	■	'
+pm’max(1 - z-,m), \forallm	\scrM-
|Tn’m| |V(Tj)|-1
\bfqn,m _ \bfqn,m(nn,rn n,m )z	.	\deltan,m
Q _	(qi, 1,0, P\mathrm{r}, 1,0 )zn,m I /	,	\deltaj,k
j=1	k=1
j - q-m( j •	,	\in \scrM-
z„,mq”,L \leq q-,m \leq q-,Uz„,m, \forallm \scrM-
|V (Ti)|-1
\sum	\delta-,m \leq z„,m, \forallm \scrM-
k=1
\delta-f &gt; 0, \forallm \in\scrM-, j \{1,.|\scrT-,m|}, k \in\{1,..., |V(Tj)|- 1} w-,m \leq	.(Tj)|_1, \forallm \in\scrM-,
j \{1,..., |\scrT -,m|- 1}
|V (T, )|-1
\sum jm,fc \leq w-,m, \forallm \in\scrM-,
k=1
j \in\{1,..., |\scrT -,m|- 1}
w-,m \{0,1}, \forallm \scrM-, j \{1,..., |\scrT-,m| - 1}.
(2.9d)
(2.9e)
(2.9f)
(2.9g)
(2.9h)
(2.9i)
(2.9j)
having the additional variables:
• \delta-,m	a weighting variable that incrementally represents the
domain into a single polytope;
• w-,m assumes value 1 when the variable \delta",f"	of the
j	PP (Tj)|-1
simplex T\widehat	\scrTn,m takes on value 1, for all \widehat \leq j. In this case,
Tj+1 is the active simplex of the domain;
and extra parameters:
•	breakpoint of the lift-gas injection rate for vertex
k of simplex j of well n;
• P-jm	breakpoint of the pressure of manifold m for vertex
k of simplex j;
•	scrTn,m is the set of simplexes that make up the family of polytopes in the domain of the production function bulletn,m when well n is routed to manifold m;
•	V(T) is the set of vertices of the simplex T scrT scrTn,m.
The Inc model requires an ordering of the polytopes and vertices according to properties 01 and 02. In this dissertation, the J1 triangulation was used for all simplex-based approximation models, inclusive Inc. To find such an ordering of the J1 triangulation, the approach below was followed:
1.	An undirected graph scrG = (scrP, £) is obtained to represent each polytope (simplex) as a vertex P, where an edge (P, P\prime) scrT £ if and only if V(P) cap V(P\prime) = emptyset;
2.	A weight cp,p\prime = 1/(|V(P) cap V(P\prime)|) is assigned to each edge, being inversely proportional to the number of shared vertices between P and P\prime;
3.	A Hamiltonian path \scrC for scrG is found by a reduction to the traveling salesman problem which is solved using the Concorde solver.
4.	Finally, an ordering of the vertices is obtained by following the
path \scrC, moving from one polytope Pk to the next Pk+i and selecting the common vertice	= v0+1 at random.
2.5.5	SOS2 Model
In a pioneer work, Beale and Tomlin [34] proposed a new representation for piecewise-linear functions based on the convex combination of the weighting variables A’s associated with the vertices of the function domain. Among these weighting variables, only two of them can be nonzero and consecutive in the branch-and-bound algorithm. Such sets are called S0S2 and the constraints that use these sets are called S0S2 constraints.
Nowadays some general purpose solvers support S0S2 constraints. [35] presented an example that illustrates how the S0S2 constraints can be treated in a branch-bound procedure. Assume that {A°,...,	are S0S2, and let {\lambda°, \lambda1,...,	be solution of the linear relaxation of the problem, where ~k1,	&gt; 0 for
some k^,k2 scrT {0,..., k(j)}, ki &amp;lt;k2, and k2 — ki &gt; 2. This violation of the S0S2 constraint can be ruled out in the branch-and-bound search by introducing the constraints \lambdaj = ■ ■ ■ = A^1 = 0 in one branch, and Aj'1 +2 = ■ ■ ■ =	= 0 in the other.
Beale[36] showed how to extend SOS2 constraints to multidimensional piecewise-linear functions. Instead of using binary variables, convex combinations are limited to a hypercube of the function domain using a linked chain of SOS2 constraints. The equations that represent the well-performance curve qn,m(pm, q") are reformulated with SOS2 constraints as follows:
For all n G N :
q" =	q&gt; m\xiMn qi\xiscrKn’m pIEscrRn-m	(2.10a)
E E	pr &amp;lt;pm, v™ ■	(2.10b)
qiEscrKn,m pi\xiscrRn,m	
pm	E E	pr+pm,max(1 - zn,m),	(2.10c)
qiEscrKn,m pr\xiscrRn,m	
Mn	
\bigl("’m =	£	£	q"’m(qi,pr), Vm M"	(2.10d)
qi escrKn-m prescrRn-m	
z^mq^ &amp;lt;q"’m &amp;lt;q"’UZ"’m, Vm	Mri	(2.10e)
&gt; 0, Vq;	scrK"’m, m M", pr	scrR"’m	(2.10f)
E E	= Z"’m, Vm	M",	(2.10g)
qiEscrKn,m pr\xiscrRn,m	
m = E ■,w	(2.10h)
pr\xiscrRn.m	
, Vpr	escrR".	(2.10i)
qiEscrKn,m	
(CEscrKn.m , «DscrRn.m HPC SOS2	(2.10j)
having additional variables
•	is an auxiliary variable which takes on the value of the
summation of the weighting variables	over all manifold
pressures pr for a particular injection rate q\bigr);
•	\etap’m is an auxiliary variable which takes on the value of the
summation of the weighting variables	over all q; for a
particular manifold pressure pr.
The auxiliary variables	and	compose the linked chain
of SOS2 constraints that divides the domain in a grid. The SOS2 constraints (2.10j) limit the convex combination of the weighting variables to be within a single polytope (hypercube).
2.6	MODELING AND ANALYSIS
This section presents a computational and simulation analysis of the MILP formulations developed for the oil production optimization problem subject to routing and pressure constraints. The oil production system used as a testbed is a synthetic but representative oil field modeled with a multiphase flow simulator widely used by oil operators. The computational analysis evaluates the performance of the MILP reformulations for both hypercube and simplex approximations. Finally, a simulation analysis is performed to analyze the mean errors and respective overall benefit of these models compared to the results obtained with the multiphase flow simulator.
2.6.1	Production System
The production system has N =16 wells and M = 2 manifolds as illustrated in Figure 2.7. All production wells can send their production to both manifolds, i.e. \scrNm = \scrN, \forallm G \scrM. Each manifold is connected to a dedicated separator.
Figure 2.7: Production system network with gas-lifted wells.
The wells and manifolds are topologically divided into two groups: the wells 1-8 are 1 km away from manifold 1, and 10 km away from manifold 2, while the wells 9-16 are 1 km away from manifold 2, and 10 km away from manifold 1. The pipelines connecting wells and manifolds have 4 inches of Inner Diameter (ID), and 0.001 inches of Roughness (R). With this topological structure, qn,mi (pr,q;) &gt; qn,m2(pr,Qj) if well n is closer to manifold 1 than manifold 2 for a given manifold pressure p\mathrm{r} and lift-gas injection rate .
The Gas-Oil Ratio (GOR) and Water Cut (WCUT) fractions are given constants for each well. The liquid flow rate of each well behaves according the equation = J;(p\mathrm{R}_pwf), where = qo + qw, pwf is the bottom-hole pressure, J; is the well productivity index, ana p\mathrm{R} is the reservoir static pressure. Table 2.1 presents the well parameters with the units of GOR, WCUT, p\mathrm{R}, and J; being sm3/sm3, %, psi, and STB/d/psi, respectively.
Table 2.1: Well parameters
n	GOR	WCUT	p\mathrm{R}	Ji	
1	200	0	2100	15
2	200	20	2300	2
3	300	10	1950	12
4	300	40	2050 15
5	400	0	1750	4"
6	400	20	1700	9
n	GOR WCUT	p\mathrm{R}	Ji
9	200	10	1900	5
10	200	40	2200	9
11	300	0	1850	11
12	300	20	2300	6
13	400	10	1825	14
14	400	40	2200	7
7	500	10	1700	11
15	500	0	1600	8
8	500	40	2100	10
16	500	20	1800	5
The production of manifold 1 flows through a pipeline of 10 km to reach a separator, while the production of manifold 2 flows through a pipeline of 5 km long. Both pipelines have negligible vertical elevation, ID = 4.5 inches, and R = 0.001 inches. The manifold pressures can vary from 300 to 800 psia, while the nominal pressure at the separator is 300 psia.
All wells have identical tubings with the following features: ID of 3 inches, drilling depth of 3.7 km, depth of 2.7 km, and injection point at 2.8 km. The maximum flow rate of each well is 8000 Mscf/d. The well performance curves used to represent this production system are described in [27]. This instance was obtained using the multiphase flow simulator Schlumberger Pipesim, inspired in a synthetic field from [15].
2.6.2	Computational Analysis
This section presents a computational analysis of the application of the MILP formulations developed in this paper to the synthetic production system. The formulations were expressed in A Mathematical Programming Language (AMPL) and solved with the MILP solver CPLEX 11.2 in a Linux workstation, with an Intel Core 2 Quad 2.93GHz processor and 4GB of RAM. All experiments ran within a time limit of 10 000 seconds (approx 2.78 hours). The instances for which the solver ran out of memory are indicated with an asterisk (\star).
For comparing the performance of the developed formulations, we analyze the impact of the number of polytopes in the domain
of the PWL functions for each scenario of gas-compression capacity. This analysis aims to verify the increase in the running time as a function of the resolution quality. The analysis considered three different scenarios of lift-gas compression capacity, namely: high for qmax = 3 624480 sm3/d, medium for q;max = 453 060 sm3/d, and low for qPax = 1 13 265 sm3/d. The resolution qualities are:
•	coarse: 18 squares (6 breakpoints for gas-injection and 3 for manifold pressure) for the production function and 25 cubes (5 breakpoints for phase flow) for pressure drop in the hypercube approximation; 36 (twice the number of squares) and 150 (6 times the number of cubes) polytopes for the simplex approximation, respectively;
•	moderate: 66 squares (11 by 6) and 1000 cubes (10 breakpoints in each phase) for hypercube approximation; 132 and 6000 polytopes in the simplex approximation, respectively.
•	fine: 180 squares (15 by 12) and 2197 cubes (13 breakpoints in each phase) for hypercube approximation; 360 and 13182 polytopes in the simplex approximation, respectively.
Table 2.2 gives the size of the oil production optimization problem for the instances considered in the computational analysis and each PWL model, as reported by the MILP solver.
Table 2.2: Formulation Size
Hypercube	Simplex
	Model	Coarse	Moderate	Fine	Coarse	Moderate	Fine
	Binary vars.	6	2’4	11 682	4482	64.22	37154
DCC	Continuous vars.	2610	11 778	60 546	4498	22 786	132 226
	Constraints	891	2 805	11 973	1673	7013	37 445
	Binary vars.	172	242	312	212	280	350
DLog	Continuous vars.	2610	11 778	60 546	4498	22 786	132 226
	Constraints	601	741	881	681	817	957
	Binary vars.	6	2’4	11 682	8 2-4	64 7 22	37154
cc	Continuous vars.	1058	3 408	13 772	1058	3408	13 772
	Constraints	1287	3 637	14 001	1287	3637	14 001
	Binary vars.	-	-	-	212	282	352
Log	Continuous vars.	-	-	-	1058	3408	13 772
	Constraints	-	-	-	681	821	961
	Binary vars.	472	2 514	11 682	1126	6 722	37154
MC	Continuous vars.	1092	5 554	26914	2670	16130	95 138
	Constraints	2 965	16 061	79 237	7457	44 549	250 405
	Binary vars.	-	-	-	1316	6656	37 086
Inc	Continuous vars.	-	-	-	3118	16 066	95 068
	Constraints	-	-	-	3 047	13 727	74 587
	Binary vars.	34	34	34	-	-	-
SOS2	Continuous vars.	1402	4 026	14938	-	-	-
	Constraints	669	943	1 491	-	-	-
Hypercube Approximation
A computational analysis of DCC, DLog, CC, and SOS2 models is performed with hypercube approximation to the oil production optimization problem. Tables 2.3, 2.4, and 2.5 present the running time in seconds and the primal-dual gap (i.e., ¡upper-bound - best-integer|/|best-integer|) for the PWL formulations considering the hypercube approximation for high, medium, and low gas-compression capacity respectively. All formulations were evaluated with coarse, moderate, and fine resolutions for each scenario of lift-gas availability.
Table 2.3: Hypercube Approximation: High Gas-Compression Capacity
Approximation Resolution
Model	Coarse		Moderate		Pine	
	CPU (s)	GAP (%)	CPU (s)	GAP (%)	CPU (s)	GAP (%)
DCC	22.54	0.00%	121.26	0.00%	10000.00	17.99%
DLog	15.19	0.00%	780.74	0.00%	5 047.64	0.00%
CC	14.05	0.00%	86.67	0.00%	1311.36	0.00%
MC	320.11	0.00%	3 370.52	0.00%	10000.00	0.02%
SOS2	4.70	0.00%	18.66	0.00%	152.23	0.00%
Table 2.3 presents the results for the scenario of high availability of compression gas. With the exception of DCC and MC, all formulations reached the global optimum, with the SOS2 formulation achieving the best performance.
Table 2.4: Hypercube Approximation: Medium Gas-Compression Capacity
Approximation Resolution
Model	Coarse		Moderate		Fine	
	CPU (s)	GAP(\%)	CPU (s)	GAP(\%)	CPU (s)	GAP(\%)
DCC	155.49	0.00%	6451.25	0.00%	\star9 641.33	28.95%
DLog	35.70	0.00%	1 222.15	0.00%	10000.00	6.89%
CC	200.43	0.00%	5 358.81	0.00%	10000.00	19.28%
MC	206.08	0.00%	10000.00	0.95%	10000.00	45.59%
S0S2	52.38	0.00%	101.19	0.00%	865.28	0.00%
Table 2.4 presents the results for the scenario of medium availability of compression gas. All formulations reached the global optimum for coarse and moderate resolutions, with the exception of MC for which the optimum was found only for the coarse resolution. Although DLog was the most efficient for the coarse resolution, only the SOS2 formulation was capable of closing the primal-dual gap with the fine resolution.
When the compression capacity becomes low, the oil production optimization problem becomes more complex and only the
Table 2.5: Hypercube Approximation: Low Gas-Compression Capacity
Approximation Resolution
Model	Coarse		Moderate		Fine	
	CPU (s)	CAP(\%)	CPU (s)	CAP (%)	CPU (s)	CAP(\%)
DCC	191.88	0.00%	7592.06	0.00%	*7742.53	83.03%
DLog	65.12	0.00%	1,068.58	0.00%	10000.00	2.58%
CC	109.00	0.00%	8,473.52	0.00%	10000.00	29.84%
MC	40.03	0.00%	10000.00	0.69%	10000.00	69.29%
SOS2	37.29	0.00%	169.88	0.00%	4519.59	0.00%
SOS2 formulation achieves the global optimum in all resolutions as shown in Table 2.5. The MC formulation reached the optimal solution only in the coarse resolution, while the others reached the optimum for coarse and moderate resolutions, but failed to close the primal-dual GAP for the fine resolution.
Simplex Approximation
The results from a computational analysis of DCC, DLog, CC, Log, MC, and Inc models are presented for the simplex approximation of the function domains. As before, the performance of these models considers a varying number of polytopes and three scenarios of lift-gas compression capacity.
Table 2.6: Simplex Approximation: High Gas-Compression Capacity
Approximation Resolution
Model	Coarse		Moderate		Fine	
	CPU (s)	CAP(\%)	CPU (s)	CAP(\%)	CPU (s)	CAP(\%)
DCC	94.35	0.00%	7895.19	0.00%	10000.00	198.99%
DLog	85.04	0.00%	1576.78	0.00%	10000.00	0.52%
CC	45.39	0.00%	623.52	0.00%	*9 855.58	188.58%
Log	5.46	0.00%	26.80	0.00%	141.09	0.00%
MC	544.65	0.00%	10000.00	0.13%	10000.00	-
Inc	102.85	0.00%	5 839.36	0.00%	10000.00	0.36%
Table 2.6 presents the running times in seconds and primal-dual GAPs for the scenarios of high compression capacity with coarse, moderate, and fine resolutions. All models reached the global optimum with coarse resolution fairly quickly. For a medium resolution, the optimal solution was found with all formulations but MC, which also achieved the worse performance with the coarse resolution. For a fine resolution, the MC model could not find a feasible solution and only the Log model succeeded to close the primal-dual GAP. For a high gas-compression capacity, the Log model outperformed all of the other models for all approximation qualities.
Table 2.7: Simplex Approximation: Medium Gas-Compression Capacity
Approximation Resolution
Model	Coarse		Moderate		Pine	
	CPU (s)	GAP(\%)	CPU (s)	GAP(\%)	CPU (s)	GAP
DCC	*8044.60	3.80%	*5 060.57	6.99%	10 000.00	65.89%
DLog	210.06	0.00%	3 852.82	0.00%	10 000.00	23.92%
CC	10000.00	2.84%	*5 892.72	51.04%	\star6 681.91	-
Log	11.51	0.00%	36.50	0.00%	157.82	0.00%
MC	10000.00	1.97%	10 000.00	9.47%	10 000.00	-
Inc	2741.95	0.00%	10 000.00	9.05%	10 000.00	2 039.15%
Table 2.8: Simplex Approximation: Low Gas-Compression Capacity
Approximation Resolution
Model	Coarse		Moderate		Pine	
	CPU (s)	GAP (%)	CPU (s)	GAP (%)	CPU (s)	GAP (%)
DCC	10000.00	5.97%	*4 530.18	100.87%	*4 966.15	595.18%
DLog	289.83	0.00	3 927.27	0.00%	10000.00	8.39%
CC	10000.00	3.81%	10000.00	18.15%	*5 946.25	-
Log	20.38	0.00%	15.28	0.00%	149.95	0.00%
MC	3 418.98	0.00%	10000.00	8.62%	10000.00	204.90%
Inc	1289.12	0.00%	10000.00	12.65%	10000.00	118.54%
Tables 2.7 and 2.8 present the results for the scenarios of medium and low compression capacity, respectively. As the compression capacity becomes constrained, the oil production optimization problem becomes harder and the primal-dual GAP cannot be closed with most of the formulations and resolutions. This was expected because the approximation with simplex is more precise but rather complex. The results with medium and low gas-compression capacity were similar: the Log model achieved the best performance, whereas only the DCC and CC models could not reach the global optimum with the coarse resolution. With a moderate resolution, only logarithmic models (Log and DLog) closed the primal-dual GAP. With a fine resolution, the solver ran out of memory with the CC model and could not find a feasible solution, however the optimal solution was found with the Log model which was faster in all scenarios and approximation qualities.
2.6.3	Simulation Analysis
The quality (benefit and mean error) of the solutions obtained by hypercube and simplex approximations are compared considering the oil-field performance estimated with a multiphase flow simulator. The simulation analysis evaluates the mean errors of the process variables calculated with the simulator and their optimizer predictions for the scenario of low compression capacity, considering three
approximation resolutions: coarse, moderate, and fine. Notice that the PWL models with the same domain (hypercube or simplex) are equivalent, meaning that all formulations with same domain reach the same optimal solution. For this reason, the simulation analysis contrasts against the simulator only the optimal solutions obtained with the hypercube- and simplex-based domains for the three different resolutions.
The objective function considered for optimization is:
f =	(poqom + pgqgm - Pwqm) -	Pi«r
with po = 20, pg = 2, pw = 1, and p; = 0, which were arbitrarily defined to reflect the relative values of the production phases and costs.
Tables 2.9 and 2.10 present the pressure and flow rates handled by both manifolds according to the optimizer predictions. All optimization models suggested the same well-manifold routings: wells 1, 3, 4, 5, 6, 7, and 8 were linked to manifold 1; wells 2, 9, 10, 11, 12, 13, 14, and 15 were connected to manifold 2. The main differences arise in the multiphase flows, pressures, and in the system total benefit.
Table 2.9: Hypercube Approximation
		Coarse		Moderate		Fine	
		Simulated	Error (%)	Simulated	Error (%)	Simulated	Error (%)
f ($)	Man.	2352855.52	IT7I%-	2496486.85	0.16%	2508574.67	0.66%
pm (psia)	1	408.83	0.41%	413.93	0.27%	412.73	0.93%
	2	373.84	1.36%	388.50	0.05%	391.88	0.43%
(W/d)	1	535754.74	0.45%	551045.83	0.21%	543683.45	0.87%
	2	611077.55	3.48%	665445.89	0.46%	678471.64	0.50%
qm m	1	1426.53	0.31%	1444.99	0.24%	1449.90	0.60%
	2	1565.42	9.19%	1766.24	0.35%	1800.23	0.64%
qm m	1	291.77	7.23%	308.21	3.11%	311.40	3.14%
	2	356.28	11.64%	412.96	0.87%	426.67	1.48%
Analyzing the hypercube-based solutions shown in Table 2.9, it is noticeable the effect of the resolution quality on the simulated manifold production and pressure. The solution obtained with the coarse resolution has considerably high errors, mostly in manifold 2. When the resolution is increased (moderate and fine), the errors drop to under 1.5% except for the water production. Surprisingly, the moderate resolution achieves smaller mean errors than the fine resolution. However, a better solution was found with a more precise resolution, inducing a better field operation but with higher modeling errors. Further, the oil production and benefit function are increased as the resolution increases, even though a more precise resolution induces higher errors.
Table 2.10 shows the manifold pressure and flow rates of the simplex-based solution for varying resolutions. The errors obtained
Table 2.10: Simplex Approximation
		Coarse		Moderate		Fine	
		Simulated	Error (\%)	Simulated	Error (%)	Simulated	Error (%)
f (\$)	Man.	2458351.41	3.71%	2484899.00	0.51%	2730618.46	0.71%
pm (psia)	1	394.15	0.02%	413.14	1.33%	427.92	0.74%
	2	384.65	2.45%	387.57	0.30%	398.29	0.38%
qmathrm{g} (W/d)	1	502907.20	1.54%	549629.99	1.18%	611927.05	0.87%
	2	697727.10	5.66%	661198.37	0.06%	721230.08	0.57%
	1	1330.96	3.65%	1438.33	0.83%	1450.27	0.71%
	2	1551.85	14.26%	1759.47	0.48%	1802.32	0.73%
qmathrm{w} ",	1	212.54	4.84%	304.47	3.76%	318.14	3.00%
	2	360.95	28.89%	409.23	1.83%	429.38	1.50%
with the coarse resolution were not high in manifold 1, but considerably high in manifold 2. As in the approximation with hypercubes, the errors are reduced with an increased resolution (moderate and fine resolutions). However, the moderate resolution reached a solution with smaller errors in manifold 2, while the fine resolution presented smaller errors in manifold 1. Again, it can be noticed that the oil/gas production and benefit function are increased as the resolution is improved with simplex approximation. The profit obtained in the fine resolution is about 9.89% better than with the moderate, and 9.97% better than the coarse.
To further illustrate the solutions settings produced by the optimization model, Table 2.11 gives the gas-lift injection and oilflow rates per well for the fine resolution with simplex domains. Likewise, Table 2.12 gives the well settings produced by the optimization model with hypercube domains.
Table 2.11: Optimal solution per well with a fine simplex resolution
n	qn	qmathrm{o}	n	qn	qmathrm{o}
1	9280.93	350.30	9	28316.80	175.58
2	28288.70	137.93	10	28316.80	177.12
3	9280.93	256.61	11	7065.15	271.40
4	28316.80	170.82	12	0.00	279.45
5	9280.93	161.81	13	0.00	244.99
6	28316.80	141.79	14	14158.40	191.27
7	9280.93	185.33	15	5407.81	181.04
8	14158.4	193.89	16	7065.15	156.65
2.6.4	Discussion
From the computational and simulation analyses, a comparison of the approximations based on hypercubes and simplexes elicited the following remarks:
Table 2.12: Optimal solution per well with a fine hypercube resolution
n	qn	qn
1	1174.24	351.16
2	13701.51	127.67
3	1174.24	258.95
4	8680.19	157.04
5	1174.24	162.05
6	16506.91	142.91
7	1174.24	190.25
8	8253.46	196.29
n	qn	qn
9	27403.02	177.62
10	27403.02	178.63
11	0.00	271.06
12	0.00	281.61
13	0.00	247.37
14	0.00	187.09
15	0.00	182.19
16	6622.30	158.55
•	In most cases the SOS2 model achieved a better performance for the approximations based on hypercubes. On the other hand, the Log model was the most efficient for the approximations based on simplexes, regardless of the gas-compression capacity and resolution quality. Comparing these two models, the SOS2 formulation is more efficient in only two cases: coarse and moderate resolutions with high gas-compression capacity. In all other cases, which are more complex, the Log model attained a considerably better performance, probably a consequence of the logarithmic number of binary variables and extra constraints.
•	Models approximated with hypercubes produced solutions with smaller mean errors than simplex approximation models. In spite of having somewhat higher mean errors the models approximated with simplexes produced solutions that, when implemented in the simulator, achieved a little lower benefit (0.47 %) in the moderate resolution, but considerably higher benefits (\$) in coarse (4.29%) and fine (8.13%) resolutions. The analysis indicates that solutions obtained with simplex approximations can induce better operating points for the oil field, despite the higher mean errors.
2.7	SUMMARY AND SYNTHESIS OF CONTRIBUTION
In this Chapter, a framework was developed for modeling pressure drops and well production functions with multidimensional piecewise-linear models for production optimization of gas-lifted oil fields. This framework contains several MILP reformulations of the original non-linear optimization problem with approximations based on hypercubes and simplexes. Computational and simulation analyses were performed considering a synthetic however representative oil field modeled with a commercial multiphase flow simulator. Although the problem of optimizing the production of an oil field is
considerably challenging, the results from these analyses can guide operations engineers to implement customized optimization solutions in real-world oil fields.
The contribution of this Chapter is about approximating and solving MINLPs that arise from the short-term optimization of oil production platforms. It was shown that the MPWL models are effective tools for modeling complex, nonlinear functions that can be obtained directly from sample or simulated data, and also from proxy nonlinear models. The main contributions of this Chapter can be summarized as:
•	A comprehensive study of MPWL models applied to shortterm production optimization;
•	A computational analysis of the MILP models for solving the gas-lift distribution optimization problem;
•	A simulation analysis to assess the effectiveness of MPWL models with hypercube and simplex domains.
3	MODELING OF FLOW SPLITTING IN GATHERING NETWORKS
In modern offshore oil fields, wells can be equipped with routing valves to direct their production to multiple manifold headers, a strategy that is routinely adopted in practice either to provide resilience to equipment failure or adjust the well-manifold routings to improve production. However, the existing models for shortterm production optimization do not account for splitting of flows and therefore require the wells to be connected to a single header. This Chapter proposes a nonlinear model of flow splitting in subsea installations that reproduces the complex behavior observed in multiphase-flow simulation. This model is further approximated with multidimensional piecewise-linear functions to a desired degree of accuracy with respect to simulated behavior. This piecewise-linear model enables the development of an MILP formulation for production optimization that automatically decides between single and multiple routing of wells to headers. The effectiveness of this MILP formulation is assessed in a synthetic but representative gas-lifted oil field modeled in a standard simulator. The Chapter is based on the following papers:
•	Silva, T. L.; Camponogara, E.; Teixeira, A. F.; Sunjerga, S. (2013): “A Mixed-Integer Linear Programming Model for Automatic Routing Decisions in Oil Production Optimization"". In: Proceedings of IEEE International Conference on Automation Science and Engineering (CASE), Madison, USA, 2013.
•	Silva, T. L.; Camponogara, E.; Teixeira, A. F.; Sunjerga, S. (2015): “Modeling of Flow Splitting for Production Optimization in Offshore Gas-Lifted Oil Fields: Simulation Validation and Applications"". Journal of Petroleum Science and Engineering, v. 128, pp. 630-642.
3.1	INTRODUCTION
In daily operations of oil fields, petroleum engineers conceive production plans to decide upon valve configurations, well-manifold routings, gas injection rates, among others. Optimization tools such as the piecewise-linear approximations presented in the previous Chapter can be used to model complex process functions that are part of decision-support systems, which may help operators in determining optimal platform settings for daily or weekly operations. Although production optimization of oil fields on the short-term is a complex task that has been studied by many researchers [9, 10, 16, 11, 12], in recent developments, mathematical programming approaches have been successfully applied to determine the daily production plans of complex oil fields, like the Urucu Field in Brazil [37] and the Tfoll Field in Norway [17]. Common to these works is
the attempt to close the gap between the scientific models and the needs of real-world oil fields.
Despite flow splitting being a common practice in industrial settings, to the best of our knowledge it is not accounted for by existing mathematical models in the optimization literature, whose works usually impose a single routing from wells to manifolds. Incidentally, flow splitting induced by routing well production to multiple manifolds is a common practice in the Urucu field, a reservoir located in the heart of the Amazon, which is not addressed by the existing models [37]. To this end, this dissertation advances previous works by developing an optimization model that accounts for flow splitting in the gathering system by allowing production from wells to flow to multiple manifolds, a configuration which is being widely used in off-shore fields.
In the following Section, a mathematical model is proposed for modeling of flow splitting according with the observed behavior of a commercial multiphase-flow simulator. This model is approximated using piecewise-linear functions and further validated against the simulator. In Section 3.3, a MILP model that accounts for flow splitting is developed for production optimization of a gas-lifted oil field with pressure and routing constraints. Section 3.4 discusses the modeling of a synthetic, but representative field, and proposes a methodology to obtain sufficiently accurate piecewise-linear models for well-production and pressure drops. Further, a computational analysis evaluates the performance of the MILP formulation and analyzes the impact of flow splitting. Finally, the concluding remarks and a synthesis of the Chapter’s contribution are presented in Section 3.5.
3.2	FLOW SPLITTING MODELING AND VALIDATION
A typical offshore production system is composed of subsea wells, manifolds gathering production from wells, and surface facilities. Production wells are equipped with choke valves that control well-head pressure and production, which can benefit from gas-lift to increase the naturally flowing rate. After being gathered by a manifold, the well production is directed to surface facilities in the platform to be processed by a separation unit, which splits the production in three-phase flows: namely, oil which is transferred by shuttle tankers, gas which is compressed and exported in subsea pipelines, and water which is processed before discharge.
Figure 3.1 illustrates a subsea production system consisting of a single well and three manifolds gathering production. Pressures and flow rates are depicted in the figure denoting the well-head pressure (p\mathrm{w}h), pressure downstream the choke (pJs), manifold pressure (pm), well production (qn), flow rates in the jumpers (qn’m), and gas-lift rate (qfnj).
In such fields, operators usually decide upon the routing of production from wells to manifolds, which are implemented by opening or closing the routing valves. To the best of our knowledge, previous works found in the technical literature enforce the policy of routing wells to a single manifold [17, 37], despite multiple routing being routinely implemented in real-world oil fields.
In what follows, a mathematical model for flow splitting is developed in the context of a single well and multiple manifolds. This model can be used to represent flow splitting of wells in complex production networks, encompassing several wells and multiple manifolds.
3.2.1	Nonlinear Model
Consider a particular gas-lifted well n of a set \scrN = \{1,..., N}. Suppose that well n can send its production to a subset \scrMn of the manifolds, with \scrMn \subseteq \scrM = \{1,...,M}. The oil, gas, and water produced by well n can be characterized by the following equations:
i qn = \widehatn).(1 - wcutn)
(Pmathrm{w}h,q?n3 ).GLRn + qfnJ	(3.1)
( qmathrm{w}ater = \widehatl7q (P^O^nj ).WCUT ”
with \widehatiq being the liquid production as a function of the well-head pressure and the rate of the lift-gas injection q^-. For the purpose of steady-state production optimization, the Gas-Liquid Ratio
(GLR) and the WCUT of the reservoir are assumed to be known and constant for weeks.
The difference between the well-head pressure and the pressure downstream the choke, p”s, corresponds to the pressure loss due to friction which is related to a particular choke opening. Flows in the jumper connecting well n to manifold m are given by functions as follows:
=	\mathrm{j}n	(\mathrm{j}n	p”	\bfp”	) sp	sp	ds	man		(3.2a)
q” =	q”’m,		(3.2b)
		
qn,m,		(3.2c)
		
p”s,		(3.2d)
p”s = \Deltap . ' ..	,GoR ■	+ pm, m	e \mathrm{q}n	(3.2e)
GORn,m ■ (1 - WCUTn) = GLR” + (		
	\q”il + q\mathrm{w}ater	, (3.2f)
Vm e
where:
•	= (q”il,q”as,q\mathrm{w}ater) \mathrm{d}s a vect°r with the three-phase flow produced by well n,
•	q”p = (q”im, q”am, q^’X) : m € \mathrm{q}n) is a vector with the rate of all fluid phases flowing in the jumpers,
•	Pman = (pm : m G \mathrm{q}n) is a vector with the pressure of the manifolds receiving production from well n.
The three-phase flows in the jumpers are given by the function q”p(qn, Pns, Pman), which depends on the total flow rate qn of well n, the pressure downstream the choke (p”s), and the pressures at the manifolds to which the well is connected (p\mathrm{m}an). The multiphaseflow simulator iteratively calculates the flow for each jumper based on the pressure differences downstream the choke to the manifold, keeping the same gas-liquid ratio of the well in accordance with Equation (3.2f). Notice that the left-hand and right-hand side of Equation (3.2f) defines a factor that if multiplied by a flow of liquid will produce the respective flow of gas, namely the GLR, for the jumper and the well, respectively. The pressure drops in the jumpers --------------------------------------------n,m
are calculated by function	, a behavior which is a consequence
of flows in the jumpers and resulting pressure differences.
n,P
Typically, the functions q\mathrm{s}p and Deltap\mathrm{j}p are not known explicitly but rather implemented by simulation software, which iteratively converges to a solution of the system of equations (3.2) that meets Physics laws. More specifically, Equation (3.2f) assures that gas and liquid flow rates in the jumpers are in the same proportion of flows produced by the well, which is also observed in commercial simulators.
The set of equations representing the flow splitting phenomena are based on some assumptions: material balance holds, pressure balance holds, and inlet and outlet flows have the same Gas-Liquid Ratio (GLR). Such relations are further approximated and validated against simulation software.
3.2.2	Piecewise-Linear Approximation
Despite being routinely used by reservoir engineers to predict production, the relations implemented by simulation software are either not explicitly known or too complex to be effectively used in mathematical optimization. Alternatively, these relations can be conveniently modeled with multidimensional piecewise-linear functions. The advantage of piecewise-linear models with respect to others is that the former are directly obtained from the sample data, dispensing with the synthesis of proxy models, a task that can itself be rather complex. This means that a piecewise-linear function can approximate a nonlinear function to a desired degree of accuracy provided a sufficient number of sample points.
Optimization problems involving these functions can be modeled as MILPs and solved with specialized algorithms or generalpurpose solvers, as discussed on Chapter 2. Usually, the latter approach takes advantage over the first since it uses the advanced technology available for solving MILPs [18]. A comprehensive study of available MILP models to represent multidimensional piecewise-linear functions in the context of oil production optimization is found in [38].
In what follows, the main idea of this Chapter is presented, which consists of approximating implicit relations used by multiphaseflow simulators to predict splitting of flows as piecewise-linear models. This methodology is then used to optimize the production of a representative offshore gas-lifted oil field.
MILP Approximation for Flow Splitting
The mathematical modeling of flow splitting developed in Section 3.2.1 is interesting for understanding the process, but not suitable for optimization purposes since it relies on implicit functions implemented by simulation software. Herein we approximate such functions using the multidimensional piecewise-linear model based
on specially ordered sets of variables [36, 39] denoted by SOS2, resulting in a MILP formulation. This model was chosen for its simplicity and efficiency for hypercube domains [38].
The well production function widehatq(q\mathrm{i}n,j ,p\h) °f a given well n is approximated with the piecewise-linear function . Gas and water production are obtained from the gas-liquid ratio and watercut relations. Equation (3.1) is rewritten as:
	= (qi,p\mathrm{k})\in\scrKn	■ widehatn(qi,pk) ■ (1 - WCUTn),
	=	Aqi,pk cdot widehatn(qi,pk) cdot	+ qn,
	(qi,pk)\in\scrKn	
q\ater	=	\lambdanqi,p\mathrm{k} cdot widehatn(®,pmathrm{k}) cdot wcutn,
	(qi,pk)e\scrKn	
where is the set of breakpoints of lift-gas injection rates, scrK” is the set of breakpoints of well-head pressure of well n, and scrKn := scrK" times . Further, Aq.,pk is the weighting variable associated to the breakpoint (qi,pk) in scrKn.
The gas injection rate and the well-head pressure of well n are defined with the same weighting variables \lambdan used to approximate the production function:
q"nj =	sum	■ qi&gt;	(34a)
(qi,Pk)e\scrKn
p\h =	sum	cdot pmathrm{k}	(34b)
(?i,Pk)e\scrKn
Extra constraints are added to implement the piecewise-linear model SOS2 approximating the well production function (widehatq):
1	=	■	(3-5a)
(q\mathrm{i},p\mathrm{k})\in\scrKn
0 leq Aqi,pk, V(qi,pk) inscrKn,	(3.5b)
= sum , forallqi inscrKn	(3.5c)
= sum \lambda;\mathrm{i},pk, ■ inscrKn,	(3.5\mathrm{d})
(\xiq\mathrm{i})qie\scrKi, (\xip\mathrm{k})Pk£\scrKp are SOS2,	(3.5\mathrm{e})
where \xiqi and	are auxiliary variables which are used to implement
SOS2 constraints.
The pressure drop \Deltap\mathrm{j}P («1^™,GORn,m) in the jumper connecting a well n to manifold m is approximated with a piecewise-linear model:
'-'--n.m	x—&gt;	--------n,m
\Deltapjp =	■ \DeltaPjp
(qi,gor)
where scrRn,m := scrRp,m times scrR\mathrm{g}.’m is the set of breakpoints for liquid flow rates (scrRP’m) and gas-oil ratio values (scrR\mathrm{g},m') in the jumper, with being the weighting variable associated to each breakpoint (q, gor) in the set scrRn,m.
Resulting flows split from a particular well n are calculated with the weighting variables \phin’mor associated to the pressure drop n,m approximation \Deltap\mathrm{j}p :
i	cm =	« ■ (1 - wcun,
(qmathrm{l},gor)
&amp;lt;qnam	\	\phimm°r ■ « ■ (1 - wcuTn) cdot 50r,	(3.7)
(qi,g°r)E\scrRn’m	' '
COEr =	\phin;m°r cdot « cdot wcutn,
(qi,gor)\in\scrRn’m
Notice that the flows in the jumpers are now explicitly calculated based on the pressure gradients established by the piecewise-linear n,m approximation of the pressure drop function \Deltap\mathrm{j}p .
Then gas-liquid proportions of split flows are kept the same of the well in accordance with an approximation of Equation (3.2f) as follows:
12	\phinm°r cdot 5or cdot (1 - WCUTn) = GLRn+
(qi,gor)E\scrRn’m
n
qi?Pk
(3.8)
(qmathrm{i},pmathrm{k})\in\scrKn
\widehatiq (« ,p\mathrm{k})
E
A
Extra constraints are added to implement the SOS2 piecewise-linear model which approximates pressure drops in the jumpers for the well-manifold pair (n,m):
1=	\phinm°r,	(3.9\mathrm{a})
(qi,gor)\in\scrRn’m
\etan,m =	\phinmor, forall®	,	(3.9b)
n,m gor\in\scrRmathrm{g}
\etanm = e \phi^or,\forallgor\in\scrRr■	(3.m
(&lt;”),,m	\bigr)gor\inKtm are SOS2. (3.9d)
The auxiliary variables \etan,m, and are use\forall \bigl(0 implement the piecewise-linear strategy with special ordered sets of constraints.
One should notice that the model developed for approximating flow splitting for optimization purposes could also be developed with other piecewise-linear models, such as the convex combination models DCC, DLog, CC, and Log; the incremental model Inc; or the multiple choice model MC [38]. Further, the splitting model can be adjusted for other production systems. For instance, in a gas reservoir - like Mexilhao Field which is located in the Santos Basin off the coast of Brazil - the production of wells is not dependent of gas-lift injection, so it suffices to remove the lift-gas contribution from Equations (3.3) and (3.8).
3.2.3	Simulation-Based Validation
The validation of the mathematical model of flow splitting is carried out by contrasting its behavior against to the behavior observed in a multiphase flow simulator. For this purpose, a small synthetic field is developed and used as a testbed for the experiments.
Synthetic Field Modeling
A typical gas-lifted well that was modeled in the multiphase flow simulator Pipesim from Schlumberger® is illustrated in Figure 3.2. The flow rate of the well can be increased by injecting pressur-
Figure 3.2: Gas-lifted well in pipesim.
ized gas at the bottom of the production tubing and by choking
production in the well-head, which changes the back-pressure to the well-head.
The well has the following attributes: liquid Productivity Index (PI) = 80 STB/d/psi, GLR = 160 sm3/sm3, WCUT = 0.01 sm3/sm3, and reservoir static pressure of 2100 psia. It is assumed that the reservoir characteristics do not vary frequently, and thus the gas-oil ratio, water-cut, and productivity index of the well are constants for the horizon of production optimization.
The well is connected to subsea manifolds that represent the submarine equipment, which are typically found in offshore fields. Figure 3.3 illustrates the subsea equipment of a simple offshore
Figure 3.3: Illustrative Scenario Modeled with Pipesim.
field, which consists of a single well flowing production to three subsea manifolds through jumper pipelines with 4 inches of inner diameter, 0.25 inches of wall thickness, and 0.001 inches of roughness. The pipelines B15, B25, and B2 have different horizontal lengths, namely 1 kilometer, 1.25 kilometers, and 1.5 kilometers, respectively.
Simulation Analysis
In this section, a simulation analysis is performed with the goal of evaluating whether the MILP model approximates satisfactorily the flow splitting observed in the commercial multiphase flow simulator.
The methodology adopted to assess the degree of accuracy of the MILP model is illustrated in Figure 3.4. The methodology consists of the following steps:
Step 1:	Boundary conditions such as pressures in the manifolds
and lift-gas rates are given as inputs for the simulator,
Figure 3.4: Splitting simulation analysis.
which iteratively calculates the pressures in the wellhead and downstream the choke, and also the resulting flow rates in the pipelines.
Step 2:	Flow rates and pressures calculated by the simulator (qSIM, pS/M) are gjven as references for the splitting model. A feasible solution is calculated by the splitting model for which the infinity norm ||pSPL — pSIM ||is bounded by the tolerance \varepsilon. If the difference between the flow rates and pressures estimated by the splitting model and the simulator are equal or smaller than the tolerance, a reasonable solution was achieved and the algorithm stops. Otherwise, the algorithm continues by going to step 3.
Step 3:	The well-production and pressure-drop approximations are refined by sampling well flow rates and pressure drops from simulator for a higher number of breakpoints. The new PWL functions are given as inputs for the splitting model and the algorithm proceeds by returning to step 2.
The algorithm was initialized with PWL approximations containing 5 breakpoints per axis and having (q^f, pmathrm{m}fn) = (5200, [150,155,160]') as the boundary conditions. A solution was reached after 3 iterations, with the resulting approximation for the wellproduction function (\widehaton|) having a total of 289 breakpoints, being 17 for injection flow rates and 17 for well-head pressures. The result
ing approximation for pressure-drop functions (\DeltaPmathrm{j}p ) also contains 289 breakpoints, namely 17 per axis.
Table 3.1 presents flow rates in cubic meters per day (sm3/d) and pressures in psia. Notice that the maximum error between the simulator results and the splitting model predictions is less than 2.5%, which was the chosen tolerance for the convergence of the algorithm.
Table 3.1: Simulation Analysis of Splitting
	Variable	Splitting Model	Simulator	Error
		96972.70	97365.27	0%0\%
	qZi	563.45	565.32	0.33%
		5.69	5.71	0.35%
Well	Pmathrm{w}h	192.83	190.00	1.05%
	Pds	192.83	190.00	1.05%
	qn .	5910.56	6000.00	1.49%
	q^as	39644.60	39710.47	0.17%
	q^	230.35	230.57	0.00%
Manifold 1	q^ater	2.33	2.33	0.00%
	pm	147.86	150	1.43%
	GLRn’m	170.39	170.51	0.07%
	q^as	32313.50	31613.81	2721\%
		187.48	183.56	2.14%
Manifold 2	q^ater	1.89	1.85	0.00%
	pm	153.15	155.00	2.16%
	GLRn’m	170.39	170.51	0.07%
	q^as	25893.60	26040.99	057\%
	qh	150.45	151.20	0.50%
Manifold 3	q^ater	1.52	1.53	0.65%
	pm	157.62	160.00	1.49%
	GLRm	170.39	170.51	0.07%
Despite the errors in optimizer predictions for well flow rates, they are similar to the flows calculated by the simulator (&amp;lt;0.40%), while pressure differences are acceptable (\leq 1.49%). Flow rate measurements in the manifolds for both optimizer and simulator are small for manifolds 1 and 3 (\leq 0.65%), while the errors for manifold 2 are aceptable. The pressure predictions have the higher errors, but did not exceed the upper bound on errors (2.5%). Although the approximations are not free from modeling errors, the simulation analysis showed that the proposed formulation can approximate satisfactorily the phenomena observed in the simulator for a given tolerance.
3.3	APPLICATION TO PRODUCTION OPTIMIZATION
A mathematical methodology to approximate flow splitting in subsea equipment was developed and validated against a commercial multiphase-flow simulator. This methodology is now incorporated into a mixed-integer programming model to optimize a representative offshore production system with multiple routing decisions and gas-lift distribution. The resulting model will be referred to as automatic routing model.
A typical offshore field consists of a set of wells draining fluids from a reservoir to subsea manifolds which gather production to the compression and separation system of a Floating Production Storage and Offloading (FPSO), as illustrated in Figure 3.5. The flow paths from wells to manifolds are determined by routing valves. When the flow arrives at the platform, the compression and separation system terminal removes the gas from the mixture, which is compressed and exported to an onshore unit or used for gas-lift. The water is treated before discharge, while the oil is stored and then transferred to the coast in shuttle tankers.
Figure 3.5: Illustrative offshore gas-lifted field.
The problem of optimizing the production of an offshore field subject to gas-lift distribution, pressure constraints and multiple routing decisions is considerably hard to solve due to the nature of the production and pressure-drop functions, which are non-linear, along with the discrete variables regarding the activation of wells and routing decisions. To this end, the problem is formulated as an
MILP program using piecewise-linear models to approximate the non-linear functions.
Despite being a common practice in real-world oil fields, previous mathematical models avoid dealing with scenarios in which flow splitting takes place due to the complexity involved. The proposed MILP model is able to automatically decide upon the splitting of flows in the subsea pipelines, representing the division of fluids accordingly with commercial simulation software.
3.3.1	Mixed-Integer Linear Programming Model
In this section an MILP formulation is developed to optimize the daily production of an offshore production system subject to gaslift distribution and multiple-routing decisions. The splitting model is incorporated into this formulation, with small changes to support routing decisions and variations on the manifold pressure. The list of sets, parameters, variables, and functions of the MILP formulation appear in Tables 3.2, 3.3, 3.4 and 3.5 respectively.
Table 3.2: Sets of automatic routing MILP model
Sets Description
\scrN	Set of wells
\scrNm	Subset of wells sending production to manifold m: \scrNm \subseteq \scrN
\scrM	Set of manifolds
\scrMn Subset of manifolds receiving flows from well n: Mn \subseteq \scrM
\scrH Set of phase flows: \scrH := {oil, gas, and water}
Gas-lift breakpoints
\scrKn	Well-head pressure breakpoints
\scrKn	Breakpoints for approximating
'\scrRn,m	Liquid flow rate breakpoints for jumpers
Gas-oil ratio breakpoints for jumpers
\scrRmathrm{p},m	Pressure downstream the choke breakpoints for jumpers
\scrRn,m	Breakpoints for approximating	: \scrRf’m X \scrRn,m	\scrRmathrm{p},m
Qm	Liquid rate breakpoints for the flowlines
\scrQm	Gas-oil ratio breakpoints for the flowlines
\scrQm	Water-cut breakpoints for the flowlines
-—- m
Qm	Breakpoints for approximating \Deltap : \scrQm \times \scrQm	\scrQm
Table 3.3: Parameters of automatic routing MILP model
Parameter	Description
qn,L qn,U n.max Pwh n,max Pd' n,max Phipps GLRn	Lower bounds on well n flow for all phases h \in\scrH Upper bounds on well n flow for all phases h \scrH Big-M value for well-head pressure Big-M value pressure downstream the choke Bound provided by the HIPPS Gas-liquid ratio for well n
WCUT n GLRn,m’ max m,max Qh ' \bfqm,max qmax qg max ql qmax qw in ax qinj m.S p	'	Water cut for well n Maximum gas-liquid ratio for jumper (n, m) Maximum value for the flow of phase h in manifold m Maximum flows for all phases: (qh‘’mmathrm{a}mathrm{x} : h \scrH) Gas compression capacity in the platform Liquid handling capacity in the platform Water treatment capacity in the platform Limit for gas-lift injection Nominal pressure at the separator
Table 3.4: Variables of automatic routing MILP model
Variable	Description
\widetildehn \bfqn n,m Qh' qn'm Qh qm Cj Pmathrm{w}h Pd\mathrm{s} \lambdan \lambda9inj 'Pwh yn m yman \xin	Flow of phase h \scrH produced by well n All phase flows produced by well n: (\widetildeh : h \scrH) Flow of phase h \scrH sent by well n to manifold m phase flows from well n to manifold m: (qh’m : h \scrH) Total flow of phase h \scrH received by manifold m Phase flows received by manifold m: (q™ : h	\scrH) Pressurized gas rate injected in well n Well-head pressure of well n Pressure downstream the production choke of well n Weighting variable for the PWL approximation of q\mathrm{o}\mathrm{i}i Binary variable indicating whether well n is producing Binary variable indicating if manifold m is active SOS2 variable on gas-lift to approximate
\xin
pk
n,m
\phiq\,gor,p\mathrm{d}\mathrm{s}
n,m
Apmathrm{j}p
GLRnm
zn,m
n,m
\etaqi’
,pn.m \etagor
,pn.m \etaPds
m
\Deltap
m p
GORm
qV1\mathrm{q},gor,wcut
\delta
\deltaqiiq
gor
m wcut
SOS2 variable on well-head pressure to approximate
n,r
Weighting variable for the PWL approximation of Apmathrm{j}p
n,m
PWL approximation of the pressure drop function
Gas-liquid ratio of flows in the jumpers
Binary variable with routing from well n to manifold m
SOS2 variable for jumper oil flow rate breakpoints
SOS2 variable for jumper gas-oil ratio breakpoints
SOS2 variable for p\mathrm{d}s breakpoints
m
PWL approximation of the pressure drop function \Deltap Manifold pressure
Gas-oil ratio of fluids received by manifold m
Weighting variable for the PWL approximation of \Deltap
SOS2 variable for the flowline liquid flow rate breakpoints
\delta
SOS2 variable for flowline gas-oil ratio breakpoints
SOS2 variable for flowline water-cut breakpoints
Table 3.5: Functions of automatic routing MILP model
Function
Description
f
\widehatnmathrm{q}(Cj&gt;Pmathrm{w}h)
\Deltap"pm (Cr&gt;g°rn’m&gt;p\mathrm{d}s)
\DeltaP (qmmathrm{q},GORm,WCUTm)
Objective function - total oil produced
Well production function of well n
Pressure-drop in the well-manifold jumper (n, m)
Pressure drop in the manifold m flowline
The goal of the optimization problem is expressed in the objective function f as the maximization of the total oil produced in the manifolds:
m
max f =	qoil.
m \in\scrM
(3.10)
Although more complex objectives could be readily used by means of piecewise-linear approximation, oil production remains widely adopted arguably for being more easily measured in real-world settings.
The production of the wells is given by a piecewise-linear function which approximates the flow rates observed in the simulator, obtained by sampling the production functions for a sufficiently wide range of lift-gas rates
and well-head pressures. The well-production functions are approximated in the MILP formulation with the following equations:
For all n \scrN :
n	n	n \widetildeoil	\lambdaqi,Pk \cdot \widehatliq(qbpk) ’	(1 — WCUTn),	(3.11)
(qi,Pk)escrKn		
n	n	n \widetildegas	,pk \cdot \widehatliq(qbpk) ' (qi,Pk)inscrKn	GLRn + qT,	(3.12)
n	n	n \widetildewater	,p\ ’ \widehatliq (qi,pk, (qi,Pk)inscrKn	) • WCUTn,	(3.13)
nn qinj =	\lambdaqi,Pk ‘ (qi,Pk)escrKn		(3.14)
n	n	i	n.max pwh	\lambdaqi,Pk '	1 Pwh (qi,Pk)inscrKn	• (1 — ynX	(3.15)
n	n	n.max Pwh	\lambdaqi,Pk	— pwh (qi,Pk)inscrKn	• (1 — ynX	(3.16)
yn =	\lambdan\mathrm{i},Pk &gt; (qi,Pk)escrKn		(3.17)
\lambdan.,Pk	0, V(qi,pk)	\scrKn,		(3.18)
\xin. =	\lambdan.,Pk, w	\scrKn, PkinscrKn		(3.19)
\xiPnk =	\lambdan.,Pk,	\scrKn qiinscrKn		(3.20)
(\xin) crn , (C) care SOS2. SqVqjinscrKp &gt;	V-'PkEscrKp		(3.21)
The well production approximation equations are not omitted here for clarity reasons, although they are quite similar to the PWL approximation of the flow splitting phenomena. Notice that the main differences appear in Equations (3.15)--(3.16) which now have a big-M term to relax the well-head pressure in case of a well shut-in.
Binary variables (yn) are introduced to express the possibility of shutting in wells, a procedure that may be required for operational reasons or to improve overall system production. When a well is active (yn = 1) its production is bounded by operational limits:
ynqn,L &amp;lt;qn	qn,Uyn, \foralln	.	(3.22)
The well-manifold flow paths are determined by the binary variables zn,m. Notice that the algorithm will decide upon single or multiple routing. Routing from well n to manifold m (zn,m) can only be active when the well
is producing (yn = 1). Otherwise (yn = 0), the routing from this well is disabled (zn,m = 0, \forallm \scrMn).
In order to account for the manifold pressure variation in the model, the pressure drops become also dependent of the pressure downstream the choke (p3s). The pressure drops Ap\mathrm{j}p’ ( q^q™, GORn,m, p\mathrm{d}\mathrm{s}) in the jumpers are approximated in the MILP formulation by:
For all n \scrN, m	\scrMn :
n,m	= £ («i,gor,Pds)escrR	/ n,m \phiqi,gor,Pds ‘	n,m \DeltaPjp wng^Pdsh	(3.23)
n,m qoa =	= sum («i,gor,Pds)escrRn’	/ n,m \phi«i,gor,Pds ' gl	• (1 - WCUTn),	(3.24)
n,m gmathrm{g}mathrm{a}s	= sum (®,gor,Pds)escrRn’	/ n,m \phi«i,gor,Pds ' gl	■ (1 - WCUTn) • gor,	(3.25)
n,m g\mathrm{w}mathrm{a}ter	= sum Oi ,gor,Pds)escrRr	\cdot gl \cdot WCUTn,		(3.26)
n Pds	sum (®,gor,Pds)escrRn,m	z n,m \phiqi,gor,PdB ' pds	1 pn&gt;max . (1 _ z	) + pds	(1	Zn&gt;m),	(3.27)
n Pds	sum	/ n,m \phiqi,gor,PdB ' pds	n.max - pds	(1 - zn,m),	(3.28)
(.9i,9°r,pdB)escrRn’'
GLRn +	\lambdan ,P\mathrm{k}
(«i,Pk)escrKn
&amp;lt;GLRn,max(1 - zn,m)
gi
\widehat. g--/p
+	£	\phinr9or,pdB \cdot gor \cdot (1 - WCUTn)
(«i,9or,Pds)escrRn,m
(3.29)
GLRn + sum \lambdan ,P\mathrm{k}
gi
(qi,Pk)escrKn
,	,&gt; -GLRnmathrm{m}mathrm{x}(1 - Znm)
£
+
\cdot gor ■ (1 - WCUTn)
(qi,gor,Pds)inscrRn’m
(3.30)
zn,m
n,m \phiqi,gor,Pds ,
(3.31)
£
(qi,gor,Pds)inscrRn’m
0, V(gi,gor,pds)	\scrR
zn,m	yn) \forall'm
n,m
(3.32)
(3.33)
n,m
\etaqi’
En,m
\phiqi,gor,Pds ,
\forallgi	\scrRn,m,
(3.34)
n,m
\etagor
En.m	n,m
\phiqi,gor,P\mathrm{d}s, vgor	\scrRg ,
(3.35)
£
£
n,m	n,m	n,m
\etaPd, =	\phiqi,9or,pds , \forallpds 6 \scrRp ,	(3.36)
1 (Cm)gore\scrRn&gt;™ &gt; and (CT)PdBe\scrRn’™ are SOS2.
(3.37)
Notice that the pressure-drop approximation equations are similar to the PWL approximation developed in the splitting model with small changes to handle the routing decisions (zn,m).
The mass balance of flows produced by the wells and split to the manifolds are imposed by the following vector constraints:
\bfqn =	qn,m&gt;	\in\scrN,	(3.38)
\bfqm =	\bfqn’m&gt; Vm \scrM.	(3.39)
Each manifold can handle certain rates of oil, gas, and water which are honored by constraints bounding all of the phase flows:
qm &amp;lt;qm’max, \forallm	\scrM.	(3.40)
The platform limits on compression, liquid handling, water treatment, and gas-lift are imposed as bounds on the total production of gas, liquid, and water:
For all m \scrM :
m	max qgas	qg	,	(3.41)
m 1	m	max (qoil + qwater)	ql	,	(3.42)
m	max Qwater — qw	,	(3.43)
n	max qinj	qinj . n\in\scrN	(3.44)
Pressure constraints on subsea equipment are then established:
For all n \scrN :
Pwh	- Pmathrm{w}imathrm{m}aX (1 - yn),	(3.45)
pnmathrm{s}	Pm	+	+pnrmathrm{x} (1 -	zn,m),	(3.46)
pnmathrm{s}	Pm	+	- pnrmathrm{x} (1 -	^n,m),	(3.47)
■	.	(3.48)
A High-Integrity Pressure Protection System (HIPPS) ensures the safety of the production system, establishing a bound (pmathrm{h}i’mathrm{m})mathrm{a}x) on the pressure
downstream the choke. Notice that the difference between the well-head pressure (p\mathrm{w}\mathrm{h}) and the pressure downstream the choke (p\mathrm{d}s) gives the pressure loss in the choke.
Pressure drops in the flowlines, which rise the production from manifolds to platforms, are calculated by a PWL approximation of the pressuredrop function Apm(qim1, GORm, WCUTm):
For all m \scrM :
m \Deltap	\OmegaQliq,gor,wcut \cdot \Deltap	(qliq, gor, WCUt^, (qiiq ,gor,wcut)\in\scrQm	(3.49)
m 9oii =	\Omegaqliq,gor,wcut ’ qliq ’ (1	wcut)j	(3.50)
	(qiiq,gor,wcut)\in\scrQm	
qgas =	\Omegaqmathrm{l}\mathrm{n}mathrm{q},gor,wcut ' qliq ’	' (1	wcut),	(3.51)
	(qiiq ,gor,wcut)\inQm	
qwater	\Omegaqiiq,gor,wcut ’ qliq ’ wcutj (qiiq ,gor,wcut)\inQm	(3.52)
m yman —	\Omegaqiiq ,gor,wcut j (qiiq ,gor,wcut)\in\scrQm	(3.53)
\Omegaqiiq,gor,wcut	0j V(ql\mathrm{i}qj	wcut) \scrQ , zn,m	ymanj	\scrNm j	(3.54) (3.55)
\deltaqiiq	y &gt;	\Omegaqumathrm{q},gor,wcutj gor\in\scrQm wcut\in\scrQm	(3.56)
\deltagor	\Omegaqumathrm{q},gor,wcutj qiiq\in\scrQm wcut\in\scrQm	(3.57)
\deltawcut	\Omegaqiiq,gor,wcut j qiiq\in\scrQm gor\in\scrQm	(3.58)
(Cq)	po j (\deltamor)goreeg j (\deltamcut)wcuteew	SOS2	.	(3.59)
The binary variable y\mathrm{m}an denotes the activation of manifold m. Notice that the pressure drop in the flowlines depend on the liquid flow rate and the proportions of gas and water of the mixture. The manifold pressure (pm) must be equal to the separator nominal pressure (pm,s) to which it is connected plus the pressure drop in the flow m line (\Deltap ):	
pm = pm,s + \Deltap , \forallm \scrM.	(3.60)
Putting all together, the problem of allocating pressurized gas and deciding upon the routing of wells to separation units is expressed in a compact
form as:
P :
max f =
s.t. : Constraints (3.11)-(3.21), Constraint (3.22),
Constraints (3.23)-(3.37),
Constraints (3.38)-(3.39),
Constraint (3.40),
Constraints (3.41)-(3.44),
Constraints (3.45)-(3.48),
Constraints (3.49)-(3.59),
Constraint (3.60).
3.4 MODEL SYNTHESIS AND COMPUTATIONAL ANALYSIS
This section evaluates the developed framework for flow splitting in a representative offshore oil field, which operates with gas-lift, allows splitting of flows, and is further constrained by physical and operational constraints. A methodology is proposed for the synthesis of piecewise-linear models that satisfactorily approximate the nonlinear process functions.
3.4.1	The Gas-Lifted Oil Production System
The synthetic production system was inspired in [16, 38] and modeled in a multiphase-flow simulator, namely Schlumberger@ Pipesim. This system will serve as a testbed for model synthesis and computational analysis. Figure 3.6 illustrates the production infrastructure of this oil field.
The wells are topologically divided into three groups:
•	wells	1-2 are	1 km away from manifold 1 and 1.5	km from manifold	2;
•	wells	3-5 are	1 km away from both manifolds;
•	wells	6-7 are	1.5 km away from manifold 1 and 1	km from manifold	2.
The pipelines called jumpers are those connecting wells to manifolds, with 4 inches of ID, 0.25 inches of wall thickness, and 0.001 inches of R. The jumpers with 1 and 1.5 km of length are denoted by Ji and J2, respectively.
The pipelines called flowlines are the ones sending the production of the manifolds to the platforms. All pipelines have 5.5 inches of inner diameter, 0.5 inches of wall thickness, and 0.001 inches of roughness. The flowlines Fy and F2 have 2.5 km and 2 km of length, respectively. Each manifold has a dedicated platform for sending production. Manifold 1 is connected to the platform by pipeline Fy, while manifold 2 is connected to its dedicated platform by pipeline F2.
Some assumptions were made on the field simulation model: the reservoir has a constant pressure; GLR and WCUT of wells do not vary during the optimization process; after well flow is split, resulting flows have the
Figure 3.6: Production system network with gas-lifted wells.
same GLR of the flow before splitting. The liquid flow rate of wells behaves according with the equation qi = pi(pr — pwf) where pwf is the bottom hole pressure, pi is the well production index, and pr is the reservoir static pressure. Well parameters such as GLR, WCUT, pr, and pi are shown in Table 3.6, with the units being sm3/sm3, %, psi, and STB/d/psi, respectively.
Table 3.6: Well parameters for flow splitting analysis.
well	GLR	WCUT	pr	pi
1	70	1.00	2400	22
2	52	2.00	2650	25
3	62	1.00	2550	29
4	60	1.50	2500	30
5	65	2.00	2450	27
6	70	1.50	2600	31
7	55	1.50	2350	23
The absolute pressure in the manifolds ranges from 275 to 575 psi depending on the operational conditions, while the nominal pressure at the separators located in platforms 1 and 2 are 125 and 150 psi, respectively.
3.4.2	Model Synthesis
This section presents a procedure to synthesize mathematical models for well-production and pressure-drop functions adjusted for the synthetic production system. The procedure consists of analyzing the errors of each approximation by comparing the sampled function values and the values calculated by the mathematical model.
Grid-Fitting Procedure
In [38], it is shown that the errors in the optimizer variables can be reduced by introducing more breakpoints in the piecewise-linear approximations, with the disadvantage of increasing computational time and complexity of the resulting problem. This process was generalized by [40] with the development of a simple off-line procedure to reduce the discrepancy between optimizer predictions and simulator estimates.
Although these methods can improve the quality of approximation, they usually increase excessively the model complexity, because unnecessary breakpoints are added to the domain in each step. In this dissertation, we propose a heuristic procedure based on an algorithm proposed by [37] to obtain suitable approximations for optimization purposes. The procedure is outlined in the following steps and illustrated with the example depicted in Figure 3.7:
1.	Figure 3.7(a) presents a two-dimensional domain with 4 polytopes, namely \scrP = {Pi, P2, P3, Pi} for a given piecewise-linear approximation /(x) of a nonlinear function f (x). This approximation is given as input for the refinement procedure.
2.	Figure 3.7(b) illustrates the refinement step performed by the gridfitting procedure. The functions values f (x) of central points (x1,\=1), (x2,\=1), (x1 ,y2), and (x2,y2) are sampled from the simulator. The function values of the piecewise-linear approximation /(x) are then calculated for the same points by the convex combination of corner vertices. The relative error is obtained by measuring the deviation of the approximation in each polytope:
\varepsilonp = \f(xi,yj) - f	y)l
f (xi,y2)
i1,2\}
If the maximum error max{£P1, \varepsilonP2, £2,1, \varepsilon2,2} is lower than the tolerance, then no breakpoints are introduced and the PWL approximation is considered satisfactory for optimization purposes. Otherwise, new breakpoints are added in the polytopes where the estimated error is higher than the tolerance.
3.	Figure 3.7(c) shows the resulting domain after the refinement step is performed for an approximation in which only polytope P3 presents
Figure 3.7: Procedure to refine piecewise-linear functions.
an estimated error higher than the tolerance. This polytope was subdivided into 4 polytopes {P3a, P3b, P3c,P3d}, while polytopes P1 and P4 were subdivided into {P1a, Pu} and {P4a, P4b}, respectively. The subdivision of polytopes P1 and P4 is due to the introduction of the new breakpoints X1 and y2 in the PWL approximation, which is composed of the Cartesian product of all breakpoints from both axis. The subdivision of only polytope P3 would be possible with other models for PWL such as CC and DCC [18], instead of SOS2 constraints.
This procedure is a simple way for estimating the approximation error of a general PWL function with hypercube domains. It can easily be extended to higher order and different domains.
Model Analysis
The grid-fitting procedure is now used to obtain suitable approximations for the synthetic production system. The well-production function qmathrm{o}ii was approximated with the procedure illustrated above, while the pressure drops Apjp and Ap were approximated with an extension to threedimensional domains.
The initial approximation for the well-production \widetildemathrm{o}il has 5 breakpoints in both domain axes: lift-gas rate and well-head pressure. Table 3.7 shows the errors of the final approximations according with the fitting procedure.
| and |^Pk | are the number of breakpoints for lift-gas rate and wellhead pressure, respectively. The approximations of well-production functions have a maximum error of 1.86%, mean error and standard deviation are less than 0.50%.
,m
The starting domain of the jumper pressure-drop functions Ap^p contains 125 points with 5 breakpoints in each axis (i.e., ql, gor, and pmathrm{d}s). Table 3.8 shows the resulting errors of the approximations produced by the fitting procedure. The number of breakpoints for liquid flow rate, gas-oil ratio,
Table 3.7: Well-production approximations						
Well	\\scrKl\	\\scrKP \	Max Error	Mean Error	Std. Deviation	Iterations
1	13	15	1734%	0728%	0T29\mathrm{G}	5
2	9	11	1.67%	0.43%	0.38%	4
3	9	9	04%	0725%	0)25%	4
4	13	15	1.12%	0.33%	0.33%	5
5	9	9	1786%	0. |5M	0.	4
6	5	5	0.73%	0.26%	0.26%	2
7	5	5	1760%	0744%	0)44%	2
and pressures downstream the choke are represented by the cardinality of the sets |\scrRy"'|. \scrR | , and |	|, respectively. The final approximations have
a maximum error less than 1.88%, and a mean error under 1.30%, which are smaller than the tolerance of 2.00%. Notice that the approximations for the pressure drops in the jumpers were obtained with fewer iterations than the approximations for the well-production functions.
Table 3.8: Jumper pressure drop approximations
Well	Man.			\\scrRmathrm{p}’m\	Max Err.	Mean Err.	Std.	It.
1	1	9	9	9	1749%	086%	0733%	3
	2	9	9	9	1.54%	0.90%	0.34%	3
2	1	9	9	9	1T6T\mathrm{G}	0795%	0737%	3
	2	9	9	9	1.63%	0.96%	0.36%	3
3	1,2	5	5	5	1715%	0774%	0725%	2
4	1,2	9	9	9	1760%	0798%	0737%	3
5	1,2	5	5	5	1741%	0787%	0732%	2
6	1	9	9	9	TT63\mathrm{G}	0796%	0735%	3
	2	9	9	9	1.48%	0.87%	0.31%	3
7	1	9	9	9	1.88'1	1.301	0743%	3
	2	9	9	9	1.48%	0.87%	0.31%	3
Finally, Table 3.9 shows the approximation erros of the pressure-drop "
\Deltap functions in the flowlines. ¡Qi"l, |\scrQ"" |, and |\scrQ""| are the number of breakpoints for liquid flow rate, gas-oil ratio, and water cut values. The maximum errors are small (&amp;lt;0.3%), while the mean errors and standard deviations are negligible (&amp;lt;0.03%). For these approximations only 2 iterations were needed to reach an approximation with small errors.
Table 3.9: Pressure drop approximations in the flowlines
Manifold |\scrQ" |	|\scrQ" |	|Q" |	Max Err. Mean Err. Stds. It.
F1	5	5	5	0.29%	0.007%	0T3%	2
F2	5	5	5	0.09%	0.004%	0.02%	2
The grid-fitting procedure was able to find approximations with errors within the tolerance for the well-production and pressure-drop functions, after a small number of iterations. This result shows that the final approximations are representing the well-production and pressure-drop functions satisfactorily.
3.4.3	Computational Analysis
This section presents a computational analysis to assess the performance of the MILP formulation developed for the production optimization problem, which considers the influence of flow splitting. The production system presented in previous section will serve as the testbed for the experiments.
An MILP formulation was developed using the flow splitting model to optimize the daily production of the synthetic field presented in previous section. For the purpose of comparison of MILP formulations with and without flow splitting, a standard single routing model was developed by introducing a new constraint on the binary variables zn,m, which denote the activation of routings from wells to manifolds:
zn,m	1, \foralln \in\scrN.	(3.61)
Both formulations were expressed in AMPL [41] and solved with the MILP solver CPLEX 12.6 in a Linux workstation, using an Intel Xeon E5-2665 processor at 2.40 GHz and 40 GB of RAM. After the pre-solve step, the resulting formulations have the following properties:
•	Automatic routing: 10 060 variables, with 14 being binary, 794 linear constraints, and 62 SOS2 constraints.
•	Single routing: 10 060 variables, with 14 being binary, and 801 linear constraints, and 62 SOS2 constraints.
Notice that with automatic routing, the formulation for the production optimization problem will decide for each well on the splitting of flows (whether its production will be sent to one or more manifolds), whereas single routing will force the production to flow to a single manifold.
The analysis evaluates the performance of both automatic and single routing models for three availabilities of gas-lift:
•	High: the available gas rate is sufficient to inject the maximum rate allowed in all wells simultaneously (24 500 sm3/d).
•	Medium: the average gas rate availability (15 500 sm3/d).
•	Low: smallest gas rate availability which enables the opening of all wells (14500 sm3/d).
All experiments ran within a time limit of 30 minutes. Table 3.10 shows the results obtained by the automatic and single routing formulations.
Table 3.10: Computational results
Solving Statistics
Gas-lift	Routing	Oil Production	Time (s)	Nodes	GAP (%)
	Automatic	2 561.82	82.32	12 490	0.00
High	Single	2523.53	140.34	20836	0.00
t\ r t	Automatic	2 556.97	1800	470867	0.20
Medium	Single	2506.64	106.88	19 336	0.00
	Automatic	2 523.61	1800	196 403	1.52
Low	Single	2 482.76	36.74	18146	0.00
With the increase of the lift-gas availability, the optimal oil production increased slightly for both formulations. All solutions found by the automatic routing model induced splitting of flows and yielded higher oil production rates (1.50% — 2.00%) in comparison to the single routing. The single routing model was faster for the scenarios with medium and low availability of ga-lift, requiring a reduced number of branch-and-bound nodes to reach the optimal solution. The automatic routing model reached the optimal solution faster in the scenario with high availability of gas-lift. For low and medium lift-gas availabilities, the automatic routing model did not reach the optimal solution within the time limit of 30 minutes. However, the best feasible solutions found for such scenarios rendered higher oil production rates than the optimal solutions found by the single routing.
To further illustrate the optimization results, Table 3.11 presents the well settings for both single and automatic routing models for the scenario with high gas-lift availability. This scenario was chosen because both models were able to reach the optimal solution within the time limit. Both solutions
Table 3.11: Optimal solution per well for the single and automatic routing models with high gas-lift availability.
Well Single Routing	Automatic Routing
n		qf	q\mathrm{o}		qf	q\mathrm{o}
1	292.63	2530.10	345.70	294.01	3000.00	353.94
2	281.77	1682.99	293.61	283.85	1693.59	289.43
3	284.38	1659.17	375.81	272.45	3250.00	435.57
4	284.59	1667.92	305.35	283.66	1508.05	299.64
5	290.12	2129.08	334.39	287.28	1500.00	317.34
6	308.63	3330.73	491.75	308.17	2500.00	481.08
7	284.44	3500	376.93	271.91	3000.00	384.82
kept all choke valves fully opened, meaning that the pressures downstream the valves (p\mathrm{d}s) are equal to the pressures upstream the valves, i.e., the well-head pressures (p\mathrm{w}h).
In this scenario, the well-manifold routings suggested by the optimization models were quite different. The single routing model aligned wells 1,
2, 4, and 5 to manifold 1; and wells 3, 6, and 7 to manifold 2. On the other hand, the automatic routing model suggested different routes, some of them yielding flow splitting: wells 1, 4, and 5 aligned only to manifold 1; wells 2 and 6 aligned only to manifold 2; and wells 3 and 7 splitting their flows to both manifolds.
The flow distribution in the gathering network for both the single and automatic routing models is presented in Table 3.12. All flow rates are in standard cubic meter per day (sm3/d). Notice that the automatic routing
Table 3.12: Optimal flow distribution in the single and automatic routing models with high gas-lift availability.
Well n	Manifold m	Single Routing			Automatic Routing		
		n,m	n,m	n,m	n,m	n,m	n,m
	1	345.70	26973.40	3'.49	353.94	28926.10	T58
1	2	0.00	0.00	0.00	0.00	0.00	0.00
9	1	293.61	17262.10	5.99	0.00	0.00	0.00
2	2	0.00	0.00	0.00	289.43	17051.00	5.91
Q	1	0.00	0.00	0.00	181.88	12746.80	1.84
3	2	375.81	25194.60	3.80	253.70	17781.60	2.56
A	1	305.35	20267.90	4.65	299.64	19760.00	4.56
4	2	0.00	0.00	0.00	0.00	0.00	0.00
	1	334.39	24307.90	6.82	317.34	22548.00	6.48
5	2	0.00	0.00	0.00	0.00	0.00	0.00
	1	0.00	0.00	0.00	0.00	0.00	0.00
6	2	491.75	38277.30	7.49	481.08	36688.10	7.33
7	1	0.00	0.00	0.00	128.80	8233.32	1.96136
7	2	376.93	24547.00	5.74	256.03	16254.20	3.90
model induces flow splitting in wells 3 and 7, which yields a higher overall oil production when compared to the single routing model.
3.5 SUMMARY AND SYNTHESIS OF CONTRIBUTION
A mathematical model was proposed to represent the splitting of flows which is of particular interest in subsea operations. The splitting model was approximated by an MILP model based on multidimensional piecewise-linear functions and validated by contrasting its predictions against to what is observed in simulation software. An MILP formulation was developed for the problem of maximizing the production of a representative offshore oilfield subject to lift-gas distribution, pressure constraints, and multiple routing decisions. Further, a heuristic procedure was designed to obtain well-production and pressure-drop approximations with mean and maximum errors within a given tolerance. The model analysis showed that the approximation errors become smaller than the tolerance after a few iterations of the procedure. This result indicates that the flow-splitting model can accurately reproduce the phenomena observed in multiphase flow simulation. Finally, the com
putational analysis showed that the standard single-routing model is solved faster than the automatic-routing model, but the latter reached solutions with higher overall oil production rates.
While Chapter 2 discussed mathematical programming tools to approximate nonlinear functions appearing in the optimization of gas-lifted platforms, this Chapter advances previous works by modeling and optimizing the production of oil fields in which multiple routing and the splitting of flows might occur in subsea equipment, often yielding higher oil rates. The contributions of this Chapter can be summarized as:
•	A nonlinear model of flow splitting in subsea equipment of offshore production systems;
•	A PWL approximation model of flow splitting and its validation against simulation software;
•	A MILP model to optimize the gas-lift distribution of an offshore field which allows for multiple routing decisions;
•	A computational analysis of single and multiple (automatic) routing models;
•	A heuristic procedure (grid-fitting) to refine MPWL approximations.
4	NETWORK CONSTRAINED RESERVOIR OPTIMIZATION
Unlike the previous Chapters which focused on short-term production optimization, this Chapter focus on production optimization in the longterm, which extends from months to a couple of years. A methodology is proposed to optimize the recovery of petroleum reservoirs constrained by production gathering systems. Since full-field implicit simulations are prohibitively costly, reservoir management policies are typically developed with standalone reservoir models, while constraints with respect to the production gathering network are limited or fully disregarded. However, it is well known that the field operation is driven by platform settings and constraints imposed by the network and processing facilities. Therefore, the disregard of such constraints may render unfeasible operational plans in practice, precluding their application in real-world fields. In this dissertation, we propose to optimize oil reservoirs constrained by gathering networks with a multiple shooting formulation, which is a control method suitable for problems with numerous output constraints. This method splits the prediction horizon of the optimal control problem in several smaller intervals enabling the use of decomposition and parallelization techniques. The developed methodology is assessed in a two-phase black-oil reservoir producing to a gathering network with nonlinear constraints regarding the operation of electrical submersible pumps. To demonstrate the method’s capability to handle network constraints, the results of the network constrained approach are contrasted against the conventional unconstrained approaches which neglected the gathering network system. This Chapter is based on the following paper:
• Silva, T. L.; Codas, A.; Stanko, M.; Camponogara, E.; Foss, B. A. (2016): “Network Constrained Reservoir Optimization"". Submitted to the SPE Reservoir Evaluation Engineering Journal on June 2017.
4.1	INTRODUCTION
The overall benefit of a petroleum field is affected by both the reservoir performance and the deliverability of the production gathering network and surface facilities. But although these systems are intrinsically connected, they are often seen separately by researchers and practitioners. While reservoir engineers seek to maximize the Net Presente Value (NPV) of the field in the long-term, production engineers look for feasible strategies regarding the network infrastructure and processing facilities that maximize the daily or weekly production in the short-term. An accurate prediction of the production process requires full-field simulations, which involve the fluid flow in the reservoir and gathering network, thus an optimal integrated strategy can only be achieved by reconciling these two often conflicting goals.
The modeling and simulation tools used for long-term and short-term operations differ in time scale and complexity. On the one hand, costly numerical simulations are performed to forecast the dynamics within the porous media and the reservoir recovery for given well production schemes. However,
conventional reservoir simulation tools typically do not allow engineers to model a wide range of well and completion designs such as deviated wells and inflow control devices. On the other hand, because the dynamics of the reservoir are considerably slower than fluid flow dynamics in gathering networks, most network simulators often ignore flow transients and adopt steady-state models to represent the production process. Without an integrated strategy, optimal controls calculated with standalone models may render unfeasible operational plans, precluding their application in real-world fields.
Several works in technical literature address short-term optimization problems such as the gas-lift distribution problem with subsea routing and facility constraints [42]. Previous Chapters of this dissertation focused on short-term production optimization. While Chapter 2 addressed optimization tools such as piecewise-linear models to represent well production and pressure drops for short-term production optimization, Chapter 3 proposed a model for flow splitting in subsea equipment of offshore production systems. A brief literature review on short-term production optimization can be found in Section 2.4. Although these approaches may increase production or reduce operational costs in the short-term, they do not account for the impact of the drainage of the reservoir on the NPV - the long-term goal, which may compromise the economic life-cycle performance of the reservoir.
Differently from the methods for short-term production optimization, from the long-term perspective, a control method that has been successfully adopted by researchers and practitioners is the Closed-Loop Reservoir Management (CLRM) [43, 44, 45]. This method combines periodic calibration of process models with measured data, and control optimization relying on field simulations to forecast and analyze oil-recovery strategies. The model update part is known as history matching, while the control optimization part is referred to as reservoir optimization. A particular reservoir optimization problem that is widely employed to improve recovery of oil reservoirs and which is addressed in this dissertation is water flooding. It consists in determining water injection strategies to push additional oil towards producing wells and to maintain a steady pressure in the reservoir. With the right choice of well targets the reservoir recovery factor can be considerably increased.
Water flooding optimization relies on accurate simulation of the recovery process, which is typically computationally expensive since it requires the solution of a system of partial-differential equations discretized in time and space [46]. For fully implicit models, the reservoir states are obtained by performing iterative calculations of fluid flow in porous media to the convergence of mass balance and pressure equations with a high degree of accuracy. The complexity of the reservoir model is thus inherited by the optimization problem because, at each iteration, the optimizer might require several simulation runs. One approach to tackle this problem is the Single Shooting (SS) method. With SS, the optimizer first computes the controls which comprise the space of decision variables and then simulates the control profile to obtain the corresponding states and algebraic variables [47]. Typically, the gradients
of constraints and objective with respect to the controls are calculated with the adjoint method, which is an efficient alternative to direct methods when the number of decision variables is large. A review of SS methods for reservoir optimization can be found in [48].
One challenging aspect regarding reservoir optimization is the handling of output constraints, which ensure that the field production meets processing limits on the surface facilities and the wells operate without damaging the formation [49, 44, 50]. However, such methods typically do not account for fluid flow interaction between the reservoir and the production gathering system, disregarding network constraints that could render the proposed plans infeasible in practice [51]. During the life cycle of petroleum fields, the pressure required by the production gathering system will significantly impact on well productivity, specially in offshore fields which typically produce to complex networks.
One alternative to deal with output constraints is the adjoint gradient computation together with the Augmented Lagrangian method [52, 51]. However, this method may be difficult to tune with a large number of output constraints. Recently, the reservoir optimization problem was tackled with the Multiple Shooting (MS) method [53]. In this approach, the production horizon is divided into several time frames or shooting intervals, each of which contains independent initial conditions for state and control variables. This method allows to enforce output constraints because intermediate states and controls are explicitly given in the mathematical formulation, becoming available during the optimization. Since the production horizon is divided in several independent intervals, network constraints can be instantiated in parallel to ensure the consistency of the long-term strategy with the gathering network system, similarly to the way constraints are handled in short-term optimization.
In this Chapter, a MS formulation is proposed to reconcile the shortterm and long-term strategies with a methodology that takes into account network constraints in reservoir optimization. The MS formulation together with a gradient-based optimization method enables the use of parallelization techniques and a scalable method to handle output constraints arising from the production gathering network. Further, while the fluid transients are represented in the reservoir domain, fluid flow is assumed to be at steadystate conditions in the production gathering network. Main goals of this Chapter are:
•	A framework to model fluid flow from the reservoir to production gathering networks at steady-state conditions;
•	A methodology to account for network constraints in water-flooding optimization using a scalable gradient-based method;
•	Numerical and simulation analyses of network constrained reservoir optimization strategies.
The rest of this Chapter is organized as follows. The following Section presents a brief literature review on the coupling of network and reservoir
models. Section 4.3 presents models and simulation methods for reservoir and production gathering networks. Section 4.4 presents a MS formulation for reservoir management which accounts for network constraints. Section 4.5 presents a numerical and simulation analysis of water-flooding problems constrained by the network. Section 4.7 presents a summary of the results and a synthesis of the contribution.
4.2	BRIEF LITERATURE REVIEW
Several works have addressed the coupling of network and reservoir models. Gokhan et al. [54] developed an implicit coupling of a 3D black-oil reservoir simulator with a general-purpose network simulator. Schiozer [55] proposed a domain decomposition strategy to improve performance of implicit full-field simulations. Tingas et al. [56] developed an integrated reservoir and surface network simulation to improve production management of gas fields in the North Sea. Kosmala et al. [57] developed a coupling control tool for reservoir and production management of an integrated production system. Davidson and Beckner [58] connected a facility network model with an inhouse reservoir simulator using an explicit coupling in which the reservoir conditions are held constant at the beginning of each time step. Coats et al. [59] modeled and formulated a black-oil and compositional fully coupled surface and subsurface simulator. Rahmawati et al. [60] coupled a network simulator with a reservoir simulator to optimize the integrated production using a derivative-free method. Gao [61] investigated the effects of coupling surface and subsurface models on production forecast. Such approaches for coupling reservoir and network simulation models vary in terms of the degree of accuracy and computational effort, which may become prohibitive for complex production systems.
4.3	PETROLEUM PRODUCTION PROCESS
The production process of hydrocarbons involves fluid flow in the reservoir, wells and gathering network system. The governing laws and dynamics in the reservoir are described with a set of differential equations and some boundary conditions, while the fluid flow in the production gathering network is represented with a set of equations ensuring mass and momentum balance. The network flow is assumed at steady-state conditions since the dynamics of fluids flowing in the reservoir are considerably slower than the transients of the fluids in the network. Since Electrical Submersible Pump (ESP) models are used in the examples that will be presented afterwards and since these represent complex nonlinear constraints, as opposed to for instance a pressure drop constraint, they are presented in some detail.
4.3.1	Reservoir Model
The reservoir model consists of a set of differential equations representing the simultaneous multiphase fluid flow in a porous medium. An undersaturated oil reservoir model was adopted in this dissertation, which means that pressure remains above the bubble point pressure during the whole prediction horizon, thus there is no gas liberation from the oil in the formation. The fluid model employed is of black oil type and the solubility of water in the oil and gas phases is neglected. Based on the mass conservation principle, the Darcy law and the capillary pressure physical principle, the set of differential equations which describes the fluid flow in porous media is [46]:
= nabla (TPnabla\PhiP) + TTp,	escrP,	(4.1a)
\bfTP =	. k,	p e scrP,	(4.1b)
P'p-Dp
\PhiP = pp - -\rhorllsll^&gt;	peP,	(4.1c)
Sw + So = 1,	(4.Id)
Pc,w = Po - p-w,	(4.1e)
where:
•	&lt;f&gt; is the rock porosity.
•	Sp is the saturation of phase p.
•	Bp is the formation volume factor of phase p.
•	qp is the standard volumetric flow of phase p which can be injected or produced by the wells.
•	P = {o, w} is the set of phase flows, namely o for oil and w for water phase.
•	kr,p is the relative permeability of phase p.
•	pp is the viscosity of phase p.
•	k is the reservoir-rock absolute permeability.
•	pp is the absolute pressure of phase p.
•	pp is the density of phase p at standard conditions.
•	||g| | is the absolute value for gravity.
•	z is the height value, with the same direction of gravity.
•	Pc,w is the capillary pressure difference between oil and water phases. This set of equations is valid in the reservoir domains Q C R3. Eq. (4.1a) is the mass conservation equation for each phase flow. Eq. (4.1b) defines the transmissibility of the fluid Tp, which is a measure of the fluid ease to flow,
varying with the fluid mobility . Eq. (4.1c) defines the phase potential, which determines the flow directions. Eq. (4.1d) defines that the wetting and nonwetting phases jointly fill completely the void volume of the porous medium. Eq. (4.1e) defines the capillary pressure as the difference between the pressure of oil and water phases. Notice that the pressure in the wetting fluid is less than that in the nonwetting fluid because of the curvature and surface tension of the interface between the two phases.
Eq. (4.1a) is discretized in space and time with the control-volume finite element method [46] and backward Euler implicit-integration scheme respectively. Well equations are introduced to represent the fluid flow in the well grid blocks accordingly [62]. The solution of this system of equations is the reservoir simulation output, i.e., the well flows qp and pressures, and the pressure of oil po and saturation of water Sw in the time range (t0,tf) for given initial conditions po(to) and Sw(t0).
Boundary conditions are established for the reservoir simulator both on well flows and bottom-hole pressures, which are corrected with Newton steps. In every iteration, first, pressure conditions are imposed, and then the rates are calculated. If the rates are higher than the specified rates, the pressures are increased until the specified rates are delivered; otherwise, the pressures are used as boundary conditions. There are also no-flow boundary conditions which are imposed on the cell walls located at the periphery of the reservoir.
Reservoir Simulation
The reservoir model is implemented in the fully implicit black-oil solver Matlab Reservoir Simulator Toolbox (MRST) which is suitable for developing new simulation and optimization methods [63]. The reservoir domain Omega is divided in a set of grid blocks \scrG according with the spatial discretization scheme. The state variables xk denote the pressure of oil (p\bfv) and saturation of water (S^) in the grid blocks at each time instant k G \scrK. To improve the notation readability, algebraic variables vk are introduced to the formulation to denote system features which are not part of the reservoir state. These variables represent the bottom-hole pressures and phase flow produced or injected by the wells.
The simulation is performed for given reservoir initial conditions \bfxk-1 = (p\bfv,S^),i G \scrG at the beginning of each time step. The MRST solution for the simulation step consists of the state xk = (p\bfv, S^) ,i G \scrG, and algebraic variables vk = (qW ,pWh) , p € \scrP, w G W at the end of the time step that satisfy the set of equations: s
0 = R\mathrm{c} (\bfxk-i, \bfxk, \bfvk)	(4.2a)
0 = Qw(\bfxk, \bfvk)	(4.2b)
0 = B(\bfvk, \bfuk)	(4.2c)
where:
•	\scrW is the set of wells and \scrGw is the set of grid blocks containing perforations of well w G \scrW.
•	Rc(-) is the system of equations (4.1a)-(4.1e) after discretization in time and space, and inclusion of well equations.
•	Qw(•) models the total well rates as the contribution of different inter-
vals of perforations within the same wellbore in the reservoir. It relates the algebraic variables denoting well flow variables \bfvk to the their corresponding perforation flow variables. The total well flow is attributed to the summation of perforation flow rates of the well: 0 — q'^p —	Qp,k,
iesw
p E \scrP, w G \scrW, where qp,k is the flow of phase p in the perforated grid blocks i at time instant k, and q^p is the total flow of phase p of well w.
•	B(-) links the well algebraic \bfvk to the corresponding well control targets uk. Typically the well control is a fixed bottom-hole pressure or a constant flow rate during the time step.
MRST solves iteratively the system of equations (4.2a)-(4.2c) with the Newton-Raphson method. Most computational effort inherited by the optimization problem lies on the solution of this system of equations, thus an efficient approach is key for the success of the methodology. Although implicit formulations allow arbitrarily large time steps because stability is ensured, there is a limitation on the time step size due to accuracy requirements. We adopted the IMplicit Pressure-Explicit Saturation (IMPES) scheme, meaning that pressure and saturation equations are solved separately, which allows for an implicit update of pressures and stable explicit update of saturations for the same time step size.
4.3.2	Network Model
Fluid Flow in Production Gathering Network
The study of flow performance in gathering networks relies on models that implement mass, momentum and energy conservation equations. Additionally a fluid model relates fluid properties with certain pressure and temperature conditions. The equations that describe the multiphase flow at steady-state conditions in production networks are derived in what follows.
Depending on the pressure and temperature conditions, gas flows might appear even in systems producing two-phase fluids at surface conditions. For this reason, an important aspect in multiphase flow is accurate identification of different flow regimes, i.e., geometrical distributions of gas and liquid mixtures such as bubbles or slugs in liquid, liquid droplets in gas, or segregated liquid and gas layers. These flow regimes impact on the pressure drops in the flowlines of the production system [64, 65]. Another key effect is the occurrence of slip between the liquid and gas phases caused by the different velocities between the phases, where typically liquid flows slower
than gas. When there is slip between the phases, the pipe volume may be mostly occupied by liquid (i.e. high liquid holdup) which causes additionally hydrostatic pressure losses due to high mixture density.
In an attempt to reduce complexity of representing mixture flow, the multiphase flow dynamics can be represented in separate equations for gas and liquid phases, and common force terms at the interface. This approach yields realistic results for flow regimes with a very distinct inter-phase such as stratified flow. However, for other flow regimes that do not have a sharp interface, this two-fluid model becomes too complex thus a different approach is followed. Herein, a dynamic model of mass and momentum equations is derived with a semi-empirical method for the gas-liquid mixture, considering additional closure equations which relates the mixture and single phase velocities with their corresponding densities [66]. The governing equations for two-phase flow are:
\partial(\rhom\num)   \partial\rho "
ds	\partialt
\partial(\rhom\num)	\partial(\rhom\num)	\partialp | Fg Ff
\partials _ \partialt	\partials + ~A + ~A
\rhom
\num
\rhog
\rhoo
Pm (\rhog, Pl) \num(\nug, \nul )
pg,sc + rs ' \rhoo,sc
Bg
Rs ' \rhog,sc T
o,sc
(4.3c)
(4.3d)
(4.3e)
(4.3f)
B
o
where:
•	\rhow, pg, and po are the densities of water, gas and oil, respectively.
The densities of oil and gas at surface conditions are po,sc and pg,sc. The water density \rhow is assumed constant in the production system regardless of the pressure and temperature conditions. The liquid density \rhol is determined with the aid of the liquid mixing rule: \rhol _ fo • \rhoo + fw •	, where fo and fw are the oil and water volume fractions,
respectively.
•	\num, \nug, and \nul are the fluid velocities of the mixture, gas, and liquid flow respectively.
•	Bg is the wet gas formation volume factor; Bo is the oil formation volume factor; Rs is the solution gas ratio; and the solution oil-gas ratio rs. These are parameters from the volatile black oil model which is a two-component model that accounts for compositional variation in volumetric properties in both the oil and gas phases. Such parameters are a function of pressure and temperature conditions, meaning that they are part of the Equation of State (EOS) model of the fluid and can be obtained from collected data and black-oil correlations.
Eq. (4.3a) is the mass conservation equation. The momentum conservation is expressed in Eq. (4.3b). Density and viscosity of the mixture are obtained with Eqs. (4.3b) and (4.3c) respectively. The fluid behavior was expressed in terms of volatile black-oil properties, as expressed in Eqs. (4.3e) and (4.3f).
Assuming steady-state flow and that there is no change in oil composition, meaning that a black-oil model is used, the pressure profile with the spatial position s of the pipeline can be written as [67]:
dp ds
p	dv
= — Sln \theta — 2dfv|v|— \rhoVTs
(4.4)
where:
•	The first term is the head loss or gravity loss which is the static change in pressure caused by the change in the pipe’s elevation. In vertical pipelines, it is usually the most important component, but can be neglected in near-horizontal pipelines.
•	The second term refers to the frictional loss which is caused by the dissipation of energy by viscous forces in the fluid. This value changes with fluid properties, flow regimes and fluid velocities.
•	The third term represents the acceleration loss which is caused by changes in fluid momentum in the well during the expansion phase. Typically this term is less important, but it might be more relevant for wells with high gas-liquid ratio.
The friction factor f was estimated using a correlation from the Moody chart [68], after calculating the slip between the liquid and gas phases and the liquid holdup with a correlation for inclined pipes proposed by [69]. An implicit Colebrook equation can be adopted to calculate the friction factor for turbulent flow regions [70]. A comprehensive study of several correlations for determining fluid properties, flow regimes and pressure gradients in inclined pipelines can be found in [66].
Electrical Submersible Pumps
Multiphase flow in production networks relies on accurate calculations of fluid properties, geometrical flow patterns and pressure drop gradients in the pipelines of the production gathering system. However, other equipment in the network such as compressors, pumps and chokes may also impact on the productivity of the system. An ESP is a particular type of equipment which has been used as an artificial-lift mechanism to improve production from fields with complex wellbore environments.
An ESP is a multistage centrifugal pump which is installed at the bottom of a well to improve performance or to enable the production from reservoirs with heavy or viscous fluids. An ESP consists of a motor powered by an alternating electric current from the surface that spins a pump at the
Figure 4.1: ESP-lifted well [3].
bottom of the well lifting fluids to the surface. The power source at the surface may operate at a fixed frequency, or it can be adjusted over a range of frequencies using a variable speed drive that alters the frequency of the current and thus the rotational speed of the pump.
A mechanical layout of an ESP-lifted well is shown in Figure 4.1. The ESP is hosted in a casing which is placed inside the tubing, close to the bottom-hole of the well. The height H1 represents the length of the casing holding the ESP, and H2 is total depth of the well down to the producing formation. The pipe sections H1 and H1 — H2 might have different features and thus in mathematical models they can be modeled as different pipes with a connection downstream the pump casing.
The relationships in the wellbore and gathering network are described in terms of pressures and flow, which is convenient because producing formations are driven by pressure. In centrifugal pumps, however, the performance is usually described using head, i.e., the elevation difference between the liquid column at the inlet and the outlet. Thus the pressure difference delivered by the pump is calculated by multiplying the head times the density of the pumped fluid. For a given ESP pumping a fixed flow rate at a specific rotational speed, the output head is constant regardless of the density of the fluid being pumped. However, the pressure output and the shaft horse power required to drive the pump will change in direct proportion to the density of the fluid.
Figure 4.2 shows a typical ESP performance curve. Its safe operation involves keeping the pump operating within the green region, the so-called
operating envelope, which is typically determined in terms of well inflow and pump head boundaries. The region is bounded in the y-coordinate by head limits which vary with the frequency of the pump, and in the x-coordinate by the up- and down-thrust limits which represent the boundaries for well flow rate at different frequencies. Typically ESP vendors provide a reference frequency f0 and the corresponding head curve for it, which is drawn in blue in Figure 4.2. Moreover, the ESP vendors also provides the well flow bounds (qmathrm{L}0, qmathrm{U}0), and the pump head limits (Hmathrm{L}0, Hmathrm{U}0) for the reference frequency. Several ESP models are available in the industry for different well production potentials and fluid properties [71].
The handling of ESP constraints demand the inclusion of nonlinear constraints in the optimization formulation which will be presented in detail afterwards in Section 4.4. These constraints increase the complexity of the optimization problem and also impact on the computational time of the simulations. The main reason for this increase in complexity is the extra time needed to solve the ESP nonlinear system of equations and the calculation of nonlinear boundaries regarding of the ESP operating envelopes at every time step (see Figure 4.2).
Graph-Based Formulation
The topology and features of the production gathering network are represented with a graph-based formulation. The description in the format of graphs is suitable to describe heterogeneous networks consisting of wells, manifolds, choke valves and processing facilities, and follows standard network-flow models [72]. Graph-based formulations were recently applied to model mass and momentum balance equations for short-term production optimization [37, 73].
The gathering network is denoted by a directed graph G = (V, E),
where V is the set of vertices representing the junctions, and E is the set of edges representing the pipelines or equipment of the network . The well inflows are source nodes (Vsrc) and the inlet of the surface facilities are the sink nodes (Vsnfc). The subset of interior nodes Vlnt contains the vertices which are neither sources nor sinks. The edges represent pipelines or equipment of
Table 4.1: Network Graph Sets.
Set	Description
V	Set of vertices of the production network.
Vsrc	Set of source vertices in the network. Vsrc \subset V
Vsnk	Set of sink vertices in the network. Vsnk \subset V
Vini	Set of interior vertices in the network. Vini = V \ (Vsrc U Vsnk)
Vg”	Inlet vertex of edge e, i.e., Vmathrm{e}” = \{i : e = (i, j) E}
V\mathrm{k}ui	Outlet vertex of edge e, i.e., V\mathrm{k}ui = \{j : e = (i, j)	E}
E	Set of edges of the production network.
Epipe	e\mathrm{G}ges ¿eno\mathrm{E}jng pipelines in the network.
Eeqp	Set of edges denoting equipments in the network.
Esrc	Set of edges leaving a source node in \mathrm{V}src, i.e. E\mathrm{v}rc =	E°ui
ievsrc
Esnk	Set of edges entering a sink node in Vsnk, i.e. Esnk =	Ef
E\mathrm{v}”	Set of edges entering node vertex i, i.e., E\mathrm{v}” = \{e : e = (i, j)	E}.
Set of edges leaving node vertex i, i.e.,	= \{e : e = (i, j)	E}.
the network such as choke valves, electrical submersible pumps or separators. The edges are associated with physical properties of the network component such as pipe diameter or pump horse power. An edge belongs either to the subset Epipe if it represents a pipeline or to the subset Eeqp if it represents an equipment. A summary of the graph sets is presented in Table 4.1.
An illustrative gathering network and its corresponding graph are depicted in Figures 4.3(a) and 4.3(b). This network contains two production wells, comprising the set of source nodes Vsrc = {v1, v2}; and one sink representing the surface facilities, denoted by the set Vsnfc = {vs}. The subsea manifold and other junctions of the network are the interior nodes which are denoted by the set Vlnt = {V3, v4, v5, v6, v7}. The pipelines and flowlines of the network are in the set of pipe edges Epipe = {e1, e3, e4, e6, e7}, while the chokes of the network are represented by the special edges in the set Eeqp = {e2, es}.
(a) ) Gathering Network	(b) ) Network Graph
Figure 4.3: Illustrative gathering network
Network Simulation
The fluid flowing in the network is simulated by a function that computes the flows and pressures in the network for some given boundary conditions imposed by its neighboring systems, namely the surface facilities and the reservoir. The downstream conditions are the pressures at the inlet of the separators, which are kept at fixed values. The upstream conditions are the pressures and flows at the bottom of the wells, which are output from the reservoir simulator and are kept fixed during the network simulation. This means that we are solving explicitly the network equations after convergence of the reservoir equations, thus the controlled variables of the integrated production system are in the reservoir domain.
The simulation variables are the pressures at the vertices and the flows in the edges, as shown in Table 4.2. These variables are computed based on
Table 4.2: Network simulation variables
Variable	Description
P\mathrm{v}	Pressure at vertex V V.
qe,p	Flow rate of phase p \scrP in edge e	E.
qe	Multiphase flow in edge e.
three principles:
1.	Mass Conservation: the flow entering a node must equal the flow leaving it, meaning that there is no accumulation of fluid in any internal node of the graph.
qe —	qe = 0, Vv e Vint	(4.5)
e£Emathrm{v}n (v)	e£Emathrm{v}ui (v)
Emathrm{v}n(v) is the set of edges reaching node v, and Emathrm{v}ut(v) is the set of edges leaving it.
2.	Momentum Conservation: The pressure drop gradient over an edge e = (i,j) is a function of the multiphase flow crossing it and the pressure boundary conditions of the pipeline.
Ape = Ape q. .o	(4.6mathrm{v})
Ape = pi — pj	(4.6b)
where Ape is the pressure drop function. Notice that the pressure drop is precisely the pressure difference between nodes i and j, and that its value depends partly on the pipeline properties and geometries.
3.	Boundary Conditions: some boundary conditions are imposed to the network simulation. The upstream boundary conditions refer to constant pressures or flows at the bottom of the wells which are computed in the reservoir simulation. The downstream boundary conditions are given by the surface facilities, typically a constant pressure at the inlet of the processing unit.
An efficient procedure is described in Algorithm 1 to compute flows and pressures in a network G for given upstream (vw) and downstream (ps) boundary conditions. The procedure receives as inputs the network graph G, the well algebraic variables v\mathrm{W} with the pressures and flows which were output from the reservoir simulation, and the constant pressures at the inlet of the separators ps in the surface facilities. It starts by assigning the bottomhole pressures (BHPW) and well flow rates (qw) with function £(.), which receives the network graph G and the well algebraic variables vw as inputs (see line 2). Function \zeta(.) computes a binary matrix (M) that maps the source nodes to the edges of the graph (see line 3). This matrix has |Vsrc| rows and |E| columns and is built according with the rule: position (i, j) of the matrix takes on value 1 if edge j receives flows from the source node i, and 0 otherwise. The boundary conditions for the simulation are imposed by assigning the corresponding well bottom-hole pressures and separator pressures in the network (see lines 4 and 5). The flow rates in all edges of the network are computed with a linear operation of the well flow rates vector and the matrix M (see line 6). The initial set of active edges for the calculation of pressure drops is established as the set of edges leaving the source nodes and the edges reaching the sinks excluding the equipment edges (see lines 7-8). The while loop (see lines 9 to 20) computes the pressure drops in all edges, except the ones representing network equipment, since their pressure
Algorithm 1 - Network Simulation
1: function NETSIMULATION(G, vw, ps)
2: 3: 4: 5: 6: 7: 8: 9:	BHPW, qW leftarrow \xi(G, Vw) M leftarrow&amp;lt;(G) pv(Vsrc) leftarrow BHPW pv(vsnfc) leftarrow ps qe(E) leftarrow MT X q\mathrm{W}	\triangleleft Flows computed with a linear operation. leftarrow \mathrm{E}out(ysrc) setminus \mathrm{E}\mathrm{e}qp \mathrm{E}down leftarrow	 \mathrm{E}in(ysnk) setminus \mathrm{E}eqp while Eup cup Edown = emptyset do
10:	j \mathrm{E}down
11:	vk leftarrow vin U \mathrm{V}out
12:	Vk+1 leftarrow V\mathrm{W}ut(Eup) U V\mathrm{e}n(Ein)
13:	\deltae(Eup) leftarrow -1T
14:	\deltae(Edown) leftarrow 1T
15:	Pv(Vk+1) leftarrow pv(Vk) + diag(\deltae(\mathrm{E}\mathrm{k})) times Ape(qe(Ek), pv(Vk))
16:	Vin leftarrow V\mathrm{W}ut(Eup)
17:	yout leftarrow  yin(\mathrm{E}down)
18:	Eup leftarrow E\mathrm{v}ut(Vin) setminus Eeqp
19:	\mathrm{E}down leftarrow	 \mathrm{E}in(yout) setminus \mathrm{E}eqp
20:	end while
21:	return pv, qe
22: end function
drops are obtained as the difference between the upstream and downstream pressures, after the network simulation procedure. Ek, Vk, and Vk+1 are respectively the set of active edges and their corresponding inlet and outlet vertices (see lines 10-12). A negative sign (\deltae) is assigned to the edges in which the pressure propagation is in upward direction, while a positive sign is assigned to the edges with a backward pressure direction (see lines 13-14). The pressure drops are calculated concurrently in all active edges and the resulting pressures are assigned to the outlet vertices (see line 15). A walk step is performed in the network, meaning that the subsets of active inlet and outlet vertices, and the corresponding subsets of active edges which reach outlet edges or leave inlet edges are updated (see lines 16-19). The algorithm converges after visiting once all non-equipment edges of the network , which is the stopping criteria of the procedure. In the worst case, the equipment edges are at the tip of the branchs and the procedure will compute the pressure drop in a single edge in each iteration up to the equipment edge. Therefore, the the computational complexity of the algorithm is O(E \ Eeqp). However, when the number of wells grows and the number independent branches in the
network increases, the procedure becomes more efficient because several edges are evaluated simultaneously. At the end, the function return the pressures at the vertices and the flows in the edges as outputs (see line 21).
4.4	RESERVOIR CONTROL OPTIMIZATION
Reservoir control optimization involves the use of mathematical models to improve the reservoir management strategy and increase oil recovery performance. We address a particular optimization problem commonly referred to as water-flooding, which is a secondary recovery method that has been successfully employed by researchers and practitioners to maximize long-term gains. In water-flooding, water is injected into the reservoir in order to sustain its pressure and displace the oil from the pore spaces towards the wells. The main challenge is to calculate the water allocation in such a way to maximize the recovery factor and delay water break-through producing wells. To this end, it is necessary to impose constraints on the states and algebraic variables, i.e. the output constraints, which require expensive process simulations and gradient calculations in order to ensure feasibility of operational strategies regarding water handling capacity and other constraints in the processing facilities.
Herein, the water-flooding optimization problem is formulated as an optimal control problem in which the reservoir states change with well controls in a given prediction horizon. The controls are bottom hole pressures or flow set-points for the production and injection wells, and the long-term objective is the maximization of the cumulative sum of present values of cash inflows and outflows, namely the NPV. Well locations are not part of the optimization but parameters which are determined a priori.
4.4.1	Multiple Shooting Formulation
MS [74] is a well-known optimal control formulation which was recently employed to optimize water-flooding processes with several output constraints [53]. In MS, the prediction horizon is split into K time frames or shooting intervals in place of a single interval as in SS. Each shooting interval has its own independent initial conditions and control variables, thus the state and auxiliary variables becomes available explicitly in the optimizer at the interval boundaries of the prediction horizon. As a consequence, output constraints can be readily handled in the MS formulation by imposing linear bound constraints on optimization variables which are available at the boundaries of the shooting intervals. Further, the MS formulation is attractive because the shooting intervals can be simulated in parallel, opening opportunities to consider output constraints in a much broader scale than currently.
For given initial conditions, each shooting interval has a final-state variable xf = (\bfxk, k e scrK) denoting the reservoir state at the end of the interval which must coincide with the initial states x = (xk, k e scrK+) of the
next time frame, where Theta+ = {2,. . ., K +1} and Theta = {1,. . ., K\}. A set of additional algebraic variables v = (vk, k G Theta) are introduced to represent well flows, bottom-hole pressures and other information regarding network equipment. The algebraic variables are divided into well (vw) and network (vn) algebraic variables. One can only impose output constraints at the boundaries of the shooting intervals, therefore we assume for simplicity that shooting intervals coincide with the reservoir simulation steps.
The controls are split in a set of U steps, where \scrU = {1, .. ., U}, and a subjective function maps the simulation step indexes to the control step indexes, \kappa : Theta \rightarrow \scrU such that if k1 &amp;lt;k2 then \kappa(k1) &amp;lt;\kappa(k2), meaning that U &amp;lt;K. The optimization variables u = (\bfxj, j G \scrU) are control inputs which represent well target rates or their corresponding bottom-hole pressures. The decision variables consist of the control variables u, the initial states x, the final states xf, and the algebraic variables v. The reservoir initial condition x1 is not part of the optimization variable, but a known parameter of the problem.
Assuming that xk and u\kappa(k) define a unique solution for xk and vk, it is possible to reduce the decision variables vector to x, v, and u, where Rk is the implicit function representing the reservoir simulation step such that xk = Rk (xk, u\kappa(k)), and R\mathrm{v}k is the implicit function denoting the relation of states and controls with algebraic variables such that vk = R\mathrm{v} (xk, u\kappa(k) )[	].
The reservoir control-optimization problem constrained by network output constraints is formulated with the following equations:
min	=\ lk(xk+1, \cdotk, u\kappa(k)) \Theta=x,u,vw ,vn kE\scrK	(4.7a)
s. \rightarrow.:	
Xk+1 = R\bfx(\mathrm{v}k,u\kappa(k)), k G Theta	(4.7b)
\cdot\bfw = Rk(xk,\bfx\kappa(k)), k G Theta	(4.7c)
\cdot\bfn = Nk (\cdot\bfw),k G Theta	(4.7d)
\bfb\bfx &amp;lt;x &amp;lt;b\bfx	(4.7e)
\bfb\bfu &amp;lt;U &amp;lt;b\bfu	(4.7f)
\bfb\bfw &amp;lt;\cdotw &amp;lt;\bfb\bfw	(4.7g)
b\bfn &amp;lt;vn &amp;lt;b\bfn	(4.7h)
Notice that the decision variables 0 are the states x, the controls u, and the well algebraic variables vw, and the network algebraic variables vn. Eq. (4.7a) defines the objective function of the optimization problem which is the summation of separable functions lk (•) from each interval. It typically denotes the NPV but can also express any gain function that can be computed from the states, controls and algebraic variables. Eq. (4.7b) defines the reservoir simulation step which calculates the next state xk+1 for a given initial state xk and control input u\kappa(k). This equation also ensures continuity of state profiles of consecutive intervals. Eq. (4.7c) defines the well algebraic variables vw also
as a function of the initial state and control input in each interval. Eq. (4.7d) computes the network algebraic variables vn for given well algebraic variables with function Nk(•) which is formally defined in Algorithm 2. This function takes the output of the network simulation procedure and computes equipment properties and corresponding gradients with respect to the controls and state variables in order to add constraints in the MS formulation. Eqs. (4.7e)-(4.7h) establish bounds for the states, controls, well and network algebraic variables, respectively.
4.4.2	Network Constraints
The present work extends the MS formulation to consider network constraints in reservoir optimization. In [53], a reduced Sequentially Quadratic Programming (rSQP) algorithm was developed to tackle reservoir management problems by means of multiple shooting. However, the algorithm does not handle algebraic variables referring to production gathering networks but only well algebraic variables.
To account for network constraints, Algorithm 2 describes a function to calculate network algebraic variables for given well algebraic variables and boundary conditions. The function receives the well algebraic variables (v\mathrm{W}),
Algorithm 2 Function to compute network algebraic variables
1: function Nk(v\mathrm{w}, ps, G)
2:	pv, qe \leftarrow NETSIMULATION(v\mathrm{W}, ps, G)
3:	v\mathrm{n} \leftarrow r(pv, qe, G)
4:	return v\mathrm{n}
5: end function
the network graph (G), and the downstream boundary conditions (ps) as inputs and then computes the corresponding network algebraic variables (v\mathrm{v}). Notice that this function is used in Equation (4.7d) of the MS formulation.
In line 1, the function receives as inputs the well algebraic variables v\bfw which are the well boundary variables in a time instant k, together with the pressures at the separators ps, and the network graph G. Provided that v\mathrm{W} is an algebraic variable of the MS formulation, Nk can be computed concurrently to the reservoir simulator.
In line 2, a simulation of the network is performed and the node pressures (pv) and edge flows (qe) are returned as outputs as shown in Algorithm 1.
In line 3, the network algebraic variables v\mathrm{v} are extracted from the network by the function T(-).
This function is rather general and can represent any value of interest in the network that can be computed from the node pressures and edge flows in a network graph. Network constraints can represent capacity limitations at the processing unit, pressure drop constraints in the subsea equipment, or
more complex constraints such as the ones related to the operation of chokes or pumps, among others. After obtaining the network algebraic variables, constraints are imposed to these values in the optimization framework with simple bound constraints:
\bfv.	(4.8a)
where vmathrm{n},L and \bfvmathrm{n},U are upper and lower bounds, respectively, for the network algebraic variables. Notice that equality constraints can also be imposed by simply setting vmathrm{n}’L = vmathrm{n}’U, however such constraints are typically hard to handle.
Choke Valve Constraints
Chokes are special valves designed to reduce the velocity and restrict flow rates in pipelines of gathering networks. When fluid flows at given pressure and temperature conditions and it passes through a restriction into a lower pressure environment, the fluid velocity increases, and due to the mass conservation principle, an increase of velocity occurs when it flows through the smaller cross-sectional area of the restriction. At the same time, the Venturi effect causes the static pressure, and therefore the density, to decrease downstream beyond the restriction.
Feasibility of production targets in choked wells can be ensured by imposing pressure drop constraints on the choke valves [15]:
ApL	Apu	(4.9)
where Ape denotes the pressure drops on the chokes e Eeqp, and vmathrm{n}’L and vmathrm{n},U denote the lower and upper bounds for the pressure drops, respectively. For a feasible operation, a positive pressure drop is imposed, meaning that ApL = 0, and Apu is a sufficiently large value to keep the constraint relaxed with respect to the upper bound.
Electrical Submersible Pump Constraints
Complex network constraints can also be imposed with the proposed methodology. In particular, the constraints regarding the operation of an ESP involves keeping the well inflow and pump head within the boundaries of the pumps operating envelopes. This can be achieved by imposing constraints to the well inflow qmathrm{l} and the pump frequency f:
fmin f	fmax	(4.10a)
f0 ■ (f }	(4.10b)
where f0 is the reference frequency, and fmln and fmax are the ESP frequency limits. The liquid flow rates at ESP pressure and temperature conditions are
constrained by upper (q\mathrm0) and lower (q\mathrm0) bounds which vary with the ESP current frequency f, and the reference frequency f0 of the equipment.
Eqs. 4.10b are rearranged such that the constraints follow the standard form established in Eq. 4.8a:
0 S “ — "\mathrmo ' (f
0 - “\mathrm0-(f—“
(4.11)
(4.12)
meaning that the left-hand side of these inequalities and the ESP frequencies comprise a vector of network algebraic variables for one ESP at time step k:
f
“ — “fo ■ (f0) “\mathrm0 • (fo — “
(4.13)
The calculation of ESP constraints require the knowledge of the pump frequencies a priori. In this dissertation, the ESP frequencies are a consequence of the well controls and resulting pressures and flows in the network. Algorithm 3 describes a procedure that computes the ESP frequencies after the network simulation procedure.
Algorithm 3 Function that computes ESP frequencies
1: function ESPfrequenoies(G, pv, qe,	f0 , Nstg )
2:	Eeqp leftarrow equipmentEdges(G)
3:	Vin leftarrow V\mathrm{e}n(Eeqp)
4:	ApESP leftarrow pv(Vin) — pv(V\mathrm{o}ut(Eeqp))
5:	Tin leftarrow nodeTemperatures(G, Vin)
6:	“e,o,“e,w ,P\mathrm,P\mathrm{w} leftarrow 10CalF10Ws(“e,0(EeqP), “e,w (E\mathrm{e}qP),	(Vin ) , Tin ,	)
7:	“1 leftarrow q\bigl(,o +
8:	\mathrmm leftarrow “i,o • \mathrm\mathrm +	/“\mathrm
9:	DeltaH.v/	cdot g)
10:	fleftarrow	(“i,fo,Nst9)
11:	return f
12: end function
The inputs are the network graph (G), the pressures in the nodes (pv), the flows in the edges (qe), the standard oil density (\mathrm\mathrm{o}c), the ESP reference frequencies (f0), and number of stages (Nst9).
In lines 2-4, the pressure difference in the edges representing the ESPs are extracted from the network variables.
In lines 5-7, the phase flows and densities are determined for the ESP pressures and temperature conditions. This function receives as inputs the phase flows and oil density at surface conditions, the ESP intake pressures and
inlet temperatures. The function outputs are the phase flows and densities at local conditions.
In lines 8-9, the ESP head values are determined for the given local density of the mixture (\rhom), where g is the gravity.
Finally, in line 10, the ESP frequencies are determined for given local liquid flow rates and ESP features. Later, in conjunction with the example in Section 4.5, an explicit model for the function \vargammamathrm{E}SP(•) is presented.
4.4.3	Pressure Drop Sensitivities
The set of equations describing the network fluid flow assumes flows at steady-state conditions, meaning that the pressure transients and fluid dynamics in the pipelines are disregarded. However, the pressure gradients vary with the pipe spatial position since the fluid densities and flow regimes change with pressure and temperature conditions. Even though the temperature distribution in the network is constant, the pressure variations might have considerable influence on the pressure drop gradients. Therefore, the pressure drop gradient in a pipeline is represented as an Ordinary Differential Equation (ODE) of the average pressure at position s of the pipe:
= f (s,p(s),q)
P(so) = po(q)
(4.14a)
(4.14b)
where f is the pressure drop gradient function at position s of the pipeline, for a given pressure at this position p(s), and a flow rate q in the pipeline. The standard flow rate q is a model parameter and do not vary with the spatial position s. The knowledge of the pressure at s0 for a given flow q rate is the boundary condition of the ODE system.
Forward Sensitivity Analysis
A sensitivity analysis allows for calculating the pressure drop gradients with respect to the model parameter q. This information is used afterwards to obtain the pressure drop gradients and total derivatives of the network constraints. A forward sensitivity method is derived by writing explicitly the total derivative of the pressure drop gradient with respect to the total flow rate:
d2p = \partialfT \partialpT + \partialf T ds • dq	\partialp \partialq \partialq
dp(so) = \partialpo(q)
dq	\partialq
(4.15a)
(4.15b)
The pressure drop sensitivity with respect to the model parameter q is defined
as:
S&lt;”=partial^
(4.16)
and satisfies the following sensitivity equations:
dS ds
S (so)
partial/ dp
T partial/T s «+partialq
partialpoT partialq
(4.17a)
(4.17b)
The spatial integration is a combined system involving the ODE and the sensitivity equations p of size N(Ns + 1), where N is the number of equations of the original problem, and Ns is the number of model parameters. The ODE solution with the corresponding sensitivities can be written as follows:
r sf=L
p(sf)=	f (s,p(s),q) ■ \Psis
S0 =
*&lt;-)=Z=7 partialp(s)+partial^)-
(4.18)
(4.19)
where L is the length of the pipeline Finally, the gradients are obtained with:
, partial\Psi
nablaq= S(sf )T \cdot -partialp-	(4.20a)
The sensitivity equations are solved simultaneously with the state profiles with a multi-step integration method. In addition, a full or partial error control for the sensitivity variables is considered in the local error calculation.. The partial derivatives can be calculated using Automatic Differentiation (AD) tools or Finite Differences (FD).
4.4.4	Adjoint Sensitivity Analysis
In the forward sensitivity approach, an ODE system of size (1 + Ns)N is solved to obtain the sensitivities with respect to the Ns model parameters. This can be prohibitive for a large-scale system, specially when the number of model parameters or sensitivity variables (Ns) is large with respect to the number of constraints. In this case, the adjoint sensitivity method is very attractive because it does not compute all the sensitivities in S.
The objective function or a constraint can be written as \Psi(s,p(s), q) such that the variables and parameters are governed by the ODE in Eqs. (4.14a) and (4.14b). Introducing a Lagrange multiplier A, an augmented
objective function is defined as:
\Psi(s,p(s),q) = \Psi(sf ,p(sf ),q)+ i lambda(s)T ( f (s,p(s),q) —
«/so L x
dp\ ds partial
ds
(4.21)
and by introducing the following perturbations:
deltap = p(s) — p\ast (s)
dq = q — q*
d\Psi = \Psi(p\ast(s) + deltap, q\ast + dq) — \Psi(p*(s), q\ast)
(4.22a)
(4.22b)
(4.22c)
the following equation is obtained for the augmented objective:
\Psi(p(s),q) = \Psi(p(sf ),q) — p(sf )Tlambda(sf) + p(so)Tlambda(so) lambda(sf (s,p(s),q) + p(s)T \mathrm{d}lambda)s'
rsf
+ J
d SO
ds
(4.23)
taking the gradient of the objective it follows that:
■ n,T,	"I T	rycr,
d\Psi(p(s),q)= -partial- — lambdas f)	deltap(sf ) + lambda(so)deltap(so) + -partial- dq+
partialp
/• sf [dlambda. . dlambda Ao klambda(s)+\mathrm{d}s
so
deltap(s) + partial-lambda dpds
(4.24)

The adjoint equations are chosen such that only dq influences
d\Psi(p(s),q) = {partial^
- '	, partialp(so)
T dq
lambdas]+ £ [partial&gt;H
dq (4.25)
with the boundary condition:
lambdas) = 'partials
and differential equation for the adjoint
dlambda =_ partialf lambda ds	dp
(4.26)
(4.27)
The choice of the best method to use is based on the number of variables and constraints of the problem. In this dissertation, a combination of forward and backward methods with automatic differentiation and finite differences were compared with respect to the computational cost. The forward method with finite differences was chosen because it was the most efficient method for the case instances of the numerical and simulation analysis.
4.5 NUMERICAL AND SIMULATION ANALYSIS
A numerical and simulation analysis is performed to assess the proposed methodology for the optimization of oil reservoirs constrained by production gathering networks. The relevance of such constraints is attested by contrasting optimal constrained strategies against traditional methods. Moreover, the flexibility of the methodology is put to test by solving optimization problems with complex network constraints such as the ones related to the operation of ESPs.
The solution method involves the orchestration of several software components as shown in Figure 4.4. A network solver was developed in Mat-
Reservoir-Network Integrated Optimization
Nonlinear Predictive Control	Network Solver
Multiple shooting	Graph representation
! Reduced SQP	!	; Network simulation
	4	&gt;	4		L	
			
QP Solver	Reservoir Simulator	ODE Solver	; Nodal Analysis
Interior point method ¡State-of-art solver	!	IMPES solver	; Automatic differentiation 1	Sensitivity analysis Forward and adjoint methods	Black-oil correlations Pressure drop derivatives
			
Other Software
Figure 4.4: Software Architecture
lab for modeling and simulation of fluid flow in gathering networks. The pressure drop calculations are computed using the framework for nodal analysis developed by [66], which consists of several correlations to compute fluid properties and pressure drop derivatives. An integrator was coupled to the network simulator to obtain the pressure sensitivities, using a Matlab interface to the ODE solver (CVODES), which is part of the SUite of Nonlinear and DIfferential/ALgebraic Equation Solvers (Sundials v2.6.2) [75]. The network solver was tightly interfaced to the REduced Multiple Shooting Optimizer (REMSO) developed [76]. REMSO is interfaced to the Matlab Reservoir Simulation Toolbox (MRST 2015a) [77] and to an mathematical programming solver (IBM ILOG CPLEX v12.6) which was used to solve quadratic programs sequentially. The software uses automatic differentiation to compute gradients, supports parallelism and adopts reduction techniques for memory saving purposes. All simulation and optimization ran on a workstation equipped with a CPU Intel Xeon E51620 3.60 GHz with 32 GB of RAM running MATLAB 2016a.
A brief description of the reservoir model used as a testbed in the
simulation experiments is given in Section 4.5.1. The production gathering network is described in Section 4.5.2. Section 4.5.3 defines the constraints and parameters of the problem. Finally, Section 4.5.5 presents case studies and a simulation analysis.
4.5.1	Reservoir Description
The reservoir model was adapted from a case instance from [78]. It consists of a Cartesian three-dimensional box, split in 1200 regular grid blocks being 20 x 10 x 6 in x, y, and z coordinates, respectively. Each block is 500 feet long, 500 feet wide and 50 feet high. We chose a rather simple reservoir model to assess the effectiveness of the developed methodology to account for network constraints, in particular nonlinear constraints as manifested by ESPs. The multiple shooting methodology has earlier been applied to a more complex reservoir model [53], however without network constraints.
The fluid is represented with an two-phase immiscible flow model and the reservoir grid blocks have homogeneous rock porosity and relative permeability. The absolute permeabilitiy is 50 darcys (d) in the x and y coordinates, and 25 darcys (d) in the z coordinate, meaning that the fluids flow easily in the horizontal direction. The relative permeability is a curve that describes phase permeabilities to water saturations. Table 4.3 provides relative phase permeabilities for a set of water saturation values, where Sw is the water saturation, Krw is the water relative permeability, and Krow is the oil relative permeability.
Table 4.3: Oil Relative Permeabilities
Sw	Krw	K Krow
0.1500	0.0	1.0000
0.2000	0.0059	0.8521
0.2500	0.0237	0.7160
0.3000	0.0533	0.5917
0.3500	0.0947	0.4793
0.4000	0.1479	0.3787
0.4500	0.2130	0.2899
0.5000	0.2899	0.2130
0.5500	0.3787	0.1479
0.6000	0.4793	0.0947
0.6500	0.5917	0.0533
0.7000	0.7160	0.0237
0.7500	0.8521	0.0059
0.8000	1.0000	0.000
The reservoir initial conditions are uniformly set to 200 bar for the oil pressure, and 0.15 for the water saturation in all grid blocks. Other relevant rock and fluid properties are shown in Table 4.4.
Table 4.4: Reservoir parameters
Symbol	Variable	Value	Units
	Porosity	0.3	-
cr	Rock compressibility	3 X 10-5	1/Pa
cw	Water compressibility	4.28	10-5	1/Pa
co	Oil compressibility	6.65 x 10-5	1/Pa
Po	Oil density	962	kg/m3
\rhow	Water density	1080	kg/m3
\muo	Oil viscosity	5.00	Pa s
\muw	Water viscosity	0.48	Pa s
Figure 4.5 depicts the reservoir model with the corresponding position of the production and injection wells. The wells are placed prior to the
p2
Figure 4.5: Reservoir Model
optimization as shown in the figure. Five production wells pi (i = 1,. . . 5) drain fluids from the reservoir and two injectors j (j = 1, 2) push water into the reservoir to displace the oil to productive areas and to sustain the reservoir pressure. The total producing life of the reservoir is taken as 10 years, with a fixed time step of 5 days, which means a total of 730 time steps.
4.5.2	Production Gathering Network
The production gathering network has 5 ESP-lifted wells producing to a common subsea manifold which transports the fluids to the processing facilities at the surface. The network graph is depicted in Figure 4.6. Each producer is equipped with an ESP which is placed in a casing inside the tubing close to the well bottom-hole. The production chokes are assumed to be fully opened with a negligible pressure drop and thus they were not included in
Figure 4.6: Production gathering network
the network graph. Constraints regarding injection wells infrastructure are not considered, but the methodology can be easily extended for this aim.
The set of pipelines transporting the fluids from the reservoir to the surface is divided in tubing, pipeline and flowlines. The pipeline features are shown in Table 4.5. The pipeline is vertical when the angle is 90 degrees,
Table 4.5: Pipeline features
Pipeline	Length (m)	ID (mm)	R (mm)	Angle (deg)
Tubing (hi)	213.30	152	0.028	90
Tubing (h2)	914.40	76	0.028	90
Pipeline	1000.00	120	0.028	0
Flowline	2000.00	240	0.028	90
ID:= Inner Diameter, R:= Roughness
and horizontal if the angle is 0 degree. For vertical pipelines, the potential component usually is the dominant in the pressure drops, while friction is dominant for horizontal pipes.
All ESPs have 70 identical stages and a motor frequency varying from 30 Hz to 90 Hz, with a reference frequency of 60 Hz. It is assumed that the platform has enough energy to supply power for all ESPs. Thus, the pump operation is not constrained by power limitations, but such constraints can also be addressed by the proposed methodology.
The network boundary conditions are given by the multiphase flows and bottom-hole pressures that are computed in the reservoir simulation, which represent the upstream boundary conditions, and the inlet pressure at the separator is kept constant at 5 bar, which is the downstream boundary condition of the system.
ESP Model
The flows and pressures in the network are calculated with the network simulation procedure as shown in Algorithm 1. The outputs are the pressure differences in the ESPs (APesp) and the flow rates of the fluids being pumped. With these values, the pump heads can be calculated from:
AH =	(4.28)
pi ■ g
where AH is the total pump head, \rhoi is the average density of the pumped flow, and g is the gravitational constant. For two-phase immiscible flows, which is the fluid model adopted in this work, the average density is the weighted average of oil and water densities which uses the local phase volume fractions of oil and water.
Notice that the boundaries of the ESP operating envelopes vary with the frequencies of the pumps, which are typically controlled by the operators from the platform. Therefore, the ESP constraints are nonlinear functions of the flow rates and densities of the fluids being pumped, and of the frequencies of the pumps. The ESP frequencies are computed with Algorithm 3, and the operating envelope constraints are imposed as described in Section 4.3.2.
Network and reservoir equations converge separately, meaning that their coupling is explicit. Thus, there is no need to perform any equilibrium loop to ensure consistency of the equations required for integrated production optimization. Instead, well controls obtained after convergence of reservoir equations are kept constant in the network simulation procedure, and the residuals of the network constraints are driven to zero by the optimization algorithm. This means that the pump frequencies are a consequence of the well controls chosen to satisfy reservoir equations, and thus an explicit relation between well inflow and pump head is required to calculate pump frequencies for given pressure drops in network equipment. A procedure to compute the pump frequencies for given node pressures, edge flows and a network graph appears in Algorithm 3.
In [3], the single stage ESP head curve at the reference frequency was satisfactorily fitted to a 4th order polynomial equation of the well flow rate, and thus the pump frequency f can be calculated as the solution of:
AH/0 = a4 ■ qf0 + a3 ■ qf0 +&amp;lt;12 ■ qf0 + ai ■ qf0 + ao
AH = AH/0 ■
(4.29a)
(4.29b)
(4.29c)
where ai, (i = 1, . .., 4) are the coefficients of the polynomial equation approximating the pump head curve, Nst9 is the number of stages of the pump, and qf0 and AHf0 denote the flow rate and pump head at the reference frequency. The polynomial equation of the head curve is a quartic polynomial equation
which can be converted to a depressed quartic equation for which there exists an explicit solution. Notice that after calculating the frequency of the pump, the ESP head can be constrained by imposing bounds to the frequency:
f min
&amp;lt;f &amp;lt;fmax
(4.30)
with fmln and fmax being the lower and upper bounds to the pump frequency respectively.
4.5.3	Optimization Problem Statement
A water-flooding optimization problem with network constraints is modeled with the MS formulation. The objective is a scaled NPV function, which is separable, and compatible with Equation (4.7a):
max NPV:	(dk ■ (1 + d)~k^ ■ I	ro ■ qp'k —	■ q^k
kescrK
i,k
+	— r\sum • qd,
ievInj
where:
•	\scrK is the set of prediction intervals which split the total producing life of the reservoir of 10 years.
•	ro — 1/stb, rw — 0.1/stb , r\sum — 0.1/stb are the gains with the oil revenue, and costs for water treatment and water injection, respectively. The gain ro, and the costs rw and r\sum were chosen so that the cost for treating the produced or injected water corresponds to 10% of the revenue obtained with the selling of oil.
•	qP,k and q^’k are the oil and water rates of production wells, and q^k is the water rate of injection wells. These well flow rates are denoted by the well algebraic variables vk in the mathematical formulation.
•	d — 0.1 is the discount factor, and dk is the time interval at k.
Constraints on reservoir states, which are given by Equation (4.7e), impose limits to the pressure of oil and water saturation in the reservoir grid blocks. The feasible value for pressure of oil ranges from 100 bar to 500 bar, while the range of feasible water saturations is from 0.01 to 0.4.
The constraints to the control inputs uk are given by Equation (4.7f). The production wells are controlled by bottom-hole pressure set points which can vary from 100 bar to 300 bar, while the injection wells are controlled by rate which can vary from 1 m3/d to 300 m3/d.
Equation (4.7g) defines constraints to the algebraic variables in a compact form. These constraints, however, are divided into well and network constraints. The well constraints impose bounds to the well algebraic variables
(vmathrm{W}) which represent the well inflow and bottom-hole pressures. Since the bottom-hole pressures of producers and injection rates of injectors are control inputs, which are already constrained in Equation (4.7e), the constraints to the algebraic variables take into account only bounds to well inflows of production wells and pressure bounds for injection wells. This avoids the extra computational cost of computing redundant output constraints. The feasible oil flow rates of production wells range from 1 m3/d to 250 m3/d, while the feasible values for water production range from 1 m3/d to 300 m3/d.
The remaining algebraic variable constraints refer to the network constraints. Such constraints impose bounds to the network variables (vmathrm{N}) which represent the violation to the ESP operating envelopes of production wells. These constraints ensure that the ESPs operate within their envelopes. To satisfy these constraints, it is sufficient to enforce bounds to the well inflow and ESP frequencies. The feasible values for the frequency range from 30 Hz to 90 Hz, while the feasible well flow rates range from 15 m3/d to 200 m3/d at the reference frequency of 60 Hz.
4.5.4	Heuristic for a Feasible Start
A primal feasible initial guess for the states and algebraic variables in reservoir optimization is typically obtained by performing a forward simulation of the reservoir for bounded control inputs. However, when network constraints are introduced in the problem, obtaining a feasible initial guess with respect to both reservoir and network equations is not evident but important for the optimization algorithm.
To obtain a initial feasible guess with respect to the network and reservoir equations, a reduced-order control strategy was adopted, which was inspired by the Feasibility Pump (FP) heuristic. The FP is an heuristic adopted for finding a feasible solution of a given mixed-integer programming problem by solving linear relaxations of the problem in order to find an incumbent solution which is as close as possible to the feasible space [79].
In this work, the heuristic used a constant control value for the whole horizon per well to find a feasible solution for the optimization problem. The result of the reduced-order control problem is a primal feasible guess which can be refined by splitting the single control step into several control intervals. This control schedule is given as the initial guess for the refined control optimization problems which can adjust the controls in each step to maximize the NPV.
The heuristic is written in a high-level language in Algorithm 4. The function receives the reservoir initial states (x0), a guess for the well controls (u0), and separator inlet pressures (ps) which are the downstream boundary conditions for the network simulation. A forward reservoir simulation is performed to obtain the states (x1) and well algebraic variables (vw,1j for all prediction intervals (see lines 2-3). Then the network algebraic variables (vN,1j are calculated provided the states and well algebraic variables in the prediction
Algorithm 4 Heuristic for a feasible start
1: function FEASIBLESTART(x0, u°, ps, K)
2:	X1&amp;lt;-Rx(x".u"j
3:	VWJ&amp;lt;-Rv(x".u"j
4:	V^1	N(x1,VW’1,pS)
5:	[xf,vw,/, vN,/,uf] ■&lt;— Remso(x°,u°,x1, vw&gt;1, vN&gt;1)
6:	uR •&lt;— controlRefinement(uf, K)
7:	return uR
8: end function
9: function controlRefinement(u, K)
10:	UR e R|K|x|u| 0T
11:	for i := 1 : |K| do
12:	uR(z)&amp;lt;— u
13:	end for
14:	return uR
15: end function
intervals (see line 4). This is achieved by invoking the rSQP algorithm with the initial states (x0), the control inputs (u0), and the algebraic variable guesses (vw,x, vN’x) as inputs (see line 5). The solution returned by REMSO consists of the optimal reservoir states (xf), constant well controls (uf) and the well and algebraic variables (vw,f, vN,f). The single control step of the solution (uf) is split into several control intervals, and the resulting refined control schedule (uR) is returned (see line 6).
The control refinement procedure splits the single control step of the reduced-order control strategy into several control intervals. Figure 4.7 depicts the control strategy before and after the refinement. On the left plot, the
Single Control per Well
t
Control Steps:
82x	72x	24x
6x	4x	2x	1x
5 days 15 days 30 days 60 days 90 days 180 days 360 days
10 years
u(i)
Refined Well Control
-—
t
Figure 4.7: Well control refinement
single well control input u(t) is shown with the corresponding reservoir states x(t) and algebraic variables v(t). The single step in this case is split into
191 control steps while keeping constant the control inputs (see plot on the right). Notice that the discretization is fine at the beginning and coarser at the end, meaning that more accurate results are required in the early life of the field.0.9 The resulting schedule is a control strategy that satisfies both reservoir and network constraints with several degrees of freedom. This schedule is adopted as the standard initial guess for all network constrained reservoir optimization problems addressed in this dissertation.
The initial guess for the reduced-order controls are the lowest feasible value for the bottom-hole pressure of producers, namely 100 bar, and the maximum injection rate and half of this value for the injectors, namely 300 m3/d and 150 m3/d. The solution of the reduced-order control problem with this initial guess kept the controls of wells pi, p3, p4, and ii unchanged, but adjusted the controls of wells p2, p5 and i2 to satisfy network constraints. The pressures at the bottom-hole of wells p2 and p5 were increased respectively to 136 bar and 149 bar, while the water injection rate of well i2 was decreased to 140 m3 /d.
The ESP constraints of well p5 are depicted for the initial guess before and after the heuristic. Figure 4.8(a) shows the violation of ESP constraints
(a) ) Violation of ESP constraints
3500
(b) ) Result using the heuristic
Figure 4.8: Output of heuristic for p5.
in the initial guess, while Figure 4.8(b) shows that the network constraints hold for the solution given by the heuristic. The figure on the left shows the ESP operating envelope with the corresponding operation of the pump, while the figures on the right show the network constraints imposed on the problem. Notice that the initial guess starts to violate the lower bound for the liquid flow rate in the pump after 2500 days of operation, which means that without network constraints, engineers would identify this problem only after a couple of years of operation.
4.5.5	Case Studies
Two case studies are performed to assess the effectiveness of the proposed methodology. The first compares network unconstrained against constrained cases with the aim to assess the impact of network constraints in reservoir optimization. The second case study compares reservoir optimization strategy which is typically performed by reservoir engineers against shortterm practices, which are traditionally performed by production engineers. Short-term practices use simplified reservoir models, but typically consider sophisticated network constraints. On the other hand, reservoir optimization methods use more accurate reservoir models, but adopt simplified constraints for the network. The second case study aims to asses the differences and benefits of the strategies when both reservoir and network models are representative. All cases are open-loop optimization problems, meaning that the controls are not adjusted with field measured data for feedback control. Detailed results showing production rates and pressure profiles per well for each case study are presented in Appendix A.
Reservoir Optimization with Network Constraints
In this study, two water-flooding problem instances are compared; one without network constraints, and the other with additional network constraints regarding the operation of ESPs. Although operators typically check feasibility of operational plans with respect to the gathering network and surface facilities before considering it as a viable recommendation, most reservoir optimization methods disregard such constraints. This study aims to asses the relevance of considering network constraints in reservoir optimization methods.
The optimization of the unconstrained case took 119 Sequentially Quadratic Programming (SQP) iterations, while the network constrained case took 287 iterations. One possible reason for the overhead of the solution method is the numerous extra network output constraints for a feasible operation of the ESPs. A total of 3650 network constraints were considered in the constrained case, i.e., one constraint per simulation step (730) per well (5) to assess the potential of the methodology, but in practice this number could be reduced since the dynamics of the reservoir are slower.
The optimal cumulative NPV of the approaches is shown in Figure 4.9. As expected, the NPV is higher in the network unconstrained case. Although
time (day)
Figure 4.9: Optimal NPV values network unconstrained and constrained scenarios.
a decrease in the objective is not desired usually, in this case the optimal strategy has binding network constraints and thus the optimal unconstrained solution is not feasible considering the integrated production system. The small difference in terms of NPV in the scenarios is possibly due to the simplicity of the reservoir model adopted in the experiments. In practice, this difference could be much larger, specially in reservoirs with heterogeneous permeability and saturation distributions.
The results also revealed that the ESPs, except for producer 3, work outside the boundaries of the operating envelopes in the unconstrained case. This means that the solution obtained without network constraints rendered recommendations that would damage the ESPs in practice. One well whose control strategy is particularly affected is producer p5. Figures 4.10(a) and 4.10(b) show the ESP operation trajectory for well p5 in both constrained and unconstrained cases. In the unconstrained case, the operation of the ESP is not kept within the boundaries of the pump operating envelope, while the ESP constraints are honored in the constrained case.
Comparison with the Short-Term Practice
Long-term optimization involves years and is performed by reservoir engineers, while short-term optimization involves days or weeks and is typically done by production engineers. In contrast with long-term goals which
(a) Network unconstrained
3500
3000
Figure 4.10: ESP constraints of well p5.
2500
2000
1500
1000
500


aim to maximize the reservoir oil recovery, the short-term practice is usually to produce as much as possible daily. Therefore it can be seen as a greedy strategy that chooses controls to give the highest production in every time step, without considering the long-term impact of such actions.
In water-flooding optimization, the early prediction of water front arrivals is a key aspect in the choice of the best strategy to operate the wells. Long-term strategies typically have an advantage over short-term ones since with the latter can not predict water front arrivals. This case study compares the long-term against a greedy strategy. The greedy approach consists of a sequence of optimization problems, one for each control step, up to the end of the prediction horizon.
The first scenario is the long-term optimization case which consists of a single optimization problem for the whole prediction horizon with a 5-day step interval. The controlled variables are the Bottom-Hole Pressure (BHP) values for producers and injection rates for the injectors. The second scenario is the greedy case, whereby several optimization problems are solved, one per step interval. The controlled variables are only the bottom-hole pressures of the production wells, and the water injection rates of injectors are kept constant at the values obtained with the heuristic procedure for a feasible
start. Table 4.6 contains a summary of both strategies.
Table 4.6: NPVs obtained with long-term and greedy strategies
Long Term Strategy	Greedy Strategy
Single optimization problem. NPV for the whole horizon. Discount factor of 10 % Producer BHPs and injection rates	One problem every 5 days NPV with a 5-day horizon Problems are solved sequentially Only BHPs of producers
The cumulative NPVs are compared to the initial guess in Figure 4.11. The initial guess is referred to as single control in the figure. In the first
Figure 4.11: Optimal NPVs for the network unconstrained and constrained scenarios.
year, the long-term strategy preserves the initial guess control strategy while the greedy strategy renders a higher NPV. After some years, the long-term strategy begins to render a higher NPV than the greedy strategy. Finally, in the last year, it can be seen that the long-term strategy gives the highest cumulative NPV and although the greedy strategy renders good results in the first years of production, it decreases the NPV of the initial guess at later stages of production. This behavior is observed because each subproblem is
solved independently and thus the future impact of the present actions are disregarded.
The ESP operating profiles induced by the greedy and long-term strategies can differ significantly as shown in Figure 4.12. In the greedy strategy,
3500
3000
2500
2000
1500
1000
500
(a) ) Greedy Strategy
Figure 4.12: ESP constraints of well p5.
3500
3000
2500
2000
1500
1000
500
(b) ) Long-Term Strategy
the well starts producing close to the maximum and decreases its production with time. The long-term strategy does the opposite, since it curtails the well production in order to prevent a premature water front arrival.
4.6 CONCLUDING REMARKS
A network solver that uses automatic differentiation, parallelization and integration mechanisms was developed and tightly interfaced to an opensource reservoir simulator. The integrated problem was represented with a multiple shooting formulation and solved with a rSQP algorithm. An explicit coupling was chosen for the reservoir and network models to avoid the extra burden of converging the equations of the integrated system at every time step. Instead, the inconsistencies between reservoir and network flows and pressures are modeled as constraints in the optimization formulation. Thus, after satisfying all constraints at the convergence of the algorithm, the equations of both reservoir and network models are consistent.
To assess the feasibility and the potential of the methodology to handle network constraints, it was considered a rather simple reservoir model, and a complex network model with nonlinear constraints regarding the operation of ESPs. A heuristic procedure was developed with the aim to obtain a feasible initial guess with respect to the integrated production system. This procedure was important for the effectiveness of the optimization algorithm.
The results elicited that the developed methodology is suitable to handle complex and numerous network constraints. Two case studies were presented. The first assessed the relevance of network constraints to ensure feasibility with respect to the gathering facilities by comparing an uncon
strained against a constrained case. While the solution of the unconstrained case rendered a strategy which violated the operating envelope boundaries of the ESPs, the strategy obtained with the constrained case honored these constraints without a significant decrease in the NPV. The second case study compared the traditional approach adopted by reservoirs engineers against short-term practices. It was shown that the latter yields a lower NPV because it can not predict early water front arrivals.
4.7 SUMMARY AND SYNTHESIS OF CONTRIBUTION
An efficient method was developed for reservoir optimization problems with network constraints. It extended the previous work developed by Codas et al. [53] in which it was shown that several output constraints favors multiple shooting. This dissertation applied the MS formulation for reservoir optimization where the output constraints are particularly related to the production gathering network.
While Chapters 2 and 3 focused on modeling and optimization tools for short-term production optimization, this Chapter focused on long-term production optimization, in particular the optimization of water-flooding processes. Production gathering network constraints appeared in all Chapters, but the approach used in the previous Chapters dealt with discrete variable and the solution method involved the use of state-of-art mixed-integer programming solver. On the other hand, the methodology developed in this Chapter deals with nonlinear problems with a large number of decisions variables and constraints, and therefore requires the use of specialized techniques such as the use of an ODE solver with sensitivity capabilities, automatic differentiation and a rSQP algorithm. The contributions of this Chapter can be summarized as:
•	A methodology to handle network constraints in gradient-based reservoir optimization;
•	A network solver that is tightly integrated to an open-source reservoir simulator and provides gradient and sensitivity information with respect to momentum balance equations;
•	A heuristic to obtain a feasible initial guess, which satisfies both reservoir and network equations for integrated production optimization problems;
•	A simulation analysis assessing the impact of network constraints in reservoir optimization.
5	CONCLUDING REMARKS
The optimal operation of oil fields is a complex task that involves several disciplines, processes and technologies. In the long-term, reservoir engineers seek strategies to improve the NPV for the remaining field life time. In the short-term, production engineers look for daily or weekly plans that maximize the field performance while the operational constraints are satisfied. From both time scale perspectives, operators had to rely on their experience and knowledge of the system, and on sensitivity analyses based on process models to find the best setpoints for operating the field. Unfortunately, these methods are not sufficient to ensure a mode of operation that enhances oil production and therefore the value of assets under unusual operational conditions, e.g. equipment failure, installation of new wells or processing facilities starting to work.
An alternative that is gaining acceptance in the industry is modelbased optimization, which relies on the integration of mathematical models with algorithms into effective optimization tools. These tools can be effective to advise engineers in finding optimal operation settings provided that process models are routinely updated with field data to reflect the prevailing system conditions. Therefore, a decisive aspect to improve economic margins with the use of model-based optimization is the development of mathematical models that are suitable for optimization purposes and which reflect sufficiently well the actual processes. The quality of recommendations provided by the optimization tool is strongly connected to the accuracy of process models, thus the validation of the optimal recommendations against simulation models is indispensable before their actual implementation in the field.
In gas-lifted oil fields, well production can be represented as a function of the well-head pressure and the gas-lift injection rate. Fhrther, pressure drops in the gathering network depend on phase flow rates and the average pressures in a pipe segment. These functions are typically calculated in an implicit manner by a network simulator, which may not be suitable for efficient optimization methods. Instead, this dissertation developed a framework for multidimensional piecewise-linear approximations to represent the nonlinear functions which appear in short-term production optimization. MPWL models have the advantage of not requiring curve fitting, enabling the synthesis of function approximations directly from sampled data. These models can be employed in the approximation of well production and pressure drop functions from data sampled in commercial multiphase flow simulators in which the process was modeled. A suitable MPWL formulation can then be chosen and adjusted for the operating conditions of the platform, yielding an optimization formulation that may support production engineers in the daily or weekly operation of oil fields.
Another modeling issue addressed in this dissertation regards the splitting of flows in production gathering networks. In modern offshore oil fields, wells can be equipped with routing valves to direct their production to multiple manifold headers. Although flow splitting is a practice routinely adopted
by engineers in the operation of offshore platforms, the existing models for short-term production optimization do not account for splitting of flows and therefore require the wells to be connected to a single header. This dissertation developed an optimization model that is able to decide upon single or multiple routing in subsea equipment of offshore fields. One important aspect of model-based optimization, in addition to model accuracy, is the equivalence of degrees of freedom between the optimization model and the decision making process adopted by operators in practice. For instance, single-routed optimization models found in previous works did not consider the ability of splitting flows in the production gathering network. Without the same degrees of freedom, the optimal recommendations can not compete with analytic and practical methods adopted by operators, which may turn the optimization tools not attractive in practice. In fields where multiple routing is an option, the proposed automatic routing model is a promising alternative to help engineers in making optimal decisions regarding the short-term goals.
Unlike previous developments which focused on short-term production optimization, another subject addressed in this dissertation is the optimization of reservoirs which are constrained by the production gathering network. Although network constraints are typically handled in short-term optimization, they are disregarded or only limitedly handled in reservoir optimization. The disregard of such constraints may render operational plans unfeasible in practice, precluding their application in real-world fields. To this end, this dissertation proposed a methodology to handle network constraints in reservoir optimization, particularly in water flooding processes. The methodology was assessed in a simple black-oil reservoir model with complicated constraints regarding the operation of ESPs. The results elicited that the methodology enables the handling of network constraints in a much broader scale than previous works by decomposing the simulation and constraint evaluations in the time domain. Although the reservoir model utilized was synthetic and rather simple, the methodology can be extended to complex reservoir, enabling the development of optimal reservoir management policies which are feasible with respect to the network and processing facilities. Further, the optimal results can help to predict early capacity limitations on the processing installations or oversized equipment based on well production forecasts and network deliverability.
5.1 SUMMARY OF CONTRIBUTIONS
This dissertation combined models and optimization methodologies for the operation of oil fields in the short-term and long-term. In the shortterm, the contributions consist of a comprehensive study of MPWL models to approximate the nonlinear well production and pressure drop functions, and the modeling of flow splitting in production gathering networks of offshore systems for optimization purposes. In the long-term, a methodology was proposed to consider network constraints in reservoir optimization, particularly
in water-flooding processes. These contributions, seen from the standpoint of integrated operations, may be used to support production and reservoir engineers in decision making processes of real-world fields. A summary of the main developments of the dissertation are presented by chapter.
The contribution of Chapter 2 is about approximating and solving MINLPs that arise from the daily optimization of oil platforms. It was shown that MPWL models are effective tools for modeling complex, nonlinear functions that are obtained directly from sample or simulated data, and also from proxy nonlinear models. Piecewise-linear functions with both hypercube and simplex domains were studied regarding their approximation accuracy. The performance and effectiveness of all MPWL models were evaluated by means of computational and simulation analyses. While SOS2 was the fastest model for hypercube domains, the logarithmic model was the most efficient for simplex domains. The approximation errors can be decreased by adding more breakpoints to the function to a desired degree of accuracy. However, the computational cost increases significantly with many breakpoints because of the extra binary variables. This is a possible reason for a better performance of SOS2 and Log models, since the first adds binary variables by demand in the branching scheme, and in the second the number of binary variables grows logarithmically.
Chapter 3 advanced previous works by modeling flow splitting phenomena in oil fields with multiple routing options in subsea equipment. A nonlinear model and a MILP approximation based on a particular MPWL model (SOS2) were proposed to represent the flow splitting phenomena in gathering networks. The SOS2 model was chosen for its efficiency and because its implementation is relatively simple, but other models discussed in Chapter 2 could also be used. When contrasted against a commercial network simulator, the MILP model was able to represent the phenomena with high accuracy provided that sufficient breakpoints were available. The flow splitting model was incorporated to a mixed-integer formulation to optimize the production of an offshore field with multiple routing. A comparison with the traditional models found in the literature, which allow only single routing, showed that the model which allows multiple routing is more general and was able to determine operational settings that yield higher oil rates.
Chapter 4 focused on the interface between reservoir management and short-term optimization layers, particularly considering network constraints in water flooding processes. Network constraints have appeared in other chapters, where they were represented using mathematical programming formulations and solved using state-of-the-art mixed-integer programming solvers. Instead, in this work, the network was represented by a graph and several correlations were used to calculate pressure drop derivatives in the pipelines. An efficient methodology based on multiple shooting was developed to represent both network and reservoir equations in water flooding optimization problems. The network variables and constraints were coupled to the reservoir equations by extending algebraic variables in the MS formulation. The methodology
is flexible to handle complex network constraints in a much broader scale than previous works from the literature. The efficiency of the developed methodology relies on the use of parallelization and advanced techniques such as an MS formulation, an ODE solver with sensitivity capabilities, automatic differentiation and reduced-order SQP algorithm. The proposed methodology was able to handle complex network constraints such as the ones related to ESP operating envelopes in reservoir optimization problems.
5.2	FURTHER DEVELOPMENTS
A list of suggestions for future work follows:
•	Include temperature and energy conservation equations in the experiments of Chapter 2. By doing that, it would be possible to impose constraints on the difference of velocity of the fluids, possibly avoiding slugs in the multiphase flow.
•	Consider compressor scheduling [35] in the experiments conducted with the MPWL models in Chapter 2. The integrated optimization of gaslift distribution and compressor scheduling may result in improved decisions.
•	Identify problem-dependent cutting planes compatible with MPWL models. The motivation is that cutting-plane algorithms may reduce the computational time for refined MPWL approximations.
•	Apply the automatic routing model proposed in Chapter 3 in more complex production systems, possibly accounting for splitting of flows in other facilities. The gains with the automatic routing model may be even greater if the gathering network system is more complex and has more degrees of freedom, such as the network of Urucu field [80].
•	Improve in the rSQP algorithm used in Chapter 4 to handle infeasible initial solutions. One possible direction is the use of an augmented Lagrangian method with a trust region in place of a line search.
•	Extend the methodology proposed in Chapter 4 for three-phase fluid reservoirs. This would allow modeling other lifting methods such as gas-lift, but further investigation on pump modeling and processing constraints would be required.
•	Develop an implicit coupling for reservoir and network models. This would allow to control the wells through the network, meaning that the controls of the integrated system could be choke openings or ESP frequencies, instead of BHPs and well rates. The challenge in this case is to converge both reservoir and network equations simultaneously since their dynamics are quite different and thus the equations of the integrated production system will be stiff.
• Include discrete variables in the methodology to optimize reservoirs with network constraints. One application is the integrated optimization of reservoir controls and infrastructure design of the field. One possible direction is to use the theory of mixed-integer optimal control developed by Sager[81].
APPENDIX A - DETAILED RESULTS OF CHAPTER 4
This appendix contains more detailed results for the experiments and simulation analysis presented on Chapter 4, particularly in Section 4.5.5. The results are divided in three sections which present the production and injection profiles of the wells and the operation trajectories of the ESPs on the network for each case study of the simulation analysis.
RESERVOIR OPTIMIZATION WITHOUT NETWORK CONSTRAINTS
This section presents the results per well for a case study in which the reservoir production is optimized without network constraints. Figures A.1(a) and A.1(b) show the injection profile of wells i1 and i2. The production profile of wells p1, p2, p3, p4 and p5 are depicted in Figures A.2(a), A.3(a), A.4(a), A.5(a) and A.6(a), respectively. Figures A.2(b), A.3(b), A.4(b), A.5(b) and A.6(b) show the operation trajectory of the ESPs of production wells p1, p2, p3, p4 and p5, respectively.
301
Well:i1 Type:rate Sign:Injector
299
2
0
300
500 ■—
F
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
500 |
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
(a) Injection profile of well i1
(b) Injection profile of well i2.
Figure A.1: Network unconstrained: injection profile of wells i1 and
i2.
Well:p1 Type:bhp Sign:Producer
150
50
100
E,
(a) Production profile of well p1
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
3500
3000
2500
2000
1500
1000
500
(b) ESP operation trajectory for well p1.
Figure A.2: Network unconstrained: production profile of well pl.
200

150
-O
100
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
3500
3000
2500
2000
1500
1000
500
(b) ESP operation trajectory for well P2.
(a) Production profile of well p2.
Figure A.3: Network unconstrained: production profile of well p2.
NETWORK CONSTRAINED RESERVOIR OPTIMIZATION
This section presents the results per well for a case study in which network constraints are taken into account in the reservoir optimization. The network constraints refer to the boundaries of the ESP operating envelopes. Figures A.7(a) and A.7(b) show the injection profile of wells it and i2. The production profile of wells p1, p2, p3, p4 and p5 are depicted in Figures A.8(a), A.9(a), A.10(a), A.11(a) and A.12(a), respectively. Figures A.8(b), A.9(b), A.10(b), A.11(b) and A.12(b) show the operation trajectory of the ESPs of production wells p1, p2, p3, p4 and p5, respectively.
Well:p3 Type:bhp Siqn:Producer
0	500	1000	1500	2000	2500	3000	3500	4000
1	---------i--------i--------i--------i---------i--------i--------i--------
0	500	1000	1500	2000	2500	3000	3500	4000
101	|---i-----i----i-----i----i-----i-----i----
H 100	-
99 I----1----1-----1----1-----1----1-------1--
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
(a) Production profile of well p3.
3500
3000
2500
2000
1500
1000
500
(b) ESP operation trajectory for well P3.
Figure A.4: Network unconstrained: production profile of well \mathrm{p}3.
Well:p4 Type:bhp Siqn:Producer
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
(a) Production profile of well p4.
3500
3000
2500
2000
1500
1000
500
(b) ESP operation trajectory for well p4.
Figure A.5: Network unconstrained: production profile of well \mathrm{p}4.
GREEDY STRATEGY IN RESERVOIR OPTIMIZATION
This section presents the results per well for a case study in which the reservoir is optimized with a greedy strategy instead of a long-term approach. Figures A.13(a) and A.13(b) show the injection profile of wells i1 and i2. The production profile of wells p1, p2, p3, p4 and p5 are depicted in Figures A.14(a), A.15(a), A.16(a), A.17(a) and A.18(a), respectively. Figures A.14(b), A.15(b), A.16(b), A.17(b) and A.18(b) show the operation trajectory of the ESPs of production wells p1, p2, p3, p4 and p5, respectively.
Well:p5 Tvpe:bhp Siqn:Producer
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
local liq. flow rate (sm3/d)
3500
3000
2500
2000
1500
1000
500
(a) Production profile of well \mathrm{p}5.
(b) ESP operation trajectory for well p5.
Figure A.6: Network unconstrained: production profile of well \mathrm{p}5.
300
299.5
E.
cr 299
2
1'
0
0	500	'000	'500	2000	2500	3000	3500	4000
500*-----1-----1-----1-----1------1-----1-----1-----1
'-------------------------------------------
0 I-----.-----.-----.-----.-----.-----.-----.-----
0	500	'000	'500	2000	2500	3000	3500	4000
time(day)
(a) Injection profile of well il.
'------------
0	500	1000	1500	2000	2500	3000	3500	4000
500
-Q
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
(b) Injection profile of well i2.
Figure A.7: Network constrained: injection profile of wells it and
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
3500
3000
2500
2000
1500
1000
500
(a) Production profile of well pl.
(b) ESP operation trajectory for well pl.
Figure A.8: Network constrained: production profile of well pl.
Well:p2 Type:bhp Sign:Producer
______________________________
150
100
50
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
(a) Production profile of well mathrm{p}2.
3500
3000
2500
2000 £ S
1500 -I
1000
500
(b) ESP operation trajectory for well P2-
Figure A.9: Network constrained: production profile of well mathrm{p}2.
100.0000000001
100.00000000005
1000
3000
4000
2000
time(day)
100
0
1000
3500
3000
2500
2000
1500
500
(a) Production profile of well mathrm{p}3.
150
Well:p4 Type:bhp Sign:Producer
100 E.
50
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
3500
3000
2500
2000
1500
1000
500
(a) Production profile of well p4.
(b) ESP operation trajectory for well p4.
Figure A.11: Network constrained: production profile of well \mathrm{p}4.
200
Well:p5 Type:bhp Sign:Producer
100
E,
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
3500
3000
2500
2000
1500
1000
500
(a) Production profile of well p5
(b) ESP operation trajectory for well p5.

Figure A.12: Network constrained: production profile of well \mathrm{p}5.
Well:i1 Control target:rate Type:Injector
Well:i2 Control target:rate Type:Injector
E
o° ---------,-------,------,------,------,------,------,----
0	500	1000	1500	2000	2500	3000	3500	4000
E
o° I---------,------,------,-------,------,------,-------,----
0	500	1000	1500	2000	2500	3000	3500	4000
_ 301
■S
300
E,
299
134
500
0	500	1000	1500	2000	2500	3000	3500	4000
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
(a) Injection profile of well i1.
133 k
cr	I_______i_______i_______i_______i_______i_______i_______i_______
0	500	1000	1500	2000	2500	3000	3500	4000
500
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
(b) Injection profile of well i2.
Figure A.13: Greedy strategy: injection profile of wells \mathrm{i}1 and \mathrm{i}2.
200
100
0
Well:p1 Control target:bhp Type:Producer
0	500	1000	1500	2000	2500	3000	3500	4000
100
50
0
0	500	1000	1500	2000	2500	3000	3500	4000
100.000001
100.0000005
Q.
JD
100
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
3500
3000
2500
2000 £ S
1500 -I
1000
500
(a) Production profile of well p1.
(b) ESP operation trajectory for well pt.
Figure A.14: Greedy strategy: production profile of well pl.
Well:p2 Control target:bhp Type:Producer
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
3500
3000
2500
2000 £ S
1500 -I
1000
500
Well:p3 Control target:bhp Type:Producer
bhp (bar)	% m 3/daV)	% m 3/daV)	77	bhp(bar)
200
100
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
Production profile of well p3.
3500
3000
2500
2000
1500 -I
1000
500
(b) ESP operation trajectory for well P3.
Figure A.16: Greedy strategy: production profile of well p3.
Well:p4 Control target:bhp Type:Producer
200
100
0
0	500	1000	1500	2000	2500	3000	3500	4000
time(day)
3500
3000
2500
2000
1500 -I
1000
500
bhp (bar)	%	3/day)	qo (m 3/day)
Well:p5 Control target:bhp Type:Producer
200
100
0
(a) Production profile of well p5.
(b) ESP operation trajectory for well p5.
3500
3000
2500
2000
500
1000
500
time (days)
Figure A.18: Greedy strategy: production profile of well p5
REFERENCES
1	JAHN, F.; COOK, M.; GRAHAM, M. Hydrocarbon exploration &amp;amp; production. 2. ed. [S.l.]: Elsevier, 2008. (Developments in Petroleum Science, v. 55).
2	FOSS, B.; JENSEN, J. P. Performance analysis for closed-loop reservoir management. SPE Journal, Society of Petroleum Engineers, v. 16, n. 1, p. 183-190, 2011.
3	STANKO, M.; GOLAN, M. et al. Exploring the potential of model-based optimization in oil production gathering networks with ESP-produced, high water cut wells. In: Proc. of the 17th International Conference on Multiphase Production Technology. Cannes, France: BHR Group, 2015.
4	YETEN, B. et al. Decision analysis under uncertainty for Smart Well deployment. Journal of Petroleum Science &amp;amp; Engineering, v. 43, p. 183-199, 2004.
5	CAMPONOGARA, E. et al. An automation system for gas-lifted oil wells: Model identification, control, and optimization. Journal of Petroleum Science and Engineering, Elsevier, v. 70, n. 3, p. 157-167, 2010.
6	SILVA, T. L. Formulações inteiras mistas para modelos lineares por partes multidimensionais: aplicacões na otimizacao da produção de petróleo sob restrições de pressão. Dissertation (Master) — Department of Automation and Systems Engineering, Federal University of Santa Catarina, 2012. In Portuguese.
7	MOISÉS, G. V.; ROLIM, T. A.; FORMIGEI, J. M. Gedig: Petrobras corporate program for digital integrated field management. In: Proc. of the SPE Intelligent Energy Conference and Exhibition. Amsterdam, The Netherlands: [s.n.], 2008.
8	CODAS, A.; CAMPONOGARA, E. Mixed-integer linear optimization for optimal lift-gas allocation with well-separator routing. European Journal of Operational Research, v. 212, p. 222-231, 2012.
9	BUITRAGO, S.; RODRÍGUEZ, E.; ESPIN, D. Global optimization techniques in gas allocation for continuous flow gas lift systems. In: SPE Gas Technology Symposium. Calgary, Alberta, Canada: [s.n.], 1996.
10	ALARCÓN, G. A.; TORRES, C. F.; GÓMEZ, L. E. Global optimization of gas allocation to a group of wells in artificial lift using nonlinear constrained programming. Journal of Energy Resources Technology, v. 124, n. 4, p. 262268, 2002.
11	CAMPONOGARA, E.; CONTO, A. de. Lift-gas allocation under precedence constraints: MILP formulation and computational analysis. IEEE Transactions on Automation Science and Engineering, v. 6, n. 3, p. 544-551, July 2009.
12	MISENER, R.; GOUNARIS, C. E.; FLOUDAS, C. A. Global optimization of gas lifting operations: A comparative study of piecewise linear formulations. Industrial &amp;amp; Engineering Chemistry Research, v. 48, n. 13, p. 6098-6104, 2009.
13	BEGGS, D.; BRILL, J. A study of two-phase flow in inclined pipes. Journal of Petroleum technology, Society of Petroleum Engineers, v. 25, n. 5, p. 607-617, 1973.
14	LITVAK, M.; DARLOW, B. Surface network and well tubinghead pressure constraints in compositional simulation. In: Proc. of the SPE ReservoirSimulation Symposium. San Antonio, Texas: [s.n.], 1995.
15	KOSMIDIS, V.; PERKINS, J.; PISTIKOPOULOS, E. Optimization of well oil rate allocations in petroleum fields. Industrial &amp;amp; Engineering Chemistry Research, ACS Publications, v. 43, n. 14, p. 3513-3527, 2004.
16	KOSMIDIS, V.; PERKINS, J.; PISTIKOPOULOS, E. A mixed integer optimization formulation for the well scheduling problem on petroleum fields. Computers &amp;amp; Chemical Engineering, Elsevier, v. 29, n. 7, p. 1523-1541, 2005.
17	GUNNERUD, V.; FOSS, B. Oil production optimization-a piecewise linear model, solved with two decomposition strategies. Computers &amp;amp; Chemical Engineering, v. 34, n. 11, p. 1803-1812, 2010.
18	VIELMA, J. P.; AHMED, S.; NEMHAUSER, G. Mixed-integer models for nonseparable piecewise-linear optimization: Unifying framework and extensions. Operations Research, v. 58, n. 2, p. 303-315, 2010.
19	TODD, M. Union jack triangulations. In: KARAMARDIAN, S. (Ed.). Fixed Points: algorithms and applications. [S.l.]: Academic Press, New York, London, 1977. p. 315-336.
20	CROXTON, K. L.; GENDRON, B.; MAGNANTI, T. L. A comparison of mixed-integer programming models for nonconvex piecewise linear cost minimization problems. Management Science, v. 49, p. 1268-1273, 2003.
21	JEROSLOW, R. G.; LOWE, J. K. Modelling with integer variables. In: Mathematical Programming at Oberwolfach II. [S.l.]: Springer Berlin Heidelberg, 1984. v. 22, p. 167-184.
22	MEYER, R. R. Mixed integer minimization models for piecewise-linear functions of a single variable. Discrete Mathematics, v. 16, n. 2, p. 163-171, 1976.
23	SHERALI, H. D. On mixed-integer zero-one representations for separable lower-semicontinuous piecewise-linear functions. Operations Research Letters, v. 28, n. 4, p. 155-160, 2001.
24	IBARAKI, T. Integer programming formulation of combinatorial optimization problems. Discrete Mathematics, v. 16, p. 39-52, 1976.
25	VIELMA, J.; KEHA, A.; NEMHAUSER, G. Nonconvex, lower semicon-tinuous piecewise linear optimization. Discrete Optimization, v. 5, n. 2, p. 467-488, 2008.
26	VIELMA, J.; NEMHAUSER, G. Modeling disjunctive constraints with a logarithmic number of binary variables and constraints. Mathematical Programming, v. 128, n. 1-2, p. 49-72, 2009.
27	SILVA, T. L.; CODAS, A.; CAMPONOGARA, E. A computational analysis of convex combination models for multidimensional piecewise-linear approximation in oil production optimization. In: Proc. of IFAC Workshop on Automatic Control in Offshore Oil and Gas Production. Trondheim, Norway: [s.n.], 2012.
28	BALAKRISHNAN, A.; GRAVES, S. C. A composite algorithm for a concave-cost network flow problem. Networks, v. 19, n. 2, p. 175-202, 1989.
29	LEE, J.; WILSON, D. Polyhedral methods for piecewise-linear functions i: the lambda method. Discrete Applied Mathematics, v. 108, n. 3, p. 269-285, 2001.
30	DANTZIG, G. On the significance of solving linear programming problems with some integer variables. Econometrica, Journal of the Econometric Society, v. 28, n. 1, p. 30-44, 1960.
31	JEROSLOW, R. G.; LOWE, J. K. Experimental results on the new techniques for integer programming formulations. Journal of the Operational Research Society, v. 36, n. 5, p. 393-403, 1985.
32	KEHA, A. B.; FARIAS JR, I. R. de; NEMHAUSER, G. L. Models for representing piecewise linear cost functions. Operations Research Letters, v. 32, p. 44-48, 2004.
33	PADBERG, M. Approximating separable nonlinear functions via mixed zero-one programs. Operations Research Letters, v. 27, n. 1, p. 1-5, 2000.
34	BEALE, E. M. L.; TOMLIN, J. A. Special facilities in a general mathematical programming system for non-convex problems using ordered sets of variables. In: Proc. of the Fifth International Conference on Operations Research. [S.I.: s.n.], 1970. p. 447-454.
35	CAMPONOGARA, E.; NAZARI, L. F.; MENESES, C. N. A revised model for compressor design and scheduling in gas-lifted oil fields. IIE Transactions, v. 44, n. 5, p. 342-351, 2012.
36	BEALE, E. M. L. Branch and bound methods for numerical optimization of non-convex functions. Computational Statistics, v. 80, p. 11-20, 1980.
37	CODAS, A. et al. Integrated production optimization of oil fields with pressure and routing constraints: the Urucu field. Computers &amp;amp; Chemical Engineering, v. 46, p. 178-189, 2012.
38	SILVA, T. L.; CAMPONOGARA, E. A computational analysis of multidimensional piecewise-linear models with applications to oil production optimization. European Journal of Operational Research, v. 232, n. 3, p. 630-642, 2014.
39	TOMLIN, J. A. Special ordered sets and an application to gas supply operations planning. Mathematical Programming, v. 42, n. 1-3, p. 69-84, 1988.
40	AGUIAR, M. A. S.; CAMPONOGARA, E.; SILVA, T. L. A mixed-integer convex formulation for production optimization of gas-lifted oil wells with routing and pressure constraints. Brazilian Journal of Chemical Engineering, v. 31, n. 2, p. 439-455, 2014.
41	FOURER, R.; GAY, D. M.; KERNIGHAN, B. W. AMPL: A Modeling Language for Mathematical Programming. [S.l.]: Boyd Fraser Publishing Company, 1993.
42	CAMPONOGARA, E.; NAKASHIMA, P. H. R. Solving a gas-lift optimization problem by dynamic programming. European Journal of Operational Research, v. 174, n. 2, p. 1220-1246, 2006.
43	JANSEN, J.; BROUWER, R.; DOUMA, S. G. Closed loop reservoir management. In: Proc. of the SPE Reservoir Simulation Symposium. The Woodlands, Texas: [s.n.], 2009.
44	WANG, C.; LI, G.; REYNOLDS, A. C. Production optimization in closed-loop reservoir management. SPE Journal, Society of Petroleum Engineers, v. 14, n. 3, p. 506-523, 2010.
45	PETERS, L. et al. Results of the Brugge benchmark study for flooding optimization and history matching. SPE Reservoir Evaluation &amp;amp; Engineering, v. 13, n. 03, p. 391 - 405, 2010.
46	CHEN, Z.; HUAN, G.; MA, Y. Computational methods for multiphase flows in porous media. Philadelphia, PA: Society for Industrial and Applied Mathematics, 2006.
47	JANSEN, J.-D.; BOSGRA, O. H.; HOF, P. M. V. den. Model-based control of multiphase flow in subsurface oil reservoirs. Journal of Process Control, v. 18, n. 9, p. 846 - 855, 2008.
48	JANSEN, J. Adjoint-based optimization of multi-phase flow through porous media: A review. Computers &amp;amp; Fluids, Elsevier Ltd, v. 46, n. 1, p. 40-51, jul 2011.
49	SAPUTELLI, L.; NIKOLAOU, M.; ECONOMIDES, M. Real-time reservoir management: A multiscale adaptive optimization and control approach. Computational Geosciences, v. 10, n. 1, p. 61-96, 2006.
50	ESSEN, G. van; HOF, P. Van den; JANSEN, J.-D. Hierarchical long-term and short-term production optimization. SPE Journal, Society of Petroleum Engineers, v. 16, n. 1, p. 191-199, 2011.
51	SUWARTADI E., K. S. F. B. Nonlinear output constraints handling for production optimization of oil reservoirs. Computational Geosciences, Springer Netherlands, v. 16, n. 2, p. 499-517, 2011.
52	CHEN, C. et al. Closed-loop reservoir management on the brugge test case. Computational Geosciences, v. 14, n. 4, p. 691-703, 2010. ISSN 1573-1499.
53	CODAS, A.; FOSS, B.; CAMPONOGARA, E. Output constraint handling and parallelization for oil-reservoir control optimization by means of multiple shooting. SPE Journal, v. 20, n. 04, p. 856-871, August 2015.
54	GOKHAN, H.; SANTANU, B.; WADE, B. Integration of a Field Surface and Production Network With a Reservoir Simulator. SPE ComputerApplications, n. June, 1997.
55	SCHIOZER, D. J. Simultaneous Simulation of Reservoir and Surface Facilities. Thesis (Doctoral), 1994.
56	TINGAS, J. et al. Integated reservior and surface network simulation in reservoir management of southern north sea gas reservoirs. In: SOCIETY OF PETROLEUM ENGINEERS. European Petroleum Conference. [S.I.], 1998.
57	KOSMALA, A. et al. Coupling of a Surface Network With Reservoir Simulation. In: SPE Annual Technical Conference and Exhibition. [S.l.]: Society of Petroleum Engineers, 2003.
58	DAVIDSON, J.; BECKNER, B. Integrated Optimization for Rate Allocation in Reservoir Simulation. Proc. of SPE Reservoir Simulation Symposium, Society of Petroleum Engineers, n. eq 1, p. 1-7, feb 2003.
59	COATS, B. et al. A Generalized Wellbore and Surface Facility Model, Fully Coupled to a Reservoir Simulator. SPE Reservoir Evaluation &amp;amp; Engineering, v. 7, n. 02, p. 132-142, apr 2004.
60	RAHMAWATI, S. D. et al. Integrated field operation and optimization. Journal of Petroleum Science and Engineering, v. 81, p. 161 - 170, 2012.
61	GAO, M. Reservoir and Surface Facilities Coupled Through Partially And Fully Implicit Approaches. Dissertation (Master) — Texas A&amp;amp; M University, 2014.
62	PEACEMAN, D. W. Interpretation of well-block pressures in numerical reservoir simulation. Society of Petroleum Engineers Journal, v. 23, n. 3, p. 531 - 543, June 1983.
63	LIE, K.-A. et al. Open-source matlab implementation of consistent discretisations on complex grids. Computational Geosciences, v. 16, n. 2, p. 297-322, 2012.
64	BEGGS, D. H.; BRILL, J. P. A study of two-phase flow in inclined pipes. Journal of Petroleum Technology, v. 25, n. 05, p. 607 - 617, 1973.
65	BRILL, J. P.; MUKHERJEE, H. K. Multiphase flow in wells. Richardson, TX: Society of Petroleum Engineers, 1999. (SPE Monograph Series, v. 17).
66	JANSEN, J. D. Nodal analysis of oil and gas wells - system modeling and numerical implementation. [S.l.]: SPE Textbook Series. SPE, Richardson. In Production, 2016.
67	HAGEDORN, A. R.; BROWN, K. E. et al. Experimental study of pressure gradients occurring during continuous two-phase flow in small-diameter vertical conduits. Journal of Petroleum Technology, Society of Petroleum Engineers, v. 17, n. 04, p. 475-484, 1965.
68	MOODY, L. F. Eriction factors for pipe flow. Transactions of the AMSE, v. 66, n. 8, p. 671-684, 1944.
69	PAYNE, G. A. et al. Evaluation of inclined-pipe, two-phase liquid holdup and pressure-loss correlation using experimental data. Journal of Petroleum Technology, v. 31, n. 09, p. 1198 - 1208, 1979.
70	COLEBROOK, C. F. et al. Turbulent flow in pipes, with particular reference to the transition region between the smooth and rough pipe laws. Journal of the Institution of Civil Engineers, v. 12, n. 8, p. 393-422, 1939.
71	PAVLOV, A. et al. Modelling and model predictive control of oil wells with electric submersible pumps. In: Proc. of the IEEE Conference on Control Applications (CCA). Antibes, France: [s.n.], 2014. p. 586-592.
72	AHUJA, R. K.; MAGNANTI, T. L.; ORLIN, J. B. Network flows: theory, algorithms, and applications. 1. ed. Philadelphia, PA: Prentice hall, 1993.
73	GRIMSTAD, B. et al. Global optimization of multiphase flow networks using spline surrogate models. Computers &amp;amp; Chemical Engineering, v. 84, n. 4, p. 237-254, Jan 2015.
74	BOCK, H. G.; PLITT, K.-J. A multiple shooting algorithm for direct solution of optimal control problems. In: PROC. OF THE 9TH IFAC WORLD CONGRESS. Budapest, Hungary, 1984.
75	HINDMARSH, A. C. et al. SUNDIALS: Suite of nonlinear and differen-tial/algebraic equation solvers. ACM Transactions on Mathematical Software (TOMS), ACM, v. 31, n. 3, p. 363-396, 2005.
76	CODAS, A. REduced Multiple Shooting Optimizer (REMSO). 2015. Available from Internet:&amp;lt;https://github.com/iocenter/remso&gt;.
77	LIE, K.-A. et al. Open-source matlab implementation of consistent discretisations on complex grids. Computational Geosciences, v. 16, n. 2, p. 297-322, 2012.
78	ROYSEM, E. H.; ALFSEN, M. Optimization of investment strategy related to subsea water separator using reservoir simulation. Dissertation (Master) — Norwegian University of Science and Technology, December 2012.
79	FISCHETTI, M.; GLOVER, F.; LODI, A. The feasibility pump. Mathematical Programming, Springer, v. 104, n. 1, p. 91-104, 2005.
80	CODAS, A. et al. Integrated production optimization of oil fields with pressure and routing constraints: The Urucu field. Computers &amp;amp; Chemical Engineering, Elsevier, v. 46, p. 178-189, 2012.
81	SAGER, S. Numerical methods for mixed-integer optimal control problems. [S.l.]: Der andere Verlag Tonning, Lubeck, Marburg, 2005.</field>
	</doc>
</add>