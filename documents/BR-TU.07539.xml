<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.07539</field>
		<field name="filename">12258_316862.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">UNIVERSIDADE FEDERAL DE SANTA CATARINA DEPARTAMENTO DE AUTOMAÇÃO E SISTEMAS PÓS-GRADUAÇÃO EM ENGENHARIA DE AUTOMAÇÃO E SISTEMAS
João Ricardo Castro Melo
CONTRIBUIÇÕES AO DESENVOLVIMENTO DE UM PERFILÔMETRO ÓPTICO A LASER PARA MEDIÇÃO E VISUALIZAÇÃO DA GEOMETRIA INTERNA DE DUTOS
Florianópolis
UNIVERSIDADE FEDERAL DE SANTA CATARINA DEPARTAMENTO DE AUTOMAÇÃO E SISTEMAS PÓS-GRADUAÇÃO EM ENGENHARIA DE AUTOMAÇÃO E SISTEMAS
João Ricardo Castro Melo
CONTRIBUIÇÕES AO DESENVOLVIMENTO DE UM PERFILÔMETRO ÓPTICO A LASER PARA MEDIÇÃO E VISUALIZAÇÃO DA GEOMETRIA INTERNA DE DUTOS
Dissertação submetida ao Programa de Pós-Graduação em Engenharia de Automação e Sistemas da Universidade Federal de Santa Catarina como parte dos requisitos para a obtenção do Grau de Mestre em Engenharia de Automação e Sistemas.
Orientador: Prof. Dr. Armando Albertazzi Gonçalves Júnior
Florianópolis
Ficha de identificação da obra elaborada pelo autor, através do Programa de Geração Automática da Biblioteca Universitária da UFSC
Melo, João Ricardo Castro contribuições ao desenvolvimento de um perfllômetro óptico a laser para medição e visualização da geometria interna de dutos [dissertação] / João Ricardo castro Melo ;
orientador. Armando Albertazzi Gonçalves Júnior -Florianópolis, sc, 2012.
143 p. ; 21CTU
Dissertação «mestrado) - universidade Federal de santa Catarina, centro Tecnológico. Programa de Pós-Graduação em Engenharia de Automação e Sistemas.
inclui referências
1. Engenharia de Automação e Sistemas. 2. Perfllometrla interna. 3. Sistemas embarcados. 4. Realidade virtual. I. Gonçalves Júnior, Armando Albertazzi. II. universidade Federal de santa catarina. Programa de Pós-Graduação em Engenharia de Automação e Sistemas. III. Título.
João Ricardo Castro Melo
CONTRIBUIÇÕES AO DESENVOLVIMENTO DE UM PERFILÔMETRO ÓPTICO A LASER PARA MEDIÇÃO E VISUALIZAÇÃO DA GEOMETRIA INTERNA DE DUTOS
Esta Dissertação foi julgada adequada para a obtenção do Título de Mestre em Engenharia de Automação e Sistemas, e foi aprovada em sua forma final pelo Programa de Pós-Graduação em Engenharia de Automação e Sistemas da Universidade Federal de Santa Catarina.
Florianópolis-SC, 17 de dezembro de 2012.
Prof. Armando Albertazzi Gonçalves Jr., Dr. Orientador
Prof. Jomi Fred Hübner, Dr.
Coordenador do Curso
Banca Examinadora:
Prof.a Fabiana Rodrigues Leta, Dr.a Universidade Federal Fluminense
Prof. Marcelo Ricardo Stemmer, Dr.
Prof. Tiago Loureiro Figaro da Costa Pinto, Dr.
À minha avó Iracema (in memoriam).
AGRADECIMENTOS
Ao professor Armando Albertazzi pela enorme paciência comigo. Também pela oportunidade dada de trabalhar no projeto PEROLA e ser seu orientando. É alguém com quem aprendo muito e pretendo passar isto adiante.
Ao Eng. Pedro Buschinelli pela grande ajuda na confecção do texto e pela experiência de trabalho no laboratório.
À professora Analucia Fantin pela orientação passada que ecoou nesta dissertação.
Aos bolsistas Luan Volpato e Rafael Bergamin, cujos trabalhos contribuíram com esta dissertação.
Aos professores do Departamento de Automação e Sistemas pela instrução, o que tem nesta dissertação um de seus resultados.
Aos meus pais, José Rubens e Maria Lúcia, pela estrutura familiar e apoio nos momentos de necessidade.
À minha namorada, Tallulah, quem deu bastante incentivo e forças para a realização do mestrado.
Aos demais familiares que me incentivaram neste período.
Ao IBP, Capes e Petrobras pelo suporte financeiro.
Aos demais companheiros do LABMETRO e a todos os que contribuíram com a realização deste trabalho ou que me deram apoio, direta ou indiretamente.
Muito obrigado.
RESUMO
Tubulações metálicas são comumente utilizadas na indústria petroquímica para o transporte de produtos, matérias-primas e fluidos de processo. Estas tubulações estão sujeitas a avarias, inclusive decorrentes da própria interação com o material transportado, como ocorre no caso da corrosão interna. Devido à alta importância das tubulações metálicas e à consequente demanda da monitoração da sua integridade, novos métodos de inspeção geométrica interna têm sido desenvolvidos. Na categoria de métodos ópticos, foi desenvolvido um sensor por triangulação cônica a laser no LABMETRO-EMC-UFSC capaz de medir o perfil geométrico de uma secção de tubo a cada aplicação. Esta dissertação tem o objetivo de fornecer subsídios para que se possa utilizar este sensor em uma completa solução de perfilometria de tubos de refinarias de petróleo e de exploração sujeitos à corrosão interna, respeitadas as características do sensor e uma estrutura mecânica predefinida. Para possibilitar a medição do perfil geométrico de uma região completa formada por secções contíguas, foi desenvolvido um sistema de aquisição e disponibilização de imagens, através de hardware e software embarcados no novo perfilômetro, além de uma biblioteca de gerenciamento da câmera utilizada no sensor óptico. A integração destas ferramentas com o sensor e outros componentes do perfilômetro possibilitou o desenvolvimento de um protótipo capaz de adquirir a geometria interna de uma região de um tubo na forma de uma nuvem de pontos cilíndrica. Para realizar a leitura dos perfis geométricos inspecionados de forma inovadora e poderosa, foi desenvolvido um sistema de visualização e análise de nuvens de pontos utilizando técnicas de realidade virtual. O uso conjunto destas ferramentas permitiu a correta aplicação do perfilômetro baseado no sensor óptico por triangulação cônica a laser na inspeção de tubos de exploração de gás severamente danificados por corrosão interna. Portanto, esta dissertação demonstra a adequabilidade da tecnologia apresentada na inspeção geométrica de tubos na indústria de petróleo e gás.
Palavras-chave: Perfilometria interna. Sistemas embarcados. Realidade virtual.
ABSTRACT
Metal pipes are commonly used in the petrochemical industry to transport goods, raw materials and process fluids. These pipes are subject to damage, including those arisen from its interaction with the transported material, as it is the case of internal corrosion. Due to the high importance of metal pipes and the consequent demand of the monitoring of their integrity, new internal geometry inspection methods have been developed. With regard to the optical category, LABMETRO-EMC-UFSC has developed an optical sensor which uses laser conical triangulation and is capable of measuring the geometric profile of one pipe section per application. The objective of this study is to provide support for the implementation of this sensor into a complete profilometry solution, given the characteristics of the sensor and a default mechanical structure. This profilometer is used to assess the geometric inspection of pipes employed at oil refineries and exploration sites, for these pipes are subject to internal corrosion. To enable the measurement of the geometric profile of a full region formed by contiguous sections, this study has developed a system that acquires images through embedded hardware and software in the new profilometer. These images are made available through a management library used for the camera of the optical sensor. The integration of these tools with the sensor and the other profilometer components has enabled the development of a prototype which is able to acquire the internal geometry of the region of a pipe in the form of a cylindrical cloud of points. In order to read the acquired geometric profiles in an innovative and powerful manner, a virtual reality system has been developed for visualization and analysis of the clouds of points. The combined use of these tools has allowed the correct application of the profilometer based on the use of laser conical triangulation sensor. Ultimately, this thesis demonstrates the capability of the laser profilometer to geometrically inspect corroded pipes in the oil and gas industry.
Keywords: Internal profilometry. Embedded systems. Virtual reality.
LISTA DE FIGURAS
Figura 1 - Classificação das tubulações.............................29
Figura 2 - Tubo de forno de refinaria apresentando corrosão interna. .. 31 Figura 3 - Trecho de gasoduto apresentando corrosão em região brevemente posterior a uma curva na tubulação.......................31
Figura 4 - Uma das montagens do Pig Palito. Destaque para as hastes ao redor das peças mais centrais.......................................37
Figura 5 - Outra montagem de um pig palito projetada para dutos de tamanhos variáveis entre 100 a 180 mm (4" a 7").....................38
Figura 6 - Apresentação dos dados coletados pelo Pig Palito. Os pontos em vermelho representam ocorrência de perda de material.............39
Figura 7 - Fluxo magnético induzido passando (a) pelo ar, (b) quase totalmente pela chapa metálica colocada e (c) com algumas linhas de fluxo em fuga, causada pela diminuição da espessura da chapa naquela região..............................................................41
Figura 8 - Um modelo de pig MFL cincunferencial da empresa Battelle, EUA. Destaque para a direção do fluxo magnético imposto pelo dispositivo.........................................................42
Figura 9 - Um modelo de pig MFL axial da empresa Det Norske Veritas, Noruega.............................................................43
Figura 10 - Um modelo de pig MFL axial do CENPES - Petrobras.......43
Figura 11 - Dados coletados pelos sensores de um pig MFL da empresa Det Norske Veritas..................................................44
Figura 12 - Uma representação dos dados obtidos por um pig MFL utilizando código de cores para os valores de raio obtidos..........45
Figura 13 - Concepção artística de um pig ultrassónico dentro de um duto. Destaque para os transdutores ultrassónicos...................46
Figura 14 - Um robó com transdutor ultrassónico utilizável na parte externa de dutos....................................................47
Figura 15 - Uma visualização do resultado obtido por um pig ultrassónico....................................................... 48
Figura 16 - O resultado da medição do corpo de prova apresentado na figura 14. A imagem resultante foi mapeada como textura em um cilindro virtual....................................................48
Figura 17 - Conceito de triangulação óptica.........................50
Figura 18 - Conceito de triangulação óptica cónica a laser aplicado no sensor............................................................. 50
Figura 19 - O algoritmo do software de medição transforma uma imagem numa lista de valores de ponto-flutuante. Cada valor da lista
posição na lista...................................................52
Figura 20 - Uma imagem capturada pelo sensor óptico. A faixa mais
clara é advinda do laser projetado na superfície interna do tubo...52
Figura 21 - Uma das primeiras montagens do sensor óptico a laser em bancada (Buschinelli, 2007). Na época era utilizado um segundo espelho cônico disposto de frente a câmera, o qual foi removido nas concepções atuais.............................................................53
Figura 22 - Foto do sensor óptico, em sua concepção atual, aplicado a um padrão de calibração anelar.....................................54
Figura 23 - Sensor óptico a laser, em sua concepção atual, aplicado a um gabarito geométrico................................................54
Figura 24 - Resultado de medição, realizada pelo sensor óptico, do gabarito da figura 21. É mostrado também o valor dos raios dos pontos do gabarito obtidos por uma máquina de medir por coordenadas.......55
Figura 25 - Esquema geral de um sistema embarcado..................57
Figura 26	- Um diagrama simplificado e genérico de um
microcontrolador...................................................58
Figura 27 - O fluxo de dados em aplicações de CG, desde o software até a tela.............................................................64
Figura 28 - Uma mesma cena fotografada de dois pontos levemente separados..........................................................66
Figura 29 - O deslocamento controlado do sensor ao longo do eixo do tubo permite a aquisição da geometria de sucessivas secções........70
Figura 30 - As k listas de n valores adquiridos em coordenadas polares devem ser concatenadas de modo a formar uma tabela de ordem n x k em coordenadas cilíndricas.........................................70
Figura 31 - Reconstrução 3D da geometria interna (vista externa) de um trecho de tubo metálico utilizando codificação de cores para valores de raio...............................................................71
Figura 32 - Diagrama funcional básico IDEF0 de mais alto nível do PEROLA-1...........................................................72
Figura 33 - Detalhamento da função de aquisição e disponibilização de imagens............................................................73
Figura 34 - Detalhamento da função de extração de nuvem de pontos cilíndrica correspondente à região inspecionada....................74
Figura 35 - Diagrama AADL de sistemas e dispositivos do PEROLA-I. Os dados e o dispositivo em cor mais fraca representam um caminho secundário, utilizado apenas na indisponibilidade da via principal.81
Figura 36 - Modelo AADL simplificado do hardware do módulo de monitoração de deslocamento........................................83
Figura 37 - A projeção de parte do corpo mecânico do PEROLA-I, com destaque para a roda do hodômetro.................................85
Figura 38 - Vista em corte do PEROLA-I, gerada por uma ferramenta CAD. Destaque para o inclinômetro, à esquerda e destacado em vermelho, e para a placa de circuito impresso, abaixo e destacada em amarelo...........................................................86
Figura 39 - Ilustração da alteração do número de pulsos por disparo para um caso exemplo de 10,25 pulsos do encoder por milímetro percorrido. ..................................................................89 Figura 40 - Diagrama de máquina de estados de alto nível do software embarcado.........................................................90
Figura 41 - Diagrama de atividades associadas ao estado "Laço de operação".........................................................91
Figura 42 - Diagrama de classes simplificado do módulo de gerenciamento da câmera do sensor.................................96
Figura 43 - Diagrama de atividades do laço de aquisição de imagens de MeasurementCameraHandler..........................................98
Figura 44 - Captura de tela da interface gráfica do módulo de controle da câmera do sensor. As cores apresentadas na imagem capturada pela câmera são de uma palheta artificial, pois a câmera é preto-e-branco. 100 Figura 45 - Usuário do sistema utilizando HMD e joystick, ambos em destaque. O computador possui placa de vídeo capaz de gerar imagens estereoscópicas..................................................106
Figura 46 - Casos de uso relativos à nuvem de pontos.............107
Figura 47 - Casos de uso relativos às visões 3D e 2D.............108
Figura 48 - Casos de uso relativos à navegação e objetos no ambiente virtual..........................................................109
Figura 49 - Casos de uso relativos à análise de dados e anotações de usuário..........................................................110
Figura 50 - Diagrama de classe simplificado da medição em coordenadas cilíndricas como definida pelo padrão XCP............112
Figura 51 - Diagrama de classes simplificado de parte do SRV. Esta representação tem o objetivo de dar foco às funcionalidades gráficas e de análise geométrica do sistema.................................114
Figura 52 - Diagrama de classes do pacote de dispositivos de entrada e sua interação com o resto do sistema.............................116
Figura 53 - Diagrama de atividades simplificado do comportamento dinâmico do SRV..................................................117
Figura 54 - Uma possível tela de saída do SRV, apresentando a reconstrução tridimensional de uma região geométrica inspecionada e objetos virtuais de leitura. A visualização apresentada é do poto de vista
externo, porém de uma geometria interna. Os valores sem unidade estão em milímetros......................................................120
Figura 55 - Visão planificada, gerada pelo SRV, da região apresentada na figura 54. Este tipo de visualização é similar ao encontrado em outros métodos de inspeção. No software apresentado, esta visão pode ser utilizada simultaneamente à tridimensional.........................120
Figura 56 - Comparação visual entre imagens obtidas com diferentes parâmetros de visualização tridimensional para uma mesma cena. A partir de uma cena original se alterou somente um parâmetro: (a) cena original, (b) escala radial dobrada, (c) parâmetros de iluminação alterados e (d) escala de cores alterada...........................121
Figura 57 - Escalas de cores utilizadas na figura 56. À esquerda, a escala utilizada nas partes (a), (b) e (c) da figura 56. À direita, a escala utilizada na parte (d) da figura 56. Os valores estão em milímetros..........122
Figura 58 - Vista interna de uma região de tubo. Nesta ocasião, o usuário utiliza um apontador virtual para a leitura do valor individual de raio de um ponto. Há ainda a presença de uma anotação......................123
Figura 59 - Esquema de volumes de projeção assimétricos utilizado na geraçào dos pares estereoscópicos..................................125
Figura 60 - Um par estereoscópico gerado pelo software de realidade virtual............................................................125
Figura 61 - Uma parte da interface de visualização planificada e análise, onde se pode ver uma lista de regiões definidas, valores de leitura para a região selecionada e uma área de visualização planificada desta região. Neste caso, é vista uma região com defeitos evidenciados em vermelho.
...................................................................126 Figura 62 - Montagem feita durante a calibração do hodómetro.......130
Figura 63 - Um dos protótipos do PEROLA-I com o laser ligado.......135
Figura 64 - Esquemático da bancada de testes do PEROLA-1...........135
Figura 65 - Vista interna da tampa com defeitos artificialmente produzidos.........................................................136
Figura 66 - A reconstrução, feita pelo SRV, da geometria interna adquirida da região da tampa com defeitos artificialmente produzidos.
...................................................................137 Figura 67 - Vista interna do tubo da bancada, com destaque ao cordão de solda e à tampa de acrílico. Pode-se ver também o perfilómetro aplicado ao fundo...........................................................138
Figura 68 - Vista reconstruída pelo SRV do cordão de solda e da tampa de acrílico inspecionados pelo perfilómetro. O ponto de vista desta cena é oposto ao da fotografia da figura 64.............................138
Figura 69 - Parte da geometria da tampa removível correspondente ao rebaixo com degraus.............................................139
Figura 70 - Representação da geometria do rebaixo vista pelo software de visualização.................................................140
Figura 71 - Recortes da vista planificada da região do rebaixo incremental.....................................................140
Figura 72 - Vista interna de um trecho de tubulação de exploração de gás fortemente exposto à corrosão...............................142
Figura 73 - Resultado de medição de trecho de tubulação de gás da figura 69, inspecionada pelo PEROLA-I e visualizada pelo seu SRV. 142
Figura 74 - Trecho de tubulação de exploração de gás severamente danificado, apresentando inclusive uma fenda....................143
Figura 75 - Reconstrução da geometria correspondente à região da figura 71.......................................................143
LISTA DE TABELAS
Tabela 1 - Lógica de destaque dos requisitos da tabela 2...........75
Tabela 2 - Requisitos técnicos do PEROLA-1.........................75
Tabela 3 - Requisitos do módulo de aquisição e disponibilização de imagens............................................................79
Tabela 4 - Estados assumptíveis pelo sinal de saída dos encoders de codificação de dois bits...........................................83
Tabela 5 - Tarefas executadas pelo	código embarcado...............92
Tabela 6 - Obtenção de pulsos por deslocamento conhecido para calibração do hodómetro (realizada com velocidade menor do que 20 mm/s).............................................................131
Tabela 7 - Resultado da calibração do	hodómetro...................131
Tabela 8 - Medição de outras distâncias com a relação obtida na calibração........................................................131
Tabela 9 - Testes de medição de deslocamento a diferentes velocidades. ..................................................................132 Tabela 10 - Testes de aquisição de imagens a diferentes velocidades e resoluções........................................................133
LISTA DE ABREVIATURAS E SIGLAS
3D	Tridimensional
AADL	Architecture Analysis and Design Language
ALU	Unidade Aritmética e Lógica (Arithmetic and Logic Unit)
API	Interface de Programação de Aplicações (Application Programming Interface)
bps	Bits por segundo
CAD	Projeto Assistido por Computador (Computer Aided Design)
CCD	Charge-coupled device
CENPES	Centro de Pesquisas e Desenvolvimento Leopoldo Américo Miguez de Mello
CI	Circuito Integrado
CPU	Unidade de Processamento Central (Central Processing Unit)
EMC	Departamento de Engenharia Mecânica
GigE	Gigabit Ethernet
GPU	Unidade de Processamento Gráfica (Graphics Processing Unit)
HMD	Monitor Acoplado à Cabeça (Head Mounted Display)
IDE	Ambiente Integrado de Desenvolvimento (Integrated Development Environment)
IDEF0	Integration Definition for Function Modeling
LABMETRO	Laboratório de Metrologia e Automatização
LAMEF	Laboratório de Metalurgia Física
LCD	Mostrador de cristal líquido (Liquid Crystal Display)
MFL	Fuga de Fluxo Magnético (Magnetic Flux Leakage)
MIPS	Milhões de instruções por segundo
MMC	Máquina de medir por coordenadas
NPC	Nuvem de pontos cilíndrica
OpenGL	Open Graphics Library
P&amp;amp;G	Petróleo e gás
PC	Computador Pessoal (Personal Computer)
PEROLA	Perfilometria Óptica a Laser
PNG	Imagem Portável de Rede (Portable Network Graphics)
PUC	Pontifícia Universidade Católica
RS-x	Padrão Recomendado - x (Recommended Standard - x)
RV	Realidade Virtual
SDK	Kit de Desenvolvimento de Software (Software Development Kit)
SE	Sistema Embarcado
SRV	Sistema de Realidade Virtual
STR	Sistema de Tempo Real
SysML	Systems Modeling Language
UFRGS	Universidade Federal do Rio Grande do Sul
UFSC	Universidade Federal de Santa Catarina
	Receptor/transmissor síncrono/assíncrono
USART	universal (Universal Synchronous/Asynchronous Receiver/Transmitter)
XCP	Nuvem de pontos estendida (extended cloud of points)
XML	Linguagem de Marcação Extensível (Extensible Markup Language)
SUMÁRIO
1	INTRODUÇÃO.................................29
1.1	MOTIVAÇÃO..................................29
1.2	OBJETIVO GERAL DA DISSERTAÇÃO..............33
1.3	OBJETIVOS ESPECÍFICOS......................33
1.4	ESTRUTURA..................................34
2	REVISÃO BIBLIOGRÁFICA......................35
2.1	MÉTODOS DE INSPEÇÃO ATUAIS.................35
2.1.1	Pig Palito.................................36
2.1.2	Pig magnético..............................40
2.1.3	Pig ultrassónico...........................45
2.2	O SENSOR ÓPTICO POR TRIANGULAÇÃO CÔNICA A LASER
49
2.2.1	DEMANDA .................................. 49
2.2.2	CONCEITO ................................. 49
2.2.3	O PROTÓTIPO DESENVOLVIDO...................51
2.3	TÉCNICAS UTILIZADAS NO TRABALHO............56
2.3.1	Sistemas embarcados........................56
2.3.1.1	Projeto de sistemas embarcados.............59
2.3.1.2	Sistemas de tempo real.....................60
2.3.2	Computação gráfica.........................62
2.3.3	Realidade virtual..........................65
3	CONCEPÇÃO DO PERFILÔMETRO..................69
3.1	PRINCÍPIO DE SOLUÇÃO.......................69
3.2	DETALHAMENTO PRELIMINAR....................71
3.3	DEFINIÇÃO DO ESCOPO DO TRABALHO............74
3.4	REQUISITOS TÉCNICOS........................75
4	SISTEMA DE AQUISIÇÃO E DISPONIBILIZAÇÃO DE
IMAGENS............................................79
4.1	GERAÇÃO DE REQUISITOS......................79
4.2	MÓDULO DE MONITORAÇÃO DE DESLOCAMENTOS.....80
4.2.1	Hardware...................................82
4.2.2	Software...................................86
4.2.2.1	Cálculo de deslocamento e etiquetagem......87
4.2.2.2	Comportamento dinâmico.....................89
4.2.3	Aspectos de tempo real.................... 91
4.3	MÓDULO DE GERENCIAMENTO DA CÂMERA DO SENSOR95
4.3.1	Modelagem................................. 95
4.3.2	Interface de usuário.......................99
4.4	CONCLUSÃO................................ 100
5	SISTEMA DE REALIDADE VIRTUAL PARA
VISUALIZAÇÃO E ANÁLISE DE MEDIÇÕES.................103
5.1	MOTIVAÇÃO E REQUISITOS................... 103
5.2	CONCEPÇÃO..................................104
5.2.1	Casos de uso...............................106
5.3	PADRÃO DE ARMAZENAMENTO DE NUVENS DE PONTOS
CILÍNDRICAS.......................................110
5.4	PROJETO E DESENVOLVIMENTO DO SOFTWARE......112
5.4.1	Arquitetura................................113
5.4.2	Funcionalidades de visualização............118
5.4.3	Imersão e interatividade...................122
5.4.4	Análise geométrica.........................125
5.5	CONCLUSÃO..................................128
6	RESULTADOS E AVALIAÇÃO DAS FERRAMENTAS
DESENVOLVIDAS.....................................129
6.1	AVALIAÇÃO DO SISTEMA DE AQUISIÇÃO E
DISPONIBILIZAÇÃO DE IMAGENS.......................129
6.2	INSPEÇÃO EM BANCADA........................134
6.3	INSPEÇÃO EM CAMPO..........................141
7	CONSIDERAÇÕES FINAIS.......................145
7.1	ASPECTOS POSITIVOS DO SISTEMA DESENVOLVIDO..145
7.2	MELHORIAS EM ANDAMENTO.....................147
7.3	SUGESTÕES DE MELHORIAS FUTURAS.............148
REFERÊNCIAS.......................................151
Apêndice A - Conceitos básicos	de AADL utilizados.157
1	INTRODUÇÃO
Este capítulo apresenta a motivação da presente dissertação, seus objetivos e, em seguida, a forma como o texto está estruturado.
1.1	MOTIVAÇÃO
Tubulações metálicas são aqui entendidas como conjuntos de tubos e acessórios, voltados ou não ao processo industrial. Estas são amplamente utilizadas nas indústrias química, petroquímica, alimentícia, farmacêutica e em refinarias para cumprir diversas finalidades, resumidas na figura 1 (Ribeiro, 2007). Dentre o conteúdo transportado encontram-se principalmente gases, óleos, vapores, combustíveis, lubrificantes e demais fluidos industriais. Os custos de sistemas de tubulações chegam a representar 25% do custo total destas instalações industriais ou até 70% do custo de equipamentos (Metálica, 1999). Dentre as aplicações encontradas para tubulações internas a plantas industriais encontram-se, entre outros, fornos e trocadores de calor.
Figura 1 - Classificação das tubulações.
Fonte: (Ribeiro, 2007).
Tubulações recebem o nome de dutos quando são utilizados como meio de transporte de insumos. A principal vantagem do
transporte dutoviário é a economia decorrente dos seus custos de instalação e operação quando comparado aos transportes rodoviário e ferroviário (Cimino, 2004). Também garantem abastecimento constante e previsível, ao contrário de métodos de transporte intermitente, como o rodoviário.
A importância financeira da indústria de tubos e acessórios no Brasil também é altamente relevante, tendo faturado 7,5 bilhões de reais no ano de 2009 (Rangel, 2010). Frente a um cenário de crescimento económico, principalmente da área de petróleo e gás, especialistas da indústria têm apontado estimativas de aumento do uso destes elementos, sendo que houve no primeiro semestre de 2010 um aumento da comercialização de tubos metálicos de 15% a 20% na comparação com o mesmo período de 2009 (Rangel, 2010).
Tanto as tubulações internas às plantas industriais quanto os dutos utilizados para transportes a longas distâncias ou exploração de matérias-primas estão sujeitos a avarias, as quais podem ser decorrentes inclusive da própria interação com o material transportado. Neste cenário, um tipo de dano especialmente difícil de detectar é o da corrosão interna, pois não apresenta normalmente nenhum sinal externo de ocorrência. Quando se fala em tubos de fornos de refinarias de petróleo, por exemplo, as altas temperaturas e variações térmicas às quais estão sujeitos causam tensões internas, as quais provocam fadiga do material e geram microfissuras que, somadas à alta energia interna (temperatura) do material transportado, aceleram o processo corrosivo. Na figura 2 pode ser vista uma região corroída de um tubo de forno de refinaria.
A corrosão interna também está presente em tubos de exploração de petróleo e gás (P&amp;amp;G). Neste caso, pode ser citada como fator impulsionador da corrosão a presença de impurezas transportadas juntamente com o material explorado (p. ex., vapor de água em suspensão no gás). Alterações do perfil de escoamento dos fluidos transportados, causadas pela configuração geométrica da tubulação utilizada, também são um fator de desgaste, causando maior corrosão em áreas próximas às juntas e curvas onde há escoamento turbulento. A figura 3 é de uma região severamente corroída de um tubo de exploração de gás em um trecho próximo a uma curva na tubulação.
Figura 2 - Tubo de forno de refinaria apresentando corrosão interna.
Fonte: CENPES-Petrobras.
Figura 3 - Trecho de gasoduto apresentando corrosão em região brevemente Posterior a uma curva na tubulação.
----F )	, ».,a.
postei
r
- &gt; M	//•
Fonte: CENPES-Petrobras.
A dificuldade da inspeção da corrosão interna, atrelada à importância de monitorar a integridade das tubulações industriais, causa grande demanda para a identificação deste tipo de ocorrência, especialmente em tubos de fornos em refinarias de petróleo. A não detecção da corrosão interna em tempo pode levar à falha e culminar em acidentes envolvendo estas tubulações. Isto causa prejuízos ambientais, humanos, de lucros cessantes pela interrupção do uso da planta pós-acidente, além de multas previstas na legislação ambiental. Tais episódios também afetam a imagem da companhia envolvida.
Tal demanda tem motivado o desenvolvimento de novas ferramentas de inspeção geométrica, agregando funcionalidade aos métodos já existentes. Na categoria de métodos de inspeção geométrica óptica, (Buschinelli, 2007) apresentou um sensor por triangulação cônica a laser e mostrou que o mesmo é capaz de medir, com muito boa precisão, a geometria interna de uma secção de tubo por vez, numa montagem compacta em relação a outros métodos. Este sensor utiliza um conjunto emissor de luz, neste caso, um laser e um espelho cônico, que ilumina de forma especial a geometria da secção a ser mensurada e uma câmera que adquire a imagem da região iluminada, além de um software para a extração de um conjunto de pontos da imagem capturada em coordenadas polares.
Para que este sensor se torne o cerne de um completo sistema de perfilagem interna de tubos, dando continuidade ao trabalho de (Buschinelli, 2007), é necessário o desenvolvimento de ferramentas de hardware e software que possibilitem a aquisição sucessiva do perfil geométrico de secções contíguas utilizando o sensor óptico e consolide o resultado em uma única nuvem de pontos que descreva a geometria interna medida. É necessário oferecer também um método adequado à visualização intuitiva e correta interpretação dos dados adquiridos.
A demanda por averiguar periodicamente a integridade geométrica de tubulações de fornos de refinarias brasileiras fortemente expostas à corrosão motivou o desenvolvimento deste perfilômetro. Para isto, foi celebrado um projeto de pesquisa e desenvolvimento entre a Petrobras e a UFSC, executado pelo Laboratório de Metrologia e Automatização - LABMETRO/EMC - ao qual se deu o nome de PEROLA (nome formado a partir de “perfilometria óptica a laser aplicada a dutos”). Dentro deste projeto estão previstos a criação de um dispositivo de perfilometria interna de tubos baseado no sensor óptico por triangulação cônica a laser, um dispositivo de perfilometria externa de tubos e um software capaz de apresentar a geometria das regiões
mensuradas por esses dispositivos de forma inovadora. E é no contexto deste projeto que esta dissertação se insere.
1.2	OBJETIVO GERAL DA DISSERTAÇÃO
Em sintonia com o contexto do Projeto PEROLA, este trabalho objetiva desenvolver as ferramentas de software e hardware necessárias para integrar o sensor óptico em uma solução completa de perfilometria interna, permitindo a aplicação de um protótipo em tubos metálicos expostos à corrosão que adquira a geometria da região inspecionada e permita a posterior visualização de forma intuitiva e registro dos dados coletados.
1.3	OBJETIVOS ESPECÍFICOS
Tomando por base o objetivo geral e levando-se em conta os trabalhos já desenvolvidos ou em desenvolvimento na época do estabelecimento desta dissertação, foram definidos os seguintes objetivos específicos:
•	Projetar, implementar e validar em bancada um sistema embarcado de monitoração de navegação, responsável pela medição dos deslocamentos axial e angular do perfilômetro interno e por disparar a medição pelo sensor óptico a laser, a partir do que já havia sido projetado em (Melo, 2009);
•	Projetar, implementar e validar um módulo de software de controle da câmera do sensor óptico, também a partir do conceito desenvolvido em (Melo, 2009), e definir um protocolo de armazenamento das geometrias inspecionadas;
•	Projetar, implementar e validar um sistema de realidade virtual (RV) para a visualização e análise dos dados adquiridos e dispostos no método de armazenamento eleito.
Dentro do desenvolvimento do perfilômetro, não está no escopo desta dissertação o aprimoramento do sensor óptico e de seu software de processamento, tampouco o projeto e execução de seu corpo mecânico, ainda que algumas decisões entre estas áreas sejam tomadas de forma interativa.
1.4	ESTRUTURA
Após esta introdução, revisam-se no capítulo 2 as soluções atuais para inspeção geométrica interna de tubos e apresentam-se algumas das ferramentas utilizadas para o desenvolvimento deste trabalho. O capítulo 2.2 apresenta o sensor óptico desenvolvido por (Buschinelli, 2007), em torno do qual o perfilômetro foi concebido. Os requisitos sistêmicos estabelecidos para o perfilômetro e o projeto conceitual a ser desenvolvido para o cumprimento destes são mostrados no capítulo 3. No capítulo 4 é apresentado o desenvolvimento do hardware e software que compõem o sistema de aquisição e disponibilização de imagens. O capítulo 5 mostra o desenvolvimento de um sistema de realidade virtual para visualização do perfil geométrico adquirido. No capítulo 6 são vistos os resultados obtidos com a implementação destes sistemas por testes em bancada do protótipo do perfilômetro e de seu software de visualização, além de resultados de inspeção de tubos realizada em campo. O capítulo 8 contém considerações finais sobre a dissertação e sugestões para melhoria e extensão do projeto.
2	REVISÃO BIBLIOGRÁFICA
Neste capítulo são apresentadas algumas soluções atuais e bem estabelecidas no mercado para a perfilometria interna de tubos. Também se apresenta o sensor desenvolvido por (Buschinelli, 2007), o qual será explorado nesta dissertação. São ainda introduzidos alguns conceitos técnicos utilizados na elaboração da dissertação.
2.1 MÉTODOS DE INSPEÇÃO ATUAIS
Devido à importância da inspeção da integridade geométrica de tubos, seja na exploração de matérias-primas ou em tubos instalados em plantas industriais químicas e petroquímicas, foram desenvolvidos vários métodos capazes de apresentar a um engenheiro de inspeção, direta ou indiretamente, a presença de defeitos internos em tubos.
Alguns destes dispositivos se enquadram na categoria de “pigs”, termo cuja origem histórica remonta aos primeiros dispositivos utilizados na limpeza interna de tubulações. O ruído causado pelo atrito entre esses e a tubulação de metal se assemelhava ao grunhido de um porco (pig, em inglês). Ainda assim, utiliza-se por vezes o termo como se fosse uma sigla, como Pipeline inspection gauge (ou gadget), algo como “aparelho de inspeção de tubulações”, mesmo não sendo os pigs utilizados apenas para inspeção (Nestleroth, 2011).
Um pig é, em essência, um dispositivo autónomo que passa através de uma tubulação ou duto, movido por pressão diferencial ou pelo próprio fluido, seja para fins de limpeza, preparo, inspeção ou mesmo escalonamento de material transportado (Nestleroth, 2011). Alguns dispositivos que são aplicados no interior de dutos e se deslocam ao longo de seu eixo, mesmo não cumprindo a definição anterior, são muitas vezes chamados de pigs pelo corpo técnico industrial apenas por questão de simplicidade.
Derivado do conceito de pig, o conceito de “pigabilidade” é utilizado na indústria para denotar a capacidade de um trecho de tubulação ou duto de ser compatível com a aplicação de pigs. Normalmente, uma baixa pigabilidade é relacionada à presença de variações de diâmetro interno e curvas abruptas na tubulação, sendo que para diferentes técnicas, dependendo de suas características, uma mesma tubulação pode ser mais ou menos “pigável”, como se pode inferir da revisão a seguir.
Entre os tipos de pig, aqueles cuja finalidade é a inspeção são comumente chamados de “pigs inteligentes” ou “pigs instrumentados”,
por serem dotados de maior elaboração tecnológica do que pigs de limpeza ou escalonamento. Podem, por exemplo, cumprir a função de perfilómetros geométricos, ou seja, medem o perfil geométrico da região de duto em que são aplicados.
Existem também métodos de inspeção geométrica que não se enquadram como pigs, ou seja, não são “passados” pelo interior do duto no sentido do deslocamento do fluido transportado. Estes geralmente são de aplicação externa e localizada, provavelmente sendo seu uso requerido após uma pré-identificação de um possível defeito interno, possivelmente resultado de uma inspeção prévia com pig.
A seguir, uma breve revisão sobre alguns dos dispositivos citados.
2.1.1 Pig Palito
O Pig Palito é um desenvolvimento do CENPES - Petrobras em conjunto com a PUC-Rio, especificamente projetado para identificar e quantificar geometricamente a corrosão interna, segundo (Franzoi et al, 2005). Seu nome vem das hastes montadas ao redor de coroas circulares componentes do dispositivo. Esta característica pode ser observada na figura 4, onde se vê uma montagem para dutos de 560 mm de diâmetro (22”).
Ao longo dos últimos anos, protótipos dimensionados para tubos de diferentes diâmetros (variando de 100 a 560 mm ou 4” a 22”) vêm sendo construídos, não se tratando apenas, portanto, de um único dispositivo, mas sim de um conceito. Para cada diâmetro de tubo a ser inspecionado é utilizada uma configuração diferente. Na figura 5 pode ser visto um protótipo de um pig palito com intervalo de medição mais amplo, sendo adequado para diâmetros de tubos variando de 100 a 180 mm (4” a 7”).
As hastes do Pig Palito tem uma posição de fim de curso que mantém suas extremidades num ponto de maior valor radial do que o raio interno máximo esperado do tubo a ser aplicado, o que também pode ser verificado na figura 4. A posição de fim de curso das hastes é de um ângulo maior do que 90° em relação ao eixo do próprio sistema na qual estão montadas, a contar do vetor ao longo de cujo sentido o sistema se desloca. Portanto, ao adentrar o tubo, estas hastes são empurradas por uma mola contra a superfície do tubo de modo a assumir em suas extremidades o valor radial do ponto em que tocam as paredes internas do tubo. Para que se obtenha este valor de raio, são utilizados sensores de efeito hall nas bases de cada haste. Medindo-se o valor do
ângulo de inclinação das hastes, dado o comprimento das mesmas, pode-se determinar o valor do raio interno do ponto tocado.
Figura 4 - Uma das montagens do Pig Palito. Destaque para as hastes ao redor
das peças mais centrais. ’ III I
Fonte: CENPES-Petrobras.
Figura 5 - Outra montagem de um pig palito projetada para dutos de tamanhos variáveis entre 100 a 180 mm (4" a 7").
Fonte: PUC-RIO / CENPES-Petrobras.
Esta característica do pig palito confere-lhe a vantagem de poder ser aplicado em dutos cuja limpeza não removeu completamente os resíduos líquidos presentes (ou sólidos com comportamento similar ao de pó ou detritos).
O número limitado de hastes contidas em cada coroa circular limita a resolução angular com que é possível medir a superfície interna. A limitação na resolução angular de cada coroa circular com hastes é superada ao se combinar algumas delas de forma que as orientações angulares estejam adequadamente deslocadas umas das outras. Por exemplo, na montagem apresentada em (Franzoi et al, 2005), dimensionada para um duto de 560 mm (22”) e mostrada na figura 4, foram combinadas cinco coroas circulares de 50 hastes cada uma, deslocadas angularmente entre si de 1,44°, aumentando para 250 o número de pontos medidos ao longo de cada secção interna de tubo inspecionado. A contrapartida fica pelo aumento do comprimento total do sistema. Na figura 5 pode-se observar este aumento ao passo que se utilizam ali componentes com apenas cinco hastes.
Ainda segundo (Franzoi et al, 2005), a menor largura de defeito de perda de material inspecionável pelo Pig Palito é do valor do diâmetro na extremidade da haste utilizada, pois esta precisa adentrar o defeito. Já a maior largura de defeito possivelmente não detectável é
obtida combinando-se o número de sensores da montagem com a circunferência nominal da secção transversal do tubo inspecionado. Na montagem citada, este valor é de aproximadamente 7 mm, também denominado resolução circunferencial do sistema.
Para o referenciamento do valor de raio ao longo do eixo do tubo inspecionado, o Pig Palito utiliza dois hodómetros baseados em sensores de efeito hall. O sinal senoidal obtido destes sensores é utilizado para mapear os valores dos raios medidos pelas hastes para diferentes posições angulares. A resolução axial depende, segundo (Franzoi et al, 2005), da velocidade de deslocamento e da taxa de amostragem do sistema. No artigo citado, na velocidade de deslocamento de 1 m/s e 512 Hz de taxa de amostragem, a resolução axial obtida foi de 2 mm.
O resultado da medição é apresentado em um software em visão planificada, dispondo os valores de raio capturados pelos sensores em relação ao eixo do tubo e ao ângulo da secção do duto correspondente a cada haste. A figura 6, extraída de (Franzoi et al, 2005), é um exemplo da apresentação dos dados ao usuário em um tubo que apresenta corrosão. O eixo das abscissas corresponde à posição axial do duto. O eixo das ordenadas, à posição angular correspondente da haste. Os valores de raio são representados por uma escala de cores que varia de verde (sem perda de material) a vermelho (maior perda de material detectada), calibrada de acordo com a especificação da montagem.
Figura 6 - Apresentação dos dados coletados pelo Pig Palito. Os pontos em vermelho representam ocorrência de perda de material.
Fonte: (Franzoi et al, 2005).
A interpretação por software dos dados coletados também permite a emissão de relatórios, os quais podem conter dados como ocorrências de defeitos, seu volume estimado e sua localização.
2.1.2	Pig magnético
O pig magnético de corrosão ou MFL (do inglês Magnetic Flux Leakage) é, segundo (Nestleroth, 2011), o pig de inspeção mais comum na indústria. As primeiras unidades começaram a ser usadas em 1966. Desde lá aos dias de hoje têm passado por constante desenvolvimento (Bubenik, 2011). O CENPES - Petrobras também conta com sua implementação desta técnica (Oliveira &amp;amp; Camerini, 2002).
Seu funcionamento baseia-se na detecção de fuga de fluxo magnético. Esta fuga acontece quando um campo magnético induzido em um corpo tem suas linhas de fluxo passando por um caminho diferente daquele que seria encontrado em um corpo com geometria inalterada, isto é, passando por regiões com anomalias geométricas ou na permeabilidade magnética.
No caso específico de detecção de perda de material em uma chapa ou na parede de um tubo metálico, deve haver um sensor de fluxo magnético - sensor de efeito hall ou sensor magnético de proximidade -entre os polos norte e sul do indutor. O fluxo magnético tende a passar pelo caminho mais fácil, ou seja, através do corpo de maior permeabilidade magnética localizado entre os polos sul e norte indutores (Halliday, 2004). À medida que o material é saturado pelo fluxo magnético, algumas linhas de fluxo começam a se dispersar, conforme ilustrado na figura 7, adaptada de (Bubenik, 2011).
Figura 7 - Fluxo magnético induzido passando (a) pelo ar, (b) quase totalmente pela chapa metálica colocada e (c) com algumas linhas de fluxo em fuga, causada pela diminuição da espessura da chapa naquela região.
Fonte: (Bubenik, 2011).
A presença de sensores de fluxo magnético ao lado do corpo metálico entre os polos norte e sul do indutor permite avaliar a intensidade da fuga, e é esse o método utilizado nos pigs MFL que contam com este tipo de sensor entre escovas indutoras. Os modelos chamados “circunferenciais” têm as escovas dispostas de modo que suas linhas de fluxo magnético sejam tangentes à circunferência da secção do tubo, como na figura 8 (Nestleroth, 2011). Já os modelos “axiais”
contam com as escovas dispostas em coroas, enquanto que os sensores de fluxo magnético são posicionados entre estas coroas, como na figura 9 (Bubenik, 2011) e na figura 10 (Oliveira &amp;amp; Camerini, 2002).
Figura 8 - Um modelo de pig MFL cincunferencial da empresa Battelle, EUA.
Destaque para a direção do fluxo magnético imposto pelo dispositivo.
Fonte: (Nestleroth, 2011).
A principal diferença entre os dois modelos está no tipo de defeito detectado com maior facilidade. Defeitos de perda de material cujo formato pode se dispor ao longo do sentido das linhas do fluxo magnético são mais difíceis de serem verificados, pois “se assemelham a rochas em um rio” (Bubenik, 2011). Se a rocha se dispuser perpendicularmente ao sentido da vazão da água, haverá maior turbulência causada por ela, enquanto que uma rocha longa e estreita cuja maior dimensão está ao longo do sentido de vazão da água pouco afetará o escoamento da mesma.
Figura 9 - Um modelo de pig MFL axial da empresa Det Norske Veritas, Noruega.
Fonte: (Bubenik, 2011).
Figura 10 - Um modelo de pig MFL axial do CENPES - Petrobras.
Fonte: (Oliveira &amp;amp; Camerini, 2002).
Logo, os pigs MFL cincunferencial e axial devem ser usados ao se ter conhecimento prévio dos tipos de defeitos mais provavelmente encontrados no tipo de duto em que serão utilizados ou em complemento um ao outro.
Quanto à detecção de movimento e mapeamento das medições, os pigs MFL se assemelham ao pig palito do CENPES - Petrobras, no que pode ser considerado um padrão de montagem de pigs instrumentados em geral, conforme se conclui a partir de (Nestleroth, 2011).
Medindo o fluxo magnético de fuga o pig MFL é capaz, portanto, de estimar volumes de perda ou acúmulo de material nas regiões por onde passa. Não é capaz, no entanto, de detectar a forma deste defeito, já que seus sensores detectam apenas aumento ou diminuição do fluxo magnético nas suas posições. A figura 11, adaptada de (Bubenik, 2011), é um exemplo dos dados coletados pelos sensores do pig MFL, neste caso, um pig circunferencial. Cada linha corresponde aos dados de um sensor ao longo do deslocamento em uma região de um tubo. Os picos identificam perda de material. Vales identificariam acúmulo, mas não estão presentes nesta amostra. Evidenciados em tracejado, picos que sugerem pequenas perdas; em linhas cheias, sugestões de grandes perdas.
Figura 11 - Dados coletados pelos sensores de um pig MFL da empresa Det Norske Veritas.
Fonte: (Bubenik, 2011).
Na figura 11, cada linha correspondente a um sensor está distanciada de 7,5° (ou 15 minutos em escala horária) uma da outra, promovendo, neste caso, uma resolução angular mais grosseira que a do pig palito. No entanto, esta limitação é secundária, dado que o pig MFL obtém medidas proporcionais ao volume de material perdido ou
depositado, ainda lembrando que seu sinal é influenciado pela forma dos defeitos encontrados.
Os dados coletados podem ser dispostos, através de tratamento por software, também em vista planificada e com o auxílio de um mapa de cores. Na figura 12, ao invés de um traçado, as linhas correspondentes a cada sensor têm seus valores representados através de pontos coloridos. Neste mapa, a cor azul representa acúmulo de material, a verde representa região com espessura esperada (ou próxima dela) e as cores amarela e vermelha representam perda de material. A disposição dos dados em abscissas e ordenadas segue o padrão da figura 11.
Figura 12 - Uma representação dos dados obtidos por um pig MFL utilizando
código de cores para os valores de raio obtidos.
Fonte: (Bubenik, 2011).
As montagens dos pigs MFL são adequadas a dutos de grandes diâmetros e oferecem pouca flexibilidade quanto a dutos multidiâmetros (dutos cujos tubos componentes são de diferentes diâmetros), dado que os sensores trabalham melhor mais próximos à parede do duto. O trabalho de (Oliveira &amp;amp; Camerini, 2002), inclusive, cita o desenvolvimento de um pig MFL no CENPES - Petrobras para “diâmetro de 10 polegadas, menor diâmetro possível após otimização [...] do hardware”.
2.1.3	Pig ultrassónico
O pig ultrassónico, disponível a partir de 1986, segundo (Nestleroth, 2011), foi criado para tentar superar a principal limitação do
MFL, que é incapaz de detectar a forma dos defeitos encontrados ao longo de um tubo. Utiliza transdutores de ultrassom radialmente dispostos ao redor do seu eixo, seguindo o modelo dos outros pigs. Na figura 13 pode-se observar como é esta disposição, ressaltando a importância de se utilizar várias coroas defasadas angularmente uma da outra (como no pig palito) para se atingir a resolução angular desejada, também com a contrapartida do aumento do comprimento do cabeçote.
Uma limitação do pig ultrassónico é a necessidade de se utilizar, para sua aplicação, um fluido acoplador, como a água. Vale ressaltar que, em caso de extrema necessidade, pigs de separação (ou escalonamento) podem ser utilizados para isolar o pig de ultrassom numa região onde fique submerso.
Os transdutores ultrassónicos medem a espessura da parede do duto onde são aplicados através do tempo de viagem das ondas acústicas emitidas pelos próprios. Desta forma, o pig ultrassónico é capaz de identificar a perda de material tanto interna quanto externa, sem podê-las diferenciar, no entanto.
Figura 13 - Concepção artística de um pig ultrassónico dentro de um duto. Destaque para os transdutores ultrassónicos.
Fonte: (Balzer, 2011).
Uma forma alternativa de se utilizar a técnica de ultrassom na inspeção geométrica de dutos está sendo desenvolvida pelo LAMEF/UFGRS (Strohaecker, 2010). Trata-se de um robó inspetor de dutos utilizável pelo lado externo, ao qual se pode acoplar um conjunto
de transdutores de ultrassom e um ejetor de água para garantir o acoplamento acústico. A montagem deste robô em operação pode ser vista na figura 14 (LAMEF/UFRGS, 2011). As letras que podem ser percebidas na figura são regiões do cilindro com menor espessura, simulando defeitos de perda de material.
Enquanto o pig ultrassônico é adequado à utilização em dutos “pigáveis”, assim como o pig magnético, o inspetor externo é adequado para uso próximo a juntas ou outras regiões onde não é viável a inserção de um pig.
Figura 14 - Um robô com transdutor ultrassônico utilizável na parte externa de dutos.
Fonte: (LAMEF/UFRGS).
Os dados coletados pela técnica ultrassônica são apresentados como os do pig palito, em vista planificada e utilizando um mapa de cores relativo ao valor mensurado. A figura 15 é a apresentação do mesmo trecho de duto medido em (Franzoi et al, 2005) por um pig ultrassônico. Já a figura 16 (LAMEF/UFRGS, 2011), é uma tela de software apresentando uma medição realizada pelo inspetor de dutos de (Strohaecker, 2010) na forma de textura mapeada em um modelo de cilindro, de forma a representar visualmente onde se encontram aquelas características identificadas.
Figura 15 - Uma visualização do resultado obtido por um pig ultrassónico.
Fonte: (Franzoi et al, 2005).
Figura 16 - O resultado da medição do corpo de prova apresentado na figura 14. A imagem resultante foi mapeada como textura em um cilindro virtual.
Fonte: (LAMEF/UFRGS, 2011).
2.2	O SENSOR ÓPTICO POR TRIANGULAÇÃO CÔNICA A LASER
Nesta seção é apresentado o sensor óptico desenvolvido por (Buschinelli, 2007) com o objetivo de se compreender melhor suas características e as necessidades que norteiam esta dissertação. O perfilômetro a cujo desenvolvimento se contribui com este texto é baseado no sensor a seguir apresentado.
2.2.1	DEMANDA
A resolução limitada do mapeamento geométrico dos métodos de inspeção comumente utilizados na indústria deixa a desejar, principalmente em se tratando de defeitos de maior complexidade geométrica, como aqueles causados por corrosão interna. Igualmente, a necessidade de inspeção de tubos de diâmetro igual ou menor que 150 mm (pouco menos de 6”), como os presentes em fornos de refinarias, não é bem atendida pelos métodos disponíveis, os quais são mais facilmente aplicáveis a tubos de maior diâmetro interno, conforme apresentado no item 2.1. Em suas versões aplicadas a tubos de menor diâmetro, as tecnologias descritas apresentam baixa resolução angular, o que impede um mapeamento geométrico mais detalhado.
Nos casos onde é necessária a perfilagem da superfície interna da tubulação com resolução radial da ordem de décimos de milímetro, métodos ópticos apresentam-se como uma solução atrativa, desde que a superfície da tubulação esteja adequadamente limpa1.
2.2.2	CONCEITO
Para superar estas dificuldades, foi explorado o conceito de triangulação óptica a laser. Esta técnica envolve a projeção de um feixe de luz a uma superfície cuja geometria se deseja mensurar. Uma câmera deve estar obliquamente apontada para a região em que a luz é projetada no mensurando de modo que se possa relacionar a imagem adquirida pela câmera às características geométricas desejadas do objeto através
1 A tubulação deve estar suficientemente limpa de forma a evitar o depósito de material (como óleo ou poeira) na parte óptica do sistema, o que pode vir a degradar o resultado de medição ou impedi-la completamente. Resíduos presentes também poderiam vir a ser erroneamente interpretados como parte da geometria do mensurando.
do processamento desta imagem, dada uma calibração adequada da montagem e do algoritmo utilizado. Em um exemplo utilizando-se um plano de luz laser, a imagem capturada pela câmera contém um traçado luminoso correspondente à intersecção entre o plano da luz laser e a secção correspondente do mensurando (figura 17). Sabendo-se a posição e orientação da câmera, deve-se realizar uma calibração do algoritmo utilizado para que seja possível medir a geometria do mensurando.
No caso específico do sensor óptico desenvolvido por (Buschinelli, 2007) foi aplicada a triangulação cônica a laser, onde se gera o plano de luz a partir de uma fonte laser linear apontada para a ponta de um espelho cônico, conforme mostra a figura 18.
Figura 18 - Conceito de triangulação óptica cônica a laser aplicado no sensor.
Tubo				Plano de luz radial		
	Câmera					
		■y-"""	1 b			
		Lente	*1	1/ Espelho		Laser	
cônico
Com esta disposição, utilizando-se um espelho cônico cujo ângulo da geratriz é de 45°, cria-se um plano de luz perpendicular ao eixo óptico do conjunto espelho/feixe laser. A luz neste caso se propaga radialmente, tornando o plano de luz ideal à aplicação interna em peças cilíndricas, caso em que este plano de luz intercepta o contorno interno da secção a ser mensurada, formando um padrão anelar. A câmera deve então estar posicionada ao longo do eixo do sistema de modo a adquirir a imagem resultante desta intersecção.
2.2.3	O PROTÓTIPO DESENVOLVIDO
O protótipo apresentado por (Buschinelli, 2007) é disposto como na figura 18. Ele foi desenvolvido de modo a medir a geometria interna de uma secção por vez de um tubo de 154 mm (6”) de diâmetro, conforme demanda industrial identificada.
Para se obter quantitativamente o perfil geométrico da secção mensurada, a imagem adquirida pela câmera do sensor é processada2 de modo a fornecer um conjunto de pontos em coordenadas polares. Tem-se, desta forma, um algoritmo cuja entrada é uma imagem que contem a projeção do laser nas paredes internas da secção examinada. A saída deste algoritmo é uma lista de valores de ponto flutuante, conforme ilustra a figura 19. Cada valor na lista representa o raio medido para o ângulo correspondente à sua posição na lista. Os valores são distribuídos igualmente ao longo de uma volta completa, fazendo que a resolução angular resultante do algoritmo seja (360/n)°, onde n é o número de valores de raio obtidos.
2	Utilizando placa de vídeo (GPU) de modo a reduzir o tempo de processamento (Buschinelli, 2012).
Figura 19 - O algoritmo do software de medição transforma uma imagem numa lista de valores de ponto-flutuante. Cada valor da lista corresponde ao raio encontrado para o ângulo representado pela í -ésima posição na lista.
Fonte: Autor.
Um exemplo de imagem capturada pelo dispositivo está na figura 20.
Figura 20 - Uma imagem capturada pelo sensor óptico. A faixa mais clara é advinda do laser projetado na superfície interna do tubo.
Fonte: LABMETRO-UFSC.
Para fins de avaliação do sensor, diferentes configurações de teste foram realizadas em bancada. Uma delas utilizava um gabarito representante de uma secção de um tubo com defeitos de geometria bem conhecida, como pode ser visto na figura 21 (Buschinelli, 2007). O conjunto emissor foi posicionado de modo a iluminar a superfície interna deste gabarito, montagem esta que serviu para a realização de ensaios que validassem as características metrológicas deste novo sensor.
Na sua concepção mais atual, o espelho cônico visível na figura 21 foi removido. Na figura 22 pode ser vista esta concepção atual aplicada a um padrão de calibração anelar, enquanto que na figura 23 ela pode ser vista aplicada ao mesmo gabarito da figura 21.
Figura 21 - Uma das primeiras montagens do sensor óptico a laser em bancada
(Buschinelli, 2007). Na época era utilizado um segundo espelho cônico disposto
de frente a câmera, o qual foi removido nas concepções atuais.
Padrão Escalonado
Gabarito
Mesa micrométrica (direção y)
Fixação do sistema
Mesa micrométrica (direção z)
Mesa micrométrica (direção x)
Fonte: (Buschinelli, 2007).
Figura 22 - Foto do sensor óptico, em sua concepção atual, aplicado a um padrão de calibração anelar.___________________
Fonte: LABMETRO-UFSC.
Figura 23 - Sensor óptico a laser, em sua concepção atual, aplicado a um gabarito geométrico.
Fonte: LABMETRO-UFSC.
Na figura 24 é apresentado o resultado de uma medição deste gabarito realizada pelo sensor óptico a laser em coordenadas polares. Nesta figura o resultado da medição do sensor é comparado ao resultado obtido por uma máquina de medir por coordenadas (MMC), o qual é o valor de referência.
Figura 24 - Resultado de medição, realizada pelo sensor óptico, do gabarito da figura 21. É mostrado também o valor dos raios dos pontos do gabarito obtidos por uma máquina de medir por coordenadas.
A resolução geométrica obtida pelo sensor está intimamente relacionada ao tamanho da matriz de pixels da câmera utilizada. As principais características do sensor óptico a laser em seu estado de desenvolvimento atual são listadas a seguir (Buschinelli et al, 2012) (Buschinelli, 2012):
•	Resolução angular: 0,25° (1440 valores de raios obtidos por secção);
•	Resolução circunferencial máxima: &amp;lt;0,5 mm;
•	Resolução radial de 0,01 mm;
•	Câmera Gigabit Ethernet (GigE), com resolução de 1024 x 1024 e aquisição de 60 quadros por segundo;
•	Faixa de medição radial: 64,4 a 88,4 mm;
•	Incerteza radial: ± 0,3 mm;
•	Tempo de processamento de 2,1 ms utilizando GPU3.
3	Conforme testes realizados em um notebook com processador Intel Core i7® e placa de vídeo NVidia GTX 285M® (Buschinelli, 2012).
Cabe ressaltar que a resolução circunferencial na região de aplicação depende do raio desta região, pois a resolução angular é sempre fixa. Quanto maior for o raio da região mensurada, maior é a distância circunferencial, em milímetros, entre dois pontos mensurados. O valor de 0,5 mm citado no parágrafo anterior se refere à resolução circunferencial nos valores máximos da calibração radial, próximos a
88,4	mm.
Portanto, com as características metrológicas apresentadas acima, mostrou-se que este sensor era capaz de atingir um grau de detalhamento geométrico para uma secção superior àquele dos métodos de inspeção avaliados. Suas características o tornam adequado à demanda de inspeção de tubos de diâmetro da ordem de 150 mm, além de possibilitar a apresentação do perfil geométrico da secção mensurada.
Conforme citado em (Buschinelli, 2007), o sensor óptico pode ser utilizado em um sistema de medição de perfil interno, não apenas de uma secção, mas de toda a geometria interna do tubo, desde que disponha de hardware e software adequado. Estes hardware e software devem realizar a aquisição do perfil automaticamente para cada secção e fundir o resultado destas em um único conjunto de dados representativo da geometria interna da região de tubo medida. É necessária, por fim, uma ferramenta que permita ao analista realizar a leitura da geometria adquirida e extrair dela informações de interesse.
2.3	TÉCNICAS UTILIZADAS NO TRABALHO
O projeto estabelecido nesta dissertação é apresentado no item
1.3	e detalhado no item 3.3. Para o desenvolvimento do sistema de aquisição e disponibilização de imagens, foi utilizado o conceito de sistemas embarcados. Para o desenvolvimento do software de visualização, foram utilizados os conceitos de computação gráfica e realidade virtual. Estes conceitos são brevemente introduzidos a seguir.
2.3.1	Sistemas embarcados
Um sistema embarcado (ou sistema embutido, SE) é um sistema composto de hardware e software dedicado a uma função específica, geralmente parte de um sistema mais amplo - diferentemente de PCs, os quais são plataformas computacionais genéricas (Berger, 2002) (Müllerburg, 1999) (Oshana, 2006). Sistemas embarcados estão por toda parte: no escritório, em casa, no hospital, na indústria. Exemplos se encontram em máquinas de lavar, impressoras, injeções eletrônicas de
automóveis e em brinquedos (Wilmshurst, 2007). Uma descrição visual da organização de um sistema embarcado pode ser vista na figura 25, adaptada de (Koopman, 1996).
Figura 25 - Esquema geral de um sistema embarcado.
J		 : software:		SISTEMAS
		AUXILIARES
FPGA/ ASIC	ImemóriaI	(ALIMENTAÇÃO. DISSIPAÇÃO.
		ETC)
....DE
■M DIAGNÓSTICO
CONVERSÃO
INTERFACE HOMEM-MÁQUINA
Jk
▼
Fonte: Adaptado de (Koopman, 1996).
AMBIENTE EXTERNO
CONVERSÃO A/D		
	V	
J SENSORES J		
SEGURANÇA E SUPORTE ELETROMECÂNICO
São dispositivos com foco na interação com o ambiente, os quais englobam CPU e memória e dispõem, de acordo com a finalidade para a qual sejam projetados, de outros componentes como apresentado na figura 25. A interação com o ambiente é dada através de sensores e atuadores, sendo a parte de segurança eletromecânica responsável por suportar condições ambientais diversas como transporte e variações de temperatura. O software executado num sistema embarcado é altamente especializado, sendo normalmente específico para a configuração de hardware no qual está implantado. Tipos de aplicação de softwares de sistemas embarcados são máquinas de estados finitos e malhas de controle, conforme aponta (Koopman, 1996).
Apesar de qualquer CPU poder ser utilizada em um SE, normalmente se utilizam circuitos integrados específicos para esta finalidade, os quais são conhecidos como microcontroladores. Um microcontrolador é um conjunto que envolve o núcleo de um
microprocessador, memória de programa, memória de dados e interfaceamento de entrada e saída (digital e, possivelmente, analógica), todos em uma única pastilha (circuito integrado), cumprindo boa parte do apresentado na figura 25. Estes recursos possibilitam o seu uso diretamente acoplado a um conjunto de sensores e/ou atuadores que, juntos, cumprirão a função que se espera daquele sistema embarcado. Um esquema simples de um microcontrolador pode ser visto na figura 26.
Figura 26 - Um diagrama simplificado e genérico de um microcontrolador.
Na figura 26, os blocos de periféricos podem representar quaisquer das funções apontadas na figura 25. No entanto, em vista da função para a qual um sistema embarcado é projetado e da alta variedade de microcontroladores disponíveis no mercado, o uso das funcionalidades embutidas no microcontrolador pode ser ou não suficiente. Por exemplo, é inadequado drenar corrente do microcontrolador para acionar um atuador cuja potência seja comparável à potência do próprio microcontrolador. Em todo caso, o projeto do
sistema deve avaliar quais periféricos devem ser agregados ao sistema de modo a cumprir sua função.
2.3.1.1	Projeto de sistemas embarcados
Dada a inerente interação com o ambiente através de sensores e atuadores específicos e a alta especialização da lógica executada, o projeto de sistemas embarcados é, essencialmente, um problema de projeto simultâneo de software e hardware. O trabalho de (Wolf, 1994) divide o projeto de um sistema embarcado em quatro grandes tarefas, sendo elas:
•	dividir a função a ser implementada em partes funcionais menores e interativas;
•	alocar estas divisões a microprocessadores ou outros componentes de hardware onde as partes funcionais possam ser efetuadas;
•	escalonar os tempos de execução das tarefas de modo a cumprir os requisitos estabelecidos e
•	mapear as tarefas para implementação em conjuntos específicos de componentes, sejam na forma de hardware ou software.
Esta estratégia é típica de projetos de alto-nível (top-down), assim como muitas metodologias de projeto de software de propósito-geral, de hardware eletrônico e de produtos, como as apresentadas em (Back et al, 2008) e (Silva, 2009). Inclusive, estas diversas metodologias são consideradas no trabalho de (Wolf, 1994) como base para o projeto de SEs, já que os mesmos executam software especializado, tem um circuito dedicado e são aplicados na forma de produtos. É natural, portanto, que as mesmas ferramentas utilizadas para o projeto de software (como ferramentas de modelagem UML4) e hardware (como sistemas CAD) sirvam para o projeto de sistemas embarcados, desde que sejam aplicadas simultaneamente. Devem ser levadas em conta, no projeto de SEs, tanto questões de compatibilidade eletromagnética dentro de seu circuito como de consistência de código executado em seu processador, para citar dois exemplos.
Quanto ao comportamento de um sistema embarcado, utiliza-se comumente técnicas de modelagem de sistemas a eventos discretos,
UML (Unified Modeling Language) é a linguagem padrão de facto para modelagem de software.
como autômatos e redes de Petri temporais. O avanço da ciência de projeto de sistemas embarcados fez com que surgissem ainda novas linguagens adaptada às suas necessidades, como a SysML (Systems Modeling Language, um dialeto de UML) e a AADL (Architecture Analysis and Design Language). Estas linguagens fornecem recursos para a modelagem dinâmica e estrutural5 de componentes de hardware e software num mesmo conjunto descritivo, facilitando a modelagem e a aplicação de técnicas de verificação de consistência para sistemas embarcados. Descrições da SysML e da AADL podem ser encontradas em (Hause, 2006) e (Feiler, Gluch &amp;amp; Hudak, 2006), respectivamente. Já estão disponíveis inclusive ambientes integrados de desenvolvimento (integrated development environments - IDEs) para desenvolvimento nestas linguagens, como o Eclipse Modeling Project (Eclipse Foundation).
2.3.1.2	Sistemas de tempo real
Uma nuance de importância crítica no projeto de sistemas embarcados é o projeto de sistemas de tempo real (Wolf, 1994). Um sistema de tempo real (STR) é “um sistema computacional que deve reagir a estímulos oriundos do seu ambiente em prazos específicos” (Farines, Fraga &amp;amp; Oliveira, 2000). Sistemas embarcados que interagem com o ambiente são também sistemas de tempo real, dado que a característica da resposta temporal destes sistemas influencia diretamente na qualidade do processo executado. Para um STR, o mais importante é dispor de previsibilidade do tempo de resposta aos estímulos do ambiente (Farines, Fraga &amp;amp; Oliveira, 2000).
Um sistema de tempo real é dito ser previsível caso seu comportamento possa ser antecipado mesmo frente às variações de carga de trabalho (i.e. as tarefas que o processador deve executar) e da existência de falhas. Para se considerar esta previsibilidade, é preciso conhecer o comportamento do sistema frente à pior hipótese de carga computacional ocorrendo simultaneamente às falhas (Farines, Fraga &amp;amp; Oliveira, 2000).
Do ponto de vista da segurança, os STRs podem ser classificados em (Farines, Fraga &amp;amp; Oliveira, 2000):
Modelagens dinâmica e estrutural são aqui entendidas como em (Silva, 2009).
•	Brandos, quando o malefício trazido por uma falha temporal é da mesma ordem de grandeza que os benefícios da operação normal (p.ex. comutação telefônica) ou
•	Críticos, quando a ordem de grandeza do malefício causado pela falha temporal exceda em muito o benefício da operação normal (p.ex. controle de voo).
Quanto ao tipo de garantia de resposta, ainda segundo (Farines, Fraga &amp;amp; Oliveira, 2000), um STR pode ser de:
•	Resposta Garantida, quando sua implementação é tal que dispõe de recursos suficientes para suportar a carga de pico, ou
•	Melhor Esforço, quando a alocação de recursos se baseia num estudo probabilístico sobre a carga esperada e os cenários de falha aceitáveis.
O último tipo é o padrão no caso de sistemas brandos, sendo inaceitável para sistemas críticos, os quais devem dispor de resposta garantida.
Para o projeto de sistemas embarcados cuja finalidade envolve a interação com o ambiente (como sistemas de supervisão, de monitoração ou de controle, todos estes, intrinsecamente, sistemas de tempo real), são aplicadas técnicas de projeto que levam em conta os mesmos elementos dos STR, como o tipo de garantia de resposta desejada, a classificação de segurança e o estudo do comportamento do sistema frente à pior hipótese de carga. A aplicação destas técnicas de projeto é facilitada por ferramentas computacionais de análise de escalonabilidade e modelagem, algumas das quais desenvolvidas com foco no projeto de sistemas embarcados, como a TIMES (Amnell et al, 2002).
De modo a efetuar este estudo de comportamento, se utiliza o modelo de tarefas para ambientes de tempo real proposto por (Liu &amp;amp; Layland, 1973), o qual considera as tarefas executadas pelo processador como periódicas (chegam para execução em intervalos constantes, o qual é o mínimo intervalo possível de chegada), com prazos de execução (deadline) definidos como o instante de chegada da próxima instância da mesma tarefa e com tempo de processamento constante (o maior tempo possível no qual a tarefa é processada), de modo a simplificar a análise de pior caso. Quanto à notação, uma tarefa t ¿ é a i-ésima tarefa periódica de um conjunto a ser executado num processador e tem tempo entre chegadas T e tempo de execução C¿.
O levantamento destas tarefas é realizado na modelagem dinâmica do sistema, conforme visto anteriormente. Seguindo a estratégia proposta por (Wolf, 1994), aquelas funcionalidades que foram
eleitas para implementação por software deve ser escalonadas nos processadores do SE de modo a cumprir seus requisitos. Aplicando o modelo de tarefas citado no parágrafo anterior para um sistema embarcado de controle considerado como de segurança crítica, pode-se considerar que o período de chegada das tarefas é o próprio período de amostragem do sistema. Deste modo, para que o sistema embarcado seja considerado de resposta garantida, deve ser projetado de modo que o conjunto de tarefas de medição (leitura de sensores), controle (cálculos baseados na leitura) e atuação (aplicação de valores em dispositivos externos) de todas as malhas envolvidas, mesmo sob variações de desempenho do hardware, seja executado sem que haja atrasos. Isso quer dizer que nunca uma instância de uma tarefa periódica t ¿ deverá estar sendo executada no momento da chegada de outra instância. Já para um sistema de medição que visa cumprir determinados requisitos metrológicos dependentes da inexistência de atrasos sob esta ótica, sendo considerados como sistemas brandos, caso o conjunto de tarefas não seja factível (escalonável), um eventual requisito de desempenho (p. ex. erro, resolução) não será cumprido naquele caso.
Para ilustrar melhor o exposto anteriormente, tome-se o exemplo de duas tarefas periódicas e t2 , alocadas em um mesmo processador, com tempos de execução Ct e C2 e períodos de amostragem e T2, sendo que Tr &amp;lt;T2. (Liu &amp;amp; Layland, 1973) mostram que é possível usar uma regra de escalonamento por prioridade fixa que possibilite a execução destas tarefas sem atraso se for garantido que:
HJ.Q+ C2&amp;lt;T2 ,	(1)
onde [xj é o maior número inteiro menor ou igual a x. A regra de escalonamento a ser utilizada neste caso é definir maior prioridade para as tarefas com menor período de ocorrência (regra conhecida como Rate Monotonic).
2.3.2	Computação gráfica
A computação gráfica (CG) é uma área da Ciência da Computação destinada à geração de imagens (Manssour &amp;amp; Cohen, 2006) e seu surgimento está intimamente relacionado ao próprio surgimento dos computadores (Foley, 1996). O seu uso, no entanto, esteve restrito por vários anos, dada a baixa disponibilidade de hardware gráfico especializado e até de programadores da área (Foley, 1996) (Manssour &amp;amp; Cohen, 2006). O grande avanço experimentado pelos hardwares gráficos nos últimos anos impulsionou o desenvolvimento da
computação gráfica como ciência e abriu seu leque de aplicações, o que inclui as áreas de defesa, engenharia, ciência pura e aplicada, arte e entretenimento, entre outras (Foley, 1996).
O uso cada vez mais frequente de recursos gráficos na computação demandou o surgimento de padrões e APIs (do inglês Application Programming Interfaces, interfaces para a programação de aplicações) que facilitassem o desenvolvimento e o reaproveitamento de novas aplicações de computação gráfica. Entre os padrões surgidos, destacaram-se e mantiveram-se no mercado o OpenGL (Shreiner, 2009) e o Direct3D (Microsoft Corporation, 2012).
O OpenGL é uma especificação aberta de interface para GPUs (Graphics Processing Unit, unidade de processamento gráfico) multiplatafroma, a qual consiste de um conjunto de mais de 700 comandos que possibilitam o desenvolvimento de aplicações de computação gráfica. Há implementações de OpenGL para os mais comuns sistemas operacionais disponíveis (p. ex. Windows, Linux, FreeBSD, iOS) e a maioria dos formatos de sistemas computacionais, como PCs, Macintoshs, smartphones, tablets e handhelds. É especificado por um consórcio de quase 100 empresas denominado Khronos Group, do qual fazem parte empresas de grande importância na área tecnológica, como Apple, NVidia, Intel, Silicon Graphics, Samsung e AMD, dentre outras (Khronos Group). Suas APIs são escritas para a linguagem de programação C e podem ser acessadas de qualquer linguagem que suporte encapsuladores e/ou interoperação. O estilo de programação em OpenGL é o de uma máquina de estados.
Já o Direct3D é um conjunto de APIs cuja funcionalidade está estreitamente ligada à do OpenGL, porém é restrito às plataformas Windows e é especificado e suportado unicamente pela Microsoft. Sua alta abrangência no mercado de jogos se deve à própria abrangência de PCs rodando Windows na atualidade. A linguagem padrão para programação utilizando Direct3D é a C++. Diferentemente de OpenGL, Direct3D oferece uma abordagem orientada a objetos na sua aplicação.
A geração de gráficos criados em ambas APIs, reflexo do próprio funcionamento do hardware o qual acessam, segue basicamente o fluxo apresentado na figura 27 (Leach, 2012), conhecida na literatura técnica como graphics pipeline.
Figura 27 - O fluxo de dados em aplicações de CG, desde o software até a tela.
3D Application or Game
3D API Commands
3D API: OpenGL or Direct3D
CPU ■ GPU Boundary
GPU Command &amp;amp; Data Stream
I
GPU Front End
Assembled
Vertex Index Stream
Polygons, Lines I &amp;amp; Points
Pretransformed Vertices
Programmable Vertex Processor
Pixel Location Stream
Rasterization &amp;amp; Interpolation
Rasterized Pretransformed Fragments
Primitive Assembly
(Transformed Vertices
Raster Operations
Programmable Fragment Processor
Pixel Updates
1 Transformed Fragments
Fonte: (Leach, 2012).
Os processadores gráficos têm passado por uma forte evolução desde o início da primeira década de 2000. Hoje os chips gráficos disponíveis no mercado já contam com centenas de núcleos de
processador6. As etapas de transformação de geometria e rasterização7 se tornaram programáveis (blocos Programmable Vertex Processor e Programmable Fragment Processor na figura 27), em oposição ao modelo fixo implementado anteriormente. Para que se pudesse ter acesso a essas novas tecnologias, surgiram linguagens específicas para este fim, denominadas linguagens de tonalização (shading languages). O código produzido nestas linguagens é executado em paralelo nos muitos núcleos gráficos, quando possível, e palavras reservadas nestas linguagens permitem a programação dos modelos de transformação geométrica e de rasterização.
2.3.3	Realidade virtual
Ao mesmo tempo em que houve grande avanço no hardware de geração gráfica, novos dispositivos de interação (entrada do usuário) e de apresentação mais intuitivos foram criados, permitindo a sua utilização conjuntamente a sistemas de computação gráfica com grau de imersão visual cada vez mais alto, o que levou à criação do conceito de realidade virtual (RV). Segundo (Hancock, 1995), realidade virtual é “a forma de interação homem-máquina mais avançada disponível”, baseada em imersão e interatividade. Já (Hills, 1999) prefere, após revisão crítica do trabalho de vários autores, dizer que RV “é uma tecnologia que se apoia em imagens com as quais, e através das quais, o seu usuário interage”, complementando com a citação de que “é um objetivo que os sistemas computacionais interativos visam” à medida que evoluem, frente ao “desejo cyberpunk dos anos 80 de deixar o corpo para trás e flutuar como pura informação num cyberespaço”. Ou seja, realidade virtual é uma tendência de levar o usuário de um sistema a sentir-se parte dele. Percebe-se, portanto, que a computação gráfica é o cerne da RV, dado que esta última depende da existência de ambientes virtuais imersivos e interativos gerados por computador.
Para o projeto de sistemas de RV, portanto, é necessário garantir imersão e interação intuitiva. A interação se dá por dispositivos de interface homem-máquina que tentam aproximar os comandos de entrada de gestos que o usuário efetuaria caso estivesse interagindo com
6Por exemplo, uma placa gráfica AMD Radeon 6990, uma das mais rápidas da atualidade, contém 3072 unidades lógicas e aritméticas (ALUs) que executam a mesma instrução em paralelo.
7	Grosso modo, consiste em transformar um conjunto de dados geométricos em pixels, dado um ponto de vista e um volume definido.
um ambiente real. Entre os dispositivos desenvolvidos para este fim encontram-se luvas com sensores de movimentos, trackpads (dispositivos que rastreiam o movimento da cabeça do usuário) e, mais recentemente, controles remotos sensíveis ao movimento (como o Nintendo Wiimote) e dispositivos de captura de gestos corporais (como o Microsoft Kinect).
De modo a criar a sensação de imersão num ambiente virtual, é importante o realismo da cena, explorando a fundo as capacidades gráficas disponíveis para criar ambientes virtuais que lembrem o mundo real. Isto inclui também o uso de ferramentas de apresentação imersivas, como salas de projeção e dispositivos de visualização estereoscópica.
A estereoscopia é o processo de visualização de uma cena por cada um dos olhos do observador a partir de dois pontos de vista levemente separados. A combinação de duas imagens captadas nesses pontos de vista permite a criação da sensação de profundidade, o que é justamente o que ocorre no cérebro humano quando os dois olhos captam imagens levemente deslocadas. A figura 28 é um exemplo de par de imagens estereoscópicas.
Figura 28 - Uma mesma cena fotografada de dois pontos levemente separados.
'	'"w * ’ À	lí		- i	.A		 '	
■	x wRbn		X	.K	
... ■			
Fonte: Autor.
Um dispositivo de visualização estereoscópica, portanto, deve dispor de um meio de entregar uma imagem de uma mesma cena para cada olho, porém com os seus pontos de vista de geração levemente afastados um do outro. Diversos dispositivos de visualização estereoscópica estão disponíveis no mercado atualmente, como as salas de cinema 3D, as quais contam com pares projetores de luz polarizada, telas não-despolarizantes e óculos polaroides. Outros exemplos são TVs e monitores 3D. A maioria destes monitores e TVs funciona com auxílio de óculos ativos para direcionar os quadros dedicados a cada olho. Estão
disponíveis ainda HMDs (Head Mounted Displays), monitores duplos para uso acoplado à cabeça e que disponibilizam uma imagem distinta diretamente para cada olho.
Por fim, num sistema de RV é fundamental a sinergia entre os dispositivos de entrada, de saída e o próprio comportamento dinâmico do software. A apresentação dos dados deve ter tempo de resposta compatível com a interação do usuário, caso contrário este pode não sentir-se imerso. Da mesma forma, é importante que os métodos de entrada sejam escolhidos de modo que estejam relacionados com o tipo de conteúdo com o qual o usuário deverá “interagir”.
Técnicas de realidade virtual têm sido utilizadas com sucesso principalmente nas áreas de prototipagem, marketing e entretenimento (Foley, 1996) (Soares &amp;amp; Santos, 2008). Nos últimos anos, a indústria de P&amp;amp;G passou a se valer mais fortemente de ferramentas de RV, principalmente como forma de alavancar novos negócios, necessidade esta causada, principalmente, pela baixa valorização do petróleo nos anos 1990 (Russo et al, 2004). Entre os exemplos de aplicações encontrados na indústria de P&amp;amp;G tem-se a visualização interativa de grandes volumes de dados de reservatórios (Russo et al, 2004) e uma plataforma de conversão de modelos CAD para interação por RV (Soares &amp;amp; Santos, 2008). No Centro de Pesquisas e Desenvolvimento Leopoldo A. M. de Mello - o CENPES - Petrobras - encontra-se um centro de realidade virtual, o qual é utilizado para a simulação de ambientes de exploração, navegação em plantas de refinarias virtuais, visualização de dados de reservatórios, entre outras aplicações.
68
3	CONCEPÇÃO DO PERFILÔMETRO
O sensor óptico desenvolvido por (Buschinelli, 2007) foi o ponto de partida para a criação de um perfilômetro que pudesse ser aplicado a uma região de um tubo, não somente a uma secção. Para isto iniciou-se no LABMETRO-EMC-UFSC, numa parceria com a Petrobras, um projeto de pesquisa e desenvolvimento para a criação de uma completa solução de perfilometria geométrica que utiliza o sensor apresentado no capítulo 2.2. Por conta da tecnologia aplicada no sensor, batizou-se o projeto de “PEROLA: perfilometria óptica a laser aplicada a dutos”.
O projeto PEROLA como um todo prevê, além do dispositivo de perfilometria interna baseado no sensor apresentado no capítulo anterior, também um dispositivo para inspeção externa e um sistema para visualização da geometria adquirida por ambos. O dispositivo de inspeção interna é também chamado de “PEROLA - Interno” ou simplesmente “PEROLA-I”. Analogamente, o dispositivo de inspeção externa é o “PEROLA - Externo” ou simplesmente “PEROLA-E”
O desenvolvimento do protótipo do PEROLA-E foi apresentado primeiramente em (Haertel, 2009); versões mais recentes foram apresentadas em (Buschinelli et al, 2012) e (Haertel et al, 2012). As contribuições apresentadas aqui dizem respeito ao PEROLA-I e ao sistema de visualização, pelo que, a partir de agora, o sistema de visualização será referido como parte integrante do PEROLA-I. Contudo, características do PEROLA-E são levadas em conta para o projeto do sistema de visualização, conforme será esclarecido adiante no item 5.1.
Este capítulo apresenta, primeiramente, o princípio de solução do PEROLA-I. Em seguida apresenta sua estruturação em módulos funcionais, realizada a partir de um refinamento do princípio de solução. Em seguida são definidos quais destes módulos funcionais foram abordados no contexto desta dissertação. Posteriormente são apresentados os requisitos de projeto, levantados junto ao corpo técnico de refinarias de petróleo brasileiras.
3.1	PRINCÍPIO DE SOLUÇÃO
Para desenvolver um perfilômetro interno a partir do sensor óptico, primeiramente é necessário adequá-lo numa estrutura mecânica que o centralize no interior de um tubo a ser mensurado, de modo que o sensor e o tubo fiquem com seus eixos alinhados. Então é necessário ser
possível deslocá-lo de forma controlada ao longo do interior da região de interesse do tubo, fazendo com que a cada incremento de deslocamento predefinido haja um disparo de medição do sensor. Desta forma será adquirida a geometria de várias secções contíguas e igualmente espaçadas, conforme figura 29.
Figura 29 - O deslocamento controlado do sensor ao longo do eixo do tubo permite a aquisição da geometria de sucessivas secções.
Fonte: Autor.
Os dados resultantes de cada medição de perfil circular (em coordenadas polares) devem, posteriormente, ser concatenados por software, resultando numa tabela de valores em coordenadas cilíndricas, conforme figura 30. Estes dados constituem uma nuvem de pontos cilíndrica (NPC) que representa a geometria da região inspecionada, tendo em cada ponto da nuvem uma amostragem da superfície interna.
Figura 30 - As k listas de n valores adquiridos em coordenadas polares devem ser concatenadas de modo a formar uma tabela de ordem n X k em coordenadas
cilíndricas.
1	2	k	1	2	... k
«1		«1
«2		«2
«3	O	«3
		
«n		«n
Fonte: Autor.
«1,1	«2,1		«k,l
«1,2	«2,2		«k,2
«1,3	«2,3		«k,3
			
«1,71	«2,J1		«k,n
Para que o resultado de medição possa ser percebido visualmente, é necessário um software de visualização capaz de reconstruir virtualmente a região inspecionada a partir da nuvem de
pontos adquirida, idealmente oferecendo capacidades de leitura e interpretação melhores que aqueles associados aos pigs apresentados no item 2.1. Uma função desejada neste caso é a reconstrução do perfil em três dimensões, como na figura 31.
Figura 31 - Reconstrução 3D da geometria interna (vista externa) de um trecho de tubo metálico utilizando codificação de cores para valores de raio.
Fonte: Autor.
3.2	DETALHAMENTO PRELIMINAR
A partir de um detalhamento do princípio de solução apresentado, foi concebido um modelo em notação IDEF0 (Integration Definition for Function Modeling) (National Institute of Standards and Technology, 1993) para descrever o PEROLA-I de um ponto de vista funcional8.
O modelo conta com uma função-raiz, de mais alto nível, cujas subfunções de interesse foram detalhadas em seus diagramas próprios, conforme padrão proposto em (National Institute of Standards and Technology, 1993). Diagramas deste modelo estão apresentados nas figuras 32, 33 e 34. Algumas decisões de modelagem apresentadas nos diagramas a seguir foram tomadas de forma a melhor elucidar o escopo do trabalho, pelo que também foram omitidos alguns elementos de modelagem considerados irrelevantes.
8	IDEF0 foi escolhida aqui por sua simplicidade. Nesta notação, cada seta deve representar um substantivo (recursos, entradas e saídas) e cada retângulo deve representar um verbo (funções ou processos). Setas entrando por cima representam restrições e variáveis de controle, enquanto que por baixo representam recursos utilizados.
Figura 32 - Diagrama funcional básico IDEF0 de mais alto nível do PEROLA-I.
Fonte: Autor.
O fato do sensor óptico já desenvolvido se basear numa câmera demanda a existência da função A1, “adquirir imagens da região”. Esta última deve respeitar as limitações impostas pelas características do sensor óptico, conforme variável de controle no diagrama acima. Sua entrada é o deslocamento do perfilômetro na região a ser mensurada e sua saída é um conjunto de imagens daquela região. A partir destas imagens será extraída, pela função A2, uma nuvem de pontos cilíndrica descritiva da geometria da região de tudo aplicada. Esta nuvem de pontos será a fonte de dados de um sistema de visualização que cumpre a função A3, permitindo a um usuário analisar de forma satisfatória a geometria inspecionada, devendo utilizar para isso técnicas de realidade virtual.
A função A1 é detalhada na figura 33.
Figura 33 - Detalhamento da função de aquisição e disponibilização de imagens.
Fonte: Autor.
Para garantir que as imagens sejam adquiridas num mesmo referencial, é necessária a medição de um eventual e indesejado deslocamento angular em torno do eixo do perfilômetro, além do deslocamento axial. Um hardware embarcado no corpo do perfilômetro deve executar a função A11 (bloco 1 do diagrama A1, figura 33), respeitando as restrições impostas pela estrutura mecânica do perfilômetro. Este mesmo sistema embarcado será utilizado para efetuar o disparo da aquisição de imagens da câmera do sensor e enviar os dados necessários de etiquetagem.
Um módulo de software de controle da câmera do sensor deve ser utilizado para o cumprimento da função A12. Através dele o usuário deve ser capaz de regular parâmetros de aquisição de imagens, como tempo de exposição e sensibilidade do sensor CCD. Além de fornecer as imagens para processamento pelo algoritmo do sensor óptico, este módulo deve disponibilizá-las para visualização em tempo de execução.
A função A2 é detalhada na figura 34. Nota-se neste caso a necessidade da definição de um padrão de armazenamento para garantir a compatibilidade com o sistema de visualização que desempenha a função A3.
Figura 34 - Detalhamento da função de extração de nuvem de pontos cilíndrica correspondente à região inspecionada.
Fonte: Autor.
3.3	DEFINIÇÃO DO ESCOPO DO TRABALHO
O projeto PEROLA é desenvolvido em equipe, com atribuições e responsabilidades delegadas a cada integrante. O somatório coordenado das várias atribuições leva à sua materialização. O presente trabalho de mestrado contribuiu ao projeto nos seguintes aspectos:
•	Projeto, implementação e avaliação do sistema embarcado de monitoração de deslocamentos e do módulo de software de gerência da câmera do sensor, os quais são conjuntamente referidos como “sistema de aquisição e disponibilização de imagens” e cumprem a função A1;
•	Definição do protocolo de armazenamento da nuvem de pontos cilíndrica e
•	Projeto, implementação e avaliação do sistema de realidade virtual cumpridor da função A3.
O sistema de aquisição e disponibilização de imagens é apresentado no capítulo 4 e teve seu desenvolvimento iniciado em (Melo, 2009). A definição do protocolo de armazenamento e o desenvolvimento do sistema de RV para visualização dos resultados das medições são apresentados no capítulo 5.
Não estão incluídos no contexto desta dissertação, portanto, o projeto da estrutura mecânica do perfilômetro (o qual é anterior a este trabalho) nem o aperfeiçoamento do software do sensor, o qual cumpre a função A2. Ambos os casos são, no entanto, considerados nas decisões de projeto aqui tomadas.
3.4	REQUISITOS TÉCNICOS
Considerando características do sensor óptico e o princípio de solução apresentado, foi estabelecido um conjunto de requisitos técnicos para o PEROLA-I. Estes requisitos levam em conta valores desejados de desempenho operacional e normas de segurança em refinarias e estão na tabela 2. Foram destacados os itens relevantes para as funções específicas a este trabalho de acordo com a tabela 1.
Tabela 1 - Lógica de destaque dos requisitos da tabela 2.
Relativo ao Sistema de Aquisição e Disponibilização de Imagens	Unidade	Valor
Relativo ao Sistema de Realidade Virtual para Visualização e	Unidade	Valor
Fonte: Autor.
Tabela 2 - Requisitos técnicos do PEROLA-]
Requisito de Projeto	Unidade	Valor-meta
1 - Diâmetro do duto a inspecionar	Pol. (mm)	6 (152,4)
2 - Atendimento às normas de segurança em refinaria	Sim/Não	Sim
3 - Operação em dutos limpos e secos	Sim/Não	Sim
4 - Confiabilidade	Falhas / km	1
5 - Extração de parâmetros geométricos	Sim/Não	Sim
6 - Comprimento máximo (entre o computador e o cabeçote)	m	50
7 - Largura mais comum do defeito a ser medido	mm	3 a 10
8 - Comprimento mais comum do defeito a ser medido	mm	2 a 10
9 - Profundidade mais comum do defeito a ser medido	mm	2 a 10
10 - Incerteza do raio	mm	± 0,4
11 - Incerteza da medição de deslocamento	%	2
12 - Materiais limpáveis e resistentes	Sim/Não	Sim
13	- Facilidade de manutenção / Reposição de peças degradadas
14	- Velocidade de processamento
Sim/Não
imagens/s
Sim
10 a 50
16 - Durabilidade	Anos	&gt; 2 anos
17 - Resolução axial	mm	1
18 - Resolução angular	o	0,25
19 - Velocidade de inspeção	mm/s	10 a 50 mm/s
20 - Facilidade de instalação em campo	No. pessoas	1
21 - Visualização em 3D	Sim/Não	Sim
22 - Facilidade de Operação	Sim/Não	Sim
23 - Facilidade de transportar /acondicionar	Sim/Não	Sim
24 - Ângulo de visão	O	&gt;70
25 - Interface de software amigável	Sim/Não	Sim
26 - Raio de curvatura mínimo	m	10 m
27 - Tamanho	(diâmetro	x comprimento) mm	120 x 800
28 - Massa	kg	20
29 - Temperatura de operação9	°C	0 a 45
30 - Alimentação própria/armazenagem dados	Sim/Não	Não
31 - Tração própria	Sim/Não	Não
Fonte: LABMETRO-UFSC.
Esta definição de requisitos foi dada através de um processo iterativo, pelo que alguns dos mesmos foram retirados das próprias características logradas no desenvolvimento do sensor óptico em (Buschinelli, 2007), como os requisitos 3, 6, 14, 15, 19 e 24. Alguns outros valores-meta já eram buscados no desenvolvimento do sensor e aqui foram mantidos, como os requisitos 1, 7, 8, 9, 10, 11, 17 e 18. Há
9	Aqui foi escolhido, por simplicidade, o valor de trabalho da câmera do sensor.
também variáveis simplificadoras do desenvolvimento numa primeira fase, como os requisitos 29, 30 e 31.
Os demais requisitos da tabela 2 dizem respeito à aplicação do sensor num sistema completo de perfilometria. Entres estes, foram destacados alguns como sendo relativos aos sistemas pertinentes a este trabalho, citados no item 3.3.
Nos próximos dois capítulos são apresentados os desenvolvimentos destes sistemas, os quais se baseiam na modelagem da solução apresentada e nos requisitos do PEROLA-I relativos aos mesmos, além de outros requisitos incorporados posteriormente.
78
4	SISTEMA DE AQUISIÇÃO E DISPONIBILIZAÇÃO DE IMAGENS
Este capítulo apresenta o desenvolvimento conjunto do sistema embarcado de monitoração de deslocamento e do módulo de controle da câmera do sensor óptico. Primeiramente são apresentados os seus requisitos específicos e as soluções adotadas no seu cumprimento. Em seguida, é apresentado o desenvolvimento dos sistemas que cumprem as funções especificadas na modelagem realizada no item 3.2.
4.1	GERAÇÃO DE REQUISITOS
Combinando os requisitos do PEROLA-I colocados na tabela 2 com aqueles relacionados à função A1 do diagrama da figura 33, foram gerados os requisitos específicos do sistema de aquisição e disponibilização de imagens. Estes requisitos estão na tabela 3. Foram também considerados requisitos impostos por restrições mecânicas e critérios de usabilidade.
Tabela 3 - Requisitos do módulo de aquisição e disponibilização de imagens
Requisito de Projeto	Unidade	Valor-meta
1A - Atendimento às normas de segurança em refinaria	Sim/Não	Sim
1B - Operação em condições adversas de limpeza	Sim/Não	Não
1C - Confiabilidade	Falhas / km	1,0
1D - Comprimento mínimo entre o computador e o cabeçote	m	50
1E - Incerteza da medição de deslocamento	%	2
1F - Facilidade de reposição	Sim/Não	Sim
1G - Velocidade de aquisição	Imagens/s	50
1H - Resolução axial mínima	mm	1,0
1I - Resolução angular	0	0,25
1J - Velocidade de inspeção	mm/s	50
1L - Largura máxima da placa interna	mm	55
1M - Comprimento máximo da placa interna	mm	65
1N - Disponibilização das imagens adquiridas por arquivos	Sim/Não	Sim
1O - Disponibilização das imagens adquiridas por software integrável	Sim/Não	Sim
1P - Imagens disponibilizadas no mesmo referencial	Sim/Não	Sim
1Q - Visão da imagem corrente capturada	Sim/Não	Sim
1R - Configuração de parâmetros de captura em tempo de operação	Sim/Não	Sim
1S - Possibilidade de operação com diferentes modelos de câmeras	Sim/Não	Sim
Fonte: Adaptada de (Melo, 2009).
Para o cumprimento destes requisitos, o projeto foi dividido, conforme apresentado na modelagem do diagrama A1 no item 3.2, em dois módulos funcionais:
•	Módulo de monitoração de deslocamentos, implementado através de hardware e software embutidos no perfilômetro;
•	Módulo de gerenciamento da câmera do sensor, implementado como biblioteca de software a ser integrada ao software de operação do perfilômetro, executado em plataforma PC.
O PC que executa o software de operação do perfilômetro será referido como “PC anfitrião”, enquanto que o módulo de monitoração de deslocamentos pode ser referido adiante simplesmente como “sistema embarcado”. O desenvolvimento destes módulos é apresentado nas duas próximas seções.
4.2	MÓDULO DE MONITORAÇÃO DE DESLOCAMENTOS
Este módulo é responsável pela medição do deslocamento do perfilômetro; tanto o deslocamento linear ao longo do eixo da região de tubo a ser mensurada (deslocamento axial - função hodômetro) quanto a rotação ao redor do seu próprio eixo (deslocamento angular - função inclinômetro). É responsável também por disparar a aquisição de imagem na câmera do sensor óptico, a cada incremento predefinido de deslocamento axial, e fornecer os dados de etiquetagem essenciais para a reconstrução da geometria inspecionada. Além disso, deve receber comandos do software de operação do PEROLA-I para zerar as
medições e definir a distância padrão a ser percorrida a cada medição de secção.
A fim de se ter uma noção geral do sistema projetado, a forma como o módulo de monitoração interage com outros componentes do PEROLA-I é mostrada na figura 35, a qual apresenta uma modelagem simplificada de alto nível de abstração dos dispositivos e sistemas do perfilômetro. Este modelo foi criado em linguagem AADL gráfica10. Uma explicação básica dos conceitos utilizados desta linguagem é dada no Apêndice A.
Figura 35 - Diagrama AADL de sistemas e dispositivos do PEROLA-I. Os dados e o dispositivo em cor mais fraca representam um caminho secundário, utilizado apenas na indisponibilidade da via principal.
Fonte: Autor.
O diagrama mostra que o módulo de monitoração (sistema ModuloMonitoracao) cria o evento disparocamera, fornece os dados de etiquetagem ao software de operação do perfilômetro, executado no sistema PC (portas de dados e eventos etiqcam, etiq_pc e etiquetagem), e dele recebe comandos de configuração (portas de dados e eventos
10	A linguagem AADL possui as versões gráfica e textual.
comandosse, comcam e com_pc). Esta troca de dados pode se dar através do uso de registradores na câmera do sensor, caso esta disponha de funcionalidade de leitura e escrita por dispositivo externo. O módulo embarcado realiza estas operações através dos canais de dados RX (recepção) e TX (transmissão) da câmera, enquanto que o módulo de gerenciamento da câmera realiza sua comunicação através da conexão da câmera com o PC anfitrião, a qual é utilizada para todas as portas de dados entre o sistema PC e o dispositivo Camera no diagrama. Neste caso o software executado no PC deve realizar a leitura e escrita dos registradores de forma sincronizada com as ações do sistema embarcado.
Caso a câmera utilizada não disponha de recurso de escrita por dispositivo externo, pode ser utilizada uma via alternativa (destacada em cor diferente no diagrama), daí a duplicidade de algumas conexões e dados no modelo. No caso deste projeto, foram usados dois modelos de câmera. A utilizada nas primeiras concepções possui interface firewire. A câmera utilizada na concepção atual tem interface gigabit ethernet (GigE). Ambas dispõem de conectores que possibilitam comunicação serial com dispositivos e acionamento externo, utilizando, portanto, os canais padrão apontados no diagrama. O evento disparocamera ocorre quando o módulo detecta um deslocamento axial padrão, cujo valor é definido pelo operador do perfilômetro; após a aquisição da imagem, o software executado no PC anfitrião recebe a mesma junto com seus dados de etiquetagem.
4.2.1 Hardware
Um modelo simplificado11 em AADL do hardware do módulo de monitoração é apresentado na figura 36. Este diagrama é o detalhamento do sistema ModuloMonitoracao da figura 35 e apresenta, portanto, as mesmas portas de dados e eventos presentes no referido sistema.
11	Uma das simplificações presentes no diagrama foi representar o microcontrolador utilizado como um processador, o que não deve, entretanto, prejudicar na compreensão do modelo.
Figura 36 - Modelo AADL simplificado do hardware do módulo de monitoração de deslocamento.
Microcontrolador
varhodometro
var incEnometro
comandos «á í
Fonte: Autor.
etiquetagem fel-
Os dispositivos Enc_hodometro e Enc_inclinometro fornecem o sinal que possibilita a medição dos deslocamentos axial e angular, respectivamente. Ambos têm tipo de sinal idêntico, codificado em dois bits, cujos possíveis valores de saída são apresentados na tabela 4.
Tabela 4 - Estados assumptíveis pelo sinal de saída dos encoders de codificação de dois bits.
Canais	A	B
Valor lógico no “estado 1”	0	0
Valor lógico no “estado 2”	1	0
Valor lógico no “estado 3”	1	1
Valor lógico no “estado 4”	0	1
Fonte: Autor.
Estes estados são lidos por um microcontrolador situado numa placa de circuito impresso através das portas var hodometro e varinclinometro. Uma mudança de estado no valor de saída destes dispositivos é considerada como um “pulso” e pode ser tratada como evento, como ilustrado pelo uso da porta de dados e evento var_hodometro. Isto permite uma priorização da leitura do hodômetro, função principal do módulo de monitoração. A mesma estratégia não é necessária para a leitura do inclinômetro.
O microcontrolador12 é responsável pelo cálculo dos valores de interesse e geração do evento de disparo, além do envio e recebimento de dados já citado. O sinal do evento de disparo é dado por uma transição de valor lógico conectado diretamente à câmera. Já o envio e recebimento de dados é feito através de um módulo USART 13 disponível no microcontrolador.
Na mesma placa também se encontram condicionadores de sinal para os padrões RS-232 e RS-485 (dispositivos Cond_RS485 e Cond_RS232) utilizados em conjunto com o USART. Ambos os padrões são considerados seguros para a operação em ambiente petroquímico pela relativa baixa frequência de transmissão, da ordem de até 100 kHz.
O primeiro padrão é o utilizado quando se comunica usando a câmera como intermediária e tem seus sinais enviados ao mesmo conector utilizado para o disparo de aquisição. Para atender o requisito de distância entre o computador do sistema e o perfilômetro, no caso da câmera firewire foram utilizados repetidores no cabo que a liga ao PC de operação do perfilômetro. Para a câmera GigE isto não foi necessário, dado que o seu padrão de comunicação cumpre o requisito de distância sem o uso de repetidores. O padrão RS-485 foi o escolhido para uso com a via alternativa (destacada em cor diferene nos diagramas AADL) por ter alcance acima das especificações do perfilômetro, possibilitando a operação transparente em caso de utilizar-se uma câmera que não disponha de comunicação serial com dispositivo externo. Assim, para se utilizar uma câmera no perfilômetro, portanto, basta que ela disponha de acionamento externo14. Percebe-se também que o microcontrolador não diferencia o envio e recebimento de dados passando pela câmera ou pela via alternativa.
Para a aplicação do encoder do hodômetro, foi dimensionada uma roda extra acoplada ao mesmo e posicionada na parte exterior do corpo mecânico do perfilômetro, conforme figura 37. Foi projetada de modo a gerar 10 pulsos do encoder por milímetro percorrido pela roda, ao se utilizar um encoder de 1440 pulsos por volta. Atinge-se desta forma, por projeto, a medida de deslocamento axial com resolução de
12	Na implementação realizada, foi utilizado um microcontrolador PIC® por haver um programador (gravador de código) já disponível no laboratório.
13	Universal synchronous/asynchronous receiver/transmitter, do inglês, receptor/transmissor síncrono/assíncrono universal.
14	Para o uso de uma câmera que não dispõe de acionamento por sinal externo, o módulo de gerenciamento da câmera deve efetuar a aquisição de imagem por software assim que receber os dados de etiquetagem.
0,1 mm, suficiente para aquisições de imagens interespaçadas de pelo menos 1 mm, conforme requisito 1H. Esta resolução de 0,1 mm, correspondente à medida de deslocamento axial sofrido, não deve ser confundida com a resolução axial da aquisição do perfil geométrico, que é a distância entre as aquisições de geometria das secções que compõem a região inspecionada.
Figura 37 - A projeção de parte do corpo mecânico do PEROLA-I, com destaque para a roda do hodómetro.
Fonte: (Melo, 2009).
Já o encoder para a medição do deslocamento angular utilizado é um inclinómetro do tipo diferencial de 5000 pulsos por volta. Seu posicionamento dentro do corpo mecânico do PEROLA-I pode ser visto na figura 38. Na mesma figura pode ser visto o local dimensionado para a placa de circuito impresso que abriga microcontrolador e condicionadores de sinal para comunicação. Deve ser observado que estes componentes (roda externa, inclinómetro e placa) obedecem às restrições previamente impostas pelo projeto mecânico do perfilómetro.
Figura 38 - Vista em corte do PEROLA-I, gerada por uma ferramenta CAD. Destaque para o inclinômetro, à esquerda e destacado em vermelho, e para a placa de circuito impresso, abaixo e destacada em amarelo.
Fonte: Autor.
A relação de pulsos por volta completa do inclinômetro escolhido cumpre com folga o requisito 1I, oferecendo 0,072° de resolução angular. Por razões de economia de espaço, posteriormente foi concebido um inclinômetro alternativo, consistindo de um encoder acoplado a um disco de massa assimetricamente distribuída, característica similar à do inclinômetro já utilizado. Possui contagem de 1440 pulsos por volta, alcançando justamente o valor de 0,25° de resolução angular.
4.2.2 Software
O software executado no microcontrolador tem as seguintes funcionalidades:
•	Verificar a existência de comandos vindos do PC;
o Aplicar comandos, caso existam;
•	Ler encoders do hodômetro e do inclinômetro;
o Calcular as posições axial e angular do perfilômetro;
o Caso seja detectado deslocamento axial correspondente a um múltiplo inteiro do passo de aquisição de
imagens, efetuar o disparo de aquisição na câmera e enviar os dados de etiquetagem calculados.
Entre os comandos enviados do programa de operação do perfilômetro no PC para o sistema embarcado encontram-se:
•	Zerar medição do deslocamento angular e/ou axial;
•	Trocar a distância padrão para aquisição de imagens, i.e., a resolução axial da medição de perfil geométrico, entre os valores 1, 2, 5 ou 10 mm;
•	Notificar uma falha de envio de dados, demandando um reenvio;
•	Definir resolução do inclinômetro em 1440 pulsos por revolução ou 5000 pulsos por revolução.
4.2.2.1	Cálculo de deslocamento e etiquetagem
A leitura do novo estado do sinal do encoder e comparação com o estado anterior permite verificar o sentido do deslocamento da rotação de um encoder e, por consequência, o sentido do deslocamento axial ou angular do perfilômetro. Cada troca de estado gera um pulso. A partir de um dos estados apresentados na tabela 4, o encoder somente alcança outro diferente de apenas um bit, ou seja, com valor lógico diferente em apenas uma das portas.
Apesar da roda do hodômetro ter sido projetada para gerar 10 pulsos do encoder por milímetro percorrido, o valor real desta relação não é exato. A relação mais corretamente utilizada é obtida por calibração do hodômetro, a partir da qual se obtém um valor de distância percorrida por cada pulso recebido, valor obtido em termos de milímetros por pulso. Invertendo-se este valor e normalizando-o para cada valor padrão de espaçamento entre aquisições, nomeadamente, 1, 2, 5 ou 10 mm, obtém-se então o número do incremento de pulsos necessários para aquisição de uma nova imagem. O número inteiro mais próximo deste valor obtido é utilizado como critério de aquisição de imagem. Este valor é aqui denominado pulsos por disparo.
O valor de posição axial utilizado para a etiquetagem da imagem correspondente a um determinado disparo é o número de pulsos do hodômetro acumulados até aquele instante, de modo que o software no PC possa transformá-lo num valor de posição expresso em milímetros. Similar e simultaneamente, quanto à posição angular medida pelo inclinômetro, é enviado o número de pulsos acumulados para que
seja mapeado pelo software como um valor de ângulo. Este envio de dados para etiquetagem acontece através de escrita nos registradores de envio de dados do microcontrolador logo após o disparo de aquisição. A mensagem utilizada tem tamanho de 9 bytes15, comportando cabeçalho, valor de posição longitudinal e angular. O envio propriamente dito acontece paralelamente à execução do código16 do programa, após o término da escrita dos valores de etiquetagem.
Esta estratégia de envio do valor correspondente ao número de pulsos lidos evita um erro cumulativo de quantização que haveria caso se considerasse o disparo da aquisição de imagem como sendo realizado exatamente após se percorrer o valor de deslocamento padrão. Como consequência, o número de aquisições realizadas em uma região inspecionada pode diferir do esperado.
Para exemplificar esta situação, seja um hipotético valor de 10,25 pulsos por milímetro percorrido, obtido após calibração do hodómetro. Suponha-se que o módulo de monitoramento está configurado para aquisição a cada deslocamento de 1 mm. Neste caso, o primeiro disparo da aquisição ocorre ao se receberem 10 pulsos do encoder do hodômetro, o que corresponde a um deslocamento de aproximadamente 0,97 mm. No entanto, as 100 primeiras imagens seriam adquiridas ao se percorrerem 97 mm, enquanto que o valor esperado seria de 100 mm.
Para que este efeito seja mitigado, algumas das aquisições são realizadas após um número de pulsos diferente, de modo a compensar a parte fracionária da relação dada em pulsos por milímetro. No exemplo do parágrafo anterior, a quarta aquisição de um grupo de quatro disparos seria efetuada após a leitura de 11 pulsos. Desta forma, a cada quatro imagens adquiridas, seriam necessários 41 pulsos do hodômetro. Com uma relação de 10,25 pulsos/mm, tem-se neste caso um deslocamento percebido de 4 mm para a aquisição de quatro imagens, o que corresponde ao valor esperado da operação do sistema. Este cenário é exemplificado na figura 39.
15	Os bytes neste caso são de 9 bits, pois contêm um bit de parada.
16	Entende-se aqui como código a sequência binária executada pelo microcontrolador, não o seu código-fonte.
Figura 39 - Ilustração da alteração do número de pulsos por disparo para um caso exemplo de 10,25 pulsos do encoder por milímetro percorrido.
■	Pulsos p/ aquisição
■	Pulsos no deslocamento
Fonte: Adaptado de (Melo, 2009).
Ao sofrer deslocamento no sentido contrário ao padrão, o módulo de monitoramento não efetua disparo de aquisição de imagem. Isto é necessário porque, durante a operação do perfilômetro, pode haver necessidade de deslocá-lo para trás para retirada de algum obstáculo, por exemplo. Ao se atingir novamente a posição na qual teve o sentido de deslocamento invertido, o microcontrolador volta a efetuar disparos.
4.2.2.2	Comportamento dinâmico
O algoritmo embarcado foi projetado para se comportar como ilustrado pelo diagrama de máquina de estados da figura 40. A transição de reinicialização, por ser óbvia, foi retirada do diagrama para facilitar sua leitura.
Figura 40 - Diagrama de máquina de estados de alto nível do software embarcado.
Fonte: Autor.
No estado Inicializa rotina são configuradas as portas do microcontrolador e declaradas as variáveis de trabalho.
O estado Lê deslocamento axial e a transição Int. do hodômetro, destacados no diagrama, só existem se for utilizado o recurso de interrupção do microcontrolador para a leitura do hodômetro. Isto corresponde a um evento na porta var_hodometro no modelo AADL. Esta estratégia pode ser adotada caso se note necessidade de priorização da leitura do deslocamento axial.
A recepção de mensagens vindas do PC é preemptiva (Int. USART), porém deve ocorrer com uma frequência vigorosamente menor e toma menos instruções, além de que o módulo USART no microcontrolador utilizado opera em paralelo. O tratamento de mensagens do PC para o módulo embarcado funciona no modelo produtor-consumidor. Neste caso, o produtor é representado pelo evento de chegada de mensagens, as quais vão sendo enfileiradas em registradores próprios. O consumidor é o código que retira as mensagens da fila e as processa. Na figura 41, a qual contém o diagrama de atividades associado ao estado Laço de operação, as ações Verifica mensagens e Aplica comandos representam o consumidor das mensagens.
Figura 41 - Diagrama de atividades associadas ao estado "Laço de operação".
Fonte: Autor.
A ação Lê deslocamento axial somente consumirá algum tempo caso não seja utilizado o mecanismo de interrupção na leitura do deslocamento axial, conforme citado anteriormente.
As transições correspondentes à existência de mensagens estão no singular devido à estratégia de aplicação de uma mensagem por vez, conforme projeto.
4.2.3	Aspectos de tempo real
O sistema embarcado do PEROLA-I, quanto à segurança, é classificado como um sistema brando, na classificação citada no item 2.3.1.2. Caso haja excesso de velocidade de disparos (mais do que a câmera do sensor pode suportar) e/ou falhas na medição, a qualidade da geometria final inspecionada perderá resolução axial na região onde houver falhas, mas pode manter a qualidade em outras regiões de aplicação. Igualmente, uma falha por si só neste caso não acarreta em dano irreversível. A resolução axial do sistema é suficiente para identificar os defeitos esperados mesmo que a medição sofra algum grau de degradação. Ainda, caso observado que a qualidade da inspeção não foi satisfatória em uma região do mensurando, basta realizá-la novamente.
A carga de pico à qual o módulo embarcado estará sujeito pode ser inferida analisando-se as tarefas modeladas juntamente às especificações de desempenho do sistema. Apesar do requisito de
velocidade de aquisição ser claro, não é possível garantir que o PEROLA-I não estará sujeito a deslocamento em velocidade acima da nominal. Portanto, o sistema é de melhor esforço no que diz respeito à garantia de resposta, também conforme citado no item 2.3.I.2.
As tarefas presentes na modelagem realizada são apresentadas na tabela 5, caracterizadas pelo número arredondado de instruções geradas pelos seus códigos e sua expectativa de ocorrência.
Tabela 5 - Tarefas executadas pelo código embarcado.
Tarefa	Descrição	N° de instruções	Ocorrência
T0	Inicialização	50	Única
T1	Verificação de mensagem	30	A cada laço
t2	Leitura do hodómetro	150	A cada laço
t3	Leitura do inclinómetro	150	A cada laço
t4	Recepção de mensagem	50	A cada aquisição
t5	Aplicação de comando	250	A cada aquisição
T6	Verificação de necessidade de disparo	20	A cada laço
Ty	Disparo e etiquetagem	400	A cada aquisição
Fonte: Autor.
Cada tarefa definida está associada a um estado do diagrama da figura 40 ou a uma ação da figura 41, obedecendo à sequência ali apresentada. Todas são, portanto, tarefas controladas, exceto t4, a qual é esporádica, pois depende da transição Int. USART que pode ocorrer a qualquer momento. Caso a leitura do hodómetro seja utilizada por interrupção na porta do microcontrolador, t2 também se torna esporádica, com sua execução dependendo da ocorrência da transição Int. do hodómetro.
O tempo de execução real das tarefas é obtido através de rotinas de teste que simulam o pior caso de execução. No entanto, a análise realizada aqui leva em conta o tempo de execução como sendo proporcional ao número de instruções do microcontrolador correspondentes a cada tarefa. As razões disto são a simplicidade para análise preliminar e que o tempo real de execução depende de modelos de microcontrolador e configurações que podem ser ajustadas, enquanto o número de instruções permanece o mesmo para o código desenvolvido.
O período crítico de ocorrência de tarefas para o módulo de monitoração é dado pelo requisito de velocidade de inspeção em imagens por segundo. Utilizando-se uma câmera com taxa de aquisição máxima de n quadros por segundo, o intervalo de análise para um cenário de carga de pico deve ser tomado como sendo de (1 0 0 0/n) milissegundos. Este deve ser o intervalo de ocorrência da tarefa t 7, responsável por comandar uma aquisição de imagem. Por exemplo, tomando-se o limite de taxa de aquisição da câmera GigE utilizada como 60 imagens por segundo, deve-se fazer uma estimativa de ocorrência de um ciclo de tarefas num período de 16 ms para se verificar que o sistema seja capaz de cumprir os requisitos de desempenho.
O tempo de processamento de imagem do sensor é plenamente adequado ao período estabelecido, conforme citado no item 2.2.3. A taxa de aquisição da câmera GigE supera o requisito mínimo correspondente, resultando em certa folga, o que é sempre desejável. Porém, caso o período de chegada de t 7 seja menor, ou seja, se houver mais pedidos de aquisição de imagem do que o suportado pela câmera, as requisições excedentes simplesmente não serão atendidas, resultando em degradação da resposta do sistema.
Outro fator temporal não relacionado com o número de instruções das tarefas é o tempo de envio dos dados de etiquetagem a partir do módulo USART do microcontrolador. Algumas instâncias da tarefa T5e todas da tarefa t7 enviam 9 bytes referentes à etiquetagem das imagens, pelo que um ciclo de tarefas entre duas aquisições deve comportar o tempo necessário para este envio. Este tempo depende de quantas ocorrências de envio de etiquetagem há entre duas aquisições na modelagem realizada para estudo de carga de pico e da latência escolhida para a comunicação serial.
Utilizando-se a configuração de resolução axial de 1 mm, tem-se dez trocas de estado do encoder do hodómetro entre aquisições, gerando a chegada de dez tarefas t2 caso seja utilizada a priorização por interrupção, ou demandando a execução de pelo menos 10 laços de atividades em caso contrário. Se utilizada a resolução axial de 10 mm, ter-se-á próximo a 100 ocorrências da mesma tarefa entre duas aquisições de imagem. Caso, com a mesma configuração de 10 mm de resolução axial, não se utilize a tarefa t2 como preemptiva, deve-se ter 100 execuções de laço de operação entre aquisições para que seja feita a leitura adequada do hodómetro.
Quanto às tarefas T4e t 5 , não é prevista no comportamento do sistema uma alta taxa de envio de mensagens PC - SE. Estas são
esperadas, em sua maioria, antes do início da operação, para zerar as medidas e configurar as resoluções axial e angular. Contudo, a mensagem de notificação de falha de comunicação, a qual é enviada automaticamente pelo módulo de controle da câmera no PC anfitrião numa situação de falha, pode ocorrer com razoável frequência, principalmente numa situação de carga de pico. Mesmo que a frequência de ocorrência das tarefas T4e t5 não venha a ser comparável à taxa de aquisição de imagens, é fundamental analisar o caso onde há uma ocorrência de cada uma delas entre duas aquisições.
Foi estabelecido um cenário para avaliação do sistema quando sujeito a uma carga de pico. Este cenário define ocorrências de tarefas em um período crítico entre duas aquisições de imagens, conforme considerações feitas até aqui. Sua definição é a seguinte:
•	No intervalo analisado entre duas ocorrências de t7 , há a chegada de duas mensagens do PC, gerando duas tarefas t4. A primeira notifica a falha no envio da etiquetagem do penúltimo disparo, demandando o seu reenvio; outra mensagem notifica a falha no envio da etiquetagem do último disparo, demandando mais um envio, o que acarreta duas ocorrências de t 5. A soma destes dois pares de tarefas consome 600 instruções. Paralelamente, há o envio de 18 bytes em mensagens.
•	Para a correta leitura do hodómetro sob a configuração de disparo de aquisição a cada 10 mm percorridos, há 100 ocorrências do laço de tarefas [t4, t2 , t3 , t6], cada uma consumindo 350 instruções, num total de 35 mil.
•	No encerramento deste ciclo há um disparo de aquisição t7, o qual consome 400 instruções e acrescenta mais 9 bytes para envio pelo USART.
Quanto à transmissão de dados, para que os 27 bytes do cenário definido sejam transmitidos em tempo hábil, a taxa de transmissão deve ser maior do que 15.187,5 bits por segundo (bps), valor necessário para enviar os 243 bits da mensagem em 16 ms. Portanto, a taxa de transmissão utilizada foi definida como 19200 bps para que se possa lidar com estas ocorrências com segurança.
Conforme descrição do cenário de alta carga, o microcontrolador deve ser capaz de executar pelo menos 36 mil instruções entre duas aquisições de imagem. Levando-se em conta os 16 ms de tempo mínimo entre aquisições no caso da câmera GigE, nota-se a necessidade de um microcontrolador que execute mais de 2,25 milhões
de instruções por segundo (MIPS) para a correta operação com o código desenvolvido. O microcontrolador PIC® utilizado pode operar, utilizando o seu oscilador interno, a até 2 MIPS (Microchip, 2004). Portanto, sujeitando o módulo de monitoração à carga de pico definida, deve haver degradação da resposta em termos de erro de leitura do hodômetro e, consequentemente, de aquisição de imagens na posição esperada.
Trocando-se a configuração da leitura do hodómetro para que seja realizada por interrupção, ou seja, fazendo com que a tarefa t2 seja tornada esporádica e de mais alta prioridade, não são mais necessárias tantas ocorrências do laço principal de tarefas controladas [t-l, t3, t6] entre aquisições num cenário de carga de pico. Reduzindo-se a estimativa para 20 execuções deste laço reduzido, somado a 100 ocorrências de t2 e às outras ocorrências definidas, reduz-se a carga de pico a 20 mil instruções num novo cenário. Neste caso, existe a demanda de 1,25 MIPS, valor menor que a capacidade de processamento do microcontrolador utilizado.
4.3	MÓDULO DE GERENCIAMENTO DA CÂMERA DO SENSOR
A função deste módulo é oferecer ao software de operação do PEROLA-I, executado no PC anfitrião, o acesso à câmera do sensor e ao módulo embarcado de monitoração de deslocamento. Isto é realizado através de uma biblioteca com as seguintes funcionalidades:
•	Visualização da imagem corrente na câmera;
•	Configuração dos parâmetros da captura de imagem da câmera;
•	Envio de comandos ao sistema embarcado;
•	Disponibilização e indexação das imagens etiquetadas recebidas após disparo efetuado pelo SE.
4.3.1 Modelagem
A biblioteca foi projetada de modo a separar os conceitos de recurso, lógica de aplicação e interface. Como recurso tem-se as imagens etiquetadas, a medição e a câmera, principalmente. Apesar da câmera ser utilizada no PEROLA-I com a finalidade de realizar a medição do perfil de secções e também usá-la como canal de comunicação, optou-se por modelar sua entidade correspondente em software de forma desvinculada da sua forma de aplicação, a fim de favorecer a reusabilidade.
O diagrama de classes da figura 42 apresenta, de forma bastante simplificada, as classes do módulo de gerenciamento da câmera do sensor. Foram mantidos basicamente os atributos e métodos essenciais para a compreensão do projeto realizado.
Figura 42 - Diagrama de classes simplificado do módulo de gerenciamento da câmera do sensor.
Fonte: Autor.
Para a utilização de diferentes modelos de câmera, foi concebida uma classe abstrata Camera, a qual dispõe de atributos e
métodos comuns a câmeras acessíveis por software, independentemente do modelo e fabricante. Seus atributos e métodos expostos são coerentes com o dispositivo Camera apresentado no modelo AADL na seção 5.2. Permitem realizar, entre outras ações, a aquisição de imagens, a escrita e leitura de registradores, permitindo a comunicação com o sistema embarcado, além da definição do modo de acionamento como externo ou interno. Também está reservado um método para utilização de um componente de configuração dos parâmetros da câmera.
Para o funcionamento com uma câmera em específico, deve-se criar uma classe que implemente esta classe abstrata e tenha acesso à API própria para o funcionamento com aquele modelo ou família de câmera. Isto pode ser feito com o auxílio de kits de desenvolvimento de software (software development kits, SDKs) específicas de fabricantes de câmera ou APIs com vasto suporte. O controle de configuração, por exemplo, pode ser fornecido pelo fabricante através do SDK ou pode ser implementado pelo desenvolvedor do PEROLA-I. Naturalmente, nem todas as funcionalidades estarão presentes em todos os modelos de câmera. Nestes casos, podem ser programadas mensagens de erro nos métodos e atribuições ausentes.
No estado atual de desenvolvimento tem-se três implementações da classe abstrata câmera. Uma permite acesso às câmeras firewire das concepções mais antigas do sensor óptico. Outra fornece acesso ao modelo de câmera Gigabit Ethernet utilizado na concepção mais atual. A última é uma “câmera virtual de testes”, um trecho de software que emula uma câmera ao fornecer imagens por eventos com uma cadência definida.
A classe CameraHandler permite o uso da câmera num cenário típico, ao disponibilizar um laço de aquisição, métodos de conexão e desconexão e uma retrochamada para a recepção de imagens. De modo a aplicar este cenário ao contexto de medição do PEROLA-I, foi criada uma classe MeasurementCameraHandler que herda CameraHandler e agrega objetos do tipo TaggedImage e Measurement. O objeto TaggedImage representa a última imagem etiquetada adquirida, objeto que é copiado pelo módulo de processamento logo após a aquisição. Os dados de etiquetagem são a posição de aquisição daquela imagem e o ângulo com que ela foi adquirida. Já a classe Measurement contém metadados da operação de perfilometria para uma região onde o PEROLA-I estiver sendo aplicado.
A classe MeasurementCameraHandler é a principal entidade do processo de medição, portanto, pois permite o acesso à câmera do ponto de vista da sua aplicação como componente do sensor óptico a laser. A
separação de conceitos seguida permite, por exemplo, que os métodos de comunicação com o sistema embarcado expostos nesta classe tenham implementações diferentes caso seja aplicada uma câmera sem o uso de interface de comunicação com dispositivo externo.
Do ponto de vista dinâmico, o laço de aquisição de imagens etiquetadas funciona como o diagrama de atividades da figura 43.
Figura 43 - Diagrama de atividades do laço de aquisição de imagens de MeasurementCameraHandler.
Disparo de aquisição
Notifica falha
Leitura serial
Aquisição de imagem
Envio de mensagem para o SE
! V [Não]
Tentativas excedidas?
Aguardo de disparo de aquisição 7K
J-
r
I
' Sucesso?
/" IEntrega de \ Sim] a imagem etiquetada ao i [Nãc
Escrita serial
Fonte: Autor.
O laço de aquisição tem como principal atividade aguardar um disparo de aquisição. Este pode ser dado internamente pela câmera, caso esteja configurada desta forma, ou pelo sinal vindo do módulo embarcado de monitoração. Após a recepção da imagem, esta é disponibilizada para apresentação na tela. O código tenta ler os registradores de comunicação serial da câmera em busca dos dados de etiquetagem. Caso não haja dados ou estes estejam incorretos, uma falha é notificada ao SE, o que influencia nos dados sobre a medição e acarreta numa mensagem ao módulo embarcado. Se o SE responder adequadamente, a imagem é normalmente etiquetada. Senão, considerase uma falha de aquisição.
Para cada aquisição efetuada com sucesso, tem-se a imagem da secção correspondente etiquetada com os dados de posição longitudinal no interior do tubo e o seu ângulo relativo de aquisição. Estes dados estão prontos para ser enviados ao módulo de processamento do PEROLA-I para que sejam traduzidos em geometria, conforme explicado no item 2.2.3, e posteriormente concatenados para se formar a geometria da região inspecionada, conforme item 3.1.
Durante a execução do laço de aquisição, caso o operador decida enviar um comando ao módulo embarcado, este envio é feito diretamente, desviando o fluxo de execução para o envio da mensagem e retornando em seguida.
4.3.2	Interface de usuário
Para a aplicação direta da biblioteca desenvolvida, foi criado um controle de interface gráfica integrável, representado no diagrama de classes da figura 42 por CameraUI. Uma captura de tela desta interface é mostrada na figura 44.
Iniciar medição		Interromper medição
Captura e abre imagem		Reiniciar encoder
		
Reiniciar indinômetro		Reiniciar Hod+lnc
Configurar Hardware
| Configurar câmera | Dados da medição O Câmera ligada [V] Mostrar imagens G3 Mostrar resultado S Trigger
Deslocamento	
Velocidade	mm/s
Vel. Média	mm/s
Vel. Máxima	mm/s
Vel. Segura	mm/s
Posição	mm
Inclinação	graus
Imagens	
Total adquiridas	
Total perdidas	
Perdidas agora	
Fonte: Autor.
Figura 44 - Captura de tela da interface gráfica do módulo de controle da câmera do sensor. As cores apresentadas na imagem capturada pela câmera são
de uma palheta artificial, pois a câmera é preto-e-branco.
Aquisição Dinâmi X ^Visualização
Os comandos disponíveis para envio ao SE são todos aqueles descritos para o sistema de aquisição e disponibilização de imagens. A interface também apresenta valores de monitoração, permitindo ao usuário perceber a existência de falhas, visualizar a velocidade instantânea de deslocamento do perfilômetro e registrar a máxima velocidade sem haver perda de imagens, entre outras informações.
4.4	CONCLUSÃO
O desenvolvimento apresentado do sistema de aquisição e disponibilização de imagens fornece subsídios para a aplicação do sensor óptico na perfilometria de uma região de tubo. Foi cumprida a função A1 do modelo IDEF0 do PEROLA-I, a qual tem como entrada o deslocamento do perfilômetro, como saída um conjunto de imagens etiquetadas e foi desenvolvida respeitando as características do sensor óptico e estrutura mecânica previamente concebida.
Ao se realizar a integração deste módulo com o software de operação e processamento de imagens, tornou-se possível a aquisição de nuvens de pontos representantes da geometria de uma região de tubo mensurada.
102
5	SISTEMA DE REALIDADE VIRTUAL	PARA
VISUALIZAÇÃO E ANÁLISE DE MEDIÇÕES
Este capítulo apresenta o projeto do sistema de realidade virtual para navegação, visualização e análise de nuvens de pontos cilíndricas obtidas pelos perfilômetros PEROLA-I e PEROLA-E.
Primeiramente se apresentam os requisitos do projeto PEROLA relativos ao sistema de visualização de nuvens de pontos e a motivação que levou à sua concepção como um sistema de realidade virtual. Então é mostrada a organização geral do sistema de RV e suas funcionalidades projetadas em termos de casos de uso. É apresentado em seguida o padrão de armazenamento de nuvens de pontos cilíndricas definido para o projeto PEROLA. O projeto detalhado do sistema de realidade virtual e sua implementação são apresentados nos itens subsequentes.
5.1	MOTIVAÇÃO E REQUISITOS
Entre os requisitos do PEROLA-I apresentados na tabela 2 relativos à visualização do resultado de medição, define-se a necessidade de que seja capaz de exibir a geometria adquirida em 3D, seja simples e amigável ao usuário, possa ser operado em laptop e possua funcionalidade de extração de parâmetros geométricos.
Com base nas ferramentas de leitura de resultados de perfilometria dos métodos de inspeção apresentados no item 2.1, nota-se a necessidade de desenvolvimento de uma ferramenta inovadora, poderosa e intuitiva para visualização da geometria adquirida, dada a importância da correta interpretação de dados adquiridos por métodos de inspeção geométrica na indústria petroquímica. Neste sentido, o uso de técnicas de realidade virtual se mostra como uma alternativa interessante, pois tende a tornar mais natural a leitura de um grande volume de dados ao utilizar métodos intuitivos e imersivos.
Idealmente, se um usuário analista pudesse se sentir transportado para dentro da região de tubo inspecionada, ainda tendo acesso a dados quantitativos extraídos no processo de medição, seria possível unir características positivas de uma inspeção visual com a riqueza de informação quantitativa da descrição geométrica em uma única análise. Portanto, é importante também que a ferramenta desenvolvida mantenha um alto grau de similaridade com métodos de leitura comumente adotados, de forma a exigir do seu usuário um mínimo esforço de adaptação.
Além do resultado de medição do PEROLA-I, o sistema de visualização projetado aqui também deve ser capaz de realizar a leitura das nuvens de pontos cilíndricas geradas como saída do PEROLA-E. Para ambos os casos, faz-se necessária a definição de um padrão de armazenamento destas nuvens de pontos.
A partir das ideias discutidas e dos requisitos de visualização do PEROLA, foram consolidados os seguintes requisitos para o sistema de visualização:
•	2A - Representação tridimensional das nuvens de pontos cilíndricas, utilizando técnicas de realidade virtual;
•	2B - Navegação intuitiva em primeira pessoa em ambiente virtual, com a presença da geometria 3D e de objetos de auxílio à leitura;
•	2C - Visualização estereoscópica do ambiente virtual, incluindo a geometria tridimensional reconstruída;
•	2D - Representação planificada da geometria inspecionada, conforme formatos comumente adotados na indústria;
•	2E - Aplicação de escala de cores radial personalizável às representações planificada e tridimensional, de modo a realçar visualmente os valores apresentados;
•	2F - Aplicação de fator de escala geométrica radial à representação 3D, a fim de ressaltar visualmente imperfeições geométricas menos perceptíveis;
•	2G - Definição de limites de visualização (cortes), de modo a simplificar a leitura de determinadas regiões de interesse escolhidas pelo usuário;
•	2H - Extração de características geométricas além daquelas passadas pelo perfilômetro, o que inclui cálculo de área danificada e volume de material perdido e/ou depositado numa região;
•	2J - Aplicação de notas de usuário salvas junto à nuvem de pontos.
5.2	CONCEPÇÃO
De modo a cumprir os requisitos estabelecidos, foi concebido um Sistema de Realidade Virtual (SRV) composto do seguinte ecossistema:
•	Um software de navegação, visualização e análise da nuvem de pontos;
•	Computador com placa de vídeo capaz de executar aplicações OpenGL estereoscópicas;
•	Periféricos de realidade virtual, consistindo de display estereoscópico e métodos de entrada intuitivos.
O software de visualização, por ser o cerne do sistema, poderá ser referido adiante como sendo o próprio SRV, por simplicidade de notação.
O hardware de realidade virtual escolhido para o desenvolvimento do sistema consistiu em um Head Mounted Display (HMD) estereoscópico e um joystick de 12 botões e duas alavancas analógicas, modelo bastante comum no mercado.
O HMD é responsável por entregar, para cada olho do usuário, a imagem correspondente à cena vista daquele ponto, causando a impressão de profundidade na visualização da cena. O modelo utilizado, já disponível no laboratório anteriormente ao início do projeto, utiliza dois pequenos monitores LCD posicionados em frente a cada olho. Estes monitores atualizam a cena a 60 quadros por segundo (ou 60 Hz) cada. A informação vinda da placa de vídeo do computador referente aos quadros é direcionada a cada monitor pela sua paridade. Portanto, o computador deve fornecer atualização de imagens a 120 quadros por segundo, metade dos quais vai para o monitor esquerdo, metade para o direito.
De modo a permitir o desenho das cenas correspondentes a cada olho e interagir com o HMD, escolheu-se uma placa de vídeo NVIDIA® Quadro FX®, utilizada no computador de desenvolvimento do sistema. Esta placa, assim como toda a família Quadro FX, por possuir quatro buffers de saída de imagens, é capaz de oferecer imagens duplas a 120 Hz sem perda significante de desempenho (NVIDIA Corporation, 2012). Isto se deve ao fato de que, por possuir quatro buffers, permite a renderização de duas cenas em paralelo. A família Quadro FX é também otimizada para o uso da API gráfica OpenGL, a qual foi escolhida para o SRV por ser um padrão em visualização muito difundido nos meios industrial e científico.
Mesmo com o uso de hardware estereoscópico, é responsabilidade do software o cálculo dos pares de visualizações da cena para causar o efeito de profundidade desejado. Apesar de demandar maior esforço de desenvolvimento, esta característica faz com que o software desenvolvido seja compatível com diferentes métodos de apresentação.
O joystick utilizado é suficiente para permitir ao usuário aproveitar todas as funcionalidades de visualização e navegação oferecidas pelo software sem a utilização de teclado ou mouse, embora a utilização destes últimos seja permitida. O software foi projetado de modo a suportar diferentes modelos de métodos de entrada, conforme será detalhado no seu projeto.
Para ilustração do ecossistema utilizado no desenvolvimento do sistema, a figura 45 apresenta um usuário do sistema utilizando o HMD e o joystick. Na tela do computador pode ser vista a imagem gerada pelo software do sistema. No HMD, a cena visualizada é a mesma, porém com a sensação visual de profundidade.
Figura 45 - Usuário do sistema utilizando HMD e joystick, ambos em destaque. O computador possui placa de vídeo capaz de gerar imagens estereoscópicas.
Fonte: Autor.
5.2.1	Casos de uso
Os casos de uso definidos para o sistema de realidade virtual foram agrupados em sistemas para a simplificação da sua apresentação. Na figura 46 podem ser vistos os atores do sistema e os casos de uso relativos ao armazenamento dos dados.
Fonte: Autor.
Os perfilômetros do projeto PEROLA geram as nuvens de pontos cilíndricas que são lidas pelo SRV. O salvamento por parte do usuário diz respeito somente às anotações adicionadas, sendo a geometria tratada como somente leitura. O padrão de armazenamento de NPCs é apresentado no item 5.3.
O SRV também deve salvar as preferências do usuário, quando aplicadas.
Os casos de uso relativos às visualizações planificada (2D) e tridimensional da nuvem de pontos são apresentadas no diagrama da figura 47.
Nota-se pelas relações entre os casos de uso que os mapas de cores e limitações de geometria visualizada (cortes) devem ser compartilhados entre as duas representações. Os parâmetros de iluminação devem ser manipuláveis pelo usuário, de modo a facilitar a leitura visual da geometria. A possibilidade de rotação da geometria 3D é importante para se manter a visão em primeira pessoa, sendo ainda capaz de visualizar a geometria por todos os ângulos.
Os casos de uso relativos à navegação e objetos de auxílio no ambiente virtual são apresentados na figura 48.
O uso de transporte animado e “colisão” do ponto de vista do usuário com a geometria (impossibilidade de atravessar a geometria virtualmente reconstruída) favorece a sensação de interação com o ambiente. Os objetos virtuais citados nos casos de uso foram definidos com o objetivo de favorecer a leitura da geometria. No caso dos postes, seu desenho se dá nos locais com anotações. Por isto ele possui uma relação de inclusão com o caso de uso “obter anotações”, apresentado na figura 49, a qual contém os casos de uso relativos à análise dos dados da medição e às anotações de usuário.
Os cálculos de volume de material removido ou depositado sobre a superfície do tubo são realizados nas regiões definidas pelo usuário. Estes cálculos levarão em conta apenas valores que excederem o que o usuário definir como limiar de defeito.
As anotações de usuário são indexadas por posição angular e axial da medição apresentada.
As próximas duas seções apresentam o desenvolvimento das ferramentas necessárias para o cumprimento dos casos de uso apresentados.
5.3	PADRÃO DE ARMAZENAMENTO DE NUVENS DE PONTOS CILÍNDRICAS
O padrão de armazenamento foi projetado com a finalidade de representar de forma única as medições dos perfilômetros externo e
interno. Suas características foram definidas para satisfazer necessidades específicas do projeto. Entre estas características, pode-se citar o posicionamento de secções irregularmente espaçadas para o caso do PEROLA-I. Para o caso do PEROLA-E, por sua vez, é necessária a representação de nuvens de pontos cilíndricas limitadas angularmente, ou seja, cujas secções geométricas não envolvem uma volta completa (360°) em torno do eixo do tubo inspecionado.
A denominação escolhida foi “nuvem de pontos estendida” ou, simplesmente, XCP (do inglês eXtended Cloud of Points). Suas principais características são:
•	Armazenamento de valores em coordenadas cilíndricas no formato binário (menor espaço ocupado e menor tempo de leitura e escrita);
•	Opção de armazenar malhas de pontos cujas secções são espaçadas de um valor fixo (como é a medição do perfilômetro externo) ou com o valor do posicionamento axial de cada secção (caso do perfilômetro interno);
•	Opção de armazenar malhas de pontos com alcance angular incompleto (região mensurada cobrindo menos do que 360°), como acontece com as medições do perfilômetro externo;
•	Armazenamento de valores-chave da medição, como posição axial de início e fim;
•	Armazenamento de valores de cabeçalho, como data, hora, local e operador da medição;
•	Armazenamento de anotações de usuário.
O diagrama de classe da figura 50 apresenta os principais atributos e métodos da entidade que representa a nuvem de pontos segundo o padrão XCP.
Figura 50 - Diagrama de classe simplificado da medição em coordenadas cilíndricas como definida pelo padrão XCP.
XCP
+lnfo : string +AngularBegin : float +AngularEnd : float +AxialBegin: double +AxialEnd : double +AngularResolution : float +AxialResolution : float
+Radii : floatQQ +UserNotes: UserNoteQ
+Load() +Save(string)
Fonte: Autor.
O atributo Radii armazena os valores em coordenadas cilíndricas conforme figura 30, item 3.1. Cada posição contém um valor de raio. Seus valores de ângulo e posição no eixo Z são inferidos através da sua posição na tabela e dos valores-chave da medição. Isto leva em conta, portanto, que valores vizinhos na tabela sejam também vizinhos na geometria.
Desta maneira, o formato de arquivos projetado aqui consegue representar de forma indiferente as medições internas e externas, possibilitando o uso do mesmo software de visualização para ambos os perfilômetros. A biblioteca que cumpre esta especificação foi implementada e integrada nos softwares do PEROLA-E e PEROLA-I, os quais criam as medições e utilizam a biblioteca para armazená-las.
Além de utilizar este protocolo próprio, o software desenvolvido também é capaz de importar nuvens de pontos cilíndricas armazenadas no formato “COP”, utilizado por outros sistemas de medição de perfil geométrico do LABMETRO-UFSC.
5.4	PROJETO E DESENVOLVIMENTO DO SOFTWARE
Esta seção apresenta, primeiramente, as decisões de projeto de software tomadas para possibilitar os casos de uso definidos para o
sistema de realidade virtual. Em seguida é mostrado o desenvolvimento alcançado do software, com suas características agrupadas de acordo com o aspecto funcional do qual fazem parte.
5.4.1 Arquitetura
As modelagens estrutural e dinâmica realizadas para o SRV são apresentadas aqui através de diagramas de classe e de atividade, respectivamente. Os diagramas apresentados foram simplificados de forma a ressaltar nuances de interesse.
No diagrama da figura 51 são apresentadas classes relacionadas à visualização.
Figura 51 - Diagrama de classes simplificado de parte do SRV. Esta representação tem o objetivo de dar foco às funcionalidades gráficas e de análise geométrica do sistema.
Fonte: Autor.
Para a apresentação de saída gráfica OpenGL é necessária uma ligação entre a API e a biblioteca gráfica do sistema operacional. Isto é realizado através da classe GLControl, a qual representa uma área de exibição na tela capaz de responder a comandos OpenGL. A relação desta área de exibição com as chamadas da API é dada através do ponteiro RenderingContext. Esta classe também é responsável pela ativação da saída estereoscópica, quando aplicável.
Foram dimensionadas estas áreas de exibição para a janela principal do programa e para janelas de exibição exclusiva de saída OpenGL em tela cheia. Por ser o HMD um segundo monitor, é necessária a utilização, para este último, de uma área de renderização própria, no caso uma instância da classe FullScreenWindow. A mesma
classe pode oferecer a visualização estereoscópica no monitor principal, caso haja suporte do hardware utilizado, ou simplesmente permitir a visão em tela cheia, mesmo que sem a percepção de profundidade.
A classe responsável pelo encadeamento de chamadas OpenGL é a Drawer. Sua única instância deve ter acesso a cada um dos RenderingContexts disponíveis. Esta classe define o volume delimitador da visualização dentro do espaço cartesiano utilizado pela API gráfica. Este espaço é calculado com base no ponto de vista do usuário que “navega” pelo ambiente, representado pela classe User. Os objetos17 a serem desenhados no ambiente virtual são implementações de DrawableObject, classe abstrata modelada para simplificar a inclusão de novos objetos virtuais na estrutura do sistema. Os atributos de cada instância ativa são levados em conta para a priorização de desenho.
O principal objeto virtual desenhável é a representação da geometria da região de tubo inspecionada, representada pela classe Pipe. Os dados de representação geométrica, extraídos de um objeto XCP aberto, são divididos em várias instâncias de Slice a fim de aliviar a carga computacional, conforme será explicado adiante. Os atributos da classe Pipe dizem respeito à forma como a reconstrução virtual do tubo é visualizada, incluindo os planos de corte aplicados, o mapa de cores utilizado e o fator de escala radial.
Por último em relação ao diagrama da figura 51, o controle de visualização planificada da nuvem de pontos tem acesso à classe Pipe para manter coerentes, entre as vistas 2D e 3D, os parâmetros de visualização aplicados. A classe responsável pelos cálculos de características geométricas, Analyzer, tem para si a definição de regiões de interesse definidas pelo usuário. O acesso aos dados geométricos é feito diretamente da medição apresentada, pois a análise dos dados independe da forma como são mostrados.
O diagrama da figura 52 apresenta o modelo de tratamento de dispositivos de entrada adotado.
17 Objeto, neste caso, refere-se a uma representação gráfica de uma entidade. Não deve ser confundido com uma instância de classe do jargão do paradigma de orientação a objetos.
Figura 52 - Diagrama de classes do pacote de dispositivos de entrada e sua interação com o resto do sistema.
Fonte: Autor.
Similarmente à estratégia adotada no caso de objetos virtuais, os dispositivos de entrada são tratados de forma única, através da interface IlnputDevíce. Isto facilita a inserção de novos métodos de entrada. A classe OperatíonProvíder expõe os métodos acessíveis pelos comandos de entrada de usuário, os quais representam operações no sistema, como navegação ou troca de fator de escala radial, por exemplo. Usando polimorfismo e retrochamadas, a classe InputHandler define quais métodos são vinculados a determinados comandos dos dispositivos utilizados.
Para possibilitar a operação fluida e consistente do software, o mesmo foi projetado para se comportar dinamicamente conforme diagrama de atividades da figura 53.
Figura 53 - Diagrama de atividades simplificado do comportamento dinâmico do SRV.
Fonte: Autor.
Após o carregamento inicial do programa e seus módulos, o SRV, além de responder aos eventos de interface gráfica típicos de programas Desktop, mantém um laço de execução constante. Neste laço são verificados comandos de entrada, aplicados os comandos correspondentes e renderizada a cena, nesta ordem. A operação de desenho da cena é bloqueante, fazendo com que o os eventos de interface gráfica sejam apenas tratados ao final de cada uma das suas execuções.
Ao se aplicar algum comando ao sistema, portanto, valores do estado interno de seus componentes são alterados sem resposta visual
imediata. A ação de desenho da cena, ocorrida em seguida, simplesmente desenha todos os elementos baseado no seu estado corrente. Antes disto, porém, é verificada a existência de operações computacionalmente dispendiosas comandadas pelo usuário. Estas ações devem ser divididas pelo programa em trechos pouco dispendiosos. Desta forma, intercalando-os com as atividades de leitura de entrada e desenho da cena, é evitado o bloqueio do programa.
Entre as atividades dispendiosas encontram-se, basicamente, o desenho e redesenho da nuvem de pontos cilíndrica. Os objetos da classe Slice que compõem a geometria desenhada da nuvem de pontos são criados um por um da forma citada. Ao se mudar os parâmetros de representação, como escala radial ou o mapa de cores, cada uma delas é marcada para redesenho.
5.4.2	Funcionalidades de visualização
A interface principal do software possui um menu de comandos, uma área de informações da medição aberta, um controle de visualização planificada e análise geométrica e uma área de desenho OpenGL, onde é exibido um ambiente virtual. Alternativamente, o sistema pode ser utilizado em tela cheia, somente com a área de renderização da API gráfica.
A nuvem de pontos representante da geometria mensurada pelo perfilômetro vem na forma cilíndrica, ou seja, cada ponto possui valores de raio (R), ângulo (0) e posição longitudinal (Z). Para que sejam passados para a API gráfica, estes pontos são convertidos para coordenadas cartesianas (X, Y e Z).
Cada conjunto de três pontos próximos é utilizado para definir um triângulo. Desta forma toda a nuvem de pontos é desenhada no ambiente virtual, através de malhas de triângulos definidos entre os pontos adquiridos, formando um sólido virtual. A cada ponto da malha, ou vértice, se associa uma posição no espaço cartesiano, uma cor e um vetor normal. A cor é obtida em função do valor de raio correspondente de cada vértice na escala de cores utilizada. O vetor normal de um vértice é definido com base nos outros vértices dos triângulos dos quais faz parte. Sua importância se dá na aplicação de recursos de iluminação e sombreamento.
Resumindo a sequência de etapas do desenho da nuvem de pontos:
• Os pontos representantes da geometria do tubo a ser desenhado são obtidos a partir do arquivo XCP aberto;
•	Cada ponto, em coordenadas cilíndricas, é transformado para coordenadas cartesianas;
•	A cada ponto se associa um valor de cor;
•	Cria-se uma malha de triângulos em toda a região, sendo cada triângulo entre três pontos vizinhos da malha, em sequência;
•	A cada ponto (ou vértice de um triângulo) se associa um valor de normal, calculado com base nos vetores formados entre o ponto de interesse e dois pontos vizinhos em sequência.
A figura 54 é uma possível saída da visão 3D do sistema de realidade virtual. Nela se apresenta uma região de tubo reconstruída, vista externamente, com a aplicação de iluminação, mapa de cores e objetos virtuais de auxílio à leitura e navegação. Os objetos virtuais são uma régua, um sistema de coordenadas e um anel que delimita o máximo valor de raio visualizado, de acordo com a escala de cores exibida. Pode-se notar, em relação à reconstrução geométrica, a aparente “rugosidade” da região apresentada, possível pelo uso de normais e fontes de luz em OpenGL.
A mesma região é vista na sua representação planificada na figura 55, notadamente com detalhes geométricos menos evidenciados. As falhas de leitura de pontos representadas por buracos na representação tridimensional são representadas como pixels transparentes na visão planificada. O software oferece a possibilidade de limitar a região visualizada em termos de faixas de valores axiais e angulares, o que pode ser feito simultaneamente para a visão planificada e tridimensional. O mapa de cores também é compartilhado, mesmo que seja personalizado pelo usuário.

Figura 54 - Uma possível tela de saída do SRV, apresentando a reconstrução tridimensional de uma região geométrica inspecionada e objetos virtuais de leitura. A visualização apresentada é do poto de vista externo, porém de uma geometria interna. Os valores sem unidade estão em milímetros.
W X
84,94
87,53
’80,13
77,72
jfe.
Realce de seccao
A: 90,00 Graus
Z: 1044,6 mm
R: 82,65 mm
Fonte: Autor.
Figura 55 - Visão planificada, gerada pelo SRV, da região apresentada na figura 54. Este tipo de visualização é similar ao encontrado em outros métodos de inspeção. No software apresentado, esta visão pode ser utilizada simultaneamente à tridimensional.
Fonte: Autor.
A fim de evidenciar as funcionalidades desenvolvidas de iluminação, escala radial e mapa de cores, a figura 56 a seguir apresenta uma mesma região reconstruída com diferentes parâmetros de visualização. Primeiramente, é mostrada uma cena com fator de escala unitário, com a aplicação da escala de cores padrão e determinados parâmetros de iluminação. Em cada uma das outras imagens apresentadas na mesma figura, foi trocada apenas uma destas características, mantendo, porém o mesmo ponto de vista. As escalas de cores utilizadas na figura 56 estão na figura 57.
Figura 56 - Comparação visual entre imagens obtidas com diferentes parâmetros de visualização tridimensional para uma mesma cena. A partir de uma cena original se alterou somente um parâmetro: (a) cena original, (b) escala radial dobrada, (c) parâmetros de iluminação alterados e (d) escala de cores alterada.
Fonte: Autor.
Figura 57 - Escalas de cores utilizadas na figura 56. À esquerda, a escala utilizada nas partes (a), (b) e (c) da figura 56. À direita, a escala utilizada na parte (d) da figura 56. Os valores estão em milímetros.
Fonte: Autor.
Entre a parte (a) e a parte (b), pode-se notar a mudança de escala radial, a qual pode evidenciar melhor os defeitos medidos. Na parte (b), a escala radial é o dobro da escala da parte (a). Entre a parte (a) e a parte (c), pode-se notar uma mudança de parâmetros de iluminação. A luz ambiente foi reduzida e a luz difusa foi incrementada. Entre a parte (a) e a parte (d), pode-se notar uma mudança na escala de cores. Estas comparações visuais servem para evidenciar as funcionalidades citadas. A sinergia entre estas funcionalidades possibilita a análise qualitativa da nuvem de pontos por parte do usuário.
5.4.3	Imersão e interatividade
A navegação no ambiente virtual do sistema, como já citado, é feita no ponto de vista de primeira pessoa, de modo a causar a imersão do usuário na cena, principalmente quando se utiliza o hardware de RV
dimensionado. Relacionada à imersão está também a possibilidade do usuário virtualmente “colidir” com as paredes do tubo durante a navegação, ou seja, ser incapaz de atravessá-las. Esta funcionalidade, além de vir ao encontro da filosofia de RV implantada, pode servir para manter a orientação do usuário.
Assim como a opção de colisão, os objetos de leitura apresentados na figura 54 podem ser ativados ou desativados. No caso dos objetos virtuais, podem ser posicionados no ambiente ao gosto do usuário. Além daqueles já apresentados, há ainda um apontador para leitura de valores individuais de raio, apresentado na figura 58, a qual é uma vista interna de uma região mensurada. Similarmente ao apontador, na visão planificada é possível a leitura dos valores individuais apontando-se para a posição desejada com o mouse.
Figura 58 - Vista interna de uma região de tubo. Nesta ocasião, o usuário utiliza um apontador virtual para a leitura do valor individual de raio de um ponto. Há ainda a presença de uma anotação.______________________________________________
Angulo: 66,76 graus
Posicao: 1244,1 mm
Vinco artificial do gabarito
Realce de seccao
A: 109,25 Graus \ Z: 1155,2 mm
R: 80,94 mm
.. - - -■
Fonte: Autor.
O anel da figura indica o menor valor de raio abrangido pela escala de cores, analogamente ao anel externo visto na figura 54. Estes anéis podem ser ajustados dinamicamente para auxílio do ajuste da
escala, indicando visualmente onde se encontram os limites radias da visualização corrente.
No topo da figura 58 pode ser vista uma anotação feita por um usuário. Estas anotações são salvas juntamente à nuvem de pontos para que outros usuários possam conferi-las. De modo a avisar um usuário da presença de anotações, o ambiente virtual dispõe de “postes” nos locais onde elas foram inseridas. Para realizar a leitura de uma anotação, basta o usuário navegar até a região correspondente ou, simplesmente, utilizar o comando de “navegar até a próxima anotação” disponível.
Para causar sensação visual de profundidade, quando se deseja utilizar a visualização estereoscópica, as cenas devem ser renderizadas de dois pontos de vista levemente diferentes. Cada ponto é correspondente a um dos olhos do usuário. Além da separação dos pontos de vista, é necessária a readaptação dos volumes de projeção. O tipo de volume de projeção utilizado na geração de imagens estereoscópicas é assimétrico, de modo a fazer coincidir o plano de projeção na tela para as duas visualizações, conforme figura 59. Esta estratégia foi escolhida com o objetivo de causar maior conforto visual18. O parâmetro ajustável pelo usuário para a visão estereoscópica é a separação ocular. Dado um valor de separação, o software calcula as projeções assimétricas de modo a coincidir o plano da tela para ambas. Quanto maior ela for, mais intensa será a sensação de profundidade experimentada na visualização. Um valor de separação demasiado alto, no entanto, pode causar desconforto visual.
18 Esta impressão pode variar de usuário para usuário.
Figura 59 - Esquema de volumes de projeção assimétricos utilizado na geraçào
A figura 60 é um exemplo de par estereoscópico gerado pelo software.
Fonte: Autor.
5.4.4	Análise geométrica
O sistema de realidade virtual desenvolvido fornece algumas funcionalidades que permitem ao seu usuário analisar quantitativamente a nuvem de pontos mensurada por um dos perfilômetros do projeto PEROLA, além da análise qualitativa permitida pelas funcionalidades de visualização.
No controle gráfico de visualização planificada, o usuário pode definir regiões de interesse através de retângulos, fornecendo para isto
dois pontos. As regiões de interesse são definidas, portanto, como uma faixa de valores axiais e angulares, de forma idêntica à limitação de visualização planificada e tridimensional. A figura 61 apresenta uma parte desta interface.
Figura 61 - Uma parte da interface de visualização planificada e análise, onde se pode ver uma lista de regiões definidas, valores de leitura para a região selecionada e uma área de visualização planificada desta região. Neste caso, é vista uma região com defeitos evidenciados em vermelho.
Fonte: Autor.
Para cada região definida, um algoritmo calcula a sua área danificada, o volume de material removido e/ou depositado e a espessura mínima encontrada naquela região. A confiabilidade destes cálculos depende da alimentação, por parte do usuário, dos valores de raio interno (sem defeitos) do tubo mensurado, do seu raio externo e do limiar a partir do que se considera uma diferença de valores de raio como um defeito.
O software é capaz de sugerir o valor de raio nominal da medição, verificando a faixa de valores que representa a moda da amostra. No entanto, esta estratégia pode gerar resultados equivocados, caso a área danificada do tubo medido seja muito alta, ou o tipo de dano apresentado acarretar em alteração geométrica de valor quase constante. De toda forma, os valores são calculados com base nos valores de entrada apresentados na interface do programa.
No caso do raio externo (ou espessura da parede do tubo), por serem o PEROLA-I e PEROLA-E métodos de medição óptica, não é possível que este valor seja medido ou inferido de alguma forma, ficando exclusivamente a cargo do usuário, quem deve possuir dados adicionais confiáveis.
Para a definição do limiar de defeito, o software dispõe de um auxílio visual para o usuário. À medida que os valores de raio nominal e limiar de defeito são alterados pelo usuário, uma visão planificada secundária da medição, similar àquela apresentada na figura 55, é atualizada. Nesta visão alternativa, é mostrada em azul a área considerada, baseados nos valores alimentados, como sendo de defeito por acúmulo de material; em vermelho, a área considerada defeituosa por perda de material; em cinza, a área considerada como “sadia” e, em branco, a área cuja geometria não pode ser medida. Isto funciona tanto para a vista geral/limitada da medição quanto para a vista de região selecionada, como na figura 61, onde são apresentados alguns defeitos para uma região definida pelo usuário. Esta região é uma parte da geometria apresentada na figura 55.
Desta forma, o usuário pode inspecionar visualmente uma região, chegar à conclusão de que ali há um defeito e posteriormente delimitar a região de interesse para os cálculos, já sabendo de antemão o formato aproximado do defeito. A fluida resposta visual às variações de parâmetros definidos pelo usuário auxilia nesta tarefa de identificação manual de defeitos.
O algoritmo de cálculo de volume removido e depositado funciona como um “interpolador de ordem zero”, fornecendo um resultado aproximado, ao considerar a contribuição volumétrica da região em torno de cada ponto baseada somente no valor daquele ponto, sem levar em conta a relação com os pontos vizinhos.
A contribuição volumétrica V de cada ponto é dada pela seguinte equação:
V = AZ x 6 x
(2)
2
Onde:
21 Z = Distância da secção atual à próxima secção;
0 = Ângulo compreendido pelo ponto em questão;
R = Raio do ponto em questão;
Rm = Raio padrão (sem defeitos) da região considerada.
A contribuição de cada ponto só é levada em conta se a diferença entre o seu valor de raio R e o raio padrão Rm for maior que o limiar de defeito passado como entrada pelo usuário. Caso a diferença entre R e Rm seja negativa, a contribuição do ponto referido é tida como acúmulo de material.
5.5	CONCLUSÃO
O sistema de realidade virtual desenvolvido atende os requisitos estabelecidos, tanto pelo PEROLA-I como aqueles definidos localmente com o objetivo de fornecer uma forma inovadora de leitura de perfil geométrico.
Mesmo com características inovadoras, o SRV também oferece métodos consagrados de leitura do perfil geométrico, tentando explorar a complementação entre ambos para tornar-se uma poderosa ferramenta de análise geométrica.
A arquitetura do sistema foi concebida de forma que este possa sofrer expansão ou melhora sem alterações estruturais importantes.
6	RESULTADOS E AVALIAÇÃO DAS FERRAMENTAS DESENVOLVIDAS
Com o desenvolvimento do sistema de aquisição e disponibilização de imagens apresentado no capítulo 5, juntamente com a sua integração aos outros módulos constituintes do PEROLA-I, foi possível a construção de um protótipo de perfilômetro capaz de adquirir a geometria interna de tubos utilizando a tecnologia do sensor óptico por triangulação cônica a laser.
A implementação do padrão de armazenamento de nuvens de pontos cilíndricas permitiu o uso do sistema de realidade virtual apresentado no capítulo 6 para a visualização e análise de perfis geométricos obtidos pelo protótipo do PEROLA-I.
Para a validação destas ferramentas, primeiramente foram realizados testes em bancada do módulo de monitoração de deslocamentos, a fim de calibrar o seu hodômetro e avaliar o seu comportamento na aquisição e etiquetagem de imagens.
Não houve necessidade de calibração do inclinômetro por dois motivos. O primeiro é que o deslocamento angular a ser sofrido pelo perfilômetro é considerado como uma perturbação, não um deslocamento padrão do sistema. A velocidade angular à qual o perfilômetro está sujeito é muito baixa em comparação com a velocidade de deslocamento axial. O segundo motivo é que o hodômetro utilizado já dispunha de folas de calibração e testes dinâmicos do próprio fabricante.
Para a avaliação do desempenho das ferramentas desenvolvidas neste trabalho frente à operação completa do protótipo do PEROLA-I, primeiramente realizaram-se testes de inspeção em bancada para, posteriormente, o protótipo ser levado a campo para a inspeção de tubos metálicos utilizados na indústria petroquímica e que apresentavam danos na sua estrutura. Os resultados destas avaliações são apresentados nas seções a seguir.
6.1	AVALIAÇÃO DO SISTEMA DE AQUISIÇÃO E DISPONIBILIZAÇÃO DE IMAGENS
Para as avaliações deste sistema foi feita uma montagem do módulo embarcado de monitoração juntamente com a câmera do sensor, dispostos na estrutura mecânica do perfilômetro correspondente a estes componentes. Esta estrutura mecânica foi posicionada sobre uma régua metálica com o auxílio de suportes, conforme ilustra a figura 62. Os
testes foram realizados com a câmera ligada a um computador executando o módulo de gerenciamento da câmera. Desta forma foi possível efetuar a medição de deslocamento juntamente às atividades de aquisição de imagem e etiquetagem. Em todos os testes neste item, o microcontrolador foi configurado para trabalhar sob a frequência de 4 MHz, o que produz 1 MIPS.
Figura 62 - Montagem feita durante a calibração do hodómetro.
Fonte: LABMETRO-UFSC.
A primeira avaliação teve como objetivo a calibração do hodómetro. Para isto, o conjunto foi submetido a deslocamentos por trajetos limitados por elementos de fim de curso, posicionados observando-se a escala milimétrica da régua, cujo valor da divisão é de 1,0 mm. O erro de leitura combinado para os elementos posicionados no início e fim de curso foi estimado como sendo da ordem de ±1,0 mm. O valor apontado pela régua foi utilizado como padrão de calibração para o hodómetro, motivo pelo qual seu valor apontado é aqui considerado como sendo verdadeiro.
Nesta avaliação foram considerados apenas os deslocamentos realizados e o número obtido de pulsos do encoder do hodómetro. A tabela 6 expõe
as distâncias percorridas em cada iteração, assim como o número de pulsos lidos. A média da relação obtida de pulsos por milímetro foi de 10,2770, conforme dados da
tabela 7.
Após a calibração do hodómetro, aplicou-se esta relação no código do módulo embarcado, conforme previsto no item 4.2.2.I. Com esta configuração de pulsos por milímetro e com a leitura do hodómetro como parte do laço principal de execução do código do módulo de monitoração, foram realizados testes para verificar o erro na medição de deslocamento efetuada pelo SE em diferentes distâncias e dentro da velocidade especificada de operação. Os valores obtidos estão na tabela 8, onde se pode notar que o erro máximo dentro da velocidade de medição especificada para o PEROLA-I (50 mm/s) foi de 0,2%. A resolução axial para aquisição de imagens definida foi de 1 mm.
Tabela 6 - Obtenção de pulsos por deslocamento conhecido para calibração do hodómetro (realizada com velocidade menor do que 20 mm/s).
Pulsos	Deslocamento [mm]	Relação [pulsos/mm]
6166	600,0 ± 1,0	10,277
6167	600,0 ± 1,0	10,278
6169	600,0 ± 1,0	10,282
6166	600,0 ± 1,0	10,277
6163	600,0 ± 1,0	10,272
Fonte: Autor.
Tabela 7 - Resultado da calibração do hodómetro.
Item	Pulsos/mm
Média	10,27700
Desvio Padrão	0,00361
Fonte: Autor.
Tabela 8 - Medição de outras distâncias com a relação obtida na calibração.
Pulsos	Deslocamento [mm]	Relação [pulsos/ mm]	Velocidade [mm/s]	Deslocamento calculado [mm]	Erro [mm]	Erro %
4115	400,0	10,288	40	400,4	0,4	0,10
4115	400,0	10,288	50	400,4	0,4	0,10
5148	500,0	10,296	50	500,9	0,9	0,18
10275	1.000,0	10,275	50	999,8	-0,2	-0,02
Fonte: Autor.
Também foram realizados testes similares sob velocidades acima dos limites de operação prevista do perfilômetro. Seus resultados estão na tabela 9, cujas linhas estão ordenadas pelos valores de velocidade de cada teste.
Tabela 9 - Testes de medição de deslocamento a diferentes velocidades.
Pulsos	Desloca -mento [mm]	Relação [pulsos/ mm]	Velocidade [mm/s]	Deslocamento calculado [mm]	Erro [mm]	Erro %
6166	600	10,277	60	600	0	0
4117	400	10,293	80	400,6	0,6	0,15
5152	500	10,304	83,3	501,3	1,3	0,26
6167	600	10,278	86	600,1	0,1	0,01
10282	1.000	10,282	100	1000,5	0,5	0,05
6169	600	10,282	150	600,3	0,3	0,05
5151	500	10,302	166,7	501,2	1,2	0,24
10279	1.000	10,279	166,7	1000,2	0,2	0,02
6126	600	10,21	171	596,1	-3,9	-0,66
6126	600	10,21	171	596,1	-3,9	-0,66
5548	600	9,247	200	539,8	-60,2	-11,14
6015	600	10,025	200	585,3	-14,7	-2,51
Fonte: Autor.
Notam-se na tabela 9 valores de erro percentual fora dos limites de 0,2% para algumas entradas. Conforme estudo de carga apresentado no item 4.2.3, o maior erro nestes casos está associado à sobrecarga no microcontrolador, o que pode ser percebido ao se atentar aos valores de pulsos obtidos nas entradas de maior erro. A possível ocorrência de microvariações de velocidade sofridas pelo dispositivo causa sobrecarga em frações de segundo, levando a falhas de leitura. Isto evidencia a
necessidade de aumento da capacidade de processamento do microcontrolador utilizado e/ou a priorização da leitura de deslocamento através do mecanismo de interrupção, conforme alternativa de projeto colocada. Mesmo que a velocidade nominal de inspeção seja algum valor da ordem de grandeza de dezenas ou poucas centenas de milímetros por segundo, o módulo de monitoração deve estar pronto para medir velocidades instantâneas substancialmente maiores.
Por fim, para a avaliação da operação geral deste sistema, foram realizados testes com o objetivo de se verificar falhas na entrega das imagens. Estes testes foram realizados com o uso da leitura do hodómetro priorizada pelo mecanismo de interrupção. Diferentes valores de resolução axial foram utilizados. Alguns resultados obtidos estão na tabela 10.
Tabela 10 - Testes de aquisição de imagens a diferentes velocidades e
resoluções.
Res. axial [mm]	Deslocamento [mm]	Velocidade [mm/s]		Secções		
		Nominal	Segura	Adqui -ridas	Perdidas	Perdidas (%)
1	1680,5	20	30,3	1686	0	0
1	1668,6	30	37,3	1674	0	0
1	1687,5	30	34,4	1691	2	0,1
1	1667,6	40	44,4	1669	4	0,2
1	1691,5	40	44	1692	5	0,3
1	1626,6	45	47,7	1623	9	0,6
1	1675,6	50	51,5	1559	122	7,3
1	1679,6	50	51,2	1591	94	5,6
2	1679,6	40	51,5	843	0	0
2	1638,7	90	94,9	822	1	0,1
5	1663,1	100	104,1	333	0	0
5	1617,8	150	158,6	324	0	0
10	1643,6	150	165,7	165	0	0
Fonte: Autor.
As velocidades seguras 19 maiores do que as nominais corroboram a tese de que as falhas de medição ocorrem por conta de
19 Velocidade segura aqui representa o maior valor medido de velocidade instantânea em que não há falhas de aquisição em uma entrada da tabela. Quando não há falhas, a máxima velocidade atingida durante aquele teste é considerada como sendo a velocidade máxima segura. Quando há falhas,
microvariações de velocidade. As maiores taxas de perdas de imagens, ou de aquisição de secções, ocorrem ao se aproximar da taxa de aquisição de 50 imagens por segundo (divisão do valor da coluna “velocidade nominal” pelo valor da coluna “res. axial”). Em valores um pouco abaixo disto, as perdas mantêm-se em valores baixos e aceitáveis. Isso pode ser causado por um possível atraso na execução da tarefa de aquisição do microcontrolador, dada a preempção da leitura do hodómetro utilizada nestes testes. Apesar da degradação da resposta ser relativamente baixa, nota-se a necessidade de ajuste na disponibilização de imagens, o que pode passar por otimização do código embarcado, aumento da velocidade do processador ou mudança na estratégia de escalonamento de tarefas. Esta conclusão de necessidade de melhoria vai ao encontro daquela concluída analisando-se o teste anterior.
6.2	INSPEÇÃO EM BANCADA
Para a avaliação em laboratório do desempenho das ferramentas desenvolvidas na operação completa do perfilómetro, foram realizados ensaios de inspeção em bancada, a qual foi projetada com o objetivo de representar as condições de operação às quais o PEROLA-I foi projetado para atender.
A bancada utilizada possui um tubo de diâmetro nominal de 152 mm (6”) e comprimento de 2,6 m e permanece em posição horizontal. O tubo foi projetado com o objetivo de representar tubos de fornos de refinaria fortemente expostos à corrosão interna e com deformidades geométricas residuais do processo de soldagem. Acoplado ao suporte onde repousa o tubo há um motor elétrico, utilizado para deslocar o perfilómetro de forma controlada através de um cabo de aço preso às suas extremidades. Na figura 63 pode ser vista uma montagem do protótipo do perfilómetro. O esquemático da bancada pode ser visto na figura 64.
significa que as mesmas ocorreram após o sistema superar a velocidade apontada como sendo segura.
Figura 63 - Um dos protótipos do PEROLA-I com o laser ligado.
Fonte: LABMETRO-UFSC.
Figura 64 - Esquemático da bancada de testes do PEROLA-I. Tampa de acrílico transparente
T,	, Tampa metalica de
Perfilômetro , ~	.
defeitos artificiais
elétrico
Fonte: LABMETRO-UFSC.
O tubo conta com uma tampa removível, onde foram usinados artefatos simulando defeitos de geometria simples e conhecida, de modo a avaliar o desempenho do perfilômetro antes de utilizá-lo numa situação com corrosão real. Há também uma tampa de acrílico utilizada para a visualização do perfilômetro no interior do tubo. Próximo de uma das extremidades há uma junta soldada com excesso de deposição de material. A figura 65 mostra a face interna da tampa removível. Podem-se perceber pela figura alvéolos circulares e vincos, além de um rebaixo incremental na forma de escada.
Figura 65 - Vista interna da tampa com defeitos artificialmente produzidos.
Rebaixo
Alvéolos
Vincos
Fonte: Autor.
incremental
Foram realizadas inspeções do perfil geométrico do tubo da bancada utilizando o protótipo do PEROLA-I. As imagens apresentadas no item 5.4 representam a reconstrução, pelo software de visualização, da geometria adquirida desta tampa e devem servir de comparação visual. Já a figura 66 usa um mapa de cores personalizado escolhido para causar maior sensação de realismo. Deve-se ressaltar que algumas das imagens citadas, como a figura 56, representam vistas externas da geometria interna adquirida. Tanto a figura 66 abaixo quanto a figura 58, no item 5.4.3, mostram a região vista internamente.
Figura 66 - A reconstrução, feita pelo SRV, da geometria interna adquirida da região da tampa com defeitos artificialmente produzidos.
Fonte: Autor.
Na figura 67 pode-se ver a junta soldada próxima à extremidade do tubo da bancada e, na figura 68, a sua representação pelo software de visualização, com o ponto de vista invertido (olhando para fora). Notase facilmente a correspondência geométrica entre a região mensurada e sua representação. Neste caso, novamente, o usuário personalizou o mapa de cores com objetivo de criar uma impressão mais realista da cena.
Figura 67 - Vista interna do tubo da bancada, com destaque ao cordão de solda e à tampa d	” 1	‘	‘	1 p ido.
Cordão de solda
Tampa de acrílico
Fonte: LABMETRO-UFSC.
Figura 68 - Vista reconstruída pelo SRV do cordão de solda e da tampa de acrílico inspecionados pelo perfilômetro. O ponto de vista desta cena é oposto ao da fotografia da figura 67.
Fonte: Autor.
Analisando o detalhe do rebaixo incremental, pode-se perceber melhor o nível de detalhes atingido. Na figura 68, retirada da especificação técnica do tubo da bancada, o valor nominal do incremento a cada degrau do rebaixo é de 0,5 mm. A figura 70 mostra a geometria interna do rebaixo adquirida pelo perfilômetro, com escala radial ampliada em quatro vezes e mapa de cores com amplitude normalizada para a região em foco. Pelo mapa de cores aplicado, exibido na figura 70, é possível notar que a diferença de raio a cada dois degraus é próxima de 1 mm, condizente com a especificação técnica. Assim é possível notar a capacidade do sistema em exibir a geometria adquirida pelo perfilômetro com alto grau de detalhes e de forma confiável.
Complementando a visão tridimensional da região, a visão planificada oferece a saída exibida na figura 71, na qual pode ser vista também a região considerada como danificada a partir dos valores de entrada colocados.
Figura 69 - Parte da geometria da tampa removível correspondente ao rebaixo com degraus.
Fonte: Autor.
Figura 70 - Representação da geometria do rebaixo vista pelo software de visualização.
Fonte: Autor.
Figura 71 - Recortes da vista planificada da região do rebaixo incremental.
		Limiar de defeito 11.00	mm	legiões
	80.24	Ra io interno	176 30 “H	mm	222-294:544-610
				230-240:553-593
		Raio externo	184.50	mm	
|6: 238,25°, Z = 533,52mm, R = 77,31mm|	■ 7: -7			
	1	Adiciona região |	Remove |		
		Med. completa	Recalcula		
	■ 78,69			
		Vol. depositado |0,00	mm2	
1 564.5	1 77.92	Vol. perdido	|-310,93	mm3	
		Esp. minima	¡42	mm	
237 -557
-593
Fonte: Autor.
6.3	INSPEÇÃO EM CAMPO
O protótipo do PEROLA-I, após sua validação em laboratório, pode ser levado a campo para realização de ensaios em tubos metálicos de diâmetro interno nominal de 152 mm (6”). Estes tubos inspecionados foram fortemente danificados por corrosão interna durante operação na exploração de gás.
Para a realização das inspeções, o protótipo foi puxado pelo mesmo sistema de tração da bancada da figura 64.
A figura 72 mostra internamente uma região de saída de um trecho de tubulação curvo. Uma visão do seu resultado de inspeção na figura 73 revela detalhes geométricos pouco perceptíveis a olho nu, ainda apresentando alto grau de realismo. A região de tubo da figura 74 está presente num trecho curvo similar àquele da figura 72, porém no lado de entrada. A representação deste trecho inspecionado pelo perfilômetro é apresentada na figura 75.
A curva presente nestes trechos de tubulação faz com que o perfil de escoamento do fluido transportado se torne turbulento, acelerando o processo corrosivo. A inspeção destes trechos com o PEROLA-I permitiu a melhor visualização deste fenômeno pelo corpo técnico do CeNPES-PETROBRAS, local onde foram disponibilizados os tubos e realizadas as inspeções nos mesmos.
Figura 72 - Vista interna de um trecho de tubulação de exploração de gás fortemente exposto à corrosão
Fonte: CENPES-PETROBRAS.
		
		
’’ei* ’	■»*		
1	A 'íâ ' . -■* '&amp;lt;	¥ :*■ - ¿0 -jèT	' .-41	
Figura 73 - Resultado de medição de trecho de tubulação de gás da figura 72,
inspecionada pelo PEROLA-I e visualizada pelo seu SRV.
Fonte: Autor.
Figura 74 - Trecho de tubulação de exploração de gás severamente danificado, apresentando inclusive uma fenda.
Fonte: CENPES-PETROBRAS.
Figura 75 - Reconstrução da geometria correspondente à região da figura 74.
Fonte: Autor.
144
7	CONSIDERAÇÕES FINAIS
Este trabalho contribuiu com o desenvolvimento de uma solução de perfilometria para o interior de tubos baseada no sensor óptico a laser desenvolvido em (Buschinelli, 2007)
Os elementos de hardware e software desenvolvidos foram capazes de aplicar com sucesso o sensor na inspeção da geometria interna de trechos retos de tubos metálicos sujeitos a avarias, aplicação para a qual o sistema foi concebido. A geometria adquirida pode ser facilmente lida, visualizada e interpretada, com alto grau de realismo, através do sistema de realidade virtual desenvolvido.
A seguir são ressaltados alguns pontos positivos do trabalho desenvolvido. Posteriormente, cita-se o que já está sendo realizado para dar continuidade ao desenvolvimento da solução de perfilometria. Em seguida são apresentadas sugestões para a melhoria do trabalho desenvolvido.
7.1	ASPECTOS POSITIVOS DO SISTEMA DESENVOLVIDO
O sistema de aquisição e disponibilização de imagens desenvolvido trouxe uma série de contribuições que são analisadas na sequência:
•	A lógica do software embarcado permite que o perfilômetro seja deslocado no sentido inverso de operação padrão sem acionar o sensor. O perfilômetro deve retornar à posição de inversão de movimento para voltar a realizar a aquisição do perfil. Isto faz com que, mesmo sob eventuais inversões de sentido do movimento, a mesma região não seja adquirida duas vezes numa mesma aplicação do perfilômetro;
•	O erro de quantização intrínseco aos transdutores digitais, no caso encoders ópticos, é mitigado por um algoritmo no microcontrolador. Isto reduz a discrepância que haveria entre o valor percorrido pelo perfilômetro e o número correspondente de secções adquiridas;
•	O sistema desenvolvido apresenta boa modularidade, permitindo, por exemplo, a troca de modelos de encoders utilizados para a medição de deslocamento axial e angular. Para isto deve-se apenas alterar parâmetros no código do sistema embarcado;
•	Os valores de etiquetagem adquiridos pelo SE são tratados somente no PC, aliviando a carga no microcontrolador;
•	Tanto o sistema embarcado quanto a biblioteca de gerenciamento da câmera foram feitos de forma a suportar vários modelos de câmeras disponíveis no mercado, o que permitirá o uso de modelos com melhor resolução e taxa de aquisição no futuro;
•	A biblioteca de gerenciamento da câmera suporta o alto desempenho do módulo de processamento de imagens e oferece visualização ao vivo da imagem capturada.
Quanto ao sistema de realidade virtual para visualização e análise de medições, cabe evidenciar:
•	O nível de detalhes proporcionado pelo conjunto perfilômetro e sistema de visualização é muito mais elevado do que o fornecido pelos métodos tradicionais de inspeção. Por exemplo, em relação ao pig palito apresentado no item 2.1.1, o PEROLA-I adquire um volume de dados mais de 50 vezes maior;
•	Os meios de visualização e navegação oferecidos, baseados em técnicas de realidade virtual, são intuitivos e poderosos. Isto possibilita o uso do raciocínio visual do analista e segue a tendência do uso de RV na indústria de petróleo e gás;
•	Diferentes métodos de visualização estereoscópica podem ser utilizados. São exemplos os monitores do tipo head-mounted display e monitores de alta frequência em conjunto com óculos ativos de cristal líquido.
•	O uso de diferentes dispositivos de entrada é suportado, em muitos casos não exigindo alterações ou novas configurações no SRV. São exemplos os diferentes tipos de gamepads, mouses 3D e smartphones.
•	Ao mesmo tempo em que inova, o sistema desenvolvido mantém semelhança com métodos disseminados na indústria, de forma a diminuir o esforço de aprendizagem dos seus usuários;
•	A análise e a interpretação da nuvem de pontos adquirida pelo perfilômetro são potencializadas pela visualização de regiões de interesse, tanto na representação tridimensional quanto na planificada. Nestas regiões podem ser aplicados métodos de quantificação de características geométricas, como o cálculo do
volume de material removido e espessura remanescente da parede do tubo;
•	O sistema também permite monitorar a evolução dos danos provocados por corrosão através da comparação visual do mesmo trecho medido em tempos diferentes;
•	As anotações indexadas por posição permitem o registro de impressões e posterior leitura por diferentes analistas. Combinados com a definição de regiões de interesse, o usuário do sistema dispõe de um bom suporte para a confecção de relatórios sobre as inspeções geométricas realizadas pelo PEROLA-I ou pelo PEROLA-E.
Desta forma obtém-se uma valiosa ferramenta não só na inspeção do estado atual de integridade geométrica dos tubos, mas também para uma análise fina da sua evolução temporal, contribuindo com a segurança operacional de refinarias e outras instalações que envolvem tubulações expostas a corrosão interna.
7.2	MELHORIAS EM ANDAMENTO
O desenvolvimento do PEROLA-I está inserido no escopo de um projeto que continua em andamento no momento da conclusão desta dissertação. Ele está passando por atualizações que incrementam sua funcionalidade. Dentre estas, estão previstas a criação de protótipos para aplicação em tubos de diferentes diâmetros, para trechos com diâmetro interno variável, para trechos com curvas e para inspeções de tubos com eixo vertical. Estas novidades exigem que o sistema de aquisição e disponibilização de imagens passe a realizar a medição em trechos curvos e do posicionamento angular do perfilômetro em torno do seu próprio eixo na vertical. O hodômetro deve ser adaptado para uso em diferentes diâmetros. Também está sendo levantada a possibilidade de uso de um hodômetro/inclinômetro óptico.
O formato de armazenamento das medições está em processo de reformulação. A nova definição utiliza padrões como XML e PNG. Seu desenvolvimento está sendo realizado sob o critério de extensibilidade. Assim, a definição de novos valores a serem armazenados deve ser assimilada sem causar perda de compatibilidade em medições antigas. Outro critério de desenvolvimento é a aplicação da biblioteca de armazenamento e carregamento em diferentes linguagens e plataformas,
de modo a tornar o sistema de realidade virtual compatível com inspeções realizadas por outros métodos.
Está em desenvolvimento, para o sistema de realidade virtual, um módulo de análise automática de defeitos. Seus objetivos são encontrar, quantificar e classificar automaticamente as regiões defeituosas presentes. Isto deve simplificar a tarefa de análise no caso de medições muito longas, da ordem de 50 m ou mais.
O SRV também suportará a abertura simultânea de vários resultados de medição, o que potencializa a comparação geométrica entre as mesmas. Isto possibilitará o estudo da evolução temporal da geometria dos trechos inspecionados.
Para dar suporte às novas funcionalidades de análise geométrica, está em fase de estudo a construção de um banco de dados que reúna várias medições de uma mesma instalação industrial de interesse. Este banco de dados permitirá a mineração e comparação de dados de diferentes inspeções.
Em relação às funcionalidades de visualização, está em fase de testes um módulo de reconstrução da geometria tridimensional utilizando a técnica de pixel shader, aproveitando-se das tecnologias mais recentes em hardware gráfico para promover um grande aumento de realismo da cena e melhorar o desempenho do software.
Módulos de rede no paradigma cliente-servidor também estão sendo desenvolvidos para o software de operação do perfilômetro e para o sistema de visualização, com o objetivo de possibilitar a visualização do resultado inspecionado simultaneamente à aplicação do perfilômetro.
Por fim, estão em desenvolvimento novos módulos que possibilitem o uso do SRV com diferentes periféricos de realidade virtual, como novos monitores estereoscópicos e câmeras de detecção de movimento.
7.3	SUGESTÕES DE MELHORIAS FUTURAS
Embora o sistema apresente diversos aspectos positivos, ainda há pontos que podem, e devem, ser melhorados. Dentre eles estão:
• O sistema de aquisição e disponibilização de imagens requer um microcontrolador com maior capacidade de processamento. Além de reduzir o erro de medição de deslocamento e falhas de aquisição por picos de velocidade, isto permitiria o eventual uso de câmeras com maior taxa de aquisição de imagens, melhorando a velocidade de inspeção do PEROLA-I.


Deve haver otimização do software embarcado e mudança na estratégia de escalonamento de tarefas, de modo a melhorar o tratamento de erros. Isto é necessário, pois, apenas a melhora do hardware não será suficiente para eliminar falhas decorrentes do aumento da velocidade de inspeção.
Quanto ao sistema de realidade virtual, as principais melhorias necessárias estão relacionadas à usabilidade do sistema. Deve haver testes de ergonomia com usuários da indústria e avaliações do sistema através de questionários. O resultado destas avaliações pode influenciar na melhoria da interface e das capacidades do SRV, tornando-as mais simples ou mais elaboradas. É importante também avaliar a impressão causada pelas técnicas de realidade virtual, pois se considera que a mesma deve variar de usuário a usuário.
150
REFERÊNCIAS
AMNELL, T. et al. Times - A Tool for Modelling and Implementation of Embedded Systems. In: Joint European Conferences on Theory and Practice of Software. Grenoble: Springer Verlag, 2002. p. 460-464.
BACK, N. et al. Projeto Integrado de Produtos: planejamento, concepção e modelagem. São Paulo: Manole, 2008.
BALZER, M. Institut für Prozessdatenverarbeitung und Elektronik IPE. 2011. Disponível em Karlsruher Institut für Technologie:&amp;lt;http://www.ipe.kit.edu/157.php&gt;. Acesso em 28 fev. 2012.
BERGER, A. S. Embedded Systems Design. Lawrence, KS, EUA: CMP Books, 2002.
BUBENIK, T. MFL Overview. In: In-Line Inspection Symposium. San Francisco, CA, EUA, 2011. p. 32-57.
BUSCHINELLI, P. D. A GPU based real time image processing for an axis symmetrical optical laser triangulation system. In: SPIE Optics + Photonics. San Diego, CA, EUA, 2012.
BUSCHINELLI, P. D. Desenvolvimento de um sistema óptico por triangulação cônica para inspeção do perfil interno de dutos. Dissertação (Mestrado em Metrologia Científica e Industrial) -Universidade Federal de Santa Catarina, Florianópolis, 2007. 153 p. [Orientador: Armando Albertazzi Gonçalves Junior].
BUSCHINELLI, P. D. et al. Perfilometria óptica de dutos sujeitos à corrosão: princípios e recentes progressos. In: INTERCORR. Salvador, 2012. p. 1-12.
CIMINO, R. 2004. Transporte aeroviário, aquaviário e dutoviário. Disponível	em	Engeharia	Compartilhada:
&lt;http://www.engenhariacompartilhada.com.br/Secoes.Aspx?Capitulo=3 6054&gt;. Acesso em 1° ar. 2012.
ECLIPSE FOUNDATION. Eclipse Modeling Project. Disponível em Eclipse Foundation:&amp;lt;http://www.eclipse.org/modeling/&gt; Acesso em 1 jul. 2011.
FARINES, J.-M., FRAGA, J. d. &amp;amp; OLIVEIRA, R. S. Sistemas de Tempo Real. Florianópolis: Universidade Federal de Santa Catarina,
2000.
FEILER, P., GLUCH, D., &amp;amp; HUDAK, J. The Architecture Analysis &amp;amp; Design Language AADL: An Introduction. Pittsburgh: Software Engineering Institute, Carnegie Mellon University, 2006.
FOLEY, J. D. Computer Graphics: Principles and Practice. Nova Iorque, NY, EUA: Addison-Wesley Professional, 1996.
FRANZOI et al, A. R. Comparação do resultado de 3 técnicas de inspeção com pigs instrumentados em um mesmo oleoduto da Bacia de Campos. In: Rio Pipeline 2005. Rio de Janeiro, 2005.
HAERTEL, M. E. Perfilômetro Óptico Externo para Dutos Expostos à Corrosão. Dissertação (Mestrado em Metrologia Científica e Industrial) - Universidade Federal de Santa Catarina, Florianópolis, 2007. 79p. [Orientador: Armando Albertazzi Gonçalves Junior].
HAERTEL, M. E. et al. Development of an optical system for geometric inspection of external surface of pipelines. In: SPIE Optics + Photonics. San Diego, California, EUA, 2012.
HALLIDAY. Física 3. 5 ed. Rio de Janeiro: LTC, 2004.
HANCOCK, D. Viewpoint: Virtual Reality in search of middle ground. In: IEEE Spectrum, vol. 32, ed. 1, jan. 1995. p. 68.
HAUSE, M. The SysML Modelling Language. In: Fifth European Systems Engineering Conference. Cheltenham, Reino Unido: Incose, 2006.
HILLS, K. Digital Sensations: Space, Identity, And Embodiment In Virtual Reality. Minneapolis, MN, EUA: University of Minnesota Press, 1999.
KHRONOS GROUP. Khronos Contributing Members. Disponível em	Khronos	Group	Website:
&lt;http://www.khronos.org/members/contributors&gt;. Acesso em 25 jun. 2012.
KOOPMAN, P. Embedded Systems Design Issues: The Rest of the Story. In: Proc. Internat. Conf. Comput. Design. Austin, TX: IEEE Computer Society Press, 1996. p. 310-317.
LAMEF/UFRGS. Sistemas automáticos de inspeção UFRGS -LAMEF. Porto Alegre, 2011. CD-ROM.
LEACH, G. Graphics Pipeline. Disponível em Interactive 3D Graphics and	Animation:
&lt;http://goanna.cs.rmit.edu.au/~gl/teaching/Interactive3D/2012/lecture2. html&gt;. Acesso em 6 jan. 2012.
LIU, C. L., &amp;amp; LAYLAND, J. W. Scheduling algorithms for multiprogramming in a hard real-time environment. In: Journal of the Association for Computing Machinery, vol. 20. Jan. 1973. pp. 46-61.
MANSSOUR, I. H. &amp;amp; COHEN, M. OpenGL: Uma abordagem prática e objetiva. São Paulo: Novatec, 2006.
MELO, J. R. Sistema de aquisição de imagens indexadas para uso em perfilômetro óptico. Monografia (Curso de Engenharia de Controle e Automação) - Universidade Federeal de Santa Catarina. Florianópolis, SC, Brasil. 2009. 87p.
METÁLICA. Tubulação Industrial. Disponível em Portal Metálica:&amp;lt;http://www.metalica.com.br/tubulacao-industrial/&gt;. 1999. Acesso em 1 mar. 2012.
MICROCHIP. PIC16F688 Data Sheet. EUA: Microchip Technology, 2004.
MICROSOFT CORPORATION. DirectX Graphics and Gaming Windows. 2012. Disponível em Microsoft Developer Network:&amp;lt;http://msdn.microsoft.com/en-us/library/hh769064v=vs.85&gt;. Acesso em 16 jul 2012.
MÜLLERBURG, M. Software intensive embedded systems. In: Information and Software Technology, 5 nov. 1999. p. 979-984.
NATIONAL INSTITUTE OF STANDARDS AND TECHNOLOGY.
Announcing the Standard for Integration Definition for Function Modeling IDEF0. Springfield, Virginia, EUA: Federal Information Processing Standards Publication, 1993.
NESTLEROTH, B. Nondestructive Pipeline Inspection Using Pigs. In: In-Line Inspection Symposium. San Francisco, CA, EUA, 2011. p. 2-31.
NVIDIA CORPORATION. Quadro Quad Buffered Professional Stereo Technology.	2012. Disponível em&amp;lt;Nvidia:
http://www.nvidia.com/obiect/quadro stereo technology.html&gt;. Acesso em 29 set. 2012.
OLIVEIRA, C. H., &amp;amp; CAMERINI, C. S. Pig instrumentado da Petrobras - Resultados e perspectivas. In: Conferência sobre tecnologia de equipamentos. Salvador, 2002. p. 1-11.
OSHANA, R. DSP Software Development Techniques for Embedded and Real-Time Systems. Burlington, MA, EUA: Elsevier, 2006.
POINTGREY RESEARCH. PGR Scorpion Technical Reference Manual. EUA: PointGrey Research, 2004.
RANGEL, F. Investimentos aos tubos. Portos e Navios, Indústria Naval, ed. 598, nov. 2010, p. 16-21.
RIBEIRO, A. C. Curso de tubulações industriais: Aula 1. Faculdade de Engenharia Química de Lorena, Universidade Federal do Paraná. Disponível em:&amp;lt;ftp://ftp.demec.ufpr.br/disciplinas/TM141/aula01.pdf&gt;. Lorena - PR, 2007.
RUSSO, E. E. et al. A Realidade Virtual na Indústria de exploração e Produção de Petróleo. In: Realidade Virtual: Conceitos e Tendências. São Paulo: Mania de Livro, 2004. p. 283-288.
SHREINER, D. OpenGL programming guide: the official guide to learning OpenGL, versions 3.0 and 3.1. Boston, MA, EUA: Pearson Education, 2009.
SILVA, R. P. Como modelar com UML 2. Florianópolis: Visual Books, 2009.
SOARES, L. P., &amp;amp; SANTOS, I. H. EnViron: Uma ferramenta de realidade virtual para projetos de engenharia. In: XXIX Iberian Latin American Congress on Computational Methods in Engineering. Nov. 2008.
STROHAECKER, T. RCA - Grupo de Robótica, Controle e Automação. 2010. Disponível em Laboratório de Metalurgia Física:&amp;lt;http://www.lamef.demet.ufrgs.br/rca.html#1&gt;. Acesso em 15 mar. 2012.
WILMSHURST, T. An Introduction to the Design of Small-Scale Embedded Systems. Derby, Inglaterra: Palgrave, 2001.
WILMSHURST, T. Designing embedded systems with PIC microcontrollers: principles and applications. Oxford, Inglaterra: Elsevier, 2007.
WOLF, W. H. Hardware-Software Co-Design of Embedded Systems. In: Proceedings of the IEEE, Vol 82, N° 7, 1994. p. 967-989.
156
APÊNDICE A - CONCEITOS BÁSICOS DE AADL UTILIZADOS
AADL é uma linguagem para descrição, projeto gráfico e análise de sistemas em termos de componentes e suas interações. Inclui abstrações de software, hardware computacional e componentes para especificação e análise de sistemas embarcados de tempo real e mapeamento de software em elementos de hardware (Feiler, Gluch, &amp;amp; Hudak, 2006).
Entre os elementos definidos na linguagem, a seguir são apresentados aqueles presentes em diagramas neste trabalho.
•	Sistema. Elemento composto de outros sistemas, hardware e software. Possui descrição interna.
•	Dispositivo. Elemento de hardware que representa sensores, atuadores ou componentes que interagem com o ambiente.
•	Processador. Utilizado para escalonar e executar programas e threads. Componentes de software devem ter um processador associado.
•	Porta de dados. Utilizada para leitura do estado de uma informação.
•	Porta de evento. Utilizada para encaminhamento de um evento assíncrono.
•	Porta de dados e evento. Utilizada quando a mudança de estado de uma informação é vista como um evento.
Os elementos gráficos correspondentes aos descritos acima são apresentados na figura abaixo, com seus identificadores nomeados em referência aos seus tipos.
Sistema	Processador	Dispositivo
evento&amp;lt;/
evento
dados_evento
dados
dados
dados_evento</field>
	</doc>
</add>