<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.19482</field>
		<field name="filename">2840_Gomes_JoseAdilsonTenorio_M.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">UNIVERSIDADE ESTADUAL DE CAMPINAS
FACULDADE DE ENGENHARIA MECÂNICA
DEPARTAMENTO DE ENGENHARIA DE PETRÓLEO
Dissertação Apresentada à
Faculdade de Engenharia Mecânica Como Requisito Parcial à Obtenção do Título de Mestre em Engenharia de Petróleo
SIMULAÇÃO NUMÉRICA DE POÇOS HORIZONTAIS EM RESERVATÓRIOS COM FLUXO MULTIFÁSICO,
USANDO REFINAMENTO LOCAI..
5oho
Autor : José Adilson Tenorio Gomes
:'A
Novembro de 1990
UNIVERSIDADE ESTADUAL DE CAMPINAS
FACULDADE DE ENGENHARIA MECÂNICA
DEPARTAMENTO DE ENGENHARIA DE PETRÓLEO
A dissertação”Simulação Numérica de Poços Horizontais em Reservatórios com Fluxo Multifásico, usando Refinamento Local”, elaborada por José Adilson Tenório Gomes e aprovada por todos os membros da Banca Examinadora foi aceita pela Sub-Comissao de Pós-Graduação em Engenharia de Petróleo como requisito parcial a obtenção do título de Mestre em Engenharia de Petróleo.
Campinas,23 de Novembro de 1990
Antonio Cláudio de França Corrêa, Ph.D.
A Dora
Thiago e Ligia
A minha mãe
E ao meu pai (em memória )
AGRADECIMENTOS
■s
A Walter Pereira Formosinho por tornar possível a participação do mestrado.
Ao colega Celso Cesar Moreira Branco por sua valiosa contribuição.
Aos colegas de mestrado, professores e funcionários do CEPETRO pelo apoio necessário ao bom andamento do curso.
À todas as pessoas que direta ou indiretamente contribuiram para a realização desta tese.
Conteúdo
1	introdução	i
2	REVISÃO BIBLIOGRÁFICA	3
2.1	Poço Horizontal............................................   3
2.2	Refinamento Local . ....................................      6
3	DEFINIÇÃO DO PROBLEMA	9
4	FORMULAÇÃO DO MODELO	NUMÉRICO	11
4.1	Formulação Geral...........................................  11
4.1.1	Condições Iniciais ................................    12
4.1.2	Condições de Contorno..............................    13
4.2	Discretização das Equações de Fluxo . ....................   13
4.2.1	Termo de Acumulação	 ................................ 13
4.2.2	Termo de Fluxo...................................    .	. 14
4.2.3	Tratamento das Interfaces............................. 19
4.3	Equações de Fluxo na Forma de Diferenças...................  21
5	SOLUÇÃO DO MODELO NUMÉRICO	23
5.1	Descrição do Problema .................................    .	23
5.2	Solução do Sistema não-Linear de Equações .................. 24
5.3	Ordenação da Malha e Solução da Matriz.....................  25
5.3.1	Modelo Totalmente Acoplado..........................   25
5.3.2	Modelo Desacoplado..................................   29
5.4	Solução do Sistema Linear de Equações......................  33
5.5	Condições de Produção ...................................    34
5.6	Derivadas................................................    36
5.7	Controle Automático do Tempo................................ 36
6	VALIDAÇÃO DO MODELO	38
6.1	Solução Analítica ...................................      3g
6.2	Simulação dos Testes ..................................... 43
6.2.1	Comportamento da Pressão no Drawdown ................43
6.2.2	Determinação da Permeabilidade...................... . 46
7	ANÁLISE DOS RESULTADOS	54
7.1	Modelo Totalmente Acoplado................................ 54
7.1.1	Comparação entre os Métodos de Solução ..............54
7.1.2	Refinamento Radial.................................. 56
7.1.3	Refinamento Angular.........  ....................... 57
7.2	Comparação entre o Acoplado e os Desacoplados..............58
8	APLICAÇÃO DO MODELO	72
9	CONCLUSÕES E RECOMENDAÇÕES	81
10	REFERÊNCIAS	83
10.1	Poços Horizontais......................................   83
10.2	Refinamento local.......................................  85
11	APÊNDICE A - Derivadas das Equações	de	Fluxo	87
12	APÊNDICE B - Dados Utilizados na Simulação	102
13	APÊNDICE C - Resultados	105
13.1	Poço com 300m de comprimento  .......................    105
13.2	Poço com 100m de comprimento...........................  112
14	APÊNDICE D - Programas Computacionais	120
3.1	Representação do reservatório................................	. . . 10
4.1	Representação das linhas de fluxo próximo ao poço .......................... 14
4.2	Bloco cilíndrico para cálculo da posição do ponto nodal ...........	18
5.1	Modelo físico e si tema de coordenadas ....................................  24
5.2	Ordenação da malha.......................................................    26
5.3	Matriz	Jacobiana do sistema totalmente acoplado .............................28
5.4	Matriz	Jacobiana referente a malha	cartesiana..............................  30
5.5	Matriz	Jacobiana referente a malha	cilíndrica ...............................30
5.6	Fluxogramas para os métodos desacoplados ..................................  31
5.7	Representação dos termos de fluxo .............................  .	32
6.1	Representação do modelo físico.............................................. 39
6.2	Representação das linhas de fluxo dos regimes do transiente .................39
6.3	Comparação entre a solução analítica e a numérica	 .....................45
6.4	Gráfico de	Ap vs	Zní, para	o radial inicial............................. 50
6.5	Gráfico de	Ap vs	Int, para	o pseudo radial	tardio -	k	=	1.97	x	10~14m2	.	.	51
6.6	Gráfico de	Ap vs	Int, para	o pseudo radial	tardio -	k	~	9.87	x	10“15m2	.	.	52
6.7	Gráfico de	Ap vs	i1/2, para	o linear tardio............................. 53
7.1	Fator de sobre-relaxação versus tempo ...................................... 60
7.2	Refinamento radial (caso 1 ) - pwy versus tempo............................. 61
7.3	Refinamento radial	(	caso	1	)	* Qo versus tempo ...........................62
7.4	Refinamento radial	(	caso	2	)	- pwy versus tempo.........................  63
7.5	Refinamento radial	(	caso	2	)	~ Qo versus tempo ...........................64
7.6	Refinamento radial	(	caso	2	)- Qw versus tempo.........................    65
7.7	Refinamento radial ( caso 2 )- RWO versus tempo	..............	66
7.8	Refinamento angular - pwj versus tempo ..................................    67
7.9	Refinamento angular - Qo versus tempo .....................................  68
7.10	Comparação entre os modelos - pm/ versus tempo ..............................69
7.11	Comparação entre os modelos - Qo versus tempo ...............70
7.12	Comparação entre os modelos - Qw versus tempo ..............	71
8.1	Posição do poço - pwj versus tempo ........................   74
8.2	Posição do poço - Qo versus tempo.........................    75
8.3	Posição do poço - Qw versus tempo..........................   76
8.4	Comprimento do poço - pwj versus tempo ...................    77
8.5	Comprimento do poço - Qo versus tempo . ..................... 78
8.6	Comprimento do poço ~ Qw versus tempo ....................... 79
8.7	Perfil vertical de saturação de água......................... 80
víii
6.1	Parâmetros usados na validação......................................... 44
6.2	Características do reservatório e malha................................	46
6.3	Duração, em horas, dos regimes transiente.............................. 46
7.1	Parâmetros Usados na Simulação . ...................................    55
B.l Propriedades PVT do óleo saturado.......................................	102
B.2	Propriedades PVT do óleo sub-saturado ...............................  102
B.3	Propriedades PVT da água...........................................    102
B.4	Propriedades PVT do gás .........................................      103
B.5 Permeabilidades relativas óleo - água.................................  103
B.6 Curva de pressão capilar óleo - água . .................................104
LISTA DE SÍMBOLOS
A = Area da SeçãoTransversal (m2)
a = Dimensão do reservatório perpendicular ao poço (m)
B ~ Fator volume de formação (m3res/m3síd)
b = Dimensão de reservatório paralela ao poço (m)
c ~ Compressibilidade (Pa"1)
d	= Menor dimensão; poço/limite do reservatório (m)
D	— Maior dimensão: poço/limite do reservatório (íti)
I) = Profundidade em relação a um plano de referência (m) e	~	Vetor unitário
FF	—	Fator de forma
h	=	Espessura da formação (m)
k	=	Permeabilidade (m2)
L	—	Comprimento do poço (m)
m = Massa por unidade de volume (kg/m3)
m	=■	Fluxo de massa (kg/m3/s)
n	~	Número de blocos
p	=	Pressão (Pa)
Q	— Vazão em condições de superfície (m3std/d)
g	= Vazão em condições de reservatório	(m3/d)
g	= Termo fonte (kg/m3/s)
R	= Razão de solubilidade (m3sid/m3std)
r	= Raio (m)
S	= Saturação (fr)
s	— Skin
t	— Tempo (.s)
T	= Transmissibilidade
ü	~ Velocidade média (m/s)
V	= Volume (m3)
w	— Ponderador ou fator de sobre-relaxação
LETRAS GREGAS
A = Operador de diferenças d — Operador diferenciai parcial V — Operador divergente $	=	Porosidade (/r)
6	=	Potencial de fluxo
p ~ Viscosidade (Pa,s)
P = Massa Específica (fcg/m3)
7	— Peso Específico (kgf /m3)
0	= Direção angular
ÍNDICES INFERIORES e	=	Externo
end	~	Finai de um	regime
l	~	Fase; óleo, água	ou gás
o	—	Oleo
p	Poroso
ph ~ Poço horizontal
r ~ Rocha ou relativa ou direção radial start = Início de um regime
i	=	Total
w	=	Agua ou	poço
x,	i	=	Direção	£
y,	j	~	Direção	y
z,	k	—	Direção	z
ÍNDICES SUPERIORES
m ~ Iteração anterior do sistema linear de equações
m + 1	= Iteração atual do sistema linear de equações
n = Time step anterior
n + 1	— Time step atual
!/	~ Iteração anterior do sistema não linear de equações
v 4-1	= Iteração atual do sistema não linear de equações
*	Nível de iteração intermediário
RESUMO
Com o aprimoramento tecnológico dos métodos de perfuração e com-pletação e a necessidade de otimização do volume de óleo recuperável, nota-se um crescente interesse na perfuração de poços horizontais para a drenagem de reservatórios de petróleo. Estes poços são altamente atrativos, principalmente para reservatórios com pequena espessura de óleo e presença de aquífero e/ou capa de gás, para os quais são grandes os riscos de formação de cones de água e/ou gás, quando se utilizam poços verticais para sua drenagem.
0 objetivo deste trabalho, é o desenvolvimento de uma técnica de simulação numérica, na qual possa ser utilizada uma geometria de refinamento local para o poços horizontais, que represente adequadamente a geometria do fluxo multifásico ao redor do poço.
Para melhor representar a geometria do fluxo, considera-se que nas proximidades do poço, o fluxo é predominantemente radial, tendendo para linear, conforme se afasta do poço. Então, para a representação numérica utiliza-se uma malha cilíndrica nas proximidades do poço e uma malha cartesiana para a região do reservatório mais afastada do poço.
Foram desenvolvidos dois simuladores, com as equações que regem o fluxo dos fluidos no meio poroso, discretizadas numéricamente por diferenças finitas, totalmente implícito, sendo o primeiro considerando um sistema radial/cartesiano acoplado e resolvidos simultaneamente. O segundo considera os dois sistemas desacoplados, com o acoplamento radial/cartesiano feito num time-step ou numa iteração Newtoniana.
A validação foi feita através da comparação dos resultados numéricos com as soluções analíticas desenvolvidas para análises de testes para o regime transiente.
São feitas análises entre os métodos de acoplamento, entre os métodos de solução do sistema linear de equações e são apresentados alguns exemplos de aplicação dos modelos.
ABSTRACT
The main purpose of this work is to present a finite difference numerical simulator for horizontal wells, based on the use of a local refinement technique. The radial multiphase flow close to the well is more realistically represented through the use of a cylindrically oriented grid blocks. The outer region of the reservoir, where the flow regime is predominatily linear, is modelled by regular cartesian blocks.
The connection between the well and reservoir regions was implemented considering two approaches: in the coupled approach the radial/cartesian system is solved simultaneously, while in the uncoupled the reservoir region is solved first, followed by the solution of the well region at each time-step or at each Newtonian iteration.
The validation of the model was done through comparison of the numerical results with analitycal ones in the transient flow regimes.
The coupling and matrix solution methods as well as some results of the simulation runs are discussed in this work.
1	INTRODUÇÃO
Como consequência, houve grande avanço tecnológico em diversas áreas, principalmente na perfuração e completaçao de poços direcionais, permitindo que se tornasse cada vez mais viável a perfuração, completação e utilização de poços horizontais para a produção de petróleo. A idéia da utilização de poços horizontais nao é nova, pois até os anos 50, mais de uma centena já haviam sido perfurados, mas com índices de sucesso tanto para a perfuração quanto para a produção pouco satisfatórios. Somente a partir do inicio dos anos 80 é que os poços horizontais começaram a ter resultados mais promissores.
Os princípios físicos que regem o fluxo de fluidos no meio poroso mostram que os poços horizontais oferecem muitas vantagens sobre os verticais. Dentre estas, podemos destacar a grande diferença entre a produtividade dos dois tipos de poços, pois esta depende da extensão do poço em contato com a formação produtora, que para os poços horizontais não é limitada pela espessura da formação como é para os poços verticais. A recuperação final é maior, devido a melhor eficiência de varrido. Para reservatórios com grande extensão areal, o número de poços necessário para sua drenagem é bem menor. Este aspecto é muito interessante para campos offshore, explotados com poços perfurados a partir de plataformas. Devido a grande extensão atingida pelo poço horizontal, há maior contribuição para um melhor conhecimento geológico lateral do reservatório, pois em poços verticais isto fica restrito a um ponto. Os poços horizontais podem também oferecer soluções para problemas da produção de óleo e gás em reservatórios onde os poços verticais convencionais teriam resultados poucos satisfatórios. Como exemplo, podemos citar: reservatórios com problemas de formação de cones de água ou gás, reservatórios com fraturas verticais, reservatórios com baixa permeabilidade ou com anisotropia e em reservatórios com baixa eficiência de varrido ou com baixa injetividade.
de base para a escolha do tipo de poço mais adequado, deverá ser cercado de todos os cuidados, mesmo porque o custo de um poço horizontal ainda é maior que um poço vertical ou direcional. Assim, para que todas as variáveis possam ser cuidadosamente analisadas, minimizando os riscos, muitas pesquisas tem sido feitas. No inicio, estas pesquisas eram voltadas mais para a determinação de fórmulas analíticas para a previsão da produtividade dos poços horizontais e sua comparação com os verticais. Mais recentemente, com o grande avanço da informática, muito se tem estudado em relação a poços horizontais. Também as novas técnicas em solução de sistemas matriciais tem permitido avanços na área de refinamento de malha e decomposição de domínios, que tem aplicação direta em estudos de poços horizontais.
Este trabalho tem por principal objetivo, a utilização de técnicas de refinamento de malha, aplicadas a diferenças finitas para o desenvolvimento de um simulador que possa representar adequadamente a geometria de fluxo no reservatório drenado por um poço horizontal. Também, estudar as diversas formas de solução dos sistemas gerados e diferentes formas de acoplamento entre as malhas, para que possam ser aplicadas com diferentes objetivos, seja para o estudo de poço ou para o estudo global de um reservatório.
2	REVISÃO BIBLIOGRÁFICA
2.1 Poço Horizontal
A idéia da utilização de poços horizontais para a produção de petróleo não é recente, já que em algumas publicações í3,1^ encontramos referências de que até os anos 50 e 60, mais de uma centena de poços horizontais já haviam sido perfurados, principalmente na URSS, mas com resultados até então pouco satisfatórios em termos de produção de petróleo. Até esta época, os poucos estudos para a análise do comportamento dos poços horizontais eram realizados em laboratórios, com o auxílio de modelos analógicos elétricos e se concentravam principalmente na comparação entre a produtividade do poço horizontal com a do vertical. Devido as limitações físicas dos modelos utilizados, poucas variáveis podiam ser examinadas, entre elas, o comprimento do poço e a espessura da formação. É citado ^7'1^ que nesta mesma época foi desenvolvida por Merkulov, V.P. (1958), a primeira fórmula analítica para o cálculo do IP de poços horizontais.
A partir do final dos anos 70, devido à crescente valorização do petróleo, iniciou-se uma incessante corrida da indústria petrolífera, para a descoberta de novas reservas e otimização da produção e recuperação final dos campos em produção. Como consequência, houve um grande avanço em diversas áreas, principalmente nas técnicas de perfuração , completação e perfilagem de poços direcionais, tornando-se a partir daí, tecnicamente viável, a utilização de poços horizontais para a produção de petróleo. É a partir de então que começam a ser publicados vários artigos sobre a tecnologia de poços horizontais.
A partir de 1978 - principalmente com a Elf Acquitaine e o Instituto Francês de Petróleo, que financiados pela comunidade econômica européia, iniciaram estudos para a perfuração de quatros poços horizontais - é que começaram a ser publicados vários artigos sobre o comportamento de poços horizontais. Gíger apresentou fórmulas analíticas para o cálculo do IP de poços horizontais e vazão crítica para a formação de cristas de água. Apresentou também os critérios para a escolha entre poços horizontais e verticais conven -
donáis. Critérios que levavam em consideração as dimensões do reservatório, mecanismos de manutenção de pressão, anisotropia e características dos fluidos. Em outro artigo Giger analisou as vantagens da produção através de poços horizontais em reservatórios com heterogeneidades tais como: variações da permeabilidade lateral e vertical e com fraturas. Analisou também, os efeitos dos mecanismos de alimentação e o comprimento do poço horizontal. Após os primeiros cinco anos de produção dos poços perfurados pela Elf Aquitaine e o Instituto Francês de Petróleo, Reiss l3) apresentou os principais resultados, comparando-os com as análise teóricas desenvolvidas para o estudo do IP, eficiência de varrido e produção em reservatórios fraturados.
Com a utilização de um modelo hodográfico, Giger desenvolveu fórmulas analíticas para o cálculo da deformação vertical dos contatos óleo/água e gás/óleo e a vazão crítica para a formação de crista de água. Aplicou as fórmulas para reservatórios com capa de gás e aquífero não atuante, influxo de água de fundo e lateral. Chaperon fez um estudo das vantagens da produção com poços horizontais em reservatórios com camadas isoladas de baixa permeabilidade. Utilizando as fórmulas analíticas desenvolvidas por Giger, Kacher W estudou o problema da produtividade dos poços horizontais em reservatórios fraturados e com anisotropia. Joshi desenvolveu equações para o IP de poços horizontais e fez estudos para determinação da influência da anisotropia do reservatório, espessura, área de drenagem do poço e da excentricidade na produtividade. Estudou também a tendência da formação de cristas de gás e água. Babu et al ma-tendo a forma inicial proposta por Giger, desenvolveram o cálculo do IP para reservatórios limitados com poço parcialmente penetrante.
Os estudos desenvolvidos até então, se prendiam ao desenvolvimento de fórmulas analíticas, sem referências à utilização de simuladores numéricos para o estudo do comportamento de poços horizontais. Sherrard í6- apresentou um estudo para poços horizontais no qual fez uso de um simulador black-oil, totalmente implícito com o poço horizontal sendo representado por vários blocos, numa região em que a malha tinha um grande refinamento, que se estendia por todo o reservatório, em todas as direções. Uma análise
dos cuidados na utilização de fórmulas para o cálculo do 1P aplicadas para simuladores numéricos convencionais por diferenças finitas, foi feita por Lee í8h Para evitar resultados errados recomendou um grande refinamento e que o poço fosse representado por varios blocos. Kossack também usou um simulador black-oil totalmente implícito para simular o comportamento da produção através de poços horizontais, em reservatórios com. várias fácies de diferentes permeabilidades. Chang usou o BOAST para fazer a simulação do poço horizontal ou inclinado, através da decomposição do poço em três componentes centrados e paralelos às faces dos blocos e o cálculo do IP para cada componente usando o método das imagens.
Todas as fórmulas desenvolvidas para o cálculo do IP assumiram até agora o comportamento do regime permanente, ou seja, davam estimativa para a produtividade ou injetividade para poços, para os quais, a queda de pressão entre o poço e a formação permanece constante, tais como nos processos de injeção de água.
0 comportamento do fluxo de um fluido incompressível em poços horizontais no regime transiente, para reservatórios com espessura finita e infinito horizontalmente foi es* tudado por Lara e Clonts Goode e Thambynayagam descreveram as repostas de pressão no poço horizontal para um fluido levemente compressível num reservatório semi-infmito: limitado verticalmente e na direção perpendicular ao poço, desprezando o efeito gravitacional. Ozkan et al (161 desenvolveram curvas tipos para testes de poços horizontais em reservatório infinito, Odeh e Babu l13) apresentaram análises do comportamento no regime transiente para reservatório limitado em todas as direções e para poço parcialmente ou totalmente penetrante, localizado paralelamente a duas faces, em qualquer ponto do reservatório. Também para fluido levemente compressível sem o efeito gravitacional.
2.2 Refinamento Local
Durante a simulação numérica de reservatórios é desejável que as regiões em que ocorrem fortes variações nas características do fluxo, sejam representadas por uma malha com refinamento tal, que possa mostrar com precisão estas variações. Estas regiões na maioria dos casos são as regiões dos poços, que é uma região relativamente pequena quando comparada com todo o reservatório. Portanto, é interessante que somente esta região tenha um grau de refinamento maior, deixando as outras partes de reservatório representada por blocos maiores, o que não provoca nenhuma perda de precisão e contribui enormemente para o aumento da velocidade de simulação e economia de memória computacional.
Na simulação numérica de reservatórios com discretização por diferenças finitas e uso de coordenadas cartesianas, devem ser tomados alguns cuidados na implementação de refinamentos local, para que não ocorram erros que comprometam os resultados. Um dos primeiros pequi sadores nesta área foi Rosenberg que apresentou um método de refinamento local onde prevê quatro diferentes configurações para a aplicação de diferenças finitas. Mostra que o uso destas configurações são efetivas e mais econômicas. Quandalle e Besset com o objetivo de melhor representar reservatórios com falhas, discordâncias geológicas e outras anomalias, fizeram a aplicação do refinamento local em vários níveis, com o uso de múltiplos time-steps para diferentes grupos de blocos, num simulador black-oil implícito na pressão e na saturação. Concluiram que o uso deste procedimento proporcionava resultados bem próximos dos obtidos com a utilização de uma malha totalmente refinada, mas com grande redução no tempo de computação.
Heinemann et al UD sugeriram a aplicação do refinamento local dinâmico em simulador de múltiplas aplicações, com o objetivo de fazer uma grande redução no número de blocos necessários à representação do reservatório. As equações foram formuladas para diferentes graus de implicitude, que dependiam dos níveis de variação da pressão, saturação e da temperatura do reservatório. Também foi feita a seleção dinâmica do refinamento e do tamanho do time-step e uma análise do erro de discretização devido a este
refinamento.
A malha híbrida proposta por Pedrosa, representava a região próxima ao poço através de uma malha cilíndrica ou elíptica - a depender das características do reservatório - e a região mais afastada do poço através de uma malha cartesiana. Esta configuração adaptava perfeitamente à geometria do fluxo próximo e longe do poço, podendo dentro da malha cilíndrica, os blocos serem sucessivamente menores, conforme se aproxima do poço. Com esta configuração, desenvolveu simuladores com graus de implici-tudes diferentes para as duas regiões; a região do poço totalmente implícita e a região do reservatório num esquema IMPES. As duas regiões foram resolvidas independentemente, sendo as condições dos blocos cartesianos vizinhos aos cilíndricos, usadas como condições de fronteira para os cilíndricos, num processo que poderia ser iterativo ou nao. 0 processo não iterativo traz bons resultados, pois segundo Akbar et al ^i8) a convergência num processo iterativo é atingida numa única iteração.
Em outro artigo, Quandalle e Besset analisaram o efeito do refinamento de malha em diferentes níveis, e para eliminar efeitos indesejáveis, propuseram esquemas mais sofisticados para diferenças finitas envolvendo cinco e nove pontos, ao invés de dois, aplicável a qualquer composição de malha tridimensional. Han apresentou um esquema de refinamento dinâmico para qualquer região do reservatório, onde o refinamento é sempre de um bloco para um número par de vizinhos. Wasserman propôs a aplicação do refinamento estático em vários níveis para simuladores tridimensionais, usando para a solução o conceito de decomposição de domínios. Ewing et al discutiram as várias estratégias para o refinamento de malha e o uso da decomposição de domínios. Heine-mann et al propuseram o método de discretizaçao volume finito ou balanço, que fica entre a diferença finita e o elemento finito e se caracteriza pela formação dos blocos pela
8 ligação entre as linhas perpendiculares aos grid points, fazendo com que cada bloco tenha uma geometria irregular e com seis vizinhos. Brand e Heinemman&amp;lt;29\ apresentaram novas formas de fatoraçao da matriz esparsa gerada quando do uso de refinamento local e apresentaram também alguns métodos eficientes de ordenação da malha.
3	DEFINIÇÃO DO PROBLEMA
0 principal objetivo deste trabalho, é o estudo das técnicas e desenvolvimento de um simulador numérico, com malha que represente adequadamente a geometria de fluxo, para o estudo do comportamento de reservatórios com produção através de poços horizontais.
As equações de fluxo foram desenvolvidas para a construção de um simulador tridimensional, bifásico ( óleo e água ), totalmente implícito e utilização do conceito de malha híbrida, ou seja, a região próxima ao poço - onde ocorrem grandes variações de pressão e saturação e onde a geometria do fluxo é predominantemente radial - será representada por uma malha cilíndrica. A região mais afastada do poço será representada por uma malha cartesiana com o acoplamento entre as duas regiões através de dois processos distintos:
• Sistema totalmente acoplado:
Considera as duas malhas sendo resolvidas simultáneamente no mesmo sistema linear de equações, ou seja, no mesmo Jacobiano;
» Sistemas desacoplados:
Considera as malhas resolvidas separadamente, com posterior acoplamento através da transferência dos termos de fluxo em cada time-step ou em cada iteração New-toniana.
São feitas comparações entre os resultados gerados pelos diferentes métodos de acoplamente das regiões e também são feitas análises em relação aos métodos de solução do sistema linear de equações,
O reservatório a ser estudado é ilustrado pela figura 3.1.
Poço horizontal
Figura 3.1: Representação do reservatório
4	FORMULAÇÃO DO MODELO NUMÉRICO
4.1 Formulação Geral
0 modelo desenvolvido é um simulador black-oil, totalmente implícito, tridimensional, bifásico ( óleo e água. ), com as regiões que representam o reservatório e o poço podendo ser totalmente acopladas ou desacopladas.
As equações que regem o fluxo dos fluidos no meio poroso são derivadas a partir da equação da conservação de massa para o fluxo de uma fase,
„ . dm
= —-H;	(4.1)
onde : m — fluxo de massa através da fronteira;
m = massa por unidade de volume;
q — termo fonte.
Fazendo a substituição do fluxo de massa e a massa no meio poroso em termos de densidade média, porosidade e saturação, teremos para a fase Z:
-	- ^(p^) +	,	(4.2)
Usando a lei de Darcy para o fluxo multifásico, que é dada por;
tq =	~ 7íVB)	(4.3)
Mí
e o conceito de fator volume de formação, podemos derivar a equação que rege o fluxo para cada, fase, conforme:
V.[Al(Vp,-7iW = |)[^íl + ?i	(4-4)

Al
Segundo a formulação apresentada por PedrosaL2^ esta equação pode ser inte-
grada sobre um volume de controle 1&lt;
Definindo a diferença de potencial como, V&amp;amp;/ =	D) e admitindo fluxo
permanente através das fronteiras, a equação 4.4 pode ser reescrita e integrada como:
jv V.[A,VÍ,]dV = jv	+ 9,	(4.6)
Usando o teorema do divergente ( ou teorema de Gauss ), que transforma uma
integral de volume em uma integral de superfície, esta equação pode ser reescrita, com o
lado esquerdo modificado para uma integral do fluxo de massa sobre uma superfície A,
assim:
onde : âA ~ elemento de área atravessada pelo fluxo;
n ~ vetor unitário normal a superfície;
(4.7)
V ~ volume de controle.
O lado esquerdo da equação acima, é o termo de fluxo e representa o fluxo de massa sobre toda superfície de controle e o lado direito é 0 termo de acumulação que repesenta a taxa de expansão e contração do volume de controle.
Para a solução do problema são necessárias as seguintes relações adicionais:
ZSi ^=SO + SW=1
" Po “ Pw ~
(4.8)
(4.9)
4.1.1	Condições Iniciais
0 reservatório se apresenta inicialmente saturado com óleo e água conata, podendo ou não ter presença de água livre ( aquífero ). Quando houver aquífero, considera-se que as fases estão em equilíbrio gravitacional e capilar. A pressão original, pt) é dada no contato óleo/água ou numa profundidade de referência arbitrária.
4.2	Discretização das Equações de Fluxo
As equações anteriores sao discretizadas por diferenças finitas para formulação totalmente implícita, com esquema de bloco centrado com cinco pontos.
4.1.2	Condições de Contorno
4.2.1	Termo de Acumulação
Considerando diferenças regressivas no tempo, o termo de acumulação pode ser
aproximado por:
(4.10)
onde At é o operador de diferenças no tempo, definido como:
(4.11)
onde n representa o nível de tempo e ã; é o inverso do fator volume de formação B( , ou seja, bi —
Sabendo que:

n4-l
(4.12)
A&lt;[^] = ^f{[l +	~ P?)](l - S':+'K+l - ( WU
+ Mrt+1 ~	- (S„6w)”)uí
Para a equação do óleo foi usada a relação adicional:
$t&gt; + Sw = 1
(4.13)
(4.14)
(4.15)
4.2.2	Termo de Fluxo
O termo de fluxo é fortemente dependente da geometria da malha, e esta tem que ser levada em conta na discretização das equações. Para a representação do poço horizontal adotou-se a hipótese de que próximo ao poço, as linhas de fluxo são aproximadamente radiais com as linhas equípotenciais circulares, conforme ilustrado na figura 4.1, o que levou à adoção de uma malha híbrida ( Pedrosa^22^ ), ou seja, cilíndrica para a região próxima ao poço e cartesiana para regiões mais afastadas.
Figura 4.1: Representação das linhas de fluxo próximo ao poço
Portanto, para a discretização do termo de fluxo tem que ser levado em consideração o sistema de coordenadas e a área atravessada pelo fluxo. Para um determinado
(4.16)
0 potencial de fluxo pode ser decomposto em parcelas referentes a cada, direção em cada sistema de coordenadas, ou seja:
Coordenadas cilíndricas
V0;
Coordenadas cartesianas
(4.17)
(4.18)
onde, er , e# , ez, ev e e- são vetores unitários para cada direção.
Assim quando aplicado a uma determinada direção as parcelas referentes às outras direções se anulam. Por exemplo, para a direção x teremos:
kri d$i Bw dx
dA
(4-19)
Considerando que pode ser obtido como um valor médio, que d A pode ser determinada de acordo corn a geometria e que o termo	seja função somente da
direção considerada a integral pode ser determinada, chegando-se a seguinte forma:

(4.20)
O termo (jFF^^)jace, representa a transmissibilidade e cujas parcelas são calculadas para as faces, como a seguir:
interface
I
&lt;/, I a, ’ + &gt;
I I d
ponderador : w = portanto:
Pljace = (1 ~	+ w/zí(+1	(4.21)
Biíace ~ (1 - w)Bu + wBu+i	(4.22)
As propriedades nos pontos nodais, são funções das pressões nos mesmos.
» FF - Fator de forma, que leva em consideração a geometria da face atravessada pelo fluxo c portanto definidos para cada tipo de malha ( cartesiana ou cilíndrica ) e para cada direção, conforme a formulação que é apresentada por Pedrosa^22h
- Malha Cilíndrica
* Direção Radial - r
ri rf	r	.
íi+1/2 ~ +
Krijh	«rí+lj* ’'.+ 1/2
onde kríjk é a permeabilidade absoluta na direção radial.
* Direção Angular - 0
^■fzj+i/2 — [
(4.24)
^Síj+ik
onde kçijk é a permeabilidade absoluta na direção angular.
* Direção Linear - z
FF ........ ^(í^+l/z)2 ~ (r,-i/2)2)1
1 j /‘j-íh | £í*±jl~£í±lzi fcpíjk	kpíjfc-H
onde ki)ijh é a permeabilidade absoluta na direção linear.
- Malha Cartesiana
* Direção - x
ri p	_ r
íj-Fl/2 [ Xj^y^-Xí __ Xf + l~Xi^i/2
*	Direção - y
f AXtADfc ,
r ^b+i/2 ” lyjW2-y7 _ y,-+1-r&gt;+1/a J
*	Direção - z
A Y AV,
PP	_ r__________________________
i ifc+1/2 ~	__
kDíjk	fcpvk + i
para as faces i — 1/2, j — 1/2 e k — 1/2 as fórmulas são similares.
(4.25)
(4.26)
(4.27)
(4.28)
Para a malha cilíndrica é adotado um espaçamento logaritmo, que se caracteriza por ter blocos exponencialmente maiores conforme se afasta do poço. Esta configuração é interessante, pois próximo ao poço, as mudanças de saturação e pressão são mais intensas. Para o cálculo da posição do ponto nodal, consídera-se que para o fluxo de um fluido incompressível numa malha cilíndrica, este ponto deve estar localizado no ponto onde a distribuição de pressão para o regime permanente, seja igual a pressão média volumétrica do bloco.
Para o bloco radial, representado pela figura 4.2, a distribuição de pressão para o fluxo permanente é dado por:

êkhln{
T
D-1/2
)
Para o fluxo incompressível no regime permanente a vazão g, através de qualquer seção transversal do bloco é constante. E a pressão média volumétrica é dada por:
1
(4.30)
Figura 4.2: Bloco cilíndrico para cálculo da posição do ponto nodal
0 volume de um bloco cilíndrico, conforme esquematizado na figura 4.2, é dado
por:
= f (^+1/2 —	O31)
e
dV Ohrdr
(4.32)
Portanto a pressão média volumétrica do bloco pode ser escrita como:
2	/•’■&amp;lt;+1/2 r
n/r'¿	„ „2	)/} / UA-í/2 +
í+l/2 ri-l/2)n ^í-1/2
......]Ohrdr
ri-l/2
(4.34)
que integrada de	à n+1/2, resulta era:
rt'+Í/2
r,-i/2
(4.35)
se Ti é o ponto nodal, então a pressão ( p ), neste ponto deve ser igual a pressão média, daí igualando as equações 4.29 e 4.35, teremos a posição deste ponto:
onde : o =
e a posição das faces dos blocos é dada por:
n+1/2 = ru,eiãp
N.Blocos
(4.37)
4.2.3	Tratamento das Interfaces
A malha cilíndrica possui o mesmo volume e o mesmo número de blocos na direção z, que os blocos cartesianos atravessados pelo poço. Na direção radial o número mínimo de blocos são 2 e estes sao exponencialmente crescentes a partir do poço. Na direção angular o número mínimo de blocos são 4.
Para o modelo totalmente acoplado pode haver, na direção radial (r) e linear (z), comunicação entre a malha cilíndrica e a cartesiana. A única diferença que ocorre nas equações de fluxo dos blocos de interfaces são os fatores de forma. Estes são dados por:
1.	Direção Radial - r
A0AD
FFii+i/2 +
2.	Direção Linear - z
FFIM/i = I
AÜ((r,H/2)! - (r,_1/2)2) AD(rL„J^) A^rv	*zci&lt;
(4.39)
Nestas equações ternos:
♦	re ~ raio externo da malha, cilíndrica;
♦	?nx = ponto nodal do bloco mais externo da malha cilíndrica;
» dcv = distância entre ponto nodal do bloco znais externo da malha cilíndrica e o do bloco catesiano vizinho;
♦	krnx — permeabilidade absoluta do bloco cilíndrico mais externo na direção radial;
♦	kTCV = permeabilidade absoluta do bloco cartesiano na direção do bloco radial vizinho;
♦	kznx = permeabilidade absoluta do bloco cilíndrico mais externo na direção linear;
» kxcv = permeabilidade absoluta do bloco cartesiano na direção do bloco radial vizinho;
Para os modelos desacoplados não existem termos de interfaces, pois a comunicação cartesiano/cilíndrico é determinada pela substituição do termo de fluxo referente as faces externas dos blocos cilíndricos, pelos termos de fluxo dos blocos cartesianos vizinhos, calculados numa iteração ou num time step. No próximo capítulo serão dados mais detalhes sobre este acoplamento.
4,3	Equações de Fluxo na Forma de Diferenças
De acordo com as discretizações do termo de acumulação e termo de fluxo, feitas nas seções anteriores, as equações para o fluxo do óleo e água no meio poroso, num esquema totalmente implícito na pressão e na saturação, podem ser escritas da seguinte forma:
Equação para o óleo:
E Í71	ÍMtiõWS - A+1) - KtrifM. - Ml +	
	^ro”f1/2((p™+1 - PS) - 7."+-\/,(Dm - MJ]) = ^4([1 + c,(Pr‘ - ?;)i(i - S’«K+' - (SA)")W + ?0	(4.40)
Equação para a água:
E mr;,z,ító\ - *+ij -	- p^+') -	- b.» +
m
- pS) - (a,4í’ ~	- a,-.))} =
^([í + Cr(?;+1 - ;&gt;;)](s„í&gt;,„)"+1 - (Sw6„)")í&gt;4 + ■?«.	(4.4i)
Nas equações acima, m representa as três direções (i, j, k ), o time step anterior ( aid time step level), é dado por n e o time step atual ( new time step level), por n 4-1. A transinissibilidade e o peso específico dos fluidos são calculados nas faces dos blocos.
Estas equações podem ser escritas simplificadamente utilizando-se a notação definda por Aziz e Settari30, da seguinte forma:
A[T((APi - 7,AD)g+' =	(4-42)
Onde o primeiro membro significa:
kzlTJ&amp;amp;zPt - 7í^D)]^
Para uma variável U, o operador de diferenças centrais é definido como: (A^)f - Ui+l/2 - U^/2
Em termos de p0 e Sw a equação 4,42 pode ser escrita como:
A[T„(APo - %AD)]"t’ =	A,[&lt;(1 - S„)]w	(4.44)
A[T,„(Ap. - AP„„ -	A.D)]$’ =	(4-45)
Estas equações escritas para todos blocos ijk, (i = 1,2, - • • nz, j = 1,2, - • • ny e k — 1,2, &gt; ■ • nz ) no nível de iteração n +1 geram um sistema não-linear de 2 x nx x ny x nz equações com 2 x n® x ny x nz incógnitas.
■Os métodos de solução do sistema não linear de equações, assim como os métodos de solução do sistema já linearizado serão abordados no próximo capítulo.
5	SOLUÇÃO DO MODELO NUMÉRICO
0 objetivo deste capítulo é fazer a descrição do problema a ser resolvido e todas as hipóteses utilizadas para sua solução.
5.1	Descrição do Problema
As equações desenvolvidas e discretizadas anteriormente serão aplicadas para o estudo do comportamento de um reservatório produzindo através de um poço horizontal num modelo com as seguintes características:
•	Totalmente implícito;
•	Tridimensional;
•	Bifásico ( óleo e água );
•	Poço com condutividade infinita e com fluxo nas pontas desprezível;
•	Produção com vazão ou pressão de fluxo de fundo especificada;
•	Uso de malha híbrida, com região do poço em coordenadas cilíndricas e a região do reservatório em coordenadas cartesianas;
•	Regiões totalmente acopladas ou desacopladas;
•	Consideração do efeito gravitacionai;
•	Consideração do sentido de fluxo;
•	Solução do sistema não linear de equações pelo método de Newton-Raphson;
•	Solução do sistema linear de equações por método direto e iterativo.
Figura 5.1: Modelo físico e sitema de coordenadas
5.2	Solução do Sistema não-Linear de Equações
Para o esquema totalmente implícito, o método de Newton Raphson será aplicado para resolver o sistema não linear de equações, nas incógnitas pa e SWi que é gerado com a aplicação das equações desenvolvidas anteriormente a todos os blocos que formam o reservatório.
O esquema iterativo do Newton-Raphson é gerado a partir da expansão das funções de resíduos de cada fase,	~ o, w ), em torno da iteração ( v ), e retenção
dos termos de menor ordem.
Genéricamente o método de Newton-Raphson pode ser escrito, como:

(
dF¡ dx
(5.1)
onde:
• F¡ são as funções de resíduos dadas pelas equações;
= A[T0(Ap„ - 7,Aflg‘ - ^A([^„(l -	- 9o = 0	(5.2)
Fwijk AfTuifApo A/1,.7«'Aa)]ÍJ;j	A.ípó,, .S7ó.¡j— q..: — 0 (5.3)
• dé’)P’ representa a matriz Jacobiana, que é formada pelas derivadas das funções resíduos, em relação as variáveis primarias ( po e Sw ) para todos os blocos e seus vizinhos. Para o nosso problema, que é tridimensional e bifásico a matriz resultante é heptadiagonal blocada e os blocos 2x2, com a seguinte composição:
\ àpo
/
*	, é o vetor solução dado por ¿rir"4,1 = ;zr’,'+‘1 — ari, sendo x as variáveis pa e Sw
e í/ o nível de iteração Newtonian a.
5.3	Ordenação da Malha e Solução da Matriz
0 acoplamento entre a região do poço ( malha cilíndrica. ) e a região do reservatório ( malha cartesiana ) será resolvido de duas formas distintas; 1) de forma totalmente acoplada e 2) de forma desacoplada, como será discutido a seguir:
5.3.1	Modelo Totalmente Acoplado
Neste caso as duas regiões são resolvidas simultáneamente no mesmo sistema de equações, para o esquema totalmente implícito na pressão e na saturação.
A figura 5.2 ilustra o tipo de ordenação da malha adotada neste trabalho.
Figura 5.2: Ordenação da malha
f dce V	í &amp;amp;G y+1	( GCV
V Jrc Jrr J	\ ó® J	\ Gr )
onde : Jcc é a submatriz de derivadas parciais das funções de resíduos do sistema cartesiano com relação às variáveis primárias do mesmo sistema;
JrT é a submatriz de derivadas parciais das funções de resíduos do sistema cilíndrico com relação às variáveis primárias do mesmo sistema;
Jcr é a submatriz de derivadas parciais das funções de resíduos do sistema cartesiano com relação às variáveis primárias do sistema cilíndrico;
Jrc é a submatriz de derivadas parciais das funções de resíduos do sistema cilíndrico com relação às variáveis primárias sistema cartesiano;
êxc é o vetor solução para o sistema cartesiano;
òxT é o vetor solução para o sistema cilíndrico;
G’c é o vetor de termo independente para o sistema cartesiano;
Gt é o vetor de termo independente para o sistema cilíndrico.
As submatrizes e Jrc correspondem aos elementos de interfaces e a distância destes elementos à parte central da matriz depende da ordenação da malha. A figura 5.3 ilustra a matriz Jacobiana completa para uma malha com as seguintes características: cartesiana com 3x3x4, com um total de 34 blocos e uma cilíndrica de 2x4x2, com um total de 16 blocos, conforme a figura 5.2.
Nesta matriz e nas seguintes as letras (de A até G), representam blocos e tem o seguinte significado:
AB D	F						
CAB D	F						
CAB D	F						
CA	D	p						
E	AB D		F					
E CAB D							F
E CAE D							F
E CA	D		F					
E	AB		F					
E CAB		F					
E CAB		F					
E CA		F					
G	AB	D	F				
G	CAB		F				D
G	CAS		F				D
G	CA	D	F				
G	E	A D		F			B B B B
G	E	A	D		F			C c C C
G		E AB			F		
G		CAE			F		G
G		CAB			F		G
G		E	CA			F		
	G		AS	D			
	G		CAB	D			
	G		CAB	D			
	G		CA	D			
		G	E	AB	D		
			r E.	CAB	D		G
			E	CAB	D		G
		G	E	CA	D		
		G		E	AS		
		G		E	CAB		
		G		E	CAB		
		,...G			E	CA		
						ABD	E	F
						CA D	E	F
						E ABD	F
						ECA D	F
						E ABD	F
						ECA D	F
						&amp;amp;	E fiE	F
						D	ECA	F
		C		F		G	ABD	E
		E		F		G	Cfi D	E
		C F				G	E ABD
		B	F				G	ECA D
F		C				G	E ABD
F		B				G	ECA D
	F	C				G	D	E fiB
	F	B			|	G	D	ECA
							
Figura 5.3: Matriz Jacobiana do sistema totalmente acoplado
/ -SFi^ SF,„ \
^Pfíjjk ^^wijk dFo tdFr,
X ^Poijk ÓFwijk /
•	B =	Hem, em	relação	aos	blocos	i, j, k + 1;
•	C —	Hem, em	relação	aos	blocos	i, j, k — 1;
•	D = Hem, em relação aos blocos i,j + 1, k',
*	E ~ Idem, em relação aos blocos i,j — 1, k;
*	F =	Hem, em	relação	aos	blocos	i + 1, j, k;
♦	G =	Hem, em	relação	aos	blocos	i — 1, j, k.
5.3,2	Modelo Desacoplado
Por este método as duas regiões são resolvidas separadamente, ou seja, é gerada uma matriz heptadiagonal para a malha cartesiana e outra para a malha cilíndrica.
0 sistema de ordenação é o mesmo adotado anteriormente ( figura 5.2 ) que resultará em matrizes heptadiagonais com blocos 2x2, tanto para a região do poço ( malha cilíndrica ) quanto para a região do reservatório ( malha cartesiana ), conforme pode ser visto respectivamente nas figuras 5.4 e 5.5. Deve ser observado que as matrizes geradas tem as bandas bem definidas, para as quais existern métodos eficientes de solução.
0 acoplamento entre as duas regiões é feito através da transferência de massa de uma malha para outra, no qual o balanço de massa deve ser respeitado. Esta transferência pode ser feita através de dois processos, cujos fluxogramas são apresentados na figura 5.6. No primeiro, os termos de fluxos são transferidos de uma malha para a outra num timestep. Já no segundo, esta transferência é feita dentro de uma iteração Newtonian a.
Esta transferência é representada na figura 5.7, onde os termos qm, são os termos de fluxo das faces dos blocos cartesianos, e são calculados numa iteração ou num time
Figura 5.4: Matriz Jacobiana referente a malha cartesiana
E F
E
ABD
Cft D
E ABD
ECA D
E ABD
ECA D E AB ECA
D
D
G
G G
G
G
Z-’1 *¿3
F
F
F
F
F
F
E
E
ABD ca d
E ABD
ECA D
E ABD
ECA D
E fiB
ECA
G
F
D
G D
Figura 5.5: Matriz Jacobiana referente a malha cilíndrica
a ) Acoplamiento no time siep
GD
b ) Acoplamiento na iterará»
Figura 5.6: Fluxogramas para os métodos desacoplados
Quando a malha cilíndrica for mais refinada que a cartesiana, é feita a ponderação dos termos de fluxo. Pela figura 5.6, nota-se que o fluxo que sai (entra) num bloco cartesiano deve ser igual ao somatório dos fluxos que entra (sai) de cada bloco cilíndrico, ou seja:
Figura 5.7: Representação dos termos de fluxo
n
j=i
(5.4)
0 fluxo para cada bloco cilíndrico também pode ser calculado pela lei de Darcy:
- t A
Qlj — ^¡jAÁ )jront
(5-5)
onde, A,-j =	será calculada no bloco a montante, Aj é a área de interface,
a variação do potencial entre um bloco cartesiano e um bloco cilíndrico e d a projeção vertical ou horizontal da distância entre os pontos nodais.
Dividindo a equação 5.5 pela 5.4, obtem-se:
(5.6)
fM I front
(5-7)
5.4	Solução do Sistema Linear de Equações
Para a solução do sistema matricial podem ser usados métodos diretos ou iterativos. Para casos em que não se exija uma malha muito refinada, é perfeitamente viável a utilização do método direto por eliminação de Gauss. Já para casos mais complexos em que deve haver um grande refinamento da malha é recomendável a utilização de métodos iterativos.
Neste trabalho resolveremos o sistema pelo método direto, com o uso de um
algoritmo com otimização do processo de eliminação de Gauss ( com o algoritmo para matrizes esparsas, NSPIV34 ) e também pelo método iterativo BSOR (Aziz e Settari í30)). Este último pode ser representado da seguinte forma:
se refere a região do poço, e Jrc se referem às interfaces entre as duas regiões. xc e a'r são os vetores de incógnitas, Gc e Gr são os termos independentes.
A partir de um valor inicial para x.~ e xr resolve-se, num primeiro passo, o sistema para a incógnita xr'.
~ wx* + (1 — w)x™
o segundo passo é usar xm+1, determinado no passo anterior e resolver o sistema
para xc, com a seguir:
5.5	Condições de Produção
Tanto para o modelo totalmente acoplado, quanto para os desacoplados, a condição de produção poder ser pela especificação da vazão de produção ou da pressão de fluxo de fundo.
1,	Vazão Especificada
Quando a vazão for especificada ( vazão constante ), a pressão de fluxo de fundo em cada iteração é calculada usando as propriedades de rocha e fluidos, da iteração anterior. 0 cálculo da pressão de fluxo de fundo, é feito com base nas propriedades de um bloco cilíndrico que se comunica, com o poço. Devido às dimensões reduzidas destes blocos e o fato do poço ter condutividade infinita, este procedimento mostrou-se perfeitamente aceitável, pois testes para o cálculo de pwf com todos os blocos comunicante com o poço, deram resultados praticamente iguais. Assim, usando o primeiro bloco teremos:
pwy —	7í&gt;l/2,
cri k
(5.8)
Nesta equação o subíndice	significa que a propriedade é tomada no ponto
nodal e (1/2, j, k) na face do poço. Qoltj¿ é a vazão do bloco (1, j, k), que é a vazão total especificada ponderada de acordo com as transmissibilidades das faces produtoras, ou seja, para um determinado j e k:



(5.9)
1
A transnaissibilidade na face do poço é dada por:
rT'	__ 17 I?	™T(A,},k
10X']/2,j1fc ” 7 rsl/2,j,í:'	n
fíõ1/2,j&gt;kJ:^/2j,k
(5.10)
e o fator de forma na face do poço é dado por:
/2,j,k ~~
¿XOj&amp;amp;Dk
i lnri&gt;í’k kl,},k
(5.11)
2. Pressão de Fluxo de Fundo Especificada
Quando a pressão é especificada, a vazão é determinada pelo somatório das vazões de cada bloco em comunicação com o poço:
nz
= EE Qoi,i¿ í=ifc=i
(5.12)
onde:
Q^lJ,k — r^'oxlj1klpol,3¡k PWJ 'Yol/2,j,k(Dph
é a vazão de óleo de cada bloco cilíndrico em comunicação com o poço. Na equação 5.12 ny e nz são o número de blocos da malha cilíndrica nas direção y e z, respectivamente.
3. Vazão de Gás e Agua
Em todos os casos simulados a pressão em qualquer bloco sempre estará acima da pressão de saturação, assim a vazão de gás será dada por:
ny m
ny nz
Qs — EL
&amp;amp;=1
(5-14)
A vazão de água será obtida através das razoes de mobilidades:
ny ni
Qw^
nj/ «5	\
&gt;1 fc=l
as mobilidades do óleo e da água são definidas como:
1	__ "'rol,j,fc
“o
(5.16)
(5.17)
Este procedimento para o cálculo das condições de produção é usado tanto para o modelo totalmente acoplado como para os modelos desacoplados, isto proporciona a vantagem da não utilização de modelos de poço.
5.6	Derivadas
Conforme visto anteriormente, a solução do sistema com a aplicação do método de Newton Raphson, exige a determinação das derivadas das funções de resíduos do óleo e da água em relação as variáveis primárias para todos os blocos e seus vizinhos. As derivadas das funções de resíduos - termos de fluxo e termos de acumulação - dos termos fontes e todas as hipóteses consideradas para sua determinação sao apresentadas no anexo A.
5.7	Controle Automático do Tempo
0 tamanho do time step deve ser selecionado de forma adequada a garantir a estabilidade da solução e erros de truncamentos aceitáveis, ( Aziz e Settarb30) ). Esta seleção pode ser feita com base na comparação entre as máximas variações da pressão e da saturação ocorridas num bloco, com valores limites pré-estabelecidos, de pressão ( DPLIM) e saturação ( DSLÍM), que são fornecidos como dados de entrada.
No programa são calculadas as variações máximas para os blocos, que podem
ser representadas por:
DSMAXn max{XtS^k}
DPMAXn = m^fA^}
(5.18)
(5.19)
Caso DSMAX e/ ou DPMAX excedam os valores limites, um novo valor para Atn+Í será calculado, conforme:
Aís = At"
DSLIM
DSMAX'1
(5.20)
ou

A n DPL1M
Aí”------
DPMAXn
(5.21)
Assim o tamanho do novo time step será:
Atn+1 = min{ AC, Aíp}	(5.22)
Quando as variações de pressão e saturação estão dentro dos limites estabelecidos, o controle do time step é feito pelo número de iterações Newtonianas. Assim estabelece-se um número mínimo ( ITMIN) e um número máximo ( ITMAX) de iterações. O novo time step será estabelecido da seguinte forma:
número de iterações &amp;lt;ITMIN -+ Aín+1 = 1.5Aí”
ITMIN &amp;lt;número de iterações &amp;lt;ITMAX —* Atn+1 — Xtn
número de iterações &gt; ITMAX —+ Atn+1 = 0.5Aí71
6	VALIDAÇAO DO MODELO
A validação foi feita através da comparação dos resultados obtidos dos modelos desenvolvidos com as soluções analíticas desenvolvidas por Odeh e Babu íl3) para o drawdown em um poço horizontal com fluxo de uma fase.
6.1	Solução Analítica
As análises para a descrição do comportamento do fluxo monofásico, apresentadas por alguns pesquisadores í11-17), mostram que para um poço horizontal podem acorrer até quatro regimes de fluxo transientes distintos, que tem sua existência e duração como função das características do reservatório - dimensões e forma - características da rocha, fluido e do poço horizontal - raio, comprimento e localização dentro do reservatório.
As soluções analíticas usadas para a validação, consideram o fluxo de um fluido levemente compressível e sem considerar o efeito gravitacional. Assume um poço horizontal com condutividade infinita, raio rw e comprimento L, perfurado paralelamente a uma das faces de um reservatório fechado. As dimensões do reservatório são, espessura; h, comprimento ( direção x ); a, largura ( direção y, paralela ao poço ); b. O poço horizontal com coordenadas do início e fim definidos respectivamente por (a-’o&gt;yi!^o) e (j:q, y?, ¿o)-O modelo físico e os parâmetros usados nas fórmulas analíticas estão representados na figura 6.1.
Conforme mencionado anteriormente, o transiente completo para um poço horizontal apresenta quatro regimes distintos: 1) Radial inicial, 2) Linear inicial, 3) Pseudo radial tardio e 4) Linear tardio. A representação esquemática das linhas de fluxo em cada regime são apresentadas na figura 6.2.
As equações que regem o comportamento da pressão do fluxo monofásico para produção com vazão constante, e os tempos de inicio e fim para os quatros regimes de fluxos , são apresentados a seguir:
1.	Regime Radial Inicial
Figura 6.1: Representação do modelo físico
Fígura 6.2: Representação das linhas de fluxo dos regimes do transiente
4D
t.nd = 0.4744^^ ¡kz
(6.1)
ou
l.,j. =&amp;lt;¡.03'¿QL2i/&gt;iicí/ky
(6-2)
Devido à curta duração, este período pode ser mascarado pelos efeitos decorrentes do início do primeiro fluxo. Em adição , a não consideração do efeito gravitacional pode distorcer os resultados.
O comportamento da pressão é dado por:

Puf = pi~
0.1833gpB
+ 0.3492 +0.87^)
(6-3)
Para este regime um gráfico semi-log de [(p; — pwj) = Ap] vs i dará uma linha reta com inclinação m, dada por:
.	. 0.1833gpB
(6.4)
2.	Regime Linear Inicial
Este regime ocorre no período em que o transiente de pressão é influenciado somente pelos limites inferior e superior do reservatório, e ocorrerá se o comprimento do poço for significativamente maior que a espessura do reservatório, e se a contribuição do fluxo nas pontas do poço for desprezada. A duração deste período é dada aproximadamente por:
O comportamento da pressão é dado por:
(6.7)
Para este regime um gráfico de (p¿ — pTO/) vs \A dará uma linha reta com inclinação m, dada por:
■\Z^fictkxLh
(6.8)
3. Regime Pseudo Radial Tardio
Se a espessura do reservatório nao for suficientemente grande quando comparada com a largura, este regime pode não ocorrer. Também é necessário que razão de penetração, definida por L/è, seja menor que 0.45. O início deste período ocorre
para:
tatart ~ Q.39W)L?$¡lCt/kv
(6.9)
e o final para o menor valor abaixo:
t^d - 0.5271	+ L/4)2/k9
(6.10)
ou
tend =
(6.11)
0 comportamento da pressão é dado por:
t	i Rir7-.
+0,25/71“ - Insen—- 1.838 + 5O)]
Kz	11
(6.12)
Para este regime um gráfico semi-log de - pwí) vs i, é uma linha reta com inclinação m, dada por:
0.1833çpB
(6.13)
4. Regime Linear Tardio
Este período ocorre após o transiente de pressão ter atingido os limites do reservatório nas direções y e z e o comportamento nestas direções se tornará do tipo pseudo permanente. E análogo ao fluxo linear que ocorre para uma fratura vertical, com uma queda de pressão adicional resultante da penetração parcial nas direções y e z, Se o reservatório for infinito este período poderá não ocorrer. O início deste período é dado pelo menor valor abaíxo:
i3tart = 1.2&amp;amp;5Q^pct(Dv + L/4)2/^
(6.14)
Istart = 0.4744£&gt;^/xcf/^
(6.15)
o final é dado por:
fend 0.4348^/íCíd')./tI
(6.16)
h
O comportamento da pressão é dado por:
Pluf
Pi -
0.5646^.0
bh
[Vt^pCikx +
0.2803À
(Zn— _p 0,25/u" + A	C
, 180°^o
—brisen—j----- 1,838 -f- so)]
Para este regime um gráfico (p¿ — pwj) vs y/t é uma linha reta com inclinação m. dada por:
0.5646gpB yf (^pCtJCgbh
Em seu artigo Odeh e Babu observam que a ocorrência dos quatro regimes de fiuxo podem não ser garantida. Assim, devemos nos preocupar em que a duração de um regime particular seja suficientemente longa para que as análises possam ser conclusivas, A permeabilidade, volume drenado, forma do reservatório, o comprimento e a localização do poço, afetam em diferentes graus a duração de cada período de fluxo. Podem ocorrer situações em que nao ocorram nenhum dos quatro regimes de fiuxo transiente.
6.2	Simulação dos Testes
Para demonstrar a validade do modelo desenvolvido, foi feito primeiramente, a comparação entre os resultados analíticos e numéricos para o comportamento da pressão no drawdown para o caso de um poço horizontal totalmente penetrante. Posteriormente, foi feita a determinação da permeabilidade, individualmente para cada período do regime transiente e comparação com os valores usados na simulação.
Os principáis parámetros utilizados em todos os casos simulados foram os mesmos apresentados por Odeh e Babu&lt;13) e são apresentados na tabela 6.1.
6.2.1	Comportamento da Pressão no Drawdown
Conforme mencionado anteriormente, foi escolhida uma situação para a comparação do comportamento da pressão obtidos numérica e analíticamente. Esta situação
Parâmetro	Valor
Vazão (wPstd/d)	127.2
Viscosidade (Pa.s)	1.0 x 10~3
Fator volume de formação (m3res/m3std)	1.25
Raio do poço (m)	0.08
Pososidade (fr)	0.20
Compressibilidade total (Pa~])	2.18 x 10~9
Skin	0.0
Permeabilidade absoluta (m2)	4.94 x 10~14
Tabela 6.1: Parâmetros usados na validação
é a simulação da produção de um reservatório produzindo através de um poço totalmente penetrante e cujo objetivo é verificar os resultados numéricos sujeitos à influência da mudança da forma de simulação do fluxo na direção a', ou seja, em direção ao poço, a representação do fluxo passa de linear para radial.
As características do reservatório, malha utilizada e os períodos de ocorrência de cada regime são apresentados nas tabelas 6.2 e 6.3. E a comparação entre a solução analítica com os resultados obtidos pelo modelo numérico é mostrada na figura 6.3.
Da análise deste gráfico, conclui-se que é boa a concordância entre os resultados. Havendo um pequeno desvio entre as curvas logo no inicio, que é devido aos efeitos iniciais da entrada em produção e a não consideração do efeito gravitacional nas fórmulas analíticas, e outro desvio após o término do regime radial inicial - similar a um pseudo skiii - que é causado pela diferença entre os volumes dos blocos da interface da malha cilindrica com a cartesiana. Este ultimo efeito pode ser reduzido com uma discretizaçao mais refinada e com variação mais suave entre os volumes dos blocos externos da malha cilíndrica e os blocos contíguos da malha cartesiana. Devido as limitações de computador, isto nao foi possível neste trabalho.
Figura 6.3: Comparação entre a solução analítica e a numérica
Características	
Comprimento do reservatório (m)	1050.0
Largura do reservatório (m)	500.0
Espessura do reservatório (m)	50.0
Comprimento do poço (m)	500.0
Malha cartesiana	
Número de blocos na direção x	21
Número de blocos na direção y	1
Número de blocos na direção z	1
Malha cilíndrica	
Número de blocos na direção r	20
Número de blocos na direção 0	4
Número de blocos na direção z	1
Tabela 6.2: Características do reservatório e malha
Regimes	tempo (hr)	
	início	fim
Radial inicial	—~	0.73
Linear inicial	0.73	25.82
Pseudo radial tardio	—	—
Linear tardio	48.41	293.5
Tabela 6.3; Duração, em horas, dos regimes transiente.
6.2.2	Determinação da Permeabilidade
Para a determinação da permeabilidade através dos resultados numéricos, e posterior comparação com os utilizados na simulação, foram escolhidos reservatório com dimensões particulares, nas quais os diversos regimes de fluxo transiente tenham duração suficiente para as análises individuais.
1.	Regime Radial Inicial
Os principais parâmetros usados para o regime radial inicial foram:
Q — 50 m3sid/ d
kz = ky =	9.869 x 10”15m2 ( 10 md)
a = 550 m
b = 500 m
h ~ 50 m
L ~ 500 m
&lt;4 = 250 m dz — 25 m
A malha usada foi: cartesiana; llxlxl e a. cilíndrica; 10x4x1. Para o reservatório com as dimensões acima, segundo a equação 6.1 ou a 6.2 o final do regime radial inicial ocorrerá para ien{¡ — 3.63/ir. O gráfico de Apw/ vs logt é mostrado na figura 6.4, do qual obtem-se uma reta com inclinação de m = 26.88/1 Pa/ciclo, e através da equação 6.4, obtem-se a permeabilidade de 9.849 x 10“15 m2 (9.98 md).
2.	Regime Linear Inicial
Para o regime linear inicial não foi feita a determinação da permeabilidade, pois a duração deste regime é muito pequena e ocorre para situações muito particulares.
3.	Regime Pseudo Radial Tardio
Para a validação do regimes pseudo radial tardio, foi encontrada certa dificuldades, pois o simulador desenvolvido faz o uso intensivo de matrizes de quatro dimensões ( três dimensões para as três direções, e uma para cada reservatório; cilíndrico e cartesiano ), isto exige grande capacidade de memória de computador e como estamos trabalhando com micro computador ficamos limitados ao refinamento ( número de blocos ) da malha. O maior refinamento areal da malha conseguido foi de 7x7x1 para o cartesiano e para o cilíndrico. Para se conseguir um tempo suficientemente longo para as análises do regime em questão é necessário uma malha mais refinada nas direções x e y.
Mesmo limitado ao pequeno número de blocos, fizemos dois testes, que mesmo não dando uma grande duração para o regime pseudo radial tardio, mostra que os resultados do modelo são coerentes com as deduções analíticas.
Os principais parâmetros usados foram:
Q = 50 msstd/ d
a = 350 m
b = 350 m
h — 50 m
Dx ~ Dy = 75 m
Dz = 25 m
Foi feita a simulação com o uso de dois valores de permeabilidade:
9.8690 x 10"í5 m2 ( 10 md ) e 1.9738 x IO"1’1 m2 ( 20 md ).
Para estas condições, o regime pseudo radial tardio tem a seguinte duração: tatari = 11.94 hr e tend = 163.00 hr. Os gráficos de Ap vs logt, para as permeabilidades de 9.8690 x 10~ls m2 ( 10 md ) e 1.9738 x 10~14 m2 ( 20 md ), são apresentados respectivamente, nas figuras 6.5 e 6.6. Nestes gráficos notamos que, apesar do regime não ter longa duração, se tomarmos a inclinação da reta logo após o término do regime radial inicial ( visto que neste caso nao há ocorrência do regime linear inicial ), serão obtidas as seguintes inclinações: m — 25Q.QK Pa/ciclo em ~ 125 Kpa/ciclo. Usando estes valores na equação 6.13 obtem-se aproximadamente permeabilidades de 9.8690 X 10“15m2(10md) e 1.9738 x 10~1,sm2(20md).
4.	Regime Linear Tardio
Para o regime linear tardio os parâmetros usados foram:
Q — 50 m3std/d
kx — ky = kz = 9.869 x 10"15m2(10md)
a — 1350 m
b ~ 500 m
h, — 50 m
L ~ ÕQQ m
Na figura 6.7, é representado o gráfico de A/3 vs y/t, da qual obtem-se uma reta com inclinação m — lòSkPaJhr^2, que aplicada, a equação 6.18 resulta numa permeabilidade de 9,671 x 10“15m2(9.8md),
Tempo (horas)
T
■J d
-i
Je
T”i—|——nr
□near tmcíol
■i i	s—up
10
o
[ I F I ‘ I I i I t |
20	30
Tempo^2 (hr1'/2)
1 i !
40
50
7	ANÁLISE DOS RESULTADOS
0 objetivo deste capitulo é a apresentação e análise dos resultados da simulação do comportamento de um reservatório produzindo através de um poço horizontal e dos métodos usados para esta simulação. Esta análise foi feita em duas partes: na primeira, são apresentados os resultados do simulador totalmente acoplado, com o sistema linear de equações resolvido por método direto e iterativo (BSOR) e a malha cilíndrica que representa a região do poço com diferentes refinamentos angular e radial. Na segunda parte foi feita a comparação entre os resuldados obtidos pelos modelos que usam o método totalmente acoplado e os desacoplados.
Os dados de simulação, condições de produção e as características do reservatório que foram usados na simulação são apresentados na tabela 7.1. Enquanto que os dados das análises PVT do óleo, gás e água e os dados das análises petrofísicas são apresentados no anexo B.
Voltamos a salientar que devido ao uso de micro computador as malhas simuladas não tem grande refinamento, mas foram o suficiente para que as análises fossem conclusivas.
7.1	Modelo Totalmente Acoplado
7.1.1	Comparação entre os Métodos de Solução
O programa computacional desenvolvido prevê a solução da matriz Jacobiana por método direto ou iterativo. Para efeito de investigação, a solução com método direto foi feita de duas formas: a primeira forma foi a utilização da. eliminação de Gauss normal com a matriz completa - trabalhando inclusive com os elementos nulos - e a segunda é através da utilização do algoritmo ( NSPIV34 ), também baseado na eliminação de Gauss, que trabalha somente com os elementos não nulos. Para os casos simulados pode-se fazer as seguintes observações:
Parâmetros de Simulação	Unidade	Valor
Tolerância para pressão	Pa	3447.40
Tolerância para saturação	fr	0.0010
Máxima variação da saturação num time slep	fr	0.0500
Máxima variação da pressão num time step	kPa	689.48
Incremento de tempo máximo	dias	10.00
Incremento de tempo mínimo	dias	0.0010
Número máximo de iterações no Jacobiano		5
Número mínimo de iterações no Jacobiano		2
Dados de produção e poço		
Vazão de óleo máxima	m3/dia	300.00
Vazão de óleo mínima	m3/dia	15.00
Pressão de fluxo mínima no poço	MPa	30.00
Raio do poço	771	0.10
Cota do poço	fn	-2560.00
Dados do reservatório		
Saturação inicial de água	fr	0.12
Compressibilidade da rocha	MPa"1	0.440 x 10“3
Pressão inicial do reservatório	M'Pa	35.00
Cota do contato óleo/água	m	-2585.00
Permeabilidade absoluta (z,y e z)	m2	49.3 x 10“13
Porosidade	fr	0.30
Tabela 7.1: Parâmetros Usados na Simulação
•	Tempo de execução - o algoritmo otimizado trouxe uma. redução média de até 60% no tempo de simulação, em relação a eliminação de Gauss com a matriz completa;
•	Area de memória * A primeira vista pode-se pensar que o método otimizado traria uma redução de memória necessária, mas isso nao ocorre, porque apesar de não necessitar de armazenar toda a matriz, o algoritmo trabalha com vetores auxiliares que são tão maiores quanto for a esparsídade da matriz, ou seja, a distância entre os elementos que representam as interfaces e a diagonal principal.
O método iterativo usado foi o de sobre-relaxação sucessiva por blocos (BSOR),e para as situações simuladas notou-se que esse método é desvantajoso, em relação ao método direto, quanto ao tempo de simulação. Para, que os resultados fossem aceitáveis, a tolerância usada no processo iterativo do sistema linear de equações não pôde ser menor que 10~5.
A vantagem desse método é em relação a pequena área de memória necessária., assim para problemas com grande número de blocos passa a ser atrativo.
Para a situação de um poço horizontal totalmente penetrante num reservatório de 300 x 150 x 150m, representado por uma malha cartesiana de 3 x 3 x 1 e uma malha cilíndrica de 3 x 4 x 1, o fator de sobre-relaxação que proporcionou um menor número de iterações foi de aproximadamente 1.15, conforme pode ser visto pela figura 7.1
7.1.2	Refinamento Radial
O objetivo é verificar a influência do refinamento da malha cilíndrica na direção radial, sobre o comportamento da produção em duas situações: a primeira, com o poço totalmente penetrante e a segunda com poço parcialmente penetrante.
» Poço totalmente penetrante -
Nesta primeira situação o refinamento radial influi somente na malha cilíndrica, já que nao há mudança do número de interfaces cilindro/cartesiano nas direções x e y. Os resultados do comportamento da pressão de fluxo e vazão de óleo são apresem tados respectivamente nas figuras 7.2 e 7.3. Observa-se que para o comportamento da pressão para vazão constante, os resultados são iguais para os três refinamentos. Há uma diferença entre os tempos de chegada a pressão de fluxo e a vazão mínima; quanto maior o refinamento mais rápido serão atingido estes tempos.
A produção de água em todos os casos foi insignificante, e como não houve diferenças para, este caso, torna-se desnecessário a apresentação dos gráficos.
* Poço parcialmente penetrante:
As dimensões do reservatório foram: 300 x 150 x 300m com malha cartesiana de 3 x 3 x 3 e malha cilíndrica de 2,3,5 x 4 x 1.
Nesta situação há variação do número de interfaces na direção z. Quanto maior o refinamento, maior será o número de elementos de interfaces na matriz Jacobi-ana. Os resultados do comportamento do reservatório com a produção de um poço horizontal centrado com 100 m de comprimento, são apresentados nas figuras 7.4;
versus tempo, figura 7.5; vazão de óleo versus tempo, figura 7.6; vazão de água versus tempo e figura 7.7; razão água/óleo versus o tempo. Pelo gráfico de pwf vs t nota-se que há uma pequena diferença entre as pressões para os diferentes refinamentos. Nesta situação, a produção de água já é significativa, sendo maior para malha com menor refinamento, conforme pode ser visto pela figura 7.6 e 7.7. Isto pode ser explicado pelo fato de que para um maior refinamento a distribuição da saturação de água é mais homogênea.
7.1.3	Refinamento Angular
Para este caso, foi estudado o comportamento da produção de um poço totalmente penetrante com a malha cilíndrica sendo dividida em 4 e 8 partes na direção angular. Quando
Na figura 7.8 sao apresentadas as curvas de pwj vs t. Nota-se que o comportamento é igual era todos os casos. O comportamento da vazão de óleo cora tempo é apresentado na figura 7.9, na qual nota-se que há uma tendência de redução do tempo de produção para malhas mais refinadas, quando a vazão de produção é variável e pequena. Neste caso a produção de água , também foi insignificante.
Deve ser observado, que se ocorresse a produção significativa de urna segunda fase, haveria diferenças no comportamento para os diferentes refinamentos angulares, pois a distribuição de saturações nos dois casos seriam diferentes.
7,2	Comparação entre o Acoplado e os Desacoplados
Um dos principais objetivos desse trabalho é a comparação entre os resultados do simulador totalmente acoplado e os desacoplados - que fazem o acoplamento numa iteração ou num time step. Pelos casos simulados, podem ser feitas as seguintes observações:
•	tolerância - Para os desacoplados, deve-se tomar certos cuidados com uma tolerância ’’folgada” no processo de convergência do Newton-Raphson. Pois como é um processo que usa os termos de fluxo, da iteração ou do time step anterior da malha cartesiana., como influxo nas fronteiras externas da malha cilíndrica, pode haver problemas de balanço de materiais nos blocos da malha cilíndrica.
•	Tempo - O tempo de simulação é menor para os modelos desacoplados.
•	Capacidade de memória - A grande vantagem dos modelos desacoplados é em relação à menor área de memória necessária ao processamento. São armazenadas somente as matrizes Jacob!anas referentes às duas malhas - que a depender do algoritmo
Os resultados para um reservatório de 250 x 250 x 600m com uma malha cartesiana 5x3x1 e malha cilindrica de 3x4x1, para um poço totalmente penetrante, podem ser vistos ñas figuras 7.10, 7.11 e 7.12. Através destes gráficos nota-se que no período em que a vazão de óleo é constante, os resultados dos desacoplados coincidem e existe uma pequena diferença deles para o totalmente acoplado. A outra diferença notada, é que quando o acoplamento é feito num time siep há. tendencia, de ser um pouco maior o tempo de produção . quando a pressão de fundo é constante e a vazão é baixa.
TTTTT~rn~TTTh | i i i ! 1 iTTTTTTm H í i | ! h i i'i~rrrrTT"H i i i i ! p i i i i i^'T^-[-Tí,Tn"nn~T7TT~TT-rTT~n~
1.00	1.10	1.20	1.30	1.40	1.50	1.60	1.70	1.80
Fator de Sobre— Reloxacao (w)
Tempo (dias)
4 O U	i' s' i s í i rr-t i i rrrrrTTTTrrn-r~r~o-rnn^nrrT^TT-ttt

-G42-----fr
o ¿do
-£&amp;amp;
OD o-
-fr-fr


j
□-
&lt;■ NXR
-a NXR

0	20	40	60	80
Tempo (días)
-r"| 'i i t ■ i i t i i [ [■ i t j ■] r"i TT r
100	120	140
Tempo (dias)
Figura 7.4: Refinamento radiai ( caso 2 ) - Pwf versus tempo
Tempo (dios)
TT"r~T~TT^-í~&gt;l IHII	t f 3 t I M I' r I' 1' r M i M 1 M M I M 1 I I I i M I I
SxíjSxl
2 Q -prrr-r-rrT i i ¡ s n"r~rT~T"T t : ; s rrr-rTT i ¡ í ¡ s ■, ■■■r--[—r-T—f ■ ! ¡ t i i 'i'i"rr~[~rTT~i hih |H''rr~r~T~7~7~rT~
0	20	40	60	80	100	120	140
Tempo (dios)
Tempo (dias)
Tempo (dios)
U. O -7 r~i~r Him "rrmTi' ■[ f ■rrrTrrrTi' 1 &gt; 11 1 1 s 1 1 i1 rr 1 r 1 t rr~T~T'i ; i ! r r 1-y n~n~m i 1 ¡ ! rr
20	40	60	80	100	120	140	160
Tempo (dios)
7 9	|—r~[-r-T"r-Rn im| rn-1~rr-rl-T-n híiíh , ■|..p-rT-rl--r-1~T-1.. r r r ; ; [ $ i i i
0	50	100.	150	200	250	300
Tempo (dias)
350 -q—r"s i i i ; i—i—i i i 'i"i—i i r	¡	¡■ ■■■; |...-r-1--r~r-T~7--í■■ r	,—t , , F ■ ■ ■r...r..r--lr.
50	100	150	200	250	300
Tempo (dias)
1 b D . 0	—!—í—I—!“'1—r-1—s--!—I—I—)—!—í—I—I—!—I—[—I—1—i—I ■ 1 ■ V—r ■ 1 ■ ! '"T~T~1 ' I ' 1 ' ■i~T~T~l—I—I—1—1—1—r-r~r~r^T~r*T
■ 3
2
1
Poco no bioco 1
Tempo (dias)
3 D	i r—i—i—r-T"T”~T i~~i ! ¡ i i rm—i r~'r i ' i i i f r r-1 i—i—i—i—í—;—í—i—i—i—i—r
t~t~t i i i vttvi i i ! ! ■ tt~r~'rr i [ ! i i■ ■ i—i—i—t—t~t~ 40	60	80	100
Tempo (dias)
f-í 0 U J” i T T i r*i~~r	j í	i t~~r~r~~j * ? y—s	f	¡—r
&lt;&gt;
-a---------et—e-
©■■&amp;amp;-e-&amp;amp;-o Poco corri 300 m
Poco coro 200 m
M-írtrt poco com 100' m
3x4x1,2,3
-f-Y—(—f—■- I ■■} ; 'T—j—r.-T~r~T—n-r i [ j j—I—I—] 1 'I
20	40	60	■	80
Tempo (dias)
1"!—!—i—(—1—!’
roto
Pace
Poco
cam 300 m
corrí 200 m
y
3x4x1.2.3
100
Ternpo (días)


Figura 8.7: Perfil vertical de saturação de agua
9 CONCLUSÕES E RECOMENDAÇÕES
As principais conclusões obtidas no desenvolvimento deste trabalho foram:
•	Poço horizontal;
“ Com o avanço das técnicas de perfuração e completação, a utilização de poços horizontais surge como alternativa viável para a drenagem de reservatórios, onde a utilização de poços verticais convencionais é comprovadamente ineficaz.
•	Refinamento local de malha e decomposição de domínios:
— São ferramentos muito úteis, que podem ser utilizadas para economizar tempo e memória computacional, não só para a simulação de poços horizontais mas também para a representação de qualquer fenômeno localizados.
•	Modelos desenvolvidos:
-	Tanto o modelo totalmente acoplado quanto os desacoplados - com acoplamento na iteração e no time step - fazem a representação do comportamento de reservatório com poço horizontal e da geometria do fluxo ao redor deste, de forma adequada e econômica;
— Nos modelos desacoplados deve-se ter atenção especial com as tolerâncias usadas no processo de convêrgencia;
-■ O modelo totalmente acoplado tem maior aplicação em problemas que podem ser representados por malhas grosseiras;
-	Os modelos desacoplado podem ser implementados em simuladores convencionais.
•	Métodos de solução do sistema linear de equações:
-	A utilização de métodos de solução de matrizes esparsas que trabalhem somente com os elementos não nulos trazem significativa economia de tempo;
Como recomendações para o aprimoramento deste trabalho, sugerimos:
•	Adaptação dos modelos desenvolvidos para, computadores de grande porte, para simulação de malhas com maior refinamento;
•	Adaptação de malhas esféricas para a representação do fluxo nas pontas do poço;
•	Pesquisa de algoritmo mais otimizado para a solução de matrizes esparsas com elementos de interface de malhas.
10 REFERÊNCIAS
10.1	Poços Horizontais
1.	Giger, F. M.,Reiss, L. H. and Jourdan, A. P., “The Reservoir Engineering Aspects of Horizontal Drilling”, paper SPE 13024 presented at the 59th Annual Technical Conference and Exhibition, Houston, September, 1984.
2.	Giger, F. M., “ Horizontal Wells Production Techniques in Heterogeneous Reservoirs ”, paper SPE 13710 presented at the Middle East Oil Technical Conference and Exhibition, Bahrain, March, 1985.
3.	Reiss, L. H., “Horizontal Wells’ Production After Five Years”, paper SPE 14338 presented at the 60th Annual Technical Conference and Exhibition of the SPE, Las Vegas, September, 1985.
4.	Giger, F. M.,“ Analytic 2-D Models of Water Cresting Before Breakthrough for Horizontal Wells”, paper SPE 15378 presented at the 61th SPE Annual Technical Conference and Exhibition, New Orleans, October, 1986.
5.	Chaperon, L, “Theoretical Study of Conning Toward Horizontal and Vertical Wells in Anisotropic Formations: Subcritical and Critical Rates”, paper SPE 15377 presented at the 61th SPE Annual Technical Conference and Exhibition, New Orleans, October, 1986.
6.	Sherrrard, D. W., Brice, B. W. and MacDonald, D.G., “Application of Horizontal Wells at Prudhoe Bay”, paper SPE 15376 presented at the 61th SPE Annual Technical Conference and Exhibition, New Orleans, October, 1986.
7.	Karcher, B. J., Giger, F. M. and Combe, J., “Some Practical Formulas to Predict Horizontal Well Behavior", paper SPE 15430 presented at the 61th SPE Annual Technical Conference and Exhibition, New Orleans, October, 1986.
8.	Lee, S. H.,“Analysis of Produtivity of Inclined Wells and its Implication on Pinite Difference Reservoir Simulation”, paper SPE 16002 presented at the Ninth Symposium on Reservoir Simulation , San Antonio, February, 1987.
9.	Kossack, C. A.,Kleppe, J. and Aasen, T., “Oil Production from the Troll Field: A Comparison of Horizontal and Vertical Wells”, paper SPE 16869 presented at the 62th Annual Technical Conference and Exhibition of SPE, Dallas, September, 1987.
10.	Joshi, S. D., “Augmentation of Well Produtivity With Slant and Horizontal Wells”, paper SPE 15375 presented at the 61th SPE Annual Technical Conference and Exhibition. New Orleans, October, 1986.
11.	Goode, P. A., Thambynayagam, R. K. M., “Pressure Drawdown and Buildup Analysis Wells in Anisotropic Media”, paper SPE 14250 presented at the 1985 SPE Annual Technical and Conference and Exhibition in Las Vegas, Sept. 22-25.
12.	Lara, A. Q., ”Estudo do Comportamento Transients de Pressão em Poços Horizontais”, tese de mestrado, Universidade Federal de Ouro Preto, março, 1986.
13.	Odeh, S. A., “Transient Flow Behavior of Horizontal Wells: Pressure Drawdown and Buildup Analysis”, paper SPE 18802 presented at the 1989 SPE California Regional Meeting, April 5-7.
14.	Chang, M. M., “Simulation of Production from Wells With Horizontal-Slanted Laterals”, Final Report, IIT Research Institute National for Petroleum and Energy Research, Bartlesville, Oklahoma, March, 1989.
15.	Babu, D. K., Odeh, A. S., ’’Productivy of a Horizontal Well”, paper SPE 18298, presented at the SPE Annual Technical Conference and Exhibition, Houston, October, 1988.
16.	Ozkan, E., et al, ’’Horizontal-Well Pressure Analisys”, paper SPE 16378, presented at the 1987 SPE California Regional Meeting, April, 1987.
17.	Clonts, M. D., Ramey, H. J., ” Pressure Transiente Analysis for Wells with Horizontal Drainholes ”, paper SPE presented at the 56th California Regional Meeting in Dokland, C.A., April, 1986.
10.2	Refinamento local
18.	Akbar, A., et al, ’’Numerical Simulation of Individual Wells in a Field Simulation Model”, paper SPE 4073 presented at the SPE-AIME, 47th Annual Fall Meeting, San Aantonio, October 1972.
19.	Rosenberg, D., “Local Mesh Refinement fo Finite Diference Methods”, paper SPE 10974 presented at the 57th Fall Technical Conference and Exhibition of the SPE, New Orleans,1982.
20.	Quandale, P. and Besset, P., “The Use of Flexible for Reservoir Modeling”, paper SPE 12239 presented at the SPE Symposium on Reservoir Simulation , San Francisco, November, 1983.
21.	Heinemann, Gerken, G. and HantelmannM, G., “Using Local Grid Refinement in a Multi pie-Application Reservoir Simulator”, paper SPE 12255 presented at the SPE Symposium on Reservoir Simulation , San Francisco, November, 1983,
22.	Pedrosa, O, A., “ Use of Hybrid Grid in Reservoir Simulation ” Tese de Doutorado, Stanford University, December, 1984.
23.	Forsyth, P. A. and Sammon, P. H.,“Local Mesh Refinement and Modelling of Faults and Pinchouts”, paper SPE 13524 presented at the SPE 1985 Reservoir Simulation Symposium, Dallas, February, 1985.
24.	Quandale, P. and Besset P., “Reduction of Grid Effects Due to Local Sub-Gridding in Simulations Using a Composite Grid”, paper SPE 13527 presented at the SPE 1985 Reservoir Simulation Symposium, Dallas, February, 1985.
25,	Han, I). K., Yan, C.Z. and Peng, L.T., “A More Flexible Aproach of Dynamic Local Refinement for Reservoir Modding”, paper SPE 16014 presented at the Ninth SPE Symposium on Reservoir Simulation, San Antonio, February, 1987,
26,	Wasserman, M. L.,“Local Grid Refinement fo Three-Dimensional
Simulators”, paper SPE 16013 presented at the Ninth SPE Symposium on Reservoir Simulation, San Antonio, February, 1987.
27,	Ewing, R. E., Boyet, B. A. and Babu, D. K./Effient Use of Locally Refined Grids for MultifaseReservoir Simulation”, paper SPE 18413 presented at the SPE Symposium on Reservoir Simulation , Houston, February, 1989,
28- Heinemann, Z. E., Brand, C., Munka, M. and Chen, Y. M., “Modeling Reservoir Geometry With Irregular Grids”, paper SPE 18412 presented at the SPE Symposium on Reservoir Simulation , Houston, February, 1989.
29.	Brand, C., Heinernman, Z. E,, ”A New Iterative Solution Technique for Reservoir Simulation Equation on Localy Refined Grids”, paper SPE 18410, presented at the SPE Symposium on Reservoir Simulation in Houston, February, 1989.
30.	Aris, K, e Settari, A., ” Petroleum Reservoir Simulation”, Applied Science Publisher, 1979.
31.	Peacernan, D. W,, ”Fundamentals of Numerical Reservoir Simulation”, Elsevier Scientific Publishing Co., Amsterdam, 1977.
32.	Crichlow, H. B., ”Modern Reservoir Engeneering - a Simulation Approach", Prentice Hall Inc., Engledwood Cliffs, NJ, 1977.
33.	Dake, L, P., ” Fundamentals of Reservoir Engineering”, Elsevier Scientific Publishing Co., Amsterdam, 1978.
34.	Sherman, A. H.,” NSPIV - A Fortran for Sparse Gaussian Elimination with Partial Pivoting”, The University of Texas at Austin,
Neste apêndice, são apresentadas todas as derivadas e as hipóteses usadas para a solução do problema na forma totalmente implícita.
As equações para o fluxo do óleo e da água são:
Equação para o óleo:
T&amp;amp;m+'l/Z iCpm+r Pm}	¿An-l-1)] 4"
POTOM2
&lt;I'Qm—l/2 KPtb Pm-l) ~	1/2 (^An—1 ~ 7?m)] ~
s 1	.........-v  ...........
POTOMl
“£“([1 + er(po - pon)][l - 5w)òo] - (Sobo}n}ijk +Qo	(A.l)
■---:------------------------------------------
ACO
Equação para a água:
Twm+i/2 [(pm + 1 Pm)	'ywm+l/2^^m ^An-H)] 4“
.. ...........
P0TWM2
[(Pm	Pm—1)	~	—1)	.. ^m)] ”
-.-----------------------/
P0TWM1
-j^--([l + cr(po — pon}](Swbw} - (Sobo)n)ijk +Qw	(A.2)
ACW
Como as equações acima estão escritas de forma simplificadas deve-se observar que:
• Os termos de fluxo devem ser tomados em todas direções, portanto, as transmis-sibilidades devem ser calculadas para todas direções, assim nesta representação m, representa os blocos í,j e fc,
m + 1/2 representa as faces i + 1 /2, j + 1/2 e k + 1/2 e
•	P0TIM2 representa a diferença de potencial de fluxo entre os blocos m e m 4 1. P0TIM1 representa a diferença de potencial de fluxo entre os blocos m e m — 1. Z, pode ser óleo (o) ou agua (w).
M, representa as direções x, y ou z.
•	Como ó usado o esquema totalmente implícito, a maioria das variáveis são calculadas no time step n 4 1, Para simplificar as equações, somente serão colocados os expoentes quando elas estivem no time step n.
•	ACl é o termo de acumulação para o óleo ou a água.
•	p é a pressão na fase óleo.
•	Pe é a pressão capilar óleo/água.
Portanto usando a nomenclatura simplificada as funções de resíduos podem ser escritas:
Óleo:
Po = Tom+1/2POTOM2 - Tom^/2POTOM1 - ACO - Qo	(A.3)
Água:
Fw = Twm+Í/2POTWM2 - Twm~í/2POTWM1 - ACW ~ Qw
(A.4)
Derivadas das Funções Resíduos do Óleo - Fo
L Eni Relação a Pressão ( Equação Geral )
dFo dp
P0T0M2^-^^
dp
4* l\i+l/2
ÔP0T0M2 dp
- POTOM1
Tom..1/2 rr dPOTOMl dACO dQo dp	dp	dp dp
(A.5)
2.	Em Relação a
dFo dpm~i
= —POTOMA
dpm-\
dPOTOMl
dp
(A.6)

3.	Em Relação a, pm
dFo dPm
P0T0M2^-^Ul
dpm
4- Tom+l/2
dP0T0M2
dPm
Tom~l/2	dPOTOMl _ dACO
dpm	QPm	QPm
- P0T0M1
dQo dpm
(A.7)
4.	Em Relação a pm+l
dFo
dpm.+1
= P0T0M2^F±yi
4- Tom+l/2
dP0T0M2 dpm-Vl
(A.8)
1, Em Relação a Saturação ( Equação Geral )
= P0T0M2 oàw
dSw
+ Tom+i/2
dPOTOM2 dSw
To^/2	„ dPOTOMl
dSw	dSw
ÔACO
dSw
- P0T0M1
dQo dSw
(A.9)
2. Em Relação a Swm~i
^- = -P0T0Ml^^
(A.10)
3.	Em Relação a Swm
9Fo
dSwm
POTOM2dT^+i/2 - POTOMl^^- -	+
uSwm	¿ÀSWrrç (jSw^
dQo
dSwm
(A.ll)
4-, Em Relação a Swm+i
dFo dSwm+i
= POTOM2aPm+I/3
(A.12)
Derivadas das Funções Resíduos do Água - Fw
1. Em Relação a Pressão ( Equação Geral )
dFw
dp
P0TWM2
dTwm+y2 dp
+ Twm+l/2
9POTWM2
dp
- P0TWM1
Twm~1/2	dPOTWMl ÔACW ÔQw
dp	m-l/2
2. Em Relação a pm-x
ÔFw dpm~i
= -POTWMl^^ dpm-l
Twm~.2f2
dPOTWMl dp-m-i
(A.14)
3, Em Relação a pm
dFw dpm
POTWM2dT^m+1/2 + Twm+l/2
T- 1/2 dpm
dpm
dPOTWMl
-Tw^1(2
dPm
4. Em Relação a pTO+1
ÔFw dpm+l
= P0TWM2dT™m+^
dPOTWM2
- P0TWM1
dpm
dACW ÔQw
dpm
dpm
(A, 15)
_ dPOTWM‘2
+ J wm+l/2-a
dpm+i
1. Em Relação a Saturação ( Equação Geral )
dFw dSw
= I0TWM2-~l^ + Tw^~~~Js^~ +
-potwmJ-^ -	+
dACW dQw dSw dSw
dSw
(A.,17)
2. Ern Relação a S'wm_3
ÔFw dSwm~!
= ~POTWMlT™m~l/2
rri
— J w
m—1/2
ÔPOTWMl dSwm~i
(A.18)
3. Em Relação a
dFw dSwm
POTWM2^M111 _L Tw SPOTWMZ
1 OTA M2 dS^ + 2 wm+1/2 dSw^ + ÔPOTWMl t
—POIW Ml    1 wm „! M......4-
oSwm
dACW dQw
dSwm + ÕSwm
dSwm
(A.19)
4. Em Relação a Swm+1
dFw dS
^i^ôTwm+1/2 i m 3POTWM2
— P07 WM2—------F Twm+i/2
dSwm+í
(A.20)
Derivadas dos Potenciais em Rei ação a Pressão
P0T0M1 ou 7WIVAH
POTOMX
= (Pm ~ Pm-i ) “ («&gt;7oto + (1 - w)yom^t)]
(Dm-i
(A. 21)

P0TWM1 = (pm - pm^) ~ (Pc™ ~ Pc^ ) +
-[w7wm + (1 - w)7wra_j)](Pm_i - Dm)
(A.22)
dPOTIMl
dPOTIMl
dpm-i
(A.23)
= 1 _	_ Z&gt;„)
$Pm	®pm
(A.24)
dPOTIMl dpm^l
(A.25)
» P0T0M2 ou P0TWM2
P0T0M2 = (Pm+l Pm) - [W7&lt;?m+1 + (1 - w)7Om)]
(Dyn ~ Dm+1)
(A.26)
P0TWM2 = (pm+i -	- (Pcm+1 -	4-
~[w7wm+i + (1 - w)7wm)](Pm - Dm+1)
(A.27)
dPOTIMZ
&amp;amp;Pm-l
(A,28)
ÔP0TIM2 dpm
(A.29)
9POTIM2
&amp;amp;Pm+1
^’y dpm+1
(A.30)
= 1 ~ W

Derivadas dos Potenciais em Relação a. Saturação
• P0T0M1 ou P0T0M2
dP0T0M\,2 __ dPOTOMl.,2 _ dPOTOM 1,2 dSwm_i	dSwm	dSwm+i
» P0TWM1
dPOTWMl
dSWn-i
dPcm-!
dSwm—\
dPOTWMl 9Pcm
dSwm " dSwm
dPOTWMl dSwm+i
» P0TWM2
(A.34)
&amp;amp;P0TWM2 dSwm_!
(A.35)
9POTWM2 __ dPc^ dSwm âSwm
(A.36)
dP0TWM2 dSwm+1
(A.37)
dP Cjn.-í-i
Derivadas das Transmissibilidade
Convenção do sentido de fluxo para, as duas malhas são;
coordenada m	sentido do fluxo	
	A	B
i	contrário ao eíxo x	sentido do eixo x
j	sentido do eixo y	contrário ao eixo y
k	sentido do eixo z	contrário ao eixo z
Derivadas em relação a pressão
As derivadas em relação a pressão são iguais para todos os eixos de fluxo.
qualquer sentido
dTlm+1/2
dPm—l
(A.38)
dpm

1 dblm ^m+l/2 dpm
1 dplm
P^m+1/2 dp Trt
(A.39)
&amp;amp;Tlm+l/2 dpm+1
1 dblm+i
^rn+l/2 dpm^-i
1 dplm+-í p^m+1/2 dpm^.i
(A.40)
dTlm_1/2
dpm^i
= (1

1	dblm—|
bt-rn —1/2 dp^ — l
1/2
(A.41)
arUi/2 dpm
í,	r 1 dblm. J 1 dplr,,_
(1 - W)1	-----[—i-----T—-
(A.42)
dTlm-lpi Q &amp;amp;pm-l
(A,43)
Derivadas em relação a saturação
1. Direção x
(a) Sentido A
derivada	face i — 1/2	face i 4" 1/2
ÕTl	0	0
dSwi—i		
8TÍ	Z7 JT	/ 6/ \	dkrli t—1/21	) 1—1/2 ¿5^	0
dTÍ	0	CE?	. / bl \	. dfcrii+i *—1/2Ç fíj )i-~l/2 J5ttl¿+1
&amp;amp;Swi±i		
(b) Sentido B
derivada	face í-l /2	face i +1/2
ari		0
j		
ari dSllíi	0	1? E?	/ M 'I	ikrit-}
&amp;amp;TI	0	0
deltaSiui+i		
2. Direção y e z
(a) Sentido A
derivada	face m — 1/2	face m + 1 /2
ÕTl	I? L1	. f bl\	.	0
		
3TI SSwm	0	P p	, í bl\	àkrl^
&amp;amp;Ti	0	0
deltaSwm-f.1		
(b) Sentido B
derivada	face m — 1/2	face in 4- 1/2
9TÍ	0	0
		
ST1 9Swm	r? IV	t bí \	dkrl-n, ¿Swm	0
3TI	0	iv r?	f bi \	dkrlm+1 m-H./2l jjJm+1/2
Q$u&gt;m + i		
Derivadas dos Termos de acumulação
Oleo
&amp;amp;ACO Vpíjkf!, t f	ydbo h Z1 n s
1^7 = ”ST&lt;|1 + cr(p - p )](1 - Sw)~ + (1 - Sw)bocr)
(A.44)
dACO
Vpijk
A/
Q1 +cr(p-pn)]6o
(A.45)
Água
dACW _ VPijk
dpíjk
([1 4- cr(p — pn)]Sw
dbw dp
4- Swbwcr)
(A.46)
dACW
dSwijk
^^([1 + cr(p - pn)]bw
(A.47)
Derivadas das VazÓes
A vazao de cada Moco comunicante com o poco é dada por:
Ql = Tl^POTlXl
Óleo
(A.48)
ou,
dQo dpijk

m POTIXA
(A.49)
dQo	nn'ri v i t m	dboijk 1 /¿dljfc .
~— = porixi[wi 01/2M,............................ )	+
dpijk	bo1/2jk Pijk	Ii&lt;hi2jk Pisk
Vpljk
dQo _ DnTjvir tv. {dT^ptik
dSw¿jk POTlXllwT*W&amp;lt;dSwi3k
Para a Agua
(A.50)
(A.51)
dQw
dpijk
Xw	krwbwpo
Qo== -— ----QO
Xo	krobopw
RMIVO
dQo = RMWO^ dpijk
+ Qo
RMWO dpw
(A.52)
(A.53)
Qw ~
onde o temo
í°’ caícu^a(io-

krw po dbw bw (to bwpo bo kroíbopw dp bopw dp bo^pwdp
bwpo pw bopw2 dp
(A.54)
esta equação pode ser escrita de outra forma:
RMWO dpijk
krwbwpo 1 dbw 1 po 1 bo 1 pw
krobopw lbw dp podp bodp pw dp
(A.55)
SRM.WQ
Ôp
portanto mais simplificadamente, teremos:
^ = rmwo[^l + Qo^2]
dpijk	dpijk	dpijk
(A. 56)
Em relação a saturação teremos:
dQw dSwíjk
RMWO
dQo dSw^jk
RMWO d S t?i j ¿
(A.57)
dRMWO bwpo j dkrw	krw dkro
dSwijk	krobopo1 dSwijk	kro dSwijk
(A.58)
Pressão MPa	B, m3/m3 std	Viscosidade cp	Densidade kg/m3	7?.,o rn3 std/m3 std
0.10	1.062	1.040	714.4	0.2
1.82	1.150	0.975	698.2	16.1
3.55	1.207	0.910	678.0	32.1
7.00	1.295	0.830	657.4	66.1
13.89	1.435	0.695	625.2	113.3
17.34	1.500	0.641	614.1	138.0
20.79	1.565	0.594	605.8	165.6
27.68	1.695	0.510	594.0	226.2
34.57	1.827	0.449	584.0	288.2
62.15	2.357	0.203	552.9	531.4
Tabela B.l: Propriedades PVT do óleo saturado
Pressão	Bo	Viscosidade	Densidade
MPa	m3/m3 std	cp	kg/m3
27.68	1.695	0.510	594.0
62.15	1.579	0.740	637.6
Tabela B.2: Propriedades PVT do óleo sub-saturado
Pressão MPa	K m3/m3 std	Viscosidade cp	Densidade kg/m3	R m3 std/m3 std
0.10	1.0410	0.310	997.0	0.0
1.82	1.0403	0.310	997.7	0.0
3.55	1.0395	0.310	998.4	0.0
7.00	1,0380	0.310	999.8	0.0
13.89	1.0350	0.310	1002.7	0.0
17.34	1.0335	0.310	1004.2	0.0
20.79	1.0320	0.310	1005.7	0.0
27.68	1.0290	0.310	1008.6	0.0
34.57	1.0258	0.310	1011.7	0.0
62.15	1.0130	0.310	1024.5	0.0
Tabela B.3: Propriedades PVT da água
Pressão MPa	m3/in3 std	Viscosidade cp	Densidade kg/m3
0.10	0.93576	0.0080	1.0
1.82	0.06790	0.0096	14.3
3.55	0.03523	0.0112	27.5
7.00	0.01795	0.0140	54.0
13.89	0.00906	0.0189	107.0
17.34	0.00727	0.0208	133.5
20.79	0.00606	0.0228	159.9
27.68	0.00455	0.0268	213.0
34.57	0.00364	0.0309	266.1
62.15	0.00217	0.0470	447.7
Tabela B.4: Propriedades PVT do gás
sw	•* *	
0.00	0.0	1.0
0.12	0.0	1.000
0.20	0.075	0.997
0.25	0.125	0.980
0.30	0.190	0.900
0.40	0.410	0.500
0.45	0.60	0.100
0.50	0.72	0.050
0.60	0.87	0.0001
0.70	0.94	0.0
0.85	0.98	0.0
1.00	1.00	0.0
1.10	1.00	0.0
Tabela B.5: Permeabilidades relativas óleo - água
St = sur	PCOU! (Pa)
0.0	50000.
0.12	50000.
0,2	20000.
0,3	10000.
0.35385	5000.
0.40769	2500.
0.46154	1000.
0.51538	500.
0.56923	200.
0.62308	100.
0.67692	50.
0.73077	25.
0.83846	15.
0.89231	10.
0.94615	5.
1.00000	0.0
1.10000	0.0
Tabela B.6: Curva de pressão capilar óleo - água
13 APÊNDICE C - Resultados
13,1 Poço com 300m de comprimento
PROGRAMA ACTION.FOR
TOTALMENTE IMPLICITO
TRIDIMENSIONAL
BI-FASICO ( OLEO/AGUA )
eBXHGIEâlS-eâDQS-UnilZADOS
Parâmetros de Simulacao:
Região do reservatório - GRID
CARTESIANO -
N# de blocos na direcao X	(13)	NXC===&gt;	3
N# de blocos na direcao Y	(13)	NYC===&gt;	3
N# de blocos na direcao 2	(13)	NZC==*&gt;	1
Dim. dos blocos direcao X	(FIO.4)	DBDX===&gt;	100.00
Dim. dos blocos direcao Y	(FIO.4)	DBDY===&gt;	50.00
Dim. dos blocos direcao Z	(FIO.4)	dbdz===&gt;	300.00
N. de blocos produtores	(13)	NBP===&gt;	1
Coord, i do bloco produtor	(13)	ipx==&gt;	2
Coord, j do bloco produtor	(13)	JP===&gt;	2
Coord, k do primeiro bloco produtor Regiao do poco - GRID RADIAL -	(13)	KP===&gt;	1
N# de blocos na direcao X	(13) NX===&gt;		3
N# de blocos na direcao Y	(13) NY===&gt;		4
N# de blocos na direcao Z	, (13	i) NZ===&gt;	1
.001
DT===&gt;
Time step inicial (dias) Tolerancia para pressao (Pa) Tolerancia para saturacao (fr) Max var de sat num DT (fracaa) Max var de pres, num DT (KPa) Vazao de oleo maxima (m3/dia) Vazao de oleo minima (m3/dia) Tempo final de simulacao (dias) Pwf minima no poco (MPa)
Raio do poco (m)
Int. tempo p/ impr.relatorio (dias) Int. tempo p/ impr.gráfica (dias) Int. células de impressao Incremento de tempo máximo (dias) Incrementode tempo mínimo (dias) N# max de iteracoes no JACÜBIANO N# min de iteracoes no JACOBIAND Fatia J base para o calculo de Pwf Dados do teste de formacao:
(F8.3Í
(F8.3) T0LP===&gt;3447.400
(F6.4) T0LS===&gt;
(F6.4)DSLIM===&gt;
(F8.3)DPLIM===&gt;
(F8.3)Q0MAX===&gt;
(F8.3)Q0MIN===&gt;
(F8.2) TSIM===&gt; 5000.00
(F8,3)PWMIN===&gt;
(F8.4) RW===&gt;
(F5.l)TIMPR~-=&gt; (F5.1)TIMPG-==&gt;
(I3)IRIMP==&gt; 1
(F5.1)DTMAX==S=&gt;
(F6.4)DTMIN===&gt; (I3)ITMAX===&gt; (I3)ITMIN===&gt; (13)JPROD===&gt;
.0010
.0500
689.480
300.000 15.000
30.000 .1000 3Q.0 10.0
10.0 .0010
5
2
1
Simulacao de teste de formacao
Vazao de producao (m3/dia)
Tempo de fluxo (horas)
Tempo de estática (horas)
Incr. de tempo no teste (horas)
(S ou N) 0PT===&gt;N
(F8.3) QOTF===&gt;
(F8.3) TPTF=—&gt;
(F8.3) TETF===&gt;
(F8.3) DTTF===&gt;
50.000 24.000 72.000
.500
.8000 .440E-03 35.0000 90.0000
39.894
Temperatura do reservatório (®C) Raio externo da região do poco (m) Cota do poco (m)
Cota do contato o/w (m) Porosidade igual a	.3000 para
Permeabilidade na direcao X igual a Permeabilidade na direcao Y igual a Permeabilidade na direcao Z igual a
Dados do reservatório:
Saturacao inicial de agua (fracao) (F6.4) SWIIí===&gt; .1200
Densidade do gas (adim)	(F6.4) DGAS===&gt;
Compressibilidade da rocha (1/MPa)	(E9.3) CR===&gt;
Pressão inicial do reservatório(MPa) (F8.4) PRIN==&gt;
(F8.4) TEMP===&gt;
(F8.4) RE-==&gt;
(F8.3) ZC===&gt;-2560.00 (F8.3) ZCOW=s==&gt;~2610.00 todos os blocos
50.0000 para todos blocos 50.0000 para todos blocos 50.0000 para todos blocos
RESUMO D0 TIME STEP 1		
Tempo	(dia)	! .00100 !
Dt	(dia)	I	.00100	!
qo	(m3/dia)	!	.3000D+03	!
Qg	(m3/dia)	I	.6786D+05	!
Qw	(m3/dia)	!	.OOOOD+OO	!
RG0	(m3/m3)	! 226.2000 !
RWO	(m3/m3)	! .0000 !
Pwf	(MPa)	!	34.6510	!
Np	(m3)	!	.3000D+00	!
Gp	(®3)	!	.6786D+02	!
Wp	(m3)	I	.OOOOD+OO	!
Balanço	de Materais	
Oleo	(’/.)	!	.ÍOOOD+Ol	!
Gas	(7.)	!	.ÍOOOD+Ol	!
Agua	(X)	!	. ÍOOOD+Ol	I
Recup.	(7.)	! .0000
IP	(m3/d/kg/cm2)!	552,5163
Mapa de Pressão e Saturacao (Pressão, So e Sw) GRID CARTESIANO
Camada 1
! 01 !		02 !	03	!
	34.4088 !	34.4088 !	34.4088 !
3	.88000 !	.88000 !	.88000 !
	.12000 !	.12000 !	.12006 !
	34.7043 !	.0000 !	34.7043 !
2	.88000 !	.88000 !	.88000 !
	.12000 !	.00000 !	.12000 «
	35.0000 !	35.0006 !	35.0000 !
1	.00000 !	.00000 !	.00000 !
	1.00000 !	1.00000 !	1.00000 !
	GRID RADIAL		
Camada 1			
	01 !	02 !	03	?
	34.6208 I	34.6861 !	34.7042 !
1	.87999 !	,88000 !	.88000 !
	.12001 !	.12000 !	.12000 !
	34.6180 !	34.6659 I	34.5557 !
2	.87999 !	.88000 !	.88000 !
	.12001 !	.12000 !	.12000 I
	34.62Q8 !	34.6861 !	34.7042 !
3	.87999 !	.88000 !	.88000 !
	.12001 ’	.12000 !	.12000 !
	34.6235 !	34.7062 !	34.8518 !
4	.87999 !	.88000 !	.88000 !
	.12001 !	.12000 !	.12000 !
Camada 1
BLOCO	PRESSÃO	Qoj,k Qwj,k	RWO
1=1 J	(MPa)	(m3/D)	(m3/D)	(m3/m3)
1	34,62077	75.00000	.00000	.00000
34.61804
34.62077
34.62349
75.00000
75.00000
75.00000
.00000
.00000
.00000
.00000
.00000
.00000
RESUMO DO TIME STEP 24		
Tempo	(día)	!	32.44348	!
Dt	(dia)	! 10.00000 !
Qo	(m3/dia)	!	.3000D+03	1
Qg	(m3/dia)	!	.6786D+05	!
Qw	(m3/dia)	!	.18910+00	I
RGG	(®3/m3)	! 226.2000 !
RWO Pwf	(m3/m3) (MPa)	! .0006	! !	32.2753	!
Np	(m3)	!	.9733D+04	!
Gp	(m3)	!	.2202D+07	!
Wp	(®3)	!	.37940+01	■
Balanco	de Materais	
Oleo	(’/.) !	. 1000D+01	!
Gas	(*/,)	I	. 1000D+01	’
Agua	(%) !	. 1000D+01	!
Recup.	(%) 1	.6949
IP	(m3/d/kg/cm2)!	127.8716
Mapa de Pressão e Saturacao (Pressao, GRID CARTESIANO
Camada 1
So e Sw)
01	!	02	!	03
1 3 ! i	32.2221 ! .87978 ! .12022 !	32.2062 ! .87977 ! .12023 !	32.2221 ! .87978 ! .12022 1
2 |	32.5054 ! .87976 ! .12024 !	.0000 ! .88000 ! .00000 !	32.5054 ‘ .87976 ! .12024 !
í 1 ! í	32.8419 ! .00000 ! 1.00000 !	32.8288 ! .00000 ’ 1.00000 ’	32.8419 ! .00000 ! 1.00000 !
GRID RADIAL
Camada 1
!	i 02 j ”"o3
32.3272 ! .87976 ! .12024 !	32.3949 ! .87976 ! .12024 !	32.4634 ! .87976 1 .12024 !
32.3245 ! .87972 ! .12028 !	32.3750 ! .87974 ! .12026 !	32.3164 ! .87979 ‘ .12021 !
32.3272 1 .87976 ! ,12024 !	32.3949 ! .87976 J .12024 !	32.4634 ! .87976 ! .12024 !
32.3298 ! .87983 ! .12017 1	32.4144 ! .87982 I .12018 !	32.6074 ! ,85597 ■ .14403 !
Camada 1
BLOCO	PRESSÃO	Qoj	,k	Qwj,k	RWO
J	(MPa)	(m3/D)	(m3/D)	(m3/ra3)
1	32,	32716	74.	99997	.04908	.00065
2	32.	32449	74.	99988	.05614	.00075
3	32.	32716	74.	99997	,04908	.00065
4	32.	32976	75.	00017	.03481	.00046
RESUMO DO TIME STEP 27				
Tempo	(dia)	!	62.44348	í
Dt	(dia)	1	10.00000	t
qo	(m3/dia)	t	.3000D+03	1
Qg	(m3/dia)	1	.6786D+05	t
Qw	(m3/dia)	1	.3419D+00	1
RGO	(m3/m3)	i	226,2000	1
RWO	(m3/m3)	t	.0011	1
Pwf	(MPa)	1	30.2398	1
Np	(m3)	t	.1873D+05	1
Gp	(m3)	t	,42370+07	t
Wp	(m3)	!	,1256D+02	1
Balance	de Materais			
Oleo	CZ)	i	■ÍOOOD+Ol	1
Gas	CZ)		.lOOOD+Ol	1
Agua	CZ)	i	.ÍOOOD+Ol	(
Recup.	CZ)	1	1.3374	
IP	(m3/d/kg/cm2)!		130.5906	
	Mapa de Pressão		e Saturacao	(Pressão, So
GRID CARTESIANO
Camada 1
01	!	02 í 03
i 30.1828 !
3 !	.87960	!
!	.12040 !
30.1672 !
.87956 !
.12044 !
30.1828 !
.87960 ’
.12040 !
!	30.4651	!
2 !	.87953	!
!	.12047 !
.0000 I 30.4651 ! .88000 !	.87953	!
.00000 !	.12047	!
!	30.8104	!	30.7973	!
1	!	.00000	!	.00000	!
!	1,00000	!	1,00000	!
30.8104 !
.00000 !
1.00000 !
GRID RADIAL
Camada 1
01	’	02 í 03
!	30.2906	!	30.3569	!
1	!	.87954	!	.87955	!
1	.12046	!	.12045	‘
30.4240 !
.87955 !
.12045 !
!	30.2879	!	30.3370	!
2	!	.87951	1	.87955	!
!	.12049	!	.12045	!
30.2766 !
.87964 !
,12036 !
30.2906 !
.87954 !
,12046 !
30.3569 !	30.4240	!
.87955 !	.87955	!
.12045 !	.12045	»
i
4 j
i
30.2931 *	30.3763	•
,87966 !	.87964	!
.12034 !	.12036	■
30.5674 ! .83326 ! .16674 !
Camada 1
BLOCO
1=1 J
1 2
3
4
PRESSÃO
(MPa)
30.29055
30.28789
30.29055
30.29315
(m3/D)
74.99994
74.99984
74.99994
75.00027
Qoj ,k
(m3/D) .08952 .09632 .08952
.06656
Qwj,k
RWO
(m3/m3) .00119 .00128 .00119 .00089
RESUMO DO TIME STEP 34		
Tempo	(dia)	!	84.42590	!
Dt	(dia)	!	7.11914	I
Qo	(m3/dia)	!	.7956D+01	!
Qg	(m3/dia)	!	.1800D+04	!
Qw	(m3/dia)	!	.1249D-01	!
RGO	(m3/m3)	!	226.2000 !
RWO	(m3/m3)	!	.0016 !
Pwf	(MPa)	!	30.0060	!
Np	(m3)	!	.2070D+05	!
Gp	(m3)	!	.4682D+07	!
Wp	(m3)	!	.1496D+02	!
Balanco	de Materais	
Oleo	(7.)	•	.lOOOD+Ol	!
Gas	(’/.) !	.lOOOD+Ol	!
Agua	(7.)	’	.lOOOD+Ol	!
Recup.	(7.)	!	1.4777
IP	(m3/d/kg/cm2)!	132.0135
Mapa de Pressão e Saturacao (Pressao, So e Sw)
GRID CARTESIANO
Camada 1
!
01
02
03
f
i
i
i
3 !
i
29.7195 ! .87959 !
■
3o70119~! .87947 ! .12053 I
30.3747 * .00000 !
1.00000 !
29.7191 ! .87952 !
-¿12048J 7ooõõ~T .88000 ! .00000 !
30.3742 ! .00000 !
1.00000 !
29.7195 ! .87959 ! .12041 !
30.0119 ! .87947 I .12053 !
30.3747 !
.00000 }
1.00000 !
GRID RADIAL
Camada 1
03
i
02
t
01
i
t 1 ! i	30.0073 ! .87933 ! .12067 !	30.0091 ! .87950 ! .12050 !	30.0108 I .87951 ! .12049 !
I 2 i	30.0046 ’ .87914 ! .12086 !	29.9891 ! .87948 ‘ .12052 !	29.8637 ! .87966 I .12034 !
i 3 ! i	30.0073 &gt; .87933 ! .12067 !	30.0091 ! .87950 ! .12050 !	30.0108 ! .87951 ! .12049 !
’	30.0100	! 4 !	.87964	1 !	.12036 1	30.0291 ! .87961 ! .12039 !	30.1579 » .82825 ! .17175 !
Camada 1		
BLOCO	PRESSÃO	Qoifk	Qwí.k		RWO
1=1 J	(MPa)	(m3/D)	(m3/D)	(m3/m3)
1	30.00733	1.98917	.00325	.00163
2	30.00462	1.98681	.00426	.00215
3	30.00733	1.98917	.00325	.00163
4	30.01005	1.99079	.00173	.00087
Tempo	de execucao (¡	seg) =27		
13,2 Poço com 100m de comprimento
PROGRAMA ACTION.FOR
SISI5iADQB_Pga!BgSEBYAIDBIQ_gQH!!5EQgD=HfiBIZQNTAI!
TOTALMENTE IMPLICITO TRIDIMENSIONAL BI-FASICO ( OLEO/AGUA )
EBIfiÇI£âIS-DâDQS_UIILIZÔDOS
Parametros de Simulacao:
Região do reservatório - GRID CARTESIANO -X
Y
Z
X
Y
Z
direcao direcao direcao direcao direcao direcao
N# de blocos na N# de blocos na N# de blocos na Dim. dos blocos Dim. dos blocos Dim. dos blocos
N. de blocos produtores
(FIO.4)
(FIO.4)
(FIO.4) (13)
(13) NXC==&gt; (13) NYC™&gt; (13) NZC===&gt; DBDX===&gt; dbdy===&gt; DBDZ===&gt; NBP== &gt;
3
3
3
100.00 50.00
100.00
1
Coord, i do bloco produtor	(13)	IP===&gt;	2
Coord, j do bloco produtor	(13)	JP===&gt;	2
Coord, k do primeiro bloco produtor	(13)	KP===&gt;	1
Região do poco ~ GRID RADIAL -			
N# de blocos na direcao X	(13)	NX===&gt;	3
N# de blocos na direcao Y	(13)	NY===&gt;	4
N# de blocos na direcao Z	(13)	NZ===&gt;	1
Time step inicial (dias)	(F8.3)	DT===&gt;	.001
Tolerancia para pressao (Pa) Tolerancia para saturacao (fr) Max var de sat num DT (fracao) Max var de pres. num DT (KPa) Vazao de oleo maxima (m3/dia) Vazao de oleo minima (m3/dia) Tempo final de simulacao (dias) Pwf minima no poco (MPa) Raio do poco (m)
Int. tempo p/ impr.relatorio (dias) Int. tempo p/ impr.gráfico (dias) Int. células de impressao Incremento de tempo máximo (dias) Incrementode tempo mínimo (dias) N# max de iteracoes no JACOBIANO N# min de iteracoes no JACDBIANO Fatia J base para o calculo de Pwf
Dados do teste de formacao:
Simulacao de teste de formacao Vazao de producao (m3/dia) Tempo de fluxo (horas) Tempo de estática (horas) Incr. de tempo no teste (horas)
(F8.3) T0LP===&gt;3447.400
(F6.4) TÜLS===&gt;
(F6.4)DSLIM===&gt;
(F8.3)DPLIM===&gt;
(F8.3)qOMAX—&gt;
(F8.3)qOMIN===&gt;
(F8.2) TSIM===&gt; (F8.3)PWMIN===&gt;
(F8.4) RW=“&gt; (F5.1)TIMPR==~&gt; (F5.1)TIMPG===&gt; (I3)IRIMP===&gt;	1
(F5.1)DTMAX===&gt; (F6.4)DTMIN==-&gt;
(13)ITMAX===&gt; (I3)ITMIN===&gt;
(13)JPROD===&gt;
.0010 .0500 689.480 300.000
15.000 5000.00
30.000 .1000
30.0
10.0
10.0 .0010
5
2
1
(s
ou N) OPT-
(F8.3) (F8.3) (F8.3) (F8.3)
&gt;N QOTF===&gt; tptf=—&gt; TETF===&gt; DTTF===&gt;
50.000
24.000
72.000
.500
Dados do reservatório:
Saturacao inicial de agua (fracao) (F6.4) SWIN===&gt; .1200 Densidade do gas (adim) Compressibilidade da rocha (1/MPa) Pressão inicial do reservatório(MPa) Temperatura do reservatório (®C) Raio externo da região do poco (m) Cota do poco (m) Cota do contato o/w (m)
Porosidade igual a	.3000 para *
Permeabilidade na direcao X igual a Permeabilidade na direcao Y igual a Permeabilidade na direcao Z igual a
(F6.4) DGAS===&gt;
(E9.3) CR===&gt;
(F8.4) PRIN==&gt;
(F8.4) TEMP===&gt;
(F8.4) RE-==&gt;
(F8.3) ZC===&gt;-2560.00
(F8.3) ZC0W===&gt;-2610..00 todos os blocos
i	50.0000	para	todos	blocos
i,	50.0000	para	todos	blocos
i	50.0000	para	todos	blocos
.8000 .440E-03 35.0000 90.0000
39.894
RESUMO DO TIME STEP 1
Tempo	(dia)	!	.00100
Dt	(dia)	!	.00100
Qo	(m3/dia)	1	.3000D+03
Qg	(m3/dia)	!	.6786D+05
Qw	(m3/dia)	!	.OOOOD+OO
RGO	(m3/m3)	!	226.2000
RWO	(m3/m3)	!	.0000
Pwf	(MPa)	!	34.5445
Np	(m3)	!	.3000D+00
Gp	(m3)	!	.6786D+02
Wp	(m3)	!	.00000+00
Balanco	de Materais	
Oleo	(*Z)	■	.1000D+01	!
Gas		.1000D+01	!
Agua	(7.)	!	.1000D+01	!
Recup,	(•/.) !	.0000
IP	Cm3/d/kg/cm2)!	184.1721
Mapa de Pressão e Saturacao (Pressao, So e Sw)
GRID CARTESIANO Camada 1
! 01 !		02 ’	03	I
i 3 ! i	34.4088 ! .88000 ! .12000 !	34.4088 ! .88000 ’ .12000 !	34.4088 ! .88000 ! .12000 !
1 2 I i	34.7043 ! .88000 ! .12000 !	,0000 ’ .88000 ! .00000 I	34.7043 ! .88000 ! .12000 !
i 1 ! f	35.0000 ! .00000 ! 1.00000 !	35.0006 ! .00000 ’ 1.00000 I	35.0000 ! .00000 ! 1.00000 !
Camada 2			
i	01 !	02 !	03	!
J 3 ! i	34.4088 ! .88000 ! .12000 Í	34.4088 ! .88000 ! .12000 !	34.4088 ! .88000 ! .12000 ’
1 2 1	34.7043 ! .88000 ! .12000 !	34.7040 ! .88000 ! .12000 !	34.7043 ! .88000 ! .12000 !
i 1 ! !	35.0000 ! .00000 ! 1.00000 !	35.0000 ! .00000 ! 1.00000 !	35.0000 ! ,00000 ! 1.00000 !
Camada 3			
! 01 !		02 !	03	I
i	34.4088 !	34.4088 !	34.4088 !
3 !	.88000 !	.88000 I	.88000 !
i	.12000 !	.12000 !	.12000 !
!	34.7043	!
2 ! ,88000 !
I .12000 !
34.7043 ! .88000 ! .12000 !
34.7043 ! .88000 ! .12000 !
1 1 i 1	'	35.0000	! i	.00000	! ' 1.00000 !	35.0000 ! .00000 ! 1.00000 !	35.0000 ! ,00000 ! 1.00000 !
GRID RADIAL Camada 1			
i	01 !	02 !	03	!
i	!	34.4538 !	34.6498 !	34.7039 !
1 !	!	.87997 !	.87999 ’	.88000 !
i	!	.12003 !	.12001 !	.12000 !
3	!	34,4511 !	34,6296 !	34.5554 !
2 !	!	.87997 !	.87999 ! .12001 !	.88000 !
i	1	.12003 !		.12000 !
!	!	34.4538 ! !	.87997 !	34,6498 !	34.7039 !
3 !		.87999 !	.88000 !
i	!	.12003 !	.12001 }	.12000 !
	! 34.4565 ! ! .87997 ! ! .12003 !	34.6698 ! .87999 !	34.8515 !
4 !			.88000 !
1		.12001 !	.12000 !
Camada 1
BLDCD	PRESSAC	]	Qoj ,k	Qwj,k	RWQ
1 = 1 J	(MPa)	(®3/D)	(m3/D)	(m3/m3)
1	34.45381	75.00000	.00000	.00000
2	34.45108	75.00000	.00000	.00000
3	34.45381	75.00000	.00000	.00000
4	34.45653	75.00000	.00000	.00000
RESUMO DO TIME STEP168
Tempo	(dia)	!	30.05590	!
Di	(dia)	!	.19462	i
Qo	(m3/dia)	!	.3000D+03	1
Qg	(m3/di a)	!	.6786D+05	1
Qw	(m3/dia)	I	.1017D+02	1
RGO	(m3/m3)	!	226.2000	i
RWD	(m3/m3)	!	.0339	{
Pwí	(MPa)	!	31.9132	J
Np	(m3)	!	. 9017D+04	t
Gp	(m3)	!	.2040D+07	1
wp	(m3)	!	. 1401D+03	1
Balance	de Materais		
Oleo	(X)	!	.1000D+01	f
Gas	(7.)	•	.10Ô0D+01	1
Agua	(7.)	■	.1000D+01	1
Recup.	CO	!	.6437	
IP	(m3/d/kg/cm2)!	43.9504	
Mapa de Pressão e Saturacao (Pressao, So e Sw) GRID CARTESIANO
Camada 1
!	01	‘	02	!	03
i
3 !
i
32.3138 !
.87979 ! .12021 !
32.2763 ! .87978 ! .12022 !
32.3138 ! .87979 ! .12021 !
*	32.5826	I
2 !	,87977	!
!	.12023	!
.0000 !	32.5826	!
.88000 !	.87977	I
-00000 !	.12023	!
I	32.9601	!	32.9172	!
1	!	.00000	!	.00000	!
!	1.00000	!	1.00000	!
32.9601 ! .00000 !
1.00000 !
Camada 2
01	1	02	•	03
i 3 ! i	32.3923 ! .87980 ! .12020 !	32.3800 ! .87979 I .12021 !
i 2 ! i	32.6833 ! .87978 ! .12022 !	32.6657 ! .87978 ! .12022 !
i 1 ! i	32.9898 ! .00002 ! .99998 !	32.9807 ! .00000 ! 1.00000 !
32.3923 ! .87980 ! .12020 !
32.6833 !
.87978 1
.12022 !
32.9898 ! .00002 ! .99998 !
Camada 3
f	01 !	02 !	03	!
i 3 I 1	32.4363 ! .87980 ! .12020 !	32.4331 ! .87980 ! .12020 ’	32.4363 ! .87980 ! .12020 !
t 2 ! t	32.7274 I .87979 ! .12021 !	32.7239 I .87979 ! .12021 !	32.7274 ! .87979 ! .12021 !
1 1 ! i	33.0153 ! .00229 ! .99771 !	33.0126 ! .00206 ! .99794 !	33.0153 ! .00229 ! .99771 !
GRID RADIAL Camada 1			
!	01 !	02 !	03	!
1 1 ! í	32.0721 ! .87494 ! .12506 !	32.2745 ! .87856 ! .12144 !	32.4760 ! .87976 ! .12024 !
i 2 ! i	32.0693 ! .87975 ! .12025 !	32.2540 ! .87976 ! .12024 !	32.3256 ! .87979 ! .12021 !
i 3 I t	32.0721 ! .87494 ! .12506 !	32.2745 ! .87856 ‘ .12144 !	32.4760 ! .87976 ! .12024 !
i 4 ! i	32.0748 1 .83972 ! .16028 !	32.2947 ! .83030 ! .16970 !	32.6238 ’ .79096 ! .20904 !
Camada i
PRESSÃO
Qoj
Qwj,k
BLOCO
1=1
J	(MPa)	(m3/D)	(»3/D)	(m3/i
1	32.07208	75.02146	1.01680	.01355
2	32.06926	75.03504	.05114	.00068
3	32.07208	75.02146	1.01680	.01355
4	32.07484	74.92205	8.08654	.10793
RWO
___________RESUM0_D0_TIME_STEP316____
Tempo (dia)	I	60.12462
Dt	(dia)	!	.43789
Qo	(m3/dia)	!	. 2320D+03	!
Qg	(®3/dia)	’	.5248D+05	!
Qw	(nt3/dia)	!	.1520D+02	!
RGO	(m3/m3)	!	226.2000 !
RWO	(m3/m3)	!	.0655	!
Pwf	(MPa)	!	30.0170	!
Np	(m3)	•	. 1793D+05	!
Gp	(m3)	!	.4055D+07	!
Wp	(m3)	!	.5932D+03	!
Balance	de Materais	
Oleo	(X)	!	. 1000D+01	1
Gas	y.)	*	.1000D+01	!
Agua	(7.)	!	. 1000D+01	!
Recup.	(X)	!	1.2800
IP	(m3/d/kg/cm2)!	44.5924
	Mapa de Pressao	e Saturacao (Pressao, So e Sw)
GRID CARTESIANO
Camada 1
01 I 02	!	03
í 3 í í	30.2545 ! .87960 ! .12040 !	30.2246 ! .87957 ! .12043 !	30.2545 ! .87960 ! .12040 !
i 2 ! i	30.5272 ! .87953 ! .12047 !	.0000 ! .88000 ! .00000 !	30.5272 ! .87953 ! .12047 !
i 1 ! i	30.9030 1 .00000 ! 1.00000 !	30.8712 ! .00000 ! 1.00000 !	30.9030 ! .00000 ! 1.00000 !
Camada 2
01	!	02	!	03	!
30.3218 ! .87961 1 .12039 !	30.3113 ! .87961 ! .12039 !	30.3218 ! .87961 ! .12039 »
30.6122 ! .87955 ! .12045 !	30.5969 ! .87955 ! .12045 !	30.6122 ’ .87955 ! .12045 !
30.9247 ! .00002 ! .99998 !	30.9179 ! ,00000 ! 1.00000 !	30.9247 ! .00002 ! .99998 !
Camada 3
01	!	02	!	03
30.3619 ! .87961 ! .12039 !	30.3591 ! .87961 ! .12039 !	30,3619 ! .87961 ! .12039 !
30.6531 ! .87956 ! .12044 !	30.6501 ! .87956 ! .12044 !	30.6531 ! .87956 ’ .12044 ‘
30.9426 ! .00427 ! .99573 !	30.9404 ! .00380 ! .99620 !	30.9426 ! .00427 ! ,99573 !
GRID RADIAL
Camada 1
01 !	02 !	03	!
30.1338 !	30.2868 !	30.4426 !
.86201 !	.87088 !	.87954 !
.13799 !	.12912 !	.12046 !
30.1313 !	30.2672 !	30.2940 !
.87803 !	.87957 !	.87964 !
.12197 !	.12043 !	.12036 !
30.1338 !	30.2868 ‘	30.4426 !
.86201 !	.87088 !	.87954 !
.13799 !	.12912 !	,12046 !
30.1361 I	30.3043 !	30.5876 !
.81679 !	.79437 !	.71263 !
.18321 !	.20563 !	.28737 !
Camada 1
BLQCO	PRESSAÜ		Qoj,k	Qwi.k	RWO
1=1 J	(MPa)	(m3/D)	(m3/D)		(m3/m3)
1	30.13384	58.05285	2.69940	.04650
2	30.13128	58.16289	.29044	.00499
3	30.13384	58.05285	2.69940	.04650
4	30.13610	57.72554	9.50680	.16469
RESUMO DO TIME STEP351		
Tempo	(dia)	!	89.70982	!
Dt	(dia)	i	2.21684	!
Qo	(m3/di a)	’	.1480D+02	!
Qg	(m3/d i a)	!	.3349D+04	!
Qw	(m3/dia)	!	.1005D+00	!
RGO	(®3/m3)	’	226.2000 !
RWO	(m3/m3)	!	.0068 !
Pwf	(MPa)	I	30.0170	!
Np	(m3)	!	.2019D+05	!
Gp	(m3)	!	.4568D+07	!
wp	(m3)	!	.6893D+03	!
Balance	de Materais	
Oleo	(X)	*	. 1000D+01	’
Gas	(7.)	!	. 10Q0D+01	!
Agua	(7.)	1	. 1000D+01	I
Recup.	(7.)	■	1.4418
IP	(m3/d/kg/cm2)!	39.1183
Mapa de Pressão e Saturacao (Pressao, So e Sw)
GRID CARTESIANO
Camada 1
i	01 !	02 !	03	!
3 ! i	29.7628 ! .87959 ! .12041 !	29.7608 ! .87953 ’ .12047 !	29.7628 ! .87959 I .12041 !
i 2 ! t	30.0541 ! .87946 ! .12054 !	.0000 ! .88000 ! .00000 !	30.0541 ! .87946 ! .12054 !
i 1 !	30.4361 ! .00000 !	30.4344 ! .00000 !	30.4361 ! .00000 !
! 1.00000 ! 1.00000 ! 1.00000 ’
Casada 2
!	01 !	02 !	03	!
s 3 i	29.7679 ! .87959 ! .12041 *	29.7674 ! .87959 ! .12041 !	29.7679 ! .87959 ! .12041 !
1 2 I F	30.0605 ! .87948 ! .12052 !	30.0599 ! .87947 ! .12053 !	30.0605 ! .87948 ! .12052 !
1 1 ! s	30.4371 ! .00002 1 .99998 1	30.4367 ! .00000 ! 1.00000 !	30.4371 ! .00002 ! .99998 ’
Cassada 3
01
02
03
!	29.7711	»
3 f .87959 !
I .12041 !
29.7709 !
.87959 !
.12041 !
29.7711 !
.87959 !
.12041 !
30.0638 t
.87948 I
.12052 !
30.0637 ! .87948 !
.12052 !
30.0638 I .87948 ! .12052 i
i
2 ! t
1 ! s
30.4377 ‘ .00436 ! .99564 !
30.4376 ! .00386 ! .99614 !
30.4377 ! .00436 ! .99564 ‘
GRID RADIAL
Camada 1
i
01
s
02
i
03
t
i
3 !
i
i
2 !
i
i
4 ! i
30.0258 ! .87748 ! .12252 !	30,0370 ! .87730 ! .12270 !	30.0482 ! .87949 ! .12051 !
30.0232 ! .87926 ! .12074 »	30.0171 ! .87950 ! .12050 !	29.9010 ! .87968 ! .12032 !
30.0258 ! .87748 ! .12252 1	30.0370 • .87730 ! .12270 !	30.0482 ! .87949 ! .12051 !
30.0285 ! .87550 ! .12450 !	30.0566 ! .86638 ! .13362 !	30.1952 ! .69598 ! .30402 !
Camada 1
BL0C0	PRESSAO	Qoj,k	Qwi,k			RWO
1 = 1 J	(MPa)	(m3/D)	(m3/D)	(m3/m3)
1	30,02585	3.70475	.02511	.00678
2	30.02316	3.71582	.00738	.00199
3	30.02585	3.70475	.02511	.00678
4	30.02851	3.67845	.04289	.01166
Tempo	de execucao	(seg) =2641		
Neste anexo é apresentada a listagem do programa computacional, em linguagem FORTRAN, para o modelo totalmente acoplado. Este programa e os demais desacoplados, assim como os arquivos de exemplos de dados de entrada e de saldas, encontram-se arquivados no Departamento de Engenharia de Petróleo da Faculdade de Engenharia Mecânica da UNICAMP.
No total são três programas em linguagem FORTRAN:
L Modelo totalmente acoplado
Programa ACTIOW.FOR.
2.	Modelo desacoplado com acoplamento na iteração
Programa ACOOWLFOR
3.	Modelo desacoplado com acoplamento no iime-slep
Programa ACOOWTS.FOR
UNIVERSIDADE ESTADUAL DE CAMPINAS - UNICAMP MESTRADO EM ENGENHARIA DE PETROLEO - TURMA 1989
SIMULADOR DE RESERVATÓRIO COM POCO HORIZONTAL
AUTOR: JOSE ADILSON TENORIO GOMES
PROGRAMA ---- ACTIDW.FOR (totalmente acoplado)
CARACTERISTICAS DO PROGRAMA
*
*
*
*
*
*
*
*
Linguagem FORTRAN;
Simula o comportamento de um reservatório retangular produzindo através de um poco horizontal, usando refinamento local, ou seja, a regiao do poco e representada por uma malha cilindrica e a regiao do reservatório por uma malha cartesiana;
Regioes totalmente acoplados - resolvidas simultaneamente no mesmo Jacobiano;
Tridimensional;
Bifásico - oleo/agua;
Totalmente implícito;
Fluidos inicialmente em
A matriz jacobiana pode
-	método direto usando
-	método direto usando
-	método iterativo
equilibrio gravitacional;
ser resolvida das seguintes formas: eliminacao de Gauss algoritmo otimizado (NSPIV)
BSOR
Arquivas de entrada Entrada
1 :
2 ;
3	:
SAIDA
4	:
(PVTW.DAT)
(PETRDW.DAT) -
(ACTIDW.DAT) -
(ACTION.REL) -
e saida :
5 :
7	:
8	:
9 :
11:
12:
(ACTIO1.DAT) -
(ACTI02.DAT) -
(ACTIO3.DAT) -
(ACTI04.DAT) - saida (PHTEST.REL) - saida (PHTEST.DAT) - saida
dados de analises PVT
dados de analises petrofisícas
dados gerais de reservatório e de simulacao
Relatorio geral, com balanço de materiais de saturacao saida saida saida
para para para para para para
resultados da producao, e mapas
(tempo, (tempo,
(tempo,
(perfil de teste de formacao
de pressao e
Qo&gt; Qw, Qg, Pwf)
Np, Wp)
RWD, RGO) veri de saturacao)
C~ c c c c c c c c c c c c c c c c c c c-c c c c c c c c c c c c c c c c c c c c c
c c c c c c c c c c c c c c c c c c~
$system
IMPLICIT DOUBLE PRECISI0N(A-H,0~Z)
PARAMETER(NLAB=18,NXM=08,NYM^OB,NZM-04,PI-3.141592654D0) C Dados PVT e petrofisica
COMMON/LPETR/SWL,KRWL,KROL,SLL,PCOWL, NKR,NPC
C Parametros de simulacao e de producao
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/SIM/DT,DTMAX,DTMIN,TOLP,TOLS,DSLIMfDPLIM,TSIM,
*	QOMAX,QOMIN,PWMIN,BSOR,JPROD,MSDLU,ITMAX,ITMIN C Dados do reservatório
COMMON/RES/DGAS,CR,PRIN tTEMP,ZC,RW tRE,SHIN,PHI,PERX,PERY,
*	PERZ,ZCOW,INDPOR,INDPER
C Dados de impressão
COMMON/IMP/TIMPR,TIMPG,IRIMP
C Dados do teste de formacao
COMMON/TFR/QOTF,TPTF,TETF,DTTF,DTI,TFLUX,BETA,OPT
C Variavais da malha
COMMON/MALHA/ZB,RB,VPDR,DRO,WX,WY,WZ,FFX,FFY,FFZ,DTETA
C Variaveis do passo de tempo n
COMMON/TSA/POA,SOA,SGA,SWA
COMMON/PVTA/BOA,RSDA,BWA
C Variaveis do passo de tempo n+1
COMMON/TS/PO,SO,SG,SW
COMMON/PVT/BO,DBO,VO,DVO,DO,DDO,RSO,DESO,BW,DBW,VW,DVW,DW,DDW,CW C Variaveis das interfaces X e Y
COMMON/IFACEX/BOMX,VOMX,DOMX,BWMX,VWMX,DWMX
COMMON/IFACEY/BOMY,VOMY,DOMY,BWMY,VWMY,DWMY
COMMON/IFACEZ/BOMZ,VOMZ,DOMZ,BWMZ,VWMZ,DWMZ
C Valores de perm, relativas ,pressões capilares e suas derivadas COMMON/PETR/KRO,KRW,DKRO,DKRW,PC,DPC
C Valores de transmissibilidades e suas derivadas (faces X e Z) COMMON/DTRANS/TOX,TWX,TOY,TWY,TOZ,TWZ,
*	TDX1SA,TOX1SI,TWX1SA,TWX1SI,
*	T0X2SI,T0X2SP,TWX2SI,TWX2SP,
*	TOY1SA,TOY1SI,TWY1SA,TWY1SI,
*	T0Y2SI,T0Y2SP,TWY2SI,TWY2SP,
*	TOZlSAjTOZlSI,TWZ1SA,TWZ1SI,
*	T0Z2SI,T0Z2SP,TWZ2SI,TWZ2SP
C Vazões e suas derivadas, pressão de fluxo tempo
COMMON/VAZAO/QO,qOT,QG,QGT,qW,QWT,DQOP,DqOS,
*	DQWP,DQWS,RWO,RGO,PWF,TEMPO C Volumes acumulados
COMMON/ACUM/qOAC,QGAC,QWAC,VOORR,VWORR,VOORC,VWORC,BNPR,BWPR,
*	BNPC,BWPC,PWFA
C Matriz jacobiana e vetores solucao e independente
COMMON/SEQS/XR,XC
C
DIMENSION POL(NLAB),BOL(NLAB),V0L(NLAB),DOL(NLAB),RSOL(NLAB),
*	POLS(NLAB),BOLS(NLAB), VOLS(NLAB),DDLS(NLAB)
DIMENSION PWL(NLAB),BWL(NLAB),VWL(NLAB),DWL(NLAB),RSWL(NLAB)
DIMENSION PGL(NLAB),BGL(NLAB),VGL(NLAB),DGL(NLAB)
DIMENSION SWL(NLAB),SLL(NLAB),PCOWL(NLAB)
REAL*8 KRWL(NLAB),KROL(NLAB)
C DIMENSION PHI(NXM,NYM,NZM,2),PERX(NXM,NYM,NZM,2),
*	PERY(NXM,NYM,NZM,2),PERZ(NXM,NYM,NZM,2)
DIMENSION ZB(O:NXM+1,NYM,2),RB(NXM+1),VPOR(NXM,NYM,NZM,2),
*	FFX(NXM+1,NYM,NZM,2),FFY(NXM+1,NYM,NZM,2),
*	FFZ(NXM+1,NYM,NZM+1,2),DTETA(NYM+1)
DIMENSION POA(NXM,NYM,NZM,2),SOA(NXM,NYM,NZM„2),
*	SGA(NXM,NYM,NZM,2),SWA(NXM,NYM,NZM,2)
DIMENSION BOA(NXM,NYM,NZM,2),BWA(NXM,NYM,NZM,2)
DIMENSION PO(O:NXM+i,0:NYM+1,0:NZM+1,2),SO(NXM,NYM,NZM,2),
*	SG(NXM , NYM,NZM,2),SW(NXM,NYM , NZM,2)
DIMENSION B0(NXM,NYM,NZM,2),DBO(0;NXM+1,0:NYM+1,0;NZM+1,2),
*	V0(NXM,NYM,NZM,2),DV0(0:NXM+l,0:NYM+1,0:NZM+1,2),
*	DO(NXM,NYM,NZM,2),DDO(O:NXM+1,0:NYM+1,0:NZM+1,2),
*	BW(NXM,NYM,NZM,2),DBW(0:NXM+1,0:NYM+1,0:NZM+1,2),
*	VW(NXM,NYM,NZM,2),DVW(0:NXM+1,0:NYM+1,0:NZM+1,2),
*	DW(NXM,NYM,NZM,2),DDW(O:NXM+1,0:NYM+1,0;NZM+1,2),
*	CW(NXM,NYM,NZM,2)
DIMENSION BOMX(O:NXM+1,NYM,NZM,2),VOMX(O:NXM+1,NYM,NZM,2) ,
*	DOMX(0:NXM+1,NYM,NZM,2),BWMX(0:NXM+1,NYM,NZM,2),
*	VWMX(0:NXM+1,NYM,NZM,2),DWMX(O:NXM+1,NYM,NZM,2) DIMENSION BOMY(NXM,NYM+1,NZM,2),V0MY(NXM,NYM+l,NZM,2),
*	DOMY(NXM,NYM+1,NZM,2),BWMY(NXM,NYM+1,NZM,2),
*	VWMY(NXM,NYM+1,NZM,2),DWMY(NXM,NYM+1,NZM,2)
DIMENSION B0MZ(NXM,NYM,NZM+l,2),V0MZ(NXM,NYM,NZM+l,2),
*	DOME(NXM,NYM,NZM+1, 2),BWMZ(NXM,NYM,NZM+1,2),
*	VWMZ(NXM,NYM,NZM+1,2),DWMZ(NXM,NYM,NZM+1,2)
DIMENSION DKRO(NXM,NYM,NZM,2),DKRW(NXM,NYM,NZM,2),
*	PC(O:NXM+1,0;NYM+1,0:NZM+1,2),DPC(O:NXM+1,0:NYM+1,0:NZM+1,2)
REAL*8	KRO(NXM,NYM,NZM,2),KRW(NXM,NYM,NZM,2)
DIMENSION T0X(NXM+l,NYM,NZM,2),TWX(NXM+1,NYM,NZM,2),
*	TOXISA(NXM,NYM,NZM,2),TOX1SI(NXM,NYM,NZM,2),
*	TWX1SA(NXM,NYM,NZM,2),TWX1SI(NXM,NYM,NZM,2),
*	T0X2SI(NXM,NYM,NZM,2),T0X2SP(NXM,NYM,NZM,2),
*	TWX2SI(NXM,NYM,NZM,2),TWX2SP(NXM,NYM,NZM,2)
DIMENSION TOY(NXM,NYM+1,NZM,2),TWY(NXM,NYM+1,NZM,2),
*	TOY1SA(NXM,NYM,NZM,2),TOY1SI(NXM,NYM,NZM,2),
*	TWY1SA(NXM,NYM,NZM,2),TWY1SI(NXM,NYM,NZM,2),
*	T0Y2SI(NXM,NYM,NZM,2),T0Y2SP(NXM,NYM,NZM,2),
*	TWY2SI(NXM,NYM,NZM,2),TWY2SP(NXM,NYM,NZM,2)
DIMENSION TOZ(NXM,NYM,NZM+1,2),TWZ(NXM,NYM,NZM+1,2),
*	T0ZiSA(NXM,NYM,NZM,2),T0ZlSI(NXM,NYM,NZM,2),
*	TWZISA(NXM,NYM,NZM,2),TWZ1SI(NXM,NYM,NZM,2),
*	T0Z2SI(NXM,NYM,NZM,2),T0Z2SP(NXM,NYM,NZM,2),
*	TWZ2SI(NXM,NYM,NZM,2),TWZ2SP(NXM,NYM,NZM,2)
DIMENSION XR(NXM*NYM*NZM*2),XC(NXM*NYM*NZM*2)
DIMENSION QO(NYM,NZM),QG(NYM,NZM),QW(NYM,NZM),DQOP(NYM,NZM),
*	DQOS(NYM.NZM),DQWP(NYM,NZM),DQWS(NYM,NZM) integer*4 STOPW,in
CHARACTER*1 OPT
LOGICAL TESTE,VPWF,CONV,VDS
C abertura dos arquivos
OPEN(UNIT=1,FILE- &gt;PVTW.DAT &gt; ,STATUS-’OLD &gt;) OPEN(UNIT=2,FILE-&gt;PETROW.DAT’,STATUS-’OLD’) 0PEN(UNIT=3,FILE=’ACTION.DAT•,STATUS-’OLD’) 0PEN(UNIT=4,FILE-’ACTION.RELSTATUS-’UNKNOWN’) OPEN(UNIT-5,FILE-’ACTI01.DAT’,STATUS- &gt;UNKNOWN1) 0PEN(UNIT=7,FILE=’ACTI02.DAT1,STATUS»’UNKNOWN’) 0PEN(UNIT=8,FILE»1ACTI03.DAT*,STATUS»* UNKNOWN &gt;) OPEN(UNIT-9,FILE-’ACTI04.DAT’,STATUS-’UNKNOWN&gt;) DPEN(UNIT=11,FILE-&gt;PRIEST.REL1,STATUS-'UNKNOWN1)
o nao ct nn a a oa oaa o no	aaaanoa
0PEN(UNIT=12,FILE-’PHTEST. DAT’,STATUS='UNKNOWN')
PROGRAMA PRINCIPAL
Leitura dos dados
in=_STOPW(0)
CALL ENTRA
IF(MS0LU.EQ.3) THEN
write(*,*)'Entre com bsor (1 a 2)'
read(*,*)BS0R
ENDIF
CALL IMPDE
Conversão das unidades lidas para o sistema S.I.
call’cÕnvÜnÍ	’ ’ ~~
Inicializacao de variaveis
___CALL INICIA	’	”
Lançamento da malha e calculo das cotas dos pontos, fatores de forma e ponderadores
cÃll~grid	~	~
Calculo das pressões e saturações de agua iniciais
CALL PRESSO (PWF)
Inicializacao das saturações das fases nos blocos Calculo do volume porose inicial dos blocos
$
NX=NXR
NY=NYR
NZ=NZR DO 5 1=1,2
IF(L.EQ.2) THEN
NX=NXC
NY=NYC
NZ=NZC
ENDIF
DO 5 1=1,NX
DO 5 J=1,NY DO 5 K=1,NZ
IFÍL.EQ.2) THEN AUX=PHI(I,J,K,L)*(1.0D0-CR*P0A(I,J,K,L)) VPORÍI,J,K,L)=AUX*DBDX*DBDY*DBDZ IF(I.EQ.IP.AND.l,EQ.JP.AND.K.GE.KP.AND.K.LT.KP+NBP)
‘	VPOR(I,J,K,L)=O.ODO
ELSE AUXl=RW*RW*DBDZ/2.0D0 AUX=PHI(I,J,K,L)*(1.ODO-CR*POA(I,J,K,L))
VP0R(I,J,KíL)=(DEXP(2.0D0*I*DR0))-(DEXP(2.0D0*(I-l)*DR0)) VP0R(I,1,K,L)=VP0R(I,J,K,L)*AUX*AUX1*DTETA(I)
ENDIF
S0A(I,J,K,L)=1.ODO-SWA(I,J,K,L)
SGA(I,J,K,L)=O.ODO P0(I,J,K,L&gt;P0A(I,J,K,L) SO(I,J,K,L)=SOA(I,J,K,L) SG(I,J,K,L)=SGA(I,J,K,L) SW(I,J,K,L)=SWA(I,J,K,L)
a o no Q no ci n on noon can	n on o on an	n an	ci an o on
5 CONTINUE
Calculo dos volumes originais de oleo e agua
CALL RESERV
Impressão dos cabeçalhos para os arquivos do gráficos
WRITE(5,10)
WRITE(7,15)
WRITE(8,16)
10	FORMATÍ’TEMPO(dias) *MPa)*)	Q0(m3/dia)	QW(m3/dia)	Qg(m3/dia)
15	FORMAT(’TEMPO(dias)	NP(m3)	WP(m3)	GP(m3)’)
16	FORMAT(’TEMPO(dias)	RWD(m3/m3)	RG0(m3/m3)’:	)
Inic. de producoes de oleo, gas e agua acumuladas, do tempo e de pwf
QOAC=O.0D0
QGAOO. 0D0
QWAC-0.0D0
QOT-QOMAX
PWFA=PWF TEMP0=0.0D0
Inicializacao de variaveis de contraole de impressão, contador de passos de tempo e de outras var. de controle do processo iterativo
ITR=0
ITG-0
NTS-0
iniciar com vazao constante
VPWF=.TRUE.
---&gt; vpwf=.true.
Opcao para teste de formacao
IF((OPT.EQ. ’S’).AND.(TETF.NE.0.0) .AND. (DTTF.NE.O.O)) THEN 0PT='P
TESTE=.TRUE.
DTI=DT
TEMPTF=0.ODO
CALL CTESTE(TESTE,NTS,DT,QOMAX,TEMPTF,NITER)
ELSE
TESTE=.FALSE.
ENDIF
Inicio de um time-step - Ponto de retorno apos cada DELTA-T
GRID RADIAL
GRID RETANGULAR
---&gt; ---&gt;
L-l
L=2
500
NTS=NTS+1
NITER-1
Calculo das propriedades dos fluidas dependentes das pressões na iteracao anterior (passo de tempo n)
CALL FPOA
Ponto de retomo no processo iterativo dentra de uma iteracao no tempo
400 CONTINUE
Calculo das propriedades dos fluidos dependentes das pressões na iteracao atual e das pressões nas interfaces
anoa aa	o ao n	a	a ao a ao n n aan
CALL FPPOMCPWF^X’WY.WZ)
Verificacao do sentido de fluxo entre os blocos e calculo das transmissibrlidades das fases nas interfaces dos blocos peloiAS PELO esquema "one point upsteam" e de suas derivadas em relacao a Sw
CALL TRANS
Calculo das vazoes de oleo e agua e de suas derivadas
IF(VPWF) THEN
Vazao de oleo constante -&gt; calculo da pressao pwf no poco
*
*
para pwf
SUMT=0.ODO
DO 90 1=1,NYR
DO 90 K=1,NZR
SUMT=SUMT+TOX(1, J, K, 1)
CONTINUE
DO 91 J=1,NYR
DO 91 K=1,NZR
QO(J,K)=QOT*TOX(1,J,K,1)/SUMT
CONTINUE
PWF=PO(1,JPROD,1,1)-DOMX(1,JPROD,1,1)*(ZC-ZB(1,JPROD, 1) ) -Q0(JPROD,1)/TOX(1,JPROD,1,1)
DO 80 J=1,NYR
DO 80 K=1,NZR
DQOP(J,K)=O.ODO
DQ0S(J,K)=0.0D0
CONTINUE
IF((PWF.LT.1.001D0*PWMIN).AND.(PWF.GT.0.999D0+PWMIN))
VPWF=.FALSE.
gravar" com pwfmin
IF(PWF.LE.0.999D0*PWMIN) THEN
DT=DT/2.0D0
CALL REPTS(NTS,PWFA,PWF)
GOTO 500
ENDIF
ENDIF
it
IF(.NOT.VPWF) THEN
Vazao de oleo varialve -&gt; calculo de Qo e sual derivadas
60
QOT-O.ODO
DO 60 J=1,NYR
DO 60 K=1,NZR
PQT=PO(1,J,K,1)-PWF~DOMX(1,J,K,1)*(ZC-ZB(1, J,1)) QO(J,K)=TOX(1,J,K,1)*POT
DQOP(J,K)=-WX*TOX(1,J,K,1)*(DVO(1,J,K,1)/VOMX(1,J,K,1)-
DBO(1,J,K,1)/BOMX(1,J,K,1))*POT+(1.ODO-WX* DDO(1,J,K,1)*(ZC-ZB(1,J,1)))*TOX(1,J,K,1) DQOS(J,K)=POT*TOXlSI(i,J,K,l)
QOT=QOT+QO(J,K)
CONTINUE
ENDIF
Calculo da vazao de agua e gas e suas derivadas
Qw=Qo*(mobilidade agua),suas derivadas existem
Qg=Qo*Rs ( considerando que nao havera gas livre no reservatório ) Razao de solubilidade na pressao de saturacao
n Qa o n o ô oo o a on
QWT=0.0D0
QGT-0.ODO
DO 70 j=i,m DO 70 K-l.NZR RMWO=(KRW(1,JJK,1)*BW(1,J&gt;K,1)*VO(1,J,K,1))/
*	(KRO(1, J,K,1) *BO(1,J,K, 1)*W(1,J,K, 1)) QW(J,K)=QO(J,K)*RMWQ AUX=DVO(l,J,K,l)/VO(l,J,K,l)-DBO(i,J,K,l)/BO(l,J,K,i)-
*	DVW(l,J,K4)/VW(l.JtK,l)+DBW(l&gt;J,K,l)/BW(l,J,K,i) DQWP(J,K)=RMW0*(AUX*QO(J,K)+DQOP( J, K) )
AUX=DKRW(1, J,K,1)“KRW(1, J,K,l)*nKRO(l, J,Kfl)/KRO(l,d,K,l)
AUX=AUX*BW(l,JJK,l)*VO(í,JJK,l)/(KRO(lJJ,KJl)*
*	BO(Í,J,K,l)*VW(l,J,K,i))
DQWS(J jK)=RMWO*DQOS(J,K)+AUX*QO(J,K)
QWT=QWT+QW(J,K) QG(J&gt;K)=QO(JJK)*RSS QGT=QGT+QG(J,K)
70 CONTINUE
IF(qOT.NE.O.ODO) RWO=QWT/QOT
IF(QOT.NE.O.ODO) RGO=qGT/QOT
Calculo das funcoes de resíduos do oleo e da agua e de suas derivadas para a montagem da matriz Jacobiana
CALL MONJAC
Solucao do sistema linear de equações
1- por método direto usando Gauss
2~ por método direto usando algoritmo otimizado (NSPIV)
3- por matodo iterativo (BSOR)
IF(MSOLU.EQ.l) CALL SOLVEI
IF(MS0LU.EQ.2) CALL S0LVE2
IF(MSOLU.EQ.a) CALL S0LVE3
Âtualizacao dos valores de pressão e saturacao
NC~Õ
LC-0
DO 20 I=1,NXC DO 20 &gt;1,NYC
D0 20 K^ljNZC
IF(I.EQ.IP.AND.J.EQ.JP.AND.K.GE.KP.AND.K.LT.KP+NBP) GOTO 20 NC=NC+1
LC=2*NC-1
PD(I,J,K,2)=P0(I,J,KÍ2)+XC(LC) SW(I,J,K,2)=SW(IJJ,K,2)+XC(LC+1)
IF(SW(I,J,K,2).GT.1.0D0) SW(I,J,K,2)«1.0D0 IF(SW(I,J,K,2).LT.SWIN) SW&lt;I,J,K,2)=SWIN SO(ItJ,K,2X.ODO-SW(I, J,K,2)
20 CONTINUE
NC-0
LC=0
IF(SW(I,J,K,1).GT.1.ODO) SW(I,J,K,1)=1.ODO
IF(SW(I, J,K, 1) .LT.SWIN) SW(I, J,K,1)=SWIN
a on	n a an
21
SO(I,J,K,1)=1.ODO-SW(I,J,K,1)
CONTINUE
Aanlise da convergência
Verificacao dsa variações da saturacao e pressao
CONV=.TRUE.
NC=O
LC=0
DO 25 1=1,NXC
DO 25 J=1,NYC DO 25 K=1,NZC
IF(I.EQ.IP.AND.J.EQ.JP.AND.K.GE.KP.AND.K.LT.KP+NBP) GOTO 25
NC=NC+1
LC=2*NC-1
IF(DABS(XC(LC)).GT.TOLP) CONV=.FALSE. IF(DABS(XC(LC+1)).GT.TOLS) C0NV=.FALSE.
25	CONTINUE
NC=0
LC=O
DO 26 1=1,NXR
DO 26 J=1,NYR
DO 26 K=1,NZR
NC=NC+1
lc=2*lc-i
IF(DABS(XR(LC)).GT.TOLP) CONV=,FALSE, IF(DABS(XR(LC+1)).GT.TOLS) CONV=.FALSE.
26	CONTINUE
IF(CONV) THEN
write(*,*)* dt=’,dt/86400.0,1 tempo=J,tempo/86400.0
Determinacao das maximas variacoes de sat. e pr. no passo de tempo
30
VDS=.TRUE.
DS=O.ODO
DP=O.ODO
DO 30 1=1,NXC
DO 30 J=1,NYC
DO 30 K=1,NZC
IF(I.EQ.IP.AND.J.Eq.JP.AND.K.GE.KP.AND.K.LT.KP+NBP) GOTO 30
AUX«DABS(S0(I,J,K,2)-S0A(I,J,K,2)) IF(AUX.GT.DS) DS=AUX
AUX=DABS(SW(I,J,K,2)-SWA(I,J,K,2)) IF(AUX.GT.DS) DS=AUX
AUX=DABS(P0(I,J,K,2)-P0A(I,J,K,2))
IF(AUX.GT.DP) DP=AUX
CONTINUE
DO 31 1=1,NXR
DO 31 ...... .
DO
J=1,NYR
31 K=1,NZR
AUX=DABS(SO(I,J,K,1)~SOA(I,J,K,1)) IF(AUX.GT.DS) DS=AUX
AUX=DABS(SW(I,J,K,1)-SWA(I,J,K,1))
IF(AUX.GT.DS) DS=AUX
AUX=DABS(PO(I,J,K,1)-POA(I,J,K,1))
IF(AUX.GT.DP) DP=AUX
1.2D0*DSLIM) VDS=.FALSE.
n no	c¡ on	a aa	a an	o o
DS=DSLIM/DS
DP=DPLIM/DP
IF(DP.LE.DS) THEN DT=DT*DP
ELSE
DT=DT*DS
END IF
CALL REPTS(NTS,PWFA,PWF)
END IF
GDTD 500
Se chegou-se ate esse ponto tem-se um passo de tempo bem sucedido
DO 35 L=l,2
NX=NXR
NY=NYR
NZ=NZR
IF(L.EQ.2) THEN
NX=NXC
NY=NYC
NZ=NZC ENDIF DO 35
DO
*
*
35
1=1,NX
35 J=1,NY DO 35 K=1,NZ
VP0R(I,J,K,L)=VP0R(I,J,K,L)*(1.0D0+CR*(P0(I,J,K,L)~ POA(I,J,K,L))j
POA(I,J,K,L)=PO(I,J,K,L) SOA(I,J,K,L)«SO(I,J,K,L) SWA(I,J,K,L)»SW(I,J,K,L) SGA(I,J,K,L)=SG(I,J,K,L)
IF(L.EQ.2.AND.I.EQ.IP.AND.J.EQ.JP.AND.K.GE.KP.AND.K.LT.KP+NBP)
VPOR(I,J,K,L)=O.ODO
CONTINUE
Calculo das producoes de oleo, gas e agua acumulados
PWFA=PWF
QOAC=QOAC+QOT*DT
QGAC=QGAC+QGT*DT QWAC=qWAC+QWT*DT TEMPO=TEMPO+DT
Opcao para teste de formacao
IF(TESTE) THEN
CALL CTESTE(TESTE,NTS,DT,qOMAX,TEMPTF,NITER) GOTO 500
ENDIF
Controle de impressão de resultados para relatorio e gráficos
IF(((TSIM.NE,0.ODO),AND.(TEMPO.GE.TSIM)).OR.(QOT,LE,QOMIN)) THEN CALL BALM
CALL IMPRER(DT,NTS)
CALL IMPRER(DT,NTS)
END IF
IF(TEMPO.GE.ITG*TIMPG) THEN write(*,40)tempa/86400.,pwf/l.OD+6,rwo,dt/86400.,sw(l,1,1,1)
40 formatC tempo»’,f8.3,’ pwf»’ ,f6.3, * rwo»\el0.4,
*’ dt=\f7.4/ sw»\f6.4)
ITG=ITG+1
CALL BALM
CALL IMPREG
ENDIF
Gooüfj a	a	no oo no nao	o o on
Controle automático de DT ao final de um passo de tempo bem sucedido
Quando P»f se aproxima da pressão de sat. no poco reduz-se DT
IF((PWF.GE.0.95D0*PÜLS(1)).AND.(PWF,LE.1.O5D0+P0LS(1))) *	DT=DT/2.0D0
IF(NITER.LE.ITMIN) DT»1.5D0*DT
IF(DT.GT.DTMAX) DT=DTMAX
IF(DT.LT.DIMIN) DT=DTMIN
GOTO 500
EN D IF
nao se obteve convergência,assim uma nova iteracao sera feita
write(*,*)’---------------&gt; nao convergiu dt=’ ,dt/86400.
NITER=NITER+1
n# de iterações em um passo de tempo superou o máximo,logo reduz-se DT e reinicia-se o processo do inicio.Chama-se portanto rotina REPTS,
IF(NITER.GT.ITMAX) THEN DT=DT/2.0D0
CALL REPTS(NTS,PWF A,PWF) GOTO 500
END IF
GOTO 400
50 in=_ST0PW(l)
WRITE(4,*)’ Tempo de execucao (seg) =’,in/1000
CLOSE(UNIT=4,STATUS»’KEEP’)
CLQSE(UNIT=6,STATUS»’KEEP’)
CLOSE(UNIT=7,STATUS»’KEEP’)
STOP
END
SUBBOTINA DE LEITURA DOS DADOS DE ENTRADA
SUBROUTINE ENTRA
IMPLICIT DOUBLE PRECISI0N(A-H,0-Z)
PARAMETER(NLAB=18,NXM=08,NYM=05,NZM=04)
COMMON/LPVTO/POL,BOL, VOL,DOL,RSOL,POLS,BOLS,VOLS,DOES,NPO,NPOS
COMMON/LPVTW/PWL,BWL,VWL,DWL,RSWL,NPW
COMMON/LPVTG/PGL,BGL,VGL,DGL,NPG
COMMON/LPETR/SWL,KRWL,KROL,SLL,PCOWL,NKR,NPC
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBL0C,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/SIM/DT,DTMAX,DTMIN,TOLP,TOLS,DSLlM,DPLIM,TSIM,
ÜCI OO	o o	ou	u o	o	ou
*	qOMAX,QOMIN,PWMIN,BSOR,JPROD,MSOLU,ITMAX,ITMIN
COMMON/RES/DGAS,CR,PRIN,TEMP,ZC,RW,RE,SWIN,PHI,PERX,PERY,
*	PERZ tZCOW,INDPOR,INDPER
COMMON/IMP/TIMPR,TIMPG,IRIMP
COMMON/TFR/QOTF,TPTF ,TETF,DTTF,DTI,TFLUX,BETA,OPT
DIMENSION PQL(NLAB) ,BOL(NLAB) ,VOL(NLAB) ,DOL(NLAB) ,RS0L(NLAB) ,
*	POLS(NLAB),BOLS(NLAB),VOLS(NLAB),DOLS(NLAB)
DIMENSION PWL(NLAB),BWL(NLAB),VWL(NLAB),DWL(NLAB),RSWL(NLAB) DIMENSION PGL(NLAB),BGL(NLAB),VGL(NLAB),DGL(NLAB)
DIMENSION SWL(NLAB) ,SLL(NLAB) ,PCOWL(NLAB)
REAL*8	KRWL(NLAB),KROL(NLAB)
DIMENSION PHI(NXM,NYM,NZM,2),PERX(NXM,NYM,NZM,2),
*	PERY(NXM,NYM,NZM,2),PERZ(NXM,NYM,NZM,2) LOGICAL SINAL.SINALl
CHARACTER*! OPT,FLAG
Leitura dos dados PVT para oleo,agua,gas
READ(1,*,ERR»200)
READ(l,*,ERR=200)
READ(l,*,ERR=200)
1=0
1=1+1
READ(1,100,ERR=200)P0L(I),B0L(I),V0L(I),DOL(I),RSOL(I),FLAG
IF(FLAG.EQ.1 J) GOTO 5
NP0=I
READ(l,*,ERR=200)
READ(l,*,ERR=200)
10 1=1+1
READ(1,110,ERR=200)POLS(I),BOLS(I) ,VDLS(I),DOLS(I),FLAG IF(FLAG.EQ.J ») GOTO 10
NPOS=I
READ(l,*,ERR=200)
READ(l,*,ERR=200)
1=0
15	1=1+1
READ(l,100,ERR=200)PWL(I),BWL(I),VWL(I),DWL(I),RSWL(I),FLAG IF(FLAG.EQ.’ ’) GOTO 15
NPW=I
READ(l,*,ERR=200)
READ(l,*,ERR=200)
1=0
20 1=1+1
READ(1,115,ERR=200)PGL(I),BGL(I),VGL(I),DGL(I),FLAG
IF(FLAG.EQ.&gt; ’) GOTO 20
NPG=I
100	FORMAT(5F10.4,A1)
110 F0RMAT(4F10.4,1OX,A1)
115	F0RMAT(F10.4,2F10.6,F10.4,1OX,A1)
CLOSE(UNIT-1,STATUS»&gt;KEEP’)
Leitura de dados de pressão capilar e de permeabilidade relativa
READ(2,*,ERR=200)
READ(2,*,ERR=200)
READ(2,*,ERR=200)
C
1=0
25	1=1+1
READ(2,120,ERR=200)SWL(I),KRWL(I),KR0L(I),FLAG
IF(FLAG.Eq.&gt; ’) GOTO 25
NKR=I
C
READ(2,*,ERR=200)
READ(2,*,ERR=200)
C
1=0
30	1=1+1
READ(2,125,ERR=200)SLL(I),PCOWL(I).FLAG
IF(FLAG.EQ.' ») GOTO 30
NPC=I
C
120 F0RMAT(3F10.6,Al)
125 F0RMAT(F10.6,F10.3,1OX,Al)
CL0SE(UNIT=2,STATUS='KEEP &gt;)
a a	n no
Leitura dos parámetros de simulacao
READ(3,*,ERR=200)
READ(3,*,ERR=200)
READ(3,130,ERR=2 0 0)NXC
READ(3,130,ERR=200)NYC
READ(3,130,ERR=200)NZC
READ(3, 155,ERR=200)DBDX
READ(3,155,ERR=200)DBDY
READ(3,155,ERR=200)DBDZ
READ(3,130,ERR=2OO)NBP
READ(3,130,ERR=200)IP
READ(3,130,ERR=2OO)JP
READ(3,130,ERR=200)KP
READ(3,130,ERR=200)NXR
READ(3,130,ERR=200)NQL
READ(3,130,ERR=200)NQS
READ(3,130,ERR=200)NQI
Determinação do numero de blocos na direcao y
NYR=2*NQL+NQS+NQI
READ(3,130,ERR=200)MS0LU
READ(3,130,ERR=200)ITMAX
READ(3,130,ERR=200)ITMIN
READ(3,140,ERR=200)DT
READ(3,135,ERR=200)DTMAX
READ(3,145,ERR=200)DTMIN
READ(3,140,ERR=200)TDLP
READ(3,145,ERR=200)TQLS
READ(3,145,ERR=200)DSLIM
READ(3,140,ERR=200)DPLIM
READ(3,140,ERR=2QO)QQMAX
READ(3,Í40,ERR=200)qOMIIÍ
READ(3,155,ERR=200)TSIM
READ(3,140,ERR=200)PWMIN
READ(3,150,ERR=200)RW
READ(3,135,ERR=200)TIMER
READ(3,135,ERR=200)TIMPG
READ(3,130,ERR=200)IRIMP
READ(3,130,ERR=200)JPROD
IF(IRIMP.EQ.O) IRIMP=1
IFCHMPR.Eq.O.ODO) TIMPR=182.5D0
IF(TIMPG.EQ.0.0D0) TIMPG=TIMPR
READ(3,*,ERR=200)
o a an o	a	aan a	ana
Leitura dos dados do teste de formacao
READ(3,165,ERR=200)0PT
READ(3,155tERR=200)QOTF
READ(3,155,ERR=200)TPTF
READ(3í155,ERR=200)TETF
READ(3,155,ERRss200)DTTF
READ(3,155,ERR=200)BETA
READ(3,*,ERR=200)
Leitura dos dados do reservatório
READ(3,145,ERR=200)SWIN
READ(3,145,ERR=200)DGAS
READ(3,160,ERR=s200)CR
READ(3,150,ERR=200)PRIN
READ(3,150,ERR=200)TEMP
READ(3,155,ERR=200)ZC
READ(3,155,ERR=200)ZCOW
RE=DSQRT(DBDX*DBDY/3.141592654D0)
130 F0RMAT(35X,I3)
135 F0RMAT(35X,F5.1)
140 FÜRMAT(35X,F8.3)
145 FDRMAT(35X,F6.4)
150	F0RMAT(35X,F8.4)
155 F0RMAT(35X,F10.4)
160 FORMAT(35X,D9.3)
165	FORMAT(35X,Al)
166	F0RMAT(35X,3(I2,ÍX))
READ(3,*,ERR=200)
Bloco de leitura do vetor porosidade a Patm ,um valor por camada, associado a um numero NPHI de camadas sobrepostas (de baixo para cima)
170
180
210
READ(3,170,ERR=200)INDPOR
FORMAT(Il)
G0T0(180,190), INDPOR
READ(31210,ERR=200)AUXP
FORMAT(F8.2)
DO 220 1=1,NXR D0 220 J=1,NYR
D0 220 K=1,NZR
PHI(I,J,K,1)»AUXP
CONTINÜ
D0 221
f-l,NXC
DO 221 J=1,NYC
DO 221 K=1,NZC
PHI(I,J,K,2)=AUXP
221	CONTINUE
GOTO 230
190	WRITE(*,*)'NA0 DEFINIDA OPCAO PARA POROSIDADE POR BLOCOS'
230	READ(3,*,ERR=200)
n cio	o oo o	a no
Bloco de leitura da permeabilidades na direcao x
240	READ(3,170,ERR=200)INDPER G0T0(240,250),INDPER READ(3, 210,ERR=200)AUXP DO 260 1=1,NXR DO 260 J=1,NYR DO 260 K=1,NZR
260	PERX(I,J,K,1)=AUXP CONTINUE DO 261 1=1,NXC DO 261 J=1,NYC DO 261 K=1,NZC
261	PERXfl,J,K,2)=AUXP CONTINUE
250	GOTO 270 WRITE(*,*)'NA0 DEFINIDA OPCAO PARA PERMEABILIDADE POR BLOCOS'
270 READ(3,*,ERR=200)
Bloco de leitura da permeabilidades na direcao y
280
300
301
290
310
READ(3,170,ERR=200)INDPER
GOT0(28O,29O),INDPER
READ(3,210,ERR=200)AUXP
D0 300 1=1,NXR
D0 300 J=1,NYR
D0 300 K=1,NZR PERY(I,J,K,1)=AUXP CONTINUE
D0 301 1=1,NXC
D0 301 J=1,NYC
D0 301 K=1,NZC
PERY(I,J,K,2)=AUXP
CONTINUE
GOTO 310
WRITE(*,*)'NA0 DEFINIDA OPCAO PARA PERMEABILIDADE POR BLOCOS' READ(3,*,ERR=200)
Bloco de leitura da permeabilidades na direcao y
READ(3,170,ERR=200)INDPER
G0T0(320,330),INDPER
320	READ(3,210,ERR=200)AUXP
DO 340 1=1,NXR DO 340 1=1,NYR
DD 340 K=1,NZR PERZ(I,J,K,1)=AUXP 340 CONTINUE
DO 341 1=1,NXC DO 341 J=1,NYC
DO 341 K=1,NZC
PERZ(I,J,K,2)=AUXP
rs no	an	o	o o aooaa o o crn
Caso ocorra erro na leitura de dados de permeabilidade
CLOSE(UNIT-3,STATUS='KEEP')
200 PRINT*,'ERRO NA LEITURA DE ARQUIVO DE DADOS'
RETURN
END
SUBBOTINA DE IMPRESSÃO DOS DADOS LIDOS PARA SUA VERIFICACAD
SUBRÓÜtÍÑÉ’ÍmPDÉ ~
IMPLICIT DOUBLE PRECISION(A-H,0-Z)
PARAMETER (NLAB&lt;8, NXM=08, NYM=05, NZM=04)
COMMON/LPVTO/POL,BOL,VOL,DOL,RSOL,POLS,BOLS,VOLS,DOLS,NPO,NPOS COMMON/LPVTW/PWL,BWL,VWL ,DWL,RSWL,NPW
COMMON/LPVTG/PGL,BGL,VGL,DGL,NPG
COMMON/LPETR/SWL,KRWL,KROL,SLL,PCOWL,NKR,NPC
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP COMMON/SIM/DT,DTMAX,DTMIN,TOLP,TOLS,DSLIM,DPLIM,TSIM,
*	QDMAX,QOMIN,PWMIN,BSOR,JPRQD,MSOLU,ITMAX,ITMIN COMMON/RES/DGAS,CR,PRIN,TEMP,ZC,RW,RE,SWIN, PHI,PERX,PERY,
*	PERZ,ZCOW, INDPOR,INDPER
COMMON/IMP/TIMPR,TIMPG,IRIMP
COMMON/TFR/QOTF,TPTF,TETF,DTTF,DTI,TFLUX,BETA,OPT
DIMENSION POL(NLAB).BOL(NLAB),VOL(NLAB),DOL(NLAB),RSOL(NLAB),
*	POLS(NLAB),BOLS(NLAB),VOLS(NLAB),DOLS(NLAB) DIMENSION PWL(NLAB),BWL(NLAB),WL(NLAB),DWL(NLAB),RSWL(NLAB) DIMENSION PGL(NLAB),BGL(NLAB),VGL(NLAB),DGL(NLAB) DIMENSION SWL(NLAB),SLL(NLAB),PCOWL(NLAB)
REAL*8 KRWL(NLAB),KROL(NLAB)
DIMENSION PHKNXM.NYM.NZK^) ,PERX(NXM,NYM,NZM,2),
*	PERY(NXMNYM,NZM, 2) , PERZ(NXM, NYM,NZM,2) CHARACTER*1 OPT
Impressão do cabecalho
WRITE(04,4)
4	FORMAT(//,30X,'PROGRAMA ACTI0W4.FOR',
*//,20X,’SIMULADOR DE RESERVATÓRIO COM POCO HORIZONTAL'Jt *20X,45(’«'),//,30X,'TOTALMENTE IMPLICITO'J,30X,'TRIDIMENSIONAL’,/ *,30X,'BI-FASICO ( OLEO/AGUA )&gt;JD
GRAVACAQ DOS PARAMETROS DE SIMULACAO,DADOS DO RESEV. E DO TESTE
WRITE (04,3)NXC,NYC,NZC,DBDX,DBDY,DBDZ ,NBP,IP,JP,KP
3	FORMATOX/PRINCIPAIS DADOS UTILIZADOS' ,/,3X,25('=') ,//, *3X,'Parametros de Simulacao :',//,
*5X,'Regiao do reservatório ~ GRID CARTESIANO -',/,
*	’	N#	de	blocos	na	direcao	X	(13)	NXC===&gt;’,13,/,
c
5
	Dim. dos blocos direcao Y	(FIO.4)	DBDY===&gt;’,F9.2,/,
*&gt;	Dim. dos blocos direcao Z	(FIO.4)	DBDZ===&gt;’,F9.2,/,
*’	N. de blocos produtores	(13)	NBP===&gt;‘,13,/,
*’	Coord, i do bloco produtor	(13)	IP===&gt;’,13,/,
	Coord, j do bloco produtor	(13)	JP===&gt;’,13,/,
*1	Coord, k do primeiro bloco	produtor	(13)	KP~~=&gt;’,13)
WRITE(04,5)NXR,NYR,NZR,DT,T0LP,T0LS,DSLIM,DPLIM,Q0MAX,Q0MIN,TSIM,
♦PWMIN,HW,TIMPR,TIMPG
F0RMAT(4X,’Região do poco - GRID RADIAL
*»
*»
*&gt;
* &gt;
* &gt;
* &gt;
* &gt;
*&gt;
*}
*&gt;
N# de blocos na direcao X N# de blocos na direcao Y N# de blocos na direcao Z Time step inicial (dias) Tolerancia para pressão (Pa) Tolerancia para saturacao (fr) Max var de saí num DT (fracao) Max var de pres. num DT (KPa) Vazao de oleo maxima (m3/dia) Vazao de oleo mínima (m3/dia) Tempo final de simulacao (dias) Pwf mínima no poco (MPa) Raio do poco (m)
Int. tempo p/ impr.relatorio (dias) Int. tempo p/ impr.grafico (dias)
6
C
10
-SJ.
(13) (13) (13) (F8.3)
(F8.3) TDLP; (F6.4) T0LS= (F6.4)DSLIM! (F8.3)DPLIM: (F8.3)Q0MAX: (F8.3)Q0MIN: (F8.2) TSIM= (F8.3)PWMIN= (F8.4) RW= (F5.1)TIMPR! (F5.1)TIMPG= WRITE(04,6) IRIMP ,DTMAX", DTMIN, ITMAX, ITMIN,JPROD FDRMAT(5X,’Int. células de impressão
Incremento de tempo máximo (dias) Incrementode tempo minimo (dias) N# max de iterações no JACOBIANO N# min de iterações no JACOBIANO Fatia J base para o calculo de Pwf
*» *» *&gt;
*’
c
15
NX NY; NZ===&gt; &gt; DT===&gt;’
==&gt;’
==&gt;' = = &gt;' = = &gt;’ = = &gt;'
&gt;',13,/, &gt;',13,/, ,13,/, ,F8.3,/, ,F8.3,/, ,F6.4,/, ,F6.4,/» ,F8.3,/, ,F8.3,/, ,F8.3,/, ,F8.2,/, &gt;’,F8.3,/, &gt;’,F8.4,/, &gt;\F5.1,/, &gt;’,F5.1)
(13)IRIMP===&gt;’ (F5.1)DTMAX===&gt;’ (F6.4)DTMIN===&gt;’ (I3)ITMAX===&gt;’ (I3)ITMIN===&gt;' (13)JPR0D===&gt;’
,13,/,
&gt;F5.1,/, &gt;F6.4,/, &gt;13,/, ,13,/, ,13,/)
WRITE(04,10)OPT,QOTF,TPTF,TETF,DTTF
FORMAT(3X,’Dados do teste de formacao ,//,
*&gt;	Simulacao de teste de formacao	(S ou N)	DPT===&gt;',A1,/,
	Vazao de produção (m3/dia)	(F8.3)	qOTF===&gt;’,F8.3,/,
* ’	Tempo de fluxo (horas)	(F8.3)	TPTF---&gt;’,F8.3,/,
* ’	Tempo de estática (horas)	(F8.3)	TETF===&gt;’,F8.3,/,
*&gt;	Incr. de tempo no teste (horas)	(F8.3)	DTTF--=&gt;’,F8.3,/)
WRITE(04,15)SWIN,DGAS,CR,PRIN,TEMP,RE,ZC,ZCDW
FORMAT(3XDados do reservatório :’,//,
*’ Saturacao inicial de agua (fracao) (F6.4) SWIN==!SS&gt;’ ,F6.4,/, ♦’ Densidade do gas (adim)	(F6.4) DGAS===&gt;’,F6.4,/,
*’	Compressíbilidade da rocha (1/MPa)	(E9.3)	CR-=-&gt;’,E9.3,/,
*’ Pressão inicial do reservatorio(MPa) (F8.4) PRIN==&gt;’,F8.4,/, *’	Temperatura do reservatório (SC) (F8.4) TEMP===&gt;’,F8.4,/,
♦ *	Raio externo da região do poco (m)	(F8.4)	RE===&gt;1,F8.3,/,
*'	Cota do poco (m)	(F8.3)	ZC===&gt;’,F8.2,/,
30
31
32
C
C
C
50
60
55
65
75
70
80
90
85
95
106
100
C c c
110
WRITE(04,32)PERZ(1,1,1,1)
F0RMAT(5X,'Permeabilidade na direcao jjc Ij2t-Oco*s^)
F0RMAT(5X,’Permeabilidade na direcao
*	blocos’)
F0RMAT(5X,’Permeabilidade na direcao
*	blocos’)
X igual a’,FIO.4,’ para todos
Y igual a1,FIO.4,’ para todos
Z igual a’,FIO.4,’ para todos
GRAVACAO DOS DADDS DE PVT
WRITE(04,50)NP0
F0RMAT(/,3X,’NP0=’,13,' DADDS PVT DO OLEO SATURADO',//,3X,' Pol(MP *a) Bol(m3/m3) Vol(cp) Dol(kg/m3) RSol(m3/m3)’,/)
DQ 55 1=1,NPO
WRITE(04,60)P0L(I),B0L(l),VOL(I),DOL(I),RS0L(I)
F0RMAT(3X,5(F8.3,2X))
CONTINUE
WRITE(04,65)NPOS
F0RMAT(/,3X,’NPOS=’ ,13,' DADOS PVT DO OLEO SUBSATURADD’,//,3X,' Po *ls(MPa) Bols(m3/m3) Vols(cp) Dols(kg/m3)’,/)
DO 70 I=1,NPOS
WRITE(04,75)P0LS(I),BOLS(I),VOLS(I),DOLS(I)
F0RMAT(3X,3(F8.3,2X),4X,F8.3)
CONTINUE
WRITE(04,80)NPW
F0RMAT(/,3X,’NPW=’,13,' DADOS PVT DA AGUA’,//,3X,’ Pwl(MPa) Bwl(m *3/m3) Vwl(cp) Dwl(kg/m3) RSwl(m3/m3)',/)
DO 85 1=1 NPW
WRITE(04,90)PWL(I),BWL(I),VWL(I),DWL(I),RSWL(I)
F0RMAT(3X,5(F9.4,2X))
CONTINUE
WRITE(04,95)NPG
F0RMAT(/,3X,’NPG=’,13,’ DADOS PVT DO GAS ’,//,3X,' Pgl(MPa) Bgl(m *3/m3) Vgl(cp) Dgl(kg/m3)',/)
DO 100 1=1,NPG
WRITE(04,105)PGL(l),BGL(I),VGL(I),DGL(I)
F0RMAT(3X,F8.3,2X,F8.6,2X,F8.5,2X,F8.3)
CONTINUE
GRAVACAO DOS DADOS DE PETROFISICA
WRITE(04,110)NKR
FDRMAT(/,3X,’NKR=',I3,’ DADOS DE PERMEABILIDADE RELATIVA OLEO/AGUA
*',//,3X,' Swl	Krwl	Krol',/)
DO 115 1=1,NKR
WRITE(04,120)SWL(I),KRWL(I),KR0L(I)
120	FORMAT(3X, 3(F8.5,2X))
115 CONTINUE
WRITE(04,125)NPC
125	F0RMAT(/,3X,'NPC=',I3,’ DADOS DE PRESSAO CAPILAR OLEO/AGUA’,//,3X,
*’ Sil Pcow(Pa)’,/)
DO 130 1=1,NPC
WRITE(04,135)SLL(I),PCOWL(I)
135	F0RMAT(3X,2(F12.5,2X))
130 CONTINUE
C
RETURN
END
C------------------------------------------------------------------------
C
-----:----------------------------------------------------------------
SUBROUTINE CONVUNI
C
IMPLICIT DOUBLE PRECISION(A~H,O-Z)
PARAMETER(NLAB=18,NXM=08iNYM=Q5)NZM=04)
C
COMMON/LPVTO/POL,BOL,VOL,DDL,RSOL,POLS,BOLS,VOLS,DDLS,NPO,NPOS
COMMON/LPVTW/PWL ,BWL, VWL,DWL,RSWL,NPW
COMMON/LPVTG/PGL,BGL ,VGL,DGL,NPG
COMMON/LPETR/SWL, KRWL t KROL, SLL ,PCOWL ,NKR, NFC
COMMON/NCEL/DBDX, DBDY, DBDZ, WRC ,NBLOC, NIC, NYC, NZC, NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/SIM/DT,DTMAX,DTMIN ,TOLP ,TOLS, DSLIM ,DPLIM,TSIM,
*	QOMAX,QOMIN,PWMIN,BSORtJPROD,MSOLU,ITMAX,ITMIN
COMMON/RES/DGAS, CR, PRIN, TEMP, ZC, RW, RE, SWIN, PHI, PERX, PERY,
*	PERZ,ZCOW,INDPOR,INDPER
COMMON/IMP/TIMPR,TIMPG,IRIMP
COMMON/TFR/QOTF,TPTF,TETF, DTTF,DTI,TFLUX,BETA, OPT
C
C
DIMENSION POL(NLAB),BOL(NLAB),VOL(NLAB),D0L(NLAB),RSOL(NLAB),
*	POLS(NLAB),BOLS(NLAB), VOLS(NLAB),DOLS(NLAB)
DIMENSION PWL(NLAB),BWL(NLAB),VWL(NLAB),DWL(NLAB),RSWL(NLAB)
DIMENSION PGL(NLAB),BGL(NLAB),VGL(NLAB),DGL(NLAB)
DIMENSION SWL(NLAB),SLL(NLAB),PCOWL(NLAB)
REAL*8 KRWL(NLAB),KR0L(NLAB)
DIMENSION PHI(NXM,NYM,NZM,2),PERX(NXM,NYM,NZM,2),
*	PERY(NXM,NYM,NZM,2),PERZ(NXM,NYM,NZM,2) CHARACTER*! OPT
5
10
15
20
Transforma-se MPa para Pa , cp para kg/s*m , massa esp. para peso esp. DO 5 1=1,NPO
POL(I)=1,0D+06*P0L(I)
V0L(I)=1.0D-03*V0L(I)
D0L(I)=9,8067D0*D0L(l)
BOL(I)=1.ODO/BOL(I)
i CONTINUE
DO 10 1=1,NPOS
PQLS(I)=1.0D+06*P0LS(I)
VOLS(I)=1.00-03*VOLS(I)
D0LS(I)=9.8067D0*D0LS(I)
BOLs£l)=l,ODO/BOLS(I)
CONTINUE
DO 15 1=1,NPW
PWL(I)=1,0D+06*PWL(I)
VWL(I)=1,0D-03*VWL(l)
DWL(I)=9,8067DO*DWL(I) BWL(I)=1,ODO/BWL(I)
CONTINUE
DO 20 1=1,NPG
PGL(I)=1.0D+06*PGL(I)
VGL(I)=1.0D-03*VGL(I) DGL(I)=9.8067D0*DGL(I)
BGL(I)=1.ODO/BGL(I)
DPLlfcl:0D+03*DPLIM
CR=1.0D-06+CR
C
C Transforma-se md para m2- onde lmd=9.869E-16 m2
DO 25 1=1,NXR
DO 25 1=1,NYR DO 25 K=1.NZR
PERX(I,J,K,1)=9.869D-16*PERX(I,J,K,1) PERY(I,J,K,1)=9.869D-16*PERY(I,J,K,1)
PERZ(I, J,K, 1)=59.869D-16*PERZ(I, J,K, 1)
25	CONTINUE
DO 26 1=1,NXC DO 26 J=1,NYC
DO 26 K=1,NZC
PERX(I,J,K,2)®9.869D“16*PERX(I,J,K,2)
PERY(I, J ,K,2)=9,869D-16*PERY(I,J,K,2)
PERZ(I,J,K,2)=9.869D~16*PERZ(I,J,K,2)
26	CONTINUE
GO OOQ o	on
Vazoes de m3/dia para m3/s, tempos de dia ou hora para s
T*3600.ODO 7*3600.ODO
QOMAX=Q0MAX/864OO,ODO Q0MIN=Q0MIN/86400.ODO Q0TF=Q0TF/86400.0D0
DT=DT*86400.ODO DTTF=DTTF*3600.ODO “j’pypss'pp*— - - * - — TETF=TE._ T .____,
DTMAX=DTMAX*86400.ODO DTMIN=DTMIN*86400.ODO TSIM=TSIM*86400.0D0 TIMPR=TIMPR*86400.0D0 TIMPG=TIMPG*86400.0D0
RETURN
END
INICIALIZACAO DE VARIAVEIS DA MALHA (pressões,prop. PVT,trajismissib.)
SUBROUTINE INICIA
IMPLICIT DOUBLE PRECISION(A-H,0~Z)
PARAMETER(NXM=08,NYM=05,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBL0C,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/TS/PO,SO,SG,SW
COMMON/PVT/BO,DBO,VO,DVO,DO, DDO, RSO, DRSO, BW, DBW, VW, DVW, DW, DDW, CW
COMMON/IFACEX/BOMX,VOMX,DOMX,BWMX,VWMX,DWMX
COMMON/IFACEY/BOMY,VOMY,DOMY,BWMY,VWMY,DWMY
COMMON/IFACEZ/BOMZ,VOMZ,DOMZ,BWMZ,VWMZ,DWMZ
COMMON/PETR/KRO,KRW,DKRO,DKRW,PC,DPC
COMMON/DTRANS/TOX,TWX,TOY,TWY,TOZ,TWZ,
*	TOX1SA,TOX1SI,TWX1SA,TWX1SI,
*	T0X2SI,T0X2SP,TWX2SI,TWX2SP,
*	TOY1SA,TQY1SI,TWY1SA,TWY1SI,
*	T0Y2SI,T0Y2SP,TWY2SI,TWY2SP,
*	TOZ1SA,TOZ1SI,TWZ1SA,TWZ1SI,
*	T0Z2SI,T0Z2SP,TWZ2SI,TWZ2SP
DIMENSION P0(0:NXM-H,0:NYM+l,0:NZM+l,2),SO(NXM,NYM,NZM,2),
*	SG(NXM,NYM,NZM,2),SW(NXM,NYM,NZM,2)
DIMENSION BD(NXM,NYM,NZM,2),DBO(O:NXM+1,0:NYM+1,0:NZM+1,2) ,
*	VQ(NXM,NYM,NZM,2),DV0(0:NXM+l,0:NYM+l,0:NZM+l,2),
*	DO(NXM,NYM,NZM,2),DDO(0:NXM+1,0:NYM+1,0:NZM+1,2),
*	BW(NXM,NYM,NZM,2),DBW(O:NXM+1,0:NYM+1,0:NZM+1,2) ,
*	VW(NXM,NYM,NZM,2),DVW(O;NXM+1,0:NYM+1,0:NZM+i,2) ,
*	DW(NXM,NYM,NZM,2),DDW(0:NXM+l,0:NYM+l,0:NZM+l,2),
*	CV(NXM,NYM,NZM,2)
DIMENSION BQMX(O:NXM+1,NYM,NZM,2),VOMX(O:NXM+1,NYM,NZM,2),
*	DOMX(O:NXM+1,NYM,NZM,2),BWMX(O:NXM+1,NYM,NZM,2),
*	VWMX(0:NXM+l,NYM,NZM.2),DWMX(0:NXM+l,NYM,NZM,2)
DIMENSION BOMY(NXM,NYM+1,NZM,2),VOMY(NXM,NYM+1,NZM,2),
*	DOMY(NXM,NYM+1,NZM,2),BWMY (NXM,NYM+1,NZM,2),
*	VWMY(NXM,NYM+1,NZM,2),DWMY(NXM,NYM+1,NZM,2)
DIMENSION BOMZ(NXM,NYM ,NZM+1,2),VOMZ(NXM,NYM,NZM+1,2),
*	DOMZ(NXM,NYM,NZM+1,2),BWMZ(NXM,NYM,NZM+1,2),
*	VWMZ(NXM,NYM,NZM+1,2),DWMZ(NXM,NYM,NZM+1,2)
DIMENSION DKRO(NXM,NYM,NZM,2),DKRW(NXM,NYM,NZM,2),
*	PC(O:NXM+1,O:NYM+1,0:NZM+l,2),DPC(O:NXM+1,O:NYM+1,O:NZM+1,2)
REAL*8	KRO(NXM,NYM,NZM,2),KRW(NXM,NYM,NZM,2)
DIMENSION TOX(NXM+1,NYM,NZM,2),TWX(NXM+1,NYM,NZM,2) ,
*	TOX1SA(NXM,NYM,NZM,2),TOX1SI(NXM,NYM,NZM,2),
*	TWXISA(NXM,NYM,NZM,2),TWX1SI(NXM,NYM,NZM,2),
*	TOX2SI(NXM,NYM,NZM,2),T0X2SP(NXM,NYM,NZM,2),
*	TWX2SI(NXM,NYM,NZM,2),TWX2SP(NXM,NYM,NZM,2)
DIMENSION TOY(NXM,NYM+1,NZM,2),TWY(NXM,NYM+1,NZM,2),
*	TOYISA(NXM, NYM,NZM,2),TOY1SI(NXM,NYM,NZM,2),
*	TWY1SA(NXM,NYM,NZM,2),TWY1SI(NXM,NYM,NZM,2),
*	TOY2SI(NXM,NYM,NZM,2),T0Y2SP(NXM,NYM,NZM, 2) ,
*	TWY2SI(NXM,NYM,NZM,2),TWY2SP(NXM,NYM,NZM,2)
DIMENSION TOZ(NXM,NYM,NZM+1,2),TWZ(NXM,NYM,NZM+1,2),
*	TOZ1SA(NXM,NYM,NZM,2),TOZ1SI(NXM,NYM,NZM,2),
*	TWZISA(NXM,NYM,NZM,2),TWZ1SI(NXM,NYM,NZM,2),
*	TOZ2SI(NXM,NYM,NZM,2),T0Z2SP(NXM,NYM,NZM,2),
*	TWZ2SI(NXM,NYM,NZM,2),TWZ2SP(NXM,NYM,NZM,2)
L=l,2
5
DD 50
LX=NXR
LY=NYR
LZ=NZR
IF&amp;amp;.EQ.2) THEN
LX=NXC
EY=NYC
LZ=NZC
END IF
DO 5 I=1,LX+1
DO 5 J=1,LY
DO 5 K-1,LZ
TOX(I,J,K,L)=O.ODO
TWX(I,J,K,L)=O.ODO
CONTINUE
DO 6 1=1, IX
DO 6 J=1,LY+1 DO 6 K=1,LZ
TOY(I,J,K,L)=O.ODO TWY(I,J,K,L)=O.ODO CONTINUE
DO 10 1=1,LX
DO 10 J=1,LY DO 10 K=1,LZ+1
TOZfl,I,K,L)=O.ODO
TWZ(I,J,K,L)=O.ODO
6
10 CONTINUE
DO 15 I=O,LX+1
DO 15 J=O,LY+1
DO 15 K=O,LZ+1
O O O O QQQa o o o o
o
O
o
o Q O
O O O O O O QQaanci o o o o o o
o o o o o o Q Q QQ Q Q O O O O O O
o o o
o
II
1-4 tH o 1-1 II H II II
II
o II
■rt Tt O &gt;4 i4 O li II II II II II

*—3 i—l d H •—■J •—1
s«a- ttí fetí ¡*¡ w: NI *■ " " " - " P 1	*■"}
OOOOOOOOOO QQQQQQQQQQ OOOOOOOOOO
oooooooooo II II II II II H II II It II
O Q O
o II
d í—3 i—I &gt;—J	1 »—3 &gt;—1 i—3	&gt;—5 *—1

□□□	J
UCuQQQQOaQ
írfll mo Oh oi O a
Min o
HOl C3
QO ua
o o o 5k sé 5r CQ í&gt; O PQ P* O
Esun&amp;lt;oo a-Hc-ia ¡Z¡
HICO Hoi ci as
□o OQ
HOO
HCOQ a oo UQ
tdW O»
WM
E-*H ¡Z¡3¡ oa uu
¡31
UJ Pi
m
O Ol
UO OI
O Cl
oo corn
Q
na non ona ono	ooana	no nnaa	o nnaaoo
SUBROTINA DE LANÇAMENTO DA MALHA,CALCULO DOS PONTOS DE MALHA E DAS SUAS COTAS,CALCULO DOS FATORES DE FORMA E DO PONDERADOR WX E WZ
sÚbrõÜtÍnFgrid
IMPLICIT DOUBLE PRECISION(A-H,O-Z)
PARAMETER(NXM=08,NYM=05,NZM=04,PI=3.141592654D0) COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/RES/DGAS,CR,PRIN,TEMP,ZC,RW,RE,SWIN,PHI,PERX,PERY,
*	PERZ,ZCOW,INDPOR,INDPER
COMMON/TFR/QOTF,TPTFtTETF,DTTF,DTI,TFLUX,BETA,OPT COMMON/MALHA/ZB,RB,VPOR,DRO tWX ,WY,WZ,FFX,FFY,FFZ,DTETA DIMENSION PHI(NXM,NYM,NZM,2),PERX(NXM,NYM,NZM,2),
*	PERY(NXM,NYM , NZM,2),PERZ(NXM,NYM,NZM,2)
DIMENSION ZB(O:NXM+1,NYM,2),RB(NXM+1),VPOR(NXM,NYM,NZM,2),
*	FFX(NXM+1,NYM,NZM,2),FFY(NXM+1,NYM,NZM,2),
*	FFZ(NXM+1,NYM,NZM+1,2),DTETA(NYM+1) CHARACTER*! OPT
GRID RADIAL === calculo das cotas e fatores de forma
Calculo dos raios RB dos grids points ( o raio e o mesmo para as camadas NZR e fatias NYR do mesmo I)
DRO=DLOG(RE/RW)/NXR
ALFA-DEXP(DRO)
ALFA=DEXP((ALFA*ALFA*DRO)/(ALFA*ALFA-1.0D0)-0.5D0) DO 10 1=1,NXR
AUX“RW*DEXP((I~1)*DRO) RB(I)=AUX*ALFA
10 CONTINUE
Formacao do grid
Determinação dos ângulos lado direito
AA=PI/2.OD0
DO 20 J=1,NQL
DTETA(J)=AA/FLOAT(NQL)
20 CONTINUE
lado superior
DO 30 J=(NQL+1),(NQL+NQS) DTETA(J)=AA/FLOAT(NQS) 30 CONTINUE
lado esquerdo
DO 40 J=(NQL+NQS+1),(2*NQL+NQS) DTETA( J)=AA/FLOAT(NqL) 40 CONTINUE
lado inferior
DO 50 J=(2*NQL+NQS+1),NYR DTETA(I)=AA/FLOAT(NQI) 50 CONTINUE
Calculo das cotas de cada grid point
SUMT=(DTETA(1)/2.ODO)-(PI/4.ODO)
DO 100 J=1,NYR
ZB(I,J,1)=ZC+RB(I)*DSIN(SUMT) SUHT=SUMT+(DTETA(J)+DTETA(J+1))/2.ODO IF(OPT,EQ.'S') ZB(I,J,1)=ZC
100 CONTINUE
a aa	o no	non on	non
Ponderadores WX, WY e WZ nas direções X, Y e Z
IF(NXR.GT.2) THEM
WX=((NXR-2)*DRO-DLOG(RB(NXR-2)/RW))/DLOG(RB(NXR-1)/RB(NXR~2))
ELSE
WX=0.5D0
END IF
WY=0.5D0
WZ=Q.5D0
WRC=(RE-RB(NXR))/(RE+DBDX/2.ODO-RB(NXR))
Calculo dos fatores geométricos FFX para a 1# coluna i=l (poco)
para a 1# coluna i=l (poco)
DO 120 K=1,NZR
DO 120 J=1,NYR
FFX(1,J,K,1)=DTETA(J)*DBDZ*PERX(1,J,K,1)/DLOG(RB(1)/RW)
120 CONTINUE
para i=2,NXR ;j=l,NYR ;k=l,NZR
DO 130 1=2, NXR
AUX=RW*DEXP((l-l)*DRO)
DO 130 J=1,NYR
DO 130 K=1,NZR
AUX1=DTETA(J)*DBDZ*PERX(I-1, J, K, 1)*PERX(I, J, K, 1) FFX(I,3,K,1)=AUX1/(PERX(I,J,K,1)*
*	DLOG(AUX/RB(I-1))+PERX(I-l,J,K,1)*DLOG(RB(I)/AUX))
130 CONTINUE
para i=NXR+l ;j=l,NYR
DO 131 J=1,NYR
DO 131 K=1,NZR IF(J.LE.NQL) THEN
IF(IP.EQ.NXC) GO TO 131
IX=IP+1 3x= Jp
AVXK=PERX(IX,JX,KP,2)
ENDIF
IF(J.GT.NQL.AND.J.LE.NQL+NQS) THEN IF(JP.EQ.NYC) GO TO 131 IX=IP
JX=JP+1 AUXK=PERY(IX,JX,KP,2) ENDIF
IF(J.GT.NQL+NQS.AND.J.LE.NQS+2*NQL) THEN IF(IP.EQ.l) GO TO 131
IX»IP-1
JX=JP AUXK=PERX(IX,JX,KP,2) ENDIF
IF(J.GT.NQS+2*NQL) THEN
IF(JP.EQ.l) GO TO 131
JX«JP-1
AUXK=PERY(IX,JX,KP,2)
ENDIF
AUX1=DTETA(J)*DBDZ
FFX(NXR+1, J, K, 1)=AUX1/(DLOG(RE/RB(NXR))/PERX(NXR,J,K,1)*
*	DLOG((RE+DBDX/2.ODO)/RE)/AUXK)
C	FFX(NXR+l,J,K,l)=0,0D0
131 CONTINUE
o m	o ano	o	q no	n no
Calculo dos fatores geométricos FFZ
DO 140 K=2,NZR
DO 140 I=1,NXR
DO 140 J=1,NYR AUX=DTETA(J)*RW*RW*(DEXP(2.0D0*I*DR0)-
*	DEXP(2,0D0*(I~l)*DR0))
FFZ(I,J,K,1)=AUX*PERZ(I,J,K-1,1)*PERZ(I,J,K,1)/
*	(DBDZ*(PERZ(I,J,K-1,1)+PERZ(I,J,K,1)))
140	CONTINUE
Calculo dos fatores geométricos FFZ, para a prim. e ultima face
IF(KP.NE.l) TREN
DO 141 I=1ÍNXR DO 141 J=1,NYR
AUX=DTETA(J)*RW*RW*(DEXP(2.0D0*I*DR0)-
*	DEXP(2.0D0*(I“l)*DR0))
FFZ(I,J,l,í)=AUX*PERZ(IP,JP,KP-l,2)*PERZ(I,J,l,l)/
*	(DBDZ*(PERZ(IP,JP,KP-1,2)+PERZ(I,J,1,1)))
141	CONTINUE
ENDIF
IF(KP+NBP-1.LT.NZC) THEN
DO 142 1=1,NXR DO 142 J=1,NYR
AUX=DTETA(J)*RW*RW*(DEXP(2.ODO*I*DRO)-
*	DEXP(2.ODO*(I-1)*DR0))
FFZ(I,J,NZR+1,1)=AUX*PERZ(I,J,NZR,1)*PERZ(IP,JP,KP+NBP,2)/
*	(DBDZ*(PERZ(I,J,NZR,1)+PERZ(IP,JP,KP+NBP, 2)))
142	CONTINUE
ENDIF
Calculo dos fatores geométricos FFY
ÃÜx=dbdz*drÕ*2.Õdô
DO 150 1=1,NXR
DO 150 J=1,NYR
DO 150 K=1,NZR
JMA=1
IF(J.NE.NYR) JMA=J+1 AUX2=AUX/DTETA(J) FFY(I,J,K,1)=AUX2/(1.0D0/PERY(I,J,K,i)+l.ODO/
*	PERYfl,JMA,K,1))
150 CONTINUE
Impressão para verificacao
WRITE(04,170)
SAREA=0.0D0
DO 160 J=1,NYR
DO 160 1=1,NXR
n on	o na	q na	aanoaa
160
170
180
181
190
200
210
AUX1=RW*DEXP((I-1)*DRO)
AUX2=RW*DEXP(I*DR0)
AUX3=DTETA(J)*(AUX2*AUX2-AUXl*AUXl)/2.ODO
GTETA-DTETA(J)*360.ODO/(2.ODO*PI)
WRITE(04,180)IfJ,AUX1,RB(I),AUX2,ZB(I,J.l).
*	GTETA.AUX3
SAREA=SAREA+AUX3
CONTINUE
FORMAT(//,’	Verificacao dos resultados da Sub GRID',/,
*’ GRID RADIAL’,//,
*/, * BLOGO’,T13,’Ri-1/2 Ri Ri+1/2 Cota Angulo area’, ♦/, ’ I J K’,T16t’mJ,125,’®’,134,’m’,T41,’m graus m2’)
F0RMAT(2(I2,IX),6(F8.2,1X))
WRITE(04,181)SAREA
FORMAT(T32Area total =',F8.2)
WRITE(04,190)
FORMATC//,* BLOCO	FFX	FFY	FEZ’)
DO 200 K=1,NZR+1
DO 200 I=1,NXR+1
DO 200 J=1,NYR WRITE(04,210)I,J,K,FFX(ItJ,K,l),FFY(I,J,K,l),FFZ(I,JiK,l) CONTINUE
F0RMAT(3(I2,lX),3(D14.4ilX))
=== GRID RETANGULAR === calculo das cotas e fatores de forma
Calculo das cotas
IF(OPT.EQ.’S’) THEN
DO 221 I«1,NXC DO 221 J=1,NYC ZB(I,J,2)-ZC
CONTINUE
ELSE
DO 220 1=1,NXC
ZB(I,JP,2)«ZC
Calculo das cotas dos blocos abaixo do poco
SUM=DBDY
DO 230 J=(JP-1),1,-1
ZB(I,J,2)=ZC-SUM
SUM=SUM+DBDY
CONTINUE
Calculo das cotas dos blocos acima do poco
SUM=DBDY
DO 240 J=(JP+1),NYC
ZB(I,J,2)»ZC+SUM SVM=SUM+DBDY
240 CONTINUE
220 CONTINUE
END IF
Calculo dos fatores geométricos FFX para i=2,NX ;j=l,NY
DO 270 1=2,NXC
DO 270 J=1,NYC
DO 270 K=1,NZC
AUX=2.ODO*DBDY*DBDZ*PERX(I-1,J,K,2)*PERX(I,J,K, 2)/DBDX
FFXCI,J,K,2)=AUX/(PERX(I-1,J,K,2)+PERX(I,J,K,2))
270 CONTINUE
OU Ü	UU O	ÜU Q	V ocwu
Calculo dos fatores geométricos FFZ para k-2,NX ;j=l,NY
DO 280 1=1,NXC
DO 280 J=1,NYC
DO 280 K=2,NZC
IF(I.EQ.IP.AND.J.EQ.JP.AND.K.GE,KP.AND.K.LE,KP+NBP)GO TO 280 AUX=2.ODO*DBDX*DBDY*PERZ(I,J,K-l,2)*PERZ(I,J,K,2)/DBDZ FFZ(I,J,K,2)=AUX/(PERZ(I,J,K-1,2)+PERZ(I,J,K,2))
CONTINUE
Calculo dos fatores geométricos FFY
DO 290 J=2,NYC
DO 290 1=1,NXC
DO 290 K=1,NZC
IF(K.GE.KP.AND.K.LT.KP+NBP)THEN
IF(I.EQ.IP.AND.J.EQ.JP.OR.I.EQ.IP.AND,J.EQ.JP+1)GO TO 290 END IF
AUX=2.0D0*DBDX*DBDZ*PERY(I,J-1,K,2)*PERY(I,J,K,2)/DBDY FFYd,J,K,2)=AUX/(PERY(I,J-l,K,2)+PERYd,J,K,2))
290 CONTINUE
Impressão para verificacao
WRITE(04,300)
300 FORMAT(//,’ GRID RETANGULAR', *//,’ BLOCO	FFX	FFY	FFZ1)
DO 310 K=1,NZC
DO 310 1=1,NXC DO 310 J=1,NYC
WRITE(04,320)I,J,K,FFX(I,J,K,2),FFY(I,J,K,2),FFZ(I,J,K,2)
310 CONTINUE	s z
320 FORMAT(3(12,IX),3(D14.4,IX))
DO 250 1=1,NXC
DO 250 J=1,NYC
WRITE(4,26O)I,J,ZB(I,J,2)
260	FORMAT!? 1=’ ,12, ’J=’ ,12,1 CQTA=',F20.12)
250 CONTINUE
RETURN
END
SUBROT. PARA CALC. DAS PRESSÕES E SATURAÇÕES DE AGUA NOS GRIDS POINTS
SUBROUTINE PRESSO(PWF)
IMPLICIT DOUBLE PRECISION(A-H,O-Z)
PARAMETER(NLAB=18,NXM=08,NYM=05,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC, NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/RES/DGAS,CR,PRIN,TEMP,ZC,RW,RE,SWIN,PHI,PERX,PERY,
*	PERZ,ZCOW,INDPOR,INDPER
COMMON/MALHA/ZB,RB,VPOR,DRO,WX,WY,WZ,FFX,FFY,FFZ,DTETA
CDMMON/TSA/POA,SOA,SGA,SWA
COMMON/LPETR/SWL,KRWL,KROL,SLL,PCOWL,NKR,NPC
DIMENSION PHI(NXM,NYM,NZM,2),PERX(NXM,NYM,NZM,2),
*	PERY(NXM,NYM,NZM,2),PERZ(NXM,NYM,NZM,2)
DIMENSION ZB(O:NXM+1,NYM,2),RB(NXM+1),VPOR(NXM,NYM,NZM,2),
*	FFX(NXM+1,NYM,NZM,2),FFY(NXM+1,NYM,NZM,2),
*	FFZ(NXM+1 ,NYM,NZM+1,2),DTETA(NYM+1)
DIMENSION P0A(NXM,NYM,NZM,2),S0A(NXM,NYM,NZM,2),
*	SGA(NXM,NYM,NZM,2),SWA(NXM,NYM,NZM,2)
DIMENSION SWL(NLAB),SLL(NLAB),PCOWL(NLAB)
REAL*8 KRWL(NLAB),KR0L(NLAB)
a oa	Q	o o «9 ri
Pressao de referencia no contato oleo/agua
ZREF=ZCOW
PREF=PRIN
Det. das pressões iniciais nos blocos I, J. Para as camadas K’s se
repetem
DO 60 L-1,2
LX=NXR
LY=NYR
LZ=NZR
IF(L.EQ.2) THEN
LX=NXC
LY=NYC LZ=NZC ENDIF
DO 10 1=1,LX
DO 10 J=1,LY
DO 10 K=1,LZ
P0A(I,J,K,L)=PR(ZB(I,J,L),PREF,ZREF,1) PWA~PR(ZB(I,J, L) ,PREF,ZREF,2) IF(ZB(I,J,L).LT.ZREF) THEN
POA(I,J,K,L)=PWA DPCA=O.0D0 ELSE
DPCA=POA(I,1,K,L)~PWA
ENDIF
Calculo das saturações iniciais
IF(DPCA.LE.O.ODO) SWA(I,J,K,L)=1.ODO IF(DPCA.GT.PCOWL(1)) SWA(I,J,K,L)=SWIN IF(DPCA.GT.0.ODO.AND.DPCA.LE.PCOWL(1))
*	CALL INTERPC(PCOWL,SLL,NPC,DPCA,SWA(I,J,K,L) ,AUX)
10 CONTINUE
PWF=PDA(1,1,1,1)
Impressão para verificacao
IF(L.EQ.l) WRITE(04,70)
IF(L.EQ.2) WRITE(04,80)
FDRMATC//,’
FORMATÍ//,’ WRITE(04,30) FORMATt//,’ *’ Bloco
DO 40 K=1,LZ
DO 40 J=1,LY DO 40 1=1,LX
WRITE(04,50)1,J,K,POA(I,J,K,L)/1.OD+6,SWA(I,J,K,L) F0RMAT(lX,3(I2flX),3X,F10.4,3X,F10.4)
CONTINUE
CONTINUE RETURN END
70
80
30
50
40
60
GRID RADIAL - região do poco’)
GRID RETANGULAR - região do reservatório’)
Impressão para verificacao da sub PRESSO’,//, Pressão (MPa) Saturacao de Agua’)
C
DOUBLE PRECISION FUNCTION PR(ZAUX,PREF,ZREF,IZ)
IMPLICIT DOUBLE PRECISION(A-H.O-Z)
PARAMETER(NLAB=18)
COMMON/LPVTO/POL,BOL,VDL,DOL,RSOL,POLS,BOLS,VOLS,DDLS,NPO,NPOS COMMON/LPVTW/PWL,BWL,VWL ,DWL,RSWL,NPW
DIMENSION POL(NLAB),BOL(NLAB),VOL(NLAB),DOL(NLAB),RSOL(NLAB),
*	POLS(NLAB),BOLS(NLAB), VOLS(NLAB),DOLS(NLAB)
DIMENSION PWL(NLAB),BWL(NLAB),VWL(NLAB),DWL(NLAB),RSWL(NLAB)
5
IF(IZ.EQ.l) THEN
IF(PREF.GE.POLS(1)) THEN
CALL INTER(POLS,DDLS,NPOS,PREF,DORF,YDORF) ELSE
CALL INTER(POL,DOL,NPO,PREF,DORF,YDORF) ENDIF
ET.SE
CALL INTER(PWL,DWL,NPW,PREF,DORF,YDORF) ENDIF
PB=PREF+DORF*(ZREF-ZAUX)
PMED=(PB+PREF)/2.0D0
IF(IZ.EQ.l) THEN
IF(PMED.GE.FOLS(1)) THEN
CALL INTER(POLS,DOLS,NPOS,PMED,DORF,YDORF) KT.SE
CALL INTER(POL,DDL,NPO,PMED,DORF,YDORF) ENDIF
ELSE
CALL INTER(PWL,DWL,NPW,PREF,DORF,YDORF)
ENDIF ,	,
FR=2.ODO*(PMED-PREF)-DORF*(ZREF-ZAUX) DFR=2.ODO-(ZREF-ZAUX)*YDORF
DPMED=-FR/DFR
PMED=PMED+DPMED
IF(DPMED.GT.1.OD-6) THEN
GOTO 5
FT SF
PR=2.ODO*PMED~PREF
ENDIF
ÜUU CIU
RETURN END
CALCULO DOS VOLUMES ORIGINAIS DE OLEO, GAS E AGUA NO RESERVATÓRIO
SUBROUTINE RESERV
IMPLICIT DOUBLE PRECISI0N(A-H,O-Z)
PARAMETER(NXM=08,NYM=05,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,IP,KP
COMMON/ACUM/QOAC,QGAC,QWAC,VOORR,VWORR,VOORC,VWORC,BNPR,BWPR,
*	BNPC,BWPC,PWFA
COMMON/MALHA/ZB,RB,VPOR,DRO,WX,WY,WZ,FFX,FFY,FFZ,DTETA CQMMDN/TSA/POA,SOA,SGA,SWA
COMMON/PVTA/BOA,RSOA,BWA
DIMENSION POA(NXM,NYM,NZM,2),S0A(NXM,NYM,NZM,2),
*	SGA(NXM,NYM,NZM,2),SWA(NXM,NYM,NZM,2)
DIMENSION BOA(NXM,NYM,NZM,2),BWA(NXM,NYM,NZM,2)
DIMENSION ZB(O:NXM+1,NYM,2),RB(NXM+1),VP0R(NXM,NYM,NZM,2),
*	FFX(NXM+i,NYM,NZM,2),FFY(NXM+1,NYM,NZM,2),
*
c
FFZ(NXM+1, NYM,NZM+1,2),DTETA(NYM+1)
ODO ODO ODO ODO ODO ODO
OGU	UQU	GU Ü	UUUOU
VQ0RR=0
VG0RR=0
VWGRR=O
VOORC=O
VGORC=O
VWORC=O.
CALL FPOA
DO 40 L=l,2
IF(L.EQ.l) THEN
GRID RADIAL
WRITE(04,50)
F0RMAT(/,7 GRID RADIAL'bloco	Vp')
DO 6 1=1,NXR
DO 6 J=1,NYR
DO 6 K=1,NZR
VOORR=VOORR+VPOR(I,J,K,L)*SOA(I,J,K,L)*BOA(I,J,K,L) VW0RR=VW0RR+VP0R(I,J,K,L)*SWA(I,J,K,L)*BWA(I,J,K,L) WRITE(04,30)IJJ,K,VP0R(l,J,K,L)
FORMAT(3(I2,IX),IX,F14.2)
CONTINUE
ELSE
GRID CARTESIANO
WRITE(04,60)
60	FORMAT(/,J GRID RETANGULAR',/,' bloco	Vp')
DO 5 I=1,NXC
DO 5 J=1,NYC
DO 5 K=1,NZC
IF(I.EQ,IP.AND.J.EQ.JP.AND.K.GE.KP.AND.K.LT.KP+NBP)GO TO 5 VOOROVODRC+VPORfl, J ,K, L) *SOA (I, J, K, L) *BOA(I, J,K,L) VWORC=VWORC+VPOR(I,J,K,L)*SWA(I,J,K,L)*BWA(I,J,K,L) WRITE(04,30)I,J,K,VPOR(I,J,K,L)
5	CONTINUE
END IF
40 CONTINUE
Impressão para verificacao
WRITE(04,10)VOORR,VWORR,VOORC,VWORC,(VOORR+VOORC),(VWORR+VWORC)
10	F0RMAT(//,’ Verificacao dos volumes originais',/,
*'	Radial	Cartesiano	Total',/,
*'	0IP(m3) WIP(m3) 0IP(m3) WIP(m3) 0IP(m3) WIP(m3)',/,
*3X,6(D9.3,1X))
RETURN
END
SUBROTINA DE CONTROLE DA EXECUCAO DE TESTE DE FORMACAO
SUBROUTINE CTESTE(TESTE,NTS,DT,QOMAX,TEMPI?,NITER)
IMPLICIT DOUBLE PRECISION(A-H,O-Z)
PARAMETER(NLAB=18,NXM=08,NYM=05,NZM=04,PI=3.141592654D0) COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
CQMMON/TFR/QOTF,TPTF,TETF,DTTF,DTI,TFLUX,BETA,OPT COMMON/VAZAO/QO,QOT,QG,QGT,QW,QWT,DQOP,DQOS,
*	DQWP,DQWS,RW0,RGO,PWF,TEMPO
*	PERZ,ZCOW,INDPOR,INDPER
DIMENSION QO(NYM,NZM),QG(NYM,NZM),QW(NYM,NZM),DqOP(NYM,NZM),
*	DQOS(NYM,NZM),DQWP(NYM,NZM),DQWS(NYM,NZM)
DIMENSION B0(NXM,NYM,NZM,2),DBD(0:NXM+1,0:NYM+1,0:NZM+1,2),
*	V0(NXM,NYM,NZM,2),DVO(O:NXM+1,0:NYM+l,0:NZM+1,2),
*	D0(NXM,NYM,NZM,2),DDO(O:NXM+1,0:NYM+1,0:NZM+1,2) ,
*	BW(NXM,NYM,NZM,2),DBW(O:NXM+1,O:NYM+1,O:NZM+1,2) ,
*	VW(NXM,NYM,NZM,2),DVW(0:NXM+l,0:NYM+l,0:NZM+l,2),
*	. DW(NXM,NYM,NZM,2),DDW(O:NXM+l,0:NYM+l,0:NZM+l,2),
*	CW(NXM NYM NZM 2)
DIMENSION PHI(NXM,NYM,NZM,2),PERX(NXM,NYM,NZM,2),
*	PERY(NXM ,NYM,NZM,2),PERZ(NXM,NYM ,NZM,2) LOGICAL TESTE
CHARACTER*1 OPT
C
C1-3600.0D0
C2=1.0D+6
C3=1.0D+3
C Inido do processo, passa-se a usar vazao e DT do teste.
IF(OPT.EQ.’I’) THEN
QOT=QOTF
DT=DTTF OPT='F’ WRITE(12,5) F0RMAT(2X,’Tempo(h) ’Tempo(h) (t+dt)/dt RETURN ENDIF
C Fase de fluxo, ao sen final IFÍOPT.EQ.’F’) THEN
IF(TEMP0/C1.LT.0.0001)
IF(TEMP0/C1.GE.0.0001.AND.TEMPD/C1.LT.0.001) IF(TEMPD/C1.GE.0.001.AND.TEMP0/C1.LT.0.01) IF(TEMP0/C1.GE.0.01. AND.TEMPO/C1.LT.0.1) IF(TEMPO/C1.GE.0.1.AND.TEMP0/C1.LT.1.0) IFÍTEMPD/C1.GE.1.0.AND.TEMPG/C1.LT.10.0) IF(TEMPQ/C1.GE.10.0.AND.TEMP0/C1.LT.100.0) IF(TEMP0/C1.GE.100.0.AND.TEMP0/C1.LT.1000.0) IF(TEMP0/C1.GE.1000.0.AND.TEMP0/C1.LT.10000. DTITF=DTITF*C1 IF(TEMPD.GE.TEMPTF) THEN
DELTP=PRIN-PWF WRITEdZdOTEMPO/C^DSqRTtTEMPO/CD^WF/CZ^ELTP/CS FORMAT(4(E10.5,2X)) TEMPTF=TEMPTF+DTITF
ENDIF
IF(NITER.LE.2) DT=1.5D0+DT IF(DT.GE.DTITF) DT=DTITF
IF(TEMPO.GE.TPTF) THEN CALL IMPRET(DT,OPT,L) QOT-O.ODO RW0=0.0D0 TFLUX=TEMPO DT-DT/12.ODO OPT=’E’ RETURN
ENDIF ENDIF
C Fase de estatica, ao sen final verifica-se se a simul. vai prosseguir.
dsqrt(t) pws (MPa)
vazao de
cc
10
CC CC CC
C
pwf(MPa) pi-pwf(KPa)’,/,2X, pi-pws(KPa)’)
oleo eh nula.
DTITF=0 DTITF=O DTITF=O DTITF=0 DTITF=O DTITF=1
0)
00001
0001
001
01
1
0
DTITFdO.O
DTITF=100.0
DTITF=1000.0
5
*
11
15
IF(OPT.EQ.’E1) THEN
HORN=TEMPO/(TEMPO-TFLUX) DELTP=PRIN-PWF
WRITE(12,11)TEMPO/Cl,HORN,PWF/C2,DELTP/C3
FORMAT(4(El2.6,IX))
IF(TEMPO.GE.(TPTF+24.ODO*DT)) DT=DTTF
IF(TEMPO.GE.(TETF+TPTF)) THEN
CALL IMPRET(DT,OPT,L)
PRINT*/FINAL DO TESTE DE FORMACAD'
PRINT*/DESEJA PROSSEGUIR COM A SIMULACAO S ou N READ(*,15)OPT FORMAT(Al)
IF(OPT.NE.JS’) THEN
PRINT*/FINAL DO PROGRAMA, APENAS REALIZADO TFR' STOP
ELSE
TEMPO=O.ODO
NTS=0
DT=DTI qOT=QOMAX TESTE=.FALSE.
END IF
ENDIF
ENDIF
nno	o aaQônao
RETURN END
CALCULO DAS PROPRIEDADES DOS FLUIDOS DEPENDENTES DAS PRESSÕES NA ITERACAO ANTERIOR (passo de tempo n)
a partir desta sub nao existe po(ip,jp,kp,l) e sw(ip,jp,kp,l)
SUBROUTINE FPOA
IMPLICIT DOUBLE PRECISION(A~H,O~Z)
PARAMETER(NLAB~18,NXM=08,NYM=05,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/LPVTO/POL,BOL,VOL,DOL,RSOL,POLS,BQLS,VOLS,DOLS,NPO,NPOS
COMMON/LPVTW/PWL,BWL, VWL,DWL,RSWL,NPW
COMMON/TSA/POA,SOA,SGA,SWA
COMMON/PVTA/BOA,RSOA,BWA
DIMENSION POL(NLAB),BOL(NLAB),V0L(NLAB),DOL(NLAB),RS0L(NLAB),
*	POLS(NLAB) ,BOLS(NLAB),VOLS(NLAB),DOLS(NLAB)
DIMENSION PWL(NLAB).BWL(NLAB),VWL(NLAB),DWL(NLAB),RSWL(NLAB)
DIMENSION PDA(NXM,NYM,NZM,2),S0A(NXM,NYM,NZM,2),
*	S GA(NXM,NYM,NZM,2),SWA(NXM,NYM,NZM,2)
DIMENSION BOA(NXM,NYM,NZM,2),BWA(NXM,NYM,NZM,2)
Funcoes de POA
LX-NXR
LY=NYR
LZ=NZR
DO 10 L=i,2
IF(L.EQ.2) THEN
LX=NXC LY-NYC
ENDIF
LZ=NZC
DO 5 1=1,LX
DO 5 J=T ,LY
DO 5 K=1,LZ
*
CONTINUE
CONTINUE
RETURN END
IF(L.EQ.2.AND.I.EQ.IP.AND.J.EQ.JP.AND.
K.GE.KP.AND.K-LT.KP+NBP) GO TO 5
IF(POA(I,J,K,L).GE.POLS(i)) THEN
CALL INTER(PGLS,BOLS,NPOS,POA(I,J,K,L),BOA(I,J,K,L),AUX) ELSE
CALL INTER(POL,BOL,NPO,POA(I,J,K,L),BOA(I,J,K,L),AUX) ENDIF
CALL INTER(PWL,BWL,NPW,POA(I,J,K,L),BWA(I,J,K,L),AUX)
ono	a nannao
CALCULO DAS PROPRIEDADES DOS FLUIDOS DEPENDENTES DAS PRESSÕES NA ITERACAO PRESENTE E DAS PRESSÕES NA INTERFACES
SUBROUTINE FPPOM(PWF,WX,WY,WZ)
IMPLICIT DOUBLE PRECISION(A-H,O-Z)
PARAMETER(NLAB=18,NXM=08,NYM=05,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLDC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZRJ$QL,NQS,11QI,IP,JP,KP
COMMON/LPVTO/POL,BOL,VOL,DOL,RSOL,POLS,BOLS,VOLS,DOLS &gt;NPO,NPOS
COMMON/LPVTW/PWL,BWL,VWL,DWL,RSWL,NPW
COMMON/LPVTG/PGL,BGL,VGL,DGL,NPG
COMMON/TS/PO,SO,SG,SW
COMMON/PVT/BO,DBO,VO,DVO,DO,DDO,RSO,DRSO,BW,DBW,VW,DVW,DW,DDW,CW COMMON/IFACEX/BOMX,VOMX,DOMX,BWMX,VWMX,DWMX
COMMON/IFACEY/BOMY ,VOMY,DOMY,BWMY,VWMY,DWMY
COMMON/IFACEZ/BOMZ,VOMZ,DOMZ , BWMZ ,VWMZ,DWMZ
DIMENSION POL(NLAB) , BOL (NUB) ,VOL(NLAB) ,DOL(NLAB) ,RSOL(NLAB) ,
*	POLS(NLAB),BOLS(NLAB),VOLS(NLAB),DOLS(NLAB)
DIMENSION PWL(NLAB),BWL(NLAB),VWL(NLAB),DWL(NLAB),RSWL(NLAB)
DIMENSION PGL(NLAB),BGL(NLAB),VGL(NLAB),DGL(NLAB)
DIMENSION PO(0:NXM+1,O:NYM+1,0:NZM+1,2),S0(NXM,NYM,NZM,2),
*	SG(NXM,NYM,NZM,2) ,SW(NXM,NYM,NZM,2)
DIMENSION BO(NXM,NYM,NZM,2),DBD(O:NXM+1,0:NYM+1,0:NZM+1,2),
*	VO(NXM,NYM,NZM,2),DVO(O:NXM+1,0:NYM+1,0:NZM+1,2) ,
*	DO(NXM,NYM,NZM,2),DDO(O:NXM+1,0:NYM+1,0:NZM+1,2) ,
*	BW(NXM,NYM,NZM,2),DBW(0:NXM+l,0:NYM+l,0:NZM+l,2),
*	VW(NXM,NYM,NZM,2) ,DVW(O:NXM+1,O:NYM+1,O:NZM+1,2) ,
*	DW(NXM,NYM,NZM,2),DDW(O:NXM+1,0 :NYM+1,0:NZM+1,2),
*	CW(NXM,NYM,NZM,2)
DIMENSION BOMX(0:NXM+1,NYM,NZM,2),VOMX(0:NXM+1,NYM,NZM,2),
*	DOMX(0:NXM+1,NYM,NZM,2),BWMX(0:NXM+1, NYM ,NZM,2),
*	VWMX(0:NXM+l,NYM,NZM,2),DWMX(0:NXM+1,NYM,NZM,2)
DIMENSION BOMY(NXM,NYM+1,NZM,2),VOMY(NXM,NYM+1,NZM,2),
*	DOMY(NXM,NYM+1,NZM,2),BWMY(NXM,NYM+1, NZM,2),
*	VWMY(NXM,NYM+1,NZM,2),DWMY(NXM,NYM+1,NZM,2)
DIMENSION BOMZ(NXM,NYM,NZM+1, 2),VOMZ(NXM,NYM,NZM+1,2),
*	DOMZ(NXM,NYM,NZM+1, 2),BWMZ(NXM,NYM,NZM+1,2),
*	VWMZ(NXM,NYM,NZM+1,2),DWMZ(NXM,NYM,NZM+1,2)
ooa	non a no	nano
5
DO 4 L=l,2
IF(L.EQ.2) THEN
NX=NXC
NY=NYC
NZ=NZC
ENDIF
DO 5 1=1,NX
DO 5 J=1,NY
DO 5 K=13NZ
IF(L.EQ.2.AND.I.EQ.IP.AND.J.EQ.JP.AND.
*	K.GE.KP.AND.K.LT.KP+NBP) GO TO 5
IF(PO(I,JtK,L).GT.POLS(l)) THEN
CALL	'	‘	'
CALL
CALL
ELSE
CALL
CALL
CALL
ENDIF
CALL INTER(PWL,BWL,NPW,PD(I,J,K,L),BW(I,J,K,L),DBW(I,J,K,L)&gt; CALL INTER(PWL,VWL3NPW,PO(I,J,K,L),VW(I,J,K,L),DVW(I,J,K,L)) CALL INTER(PWL,DWL,NPW,PD(I,J,K3L) ,DWd, J,K,L) ,DDW(I, J,K,L)) CW(I,J,K3L)=DDW(I,J,K,L)/DW(I,J3K3L)
CONTINUE
INTER(POLSJBOLS,NPOS3PO(IiJ,K,L),BO(IlJ,K,L) ,DBO(I, J,K,L) )
INTERCPOLSjVOLS,NP0S3P0(I,J,K,L)fV0(I,JjK,L),DV0(I,J,K,L)) INTER(P£JLS,DQLS,NPOS,POd,J,K,L),DOd,J,K3L)fDDOd,J,K3L))
INTER(PDL,BOLfNPO,POd,J,K,L),BOd,J,K,L) iDBD(IIJ3K3L)) INTER(POL,VOL,NPO,PO(I,J,KtL),V0(I3J,K,L) ,DVO(I,J,K,L)) INTER(POL,DOL3NPO,POd,J,K,L),DOd,J,K,L),DDOd,J,K&gt;L))
Funcoes PVT das pr. nas interfaces X,Y e Z internas (usam sub. saux.) Interface d3j3k) - face do poco GRID RADIAL
IF(L.EQ.l) THEN
DO 10 J=1,NY
DO 10 K=1,NZ
CALL SAUX(PWFtBOMX(l,J,K,L),VOMX(1,J,K,L),DOMX(1,J,K3L) ,
*	BWMX(13J,K,L),VWMX(1,J,K,L) ,DWMXd,J,K,L))
10	CONTINUE
ENDIF
Interfaces X (apenas as interfaces internas da malha) Na face externa3I-NX+l, e 1=0 as funcoes sao iguais a ZERO
cartesiano
IF(L.EQ.2) THEN
W=0.EDO
DO 20 1=2,NX
DO 20 J=1,NY
DO 20 K=ljNZ IF(K.GE.KP.AND.K.LT.KP+NBP) THEN
IF(I-EQ.IP.AND.J.EQ.JP.OR.I.EQ.IP+1.AND.J,EQ.JP) GO TO 20 ENDIF
P0M=(1.ODO-W)*P0(I-1,J,K»L)+W*P0(I, J, K, L)
CALL SAUX(P0M3B0MXd,J,K,L)3V0NX(I,J,K3L) 3D0MX(I, J,K,L) ,
*	BWMXd,J,K,L),VWMX(I,J,K3L) ,DWMX(I, J ,K ,L) )
20 CONTINUE
ENDIF
radial
IF(L.EQ.l) THEN
DO 21 1=2,NX
DO 21 J-1,NY
DO 21 K=13NZ
*
*
*
21
IF(I.EQ.NX) THEN
IF(J.LE.NQL) then
IF(IP.EQ.NXC) GO TO 21
IX-IP+1
JX=JP
ENDIF
IF(J.GT.NQL.AND.J.LE.Nqt+NQS) THEN
IF(IP.EQ.NYC) GO TO 21
IX=IP
JX=JP+1
ENDIF
IF(J.GT.NQL+NQS.AND.J.LE.NQS+2*NQL) THEN IF(IP.EQ.l) GO TO 21 IX=IP-1 JX=JP
ENDIF
IF(J.GT.NQS+2*NQL) THEN
IF(JP.EQ.l) GO TO 21
IX-IP
JX=JP-1
ENDIF
P0M=(1.ODO-WRC)*PO(NX,J,K,1)+WRC*PO(IX,JX,KP+K-1,2)
CALL SAUX(POM,BOMX(I+1,J,K,1),V0MX(I+l,J,K,1), DOMX(I+1,J,K,1),BWMX(I+1,J,K,1), VWMX(I+1,J,K,1),DWMX(I+1,J,K,1))
ENDIF
POM=(1.ODO-WX)*PO(I-1,J,K,1)+WX*PO(I,J,K,L)
CALL SAUX(POM,BOMX(I&gt; JjKiLXVOMXtl, J,K,L) ,DOMX(I,J,KtL) , BWMX(I,J,K,L),VWMX(I,J,K,L),DWMX(I,J,K,L))
o ao	o oo
CONTINUE END IF
Interfaces 2 (apenas as interfaces internas da malha)
DO 40 1*1,NX
DO 40 J=1,NY
DO 40 K=2,NZ IF(L.EQ.2.AND.I.EQ.IP.AND.J.EQ.JP) THEN IF(K.GE.KP.AND.K.LT.KP+NBP) GO TO 40 ENDIF
POM*(1.0D0-WZ)*P0(I,J,K~1,L)+WZ*PO(I,J,K,L)
CALL SAUX(POM,BOMZ(I,J,K,L),VDMZ(I,J,K,L),DOMZ(I,J,K,L) ,
*	BWMZ(I,J,K,L),VWMZ(I,J,K,L) ,DWMZ(I,J,K,L))
40 CONTINUE
Interfaces Z (primeira e ultima face para o grid radial)
*
IF(L.EQ.l) THEN
IF(KP.NE.l) THEN
DO 41 1=1,NX
DO 41 J*1,NY
P0M»(1.0D0-WZ)*P0dP,JP,KP-l,2)+WZ*P0d, J ,1,1)
CALL SAUX(POM,BOMZ(I,J,1,1),V0MZ(I,J,1,1),D0MZ(I,J,1,1) , BWMZ(I,J,1,1),VWMZ(I,J,1,1),DWMZ(I,J,1,1))
CONTINUE
ENDIF
IF(KP+NBP-1.LT.NZC) THEN
DO 42 1=1,NX
DO 42 J=1 NY
POM=(1.ODO-WZ)*PO(I,J,NZR,1)+WZ*PO(IP,JP,KP+NBP,2)
CALL SAUX(POM,BOMZ(I,J,NZR+l,l),VOMZd,J,NZR+l,l),
*	DOMZ(I,J,NZR+1,1),BWMZ(I,J,NZR+1,1),
*
42
CONTINUE ENDIF
ENDIF
VWMZ(I , J (NZR+1, 1) ,DWMZ(I , J,NZR+1, 1) )
ÓOÓ	O ÓOUW	Ü	u UUOOÜO
Interfaces Y (apenas as interfaces internas da malha)
LINF=1
LSUP=NY
IF(L.EQ.2) THEN
LINF=2
ENDIF
DO 50
DO
*
1=1,NX
50 J=LINF,LSUP
DO 50 K=1,NZ IF(L.EQ.2.AND.K.GE.KP.AND.K.LT.KP+NBP) THEN
IFd.EQ.IP.AND.J.EQ.JP. OR.
I.EQ.IP.AND.J.EQ.JP+1) GO TO 50 ENDIF
AUXP=PO(I,J"1,K,L)
IF(L.EQ,1.AND,J.EQ.1) AUXP=PO(I,NY,K,L) P0M=(1.ODO-WY)*AUXP+WY*PO(I,J,K,L)
CALL SAVX(P0M,B0MY(I,J}K,L) ,V0MY(I,J,K,L) ,D0MY(I, J,K,L) ,
BWMY(I,J,K,L),VWMY(I,J,K,L) ,DWMY(I,J,K,L))
CONTINUE CONTINUE
RETURN END
Subrot. auxiliar para calculo das funcoes das pressoes nas interfaces
SUBROUTINE SAUX(P0M,BOM,VOM,DOM,BWM,VWM,DWM)
IMPLICIT DOUBLE PRECISI0N(A-H,0-Z)
PARAMETER(NLAB=18)
C0MM0N/LPVT0/P0L,BOL, VOL,DOL,RSOL,POLS,BOLS,VOLS,DOLS,NPO,NPOS
COMMDN/LPVTW/PWL,BWL, VWL,DHL,RSWL,NPW
DIMENSION PDL(NLAB) ,BOL(NLAB) ,VOL(NLAB) ,DOL(NLAB) ,RSOL(NLAB) ,
*	POLS(NLAB),BOLS(NLAB),VOLS(NLAB),DOLS(NLAB)
DIMENSION PWL(NLAB),BWL(NLAB),VWL(NLAB),DWL(NLAB),RSWL(NLAB)
IF(POM.GT.POLS(1)) THEN
CALL INTER(POLS,BOLS,NPOS,POM,BOM,AUX)
CALL INTER(POLS,VOLS,NPOS,P0M,V0M,AUX)
CALL INTER (POLS &gt;DOLS,NPOS , POM,DOM,AUX)
ELSE
CALL INTER(POL,BOL,NPO,POM,BOM,AUX)
CALL INTER(POL, VOL,NPO,POM,VOM,AUX)
CALL INTER (POL,DOL,NPO,POM,DOM,AUX)
ENDIF
CALL INTER(PWL,BWL,NPW,POM,BWM,AUX)
CALL INTER(PWL,VWL,NPW,POM,VWM,AUX)
CALL INTERtPWL,DWL,NPW,POM,DWM,AUX)
RETURN
END
SUBROUTINE TRANS
C
IMPLICIT DOUBLE PRECISION(A~H,O-Z)
PARAMETER(NLAB=18,NXM-08,NYM=05,NZM=O4)
COMMON/SIM/DT,DTMAX,DTMIN,TOLP,TOLS,DSLIM,DPLIM,TSIM,
*	QOMAX,QOMIN,PWMIN,BSOR,JPRDD.MSOLU,ITMAX,ITMIN COMMON/NCEL/DBDX, DBDY, DBDZ, WRC ,NBLOC ,NXC, NYC, NZC, NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/RES/DGAS,CR,PRIN,TEMP,ZC,RW,RE,SWIN,PHI,PERX,PERY,
*	PERZ,ZCOW,INDPOR &gt;INDPER
COMMON/LPETR/SWL,KRWL tKROL,SLL ,PCOWL,NKR,NPC COMMON/MALHA/ZB,RB,VPOR,DRO,WX,WY,WZ,FFX,FFY,FEZ,DTETA COMMON/TS/PO,SO,SG,SW
COMMON/IFACEX/BOMX,VOMX,DOMX,BWMX,VWMX,DWMX
COMMON/IFACEY/BOMY,VOMY,DDMY,BWMY,VWMY,DWMY
COMMON/IFACEZ/BOMZ,VOMZ,DOMZ ,BWMZ,VWMZ,DWMZ COMMON/PETR/KRO , KRW,DKRO,DKRW,PC,DPC COMMON/DTRANS/TOX,TWX,TOY,TWY,TOZ,THZ,
*	TOX1SA,TOX1SI,TWX1SA,TWX1SI,
*	T0X2SI,T0X2SP,TWX2SI,TWX2SP,
*	TOY1SA,TOY1SI,TWY1SA,TWY1SI,
*	T0Y2SI,T0Y2SP,TWY2SI,TWY2SP,
*	TOZ1SA,TOZ1SI,TWZ1SA,TWZ1SI,
*	T0Z2SI,T0Z2SP,TWZ2SI,TWZ2SP
COMMON/TF/TFLUXO,TFLUXW,SUMTO,SUMTW,AFXO,AFXW
DIMENSION SWL(NLAB),SLL(NLAB),PCOWL(NLAB)
REAL+8 KRWL(NLAB),KROL(NLAB)
DIMENSION ZB(O:NXM+1,NYM,2),RB(NXM+1),VP0R(NXM,NYM,NZM,2),
*	FFX(NXM+1,NYM,NZM,2),FFY(NXM+1,NYM,NZM,2),
*	FFZ(NXM+1,NYM,NZM+1,2),DTETA(NYM+1)
DIMENSION PO(0:NXM+1,O:NYM+1,O:NZM+1,2),S0(NXM,NYM,NZM,2),
*	SG(NXM,NYM,NZM,2),SW(NXM,NYM,NZM,2)
DIMENSION PHI(NXM,NYM,NZM,2),PERX(NXM,NYM,NZM,2),
*	PERY(NXM,NYM,NZM,2),PERZ(NXM,NYM,NZM,2) DIMENSION BOMX(0:NXM+1,NYM,NZM,2),VOMX(0:NXM+1,NYM,NZM,2),
*	DOMX(O:NXM+1,NYM,NZM,2),BWMX(O:NXM+1,NYM,NZM,2),
*	VWMX(O:NXM+1,NYM,NZM,2),DWMX(0:NXM+1,NYM,NZM,2)
DIMENSION B0MY(NXM,NYM+l,NZM,2),V0MY(NXM,NYM+l,NZM,2),
*	DOMY(NXM,NYM+1,NZM,2),BWMY(NXM,NYM+1,NZM,2),
*	VWMY (NXM, NYM+1, NZM, 2 ), DWMY (NXM, NYM+1, NZM, 2 )
DIMENSION BOMZ(NXM,NYM,NZM+1,2), VOMZ(NXM,NYM,NZM+1,2),
*	DOMZ(NXM,NYM,NZM+1,2),BWMZ(NXM,NYM,NZM+1,2),
*	VWMZ (NXM, NYM, NZM+1,2), DWMZ (NXM, NYM, NZM+1,2) DIMENSION DKRO(NXM,NYM,NZM,2),DKRW(NXM,NYM,NZM,2),
*	PC(0:NXM+1,O:NYM+1,0:NZM+1,2),DPC(O:NXM+1,0:NYM+1,0:NZM+1,2)
REAL*8	KRO(NXM,NYM,NZM,2),KRW(NXM,NYM,NZM,2)
DIMENSION TOX(NXM+1,NYM,NZM,2),TWX(NXM+1,NYM,NZM,2),
*	TOX1SA(NXM,NYM,NZM,2),TOX1SI(NXM,NYM,NZM,2),
*	TWX1SA(NXM,NYM,NZM,2),TWX1SI(NXM,NYM,NZM,2),
*	T0X2SI(NXM,NYM,NZM,2),T0X2SP(NXM,NYM,NZM,2),
*	TWX2SI(NXM,NYM,NZM,2),TWX2SP(NXM,NYM,NZM,2)
DIMENSION T0Y(NXM,NYM+l,NZM,2),TWY(NXM,NYM+1,NZM,2),
*	TOYISA(NXM,NYM,NZM,2),TOY1SI(NXM,NYM,NZM,2),
*	TWY1SA(NXM,NYM,NZM,2),TWY1SI(NXM,NYM,NZM,2),
*	T0Y2SI(NXM,NYM,NZM,2),T0Y2SP(NXM,NYM,NZM,2),
*	TWY2SI(NXM,NYM,NZM,2),TWY2SP(NXM,NYM,NZM,2)
a o a a ao	q	a o oao q a aa	n	an qq
DIMENSION	TOZ(NXM,NYM,NZM+1,2),TWZ(NXM,NYM,NZM+1,2),
*	T0ZlSA(NXM,NYM,NZMt2),TOZ1SI(NXM,NYM,NZM,2),
*	TWZ1SA(NXM,NYM,NZM,2),TWZ1SI(NXM,NYM,NZM,2),
*	T0Z2SI(NXM,NYM,NZM,2),TOZ2SP(NXM,NYM,NZM,2),
*	TWZ2SI(NXM,NYM,NZM,2),TWZ2SP(NXM,NYM,NZM,2)
INTEGER	DELTO,DELTW,DTD(NYM,NYM), DTW(NYM,NYM)
Det, de perm, relat, ao oleo e a agua,pressões capilares e derivadas
DO 1 1=1,NXR
DO 1 1=1,NYR
DO 1 K=1,NZR
CALL INTER(SWL,KROL,NKR,SW(I,J,K,1),KRD(I,J,K,1),DKR0(I,J,K,1))
CALL INTER(SWL,KRWL,NKR,SW(I,1,K,1),KRW(I,J,K,1),DKRW(I,1,K,1))
CALL INTER(SLL,PCOWL,NPC,SW(I,J,K,1),PC(I,J,K,1),DPC(I,J,K,1))
CONTINUE
DO 2 1=1,NXC
DO 2 1=1,NYC
DO 2 K=1,NZC
IF(I,EQ.IP.AND.J.EQ.JP.AND.K.GE.KP.AND.K.LT.KP+NBP) GO TO 2
CALL INTER(SWL,KROL,NKR,SW(I,1,K,2),KR0(I,J,K,2),DKR0(I,J,K,2))
CALL INTER(SWL,KRWL,NKR,SW(I,J,K,2),KRW(I,J,K,2),DKRW(I,J,K,2))
CALL INTER(SLL,PC0WL,NPC,SW(I,l,K,2),PC(I,J,K,2),DPC(I,J,K,2)) CONTINUE
NX=NXR
NY=NYR
NZ=NZR
DO 1000 L=l,2
IF(L.EQ.2) THEN
Verificacao dos sentidos de fluxo para as fases oleo e agua para "head" positivo :delto e deltw =1 (fluxo para o poco) para ’’head" negativo : deito e deltw =0 (fluxo contra o poco)
Blocos do poco - GRID RADIAL
Transmissibilidades ao oleo e a agua no poco ,derivadas dT/dSw
IF(L.EQ.l) THEN
00 40 1=1,NY
DO 40 K=1,NZ
TOX(1,1,K,L)=FFX(1,1,K,L)*BOMX(1,I,K,L)*KRO(1,1,K,L)/VQMX(1,1,K,L)
TWX(l,J,K,L)=FFX(l,J,K,L)*BWMX(l,I,K,L)*KRW(i,J,K,L)/VWMX(l,J,K,L)
T0X1SI(1,J,K,L)=FFX(1,1,K,L)*BOMX(1,I,K,L)*DKRO(1,1,K,L)/
*	VOMX(1,1,K,L)
TWX1SI(1,1,K,L)=FFX(1,J,K,L)*BWMX(1,J,K,L)*DKRW(1,J,K,L)/
*	VWMX(1,J,K,L)
40 CONTINUE
END IF
a a,C3	o n
Blocos (l,jtk)
DD 50 &gt;1,NY
DO 50 K=1,NZ IFÍL.EQ.Z.AND.K.GE.KP.AND.K.LT.KP+NBP) THEN
IF(IP.EQ.1.AND.J.EQ.JP.OR.
*	IP.EQ.2.AND.J.EQ.JP) GO TO 50 ENDIF
HEAD=P0(2,J,K,L)-PO(1,J,K,L)+D0MX(2,J,K,L)*(ZB(2,J.Lj-ZBCl,Jt L) ) DELTO=1
IF(HEAD.LT.O.ODO) delto=o
HEAD»PO(2,J,KiL)-PO(líJ,K&gt;L)-PC(2,J,K,L)+PC(1,J,K,L)+
*	DWMX(2,J,K,L)*(ZB(2,J,L)-ZB(1,J,L)) DELTW=1
IF(HEAD.LT.O.ODO) DELTW=0 T0X2SI(1,J,K,L)=(1-DELTO)*FFX(2,J,K,L)*B0MX(2,JjKjL)*
*	DKR0(1jJ)KiL)/V0MX(2,JiK,L)
T0X2SP(l,J,K,L)=DELT0*FFX(2,J,K,L)*B0MX(2,J,K,L)*
*	DKR0(2,J,K,L)/V0MX(2,JíK,L)
TWX2SIÍ1,J,K1L)=(1-DELTW)*FFX(2,J,K,L)*BWMX(2,JjKjL)*
*	DKRW(1,J,K,L)/VWMX(2,J,K,L) TWX2SP(1,J,K,L)=DELTW*FFX(2,J,K}L)*BWMX(2,J,K,L&gt;*
*	DKRW(2,J,K,L)/VWMX(2,J,K,L) DT0(J,K)=DELT0
DTW(J,K)«DELTW
50 CONTINUE
INTERFACES X:Transmissib. ao oleo e a agua e suas derivadas dT/dSw
DO 10 K=1,NZ
DO 10 J=1,NY
DO 10 I«2,NX-1
IFÍI.EQ.2) THEN
DELTQ=DTO(J,K)
DELTW=DTW(J,K)
ENDIF
IF(L.EQ.2.AND.K.GE.KP.AND.K.LT.KP+NBP) THEN
IF(I.EQ.IP.AND.J.EQ.JP) GO TO 10
IF(I.EQ.IP+1.AND.J.EQ.JP)GO TO 11
ENDIF
T0X(I,J,K,L)=DELTD*FFX(I,J,K,L)*BOMX(I,J,K,L)*KRO(I,J,K,L)/
*	VOMXÍI.JXLJ + Cl-DELTO^FFXCI.JJC.L)*
*	BOMX(I,J,K,L)*KRO(I-1,J,K,L)/VOMX(I,J,K,L)
TWX(I,JíKjL)=DELTW*FFX(I,j,k,l)*bwmx(i,j,k,l)*krw(i,j,k,l)/
*	VWMX(I,JíK)L) + (1-DEI.TW)*FFX(I)JjK,L)*
*	BWMX(I,J)K)L)*KRW(I-1,JjKiL)/WMX(I,J,K)L)
TOX1SA(I,J,K,L)^(1-DELTO)*FFX(I,J,K,L)*BOMX(I,J,K,L)*’
*	DKRO(I-1,J,K,L)/VOMX(I,J,K,L) TOXlSI(I,J,K,L)=DELTD*FFX(I,J,KtL)*BOMX(I,J,K,L)*DKRO(I,J,K,L)/
*	V0MX(I,J,K,L)
TWXlSAd,J,K,L)B&lt;l-DELTW)*FFXd,J,K,L)*BWMXd,J,K,L)*
*	DKRW(I-1,J,KjL)/VWMX(I,JjK,L)
TWX1SI(I,J,K,L)=DELTW*FFX(I,JJK&gt;L)*BWMX(I,J,K,L)*
*	DKRWCI, J,K,L)/WMX(I,J,K,L)
C Repete-se a verificacao do sentido de fluxo para a próxima interface X
IFCL.EQ.2.AND.I.EQ.IP-1.AND.J.EQ.JP)GO TO 10
11	HEAD=PO(I+1,JíK)L)-P0(IiJjKjL)+D0MX(I+1jJ,K,L)*
*	(ZBd+l,J,L)-ZBd,J,L))
1Õ9
DELTO=Í.
IF (HEAD. LT. 0. ODO) DELTOO
HEAD=PO(I+1,J,K,L)-P0(I,J,K,L)-PC(I+1,J,K,L)+PC(I,J,K,L)+
*	DWMX(I+1,J,K,L)*(ZB(I+1,J,L)-ZB(I,J,L&gt;)
deltw=i
IF(HEAD.LT.0.ODO) DELTW=0
T0X2SI(I, J ,K,L)SS(1-DELTO)*FFX(I+1, J,K,L)*BOMX(I+1,J,K,L)*
*	DKR0(I,J,K,L)/VOMX(I+1,J,K,L)
T0X2SP(I,J,K,L)«DELTO*FFX(I+1,J,K,L)*BOMX(I+1,J,K,L)*
*	DKRO(I+1,J,K,L)/VOMX(I+1,J,K,L)
TWX2SI(I,J,KfL)=(l-DELTW)*FFX(I+l,J,K,L)*BWMX(I+1,J,K,L)*
*	DKRW(I,J,K,L)/VWMX(I+1,J,K,L)
TWX2SP(I, J ,K,L)=DELTW*FFX(I+1, J,K,L)*BWMX(I+1, J ,K,L) *
*	DKRW(I+1,J,K,L)/VWMX(I+1,J,K,L)
C
10	CONTINUE
a on no
INTERF.X:Transmissib. ao oleo e a agua e suas derivadas dT/dSw na ULTIMA COLUNA de celulas (no limite do reserv. To e Tw = 0)
Repete-se a verificacao do sentido de fluxo nas interfaces X
*
*
*
*
*
*
*
C
*
*
*
DC 20 1=1,NY
DO 20 K=1,NZ
IF(L.EQ.2.AND.K,GE.KP.AND.K,LT.KP+NBP) THEN
IF(IP.EQ.NX-1.AND.J.EQ.JP.OR.
IP.EQ.NX.AND.J.EQ.JP) GO TO 20 ENDIF	v
HEAD=PO(NX,J,K,L)-PO(NX-1,J,K,L)+DOMX(NX,J,K,L)* (ZB(NX,J,L)-ZB(NX-1,J,L))
DELTO=1
IF(HEAD.LT.O.ODO) DELTO=O
HEAD^PO^NX,J,K,L)-PO(NX~1,J,K,L)-PC(NX&gt;J,K,L)+PC(NX~1,J,K,L)+ DWMX(NX,J,K,L)*(ZB(NX,J,L)-ZB(NX-1,J,L))
DELTW=1
IF(HEAD.LT.O.ODO) DELTW=0
TOXfNX,JJK,L)=DELTO*FFX(NX,J,K,L)*BOMX(NX,J,K,L)*KRO(NX,J,K,L)/ VOMX(NX,J,K,L)+
(1-DELTO)*FFX(NX,J,K,L)*BOMX(NX,J,K,L)*
KRO(NX-1,J,K,L)/VOMX(NX,J,K,L)
TWXÇNX,JÍK,L)=DELTW*FFX(NX,J,K,L)*BWMX(NX,J,K,L)*KRW(NX,J,K,L)/
VWMX(NX,J,K,L)+
(1-DELTW)*FFX(NX,J,K,L)*BWMX(NX,J,K,L)* KRW(NX-1,J,K,L)/VWMX(NX,J,K,L)
TOX1SA(NX,J,K,L)=(1~DELTO)*FFX(NX,J,KfL)*BOMX(NX,J,K,L)*
DKRO(NX-1,J,K,L)/VOMX(NX,J,K,L)
T0X1SKNX, J, K, L) =DELTO*FFX (NX, J,K,L)*BOMX (NX, J, K,L) *
DKRO(NX,J,K,L)/VOMX(NX,J,K,L)
TWX1SA(NX,J,K,L)=(1"DELTW)*FFX(NX,J,K,L)*BWMX(NX,J,K,L)*
&lt;	DKRW(NX-1,J,K,L)/VWMX(NX, J, K, L )
TWX1SI(NX,J,K,L)=DELTW*FFX(NX,J,K,L)*BWMX(NX,J,K,L)*
«	DKRW(NX,J,K,L)/VWMX(NX,J,K,L)
*
C transmissibilidade e derivadas na face externa IF(L.EQ.l) THEN
IF(J.LE.NQL) THEN
IF(IP.EQ.NXC) GO TO 20
IX=IP+1 JX=JP ENDIF IF(J.GT.NQL,AND.J.LE.NQL+NQS) THEN
IF&lt;JP.EQ,NYC) GO TO 20
IX-IP
JX=JP+1 ENDIF
IF(J. GT.NQL+NQS.AMD.J.LE.NQS+2*NQL) THEN
IF(IP.EQ.l) GO TO 20
IX=IP-1
JX=JP
ENDIF
IF(J.GT.NQS+2*NQL) THEN
F(JP.Eq.l) GO TO 20
X=IP
X=JP-1
*
*
*
*
ENDIF
AKROC=KRO(IX,JX,KP+K-1,2)
AKRWOKRW(IX,JX,KP+K-1,2)
AUXBO=BOMX(NX+1,J,K,1)
AUXBW=BWMX(NX+1,J,K,1)
AUXDO=DOMX(NX+1, J,K,1)
AUXDW=DWMX(NX+1, J, K, 1)
AUXVO=VOMX(NX+1,J,K,1)
AUXVW=VWMX(NX+1,J,K,1)
HEAD=P0(IX,JX,KP+K-1,2)-P0(NX,J,K,1)+AUXD0*
(ZB(NX,J,1)-ZB(IX,JX,2))
DELTO=1
IF(HEAD.LT.O.ODO) DELTO-O
HEAD=PD(IX,JX,KP+K-1,2)-P0(NX,J,K,L)-PC(IX,JX,KP+K-1,2) + PC(NX,J,K,1)+AUXDW*(ZB(NX,J,1)-ZB(IX,JX,2))
DELTW=1
IF(HEAD.LT.0.ODO) DELTW=0
TOX(NX+1,J,K,L)=DELTO*FFX(NX+liJ,K,L)*AUXBO*AKRDC/AUXVO+
(1-DELTO)*FFX(NX+1, J,K,L)*AUXBO*KRD(NX, J,K,L)/AUXV0
TWX(NX+1,J,K,L)=DELTW+FFX(NX+1,J,K,L)*AUXBW*AKRWC/AUXVW+
(1-DELTW) *FFX (NX+1, J, K, L) * AUXBW+KRW (NX, J, K, L)/AUXVW
c
20
T0X2SI(NX,J,K,L)=(1-DELTO)*FFX(NX+1,J,K,L)*AUXB0*
*	DKRO(NX,J,K,L)/AUXVD
T0X2SP(NX,J,K,L)=DELTO*FFX(NX+1,J,K,L)*AUXBO*
*	DKRD(IX,JX,KP+K-1,2)/AUXVO
TWX2SI(NX, J, K, L) = (1-DELTW)*FFX(NX+1,J,K,L)*AUXBW*
*	DKRWÍNX,J,K,L)/AUXVW
TWX2SP(NX,J,K,L)=DELTW*FFX(NX+1,J,K,L)*AUXBW*
*	DKRW(IX,JX,KP+K-1,2)/AUXVW
ENDIF
CONTINUE
ono o ona an
INTERFACES Z:Transmissib. ao oleo e a agua e suas derivadas dT/dSw
Verificacao do sentido de fluxo nas interfaces Z
para "head'* positivo :delto e deltg =1 (fluxo para dentro "do papel") para "head" negativo :deito e deltg =0 (fluxo para fora "do papel") Res. horizontal a diferença entre ZB*s e ZERO.
Sentido de fluxo da 1 e 2 camada
DO 60 1=1,NX
DO 60 J=1,NY
IF(L.EQ.2.AND.I.EQ.IP.AND.J.Eq.JP) THEN
IF(KP.EQ.1.OR.KP.EQ.2) GO TO 60 ENDIF
IF(L.EQ.1.AND.KP.NE.1) THEN
C
*
*
*
*
*
C
quando tem fluxo na primeira interface cilindro/cartesíano HEAD=PO(IP,JP,KP"1,2)-P0(I,J,1,1)~DOMZ(I,J,1,1)* (ZBd,J,l)"ZBdP,JP,2))
DELTO=1 IF(HEAD.LT.O.ODO) DELTO=O
HEAD=P0(IP,JP,KP-l,2)’P0(I,J,l,l)-PCdP,JP,KP-l,2)+PCd,J,l,l)-DWMZd,J,l,l)*(ZBd,J,l)-ZBdP,JP,2))
DELTW=1 IF(HEAD.LT.O.ODO) DELTW=O
TOZ(I,J,l,l)=DELTO*FFZd,J,l,l)*BOMZ(I, J,l,l)* KRO(IP,JP,KP-1,2)/V0MZ(I,J,1,1)+ (1~DELTO)*FFZ(I,J,1,1)*BOMZ(I,J,1,1)* KROd,J,ld)/VOMZd,J,l,l)
TWZ(I,J,l,l)=DELTW*FFZd,J,l,l)*BWMZ(I,J,lfl)* KRW(IP,JP,KP*1,2)/VWMZ(I,J,1,1)+ (1-DELTW)*FFZ(I,J,1,1)*BWMZ(I,J,1,1)* KRW(I,J,1,1)/VWMZ(I,J,1,1)
TOZÍSAd,J,l,l)=DELTO*FFZ(I,J,l,l)*BOMZd,J,l,l)* DKROÍIP,JP,KP~1,2)/V0MZ(I,J,1,1) TOZISId, J,l,l)=(l-DELTO)*FFZ(I,J,l,l)*BDMZd,J,l,l)* DKRO(I, J, 1,1)/VOMZ(I, J, 1,1)
TWZ1SA(I,J,1,1)=DELTW*FFZ(I,J,1,1)*BWMZ(I,J,1,1)* DKRW(IP,JP,KP-1,2)/VWMZd,J,1,1) TWZlSIfl,J,l,1)=(1-DELTW)*FFZ(I,J,1,1)*BWMZ(I,J,1,1)* DKRW(I,J,1,1)/VWMZ(I,J,1,1)
*
*
*
*
*
*
*
ENDIF
HEAD=PO(I, J,1,L) -P0d,J,2,L)
DELTO=1
IF(HEAD.LT.O.ODO) DELTO=O
HEAD=PO(I, J,l,L)-POd, J,2,L)~PC(I, J ,1 ,L)+PC(I, J,2,L)
DELTW-1
IF(HEAD.LT.O.ODO) DELTW=O
T0Z2SI(I,J,lJL)«DELT0*FFZ(I,J,2)L)*B0MZ(I,J,2,L)* DKRO(I,J,1,L)/VOMZ(I, J, 2, L)
T0Z2SP(I,J,1,L)=(1-DELTO)*FFZ(I,J,2,L)*B0MZ(I,J,2,L)*
DKRO(I,J,2,L)/VOMZ(I,J,2,L)
TWZ2SI (I, J, 1 ,L)=DELTW*FFZ(I,J,2,L) *BWMZ(I,J,2 ,L) * DKRW(I,J,1,L)/VWMZ(I,J,2,L)
TWZ2SPd,J,l,L)“(l“DELTW)*FFZ(I,J,2,L)*BWMZ(I,J,2,L)*
DKRWd,J,2,L)/VWMZd,J,2,L)
OTO d, J)~DELTO
DTWd, J)=DELTW
CONTINUE
DO
c
*
*
*
*
60 C
30 DO
*
*
1=1,NX
30 J=1,NY
DO 30 K=2,NZ-1
IF(L.EQ.2.AND.I.EQ.IP.AND.J.EQ.JP) THEN
IF(K.GE,KP.AND.K.LT.KP+NBP) GO TO 30 ENDIF
IF(L.EQ.2.AND.I.EQ.IP.AND.J.EQ.JP.AND.K.EQ.KP+NBP)GO TO 61
IF(K.EQ.2) THEN
DELTO=DTO(I,J)
DELTW=DTW(I,J)
ENDIF TOZd,J,K,L)=DELTO*FFZ(I,J,K,L)*BOMZd,J,K,L)*
KRO(I,J,K-l,L)/V0MZ(I,J,K,L) +
(1-DELTO)*FFZ(I,J,K,L)*BOMZ(I,J,K,L)*
*	KRD(I,J,K,L)/VOMZ(I,J,K,L) TWZ(I, J ,K,L)=DELTW*FFZ(I, J ,K ,L)*BWMZ(I, J ,K,L) *
*	KRV(IU,K-1,L)/VWMZ(I,J&gt;K,L) +
*	(i-DELTW)*FFZ(ItJ,K,L)*BWMZ(I,J,K,L)*
*	KRW(I,J,K,L)/VWMZ(I,J,K,L)
TOZ1SA(I,J,K,L)=DELTO*FFZ(I,J,K,L)*BOMZ(I,J,K,L)*
*	DKRO(I,J,K-1,L)/VOMZ(I,J,K,L) TQZISKI, J,K,L)»(1-DELTO)*FFZ(I,J,K&gt;L)*BOMZ(I, J,K,L)*
*	DKR0(I,J,K,L)/V0MZ(I,J,K,L) TWZ1SA(IIJ,K,L)=DELTW*FFZ(I,J,K,L)*BWMZ(I,JJK,L)*
*	DKRW(I,J,K-l,L)/VWMZ(I,J, K ,L) TWZ1SI(I,J,K,L)=(1-DELTW)*FFZ(I,J,K,L)*BWMZ(I,J,K,L)*
*	DKRW(I,J»K,L)/VWMZ(I&gt;J,K,L)
Repete-se a verificacao do sentido de fluxo para a próxima interface Z o res. e horizontal, dai deltaz=0
IF(L.EQ.2. AND.I.EQ.IP.AND.J.EQ.JP.AND.K.EQ.KP~l)G0T0 30 61	HEAD=PO(I,J,K,L)"P0(I,JjK+ljL)
DELTO=1
IF(HEAD.LT.O.ODO) DELT0=0
HEAD«PO(I,J,K,L)-PDd,J,K+l,L)-PC(I,J,K,L)+PCd, J,K+1,L) DELTW^1 IF(HEAD.LT.O.ODO) DELTW=O
T0Z2SI(I,J,KIL)=DELTO*FFZ(IfJ,K+1,L)*B0HZ(I,J,K+1,L)*
*	DKRO(I,J,K,L)/VOMZ(I,J,K+1,L) T0Z2SP(I, J,K,L)as(l-DELTO)*FFZ(I, J,K+1 ,L)*BOMZ(I, J,K+1 ,L)*
*	DKROd,J,K+l,L)/VOMZ(I,J,K+l,L) TWZ2SI(I,J,K,L)®DELTW*FFZ(I,J,K+1,L)*BWMZ(I,J,K+1,L)*
*	Dm(I,J,K,L)/VWMZ(I,J,K+l,L) TWZ2SP(I,J,K,L)«(1-DELTW)*FFZ(I,J,K+1,L)*BWMZ(I,J,K+1,L)*
*	DKRW(I,J,K+1,L)/VWMZ(I,J,K+1,L)
30	CONTINUE
ca no	cs n
INTERF.Z:Transmissib. ao oleo e a agua e suas derivadas dT/dSw na ultima camada de células (no limite do reserv. To e Tw = 0)
c
DO 35 I“1,NX
DO 35 J=1,NY
IF(L,EQ .2. AND.I.EQ.IP.AND. J.EQ. JP. AND. KP+NBP-1 .GE. NZC-l) GOTO 35
HEAD=P0(I,J,NZ-1,L)-PO(I,J,NZ,L)
DELTO=1
IF(HEAD.LT.0.0D0) DELTO=O
HEAD=Pa(I,J,NZ-l,L)-POdJJ,NZ,L)-PC(I,J,NZ-l,L)+PC(I,J,NZ&gt;L)
DELTW=i
IFCHEAD,LT.0.0D0) DELTW=O
T0Z(I,J,NZ,L)~DELTD*FFZ(I,J,NZ,L)*BOMZ(I,J,NZ,L)*
*	KRO(I,J,NZ~1,L)/VOMZ(I,J,NZ,L)+
*	(1-DELTD)*FFZ(I,J,NZ,L)*BOMZ(I,J,NZ,L)*
*	KRO(I,J,NZ,L)/VOMZ(I,J,NZ,L)
TWZ(I, J,NZ,L)=DELTW*FFZ(I, J,NZ,L)*BWMZ(I, J,NZ,L)*
*	KRWd,J,NZ-l,L)/VWMZ(I, J,NZ,L) +
*	(l-DELTW)*FFZd,J,NZ,L)*BWMZ(I,J,NZ,L)*
*	KRW(I,J,NZ,L)/VWMZd,J,MZ1L)
TOZ1SA(I, J,NZ,L)=DELTO*FFZ(I, J,NZ,L)*BOMZ(I, J,NZ,L)*
*	DKROÍI,J,NZ-1,L)/V0MZ(I,J,NZ,L)
T0Z1SI(IíJ,NZ,L)»(1-DELT0)*FFZ(I,J,KZ,L)*B0MZ(I&gt;J,NZ,L)*
*	DKROd, J,KZ,L)/VOMZ(I, J ,NZ,L)
TWZ1SA(I,J,NZ,L)=DELTW*FFZ(I,J,NZ,L)*BWMZ(I,J,NZ,L)*
*	DKRW(I,J,NZ-1,L)/VWMZ(I,J,NZ,L)
TWZ1SI(I,J,NZ,L)=(1-DELTW)*FFZ(I,J,NZ,L)*BWMZ(I,J,NZ,L)*
*	DKRW(I, J,NZ,L)/WMZd, J,NZ,L)
C quando tem fluxo na ultima interface cilindro/cartesiano
IFCL.EQ.1.AND.KP+NBP-1.LT.NZC) THEN
C	HEAD=PD(1,1,NZR, 1)-PO(IP,JP,KP+NBP,2)
HEAD=P0(I»J,NZR, 1)-PD(IP,JP,KP+NBP,2)-D0MZ(I,JfNZR+1,1)*
*	(ZB(lP,JP,2)-ZBd,J,l))
DELTO=1 IF(HEAD.LT.O.ODO) DELT0=0
HEAD=P0(I,J,NZR,1)-PO(IP,JP,KP+NBP,2)-
*	PC(I,J,NZR,1)+PC(IP,JP,KP+NBP,2)“DWMZ(I,J,NZR+1,1)*
*	(ZB(IP,JP,2)-ZB(I,J,1))
DELTW=1
IF(HEAD.LT.O.ODO) DELTW=0
T0Z(I,J,NZR+1,1)=DELTO*FFZ(I,J,NZR+1,1)*BOMZ(I,J,NZR+1,1)*
*	KRO(I,J,NZR,1)/VOMZ(I,J,NZR+1,1)+
*	(l-DELTO)*FFZd,J, NZR+1,1)*BOMZ(I, j,nzr+i,d*
*	KRO(IP,JP,KP+NBP,2)/V0MZ(I,J,NZR+1,1)
*
*
*
$
*
*
*
TWZ(I,J,NZR+1,1)=DELTW*FFZ(1,1,NZR+1,1)*BWMZ(I, J, NZR+1,1)* KRW(I,J,NZR,1)/VWMZ(I,J,NZR+1,1) + (1-DELTW)*FFZ(I,J,NZR+1,1)*BWMZ(I,J,NZR+1,1)* KRW(IP,JP,KP+NBP,2)/VWMZ(l,J,NZR+1,1)
T0Z2SI(I,J,NZR,1)=DELT0*FFZ(I,J,NZR+1,1)*
BOMZÍI,J,NZR+1,1)*DKRO(I,J,NZR,1)/VOHZ(I,J,NZR+1,1) TOZ2SP(I,J ,NZR,1)~(1”DELTO)*FFZ(I,J,NZR+1,1)*
BOMZ(I,J,NZR+1,1)*DKRO(IP,JP,KP+NBP,2)/VÜMZ(I,J,NZR+1,1) TWZ2SI(I,J,NZR,1)=DELTW*FFZ(I,J,NZR+1, 1) *
BWMZd,J, NZR+1,1)*DKRW(I,J, NZR ,1)/VWMZ(I,J, NZR+1,1)
TWZ2SP(I,J,NZR,1)=(1-DELTW)*FFZ(I,J,NZR+1,1)*
BWMZ(I,J,NZR+1,1)*DKR#(IP,JP,KP+NBP,2)/VWMZ(I, J,NZR+1,1) ENDIF
o o n o na aa
35 CONTINUE
INTERF.YíTransmissib. ao oleo e a agua e suas derivadas dT/dSw na
Verificacao do sentido de fluxo para "head" positivo :delto e deltw para "head" negativo :deito e deltw
=1 (fluxo no sentido anti horário) ou (fluxo para cima)
=0 (fluxo no sentido horário)
ou (fluxo para baixo)
Jl=l
J2=2
IF(L.EQ.l) THEN
J1=NY
J2=l
ENDIF T
DD 80 1=1,NX
DD 80 K=1,NZ IF(L.EQ.2.AND.K.GE*KP.AND,K.LT.KP+NBP) THEN
IF(I.EQ.IP.AND.JP.EQ.l.OR.
*	I.EQ.IP,AND.JP,EQ,2) GO TO 80
ENDIF
HEAD=PO(I,J1,K,L)-PO(I,J2,K,L)+D0MY(I,J2,K,L)*
*	(ZB(I,J1,L)-ZB(I,J2,L)) DELTO=1
*
+ o o X *&lt;
K &gt;
pi

#
o
-4
® Xi
® c4 ® I
a&gt;

«
tn £3
XI
&gt; a o
*
*
*
*
pt
£X O

tn £3
X
1
G) O
o
-O O
cs
*
* * *
*
*
n on
X P*
t-i
X
Pl
co o
*
*

*
*
G P n g
S~4		H	H	H
		o	o	X
	•&lt;	*&lt;	*&lt;	H
pt	p*.	t-t		y—i
cn	cn	w	tn	H
	&gt;	t—1	&gt;	*
	^■'N	X-”X		Ch4
Í—1		HH	M	k»
a*	%&gt;	w	*	PS
CblB^
&gt;5
X
t-
W
X M Í—tX o hskx “Í/—47JO .
r li H o o M •&amp;lt;-(Xi tn tn -mt r4 c OÕJ-1- X! Xi
&lt;D X
i—II-IO xxio KCK H If H
OH'-J ®
□ nr tr Z-'-.l—I osrao.o. oo- n si 3
	km p&gt; O HPSOH X-		&lt;fc	Mf fwÃa COOM	H	H	H	H M mW
tn	H O O II •	w	o	MH HP	X	«	o	o x nm
X	Xj	HM		{fl	X OW		H	“C	
MW	Z~X O M-	o			KJ	to	to	to HXH
nHHH	r* o ii sa;		o	HH11	Cfl	tn	txt	tn - tn«
y~xXIXt xt	H-		£	U	W	T?	w	XJ	m tn &gt; ti o
M	X M-	C	Uj,		5*5 W	Z"-X.		z~x	z-\O ÜH £t
vfr ImJ. h* I

ps m
tT &gt;
H I! O O tn tn c r-H H «: o
PS
p;
t-

Pi HO
M tri *
r* Eno
r- .__________
Ü
it p: it o

to

ps
c

t-
o ¡71 r-H K II
O
t-'
*
to X
® - ÜKH- CJ3KH
PS M Pl « X M MO f-h- H- *'• H- * HrHPnrHPX a . -	“■ ■“	“
X 0

w * co w’-'s;

'~'O o
a o
o
H
H o
c H
-4 O
p; XI 4-X
03 X
to
r-1
ÓE * C *&lt;
ac M 3t -H&amp;lt;-t
w o 3! «5
m

ps
PS
ps
t~*
t«4
tx
H
&lt;-&lt;
H
X
+	O 4- H		tn	H to H			to
		&lt;*^x	X		»•		*•
M	•&lt;	hH			X	M	X
w		V		■*	W	W-	w
&lt;-H	M	&lt;—1		KJ	H	K&gt;	
	V			*-		M-	
					*		
w		■w				»*	
H	X	r1				r*	
X-Z	*•						
*	r&gt;	*		*		*	
IPO=1
IF (HEAD, LT. 0. ODO) DELTOO IF(HEAD.EQ.O.ODO) IP0=0
HEAD^POCI, J,K,L)-PO(I, JMA,K ,L)-PC(I, J ,K,L)+PCd, JMA,KfL) +
*	DWMY(I,JMA,K,L)*(ZBd,J,L)-ZBd,JMA,L))
DELTW=1
IPW=1
IF(HEAD.LT.0,ODO) DELTW=O IF(HEAD.EQ.O.ODO) IPW=O
TDY2SKI, J ,K ,L)=IP0*DELT0*FFYd, JMA,K,L)*BOMY(I, JMA , K,L)*
*	DKROCI,J,K,L)/VOMY(I,JMA,K,L)
TDY2SP(I,J,K,L)=IPD*(l-DELTO)*FFYd,JMA,K,L)*BOMY(I,JMA,K,L)*
*	DKRO(I,JMA,K,L)/VOMY(I,JMA,K,L) TWY2SI(I,J,K,L)=IPW*DELTW*FFY(I,JMA,K,L)*BWMY(I,JMA,K,L)*
*	DKRW(I,J,K,L)/VWMY(I,JMA,K,L)
TWY2SP(I,JfKIL)=IPW*(l~DELTW)*FFY(I,JMA,K,L)*BWMY(I,JMA,K,L)*
*	DKRW(I,JMA,K,L)/VWMY(I,JMA,K,L)
70 CONTINUE
on n	no	oo on
INTERF.Y:Transmissib. ao oleo e a agua e suas derivadas dT/dSw na ultima camada de celulas (no limite do reserv. To e Tw = 0)
IF(L.EQ,2) THEN
DO 75 I-1,NX
DO 75 K=1,NZ IF(K.GE.KP.AND.K.LT.KP+NBP) THEN
IF(I.EQ.IP.AND.JP.EQ.NY.OR.I.EQ.IP.AND.JP.EQ.NY-1) GO TO 75 END IF
HEAD=PO(I,NY*l,K,L)-POd,NY,K,L)+DOMY(I,NY,K,L)*
*	(ZBd,NY-l,L)-ZBd,NY,L))
DELTO=1
IF(HEAD.LT.0.ODO) DELTO=O
HEAD=POd,NY-l,K,L)-PO(I,NY,K,L)-PCd,NY-l,K,L)+PC(I,NY,K,L) +
*	DWMYd,NY,K,L)*(ZBd,NY-l,L)-ZB(l,NY,L))
DELTW=1
IF(HEAD.LT.0.ODO) DELTW=O
TOYd,NY,K,L)=DELTO*FFYd,NY,K,L)*BOMY(I,NY,K,L)*
*	KROd,NY-l,K,L)/VOMY(I,NY,K,L)+
*	(1-DELTO)*FFY(I,NY,K,L)*BOMY(I,NY,K,L)*
*	KRO(I,NY,K,L)/VOMY(ItNY,K,L) TWY(I,NY,K,L)=DELTW*FFY(I,NY,K,L)*BWMYd,NY,K,L)*
*	KRW(I,NY-1,K,L)/VWMY(I,NY,K,L)+
*	(l-DELTW)*FFY(I,NY,K,L)*BWMYd,NY,K,L)*
*	KRW(I,NY,K,L)/VWMY(I,NY,K,L)
TOYlSAd,NY,K,L&gt;DELTO*FFYd,NY,K,L)*BOMY(I,NY,K,L)*
*	DKRO(I,NY-1,K,L)/V0MY(I,NY,K,L)
TOYlSId INY,K,L)=S(1-DELTO)*FFY(I,NY,K,L)*BOMY(I,NY,K,L)*
*	DKRO(I,NY,K,L)/VOMYd,NY,K,L)
TWYlSAd,NY,K,L)=DELTW*FFY(I,NY,K,L)*BWMY(I,NY,K,L)*
*	DKRW(I,NY-1,K,L)/VWMY(I,NY,K,L) TWY1SI(I,NY,K,L)=(1-DELTW)*FFY(I,NY,K,L)*BWMY(I,NY,K,L)*
*	DKRW(I,NY,K,L)/VWMYd,NY,K,L)
75 CONTINUE
END IF
1000 CONTINUE
RETURN
n a a o QQonri o	o	o	o cioonao
I	t	i	i
END
SUBROT, DE REINICIALIZ. DE VAR. PARA REPETIÇÃO DE PASSO DE TEMPO QUE ULTRAPASSOU D N# MAX DE ITER OU QUE NAO TENHA VERIE. DSLIM OU DPLIM
SUBROUTINE REPTS(NTS,PWFA,PWF)
IMPLICIT DOUBLE PRECISION(A-H.O-Z)
PARAMETER(NXM=08,NYM=05,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/TSA/POA,SOA,SGA ,SWA
COMMON/TS/PO,SO,SG,SW
DIMENSION P0A(NXM,NYM,NZM,2),S0A(NXM,NYM,NZM,2),
*	SGA(»XM&gt;NYM,NZM,2)&gt;SWA(»XM,NYM&gt;NZM,2)
DIMENSION PO(0:NXM+1,0:NYM+1Í0:NZM+1,2)ÍSO(NXMÍNYM,NZM,2),
*	SG(NXM1NYM,NZM,2)iSW(NXMfNYMfNZM&gt;2)
DO
*
4	L=l,2
NX=NXR
NY=NYR
NZ=NZR
IFÍL.EQ.2) THEN
NX=NXC
NY=NYC
NZ=NZC
ENDIF
DO 5 1=1,NX
DO 5 J=1,NY
DO 5 K=1,NZ
IF(L.EQ.2.AND.I.EQ.IP.AND.J.EQ.JP.AND.K.GE.KP.AND. K.LT.KP+NBP) GO TO 5
PO(ItJ,K,L)=POA(I,J,K,L) SO(I,J,K,L)=SOA(I,J,K,L) SW(I,J,K,L)=SWA(I,J,K,L)
SG(I,J,K,L)=SGA(I,J,K,L)
CONTINUE
CONTINUE
NTS=NTS~1
PWF=PWFA
RETURN END
SUBBOTINA DE CALCULO DAS FUNCOES DE RESIDU0S DO OLEO E DO SUAS DERIVADAS PARA A MONTAGEM DA MATRIZ JACOBIANA Obs.IDR eh para anular ou nao os termos de fluxo, vazao e das no poco do GRID RADIAL.
IDC eh para anular ou nao a vazao e suas derivadas no poco do GRID CARTESIANO.
GAS E DE suas deriva-
bloco do
SUBROUTINE MQNJAC
IMPLICIT DOUBLE PRECISION(A-H,O~Z)
PARAMETER(NXM=08,NYM=05,NZM=O4)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR ,NQL,NQS,NQI,IP,JP,KP
COMMON/SIM/DT,DTMAX,DTMIN,T0LP,TOLS,DSLIM,DPLIM,TSIM,
*	QOMAX,QOMIN,PWMIN,BSOR,JPROD,MSOLU,ITMAX,ITMIN COMMON/RES/DGAS,CR,PRIN,TEMP,ZC,RW,RE,SWIN,PHI,PERX,PERY,
****** * ******
*	PERZ,ZCOW,INDPOR,INDPER
COMMON/MALHA/ZB,RB,VPOR,DRO,WX,WY,WZ,FFX,FFY,FFZ,DTETA COMMON/TSA/POA,SOA,SGA,SWA
COMMON/PVTA/BOA,RSOA,BWA
COMMON/TS/PO,SO,SG,SW
COMMON/PVT/BO,DBO ,VO,DVO,DO,DDO,RSO,DRSO,BW,DBW,VW,DVW ,DW,DDW , CW COMMON/IFACEX/BOMX,VOMX,DOMX ,BWMX,VWMX,DWMX COMMON/IFACEY/BOMY,VOMY,DOMY , BWMY,VWMY,DWMY
COMMQN/IFACEZ/BOMZ,VOMZ,DOMZ,BWMZ ,VWMZ,DWMZ COMMON/PETR/KRO,KRW,DKRO,DKRW ,PC,DPC COMMON/DTRANS/TOX,TWX,TOY,TWY,TOZ,TWZ,
TOX1SA,TOX1SI,TWX1SA,TWX1SI, TOX2SI,TOX2SP,TWX2SI,TWX2SP, TOY1SA,TOYÍSI,TWY1SA,TWY1SI, T0Y2SI,T0Y2SP,TWY2SI,TWY2SP, TOZ1SA,TDZ1SI,TWZ1SA,TWZ1SI, TOZ2SI,TOZ2SP,TWZ2SI,TWZ2SP
COMMON/VAZAO/QO,QOT,QG,QGT,QW,QWT,DQOP,DQOS,
DQWP,DQWS,RWO,RGO,PWF,TEMPO
COMMON/ANULA/IX1,1X2,IY1,IY21IZ1,IZ2,IDR,IDC,LBC,JMA,JME,IX,IX, LBR COMMON/NBLC/A,D,NBC,NBR,NBT
CDMMON/ACU/ACO,ACW,DACOP,DACOS,DACWP,DACWS
COMMON/POT/POTOX1,P0T0X2,PQTOY1,P0T0Y2,POTOZ1,POTOZ2 , POTWX1,P0TWX2,POTWY1,POTWY2,POTWZ1,POTWZ2, PDX1PA,POX1PI,POY1PA,POY1PI,POZ1PA,POZ1PI, P0X2PI,P0X2PP,POY2PI,POY2PP,POZ2PI,P0Z2PP, PWX1PA,PWX1PI,PWY1PA,PWY1PI,PWZ1PA,PWZ1PI, PWX2PI,PWX2PP,PWY2PI,PWY2PP,PWZ2PI,PWZ2PP, TOX1PA,TOX1PI,TOY1PA,TOY1PI,TOZ1PA,TOZ1PI,
*	T0X2PI,TOX2PP,TOY2PI,TOY2PP,TOZ2PI,TOZ2PP,
*	TWX1PA,TWX1PI,TWY1PA,TWY1PI,TWZ1PA,TWZ1PI,
*	TWX2PI,TWX2PP,TWY2PI,TWY2PP,TWZ2PI,TWZ2PP COMMON/SDEDW/STPO,STPW,SDEOPI,SDEOSI,SDEWPI,SDEWSI,
*	DFOPX , DFOSX,DFWPX,DFWSX , DFOPZ,DFOSZ,DFWPZ,DFWSZ DIMENSION PHI(NXM,NYM,NZM,2),PERX(NXM,NYM,NZM,2),
*	PERY(NXM,NYM,NZM,2) ,PERZ(NXM,NYM,NZM,2)
DIMENSION ZB(O:NXM+1,NYM,2),RB(NXM+1),VPOR(NXM,NYM,NZM,2),
*	FFX(NXM+1,NYM,NZM,2),FFY(NXM+1,NYM,NZM,2),
*	FFZ(NXM+1,NYM,NZM+1,2),DTETA(NYM+1)
DIMENSION POA(NXM,NYM,NZM,2),SOA(NXM,NYM,NZM,2),
*	SGA(NXM,NYM,NZM,2),SWA(NXM,NYM,NZM,2)
DIMENSION BOA(NXM,NYM,NZM,2),BWA(NXM,NYM,NZM,2)
DIMENSION PQ(OiNXM+l,0:NYM+i,0:NZM+1,2),S0(NXM,NYM,NZM,2),
*	SG(NXM, NYM,NZM,2),SW(NXM,NYM,NZM,2)
DIMENSION BQ(NXM,NYM,NZM,2),DBO(O:NXM+1,0:NYM+1,0:NZM+1,2),
*	VO(NXM,NYM,NZM,2),DVO(O:NXM+1,0:NYM+1,0:NZM+1,2) ,
*	D0(NXM,NYM,NZM,2),DDO(O:NXM+1,0:NYM+1,0:NZM+1,2),
*	BW(NXM,NYM,NZM,2),DBW(O:NXM+1,0:NYM+1,0;NZM+1,2),
*	VW(NXM,NYM,NZM,2),DVW(O:NXM+1,0:NYM+1,0:NZM+1,2) ,
*	DW(NXM,NYM,NZM,2),DDW(O:NXM+1,0:NYM+1,0:NZM+1,2),
*	CW(NXM,NYM,NZM,2)
DIMENSION B0MX(0:NXM+l,»YM,NZM,2),V0MX(0:KXM+l,NYM,NZM,2),
*	DOMX(O:NXM+1,NYM,NZM,2),BWMX(O:NXM+1,NYM,NZM,2),
*	VWMX(0:NXM+1,NYM,NZM,2),DWMX(0:NXM+1,NYM,NZM,2)
DIMENSION BOMY(NXM,NYM+1,NZM,2),VOMY(NXM,NYM+1,NZM,2),
*	DOMY(NXM,NYM+1,NZM,2),BWMY(NXM,NYM+1,NZM,2),
*	VWMY(NXM,NYM+1,NZM,2),DWMY(NXM,NYM+1,NZM,2) DIMENSION BOMZ(NXM,NYM,NZM+1,2),VOMZ(NXM,NYM,NZM+1,2),
*	DOMZ(NXM,NYM , NZM+1,2),BWMZ(NXM,NYM,NZM+1,2),
*	VWMZ(NXM,NYM,NZM+1,2),DWMZ(NXM,NYM,NZM+1,2) DIMENSION DKRO(NXM,NYM,NZM,2),DKRW(NXM,NYM,NZM,2),
*	PC(O:NXM+1,0:NYM+1,0:NZM+l,2),DPC(O:NXM+i,O:NYM+1,0:NZM+1,2) REAUS KR0(NXM,NYM,NZM,2) ,KRW(NXM,NYM,NZM,2)
DIMENSION TOX(NXM+1,NYM,NZM,2),TWX(NXM+1,NYM,NZM,2),
*	TOXISA(NXM,NYM,NZM,2),TOX1SI(NXM,NYM,NZM,2),
*	TWX1SA(NXM,NYM,NZM,2),TWX1SI(NXM,NYM,NZM,2),
*	TDX2SI(NXM,NYM,NZM,2),TOX2SP(NXM,NYM,NZM,2),
*	TWX2SI(NXM,NYM,NZM,2),TWX2SP(NXM,NYM,NZM,2)
DIMENSION TOY(NXM,NYM+1,NZM,2)&gt;TWY(NXM,NYM+1,NZM,2),
*	TOY1SA(NXM,NYM,NZM,2),TOY1SI(NXM,NYM,NZM,2),
*	TWYISA(NXM,NYM,NZM,2),TWY1SI(NXM,NYM,NZM,2),
*	TOY2SI(NXM,NYM,NZM,2),TQY2SP(NXM,NYM,NZM,2),
*	TWY2SI(NXM,NYM,NZM,2),TWY2SP(NXM,NYM,NZM,2)
DIMENSION TOZ(NXM,NYM,NZM+1,2),TWZ(NXM,NYM,NZM+1,2),
*	TOZISA(NXM,NYM,NZM,2),TOZ1SI(NXM,NYM,NZM,2),
*	TWZ1SA(NXM,NYM,NZM,2),TWZ1SI(NXM,NYM,NZM,2),
*	T0Z2SI(NXM,NYM,NZM,2),TOZ2SP(NXM,NYM,NZM,2),
*	TWZ2SI(NXM,NYM,NZM,2),TWZ2SP(NXM,NYM,NZM,2) DIMENSION A(NXM*NYM*NZM*4,NXM*NYM*NZM*4),D(NXM*NYM*NZM*4) DIMENSION QO(NYM,NZM) ,QG(NYM,NZM),QW(NYM,NZM),DQDP(NYM,NZM),
*	DQOS(NYM,NZM),DQWP(NYM,NZM),DQWS(NYM,NZM) DIMENSION STPO(O:6,NZM),STPW(O:6,NZM)
C	STPO —&gt; Somatorio de Trans. X Pot. doOleo
DIMENSION SDEOPI(0:6,NZM),SDEWPI(0:6,NZM),SDEOSI(0:6,NZM) ,
*	SDEWSI(0:6,NZM)
SDEOP—&gt; Som. da Derivada da Eq. do Oleo em rel, a Pres.
no	o	o	non nooc¡
Inicializacao do jacobiano (matriz A) e do termo ind. com zeros
NBC=NXC*NYC*NZC-NBP NBR=NXR*N¥R*NZR NBT=NBC+NBR
para evitar if's no calculo do potencial
DO 1 K=KP,KP+NBP-1
PO(IP,JP,K,2)=O.ODO
SW(IP,JP,K,2)=0,ODO
1 CONTINUE
5
10
DO 5 I=1,NBT*2
DO 5 J«1,NBT*2
A(I,J)=O.ODO
CONTINUE
DO 10 I=1,NBT*2
D(I)=O.ODO CONTINUE
DO 6 K=1,NZR
DO 6 1=0,6
STPO(I,K)=O.ODO
STPW(I,K)=O.ODO
SDEOPI(I,K)=0.ODO
SDEWPI(I,K)=0.ODO SDEOSI(I,K)=O.ODO SDEWSI(I,K)=0.ODO
6	CONTINUE
C
DO
1000 L-1,2 NX=NXR
ny=nyr
NZ=NZR
NC=NBC
IF(L.EQ.2) THEN
NX=NXC
NY=NYC NZ=NZC
NC=0
END IF
noQoorsaooo on
DO 15 1=1,NX
DO 15 J=1,NY
DO 15 K=1,NZ
IF(L.EQ.2.AND.I.EQ.IP.AND.J.EQ.JP.AND.K.GE,KP.AND.
*	K.LT.KP+NBP) GO TO 15
Fator de controle para a condicao de contorno das células
idr —&gt;	indicador do poco no radial (=0 se i=l e =1	se i=/l)
ide —&gt;	indica se o bl cart eh viz do poco (=1 se	sis, =0	se	nao)
ixl —&gt;	anulara as eqs. em i~l/2 qdo for face com	o	bloco	do	poco
ix2 —&gt;	anulara as eqs. em i+1/2 qdo for face com	o	bloco	do	poco
iyl, iy2, izl e iz2 —&gt; idem a ixl e ix2
lbc —&gt; posicao do cartesiano vizinho ao poco
&gt;	lbc=l cartesiano vizinho a direita ou esquerda do poco
&gt;	lbc=2 cartesiano vizinho acima do poco
&gt;	lbc=3 cartesiano vizinho abaixo do poco
DFOSX=O DFWPX=0 DFWSX=Q DFDPZ=0
JMA=J+1
JME=J“1 IDR=1 IDOO LBC=0 LBR=1 1X1=1 1X2=1
IY1=1 IY2=1
IZ1=1
IZ2=1 IV=0 IX=0 IY=0 DFOPX=O.ODO ----- ~ ÔDO
ODD 0D0 ________0D0 DF0SZ=0.0D0 DFWPZ=O.0D0 DFWSZ=0.0D0
IF(L.EQ.l) THEN
IF(I.EQ.l) IDR=0
IF(J.EQ.l) JME=NY
IF(J.EQ.NY) JMA=1
THEN
THEN
THEN
n o an n an n ao
C
C
c
c
IF(I.EQ.IP.AND.J.EQ.JP+1)
IDC=1
IY1=O
LBC=2 LBR=K-KP+1
ENDIF
IF(I.EQ.IP-1.AND.J,EQ.JP)
IDC=1 1X2=0 LBC=3 LBR=K-KP+1
ENDIF
IF(I.EQ.IP.AND.J.EQ.JP-l)
IDC=1
IY2=0
LBC=4 LBR=K-KP+1
ENDIF ENDIF IF(I.EQ.IP.AND.J,EQ.JP.AND,K.EQ.KP-1) THEN
IDO1
122=0
LBC=5
LBR=1
ENDIF
IF(I.EQ.IP.AND.J.EQ.JP,AND.K.EQ.KP+NBP) THEN
IDC=1
121=0
LBC=6 LBR=NZR
ENDIF
W=0.5D0
-ENDIF
Numero da célula na ordenacao sequencial de células na malha
NC=NC+1
Endereço dos elementos da diagonal principal da célula i,j no jacob.
LC=2*NC-1
Calculo das dif.de potencial nas fases oleo e agua
ix e iy dah as coordenadas do cartesiano vizinho
EQ NXJ THEN
lateral direita
IF(J.LE.NQL) THEN
IV=1 IX=IP+1 JX=JP ENDIF lado superior
IF(J.GT.NQL.AND.J.LE.NQL+NQS) THEN
IV=2
IX=IP JX=JP+1
ENDIF lateral esquerda
IF(J.GT.NQL+NQS.AND.J.LE.NQS+2*NQL) THEN IV=3 IX=IP-1 JX=JP
ENDIF lado inferior
IF(J.GT.NQS+2*NQL) THEN
IV=4
IX=IP
JX=JP-1

c
C Na
ENDIF
AÜXDD=DOMX(NX+1,J ,K,1)
AUXDW=DWMX(NX+1,J,K,1)
AUXBO-BDMX(NX+1, J, K, 1)
AUXBW=BWMX(NX+1,J,K,1)
AUXVO=VOMX(NX+1,J,K,1)
AVXVW=VWMX(NX+1,J,K,1) P0T0X2=P0(IX,JX,KP+K-1,2)-PO(NX,J,K,1)+AUXD0*
*	(ZB(IX,JX,2)-ZB(NX,J,l))
P0TWX2=P0(IX,JX,KP+K-1,2)-PO(NX,J,K,1)+AUXDW*
*	(ZB(IX,JX,2)-ZB(NX, J,l))-PCdX,JX,KP+K-l,2)+PC(NX, J,K,1)
STPO(IV,K)=STPO(IV,K)-TOX(NX+1,J,K,L)*PDT0X2
STPW(IV,K)»STPW(IV,K)-TWXÍNX+1,J,K,L)*POTWX2 ET.SE
PDT0X2=P0(I+l,J,K,L)-P0(I,J,K,L)-DOMX(I+1,J,K,L)*
*	(ZB(I,J,L)-ZB(I+1,J.L))
P0TWX2=P0(I+l,J,K,L)-P0(I,J,K,L)-DWMX(I+1,J,K,L)*
*	(ZBdjJ.D-ZBd+l, J,L))-PC(I+1,J,K,L)+PC(I,J,K,L) ENDIF
POTOX1«IDR*(PO(I,J,K,L)-PO(I-1,J,K,L) -D0MX(I, J,K,L)+
*	(ZB(I-1,J,L)-ZB(I,J,L)))
POTWX1=IDR*(PO(I,J,K,L)-PD(I-1,J,K,L) -DWMXd, J,K,L)*
*	(ZB(I-1,J,L)-ZB(I,J,L))-PC(I,J,K,L)+PC(I-1,J,K,L)) P0T0Y2-PD(I, JMA,K,L)-PO(I, J,K,L)-DDMYd, JMA,K,L)*
*	(ZB(I,J(L)-ZB(I,JMA.L))
P0TOY1-PD(I, J,K,L)-PO(I,JME,K,L)-DOMY(I,J,K,L)*
*	(zb(i, jme,l)-zb(i , j ,D)
P0TWY2-P0(I,JMA,K,L)-PO(I,J,K,L)-DWMY(I,JMA,K,L)*
*	(ZBd,J,L)-ZBd,JMA,L))-PCd,JMA,K,L)+PC(I,J,K,L&gt;
POTWY1=PO(I,J,K,L)-PO(I, JME,K,L) -DWMY(I, J ,K ,L) *
*	(ZB(I,JME,L)-ZB(I, J,L))-PC(I,J,K,L)+PC(I, JME,K,L)
direcao Z a diferença de ZB e zero
IF(L.EQ.1.AND.K.EQ.1.AND.KP.NE.1) THEN IV«5 P0T0Zl«P0(l,J,l,l)-P0(IP,JP,KP-l,2)-
*	D0MZd,Jdd)*(ZB(IPdP,2)-ZBd,Jd&gt;) POTWZ1-PO(l,J,1,1)-PO(IP,JP,KP-1,2)-
*	pcdj.idí+pcdPdP.Kp-id)"
*	DWMZ(I,J,1,1)*(ZB(IP,JP,2)-ZB(I,J,1))
STPO(IV &gt;K)=STPO(IV,K)+TOZ(I, J,1,í)+POTDZ1
STPW(IV,K)=STPW(IV,K)+TWZ(I,J,1,1)+POTWZ1 ELSE
POTOZ1=PO(I,J,K,L)-PO(I,J,K-l,L) POTWZ1=PO(I,J,K,L)-PO(I,J,K-l,L)-
*	PC(I, J,K,L)+PC(I,J,K-1,L)
ENDIF
IF(L■EQ.1.AND.K.EQ.NZR.AND,KP+NBP-1.LT.NZC) THEN
IV=6
P0T0Z2=P0(IP,JP,KP+NBP,2)-P0(I,J,NZR,1)-
*	DOMZ(I,J,NZR+1,1)*(ZB(I,J,1)-ZB(IP,JP,2)) P0TWZ2=P0(IP,JP,KP+NBP,2)-PO(I,J,NZR,1)-
*	PC(IP,JP,KP+NBP,2)+PC(I,J,NZR,1)-
*	DWMZ(I, J,NZR+l,l)*(ZBd, J,1)-ZB(IP, JP,2))
STPO(IV,K)=STPO(IV,K)-TOZ(I,J,NZR+1,1)*P0T0Z2
STPW(IV,K)=STPW(IV,K)-TWZ(I,J,NZR+1,1)+P0TWZ2
ELSE
o
*

*
*
*
*
*

*
*
*
*
*
*
*
n £
o p
O P
QQ I I i i i i I
o © c* (&amp;amp; s
o oo I
I
í
I
í
J í
o tí
03	*0 03 03 *0	*0
C	sooo	o
•&lt;		
h	H tO tO H	1—
03	03 03 13 03	
1-1	&gt; 03 H H	&gt;
II	11 II II II	ti
H	1 H* 1	»-*	t
*	H &gt; H ‘	
O	•0-0	4
C3	O O O O z*&gt; O	
Oz~s	ü O O O NI O	
f tO	O 1 O 1 03 O	
SC 03	i ac i aC^%	1
“ir,	y'"s	*-&amp;lt;b-d r^s	
* H	H # H * u	Hk
O-	■ O • Q&amp;lt;_&lt;	
O H	OCOÜXO	
C X	O O O O 03 O	
■r&gt; 03	O Í—.O/~V‘	O
C3
♦
Cm t—I	W Zo* b-I
						I	O 1	1			1 H- 1		í	o
		03		P3		H I	1	1			1 tí 1		1	
		522		r&gt;		OJ 1	(X 1	1 o	C3		I p I		1	íX
03	03 03	O3C3O3	03 03	O3C/3O3	03 03	O3&lt;-v 1	p 1	1	Z—V		i n i		1	o
sC	ac o	owie	3C O	cm	C o	a r* i	tn i	i r1	r* o	e&gt;	i p i			ÍÕ
X	X X	XO3X	X X	X X	X X	X • i	i	1 o	a&lt;"-'	z—	1 o I		1	
1-*	4k*. lk-i	i-1 lo	to to	«O IO	to to	to x i	px i	i +	4-	f	i	i		1	ct
03	03 03	03	03	03 03	03	03	03 03	03 jO I	ft 1	i h	►** Q	Q	1 fX 1		&gt; !&gt; 1	0
H	S» h	&gt;	03	H 03	i—1	03	1-1 03	l-t ■	1	0 i	i		s_z	1 p 1	n	a a i	H
11	II II	II	13	II II	II 11	II II	II H 1	p. :	i li	It II	11	1 M I	o	c X 1	9
W
I I I I
I i
I ( i I
I I
I i
I I
I
M
ES
O
1~* Z—x 1	l-J- z*\ 1	i-1 o l	(-* 1	■ 1	&amp;lt;1	1 1 &gt;	HUI-I 1 &gt; W H H	1	I	1	1!	11 H 1	0 i *Td	03
- Nt i-*	• N »-	• N i—*	• ISl f-*	3&gt; 1	p í	i o n	to«:xt3Qb4«;x	t Hs I	1 VI&amp;lt;3 ttí &amp;lt;11 1	1	O
O t» ■	O t» •	o tn -	O 03 ■	S3 t	pj J	1	to to Mrs S3 iO to IO	t p I	i *; os c 03 H i	1	H
Qz-xO	C3^O	Oí-xO	Gz-xO	C3 t	p 1	i Ir* i	* * * r* i % * *	i y ;	1 r.D&gt;O- 1	a i	«
O i-t C3	O 1-1 O	O C3	O !SÍ C3		Cft i	i Oz~x	r,rs/-',C|z'xrsrx/-s	i a i	1 H 3I3z“xpt3 O 1	0 J	to
1 - O	I - O	1 X o	1 X O	IH I	1	1 4* b**-	H H ’-J1—' H *~3 M H	1 o	1 - r-.Hrsd 1	1	to
X
01
I I
I I i
I I
I I i I
I I
I
ÍX ®
P n tí S tí
ir
O o
03 O H O N to lí
03 O
Pe
►1
¡X p w
Qu H ê&gt; f H	+ Z-X. 1	4- rx 1	zx CD 1 z—s O 1	I ’	1	o X &gt; H	« X &gt; H	1 Ct?
Q r~* ■ o’—&gt;.	H w aC H H SC	Hz-x® Wz-xSI H	1 1	iK + U	U	z—s 4- u u	1 »
X'—'O o 1 o	u	4- XuZu	4- XuZ	X H po X H S3 S3	1 pu 1	&lt;- H X X	H H X X	I
z-x 1 OrxN C3	H H * t—1 H *	- X O» X O M	1 0 1	u	u	u	U	W	M	S«	1*	i Qa
HNOHtOO	u u Qu u Q	O'-	-'t_»u oze;	1 1	x Q o r-	x f r* to	1 £
u 03 t u zx I	?? H Q X H O	&gt;i t_, * X h *	1 TJ t	—Z—'—'	&lt;	x-z x-z '■&gt; Xu/	1 O
t-¡ zx sc&amp;lt;_&amp;lt;H a:	u	-	:£u	u	O	- X C3“ X O	i O f	+ * * *	+ * * *	1 Cfl
u	1-1 X_Zu u s—z	t-1 tOzzx.r’ Qz-x	Xu O Xu Q	t ct 1	H 03 03 03	H 03 03 03	j
:xu * x&amp;lt;-&amp;lt;*	VhZs^1' f—1	"Ox-z	03 to aCu to o	* *	Q O O C3	o o q o	1 z"o
u	&lt;_Z Qu U	Q	*	- O’zxtJ’-'/x	t £ I	O H H H	O H H •—]	1 c+
je se
Ni «í IO tO
«
X to
P O P O
Pu O
o

£*M £M [-M
N*	W *u tO f»	
te r»	XN“ ^^3	
hh	tn ce	b-i	X
**	M	Z~X*	*	w
Cm	^hf4 ci	X
	* ■* 'w*-z Í3Í	to
		|*M
M		'v-z
r*	* f ro r*	*
	'-'W '—'	
1	1 z“s i	
N	NHN	
ce	W- W	
	t—) z—\	
hd	H» l-l	
	- r-’’-	
Cm	S i -	
r1	&gt; N f	
z	-	03'-'	
	'—'t-t&amp;lt;-í	
r*
[“* **	O H O O		z"~x	Cm '“■"■x	Cm			1—1	1 O 1	* o o o	
f*	KsjxzO		b4	- Nt	to		* *	to	1 H- 1	CO NJ *-&amp;lt;X	
* V-z	z-v * v		te	5*: te	rs:	*	Cm z~o	Cm	1 p 1	H to to to	
	' W /*&gt;'*-		o	* ✓-&gt;	to		to	M	to	1 H 1	Of S^VuZ	
	1 b4	t	1—!	tr* w	r*	N	te	P*	1 1	O 1	1	1
ta	te	1—L	M		*to-z	CO	* z-s	V	1 ft 1	z-,H H	W
	* z-x	«e	Cm	# Cm		z**x		í-^	1 S 1	Q CO "&amp;lt;X	
1—4	Cm M	Cm		*			VM* &gt;q	'u-Z	1 1	ttf H H H	
	** t		r-	r1		X	* *	*	1 H 1	a * *	*
1—	X H			V-z		to	Cm		1 ft 1	to	
		V	1	1		Cm	to		1 H 1	f**	H
Cm	Q H	r*	N	N		to	fuM,		1 P 1	DO O O	O
4*	X^Zu	'XhX	te	W		M-			t n t	JO M «i	X
r*	* r&gt;	*		Z“*X		x/	I		i p i		
	S—'		M	M		1	(S3		I O 1	i —i i.—i L i “1	hd
1	1		+	+		N1	DO		t	1	to	to	to
N	N					m	Z—-X		t p 1	Cm Cm	Cm
co	CD		■*	■»			W		t	1	to	to	to
	,	s		Cm	Cm		W	X		t 03 t	XXX	
J-d	H		w	a»		X	to		t H 1	to	to	to
w				r*1		*	U		I ft 1	rrr	
Cm	Cm		s_-*	■XM-		Cm	X		t tn t		
	w					X	to		1 w t	* #	*
r*	£«4						to		1 p t	03 03	03
	VpX					N?	*x_Z		t o t	O O	O
						■x-z	x_z		t	t	H H	H
									1	I	O O	O
to «:
x
I i i t
I
ft y o M
r nr
S&gt;
o
0
X
*
y (X
IX o
t/i
Cm Cm Cm
XXX
«&amp;lt;+
IX m
►o »
v_z
t~&amp;lt;(_,
* x en* c r*
1 + +
P CM
C P
SJ
P
fxrnj Cm
X X X
to f f
* O o o S-/ i
o -i
Cm

r*
n
p:
P
M-
—I to
C
*
*
PWY2PI=-1.0D0-(1.0D0-WY)*DDWd,J,K,L)*(ZB(I,J,L)-ZB(I, JMA,L) )
PVY2PP»1.0D0-WY*D0W(IíJMA,K,L)*(ZB(I,JíL)-ZB(I,JMA,L))
C
*
*
IF(L.EQ.1.AND.K.EQ.1.AND.KP.NE.1) THEN
POZ1PA=~1.ODO-(1.ODO-WZ)*DDO(IP,JP,KP-1,2)*(ZB(IP,JP,2)-ZB(I,J,1))
PWZlPA=-1.0D0"(1.0D0-WZ)*DDW(IP,JP,KP-l,2)*(ZB(IP,JP,2)“ ZB(I,J,1))
P0ZlPI=1.0D0+WZ*DDD(I,J,l,l)*(ZB(IP,JP,2)-ZB(IJJtl&gt;)
PWZ1PI=1.ODO+WZ*DDW(I,J,1,1)*(ZB(IP,JP,2)-ZB(I,J,1)) ELSE
PDZ1PA--1.0D0
PWZ1PA=-1,ODO
POZ1PW.ODO
PWZ1PK.0D0
END IF
o Cid	o nna
IF(L,EQ.1.AND.K.EQ.NZR.AND.KP+NBP-1.LT.NZC) THEN
PDZ2PI=-i.ODO+(i.ODO-WZ)*DDO(ItJ,NZR,l)*(ZB(I,J,l)~
ZB(IP JP 2))
PWZ2PI=-Í.ODÒ+(Í.ODO-WZ)*DDW(IJJJNZHJ1)*(ZB(IJJJÍ&gt;-ZB(IP JP 2))
P0Z2PP-1.ODO+WZ*DDD(IP,JP,KP+NBP,2)*(ZBd, J ,1)-ZB(IP, JP,2))
PWZ2PP=1.ODO+WZ*DDW(IP,JP,KP+NBP,2)*(ZB(I,J,1)-ZB(IP,JP,2)) ELSE
P0Z2PI=-1.0D0
PWZ2PI=-1.ODO
P0Z2PP=1.0D0
PWZ2PP-1.0DQ
END IF
Calculo das derivadas dos ternos de acumulacao ACW e ACO em relacao a a Swijj e Poi,j (nas demais variaveis essas derivadas se anulam)
DACWP=VPOR(I,J,K,L)*(CR*BW(I,JtK,L)*SW(I,J,K,L)+AUX1*
*	SW(IjJ3K,L)*DBW(I,JiKjL))/DT DACWS=VPQR(IiJíK1L)*AUX1*BW(I&gt;J3K)L)/DT
DACOP«VPOR(I,J&gt;K,L)*(CR*BO(I,JíK,L)*(1.ODO-SW(I,J,K,L))+
*	AUX1*(1,000-SWd, J ,K,L))*DBO(I, J,K,L))/DT
DACOS=-VPOR(IJJjK,L)*AUXl*BO(IjJfK,L)/DT
Calculo das deriv. das transmissib. TOX e TWX em relacao a pressão
*
*
*
*
C
IF(L.EQ.l.AND.I.EQ.NX) THEN
T0X2PI=(WRC-l.ODO)*TOX(I+1,JjL)*(DV0(I,JjK&gt;L)/ AUXVO-DBO(I,J »K,L)/AUXBO)
TQX2PP«-WRC*T0X(I+l,J,K,L)*(DVO(IX,JX,KP,2)/ AUXVO-DBO(IX,JX &gt;KP,2)/AUXBO)
TWX2PI=(WRC~1.0D0)*TWXd+l,J.K,L)*(DVW(I,J,K,L)/
AUXVW-DBW(IjJjK,L)/AUXBW)
TWX2PP=-WRC*TWX(1+1,J,K,L)*(DVW(IX,JX,KP,2)/ AUXVW-DBW(IX,JX,KP,2)/AUXBW)
IF(J.LE.NQL) THEN
IV-1
ENDIF
IF(J.GT.NQL.AND.J.LE.NQL+NQS) THEN
a aci
IV=4
ENDIF IF(IV,EQ,1.OR.IV.EQ.2) THEN
SDE0PI(IV,K)^SDEDPI(IV,K)-(T0X(I+l,J,K)l)*P0X2PP+P0T0X2*T0X2PP)
SDEOSI(IV,K)=SDEOSI(IV,K)-(P0T0X2*T0X2SP(I,JtK,1))
SDEWPI&lt;IVtK)=SDEWPI(IV,K)-&lt;TWX(I+1,JJKil)*PWX2PP+P0TWX2*TWX2PP)
SDEWSI(IV,K)=SDEWSI(IV,K)-(~TWX(I+1,J,K,1)*DPC(IX,JX.KP+K-l,2)+
*	P0TWX2*TWX2SP(I,J fK,1))
ENDIF
IF(IV.EQ.3.0R.IV.EQ.4) THEN
SDEOPI(IV,K)=SDEOPI(IV,K)-TOX(I+1,J,K,1)*P0X2PP-P0T0X2*T0X2PP SDEOSI(IV,K)~SDEOSI(IV,K)-POTOX2*TOX2SP(I,JfK,1)
SDEWPI(IV,K)=SDEWPI(IV,K)-TWX(I+1,J,KJ1)*PWX2PP“POTWX2*TWX2PP
SDEWSI (IV,K)=SDEWSI (IV,K)+TWX(I+1, J	D^DPCQX, JX,KP+K-1,2)-
*	P0TWX2*TWX2SP(I,J,K11)
ENDIF
DFWPX=~TWX(1+1,J,K,1)*PWX2PI~P0TWX2*TWX2PI DFWSX=“TWXd+l, J,K, 1)*DPC(I, J jK, 1)-POTWX2*TWX2SI(I, J ,K, 1) DFOPX=-TOX(I+1,J,K,1)*POX2PI-POTOX2*TOX2PI DF0SX=-P0T0X2*T0X2SI(I,J,K,1)
ELSE
T0X2PI=(W-l.ODO)*TOX(I+1,J,K,L)*(DVO(I,J,K,L)/
*	VOMX(I+1,J,K,L)-DBO(I,J,K,L)/BOMX(I+1,J,K,L)) TOX2PP="W*TOX(I+1,J,K,L)*(DVO(I+1,J,K,L)/
*	VOMXU+l, J ,K ,L)"DBO(I+13 J ,K ,L)/BOMX(I+1, J, K,L) ) TWX2PI=(W-1.ODO)*TWX(I+1,J,KtL)*(DVW(I,J,K,L)/
*	VWMX(I+1jJ,K,L)-DBW(I,JjK,L)/BWMX(I+1,J,KjD)
TWX2PP=-W*TWX(1+1,J,K,L)*(DVW(1+1,J,K,L)/
*	VWMXd+l, J,K,L)-DBW(I+1,J,K,L)/BWMX(I+1,J,K,L)) ENDIF
TOX1PA«IDR*((W-1.ODO)*TDX(I,J,K,L)*(DVO(I-1,J,K,L)/
*	VOMX(I,J,K,L)-DBQ(I-i,J,K,L)/BOMX(I,j,k,l))) TOX1PI=IDR*(-W*TOX(I,J,K,L)*(DVO(I,J,K,L)/VOMX(I,J,K,L)-
*	DBO(I,J,K,L)/BDMX(I,J,K,L))) TWX1PA«IDR*((W-1.ODO)*TWX(I,J,K,L)*(DVW(I-1,J,K,L)/
*	VWMX(I,J,K,L)-DBW(I-1,J,K,L)/BWMX(I,J1K,L))) TWX1PI*IDR*(-W*TWX(I,J,K,L)*(DVW(I,J,K,L)/VWMX(I,J,K,L)”
*	DBW(I,J,K,L)/BWMX(I,J,K,L)&gt;)
Calculo das deriv. das transmissib. TOY e TWY em relacao a pressao
TDYlPA^Grf-i.ODO^TOYd^K’U+GOVOa, JMEjKiLj7
*	V0MY(I,J,K,L)-DB0(I,JME,K,L)7B0MY(I,J,K,L)) TOY1PI=-WY*TOY(I,JjK}L)*(DVO(I,J,K,L)/V0MY(I,J,K,L)~
*	DB0(IfJ,K,L)/BOMY(IjJ,K,L))
T0Y2PI=(WY-1.ODO)*TOY(I,JMA,K,L)*(DVO(I,J,K,L)/
*	VOMY(l)JMAiKJL)"DBO(liJ1KJL)/BOMY(I,JMAiKiL)) T0Y2PP=-WY*T0Y(IUMAiK,L)*(DV0(I,JMA1K,L)/V0MY(IJJMA&gt;KJL)-
*	DBO(I,JMA,K,L)/BOMY(I,JMA,K,L)) TWY1PA-(WY-1.0D0)*TWY(I,J,K,L)*(DVW(I,JME,K,L)/
*	VWMY(I,J,K,L)-DBW(I,JME,K,L)/BWMY(I,J,K,L))
TWY1PI=:~WY*TWY(I, J ,Kjt)*(DVW(I, J ,K ,L)/VWMY(I, J ,K ,L)-
*	DBW(I,J,K,L)/BWMY(I,J,K,L)) TWY2PI=(WY“1.0D0)*TWY(I,JMA&gt;K,L)*(DVW(I,J,KJL)/
*	VWMY(I, JMAjKjD-DBWd, J JK,L)/BWMY(IJ JMAjK^L)) TWY2PP-~WY*TWY(I,JMA,K &gt; L)*(DVW(I,JMA,K,L)/VWMY(I,IMA,X,L) -
*	DBW(I,JMA,K,L)/BWMY(I,JMA,K,L))
C
o O
C
IF(L.EQ.1.AND.K.EQ.1.AND.KP.NE.1) THEN IV=5 TQZlPA=(WZ-1.0D0)*T0Z(I,J,l,l)*(DV0(IP,JP,KP-l,2)/
*	VOMZ(I,J,1,1)-DBO(IP,JP,KP-l,2)/B0MZ(I,J,l,l)) TOZ1PI-~WZ*TOZ(I,1,1,1)*(DV0(I,J,1,1)/VOMZ(I,1,1,1)-
*	DBO(I,J,1,1)/BOMZ(I,1,1,1)) TWZ1PA-(WZ-1.ODO)*TWZ(I,J,1,1)*(DVW(IP,1P,KP-1,2)/
*	VWMZ(I,J,l,l)-DBW(IP,JP,KP-l,2)/BWMZ(l,1,1,1)) TWZIPI^-WZ+TWZÍI,1,1,1)*(DVW(I,1,1,1)/VWMZ(I,1,1,i)~
*	DBW(I,1,1,1)/BWMZ(I,1,1,1)) SDEQPI(IV,K)»SDEOPI(IV,K)+(TOZ(I,1,1,1)*POZ1PA+POTOZ1*TOZ1PA) SDEOSI(IV,K)=SDE0SI(IV,K)+(POTOZ1*TOZ1SA(I,1,1,1)) SDEWPI(IV,K)=SDEWPI(IV,K)+(TWZ(1,1,1,1)*PWZ1PA+POTWZ1*TWZ1PA) SDEWSI(IV,K)~SDEWSI(IV,K)+(TWZ(I,1,1,1)*DPC(IP,JP,KP-1,2)+
*	POTWZ1*TWZ1SA(I,1,1,1))
DFWPZ=TWZ(I,1,1,1)*PWZ1PI+POTWZ1*TWZ1PI
DF0PZ=T0Z(I,1,1,1)*POZ1PI+PDTOZ1*TOZ1PI DFOSZ=POTOZ1*TOZ1SI(I,1,1,1) DFWSZ=“TWZ(I,1,1,1)*DPC(I,1,1,1)+POTWZ1*TWZ1SI(I,I,1,1) ELSE
T0ZlPA«(WZ-1.0D0)*T0Z(I,l,K,L)*(DV0(I,l,K-l,L)/
*	VOMZ(I,1,K,L)-DBO(I,1,K-1,L)/BOMZ(I,1,K,L)) TOZ1PI®-WZ*TOZ(I,1,K,L)*(DV0(I,1,K,L)/VOMZ(I,J,K,L)-
*	DBO(I,J,K,L)/BDMZ(I,1,K,L))
TWZ1PA=(WZ-1.0D0)+TWZ(I,1,K,L)*(DVW(I,1,K-1,L)/
*	VWMZ(I,1,K,L)-DBW(I,1,K-1,L)/BWMZ(I,1,K,L)) TWZ1PI=-WZ*TWZ(I,J,K,L)*(DVW(I,J,K,L)/VWMZ(I,J,K,L)-
*	DBW(I,J,K,L)/BWMZ(I,J,K,L)) ENDIF
IF(L,EQ.1■AND.K.EQ.NZR.AND.KP+NBP-1. LT.NZC) THEN IV®6
T0Z2PI=(WZ-1.0D0)*T0Z(I,1 ,NZR+1, 1) *(DVO(I,I,NZR,1)/
*	VOMZ(I,l,NZR+l,l)-DBO(I,I,NZR,l)/BOMZ(l,l,NZR+l,l))
T0Z2PP=-WZ*T0Z(I,I,NZR+1,1)*(DVD(IP,1P,KP+NBP,2)/
*	VOMZ (I, J ,NZR+1,1) -DBO (IP, JP, KP+NBP,2)/BDMZ(I,1 ,NZR+1,1)) TWZ2PI“(WZ-1.0D0)*THZ(I,l,NZR+l,l)*(DVW(I,l,NZR,l)/
*	VWMZ(I,I,NZR+1,1)-DBW(I,1,NZR,1)/BWMZ(I,J,NZR+1,1)) TWZ2PP=-WZ*TWZ(I,J,NZR+1,1)*(DVW(IP,IP,KP+NBP, 2)/
*	VHMZ(1,1,NZR+1,1)-DBW(IP,1P,KP+NBP,2)/BWMZ(I,I,NZR+1,1) ) SDEOPI(IV,K)“SDEOPI(IV,K)“(TOZ(I,1,NZR+1,l)*PDZ2PP+P0T0Z2*T0Z2PP) SDE0SI(IV,K)=SDE0SI(IV,K)-(P0T0Z2*T0Z2SP(I,l,NZR,l)) SDEWPI(IV,K)«SDEWPI(IV,K)-CrWZ(I,l,NZR+l,l)*PWZ2PP+P0TWZ2*TWZ2PP) SDEWSI(IV,K)=SDEWSI(IV,K)-(-TWZ(I,l,NZR+l,l)*DPC(IP,lP,KP+NBP,2)+
*	P0TWZ2+TWZ2SP(I,1,NZR,1))
DFWPZ-TWZ(I,1,NZR+1,1)*PWZ2PI+POTWZ2*TWZ2PI
DFQPZ=TOZ(I,1,NZR+1,l)*P0Z2PI+P0T0Z2*T0Z2PI DF0SZ=P0T0Z2*T0Z2SI(1,1,NZR, 1)
DFWSZ=TWZ(1,1,NZR,1)*DPC(I,1,NZR, l)+P0TWZ2*TWZ2SI(I,l,NZR,1)
DFWPZ=-DFWPZ
DFOPZ--DFOPZ
DFOSZ=-DFWSZ
DFWSZ=-DFWSZ
ELSE
TOZ2PI®(WZ~1.0DO)*TOZ(I,J,K+1,L)*(DVO(I,J,K,L)/
*
VOMZ(Í,J,K+1,L)-DBÓ(I,í,K,L)/BOMZ(Í,í,K+1,L))
nao	ono	o an	nao aon	a nano no o anona
*	DBO(I,J,K+1,L)/BOMZ(I,J,K+1,L))
TWZ2PI&lt;WZ-1.0D0) *TWZd , J&gt;K+l,L) *(DVWd , J ,K,L) /
*	VWMZd, J, K+l,L)-DBW(I,J,K,L)/BWMZ(I,J,K+i,L)) TWZ2PP--WZ*TWZ(I, J,K+1,L)*(DVW(I, J,K+1 ,L)/VWMZd, J,K+1 ,L)-
*	DBWfl,J,K+1,L)/BWMZ(X,J,K+1,L))
ENDIF
Determinação das derivadas das funcoes de residuos em relacao as variaveis da malha : determinação dos elementos da matriz jacobiana dFw/Poi,j,k
CALL JAC (I,J,K,L)
15 CONTINUE
1000 CONTINUE RETURN
END
MONTAGEM DA MATRIZ JACOBIANA PARA GRID COMPOSTO MATRIZ COM BLOCOS 2X2
SUBROUTINE JAC (I,J,K,L)
IMPLICIT DOUBLE PRECISION(A-H,O-Z)
PARAMETER(NXM=08,NYM=O5,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ , WRC,NBLOC,NXC,NYC,NZC,NBP ,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMDN/NBLC/A,D,NBC,NBR,NBT
C0MM0N/ANULA/IX1,1X2,IY1,IY2,IZ1,IZ2,IDR,IDC,LBC,JMA,JME,IX, JX, LBR
DIMENSION A(NXM*NYM*NZM*4,NXM*NYM*NZM*4),D(NXM*NYM*NZM*4)
PARTE REFERENTE AO GRID CARTESIANO
KP1=KP
KPN=KP+NBP-1
IF(L.EQ.2) THEN
—I-----	(1,1,1) ate (ip-2,j,k)
IF(I.LE.(IP-2)) THEN
NCC«(I-1)+NYC+NZC+(J-1)*NZC+K
CALL MONTA (I,J,K,L,NCC)
ENDIF
—2----- de (ip-l,l,k) ate (ip-1,jp-1,k)
IF(I&gt;EQ.(IP-1) .AND.J.LE.(JP-1)) THEN NCC=(I-1)*NYC*NZC+(J-1)*NZC+K CALL MONTA (I,J,K,L,NCC)
ENDIF
—3----- de (ip-l,jp,l) ate (ip-1,jp,kpl-l)
IF(I.EQ.(IP-i) .AND. J.EQ. JP.AND.K,LT.KPI) THEN NCC=(I-1)+NYC+NZC+(J-1)*NZC+K CALL MONTA d,J,K,L,NCC)
ENDIF
-4-----de (ip-1,jp.kpl) ate (ip-1,jp,kpn)
C
C
c
IF(I.EQ,(IP-1).AND.J.EQ.JP.AND.K.GE.KP1.AND.K.LE.KPN) THEN NCC- (I -1) *NYC*NZC+ (J-1) *NZC+K CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1 zerar os elementos i+1
IF(I.NE.NXC) THEN dfo/dpoi+lj ,sgi+l,j, swi+l,j NH~NL+NYC+NZC*2 A(NL,NH)=0.ODO A(NL,NH+1)=O.ODO dfw/dpoi+l,j ,sgi+ljj, swi+l,j
A(NL+1,NH)=O.ODO A(NL+1,NH+1)=O.ODO END IF
END IF
ono	n	no	ano
—5----- de (ip-1,jp,kpn+l) ate (ip-1,jp,nzc)
IF(I.EQ.(IP-1).AND.J.EQ.JP.AND.K.GT.KPN) THEN NCC=(I-1)*NYC*NZC+(J-1)+NZC+K CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1
reduzir de 1 posicao os eleitientos i+1
IF(I.NE.NXC) THEN dfo/dpoi+l,j ,sgi+l,j, swi+l,j
NH=NL+NYC*NZC*2
NP=NBP*2
A(NL,NH-NP)=A(NL,NH)
A(NL,NH-NP+1)-A(NL,NH+1)
A(NL,NH)=0.ODO
A(NL,NH+1)=O.ODO
dfw/dpoi+1,j ,sgi+l,j, swi+l,j
A(NL+1,NH-NP)=A(NL+1,NH)
A(NL+1,NH-NP+1)=A(NL+1,NH+1)
A(NL+1,NH)=O.ODO
A(NL+1,NH+1)=O.ODO
ENDIF
ENDIF
—§-----¿e (ip-ijp+i,1) ate (ip-l,nyc,nzc)
C
C
C
IF(I.EQ.(IP-1).AND.J.GE.JP+1) THEN NCC=(I-1)+NYC+NZC+(J-1)+NZC+K CALL MONTA (I,J,K,L,NCC) NL=2*NCC-1 reduzir de 1 posicao os elementos i+1 IF(I.NE.NXC) THEN dfo/dpoi+l,j ,sgi+l,j, swi+l,j NH=NL+NYC*NZC*2 NP=NBP*2 A(NL,NH-NP)=A(NL,NH) A(NL,NH-NP+1)=A(NL,NH+1) A(NL,NH)=0.ODO A(NL,NH+1)=O.ODO dfw/dpoi+lj ,sgi+l,j, swi+l,j
A(NL+1,NH-NP)-A(NL+1,NH) A(NL+1,NH-NP+1)=A(NL+1,NH+1) A(NL+1,NH)=O.ODO
A(NL+1,NH+1)=O.ODO
ENDIF
ENDIF
no	o nn	n	no	non	n	no	non
—7-----a-te (ip;jp-2,nzc)
IF(I.EQ.IP.AND.J.LE.(JP-2)) THEM
NCC=(I-1)*NYC*NZC+(J-1)*NZC+K CALL MQNTA (I,J,K,L,NCC) NL=2*NCC”1 reduzir de 1 posicao os elementos i+1
IF(I.NE.NXC) THEN dfo/dpoi+l,j ,sgi+l,j, swi+lj
NH=NL+NYC*NZC*2 NP=NBP*2 A(NL,NH-NP)=A(NLfNH)
A(NL,NH-NP+1)“A(NL,NH+1) A(NL,NH)=0.ODO A(NL,NH+1)-O.ODO dfw/dpoi+l,j ,sgi+i,j, swi+l,j
A(NL+i,NH-NP)=A(NL+l,NH)
A(NL+1,NH-NP+1)=A(NL+1,NH+1) A(NL+l,NH)=0.0D0
A(NL+1,NH+1)=O.ODO
ENDIF
ENDIF
—8----- de (ip,jp-1,1) ate (ip,jp“l,kpl-l)
IFd.EQ.IP.AND.J.EQ. (JP-1).AND.K.LT.KPI) THEN NCC=(I-1)*NYC*NZC+( J-1)*NZC+K CALL MONTA (I,JjK,L,NCC)
NL=2*NCC-1 reduzir de 1 posicao os elementos i+l IFd.NE.NXC) THEN
dfo/dpoi+l,j ,sgi+i,j, swi+lj
NH=NL+NYC*NZC*2 NP=NBP*2 A(NLfNH-NP)=A(NL,NH) A(NL,NH-NP+1)=A(NL,NH+1) A(NL,NH)=O.ODO A(NL,NH+1)=O.ODO
dfw/dpoi+l,j jSgi+i.j, swi+l,j
A(NL+1,NH-NP)=A(NL+1,NH)
A(NL+1,NH-NP+1)-A(NL+1,NH+1)
A(NL+1,NH)=O.ODO A(NL+1,NH+1)«O.ODO ENDIF
ENDIF
—9-----de (ip,jp-l,kpl) ate (ip,jp-l,kpn)
IF(I.EQ.IP.AND.J.EQ. (JP-1).AND.K.GE.KPI .AND.K.LE.KPN) THEN
NCC-d-l)*NYC*NZC+(J-i)*NZC+K
CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1
zerar os elementos em j+1 dfo/dpoi,j+l ,sgi,j+i, swi,j+l
NH=NL+NZC*2
A(NL,NH)~O.ODO
A(NL,NH+l)=0.0D0
C dfw/dpoi,j+l ,sgi,j41, swi,j+l
A(NL+1,NH)=0.ODO
C
C
c
A(NL+1,NH+1)=O.ODO reduzir de 1 posicao os elementos i+1 IF(I.NE.NXC) THEN dfo/dpoi+l,j ,sgi+l,j, swi+l,j
NH=NL+NYC*NZC*2 NP=NBP*2 A(NL,NH~NP)«A(NL,NH) A(NL,NH-NP+1)=A(NL,NH+1) A(NL,NH)«O,ODO A(NL,NH+l)=0.0D0 dfw/dpoi+ljj ,sgi+l,j, s»i+i,j
A(NL+1,NH~NP)=A(NL+1,NH) A(NL+1,NH-NP+1)=A(NL+1,NH+1) A(NL+1,NH)-0.ODO
A(NL+1,NH+1)=O.ODO
ENDIF
OO U	U Q	O	O Q	O	OO G&gt;
END IF
—1$— ¿e (ip,jp-1,kpn+l) ate (ip,jp-1,nzc)
IF(I.EQ.IP.AND.J.EQ. (JP-1).AND.K.GT.KPN) THEN NCC=(I-1&gt;*NYC*NZC+(J-1)*NZC+K CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1
NP=NBP*2
reduzir de 1 posicao os elementos i+1
IF(I.NE.NXC) THEN dfo/dpoi+l,j ,sgi+l,j, swi+l,j
NH=NL+NYC*NZC*2
A(NL,NH~NP)=A(NL,NH) A(NL,NH-NP+1)=A(NL,NH+1) A(NL,NH)=0.0D0 A(NL,NH+l)-0.ODO dfw/dpoi+l,j ,sgi+l,j, swi+l,j
A(NL+1,NH-NP)=A(NL+1,NH) A(NL+1,NH-NP+1)=A(NL+1,NH+1) A(NL+i,NH)=0.0D0
A(NL+1,NH+l)®0.0D0
ENDIF
reduz os elementos em j+1 dfo/dpoi,j+1 ,sgi,j+l, swi,j+l
NH=NL+NZC*2
A(NL,NH-NP)=A(NL,NH)
A(NL,NH-NP+l)=A(NL,NH+i)
A(NL,NH)=0.ODO A(NL,NH+l)=0.0D0 dfw/dpoi,j+l ,sgi,j+l, swi,j+l
A(NL+1,NH-NP)=A(NL+1,NH)
A(NL+1,NH-NP+1)=A(NL+1,NH+1) A(NL+1,NH)=0.ODO
A(NL+1,NH+1)=O.ODO
ENDIF
—11---- de (ip,jp,l) ate (ip,jp,kpl-2)
C
C
C
C
C
C
o on
NP=NBP*2 reduzir de 1 posicao os elementos i+1 IF(I.NE.NXC) THEN dfo/dpoi+l,j ,sgi+l,j, swi+l,j NH=NL+NYC*NZC*2 A(NL,NH-NP)=A(NLJNH) A(NL,NH-NP+1)=A(NL,NH+1) A(NL,NH)=0,ODO A(NL,NH+1)=O.ODO dfw/dpoi+i,j ,sgi+l,j, swi+l,j
A(NL+1,NH-NP)=A(NL+1, NH) A(NL+1,NH-NP+1)=A(NL+1,NH+1) A(NL+i,NH)~O.ODO A(NL+1,NH+1)=O.ODO
ENDIF redux os elementos em j+1
IF(J.NE.NYC) THEN dfo/dpoi,j+l ,sgi,j+l, swij+l
NH=NL+NZC*2 A(NLiNH-NP)=A(NL,NH) A(NL,NH-NP+1&gt;A (NL.NH+l) A(NL,NH)=O.ODO A(NL,NH+1)=O.ODO dfw/dpoi,j+l jSgi.j+l, swi,j+l
A(NL+1,NH-NP)=A(NL+1,NH) A(NL+1,NH-NP+1)=A(NL+1,NH+1) A(NL+l,NH)S50 .ODO
A(NL+1,NH+1)“0.ODO
ENDIF
ENDIF
— 12--- (ip,jp,kpl-l)
C
C
C
C
C
IF(I.EQ.IP.AND.J.EQ.JP.AND.K.EQ.(KP1-1)) THEN NCC=(I-i)*NYC*NZC+(J~l)*NZC+K CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1 NP=NBP*2 reduzir de 1 posicao os elementos i+1 IF(I.NE.NXC) THEN dfo/dpoi+l,j ,sgi+l,j, swi+l,j
NH=NL+NYC*NZC*2 A(NL,NH-NP)«A(NL,NH) A(NL,NH-NP+1)-A(NL,NH+1) A(NL,NH)=O.ODO A(NL,NH+1)=O.ODO dfw/dpoi+l,j ,sgi+l,j, swi+lj
A(NL+1,NH-NP)=A(NL+1,NH)
A(NL+1,NH-NP+1)=A(NL+1,NH+1)
A(NL+1,NH)=0.ODO
AfNL+i,NH+1)=O.ODO
ENDIF
reduz os elementos em j+1 IF(J.NE.NYC) THEN dfo/dpoi,j+1 ,sgi,j+l, swij+l
NH=NL+NZC*2 A(NL,NH-NP)=A(NL,NH) A(NL,NH-NP+1)=A(NL,NH+1) A(NL,NH)=O.ODO
C
C
c
c
n on
c
c
c
c
C
C
C
c
c
A(NL,NH+l)-0.0D0 dfw/dpoi,j+l ,sgi,j+l, swi,j+l
A(NL+1f NH-NP)=A(NL+1f NH) A(NL+1,NH-NP+1)=A(NL+1,NH+1) A(NL+l,NH)«0.0D0 A(NL+l,NH+l)=0.0D0
ENDIF anula os elementos em k+1
IF(K.NE.NZC) THEN dfo/dpoi,j,k+l ,sgi,j,k+i, swi^jjk+l A(NLINL+2)=0.0D0 A(NL,NL+3)«0.0D0 dfw/dpoi,j,k+l ,sgi,j,k+l, swi,j,k+l A(NL+1,NL+2)=0.0D0 A(NL+1,NL+3)=0.0D0
ENDIF ENDIF_ — 13--- (ip,jp,kpn+l)
IF (I.EQ,IP.AND. 1. EQ.JP.AND.K.EQ.(KPN+1j) THEN NCO (I-l) +NYC+NZC+ (J-1) +NZC+K-NBP CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1 NP=NBP*2 avançar de 1 posicao os elementos i-1
IF(I.NE.l) THEN dfo/dpoi-l,j &gt;sgi-l,j, swi-l,j
NH=NL-NYC*NZC*2 A(NL,NH+NP)=A(NL,NH) A(NL,NH+NP+1)-A(NL,NH+1) A(NL,NH)=0.0D0 A(NL,NH+l)a0.0D0 dfw/dpoi-l.j ,sgi-i,j, swi’l,j
A(NL+1,NH+NP)=A(NL+1,NH) A(NL+1,NH+NP+1)=A(NL+1,NH+1) A(NL+1,NH)=0.0D0
A(NL+1,NH+1)=O.0D0
ENDIF avançar os elementos em j-1
IF(J.NE.l) THEN ,sgi,j-l, swij-l NH=NL-NZC*2 A(NL,NH+NP)=A(NL,NH) A(NL,NH+NP+1)=A(NL,NH+1) A(NL,NH)=O,ODO A(NL,NH+1)~O.0D0 ,sgi,j-l, swíj-l A(NL+1,NH+NP)-A(NL+1,NH) A(NL+1fNH+NP+1)=A(NL+1,NH+1) A(NL+1tNH)«0,0D0 A(NL+l1NH+l)=0.0D0
ENDIF anula os elementos em k-i IF(K.NE.l) THEN dfo/dpoi,j,k”l ,sgi,j,k-l, swi &gt;j,k-l A(NL,NL-2)=0.0D0 aOíl.nl-íM.odo
dfw/dpoi,j,k-l ,sgij,k-l, swi,j,k-l
dfo/dpoi,j-1
dfw/dpoi,j-1
ono	a	ao	a	o o	ooo
ENDIF
ENDIF
A(NL+l,NL-2)=0.0D0
A(NL+1,NL-1)=0.000
—14— (ip,jp,kpn+2) ate (íp,jp,nzc)
IF(I.EQ.IP.AND.J.Eq.JP.AND.K,GT.(KPN+1)) THEN NCC=(I-l)*NYC*NZC+(J-í)*NZC+K-NBP CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1 NP=NBP*2 avançar de 1 posicao os elementos i-1
IF(l.NE.l) THEN dfo/dpoi-i,j ,sgi~l,j, swi-l,j NH=NL-NYC*NZC*2 A(NL,NH+NP)=A(NL,NH) A(NL,NH+NP+1)=A(NL,NH+1) A(NL,NH)=O.ODO A(NL,NH+1)=O.0D0 dfw/dpoi-1,j ,sgi-l,j, swi-lj
A(NL+1,NH+NP)=A(NL+1,NH) A(NL+1,NH+NP+1)=A(NL+1,NH+1) A(NL+1,NH)=O.ODO A(NL+1,NH+1)=O,ODO
ENDIF avançar os elementos em j-1 IF(J.NE.l) THEN ,sgi,j-l, swij-l NH=NL-NZC*2 A(NL,NH+NP)«A(NL,NH) A(NL,NH+NP+1)=A(NL,NH+1) A(NL,NH)-0.0D0 A(NL,NH+1)»O.000 ,sgi,j-l, swi,j-l A(NL+1,NH+NP)=A(NL+1,NH) A(NL+1,NH+NP+1)=A(NL+1,NH+1) A(NL+l,NH)»0.0D0 A(NL+1,NH+1)=O. 0D0
oij-1
dfv/dpoi,j~l
ENDIF
ENDIF
—15---- (ip,jp+l,l) ate (ip,jp+l,kpl-l)
IF(I.EQ.IP. AND.J .EQ. (JP+1) . AND.K".LT.KP1) THEN
NCC=(I-1)*NYC*NZC+(J-1)+NZC+K-NBP
CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1
NP=NBP*2
C avançar de 1 posicao os elementos i-1
IF(I.NE.l) THEN
C dfo/dpoi-lj ,sgi-l,j, swi-lj NH=NL-NYC*NZC*2 A(NL,NH+NP)=A(NL,NH)
A(NL,NH+NP+1)«A(NL,NH+1) A(NL,NH)=0.0D0 A(NL,NH+1)=O.ODO
C dfw/dpoi-ÍJ ,sgi-l,j, swi-l,j
A(NL+1,NH+NP)-A(NL+1,NH)
c
c
c
A(NL+1,NH+NP+1)=A(NL+1,NH+1)
A(NL+1,NH)~O.ODO
A(NL+1,NH+1)=O.ODO
END IF avançar os elementos era j-1
IF(J.NE.l) THEN
dfo/dpoi,j-l
dfw/dpoijj-l
ENDIF
END IF
,Sgl,J-i, SW1J-1 NH«NL-NZC*2 A(NL,NH+NP)=A(NL,NH) A(NL,NH+NP+1)=A(NL,NH+1) A(NL,NH&gt;0.0D0
A(NL,NH+1)=0.ODO
,sgi,j-l, swi,j-l
A(NL+1,NH+NP)=A(NL+1,NH) A(NL+1,NH+NP+1)=A(NL+1,NH+1) A(NL+1,NH)=Q.ODO
A(NL+1,NH+1)=O.ODO
non	non	o	o a	aoa
—15— (ip,jp+1 ,kj)l) ate (ip,jp+1,kpn)
IF(I.EQ.IP.AND.J.EQ.(JP+1).AND.K.GE.KPI.AND.K.LE.KPN) THEN NCC=(I-1)*NYC*NZC+(J-1)+NZC+K-NBP CALL MONTA (I,J,K,L,NCC)
NL-2*NCC-1 NP=NBP*2 avançar de 1 posicao os elementos i~l
IF(I.NE.l) THEN dfo/dpoi-l,j ,sgi”l,j, swi-l,j
NH=NL-NYC*NZC*2 A(NL,NH+NP)»A(NL,NH) A(NL,NH+NP+1)»A(NL,NH+1)
A(NL,NH)=0.ODO A(NL,NH+1)=O.ODO
dfw/dpoi-l,j ,sgi-l,j, svi-l.j
A(NL+1,NH+NP)"A(NL+1,NH)
A(NL+1,NH+NP+1)=A(NL+1,NH+1)
A(NL+1,NH)=0,ODO
A(NL+1,NH+1)=O.ODO ENDIF
anula os elementos em j~l
IF(J.NE.l) THEN dfo/dpoi,j-l ,sgi,j-l, swi,j-l
NH-NL-NZC*2 A(NL,NH)=0.ODO A(NL,NH+1)=Q.ODO
dfw/dpoij-l ,sgi,j-l, swij-l
A(NL+1,NH)=O.ODO A(NL+1,NH+1)=O.ODO ENDIF
ENDIF
—17---- (ip,jp+l,kpn+l) ate (ip,jp+1,nzc)
C
C
c
oaa	o	no	a on
avancar de 1 posicao os elementos i-1
IF(I.NE.l) THEN dfo/dpoi-l,j ,sgi-l,j, swi-l,j
NH=NL-NYC*NZC*2
A(NL,NH+NP)=A(NL,NH) aCnunh+np+D-aCni^nh+i) A(NL,NH)=O.ODO
A(NL,NH+1)=O.ODO dfw/dpoi-l,j ,sgi-l,j, swi-ljj
A(NL+1,NH+NP)“A(NL+1,NH)
A(NL+1,NH+NP+1)=A(NL+1,NH+1)
A(NL+1,NH)=0.ODO
A(NL+1,NH+i)=O.ODO
ENDIF
ENDIF
—17a—	(ip,jp+2,l) at® (ipjiiycjiizc)
IF(I.EQ.IP.AND.J.GE.(JP+2)) THEN
NCO(I-1)*NYC*NZC+(J-1)*NZC+K-NBP CALL MONTA (I,J,K,L,NCC) NL=2*NCC-1 avaucar de 1 posicao os eleroentos i-1 dfo/dpoi-lj ,sgi-l,j, swi-l,j
IF(I.NE.l) THEN NH=NL~NYC*NZC*2 NP=NBP*2 A(NL,NH+NP)=A(NL,NH) AiNL.NH+NP+D-ACNLjNH+l) A(NL,NH)=0.ODO A(NL,NH+1)=O.ODO dfw/dpoi-1,j ,sgi-l,j, swi-1,j
A(NL+1 ,NH+NP)S£A(NL+1,NH) A(NL+1,NH+NP+1)=A(NL+1,NH+1) A(NL+1,NH)=0.ODO
A(NL+1,NH+1)=O.ODO
ENDIF
ENDIF
—18—	(ip+1,1,1) ate (ip+l,nyc,nzc)
IF(X.EQ.(IP+1).AND.J.LE.(JP-1)) THEN NCC=(I-1)*NYC*NZC+(J-1)*NZC+K~NBP CALL MONTA (I,JtK,L,NCC) NL«2*NCC-1
C avancar de 1 posicao os elementos 1-1 IF(I.NE.I) THEN
C dfo/dpoi-l,j ,sgi-l,j, swi-l,j NH-NL-NYC*NZC*2
A(NL,NH+NP)=A(NL,NH) A(NL,NH+NP+1)=A(NL,NH+1) A(NL,NH)=0.0D0 A(NL,NH+1)=O.ODO
C dfw/dpoi-1,j ,sgi-l,j, swi-l,j
A(NL+1,NH+NP)=A(NL+1,NH) A(NL+1,NH+NP+1)«A(NL+1,NH+1) A(NL+l,NH)=0.0D0
A(NL+1,NH+1)=O.ODO
ENDIF
aoo	n no	ci on	n	no	n nn	o	an	non
ENDIF
—19— (ip+l,jp,l) ate (ip+1,jp,kpl-i)
IF(I.EQ.(IP+1) .AND.J.Eq.JP.AND.K.LT.KPI) THEN NCC=(I-1)*NYC*NZC+(J-1)*NZC+K~NBP CALL MONTA (I,J,K,L,NCC)
NL=2*NCC~1 avancar de 1 posicao os elementos i-1
IF(I.NE.l) THEN dfo/dpai-1,j ,sgi-l,j, swi-l,j
NH=NL-NYC*NZC*2 NP-NBP+2
A(NL,NH+NP)=A(NL,NH) A(NL,NH+NP+1)=A(NL,NH+1) A(NL,NH)=0.0D0 A(NL,NH+1)=O.ODO
dfw/dpoi-1,j ,sgi-l,j, swi-l,j A(NL+1,NH+NP)»A(NL+1,NH) A(NL+1,NH+NP+1)-A(NL+1,NH+1) A(NL+1,NH)=0.ODO A(NL+l,NH+l)=0.0D0
ENDIF
ENDIF
—20—	(ip+1,jp.kpl) ate (ip+1,jp,kpn)
IF(I.EQ.(IP+1).AND.J.EQ.JP.AND.K.GE.KP1.AND.K.LE.KPN) THEN NCC=(I-1)+NYC+NZC+(J-1)+NZC+K-NBP CALL MONTA (I,J,K,L,NCC)
NL=2*NCC-1 anula os elementos i~l
IF(I.NE.l) THEN dfo/dpoi~l,j ,sgi-l,j, swi-l,j NH=NL-NYC*NZC*2 A(NL,NH)=0.0D0 A(NL,NH+1)=O. ODO dfw/dpoi-1,j ,sgi-l,j, swi—l,j
A(NL+1,NH)=O-ODO
A(NL+l,NH+l)«0.0D0
ENDIF
ENDIF
—21—	(ip+1,jp,kpn+l) ate (ip+1,jp,nzc)
IF(I.EQ.(IP+1).AND.J.EQ.JP.AND.K.GT.KPN) THEN NCC=(I -1)*NYC*NZC+(J-1)+NZC+K-NBP CALL MONTA (I,J,K,L,NCC)
ENDIF
—22  (ip+1,jp+1,1) ate (ip+l,nyc,nzc)
IF(I.EQ.(IP+1).AND.J.GE.(JP+1)) THEN NCC=(I“1)*NYC*NZC+(J-1)+NZC+K-NBP CALL MONTA (I,J,K,L,NCC)
ENDIF
—23---- (ip+2,1,1) ate (nxc,nyc,nzc)
IF(I,GE.(IP+2)) THEN
NCC=(I-1)+NYC+NZC+(J-1)+NZC+K-NBP
CALL MONTA (I,J,K,L,NCC)
Goon a aan o o naan
END IF
ENDIF
PARTE REFERENTE AD GRID RADIAL
IF(L.EQ.l) THEN
NCR=NBC+(I-1)*NYR*NZR+(J-1)*NZR+K CALL MONTA (I,J,K,L,NCR)
ENDIF
PARTE REFERENTE AS INTERFACES DO RADIAL COM 0 CARTESIANO
IF(L.EQ.1.AND.I.EQ.NXR) CALL MONTAIN (I,J,K,L,1)
IF(L.EQ.1.AND.K.EQ.1.AND.KP.NE.l) CALL MONTAIN (I,J,K,L,2)
IF(L.EQ.1.AND.K.Eq.NZR.AND,KP+NBP~1.LT.NZC)CALL MONTAIN(I,J,K,L,3)
RETURN
END
MONTAGEM DA MATRIZ JACOBIANA
SUBROUTINE MONTA (I^K^NC)
IMPLICIT DOUBLE PRECISION(A-H.O-Z)
PARAMETER(NXM=08,NYM=05,NZM=O4)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC ,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NqS,NQIfIP,JP,KP
COMMON/NBLC/A,D,NBC,NBR,NBT
COMMON/PETR/KRO,KRW,DKRO,DKRW,PC,DPC
COMMON/DTRANS/TOX,TWX,TOY,TWY,TOZ,TWZ,
*	TOX1SA,TOX1SI,TWX1SA,TWX1SI,
*	T0X2SI,T0X2SP}TWX2SI,TWX2SPJ
*	TOY1SA,TOY1SI,TWY1SA,TWY1SI,
*	TOY2SI,T0Y2SP,TWY2SI,TWY2SP,
*	TOZ1SA,TOZ1SI,TWZ1SA,TWZ1SI,
*	T0Z2SI,T0Z2SP,TWZ2SIjTWZ2SP
COMMON/VAZAO/qO,QOT,QG,QGT,qW,QWT,DQOP,DqOS,
*	DqWP,DQWS ,RWO,RGQ,PWF,TEMPO
COMMON/ANULA/IX1 tIX2,IYl,IY2,IZl,IZ2,IDR,IDCtLBC,JMA,JME,IX,JX,LBR
COMMON/ACU/ACO,ACW,DACOP,DACOS,DACWP,DACWS
COMMON/POT/POTOX1,P0T0X2,POTOY1,P0T0Y2,POTOZ1,P0TDZ2,
*	POTWX1,P0TWX2,P0TWYl,P0TWY2,P0TWZl,PDTWZ2,
*	POX1PA,POX1PI,POY1PA,POY1PI,POZ1PA,POZ1PI,
*	POX2PI,POX2PP,PDY2PI,POY2PP,POZ2PI,P0Z2PP,
*	PWX1PA,PWX1PI,PWY1PA,PWY1PI,PWZ1PA,PWZ1PI,
*	PWX2PI,PWX2PP,PWY2PI,PWY2PP,PWZ2PI,PWZ2PP,
*	T0X1PA,T0X1PI,TOY1PA,TDY1PI,TDZ1PA.T0Z1PI,
*	T0X2PI,T0X2PP,T0Y2PI,T0Y2PP,TOZ2PI,T0Z2PP,
*	TWX1PA,TWX1PI,TWY1PA,TWY1PI,TWZ1PA,TWZ1PI,
*	TWX2PI,TWX2PP,TWY2PI,TWY2PP,TWZ2PI,TWZ2PP
COMMON/SDEOW/STPO,STPW,SDEOPI,SDEOSI,SDEWPI,SDEWSI,
*	DFOPX,DFOSX,DFWPX,DFWSX,DFOPZ,DFOSZ,DFWPZ &gt; DFWSZ
DIMENSION DKR0(NXM,NYM,NZM,2),DKRW(NXM,NYM,NZM,2),
*	PC(0:NXM+l,0:NYM+l,0:NZM+l,2),DPC(Q:NXM+1,0:NYM+1,0:NZM+1,2)
REAL*8	KR0(NXM,NYM,NZM,2),KRW(NXM,NYM,NZM,2)
DIMENSION TOX(NXM+1,NYM,NZM , 2),TWX(NXM+11NYM,NZM,2),
*	T0XlSA(NXMJNYM)NZMi2)iTQXlSI(NXM1NYMfNZM,2),
*	TWX1SA(NXM&gt;NYK,NZM&gt;2),TWX1SI(NXM,NYM,NZM&gt;2)&gt;
C
*	TOX2SI(NXM,NYM,NZM,2).TOX2SP(NXM,NYM,NZM,2),
*	TWX2SI(NXM,NYM,NZM,2),TWX2SP(NXM,NYM tNZM,2)
DIMENSION T0Y(NXM,NYM+l,NZM,2),TWY(NXM,NYM+l,NZM,2),
*	TOY1SA(NXM,NYM,NZM,2) ,TOY1SI(NXM,NYM,NZM,2),
*	TWY1SA(NXM,NYM,NZM,2) ,TVY1SI(NXM,NYM,NZM,2),
*	T0Y2SI(NXM,NYM,NZM,2),T0Y2SP(NXM,NYM,NZM,2),
*	TWY2SI(NXM,NYM,NZM,2),TWY2SP(NXM,NYM,NZM,2) DIMENSION TOZ(NXM,NYM,NZM+1,2),TWZ(NXM,NYM,NZM+1,2) ,
*	TOZISA(NXM,NYM,NZM,2),TOZ1SI(NXM,NYM,NZM,2),
*	TWZ1SA(NXM,NYM,NZM,2),TWZ1SI(NXM,NYM,NZM,2),
*	T0Z2SI(NXM,NYM,NZM,2),T0Z2SP(NXM,NYM,NZM,2),
*	TWZ2SI(NXM,NYM,NZM,2),TWZ2SP(NXM,NYM,NZM,2)
DIMENSION QO(NYM,NZM),QG(NYM,NZM),QW(NYM,NZM),DQOP(NYM,NZM),
DQOS(NYM,NZM),DqWP(NYM,NZM),DQWS(NYM,NZM)
DIMENSION A(NXM*NYM*NZM*4,NXM*NYM*NZM*4),D(NXM*NYM*NZM*4)
DIMENSION STPO(0:6,NZM),STPW(0:6,NZM)
STPO —&gt; Somatorio de Trans. X Pot. do Oleo
DIMENSION SDEOPI(0:6,NZM),SDEWPI(0:6 ,NZM),SDEOSI(0:6,NZM),
NX-NXC
SDEWSI(0:6,NZM)
SDEOP—&gt; Som. da Derivada da Eq. do Oleo em rel. a Pres.
IF(L.EQ.l) THEN
NL=2*NC-1
C dfw/dpoij ,sgij, swij
A(NL ,NL)=IX2*(P0TWX2+TWX2PI+TWX(1+1,J,K, L)+PWX2PI)-
*
*
*
*
*
*
1X1+(P0TWX1+TWX1PI+TWX(I,J,K, L)+PWX1PI)+
IY2 *(P0TWY2* TWY2PI+TWY(I,JMA,K,L)*PWY2PI)-IY1*(P0TWY1+TWY1PI+TWY(I,J, K, L)+PWY1PI)+
IZ2*(P0TWZ2+TWZ2PI+TWZ(I,J,K+l,L)+PWZ2PI)-
IZ1*(P0TWZ1+TWZ1PI+TWZ(I,J,K,L)+PWZ1PI)-
DACWP-(1-IDR)*DQWP(J,K)+IDC*SDEWPI(LBC,LBR)
C dF»/dSwi,j,k
A(NL,NL+1)=
*	1X2+(PQTWX2+TWX2SI(I, J, K, L) +TWX(1+1, J, K, L )*DPC(I,J,K,L))-
*	IX1*(POTWX1*TWX1SI(I,J,K,L)~IDR*TWX(I,d,K,L)*DPC(I,J,K,L))+
*	IY2*(P0TWY2*TWY2SI(I,J,K,L)+TWY(I,JMA,K,L)*DPC(I,J,K,L) )~
*	IY1*(POTWY1*TWY1SI(I,J,K,L)-TWY(T,J,K,L)*DPC(I,J,K,L))+
*	IZ2*(P0TWZ2+TWZ2SI(I,J,K,L)+TWZ(I,J,K+l,L)*DPC(I,J,K,L))-
*	IZ1*(POTWZ1*TWZ1SI(I,J,K,L)-TWZ(I,J,K,L)*DPC(I,J,K,L))-
*	DACWS~(l-IDR)*DQnS(J,K)+IDC*SDEWSI(LBC,LBR)
C dFo/dPoi,j,k
A(NL+1,NL&gt;IX2*(P0T0X2*T0X2PI+T0X(I+l,J,K,L)+P0X2PI)-
*	IX1*(PDTOX1*TOX1PI+TOX(I,J,K,L)*POX1PI)+
*	IY2*(P0T0Y2*T0Y2PI+TDY(I,JMA,K,L)*P0Y2PI)-
+	IY1*(POTOY1*TOY1PI+TOY(I,J,K,L)*POY1PI)+
*	IZ2*(P0T0Z2*T0Z2PI+T0Z(I,J,K+l,L)+P0Z2PI)~
*	IZ1*(POTOZ1*TOZ1PI+TOZ(I,J,K,L)*POZ1PI)-
C dFo/dSwi,j,k
DACOP-(1-IDR)*DQOP(J,K)+IDC+SDEOPI(LBC,LBR)
*	IY1*(POTOY1*TDY1SI(I,J,K,L))+
*	IZ2*(P0T0Z2*T0Z2SI(I3J,K,L))-
*	IZl*(POTDZl*TOZlSI(I,J,KiL))~
*	DAGOS-(1-IDR)*DQOS(JJK)+IDC*SDEOSI(LBC,LBR)
IF(I.NE.l) THEN
NH=NY*NZ*2
C dFw/dPoi-13j,k A(NL,NL-NH)=-POTWX1*TWX1PA-TWX(I,J,K,L)*PWX1PA
C dFw/dSwi-1,j,k A(NLJNL-NH+1)=-POTWX1*TWX1SA(I,J}K,L)-
*	IDR*(TWX(I,J,K,L)*DPC(I-1,J,K,L))
C dFo/dPoi-1,j,k
A(NL+1,NL-NH)=-POTOX1*TOX1PA-TOX(I,J,K,L)*PDX1PA
C dFo/dSwi-lJ jk
A(NL+1&gt; NL-NH+1)=-P0T0X1*TOX1SA(I, J,K,L)
ENDIF
C
IF(I.NE.NX) THEN
NH~NY*NZ*2
C dFw/dPoi+l,j,k
A(NL,NL+NH)=P0TWX2*TWX2PP+TWX(1+1,J,K,L)+PWX2PP
C dFw/dSwi+1,j,k A(NLiNL+NH+l)=P0TWX2*TWX2SP(I,J,K1L)-
*	TWX(I+1,J,K,L)*DPC(I+1,J,K,L)
C dFo/dPoi+1,j,k
A(NL+1,NL+NH)=POTOX2*TOX2PP+TOX(I+1?J&gt;K,L)*P0X2PP
C dFo/dSwi+1J,k
A(NL+1,NL+NH+1)=POTOX2*TOX2SP(I, J t K»L)
ENDIF
C
IF(J.NE.l) THEN
NH=NZ*2
C dFw/dPoi,j-l,k
A(NL,NL-NH)=-POTWYl*TWYlPA-TWY(I,J,KJL)*PWY1PA
C dFw/dSwi,j-1,k
A(NLINL-NH+1)=-POTWY1*TWY1SA(I,J}KtL)-TWY(I3J,K,L)*
*	DPC(I,JME,K,L)
C dFo/dPoi,j-l,k
A(NL+1jNL-NH)=-P0T0Yl*T0YlPA-T0Y(l,J,K,L)*POY1PA
C dFo/dSwi,j-l,k
A(NL+1,NL~NH+1)=~POTOY1*TOY1SA(I,J,K,L)
ENDIF
c
IF(J.NE.NY) THEN
NH=NZ*2
C dFw/dPoi,j+13k
A(NL,NL+NH)=P0TWY2*TWY2PP+TWY(I,JMA,K,L)+PWY2PP
C dFw/dSwi,j+13k
A(NL,NL+NH+1)=P0TWY2*TWY2SP(I,J,K,L)-
*	TWY(I,JMAfK,L)*DPC(I,JMA,K(L)
C dFo/dPoi3j+13k
A(NL+1,NL+NH)=P0T0Y2*T0Y2PP+T0Y(I,JMA,K,L)*P0Y2PP
C dFo/dSwi,j+1,k
A(NL+1,NL+NH+1)=POTOY2*TOY2SP(I,J,K,L)
ENDIF
C So radial
IF(L,EQ.1.AND.J.EQ.1) THEN
NH~(NY*NZ~NZ)*2
C dFw/dPoi,j-lfk
A(NL,NL+NH)«"POTWY1*TWY1PA-TWY(I,J,K,L)*PWY1PA
C dFw/dSwiJ-hk
A(NL,NL+NH+1)=-POTWY1*TWY1SA(I,J,K,L)-TWY(I,J,K,L)*
*	DPC(I,JME,K,L)
C dFo/dPoiJ-l.k
A(NL+1,NL+NH)=-P0T0Yl*T0YlPA-T0Y(I,J,K,L)+P0Y1PA
C dFo/dS»i,j"l,k
A(NL+1,NL+NH+1)=-POTOY1*TDY1SA(I,J,K,L)
END IF
So radial
IF(L.EQ.l.AND.J.EQ.NY) THEN
NH=(NY*NZ-NZ)*2
dFw/dPoi,j+l,k
A(NL,NL-NH)=P0TWY2*TWY2PP+TWY(I,JMA,K,L)*PWY2PP dFw/dSsi,j+1,k
A (NL,NL-NH+1)=P0TWY2*TWY2SP(I,J,K,L)-
*	TWY(I,JMA,K)L)*DPC(I,JMA,K,L) dFo/dPoi,j+l,k
A(NL+1,NL-NH)=P0T0Y2*T0Y2PP+T0Y(I,JMA,K,L)*P0Y2PP dFo/dSwi,j+1,k
A(NL+1,NL~NH+l)-P0TQY2*T0Y2SP(I,J,K,L)
ENDIF
oo o es o o o o na a a nan aa	an a a an
Células atraz da célula i,j,k
IF(K.NE.l) THEN dFw/dPoi,j,k-l
A(NL)NL-2)=’P0TWZ1*TWZ1PA-TWZ(IiJjKjL)*PWZ1PA
dFw/dSwi*j,¿-1
A(NL,NL-1)sb”P0TWZ1*TWZ1SA(I , J,K,L)~TWZ(I, J ,K,L)*
*	DPC(I,J,K-1,L) dFo/dPoi J(k-1
A(NL+1,NL-2)®-P0T0Zl*T0ZiPA“TQZ(I,J,K,L)*POZ1PA
dFo/dSwi,j,k”l
A(NL+1,NL-1)=C-POTOZ1*TOZ1SA(I, J,K,L)
ENDIF
Células a frente da célula i,j,k
IF(K.NE.NZ) THEN dFw/dPoi,j,k+l
A(NL,NL+2)=P0TWZ2*TWZ2PP+TWZ(I,J,K+1,L)*PWZ2PP
dFw/dSwi,j,¿+1
A(NL.NL+3)=P0TWZ2*TWZ2SP(I,J,K,L)-
*	TWZ(I,J,K+1,L)*DPC(I,J,K+1,L) dFo/dPoi,j,k+l
A(NL+l,NL+2)=PDT0Z2*T0Z2PP+T0Z(I,J,K+l,L)*P0Z2PP dFo/dSwi,j,k+l
A(NL+1,NL+3)=POTOZ2*TOZ2SP(I,J,K,L)
ENDIF
RETURN
_ END
’”pARTÉ~HÉfÉrÉÑte”Ás"ÍÑtERFÁcÉs”dO RADIAL~COm’o CARTESIANO
C
c
SUBROUTINE MONTAIN (I,J,K,L,IND)
IMPLICIT DOUBLE PRECISION(A-H,O-Z) PARAMETER(NXM=08,NYM-05,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP COMMON/NBLC/A,D,NBC,NBR,NBT
COMMON/PETR/KRO,KRW,DKRO,DKRW,PC,DPC COMMON/DTRANS/TOX,TWX,TOY,TWY,TOZ,TWZ,
*	TOX1SA,TOX1SI,TWX1SA,TWX1SI,
*	T0X2SI,T0X2SP,TWX2SI,TWX2SP,
*	TOY1SA,TDY1SI,TWY1SA,TWY1SI,
*	T0Y2SI,T0Y2SP,TWY2SI,TWY2SP,
*	TOZ1SA,TOZ1SI,TWZ1SA,TWZ1SI,
*	T0Z2SI,T0Z2SP,TWZ2SI,TWZ2SP COMMON/VAZAO/qO,QOT,QG,QGT,QW,QWT,DQOP,DqOS,
*	Dqwp,dqws,RWO,EGO,PWF,TEMPO
COMMON/ANULA/IX1,1X2,IY1,IY2,IZ1,IZ2,IDR,IDC,LBC,JMA,JME,IX,JX,LBR COMMON/ACU/ACO, ACW,DACOP,DACDS,DACWP,DACWS
COMMON/POT/POTOX1,P0T0X2,P0T0Y1,P0T0Y2,P0T0Z1,P0T0Z2, POTWX1,P0TWX2,P0TWY1,PQTWY2,POTWZ1,P0TWZ2, P0X1PA,P0X1PI,P0Y1PA,P0Y1PI,POZ1PA,P0Z1PI, P0X2PI,P0X2PP,P0Y2PI,P0Y2PP,P0Z2PI,P0Z2PP, PWX1PA,PWX1PI,PWYiPA,PWY1PI,PWZ1PA,PWZ1PI, PWX2PI,PWX2PP,PWY2PI,PWY2PP,PWZ2PI,PWZ2PP, TOX1PA,TOX1PI,TOY1PA,TOY1PI,TOZ1PA,TOZ1PI, TOX2PI,TOX2PP,TOY2PI,TOY2PP,TOZ2PI,TDZ2PP, TWX1PA,TWX1PI,TWY1PA,TWY1PI,TWZ1PA,TWZ1PI, TWX2PI,TWX2PP,TWY2PI,TWY2PP,TWZ2PI,TWZ2PP
COMMON/SDEOW/STPO,STPW,SDEOPI,SDEOSI,SDEWPI,SDEWSI,
*	DFOPX,DFOSX,DFWPX,DFWSX,DFOPZ,DFOSZ,DFWPZ,DFWSZ DIMENSION DKRO(NXM,NYM,NZM,2),DKRW(NXM,NYM,NZM,2),
*	PC(O:NXM+1,0:NYM+l,0:NZM+l,2),DPC(O:NXM+1,O:NYM+1,0:NZM+l,2) REAL*8
DIMENSION
*
*
*
*
DIMENSION
*
*
*
*
DIMENSION
*
*
*
*
DIMENSION
*
DIMENSION DIMENSION
*
*
*
*
*
*
*
*
*
c
DIMENSION
♦
c
C'
KRO(NXM tNYM,NZM,2),KRW (NXM,NYM,NZM,2) TOX(NXM+1 ,NYM,NZM,2) ^XCNXM+l.NYM^ZM^) , TQX1SA(NXM,NYM,NZM,2),TOX1SI(NXM,NYM,NZM,2), TWX1SA(NXM,NYM,NZM,2),TWX1SI(NXM,NYM,NZM,2), T0X2SI(NXM,NYM,NZM,2),T0X2SP(NXM,NYM,NZM,2), TWX2SI(NXM,NYM,NZM,2),TWX2SP(NXM,NYM,NZM,2) T0Y(NXM,NYM+l,NZM,2),TWY(NXM,NYM+1,NZM,2), TOY1SA(NXM,NYM,NZM,2),TOY1SI(NXM,NYM,NZM,2) TWY1SA(NXM,NYM,NZM,2),TWY1SI(NXM,NYM,NZM,2) T0Y2SI(NXM,NYM,NZM,2),T0Y2SP(NXM,NYM,NZM,2) TWY2SI(NXM,NYM,NZM,2),TWY2SP(NXM,NYM,NZM,2) TOZ(NXM,NYM,NZM+1,2),TWZ(NXM,NYM,NZM+1,2), TOZ1SA(NXM,NYM,NZM,2),TOZ1SI(NXM,NYM,NZM,2) TWZ1SA(NXM,NYM,NZM,2),TWZ1SI(NXM,NYM,NZM,2) TDZ2SI(NXM,NYM,NZM,2)fT0Z2SP(NXM,NYM,NZM,2) TWZ2SI(NXM,NYM,NZM,2),TWZ2SP(NXM,NYM,NZM,2) QO (NYM,NZM) , QG (NYM,NZM) , qW (NYM,NZM) , DqOP (NYM, NZM) , DQOS(NYM,NZM),DqWP(NYM,NZM),DqWS(NYM,NZM) A(NXM*NYM*NZM*4,NXM*NYM*NZM*4) ,D(NXM*NYM*NZM*4) STPD(0:6,NZM) ,STPW(0:6,NZM)
STPO —&gt; Somatorio de Trans. X Pot. do Oleo SDEOPKO: 6 ,NZM) ,SDEWPI(0:6 ,NZM) ,SDEOSI(O:6 ,NZM) , SDEWSI(O:6,NZM)
SDEOP—&gt; Som. da Derivada da Eq. do Oleo em rel. a Pres.
&gt;
f
a
s
C INTERFACES I=NXR
C----------------,------------------------------
IF(IND.EQ.1) THEN
bloca abaixa do poco cartesiano: i=ip j=jp~1 k=kc , radial: i j k
IF(J.GT.NQS+2 *NQL.AND.JP.NE.1) THEN NCC=(IP-1)*NYC*NZC+(JP-2)*NZC+(KP+K-1) NLO2+NCC-1
NCR=NBC+(I-1)*NYR*NZR+(J-l)*NZR+K NLR=2*NCR-1
cartesiano com radial dFw/dPoi,j+l,k
A(NLC3NLR)=DFWPX dFs/dSwijj+l,k
A(NLC3NLR+1)=DFWSX dFo/dPoi,j+l,k
A(NLC+1,NLR)=DFOPX dFo/dSwi,j+l3k
A(NLC+1 ,NLR+1)!SDFDSX
ENDIF
ooao non no	noon o o o oo	o o nn
bloco a esquerda do poco
cartesiano: i=ip-l j-jp k=kc , radial: i j k
IF(J.GT.NQL+NQS.AND.J.LE.NQS+2*NQL.AND.IP.NE.1) THEN
NCC=(IP-2)*NYC*NZC+(JP~D*NZC+(KP+K-1)
NLC=2*NCC-1
NCR=NBC+(1’1)*NYR*NZR+(J-l)*NZR+K
NLR=2*NCR-1
cartesiano com radial dFw/dPoi+l,j,k
AÍNLCjNLRÍ^DFWPX dFw/dSwi+1,j,k
A(NLC,NLR+1)=DFWSX dFo/dPoi+1,j,k
A(NLC+1JNLR)=DFQPX dFo/dSwi+1jj,k
A(NLC+1,NLR+1)=DFOSX
ENDIF
bloco acima do poco
cartesiano: i=ip j=jp+l k~kc , radial: i j k
IF(J.GT.NQL,AND.J.LE.NQL+NQS.AND,JP.NE,NYC) THEN NCC-(IP-1)*NYC*NZC+JP+NZC+(KP+K-1)-NBP NLC=2*NCC-1
NCR=NBC+(I-1)*NYR*NZR+(J-l)*NZR+K NLR=2*NCR-1
C cartesiano com radial
C dFw/dPoi,j-l.k
A(NLC,NLR)=DFWPX
C dFw/dSwijj-ljk
a(nlc,nlr+d»dfwsx
C dFo/dPoi,j-lfk
ACNLC+lfNLR)=DFOPX
C dFo/dSwijj-ljk
A(NLC+1,NLR+1)=DFOSX
ENDIF
ao a a a na	r¡ o naaaa o o a aoo m o o n ao	o a o
bloco a direita do poco
cartesiano: i=ip+l j-jp k=kc , radial: i j k
IF(J.LE.NQL.AND.IP.NE.NXC) THEN
NCC=IP*NYC*NZC+(JP~1)*NZC+(KP+K-1)-NBP
NLC=2*NCC“1
NCR=NBC+(I-1)*NYR*NZR+(J-1)*NZR+K
NLR=2*NCR~Í
cartesiano com radial dFw/dPoi-1,j,k
A(NLC1NLR)=DFWPX
dFw/dSwi-l.j,k
A(NLC,NLR+1)=DFWSX dFo/dPoi-l,j,k
A(NLC+1,NLR)=DFOPX dFo/dSwi-ijj,k
A(NLC+1,NLR+1)=DFOSX
ENDIF
radial com cartesiano para qualquer posicao do cartesiano vizinho
dFw/dPoi+1,j,k
A(NLR,NLC)~P0TWX2*TWX2PP+TWX(1+1,JtK,L)*PWX2PP dFs/dSwi+lJ.k
A(NLR1NLC+l)=P0TWX2*TWX2SP(ItJ,K,L)-
*	TWX(I+1,J,K,L)*DPC(IX,JX,KP,2)
dFo/dPoi+1, j,k
A(NLR+1,NLC)=POTOX2*TOX2PP+TOX(1+1,J,K,L)*P0X2PP dFo/dSwi+lj ,k
A(NLR+1,NLC+1)-P0TDX2*T0X2SP(I,J,K,L) ENDIF
"interfaces" “k=i~e~Ñxr
bloco anterior ao poco
cartesiano: i-ip j=jp k=kp-l , radial: i j 1 IFCIND.EQ.2) TREN
NCC=(IP-l)*NYC*NZC+(JP-1)*NZC+KP-1 NLC=2*NCC-1
DO 10 M=1,NXR
DO 10 N=1,NYR NCR=NBC+(M-1)*NYR*NZR+(N-l)*NZR+K
NLR=2*NCR-1
cartesiano com radial
dFw/dPoi,j ,k+l
A(NLC, NLR)=DFWPZ
dFw/dSwi &gt;j ,k+l
A(NLC,NLR+1)=DFWSZ
dFo/dPoi,j ,k+l
A(NLC+1,NLR)=DF0PZ
dFo/dSwi,j ,k+l
A(NLC+1,NLR+1)=DFOSZ
radial com cartesiano dFw/dPoi,j ,k-l
A(NLR,NLC)=-POTWZ1*TWZ1PA-TWZ(I,J,K,L)*PWZ1PA
C dFw/dSwi,j ,k-l
A(NLRtNLC+l)=“POTWZl*TWZlSA(I,J,K,L)-TWZ(I,J,K ,L) *
*	DPC(IP,JP,KP-1,2)
C dFc/dPoi»j,k-l A(NLR+1,NLC)«-POTOZ1*TOZ1PA-TOZ(I,J,K,L)*POZ1PA
C dFo/dSwi»j,k-l
A(NLR+i,NLG+l)=-POTOZl*TOZlSA(IfJ,KfL)
10 CONTINUE
ENDIF
bloco posterior ao poco cartesiano: i=ip j=jp k=kp+nbp , radial: i j nzr
non	« oQono	o o o rao non no	oooo
IF(IND.EQ.3) THEN ncc=(ip-i)*nyc*nzc+(jp-i)*nzc+kp NLC~2*NCC-1
DO 11 M-1,NXR
DO 11 N=i}NYR
NCR=NBC+(M-1)*NYR*NZR+(N-1)*NZR+K NLR=2*NCR~1
cartesiano com radial dFw/dPoi,j,k"l
A(NLC,NLR)-DFWPZ
dFw/dSwi,j,k-l
A(NLC,NLR+1)=DFWSZ
dFo/dPoi,j,k-l
A(NLC+1,NLR)SSDFOPZ
dFo/dSwi.j,k-l
AiNLC+l.NLR+D^DFOSZ
radial com cartesiano dFw/dPoi,j,k+l
A(NLR,NLC)=P0TWZ2*TWZ2PP+TWZ(IIJJNZR+liL)*PWZ2PP dFw/dSwi,j,k+l
A(NLR,NLC+l)=P0TWZ2*TWZ2SP(I,J,NZR,L)-
*	TWZ(I,J,NZR+1,L)*DPC(IP,JP,KP+NBP,2)
dFo/dPoi3j,k+l
A(NLR+1,NLC)=P0T0Z2*T0Z2PP+T0Z(I,J,NZR+1,L)*P0Z2PP dFo/dSwi tj,k+l
A(NLR+1,NLC+l)=P0T0Z2*T0Z2SP(I,J,NZR,L)
.1 CONTINUE
ENDIF
RETURN
END
SOLUCAO DO SISTEMA USANDO METODO DIRETO COM GAUSS
SUBROUTINE S0LVE1
IMPLICIT DOUBLE PRECISION(A-H,O-Z)
PARAMETER(NXM=08,NYM=055NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLDC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
CDMMON/SEQS/XR,XC
COMMON/NBLC/A,D,NBC,NBR,NBT
DIMENSION XR(NXM*NYM*NZM*2),XC(NXM*NYM*NZM*2)
DIMENSION A(NXM*NYM*NZM*4,NXM*NYM*NZM*4),D(NXM*NYM*NZM*4)
calculo do n. de incognitas (N)
NR~NXR*NYR*NZR*2
aonna q	qqo	ono	non n	nanan ono
NC=NXC*NYC*NZC*2-NBP*2
entra com A,D,NR e NC e sai com XR e XC
CALL GAUSS1(NR,NC)
RETURN
END
SOLUCAO DA MATRIZ USANDO 0 METODO DE ELIMINACAO DE GAUSS
SUBROUTINE GAUSSi (NR,NC)
IMPLICIT DOUBLE PRECISION(A-H,O-Z)
PARAMETER(NXM=08,NYM=05,NZM=04)
COMMON/SEQS/XR,XC
COMMON/NBLC/A,D,NBC,NBR,NBT
DIMENSION XR(NXM*NYM*NZM*2),XC(NXM*NYM*NZM*2),X(NXM*NYM*NZM*4)
DIMENSION A(NXM*NYM*NZM*4,NXM*NYM*NZM*4),D(NXM*NYM*NZM*4)
N=NC+NR
TRIANGULARIZACAO
DO
650 K=1,N-1
DO 640 I®K+i,N FATOR=A(I,K)/A(K,K) D(I)=D(I)-FATQR*D(K) A(IfK)=O.ODO DO 630 J=K+1,N
A(I,J)-A(I,J)“FATDR*A(K,J) CONTINUE
CONTINUE CONTINUE
SUBSTITUIÇÃO REGRESSIVA
X(N)=D(N)/A(N,N)
DO 670 I=N-1,1,~1 S0M=0.0D0
DO 660 J=N,I+1,“1 SOM«SOM+A(X,J)*X(J)
CONTINUE x	K
X(I)=(D(I)-SOM)/A(I,I)
CONTINUE
SEPARACAO DO VETOR SOLUCAO EM DOIS VETORES
10
20
DO 10 1=1,NC XC(I)=X(I)
CONTINUE
D0~20 I=NC+1,NR+NC
IC=IC+1
XR(IC)=X(I)
CONTINUE
RETURN END
PARAMETER(NXM=08,NYM=05,NZM=04,MAX=1500)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXRjNYRjNZR^QL.NQS.NQIjIP, JP,KP
COMMGN/SEQS/XR,XC
COMMON/NBLC/AA,B,NBC,NBR, NBT
DIMENSION XR(NXM*NYM*NZM*2),XC(NXM*NYM*NZM*2)
DIMENSION AA(NXM*NYM*NZM*4,NXM*NYM*NZM*4),B(NXM*NYM*NZM*4)
INTEGER R(NXM*NYM*NZM*4),C(NXM*NYM*NZM*4)
INTEGER ITEMP(8*NXM*NYM*NZM+MAX+2),RTEMP(4*NXM*NYM*NZM+MAX)
DIMENSION A(NXM*NXM*NYM*NYM*NZM*NZM*2)
DIMENSION X(NXM*NYM*NZM*4)
DIMENSION IA(NXM*NYM*NZM*4+1)}JA(NXM*NYM*NZM*4),IC(NXM*NYM*NZM*4)
ona n	ano n oo
calculo do n. de incognitas (N)	
NR=NXR*NYR*NZR*2 NC=NXC*NYC*NZC*2-NBP*2 N=NC+NR	
MONTAGEM DOS VETORES PARA A	NSPIV
INI=O 11=0 IFIRST=O ILAST=O LOC=1 DO 20
DO
15
20
26
1=1,N
15 1=1,N
IF(AA(I,J).NE.O.ODOOO) THEN
11=11+1
A(H)=AA(I,J) JA(II)=J IF(INI.Eq.0) THEN IA(1)=J INI=1
ENDIF
ENDIF
CONTINUE
ILAST=II
LOC=LOC+1
IA(LOC)=IA(LOC-1)+ILAST-IFIRST
IFIRST=II
CONTINUE
DO 26 1=1,N
R(I)=I C(I)=I
IC(I)=I CONTINUE
CALL NSPIVfN,IA,JA,A,B,MAX,R,C,IC,X,ITEMP,RTEMP,IERR)
SEPARACAO DO VETOR SOLUCAO EM DOIS VETORES
DO 30 1=1,NC
XC(I)=X(I)
30
40 C
CONTINUE
IK^O
DO 40 I=NC+1,NR+NC
IK=IK+1
XR(IK)=X(I) CONTINUE
RETURN END
Qoooaa nanoon a can o an a oo ooo no no a o a na non oaaa a ana na na na nana ano anana
Subrotina NSPIV
Usa a eliminacao Gaussiana dispersa com intercâmbio de coluna para resolver um sistema linear do tipo (A* X= B). A fase eliminacao realiza operacoes nas linhas de ,A&gt; e para obter uma matriz triangular superior ’U' e um vetor	A fase solu -
cao resolve (U * X = Y)
Argumentos de entrada :
N - numero de equações e incógnitas
IA - vetor de (N ♦ 1) entradas contendo indicadores de linha para ’A^ veja descricao do armazenamento da matriz abaixo )
JA - vetar com uma entrada por elemento nao-zero em &gt;A&gt; contendo os numeros das colunas de elementos nao-zero de &gt;A&gt;
A	~ vetor real com uma entrada por elemento nao-zero em JA’
contendo os verdadeiros elementos nao-zero ( veja des -cricao do armazenamento de matriz abaixo)
B	- vetor real com N entradas contendo os dados do la -
do direito
MAX - numero inteiro especificando o numero máximo de entra -das de "diagonais extras com elementos nao-zero" de ’U' que devem ser armazenadas
R	- vetor inteiro com N entradas especificando a ordem
das linhas de 'A'
C	- vetor inteiro com N entradas especificando a ordem
das colunas de ,AJ.,C) e também um argumento de saida
IC - vetor inteiro de N entradas que e o inverso de ' CJ (i.e., IC(C(I)) = I ). IC e também um argumento de saida
ITEMP - vetor inteiro de (2 * N + MAX + 2) entradas para uso interno
RTEMP - vetor inteiro de (N + MAX) entradas para uso interno
Argumentos de saida :
c	- vetor inteiro de N entradas especificando a ordem das colunas de ’U’. ,C&gt; e também um argumento de en -
IC	t r ad a vetor inteiro de N entradas que e o inverso de 'CJ (i.e.f IC(C(I)) = I). IC e também um argumento de en-
X IERR	-	vetor real de N entradas contendo o vetor solucao -	numero inteiro que indica a condicao de erro ou o numero de entradas de "diagonais extras" em ’U’ ( para finalizacao bem-sucedida)
Os valores de IERR sao:
0 ,LT. IERR	Finalizacao bem-sucedida. ’U’ tem IERR entradas de "diago -nais extras" nao-zero.
IERR = 0	Erro. N = 0
-N.LE.IERR.LT.O	Erro. Linha numero IABS(IERR) de ’A' e nula.
n non o no nnoaoa	acto	«no	aoannnnonnnnnonnononnncnoaonnnnn
-2*N.LE.IERR.LT.-N
Erro.Linha numero IABS(IERR + N) tem uma entrada duplicada,
-3*N.LE.IERR.LT.-2*N
Erro.Linha numero IABS(IERR + 2*N) tem um pivo zero,
-4*N.LE.IERR.LT.IERR.LT.3*N
Erro.Linha numero IABS(IERR + 3*N) excede a capacidade de armazenamento
Armazenamento da matriz esparsa :
A matriz esparsa ’A' e armazenada usando tres vetores ’IA', ’JA! e *A’. 0 vetor &gt;k&gt; contem os elementos nao-zeros da matriz linha por linha, nao necessariamente em ordem crescente do numero de colunas. Ó vetor ’JA* contem os numeros das colunas correspondentes aos elementos nao-zero armazenados no vetor JAJ(i.e., se o elemento nao-zero armazenado em ,A(K))) esta na coluna JJ’ então, "JA(K) = ?)• 0 vetor ’IA’ contem indicadores para as li -nhas de indices de colunas nao-zero no vetor ’A/JA’ (i.e., ÍA(IA(I))/JA(IA(I))1 e a primeira entrada para a linha JI' no vetor JA/JA'). ’IA(N + 1)’ e considerado tal que JIA(N+1)=IA(I)' = numero de nao-zeros em 'A’.
SUBROUTINE NSPIV(N,IA,JA,A,B,MAX,R,C,IC,X,ITEMP,RTEMP,IERR)
IMPLICIT DOUBLE PRECISION(A-H,O-Z)
DIMENSION A(l), B(l), X(l), RTEMP(l)
INTEGER IA(i), JA(1) , R(l), C(l), IC(1) , ITEMP(l) INTEGER IU, JU, U, Y, P
Coloca indices para dividir o armazenamento temporario por NSPIVI
Y ® 1
U = Y + N
P « 1
Chama a subrotina NSPIVI para realizar os cálculos
CALL NSPIVI(N,IA,JA,A,B,MAX,R,C,IC,X,RTEMP(Y),ITEMP(P),
+	ITEMP(IU),ITEMP(JU),RTEMP(U),IERR)
RETURN
END
Subrotina NSPIVI
NSPIVI usa a eliminacao Gaussiana com troca de colunas para resolver o sistema linear * A* X= B’.A fase eliminacao realiza . operacoes em &gt;AJ e em ’B’ para obter uma unidade de matriz triangular superior JU' e um vetor 'Y* . A fase solucao resolve JU * X = Y’.
C	res atualizados do lado direito
CP	-	Vetor inteiro de ’N+i’ entradas usado por urna lista
C	de conexão. ’P(N+1)’ e o primeiro da lista, e a entra-
C	da seguinte ’P(K)' e em ’P(P(K))'. Entao ’P(N+1)’ e o
C	primeiro item dado, ’P(P(N+1))’ e o segundo, etc. Um
C	indicador de ’N+l’ marca o fim da lista
C IU - vetor inteiro de ’N+l' entradas usado como indicador
C	de linhas para *U’
C JU	vetor inteiro de ’MAX’ entradas usados para as colunas de
C	elementos nao-zero no triangulo estritamente superior de
C	'U'
CU - vetor real de ’MAX’ entradas usados para os elementos nao-C	zero no triangulo estritamente superior de ’U'
C
C
C Armazenamento da matriz esparsa:
C
C	A matriz esparsa ’A’e armazenada usando tres vetore 'IA’, ’JA'
C e 'A'.O vetor ’A’ contem os elementos nao-zero da matriz linha por C linha, nao necessarimente em ordem crescente de numeros de colunas.
C 0 vetor ’JA’ contem os numeros das colunas correspondentes aos ele-C mentos nao-zero armazenados no vetor ’A' (i.e., se o elemento nao-C zero armazenado em ’A(K)’ esta na coluna 'J’, entao 'JA(K) = J'. 0 C vetor ’IA’ contem indicadores para as linhas de indices de coluna C ’nao-zero’ no vetor ’A/JA’ (i.e., ’A(IA(I))/JA(IA(I)) e a primeira C para a linha ’I’ no vetor 'A/JA'). ’IA(N+1)=IA(I)’ - numero de C elementos nao-zero em ’A’, ’IU’,'JU’ e ’U’ sao usado de maneira si-C milar para armazenar o triangulo estritamente superior de ’U’, exce-C to que 'J(U)’ contem na verdade ’C(J)’ ao inves de ’J’.
C C C
SUBROUTINE NSPIVI(N,IA,JA,A,B,MAX,R,C,IC,X,Y,P,IU,JU,U,IERR) IMPLICIT DOUBLE PRECISION(A-H,O-Z)
DIMENSION A(l), B(l), U(l), X(l), Y(l)
REAL*8 DK, LKI, ONE, XPV, XPVMAX, YK, ZERO INTEGERC(l), IA(1), IC(1), IU(1), JA(1), JU(1), P(l), R(l) INTEGER CK, PK, PPK, PV, V, VI, VJ, VK
C
C
IF(N ,EQ. 0) G0 TO 1001
C
ONE = 1.
ZERO = 0.0D0
C
C Inicializa o trabalho de armazenamento e indicadores para 'JU'
C	DO 10 J=1,N
X(J) = 0.0D0
10	CONTINUE
IU(1) = 1 JUPTR = 0
ç
C Realiza fatorizacao numérica e simbólica linha por linha
C ’VK(VI,VJ)' e o vértice do grafico para a linha 'K-th' de 'U'
C C
C Inicia lista de conexão e armazenamento livre para esta linha
C a linha ’R(K)-th' de ’A’ torna-se a linha ’K-th’ de ’U’
C
DO 170 K = 1,N
C
C c
c c
P(N+1) - N + 1
VK = R(K)
Estabelece a linha adjacente para ‘VK’, ordenado na ordem corrente das colunas de . 0 indice do laco diminui para explorar qualquer coluna de ’A* numa ordem relativa correta
20
C
C c
c
30
JMIN = IA(VK)
JMAX ~ IA(VK+1) - 1
IF(JMIN .GT. JMAX) G0 T0 1002
1 « JMAX JAJ = JA(J) VJ - IC(JAJ)
Armazena ’AÍKjJ)’ no vetor de trabalho
X(VJ) = A(J)
Este codigo insere JVJ' na lista adjacente de *VK’
40
PPK = P(PK)
IF(PPK - VJ) 30,1003,40
P(VJ) * PPK
P(PK) = VJ
J = J - 1
IF(J .GE. JMIN) GO T0 20
0 codigo seguinte calcula a 'K-th? linha de ’UJ
C
C
c
so
c
c
0
c
c
VI	= N + 1
YK = B(VK)
VI = P(VI)
IF(VI .GE. K) G0 T0 110
&gt;VI .LT. VKJ — processa o elemento L(K,I) e margeia a adjacência de ’VI’ com a adjcencia ordenada de *VK?
LKI - - X(VI)
X(VI) = ZERO
Ajusta o lado direito para refletir a eliminacao
c
c c
c c c c
YK = YK + LKI * Y(VI)
PPK = VI
JMIN = IU(VI)
JMAX = IUCVI+1) - 1
IFÍJMIN .GT. JMAX) G0 T0 50
DO 100 J=JMIN,JMAX
JUJ = JU(J)
VJ = IC(JUJ)
Se WJ’ ja esta na adjacência de ’VK', pule a inserção
IF(X(VJ) .NE. ZERO) G0 T0 90
Inserte ’VJ* na lista adjacente de ’VK*
"reset" 'PPK1 to ’VI’ se nos tivermos passado o ponto de inserção correto. (Isto acontece quando a adjacência de ’VI1 nao esta na ordem corrente da coluna devido ao pivoteamento)
80
PPK = P(PK)
IF(PPK - VJ) 70,90,80
P(VJ) = PPK
P(PK) ~ VJ
PPK » VJ
Calcula }L(K,J) ® L(K,I)*U(I,J)1 para ’L(K,I)’ nao-zero, compute JU*(K,J) - U*(K,J) - L(K,I) * U(I,J)’ para ’U(K,J)&gt; nao - zero '(U*(K,J) « U(K,J) * D(K,K))’
X(VJ) = X(VJ) + LKI * U(J) CONTINUE T0 50
- troca a
c
C ' c
c c 90 100
C
c :
C ! c
c : c 110
GO
Pivo	------
da diagonal
Encontra a maior
maior entrada da 'K-thí linha de 'U' com a entrada
entrada, contando as diagonais extras nao-zero
120
GO TO 1004
IF(VI ,GT. N)
XPVMAX « DABS(X(VI))
MAXC = VI
NZCNT = 0
PV = VI
V = PV
PV = P(PV)
IF(PV&amp;lt;GT. N) G0 T0 130
NZCNT = NZCNT + 1
XPV « DAES(X(PV))
IF(XPV ,LE. XPVMAX) GO TO 120
XPVMAX = XPV
MAXC = PV
MAXCL « V
GO TO 120
IF(XPVMAX .EQ. ZERO) GO TO 1004
JVI=K’, então existe uma entrada para diagonal que deve ser dele-
130 c c
c ■ c
VI =
140
C
C Calcula
C
150
DK =
C
C
C
c c c
Se	.
tada. Senao delete a entrada que ira ser a entrada da diagonal.
IF(VI .EQ. K) GO TO 140
IF(VI .Eq. MAXC) G0 T0 140 P(MAXCL) = P(MAXC)
G0 T0 150
P(VI)
&gt;D(K) = 1/L(K,K) ’ e faz a troca
ONE / X(MAXC)
X(MAXC) « X(K)
I = C(K)
C(K) = C(MAXC)
C(MAXC) » I
CK « C(K)
IC(CK) = K
IC(I) = MAXC
X(K) = ZERO
Atualiza lado direito
Y(K) = YK * DK
c c c c c
160
IF(IU(K+1) -GT. MAX+1) GO TO 1005
IF(VI .GT. N) G0 T0 170
J = VI
i JUPTR = JUPTR + 1 JU(JUPTR) = C(J) U(JUPTR) = X(J) * DK X(J) = ZERD J = P(J)
IF(J .LE. N) GO TO 160
i CONTINUE
Volta e resolve 'U*X= Y' e reordena ’X’ ao correspondente com ,k&gt;
170
C
C ' c
K = N
DQ "
180
190
200
0
c :
c
200 I = 1,N YK = Y(K) JMIN = IU(K)
IMAX = IU(K+1) ~ 1
IF(JMIN -GT, JMAX) GO TO 190 DO 180 J “ JMIN,IMAX
JUJ = JU(J)
JUJ - IC(JUJ)
YK = YK - U(J) * Y(JUJ) CONTINUE Y(K) = YK CK = C(K) X(CK) « YK
K “ K "" 1
CONTINUE
Retorne com ’IERR' = numero de diagonais extras de nao-zeros em 'U'
IERR = IU(N+1) - IU(I) RETURN
Retorno dos erros
C
C
C
C
C
1001	IERR = RETURN
C
C Linha &gt;KJ
C
1002	IERR = RETURN
C
C Linha ’ K’
C
1003	IERR = RETURN
C
C Pivo zero
C
1004	IERR ~ RETURN
de )A) e nula
-K
de ’A’ tem entrada duplicada
~(N+K)
na linha ’K’
-(2
* N + K)
C
C Armazenamento C
1005 IERR = -(3 RETURN END
de *UJ excedido na linha 'KJ
* N + K)
N = O
0
nao	ano	ana o an aaaannnQnn	o	aa nao
SOLUCAO DO SISTEMA USANDO METODO ITERATIVO BSOR COM GAUSS
SUBROUTINE SOLVES
IMPLICIT DOUBLE PRECISION(A-H,0-Z)
PARAMETER(NXM=08,NYM-05,NZM=O4)
COMMON/NCEL/DBDX,DBDY ,DBDZ,WRC,NBLOC,NXC,NYC,NZC ,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/SIM/DT, DTMAX , DTMIN, TOLP, TOLS, DSLIM, DPLIM, TSIM,
*	QOMAX,QDMIN,PWMIN,BSOR,JPROD,MSOLU,UMAX,ITMIN
COMMON/SEQS/XR,XC
COMMON/NBLC/A,D tNBC,NBR,NBT
DIMENSION XR(NXM*NYM*NZM*2),XC(NXM*NYM*NZM*2)
DIMENSION A(NXM*NYM*NZM*4,NXM*NYM*NZM*4),D(NXM*NYM*NZM*4)
DIMENSION ACG(NXM*NYM*NZM*2,NXM*NYM*NZM*2)
DIMENSION ARG(NXM*NYM*NZM*2,NXM*NYM*NZM*2)
DIMENSION DRA(NXM*NYM*NZM*2),DCA(NXM*NYM*NZM*2)
DIMENSION DR(NXM*NYM*NZM*2),DC(NXM*NYM*NZM*2)
DIMENSION XRA(NXM*NYM*NZM*2),XCA(NXM*NYM*NZM*2)
LOGICAL CONV
jacobiana total (A) e o vetor (D) termo indep.
da da
transforma transforma
faz: parte parte
matriz A ref. matriz A ref.
entra com a matriz para o GAUSS, a a
transforma	a	parte	do	vetor	D	ref.	ao
transforma	a	parte	do	vetor	D	ref.	ao
transforma	a	parte	do	vetor	X	réf.	ao
transforma	a	parte	do	vetor	X	ref.	ao
ao radial, na matriz ARG ao cartesiano, na matriz ACG
&gt;	radial, no vetor DRA
&gt;	cartesiano, no vetor DCA í radial, no vetor XRA
&gt;	cartesiano, no vetor XCA a solucao e representada pelos vetores XR e XC
calculo do n. de incognitas (N) e largura da banda (M)
NR=NXR*NYR*NZR*2
NC=NXC*NYC*NZC*2-NBP*2
transíormacao do vetor X em dois vetores
1
2
DO 1 1=1,NR
XRA(I)=O.ODO CONTINUE DO 2 1=1,NC
XCA(I)=O.ODO
CONTINUE
transíormacao do vetor D em dois vetores
DO 5 I=1,NBC*2 DCA(I)=D(I)
5	CONTINUE
IC=Q
DO 6 I=(NBC*2+1),NBT*2 IC=IC+1 DRA(IC)=D(I)
6	CONTINUE
ACG(I,J)=A(I,J)
CONTINUE
ra oo anoa	«nan noao
LX=O
DO 20 I=NC+1,NC+NR LX=LX+1 LY=O
DO 20 J=NC+1,NC+NR LY=LY+1 ARG(LX,LY)=A(I,J) 20 CONTINUE
__PONTO DE RETORNO DO PROCESSO ITERATIVO iter=0
1000 CONTINUE
iter=íter+l
montagem do termo independente
2
IF(L.EQ.l) THEN
LIX=NC+1
END IF
IC=0
DO 40 I~LIX,LSX
AUX=O.0D0
ID=0
D0 50 J=LIY,LSY
ID=ID+1
IF(L.EQ.1) AUX=AUX+A(I,J)*XCA(ID) IF0..EQ.2) AUX=AUX+A(I, J)*XR(ID) CONTINUE
IC=IC+1
IF(L.EQ.l) DR(IC)=DRA(IC)-AUX IFÍL.EQ.2) DC(IC)=DCA(IC)-AUX CONTINUE
TFíT F(3 THEN
CALLGAUSS2 (NR,ARG,DR,XR) DO 70 K~1,NR
XR(K)=BSOR*XR(K)+(1.0D0-BS0R)*XRA(K) write(*,*) ’ i=’ ,k, ’ xr^Sxrík) write(*,*)’i=’,k,&gt; xra~xr=i,xra(k)~xr(k)
80
60
CALL GAUSS2 (NC,ACG,DCfXC)
DO 80 K=1,NC
XC(K)=BSOR*XC(K)+(1.ODO-BSOR)*XCA(K) write(*,*) Ji=' ,k, ’ xc^xcík) write(*,*),i=’,k,’ xca-xc=*,xca(k)-xc(k)
CONTINUE ENDIF CONTINUE
teste do convergencia
C0NV=.TRUE.
OOü	O	ÜUUUQ	O OÜU	ÜUO	U CJUÜÜ
110
120
DO ÍIQ 1*1,NR
IF(DABS(XR(I)-XRA(I)).GT.1.0D-9) conv=.false. CONTINUE
DO 120 1*1,NC
IF(DABS(XC(I)-XCA(I)).GT.1.OD-9) CONV=.FALSE. CONTINUE
atualizacao dos resultadas
DO 90 1*1,NR XRA(I)*XR(I) 90 CONTINUE
DO 100 1*1,NC XCA(I)=XC(I) 100 CONTINUE
IF(.NOT.CONV) GO TO 1000
write(*,*)'bsor-;,bsor,’ convergiu iter*’, iter RETURN
END
SOLUCAO DA MATRIZ USANDO 0 METODO DE ELIMINACAO DE GAUSS
SUBROUTINE GAUSS2 (N,A,D,X)
IMPLICIT DOUBLE PRECISION(A-H,O~Z)
PARAMETER(NXM=08,NYM=05,NZM=04)
DIMENSION A(NXM*NYM*NZM*2,NXM*NYM*NZM*2),D(NXM*NYM*NZM*2),
*	X(NXM*NYM*NZM*2)
TRIANGULARIZACAO
DO 650 K*1,N-1
DO 640 I=K+1,N
FATOR=A(I,K)/A(K,K)
D(I)*D(I)-FATOR*D(K)
A(I,K)=0.0D0 DO 630 J=K+1,N
A(I,J)*A(I,J)-FATOR*A(K,
630	CONTINUE
640	CONTINUE
650 CONTINUE
SUBSTITUIÇÃO REGRESSIVA
X(N)*D(N)/A(N,N)
DO 670 I=N-1,1,-1
SOM=O.ODO
DO 660 J=N,I+1,~1 SOM=SOM+A(I,J)*X(J) 660	CONTINUE
X(I)*(D(I)-SOM)/A(I,I)
670 CONTINUE
RETURN END
J)
SUBROT. DE CALCULO DE PRODUCOES DE OLEO E GAS POR BALANÇO DE MATERIAIS
SUBROUTINE BALM
*	BNPC,BWPC,PWFA
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/MALHA/ZB,RB,VPOR,DRO,WX,WY,WZ,FFX,FFY,FFZ,DTETA
COMMON/PVT/BO,DBO,VO,DVO,DO ,DDO,RSO,DRSO,BW ,DBW,VW,DVW,DW,DDW, CW COMMON/TS/PO,SO,SG,SW
COMMON/TF/TFLUXO,TFLUXW,SUMTO,SUMTW,AFXO,AFXW
DIMENSION ZB(0:NXM+1,NYM,2),RB(NXM+1),VPOR(NXM,NYM,NZM,2),
*	FFX(NXM+1,NYM,NZM,2),FFY(NXM+1,NYM,NZMt2),
*	FFZ(NXM+1,NYM ,NZM+1,2),DTETA(NYM+1)
DIMENSION BO(NXM,NYM,NZM,2),DBO(O:NXM+1,0:NYM+1,0:NZM+1,2) ,
*	V0(NXM,NYM,NZM,2),DVO(O:NXM+1,O:NYM+1,0:NZM+1,2),
*	DO(NXM,NYM,NZM,2),DDO(0:NXM+1,0:NYM+1,0:N2M+1,2),
*	BW(NXM,NYM,NZM,2),DBW(O:NXM+1,0:NYM+i,0:NZM+1,2) ,
*	VW(NXM,NYM,NZM,2),DVW(O:NXM+1,O:NYK+1,0:NZM+1,2),
*	DW(NXM,NYM,NZM,2),DDW(O:NXM+1,Q:NYM+1,0:NZM+1,2),
*	CW(NXM,NYM,NZM,2)
DIMENSION PO(0:NXM+1,0:NYM+1,0:NZM+1,2),SO(NXM,NYM,NZM,2),
*	SG(NXM,NYM,NZM,2),SW(NXM,NYM,NZM,2)
4
5
10 C
DO 10 L=l,2
IF(L.EQ.l) THEN
BNPR=O,ODO
BWPR=O.ODO
DO 4 J=1,NYR
DO 4 1=1,NXR
DO 4 K=1,NZR
BNPR=BNPR+VPOR(I,J,K,L)*SO(I,J,K,L)*BO(I,J,K,L)
BWPR=BWPR+VPOR(I,J,K,L)*SW(I,J,K,L)*BW(I,J,K,L) CONTINUE
BNPOO. ODO
BWPOO.ODO
DO 5 J=1,NYC
DO 5 1=1,NXC
DO 5 K=1,NZC
IF(I.EQ.IP.AND,J.Eq.JP,AND.K.GE.KP.AND.K.LT.KP+NBP) GO TO 5
BNPC=BNPC+VPOR(I,J,K,L)*SO(I,J,K,L)*BO(I,J,K,L)
BWPC=BWPC+VPOR(I,J,K,L)*SW(I,J,K,L)*BW(I,J,K,L) CONTINUE
END IF
CONTINUE
OGOD
RETURN END
SUBBOTINA DE IMPRESSÃO DE RESULTADOS PARA RELATORIO
SUBROUTINE IMPRER(DT,NTS)
IMPLICIT DOUBLE PRECISION(A-H.O-Z)
PARAMETER(NXM=08,NYM=05,NZM=04)
COMMON/NCEL/DBDX,DBDY,DBDZ,WRC,NBLOC,NXC,NYC,NZC,NBP,
*	NXR,NYR,NZR,NQL,NQS,NQI,IP,JP,KP
COMMON/IMP/TIMPR,TIMPG,IRIMP
COMMON/ACUM/QOAC,QGAC,QWAC,VOORR,VWORR,VOORC,VWORC,BNPR,BWPR,
*	BNPC,BWPC,PWFA
COMMON/MALHA/ZB,RB,VPOR,DRO,WX,WY,WZ,FFX,FFY,FFZ,DTETA COMMON/TS/PO,SO,SG,SW
COMMON/VAZAO/QO,QOT,qG,QGT,qW,QWT,DqOP,DQOS,
C
C
110
C
120
*	DQWP,DQWS,RW0,RG0,PWF.TEMPO
DIMENSION P0(0:NXM+l,0:NYM+l,0:NZM+l,2),S0(NXM,NYM,NZM,2) ,
*	SG(NXM,NYM,NZM,2),SW(NXM,NYM,NZM,2)
DIMENSION ZB(O:NXM+1,NYM,2),RB(NXM+1),VP0R(NXM,NYM,NZM,2),
*	FFX(NXM+1,NYM,NZM,2),FFY(NXM+1,NYM,NZM,2),
*	FFZ(NXM+1,NYM,NZM+1,2),DIETA(NYM+1)
DIMENSION QO(NYM,NZM),ÇG(NYM,NZM),qw(NYM,NZM),DQOP(NYM,NZM),
*	DQOS(NYM,NZM),DQWP(NYM,NZM),DQWS(NYM,NZM) CHARACTER*8 TIT
€1=86400.ODO
C2«1.0D+6
C3=C2/1000.0DO
REC=QOAC/(VOORR+VOORC)*100.0
PID=QOT*C1/((PO(NXC,JP,KP,2)-PWF)/98067.ODO)
WRITE(4,110)NTS
FORMAT(’ ’,19,43(’-’),/,T2O,’RESUMO DO TIME STEP’,I3,/,T9,43(’-’))
IF(QOAC.NE.0.ODO) BALO=(QOAC+(BNPR+BNPC))/(VOORR+VOORC)
IF(QWAC.NE.0.ODO) BALW=(QWAC+(BWPR+BWPC))/(VWORR+VWORC) BALG=1.0D0
WRITE(4,12O)TEMPO/C1,DT/C1,C1*QOT,
*Cl*qGT,Cl*QWT,RGO,RW0,PWFA/C2,
*Q0AC,QGAC,qWAC,BALO,BALG,BALW,REC,FID
FORMAT(T10,’Tempo	(dia) ’,T31,’!	’.F10.5,'
1 ’ / iff
*110,’Dt	(dia)	’,T31,’i	’.F10.5,’	!	
*T10,’Qo	(m3/dia)’,T31,’!	’.D10.4,’	!	
*T10,’Qg	(m3/dia)’,T31,’!	’.D10.4,’	!	
*T10,’Qw	(m3/dia)’,T31,’!	’,D10.4,’	!	\/&gt;
*T1O,'RGO	(m3/m3) ’,131,’!	’.F10.4,’	!	
*T10,’RW0	(m3/m3) ’,T31,’!	’,F10.4,’	!	’ J,
*T10,’Pwf	(MPa)	’,T31,’!	’,F10.4,’	!	* J&gt;
*T10,’Np	(m3)	’,T31,’!	’,D10.4,’	!	1 7,
*110,’Gp	(m3)	’,T31,’!	’.D10.4,’	!	7/,
*T10,’Wp	(m3)	’,131,’!	’,D10.4,’	!	‘J,
*T9,43(’-’),/	,T9,’Balanco de Materais’,/,T9,43('-		
*T10,’01eo	(’/,)	’,131,’!	’,010.4,’	!	
*T10,’Gas	(X)	’,T31,’»	’,010.4,’	!	J7.
*T10,’Agua	C‘Z)	’,T31,’!	’,D10.4,’	!	’7,
*T9,43(’-’),/	1		
*T10,’Recup.	(7.)	’,T31,’!	’,F10,4,/,	
*T10,’IP	(m3/d/kg/cm2)’,T31,	’!	’.F10.4,/,	
*T9,43(’-’))			
o nn
Mapa de pressao e saturacao do grid cartesiano
WRITE(4,400)
400 F0RMAT(T22,’Mapa de Pressao e Saturacao (Presao, So e Sw)’) WRITE(4,100)
100 F0RMAT(/,5X,’GRID CARTESIANO’)
DO 410 K=1,NZC
WRITE(4,420)K
420 FORMAT(1X,’Camada ’,I2,/,70(’-’))
WRITE(4,450)
450 F0RMAT(T4,’!	01	!	02	!	03	!	04	!1 ,
*’	05	!	06	!’ ,/,70(’-’))
DO 410 J=NYC,1,-1
WRITE(4,460) (P0(I,J,K,2)/C2,1=1 ,NXC)
460 F0RMAT(T4,’! \6(F8.4/ ! ’))
WRITE(4,470)J,(S0(I,J,K,2),1=1,NXC)
470 F0RMAT(I2,* ’ ’,6(F8.5,' ! '))
WRITEÍ4,480)&lt;SW(I,J,K,2),1=1,NXC)
480 F0RMAT(T4,’! '^(FS.B,1 ! '))
WRITE(4,490)
490	F0RMAT(70(’-'))
410 CONTINUE
ci no	.	Qoç	_	o na
Mapa de pressão e saturacao do grid radial
LIX=1
IF(NXR.LE.6) THEN
LIM»1 LSX=NXR
ENDIF
IF(NXR.GT.6.AND.NXR.LE.12) THEN
LIM=2
LSX=6
ENDIF
WRITE(4,500)
FORMAT(/,5X,'GRID RADIAL1)
DO 421 K=1,NZR WRITE(4,420)K
DO 510 M=1,LIM
IF(M.EQ.l)WRITE(4,450) IF(M.EQ.2)WRITE(4,451)
FORMAT(T4,J!	07
*' 11 ! 12
DO 610 J=1,NYR
WRITE(4,460)(P0(I,J,K,1)/C2,I=LIX,LSX) WRITE(4,470)J,(SO(I,J,K,1),I=LIX,LSX) WRITE(4,480)(SW(I,J,K,1),I=LIX,LSX) WRITE(4,490)
CONTINUE
IF(LIM.EQ.2) THEN
LIX=7 LSX=NXR
ENDIF
CONTINUE
CONTINUE
io
!	08 I 09
!',/,7o('~'))
DISTRIBUIÇÃO DAS VAZOES
60
55
35
61
DO 61 K=1,NZR
WRITE(4,420)K
WRITE(4,45)
FORMAT(/,6X,'BLOCO ',2X,'PRESSÃO 1,3X/ Qoj,k’,3X, *’ Qwj,k',10X,'RWO',
*/,3X,'1=1 J	(MPa)	(m3/D)	(m3/D)',8X,'(m3/m3)9
DO 55 J=1,NYR
AUX=O.ODO	. t ,
IF(QO(J,K).NE.O.ODO)AUX=qW(J,K)/QO(J,K)
WRITE(4,60)J,P0(l,J,K,1)/C2,Q0(J,K)*C1,QW(J,K)*C1,AUX
FORMAT(7X,I2,1X,4(F1O.5,2X))
CONTINUE
WRITE(4,35)
FORMAT(IX)
CONTINUE
WRITE(9,88O)TEMPD/C1
880	FQRMAT(’tempo=',F10.2,’ parâmetros abaixo:dvp,sw*)
JJ=2*NQL+NQS+NQI/2+l
DO 870 1=1,NXR
DELSW=SW(I,JJ,1,l)-0.12D0 WRITE(9,890)-RB(I),SW(I,JJ,1,l)*100.0
890 F0RMAT(2(F10.2,2X))
870 CONTINUE
C
RETURN
END
SUBROTINA DE IMPRESSÃO DE RESULTADOS PARA GRÁFICOS
" SUBROUTINE"IMPRÊg"
IMPLICIT DOUBLE PRECISIDN(A-H,O-Z)
PARAMETER(NXM=08,NYM=O5,NZM=04)
COMMON/ACUM/QOAC, QGAC, QWAC, VOORR, VWORR,VOORC, VWORC, BNPR, BWPR,
*	BNPC,BWPC,PWFA
COMMON/VAZAO/QD,QOT,QG,QGT,QW,QWT,DQOP,DQOS,
*	DQWP,DQWS,RWO,RGO,PWF,TEMPD
DIMENSION QO(NYM,NZM),QG(NYM,NZM),QW(NYM,NZM),DQOP(NYM,NZM),
*	DQOS(NYM,NZM),DQWP(NYM,NZM),DQWS(NYM,NZM)
Ci=86400.ODO
C2=1.0D+6
WRITE(5,1D)TEMP0/C1,Cl*QOT,Cl*QWT,QGT*C1, PWF/C2
WRITE(7,20)TEMPO/C1,QOAC,QWAC&gt;QGAC WRITEÍ8,30)TEMP0/Cl,QWT/QOT,QGT/QOT
10	F0RMAT(E10.4,3X,E10.4,3X,E10.4,3X,E10.4,3X,E10.4)
20	F0RMAT(E10.4,3X,E10.4,3X,E10.4,3X,E10.4)
30	F0RMAT(E10.4,3X,E10.4,3X,E10.4)
RETURN
END
WUÜU U	O	O UÜW
SUBROTINA DE IMPRESSÃO DOS DADOS DO TESTE DE FORMACAO
SUBROUTINE IMPRET(DT,OPT,L)
IMPLICIT DOUBLE PRECISION(A-H,0-2)
PARAMETER(NXM=08,NYM=05,NZM=04)
COMMON/NCEL/DBDX, DBDY, DBDZ, WRC ,NBLOC ,NXC, NYC, NZC, NBP,
*	NXR^YR^ZR.NQL^QS^QI.IP.JP^P
COMMQN/TS/PO,SO,SG, SW
COMMON/MALHA/ZB,RB,VPOR,D RO,WX,WY,WZ,FFX,FFY,FFZ,DTETA COMMON/VAZAO/QO,QOT,QG,QGT,qW,qWT,DQOP,DQOS,
*	DQWP,DQWS,RWO,RGO,PWF,TEMPO
COMMON/ACUM/QOAC, QGAC, QWAC, VOORR, VWORR, VOORC, VWORC, BNPR, BWPR,
*	BNPC,BWPC,PWFA
COMMON/IMP/TIMPR,TIMPG,IRIMP
DIMENSION PD(0:NXM+1,0:NYM+1,0:NZM+1,2),SO(NXM,NYM,NZM,2) ,
*	SG(NXM,NYM,NZM,2),SW(NXM,NYM,NZM,2)
DIMENSION ZB(O:NXM+1,NYM,2) ,RB(NXM+1) ,VP0R(NXM,NYM,NZM,2) ,
*	FFX(NXM+1,NYM,NZM,2),FFY(NXM+1,NYM,NZM,2),
*	FFZ(NXM+1,NYM,NZM+1,2),DTETA(NYM+1)
DIMENSION QO(NYM,NZM) ,QG(NYM,NZM) ,QW(NYM,NZM) ,DQOP(NYM,NZM) ,
*	DQOS(NYM,NZM),DQWP(NYM,NZM),DqWS(NYM,NZM)
C
5
CHARACTER*! 0PT,SIT*5
C1=3600.0DO
C2»1.0D+6
C3=24.0D0*Cl
IF(OPT.EQ.’F’) THEN
SIT®’FLUXO’
ELSE
SIT®’ESTAT’
ENDIF
WRITE(11,5)SIT,NXC,NYC,NEC,TEMPO/C1,DT/C1,C3*QOT,C3*QWT,RWO,PWF/C2
F0RMAT(’ ’,/,15X,’RESULTADOS DO SIMULADOR ACTI0W4',//,
*5X,’FASE DE TESTE DE FORMACAO	’ '
X
Y
Z
- FINAL ’.A5,//,
í
1
J
J
J
J
&gt;
&gt;
15
20
*5X,’N# DE BLOCOS NA DIRECAO
*5X,’N# DE BLOCOS NA DIRECAO
*5X,’N# DE BLOCOS NA DIRECAO
*5X,'TEMPO ACUMULADO (horas)
*5X,’INCREMENTO DE TEMPO (horas)......
+5X/VAZA0 DE OLEO (m3/dia)............
*5X,’VAZA0 DE GAS (m3/dia)............
*5X,’RAZA0 GAS OLEO (m3/dia / m3/dia).
*5X,’PRESSA0 Pwf NO POCO (MPa)........
DO 10 K=1,NZR
WRITE(11,15)K
FORMATÍ/,5X,’CAMADA:’,13)
WRITE(ll,20)
FORMAT(/,5X/GRID RADIAL',/,5X,’ BLOCO ’,5X,’PRESSAO(MPA)’, 3X,’SAT OLEO’,4X,'SAT GAS’,5X,'SAT AGUA’)
DO 10 I«1,NXR
DO 10 J=1,NYR WRITE(11,25)I,J,PO(I,J,K,1)/C2,SO(I,J,K,1),
SG(I,J,K,1),SW(I,J,K,1)
FORMAT(5X,2(I2,1X),5(F10.4,2X))
CONTINUE
DO 30 K=1,NZC
WRITE(11,35)K
FORMAT(/,5X,‘CAMADA:',13)
WRITE(ll,40)
FORMAT(/,5X,'GRID CARTESIANO’,/,5X,’ BLOCO ’,5X,’PRESSÃO(MPA)’, 3X/SAT OLEO’,4X,'SAT GAS’,5X,'SAT AGUA’)
DO 30 1=1,NXC
DO 30 J=1,NYC WRITE(ll,55)I,J,P0(I,J,K,2)/C2,S0(I,J,K,2),
■■	SG(I,J,K,2) ,SW(I,J,K,2)
FORMAT(5X,2(I2,1X),5(F10.4,2X))
CONTINUE
RETURN
END
,13,/,
,13,/,
,13,/, jElO.4,/, ,F10.4,/, ,F10.4,/,
E10.4,/,
E10.4,/,
FIO.4)
*
*
25
10 C
35
40
55
30

*
*
SUBBOTINA DE INTERPOLAÇÃO POR PESQUISA BINARIA E CALC. DA 1# DERIVADA
SUBROUTINE INTER(X,Y,N,XO,YO,YDP)
REAL*8 X(N),Y(N),X0,Y0,YOP
INTEGER IN,MAX,MEIO
IF((XO.LT.X(l)).OR.(XO.GT.X(N))) THEN
PRINT*,'NAO FOI POSSÍVEL INTERPOLAR XO=’,XO DO 5 J-1,N
PRINT*,!,1	Y=’,Y(J)
5	CONTINUE
XO
15
o oooo
STOP
END IF
IN»1
MAX=N
MEI0=(MAX+IN)/2
IF((XO,GE.X(MEIO)).AND.(XO.LE,X(MEI0+l))) THEN
YOP=(Y(MEI0+1)~Y(MEIO))/(X(MEI0+l)~X(MEIO)) Y0=Y(MEI0)+(XQ-X(MEIO))*YOP
GOTO 15
ELSE
IF(X0.GT.X(MEI0)) IN=MEI0
IF(XO.LT.XfMEIO)) MAX=MEI0
GOTO 10
ENDIF
RETURN
END
C
5
10
SUBROTINA DE INTERPOLAÇÃO POR PESQUISA BINARIA E CALC. DA 1# DERIVADA SOMENTE PARA A PRESSÃO CAPILAR, dado pcow calcular sw
SUBROUTINE INTERPC(X,Y,N,X0,YO,YOP) REAL*8 X(N),Y(N),X0,YO,YOP
INTEGER IN,MAX,MEIO
IF((XO.GT.X(l)).OR.(XO.LT.X(N))) THEN PRINT*,’NAO FOI POSSÍVEL INTERPOLAR XO=’,XO DO 5 J-1,N
PRINT*,!,’ X=,,X(J),’	Y=’,Y(!)
CONTINUE
STOP
ENDIF
IN=N
MAX=1
MEI0=(MAX+IN)/2
IF((XO.GE.X(MEIO)).AND.(XO.LE.X(MEIO-1))) THEN YOP=(Y(MEIO-1)-Y(MEIO))/(X(MEI0-l)~X (MEIO)) YO=Y(MEIO)+(XO-X(MEIO))*YOP GOTO 15
ELSE
IF(XO.GT.XÍMEIO)) IN=MEIO IF(XO.LT.X(MEID)) MAX=MEI0 GOTO 10
ENDIF
RETURN
END</field>
	</doc>
</add>