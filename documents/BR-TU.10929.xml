<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.10929</field>
		<field name="filename">16132_344654.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">
PAULO RENATO DA COSTA MENDES

PREDICTIVE CONTROL FOR ENERGY
MANAGEMENT OF RENEWABLE
ENERGY BASED MICROGRIDS

FLORIANO?POLIS
2016





UNIVERSIDADE FEDERAL DE SANTA
CATARINA

PROGRAMA DE PO?S-GRADUAC?A?O EM
ENGENHARIA DE AUTOMAC?A?O E SISTEMAS

PREDICTIVE CONTROL FOR ENERGY
MANAGEMENT OF RENEWABLE ENERGY

BASED MICROGRIDS

Tese de doutorado submetida ao Programa de
Po?s-Graduac?a?o em Engenharia de Automac?a?o e Sistemas
para a obtenc?a?o do Grau de Doutor em Engenharia de

Automac?a?o e Sistemas.

PAULO RENATO DA COSTA MENDES

Floriano?polis, Agosto de 2016.



Ficha de identificação da obra elaborada pelo autor,
através do Programa de Geração Automática da Biblioteca Universitária da UFSC.

Mendes, Paulo Renato da Costa
PREDICTIVE CONTROL FOR ENERGY MANAGEMENT OF RENEWABLE

ENERGY BASED MICROGRIDS / Paulo Renato da Costa Mendes ;
orientador, Julio Elias Normey-Rico ; coorientador, Carlos
Bordons. - Florianópolis, SC, 2016.

153 p.

Tese (doutorado) - Universidade Federal de Santa
Catarina, Centro Tecnológico. Programa de Pós-Graduação em
Engenharia de Automação e Sistemas.

Inclui referências 

1. Engenharia de Automação e Sistemas. 2. Energy
Management. 3. Control of Hybrid Systems. 4. Distributed
Predictive Control. I. Normey-Rico, Julio Elias. II.
Bordons, Carlos. III. Universidade Federal de Santa
Catarina. Programa de Pós-Graduação em Engenharia de
Automação e Sistemas. IV. Título.



PREDICTIVE CONTROL FOR ENERGY
MANAGEMENT OF RENEWABLE ENERGY

BASED MICROGRIDS

Paulo Renato da Costa Mendes

‘Esta tese de doutorado foi julgada aprovada para a obtenc?a?o do
t??tulo de Doutor em Engenharia de Automac?a?o e Sistemas,

A?rea de Concentrac?a?o em Controle, Automac?a?o e Sistemas, e
aprovada em sua forma final pelo Programa de Po?s-Graduac?a?o
em Engenharia de Automac?a?o e Sistemas da Universidade

Federal de Santa Catarina.’

Julio Elias Normey-Rico, Dr.
Orientador

Carlos Bordons Alba, Dr.
Coorientador

Daniel Ferreira Coutinho , Dr.
Coordenador do Programa de Po?s-Graduac?a?o em Engenharia de

Automac?a?o e Sistemas

Banca Examinadora:

Julio Elias Normey-Rico, Dr.
Presidente

Ricardo Hiroshi Caldeira Takahashi , Dr.

Aguinaldo Silveira e Silva, Dr.

Jorge Ota?vio Trierweiler, Dr.

Eduardo Camponogara, Dr.

Rodolfo Cesar Costa Flesch, Dr.

iii





ACKNOWLEDGMENTS

I would like to thanks

My family that always encouraged me and support me at all times.

My advisor Julio Normey-Rico and my co-advisor Carlos Bordons for
guidance, support, friendship and always have time to exchange ideas.

Professor Jose? Maestre and Dr. Luis Valverde for the support and
contributions to this work.

My friends and colleagues that participated in this journey, especially
Vilmarque Joa?o Junior, Marcelo Morato, Jose? Dietrich, Iaponan Cardins,
Cassio Monteiro, Christian Mendonc?a and my girlfriend Daniela Paiva.

v





Resumo da tese de doutorado submetida a? Universidade
Federal de Santa Catarina como parte dos requisitos para a
obtenc?a?o do grau de Doutor em Engenharia de Automac?a?o

e Sistemas.

Controle Preditivo para Gerenciamento de Energia
de Micro-redes Baseadas em Energia Renova?vel

Paulo Renato da Costa Mendes

Agosto/2016

vii



Orientador: Julio Elias Normey-Rico, Dr.
Coorientador: Carlos Bordons Alba, Dr.
A?rea de Concentrac?a?o: Controle, Automac?a?o e Informa?tica
Industrial
Palavras-chave: Gerenciamento de Energia, Microrredes, Con-
trole de Sistemas H??bridos, Controle Preditivo Distribu??do.
Nu?mero de Pa?ginas: xxv + 128

O objetivo deste trabalho e? abordar a gesta?o de energia
dos sistemas de gerac?a?o e armazenamento de energia. Estes
sistemas sa?o atualmente uma realidade em pa??ses onde e? de-
sejada uma diversificac?a?o das fontes de energia e uma maior
penetrac?a?o das fontes renova?veis. Em particular, o Brasil
possui uma matriz energe?tica diversificada com base em re-
cursos h??dricos, biomassa (etanol), ga?s natural e petro?leo.
Mas, expectativa para o futuro pro?ximo e? um aumento da
utilizac?a?o de fontes de energia renova?veis, principalmente so-
lar e eo?lica. Dessa forma, este trabalho ataca um problema
econo?mico atual e importante para o Pa??s. Uma rede de
energia em grande escala pode ser subdividida em subsis-
temas chamados micro-redes, que podem ser vistos como um
conjunto de geradores despacha?veis e/ou na?o-despacha?veis
que utilizam energias fo?sseis e/ou renova?veis, armazenadores
de energia e consumidores. Uma micro-rede pode operar
em modo ilha, conectada com a rede principal e interligada
com outras micro-redes. Sabe-se que a operac?a?o ideal de
cada unidade na?o garante o perfeito funcionamento global
da micro-rede, o que leva a um comportamento inaceita?vel.
Assim, torna-se necessa?ria a coordenac?a?o entre todos os el-
ementos da micro-rede. A mesma filosofia deve ser aplicada
no problema de micro-redes interligadas. Do ponto de vista
da modelagem, os modelos de sistemas de gesta?o de energia
no n??vel superior te?m caracter??sticas h??bridas, devido a? ne-
cessidade de introduzir varia?veis bina?rias, por exemplo, para
modelar a dina?mica de armazenamento ou prec?os diferentes
para operac?o?es econo?micas como compra/venda de energia.

viii



Assim, uma abordagem natural para controlar esses sistemas
e? a utilizac?a?o de controle preditivo, o qual ja? e? amplamente
utilizado na indu?stria de processos e pode lidar com proble-
mas h??bridos de optimizac?a?o. Em uma micro-rede operando
em modo conectada a? rede principal o desafio de controle e?
maximizar o uso de fontes renova?veis, minimizar o uso de
combust??veis fo?sseis e a quantidade de energia comprada da
rede de distribuic?a?o, amortecer flutuac?o?es de energia e aten-
der a demanda. No caso de micro-redes interligadas e? dese-
jada uma estrate?gia de controle que permita a interac?a?o en-
tre micro-redes para compartilhar fontes de energia e reduzir
o fluxo de energia com a rede de distribuic?a?o. Assim, para
uma u?nica micro-rede o controle centralizado parece uma boa
opc?a?o, enquanto para micro-redes interligadas, quando o in-
terca?mbio de informac?a?o e? limitado, o controle distribu??do
aparece como uma soluc?a?o interessante. Nesta tese e? con-
siderado o problema de controle de micro-redes em difer-
entes cena?rios, dentre eles uma microrrede de laborato?rio
com armazenador de hidroge?nio, o estudo de microrredes in-
terligadas e uma planta de gerac?a?o da indu?stria da cana de
ac?u?car. O objetivo principal e? propor soluc?o?es baseadas em
controle preditivo para atender os requisitos de operac?a?o do
sistema.

ix





Abstract of the thesis presented to the Federal University of Santa
Catarina as a partial fulfillment of the requirements for the degree of

Doctor in Automation and Systems Engineering.

PREDICTIVE CONTROL FOR ENERGY
MANAGEMENT OF RENEWABLE ENERGY

BASED MICROGRIDS

Paulo Renato da Costa Mendes

Agosto/2016

xi



Advisor: Julio Elias Normey-Rico, Dr.
Co-advisor: Carlos Bordons Alba, Dr.
Area of Concentration: Control, Automation and Industrial
Informatics
Keywords: Energy Management, Microgrids, Control of Hy-
brid Systems, Distributed Predictive Control.
Number of Pages: xxv + 128

The objective of this thesis is to address the energy
management of power generation and energy storage sys-
tems. These systems are nowadays a reality in countries
where a diversification of energy sources and a higher pene-
tration of renewable sources is desired. In particular, Brazil
has a diversified energy matrix based on water resources,
biomass (ethanol), natural gas and oil. But the expectation
for the near future is an increase in the use of renewable
sources, mainly solar and wind. Thus, this work attacks a
current and important economic problem for the country. A
large scale energy network can be subdivided into subsystems
called Microgrids, that can be seen as set of dispatchable
and/or non-dispatchable generators that uses fossil and/or
renewable energy, storage units and consumers. A microgrid
can operate in island mode, grid-connected mode and inter-
connected with other microgrids as the so called networked
microgrids. It is known that an ideal operation of each unit
does not guarantee the perfect operation of the overall mi-
crogrid, which leads to an unacceptable behavior. Thus it
becomes necessary coordination between all microgrid ele-
ments. The same philosophy should be applied in the net-
worked microgrids problem. From modeling point of view,
the top level energy management system models have hybrid
characteristics due to the need to introduce binary variables,
for example, to model storage dynamics or different prices
for economic operations like sell/purchase of energy. Thus, a
natural approach to control these systems is the use of pre-
dictive control, which is already widely used in the process

xii



industry and can deal with hybrid optimization problems.
In a microgrid operating in grid connected mode the con-
trol challenges are to maximize the use of renewable sources,
minimize the use of fossil sources an the amount of energy
bought from distribution network operator (DNO), mitigate
energy fluctuating and meet the demand. In an intercon-
nected case a control strategy that allows the interaction
between microgrids to share energy sources and reduce the
energy flow with DNO is desired. Thus for a single micro-
grid the centralized control seems to be a good option and for
networked microgrids, when information sharing is limited,
the distributed control appears as an interesting solution. In
this thesis the problem of control of microgrids in different
scenarios is considered, among them a laboratory microgrid
with hydrogen storage, the study of four interconnected mi-
crogrids and a sugar cane industry power plant. The main
objective is to propose solutions based on model predictive
control to attend the system operation requirements.

xiii





Contents

1 Introduction 1
1.1 Objectives and Organization of the Thesis . . . . . . . . . . . 8

2 Energy Hubs Modeling Framework 9
2.1 Modeling Framework . . . . . . . . . . . . . . . . . . . . . . . 10

2.1.1 Converters . . . . . . . . . . . . . . . . . . . . . . . . 10
2.1.2 Storage Units . . . . . . . . . . . . . . . . . . . . . . . 13
2.1.3 State-space Representation . . . . . . . . . . . . . . . 17

2.2 Mixed Logical Dynamical Systems (MLD) . . . . . . . . . . . 17
2.2.1 MLD Procedure applied to Storage Modeling . . . . . 20

2.3 Interconnected Energy Hubs . . . . . . . . . . . . . . . . . . . 22
2.4 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 24

3 Model Predictive Control (MPC) 25
3.1 State Space MPC . . . . . . . . . . . . . . . . . . . . . . . . . 25

3.1.1 Prediction Model . . . . . . . . . . . . . . . . . . . . . 26
3.1.2 Objective Function . . . . . . . . . . . . . . . . . . . . 28
3.1.3 Obtaining the Control Law . . . . . . . . . . . . . . . 30

3.2 Distributed MPC . . . . . . . . . . . . . . . . . . . . . . . . . 31
3.2.1 Control Problem . . . . . . . . . . . . . . . . . . . . . 32
3.2.2 Information Exchange . . . . . . . . . . . . . . . . . . 33
3.2.3 Lagrange MPC . . . . . . . . . . . . . . . . . . . . . . 34

3.3 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 38

4 Hybrid Distributed MPC 39
4.1 Problem setting . . . . . . . . . . . . . . . . . . . . . . . . . . 41
4.2 Hybrid DMPC Framework . . . . . . . . . . . . . . . . . . . . 41

4.2.1 Binary Search Algorithm . . . . . . . . . . . . . . . . 42
4.2.2 Distributed Coordination . . . . . . . . . . . . . . . . 43
4.2.3 Algorithm Convergence . . . . . . . . . . . . . . . . . 45

4.3 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 47

5 Microgrid Control 49

xv



5.1 Energy Management in Microgrids . . . . . . . . . . . . . . . 49
5.2 Laboratory Microgrid Control . . . . . . . . . . . . . . . . . . 50

5.2.1 V2G Experimental Microgrid . . . . . . . . . . . . . . 51
5.2.2 System Modeling . . . . . . . . . . . . . . . . . . . . . 52
5.2.3 Control Algorithm . . . . . . . . . . . . . . . . . . . . 54
5.2.4 Experimental Results . . . . . . . . . . . . . . . . . . 60

5.3 Networked Microgrids . . . . . . . . . . . . . . . . . . . . . . 65
5.3.1 V2G Networked Microgrids . . . . . . . . . . . . . . . 65
5.3.2 System Modeling . . . . . . . . . . . . . . . . . . . . . 65
5.3.3 Control Algorithm . . . . . . . . . . . . . . . . . . . . 67

5.4 Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70
5.5 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 74

6 Sugar Cane Industry Case 81
6.1 The Hybrid Generation Power System . . . . . . . . . . . . . 82
6.2 System Modeling . . . . . . . . . . . . . . . . . . . . . . . . . 87

6.2.1 Manipulated Variables . . . . . . . . . . . . . . . . . . 87
6.2.2 Disturbance Vector . . . . . . . . . . . . . . . . . . . . 88
6.2.3 System Output . . . . . . . . . . . . . . . . . . . . . . 88
6.2.4 Stock Flows . . . . . . . . . . . . . . . . . . . . . . . . 88
6.2.5 Final State-Space Representation . . . . . . . . . . . . 90

6.3 Optimization Problems . . . . . . . . . . . . . . . . . . . . . . 91
6.3.1 Biomass Mixture Optimization . . . . . . . . . . . . . 92
6.3.2 Demand Optimization . . . . . . . . . . . . . . . . . . 93
6.3.3 Control Structure . . . . . . . . . . . . . . . . . . . . . 93
6.3.4 Final Control Algorithm . . . . . . . . . . . . . . . . . 96
6.3.5 Simulation Results . . . . . . . . . . . . . . . . . . . . 96

6.4 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 102

7 Conclusions and Future Works 105
7.1 Contributions . . . . . . . . . . . . . . . . . . . . . . . . . . . 106
7.2 Future Work . . . . . . . . . . . . . . . . . . . . . . . . . . . 108

A Simulation Parameters 111
A.1 Laboratory Microgrid Control . . . . . . . . . . . . . . . . . . 111
A.2 Networked Microgrids . . . . . . . . . . . . . . . . . . . . . . 113
A.3 Sugar Cane Industry Case . . . . . . . . . . . . . . . . . . . . 114

xvi



Nomenclature

Acronyms

BS Binary Search
BSDC Binary Search with Distributed Coordination
CSMU Charging Station Management Unit
CMIQP Centralized MIQP
DMPC Distributed Model Predictive Control
DNO Distribution Network Operator
EMS Energy Management System
MHL Metal Hydrid Level
MISO Multiple inputs and single input
MIMO Multiple inputs and multiple outputs
MIQP Mixed Integer Quadratic Programming
MLD Mixed Logical Dynamic
MPC Model Predictive Control
OLE Object Linking and Embedding
OPC OLE for Process Control
PLC Programmable Logic Controller
QP Quadratic Programming
SISO Single input and single output
SIMO Single input and multiple outputs
SOC State of charge
SQP Sequential Quadratic Programming
TIO-MPC Time Instant Optimization - MPC
V2G Vehicle-to-grid

xvii





List of Symbols

Indexes
r Hub inputs
p Hub outputs
q Inputs of the input storage units
m Inputs of the output storage units
s Storage interface
L Converters
E Storage units
rad Radiation
g Gas
e Electricity
h Heat
E Model storage flow
L Model input flow
+ Storage charging
? Storage discharging
c Continuous variable
l Discrete variable
H2 Hydrogen
DNO Distribution Network Operator
B Battery
S Solar
W Wind
ev Electric vehicle
ez Electrolyzer
fc Fuel cell
Renewable Renewable energy source
PV Ch Charging Station photovoltaic energy source
in Input

xix



out Output
i, j Hub index
?,? Flow direction
dem Demand
aug Augmented Lagrangian
fix Fixed values for binary variables
b binary
TU Turbine
C Boiler
CHP Combined heat and power plant
Ch Chiller
TC Heat exchanger
Esc Escape
Net Network
Proc Process
Sale Sale
V Steam
M Middle
L Low
Variables
A,B,C,D State-space system matrices
? Steady state conversion efficiency of the converter
nr Number of hub inputs
np Number of hub outputs
e Storage charge/discharge efficiency
u Model input
x State vector
y Model output
? Binary variable
z Continuous auxiliary variable
? Storage coupling matrix
? Converter coupling matrix
? Electric vehicle binary variable
P Power
w Interconnecting variables
? Interconnecting matrix
? Lagrange multipliers
J Objective function
C Objective function cost
CI Controller instance

xx



SCI Set of controller instances
BCI Best cost instance
Q Weighting matrix
f Weighting vector
e Error
?c, ?b DMPC weights
N Horizon
MG Microgrid
SP Set-point
Wind Wind speed
Irradin Solar irradiation
Bag Bagasse
Str Straw
Bg Biogas
? blending factors

xxi





List of Figures

2.1 SISO converter . . . . . . . . . . . . . . . . . . . . . . . . . . 11

2.2 Hub with multiple converters . . . . . . . . . . . . . . . . . . 12

2.3 Energy Hub that contains a photovoltaic panels, a CHP and
a battery bank . . . . . . . . . . . . . . . . . . . . . . . . . . 13

2.4 Hub storage . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13

2.5 Hub with multiple storage units . . . . . . . . . . . . . . . . . 15

2.6 Interconnection variables between hub i and j . . . . . . . . . 23

3.1 MPC block diagram. . . . . . . . . . . . . . . . . . . . . . . . 26

4.1 Number of iterations and calculation time varying Nb. . . . . 47

4.2 Input, output and state variables. (blue - u1, red - y, black -
u2, magenta - wout) . . . . . . . . . . . . . . . . . . . . . . . 48

5.1 Hylab microgrid . . . . . . . . . . . . . . . . . . . . . . . . . 51

5.2 Control Structure . . . . . . . . . . . . . . . . . . . . . . . . . 55

5.3 Implementation Flowchart . . . . . . . . . . . . . . . . . . . . 56

5.4 Energy sources and storage units - Sunny day . . . . . . . . . 62

5.5 Electric vehicles charge management - Sunny day . . . . . . . 62

5.6 Energy sources and storage units - Cloudy day . . . . . . . . 63

5.7 Electric vehicles charge management - Cloudy day . . . . . . 63

5.8 Energy sources and storage units - Windy day . . . . . . . . . 64

5.9 Electric vehicles charge management - Windy day . . . . . . . 64

5.10 Network of Microgrids . . . . . . . . . . . . . . . . . . . . . . 66

5.11 Control Structure . . . . . . . . . . . . . . . . . . . . . . . . . 68

5.12 Number of iterations and calculation time varying Nb. . . . . 71

5.13 Energy prices . . . . . . . . . . . . . . . . . . . . . . . . . . . 73

5.14 Interconnected simulation energy sources. (blue - renewable
energy sources, red - charging station photovoltaic source,
black - power exchanged with DNO, cyan - battery power,
green - Demand) . . . . . . . . . . . . . . . . . . . . . . . . . 75

xxiii



5.15 Isolated simulation energy sources. (blue - renewable energy
sources, red - charging station photovoltaic source, black -
power exchanged with DNO, cyan - battery power, green -
Demand) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76

5.16 Battery SOC . . . . . . . . . . . . . . . . . . . . . . . . . . . 77
5.17 Electric vehicles charge management (Isolated Microgrids) . . 77
5.18 Energy sources during a fault. (blue - renewable energy sources,

red - charging station photovoltaic source, black - power ex-
changed with DNO, cyan - battery power) . . . . . . . . . . . 78

5.19 Interconnection variables in the two analyzed scenarios. . . . 79
5.20 Number of iterations (without fault and during a fault) . . . 79

6.1 Original Power Generation Plant . . . . . . . . . . . . . . . . 83
6.2 Proposed Power Generation Plant . . . . . . . . . . . . . . . 84
6.3 Biomass Mixture . . . . . . . . . . . . . . . . . . . . . . . . . 84
6.4 Proposed Control Structure . . . . . . . . . . . . . . . . . . . 94
6.5 System Disturbances . . . . . . . . . . . . . . . . . . . . . . . 98
6.6 Electric power generation of the proposed system . . . . . . . 99
6.7 Electric power generation of the original system . . . . . . . . 100
6.8 Fulfillment of the Demands . . . . . . . . . . . . . . . . . . . 100
6.9 Stocks of the proposed system . . . . . . . . . . . . . . . . . . 101
6.10 Blending Factors of the proposed system . . . . . . . . . . . . 101
6.11 Variables involved in steam production (proposed scenario) . 102
6.12 Variables involved in hot water production (proposed scenario) 102

xxiv



List of Tables

1.1 Brazilian Internal Energy Offer . . . . . . . . . . . . . . . . . 2
1.2 Brazilian Internal Electrical Energy Offer . . . . . . . . . . . 3

2.1 Coupling factors meaning . . . . . . . . . . . . . . . . . . . . 11

4.1 Performance Indexes . . . . . . . . . . . . . . . . . . . . . . . 48

5.1 Microgrid Units . . . . . . . . . . . . . . . . . . . . . . . . . . 52
5.2 Microgrids Components . . . . . . . . . . . . . . . . . . . . . 67
5.3 Analysis of Nb . . . . . . . . . . . . . . . . . . . . . . . . . . 72
5.4 Performance Indexes . . . . . . . . . . . . . . . . . . . . . . . 72
5.5 Energy exchanged with DNO . . . . . . . . . . . . . . . . . . 74

6.1 Microgrid Equipments . . . . . . . . . . . . . . . . . . . . . . 85
6.2 Microgrid Data . . . . . . . . . . . . . . . . . . . . . . . . . . 85
6.3 Microgrids Subsystems Operating Points . . . . . . . . . . . . 86
6.4 Microgrids Storage Units . . . . . . . . . . . . . . . . . . . . . 86
6.5 Auxiliary Variables Index . . . . . . . . . . . . . . . . . . . . 92
6.6 Biomass mixtures: Boiler gains and calorific power . . . . . . 93
6.7 Full-Month Simulation Scenario Details . . . . . . . . . . . . 103
6.8 Different Daily Simulation Scenarios . . . . . . . . . . . . . . 103

xxv





Chapter 1

Introduction

Efficient energy generation and consumption is a key factor to
achieve ambitious goals for sustainable development and activities re-
lated to air pollution and climate change. Efficient and safe power
distribution along with minimized and balanced electricity power con-
sumption is nowadays an important part of the economic activity of
most countries. One of the largest issues is that generation power
systems have to supply energy at greatly varying demands. Abrupt
changes in the large-scale energy demand status can cause severe prob-
lems to production facilities, and since these changes cannot be accu-
rately predicted they may lead to outages.

Energy generation fundamentals of today are about to undergo
a profound change: affordable fossil fuel reserves are being reduced
every year while, at the same time, energy demand increases in every
country [63]. Moreover, the aim to reduce greenhouse gas emissions is
moving its attention to more environmentally-friendly and sustainable
energy sources [104]. With an increased utilization of small distributed
energy resources for generation of electricity and heat [11], renewable
energy generation will constitute an important part of the overall energy
scenario in the coming years.

Notably, in the instance of this work, the Brazilian energy sce-
nario will be taken into account. Brazil has an immensely diversified
energy matrix. This can be seen in Brazilian energy reports of 2015 [26]
(related to the energy generation of 2014, seen in table 1.1): hydraulic
energy sums up to 11, 5% of total energy generation, almost 16% of
the generated energy came from sugar cane (ethanol and electric en-
ergy from biomass) and other bio-energy sources contributed with up



2 1. Introduction

to 12, 2% of total generation. The rest of Brazilian energy generation
corresponds to: natural gas, summing up 13, 5%, petroleum and de-
rived sources, related with 39, 4%, nuclear sources, corresponding to
1, 3% and coal, corresponding to 6% of the totality. In respect to the
Brazilian electric matrix (seen in table 1.2), 74.6% of the total electric
energy was generated by renewable energy sources.

The investment in solar energy has vastly risen in recent years and
Brazil has good climatological conditions in several regions to explore
this kind of energy source, showing competitive costs [108]. Solar and
wind energies can be considered potential energy sources to enlarge
the renewable energy share in the Brazilian electric energy matrix for
the next years. According to [24] the share of wind energy in the
total electric energy produced in 2024 will increase to 11.6% (24GW)
while solar energy will contribute with 3.3% (7GW). Beyond that, the
prospect to next years is that renewable energy sources will increase
their contribution in 84% to the electric energy matrix.

Table 1.1: Brazilian Internal Energy Offer

Energy Source Structure (%)
Non-renewable 60.6

Petroleum and derivatives 39.4
Natural Gas 13.5

Mineral Coal and derivatives 5.7
Uranium (U3O8) and derivatives 1.3

Other non-renewable 0.6

Renewable 39.4
Hydraulics and Electricity 11.5
Firewood and Charcoal 8.1
Sugar Cane derivatives 15.7

Other Renewable 4.1

Total 100

The sugar cane and ethanol power plants are particularly signifi-
cant to this study [53], as the sugar cane process has a great amount of
residue that can be treated as biomass. To allow technological improve-
ments [35] and to increase ethanol production, per ton of processed
sugar cane, the amount of sugar cane fiber made available in the plant
has to be as great as possible. A plausible solution to resolve this matter
is to harvest the crops of cane without pre-burning the crop area, and,
by this, recover a significant portion of straw available in the canebrakes



3

Table 1.2: Brazilian Internal Electrical Energy Offer

Energy Source Structure (%)
Hydraulic 59.8

Sugar Cane derivatives 5.2
Wind 2
Solar 0.003

Other renewable 2.2

Petroleum and derivatives 5.1
Natural Gas 13.0

Mineral Coal and derivatives 2.9
Nuclear 2.5

Other non-renewable 1.9

Imported 5.4

Total 100

[22]. The straw is composed of unseasoned leafs, dry leafs and by the
sugar cane pointer, and can be used, for example, to boost up heating
boilers. This biomass is not yet exploited in its plenitude, although this
situation will be reversed in the near future, knowing that Brazilian en-
vironmental legislation [73] predicts gradual prohibition of pre-burning
canebrakes. Apart from the straw, the bagasse is also an important
[2] and useful residue of the sugar cane processing. The bagasse is the
final residue of the compression process to retrieve the sugar cane juice
and is commonly used in sugar cane energy plants. From the ethanol
production process, it is, in the instance of this work, worth mention-
ing the vinasse. The vinasse [96] represents the residue made available
after the distillation of fermented sugar cane broth (garapa). For ev-
ery liter of ethanol produced, 12 liters of vinasse appear as left-overs.
Typically, the vinasse is used as a fertilizer for newer crops, which is
actually linked to environmental damaging issues, as contamination of
soil and underground water. Even if not often, the vinasse can be used
as a renewable power source. This is grounded in the technology of
anaerobic digestion of the vinasse, that ends up transformed in biogas.
This biogas can be used in thermodynamical applications: generation
of heat and power. In sum, there are three very important renewable
sources of energy in the sugar-ethanol plants: the bagasse, the straw
and the vinasse.

One of the main problems associated with these kind of systems
is the reliability and quality of the power supply. As a matter of fact,



4 1. Introduction

since the renewable source is intermittent, unpredictable fluctuations
may appear in power output [3]. Also, electrical generation from re-
newable sources is not subjected to demand, which creates imbalance
in the system. One way to overcome this problem is to include inter-
mediate storage, such as batteries, water pumping, super-capacitors,
compressed air, fly wheels, superconducting magnetic energy storage
unit, etc. [33]. This buffering capability can help to avoid the consid-
eration of renewable as an undispatchable source, due to its inherent
unpredictability and variability.

The use of storage systems enables the opportunity to decide the
microgrid optimal operating point both in the islanded and connected
to the grid modes, being possible to manage the appropriate time to
exchange energy with the external network. There are several energy
storage technologies and the possibility of hybridization among them
has aroused great interest [38], [54]. Specifically, the combination of
hydrogen storage together with electric batteries and supercapacitors
seems to be a suitable solution for renewable generation [62]. The use of
hydrogen for storing electrical energy from renewable sources is based
on the possibility of producing hydrogen by electrolysis, store it and
subsequently use it again to generate electricity through fuel cells.

A structural solution that has been studied in recent years is
the splitting of the electrical network into smaller self-generation units
based on renewable energy where the use of energy storage compen-
sates the fluctuations in renewable generation and the randomness of
consumer behavior. Thus, the concept of microgrid, introduced by [68],
becomes a powerful tool to improve the electrical system quality and
reliability. A microgrid is defined as a hybrid system which includes
several sources and storage devices to fulfill the local loads [41]. Ac-
cording to [86] a microgrid can be seen as a set of loads, generators
and storage units whose management can be done independently or
connected to the external network in a coordinated way to contribute
to the whole system stability.

On the other hand, V2G systems (Vehicle-to-grid) consist of the
use of electric car batteries, during periods when they are not used, as
energy storage units for an electrical network. Taking into account the
current size of the fleet and the expectation of a gradual increase in the
number of electric vehicles, it is expected that the energy storage ca-
pacity that can be provided in a near future will be sufficient to balance
the supply and demand on an electricity grid or microgrid, and hence,
improve the performance and stability of the network. According to
recent publications of the Brazilian Science, Technology and Innova-



5

tion Ministry ([23], [25]), the use of electric vehicles connected to the
smart grid is a trend for the future and the development of algorithms
for managing the use of vehicle batteries is a strategic research area.

It is estimated that a electric vehicle is in motion only 4% of
time, so the rest of the time it could be available as an electrical en-
ergy storage unit [47]. Furthermore, in normal use, the car batteries are
recharged overnight (which is the period of low electricity demand) and
are parked in the workplace during periods of high electrical demand,
so this power could be used to meet the peak demand. This storage
capacity is especially useful with renewable energy sources, as the fluc-
tuating nature makes it harder to adjust production and demand.

In addition, the V2G systems enable to set new business models
in which new actors appear, such as Load Managers that would be
responsible for recharging infrastructure, providing service to vehicles,
buying or selling electrical energy and building relationships with the
network managers. In the last years control algorithms for charging
electric vehicles in intelligent networks appeared in the literature. In
[28] and [97] the problem is solved by real-time optimization algorithms,
whereas in [52] an MPC-based algorithm is presented. Also solutions
based on hierarchical distributed algorithms have been presented ([5];
[36]; [43]).

Regarding modeling aspects, most part of the algorithms pro-
posed in literature use very simplified models of power systems, vehicle
motion and load characteristics. In particular, the modeling framework
called Energy hubs ([49], [31]) allows the integration of different forms
of production and storage of a microgrid, V2G system [44] and the
interconnection of different microgrids or a microgrid connected to an
electric network.

With an increasing demand on improving productivity and effi-
ciency, the operation requirements of energy systems are getting tighter.
This leads to the necessity of investing on automatic operation and
control of the plants aimed to achieve an enhanced efficiency of the
whole plant. It is known that an optimal operation of each subsystem
composing the energy plant does not ensure the optimal operation of
the whole system possibly leading to an even not admissible behavior.
This makes necessary the coordination between the elements of the
whole plant. This is typically carried out by a supervised automatic
system which relies on an upper level in the control hierarchy of the
plant. Thus, targets of each subsystem are provided by the upper level
such that the quality of the service is ensured and, if possible, opera-
tion is done close to the optimal operating point. From the efficiency



6 1. Introduction

point of view, the best control technique should take into account si-
multaneously the efficient operation of each subsystem while quality
requirements are fulfilled.

The development of new results for modeling, identification and
control of hybrid energy systems including renewable energy would im-
ply a significant improvement in the operation, efficiency and safety
of this class of relevant systems. Due to the incomplete nature of the
results on this topic, new methodologies and strategies are of potential
great relevance in this emerging field.

Model Predictive Control (MPC) is the most natural approach to
the optimal control of processes subject to constraints [17]. This ex-
plains why MPC is the advanced control strategy that has the greatest
acceptation in process industry. However, there are still many open
issues related to MPC techniques to be applied to energy systems, such
as cooperation, robustness, real-time optimization, that must be deeply
explored.

In general, microgrid management is carried out by heuristic al-
gorithms [55], although there are applications that use MPC strategies,
such as those presented in [38] and [112]. Optimal control of distributed
energy resources using model predictive control with battery storage
system is developed in [82]. In the case of hybrid storage systems,
MPC appears to be a good solution as shown in [30], [115] and [54].

Several works ([59]; [126];[51]) use the hysteresis band (HB) method
for energy management of microgrids with hybrid storage. Regarding
the performance advantages of MPC over optimized hysteresis band,
there are several papers comparing these approaches and others ([113];
[14]; [46]). The main difference between MPC and HB is that MPC
guarantees optimality while HB does not. MPC solves an optimization
problem each sampling time to determine minimal running cost while
meeting the demand and considering technical and physical limits. A
dramatic reduction in operation cost can be observed when comparing
both techniques [115].

Recent works have brought to light MPC-based control struc-
tures used to master microgrids with renewable sources. Reference
[114] shows a hydrogen-based domestic microgrid being controlled by
an MPC-based structure; [45] and [93] also refer to optimal generation
for renewable microgrids, considering hydrogen storage systems. [42]
considers plug-in hybrid electric vehicles based on multi-carrier systems
and [75] proposes a MPC to energy management of a microgrid con-
nected to an electric vehicle charging station. In terms of renewable
source applications, [44] is specific about wind balancing capabilities



7

using heuristics and MPC, whereas [76] focuses on a renewable micro-
grid in an isolated load area. Generic MPC-based structures are seen
in [4] and [92]. Economic optimization is exposed in [15] and [91].
Cogeneration is discussed in [106] and [101].

Recent studies have shown that connecting multiple microgrids
can further improve the system operation and reliability ([85], [37],
[121]). Those benefits are assigned to some properties of networked
microgrids, such as coordinated energy management and interactive
support and exchange. According to [122], self-healing capability intro-
duced by interconnecting microgrids, is an important feature in smart
grids, especially when a fault occurs in a part of the system.

The study of interconnected microgrids is a growing research field.
A centralized control model for optimal management and operation of
a smart network of microgrids was presented in [88]. [83] and [77]
addressed the optimal power dispatch problem considering uncertain-
ties in load and probabilistic modeling of generated power by renewable
small-scale energy resources. A review on distributed control techniques
for all hierarchy levels and a discussion of future research trends in this
area was presented in [125]. A game theoretic coalition formulation
strategy was proposed in [123] to allow the microgrids autonomously
cooperate and self-organize into coalitions. In [121] a bi-level stochas-
tic solution for the coordinated operation of multiple microgrids and a
distribution system is presented. A self-healing operation mode based
on average consensus algorithm for optimal operation of autonomous
networked microgrids was developed in [122]. In [105] a distributed
energy management system for the optimal operation of alternating
current (AC) microgrids was designed with consideration of the under-
lying power distribution network and the associated constraints.

Due to the complexity of large-scale networks, the distribution of
the control effort between local control agents can be a very convenient
choice. In many cases, parts of the network belong to different organi-
zations, which makes centralized control impossible to be implemented
[31]. In interconnected microgrids scenario the coordination among
all microgrids and between the microgrids and Distribution Network
Operator (DNO) brings new challenges for the overall system energy
management. In this scenario a distributed control structure becomes
a good option for sharing information about energy exchange to de-
cide the optimal operating point for the whole system. In the last
years many distributed control techniques were proposed in literature
([71],[72],[1],[18]).

The control of hybrid energy systems including renewable and



8 1. Introduction

non-renewable generation is an important problem to be studied in the
following years to allow the optimal operation of these new generation
units. The integration of V2G systems can be a key factor in network
stability guarantee against load fluctuations. In this context this thesis
aims to contribute with this research area through the study and devel-
opment of control algorithms applied to renewable energy microgrids.

1.1 Objectives and Organization of the The-
sis

This thesis has a general objective to develop MPC algorithms to
the economic management of hybrid energy systems based on renewable
energy sources. The specific objectives are:

1. Model hybrid energy systems integrating renewable energy sources
(wind and solar), hybrid storage units (batteries, hydrogen and
biomass) and electric vehicles (V2G).

2. Develop load controllers strategies and manage the electric vehi-
cles batteries usage as energy storage connected to microgrid in
the context of V2G systems.

3. Apply the control algorithms to an experimental microgrid lo-
cated at the Departamento de Ingenier??a de Sistemas y Automa?tica
(DISA) of the Universidad de Sevilla (US) in Seville, Spain.

4. Develop an Hybrid MPC and Distributed MPC strategies for the
optimal economic management of single grid-connected micro-
grids and networked microgrids respectively.

5. Apply these techniques in a Brazilian case study of hybrid power
plants in sugar cane distilleries.

This thesis is organized as follows. In Chapter 2 the energy hub
modeling framework is described. Chapter 3 presents a review of MPC,
Hybrid MPC and Distributed MPC Strategies. Chapter 4 proposes an
Hybrid Distributed MPC algorithm. Chapter 5 focuses on the applica-
tion of modeling and control methodologies described in previews chap-
ters to the problem of single grid-connected microgrid and networked
microgrids. Finally, chapter 6 presents the case of hybrid power plants
in sugar cane distilleries and the use of the discussed techniques to opti-
mize their operation. The thesis ends with some conclusions presented
in chapter 7.



Chapter 2

Energy Hubs Modeling
Framework

This chapter presents a literature review of the energy hub mod-
eling methodology, introduced in [48]. An energy hub can be used to
model the interface between energy producers, consumer and the trans-
mission line. From the standpoint of the system, an energy hub can be
identified as a unit that provides the following features:

1. input and output power;

2. energy conversion;

3. energy storage.

The hub serves as interface between the energy sources, producers
and consumers or between the different energy sources. In practice a
microgrid can be modeled as a hub and a power system can be divided
in many microgrids interconnected by transmission lines, where each
network node corresponds to one hub. The system model is designed
in two parts: power flow within and between hubs. The model is based
on some assumptions and simplifications:

• it is considered that the network is in steady state. Such a state is
achieved after the end of all transitory dynamics and all variables
oscillate uniformly or remain essentially constant;

• the interconnection between hubs is carried out through inputs
and outputs interconnection;



10 2. Energy Hubs Modeling Framework

• losses only occur in converter and storage unit elements;

• within a hub, it is assumed that the flow is unidirectional from
the inputs to the outputs of the converters, except when consid-
ering the storage elements, where the bidirectional flow (charge/
discharge) is allowed.

2.1 Modeling Framework

Hereafter the modeling of converters and storage elements will be
presented. For a description of input and output variables a standard
based on the generic variable:

g
sup
sub

(k) (2.1)

was used, where g can be represented by y for outputs and u for inputs.
When sub-index sub refers to input variables the letter r will be used;
for hub outputs, the letter p; to the inputs of the inputs storage units,
the letter q; for inputs of the output storage units, the letter m; and
for storage interface the letter s. The super-index sup is the element
type that the variable belongs, being L for converters and E to storage
units.

2.1.1 Converters

Input-output conversion can be described considering the con-
verter as a black box. Converter combinations can lead to different
hub input-output settings according the following four cases below:

• single input and single output (SISO);

• single input and multiple outputs (SIMO);

• multiple inputs and single input (MISO);

• multiple inputs and multiple outputs (MIMO).

A single converter can be seen as presented in figure 2.1. This
element converts, in every time instant k, a generic r input flow uLr (k)
of a generic hub into a generic p output flow yp(k), where superscript L
is associated to converter input flows. The input-output conversion is



2.1. Modeling Framework 11

defined through coupling factors ?Lp,r, which correspond to steady state
conversion efficiency of the converter between the input and output
flows:

Figure 2.1: SISO converter

yp(k) = ?
L
p,ru

L
r (k) (2.2)

with uLr (k) &gt; 0, which implies unidirectional flow from the input to
the output of a converter. From a physical point of view, coupling fac-
tors have the meaning listed in table 2.1, considering lossy, lossless and
gainy conversions. When considering applications where flow conserva-
tion laws have to be fulfilled (such as energy-related systems), coupling
factors are limited in the sense that the output of a converter element
must be less than or equal to the input:

yp(k) ? u
L
r (k) ? 0 ? ?

L
p,r ? 1 (2.3)

Table 2.1: Coupling factors meaning

Type of converter Coupling factor
Lossy conversion 0 ? ?Lp,r ? 1
Lossless conversion ?Lp,r = 1
Gainy conversion ?Lp,r ? 1

Considering the converter model described above, a generic hub
is composed of a converter cluster, shown in figure 2.2, linking all
flow inputs uL(k) =

{
uL1 (k), . . . , u

L
nr
(k)

}
with all flow outputs y(k) =

{
y1(k), . . . , ynp(k)

}
, where nr and np are the total number of hub in-

puts and outputs respectively. A set of converters is expressed by the
converter coupling matrix ?L, which describes the flows from the input
to the output and is composed by the converter coupling factors ?Lp,r.



12 2. Energy Hubs Modeling Framework

Figure 2.2: Hub with multiple converters

?

?
?

y1(k)
...

ynp(k)

?

?
?

? ?? ?

y(k)

=

?

?
?

?L1,1 · · · ?
L
1,nr

...
...

...
?Lnp,1 · · · ?

L
np,nr

?

?
?

? ?? ?

?L

?

?
?

uL1 (k)
...

uLnr(k)

?

?
?

? ?? ?

uL(k)

(2.4)

As the coupling factors are assumed constant, equations (2.2) and
(2.4) result in linear relations.

Application example
In this example, the concepts presented above are applied to

model the energy hub shown in figure 2.3, composed of a photovoltaic
panels, a CHP (combined heat and power plant) and a battery bank.
First input uL1 (k) is referred to solar radiation, while second input u

L
2 (k)

is referred to natural gas. First and second outputs y1(k), y2(k) are re-
ferred to electricity and heat demand respectively. Hub inputa?output
description is obtained utilizing the converter coupling matrix ?L in
equation (2.5).

[
y1(k)
y2(k)

]

=

[
?L1,1 ?

L
1,2

0 ?L2,2

] [
uL1 (k)
uL2 (k)

]

(2.5)

In the example application described herein, coupling factors have
the physical meaning of energy conversion efficiencies ?. Specifically,
the photovoltaic panels are characterized by its radiationa? electric con-
version efficiency ?Srad,e. Analogously, the CHP is characterized by its

gasa?electric conversion efficiency ?CHPg,e and its gas-heat conversion effi-

ciency ?CHPg,h . This way the converter coupling matrix has the following
form:



2.1. Modeling Framework 13

Figure 2.3: Energy Hub that contains a photovoltaic panels, a CHP and a
battery bank

? =

[
?Srad,e ?

CHP
g,e

0 ?CHPg,h

]

(2.6)

2.1.2 Storage Units

The modeling of a generic storage considers that the device is
composed of an interface and an internal storage, as shown in figure
2.4. The interface can be seen as a flow converter, which modulates a
generic storage interface input flow uEs (k) into another generic storage
interface output flow u?Es (k). The converted energy is then stored in an
ideal internal stage. Mathematically, the storage interface is modeled
analogously to a converter device, where the steady-state input-output
flow values are described by the relation:

Figure 2.4: Hub storage

u?Es (k) = es(k)u
E
s (k) (2.7)



14 2. Energy Hubs Modeling Framework

where es(k) represents the efficiency of the charge/discharge interface s
of the Hub, which describes how much of the flow exchanged with the
system affects the storage. This factor depends on the direction of the
exchanged flow, if the storage is being charged or discharged:

es(k) =

{
e+s if u

E
s (k) ? 0 (charging)

e?s else (discharging)
(2.8)

where e+s and e
?
s are respectively the charging and discharging efficien-

cies.
From a discrete-time point of view, internal storage state xs at

sampling time k + 1 depends on the state at previous sample k and on
the total exchanged flow u?Es (k) during the period ?T ranging from k
to k + 1, assuming u?Es (k) to remain constant during ?T :

xs(k + 1) = xs(k) + u?
E
s (k)?T (2.9)

Thus, vector xs(k + 1) containing all the storage states xs(k +
1); s = 1, . . . , ns depends on the state vector at previous time step
xs(k), on matrix ?

E(k) containing all the interface efficiencies es(k); s =
1, . . . , ns and on vector u

E
s (k) containing all the interface flow inputs

uEs (k); s = 1, . . . , ns, where ns is the total number of storage elements:

?

?
?

x1(k + 1)
...

xns(k + 1)

?

?
?

? ?? ?

xs(k+1)

=

?

?
?

x1(k)
...

xns(k)

?

?
?

? ?? ?

xs(k)

+

?

?
?

e1(k)

...

ens(k)

?

?
?

? ?? ?

?E(k)

?

?
?

uE1 (k)
...

uEns(k)

?

?
?

? ?? ?

uEs (k)

(2.10)

where

?E(k) =
{
?E+, ?E?

}
=

?

?
?

{
e
+
1 , e
?
1

}

...
{
e+ns, e

?
ns

}

?

?
? (2.11)

where each element of ?E(k) is a signal function of uEs (k), so, if u
E
s (k)

is positive this means that the storage is charging and es(k) = e
+
s , oth-

erwise uEs (k) ? 0 and the storage is discharging and es(k) = e
?
s .

Multiple Storage



2.1. Modeling Framework 15

As storage elements may be connected to both hub inputs and
outputs, as shown in figure 2.5, a mathematical transformation of the
corresponding storage flows has to be performed in order to obtain an
input-output description independently of where the storage device is
physically connected.

Figure 2.5: Hub with multiple storage units

As shown in figure 2.5, the flow u?Lr (k) entering the converter is
equal to the hub input flow uLr (k) minus the input side storage flow
uEq (k):

u?Lr (k) = u
L
r (k)?u

E
q (k). (2.12)

The converter output can be described as:

y?p(k) = yp(k) + u
E
m(k) (2.13)

where y?p(k) is the converter output flow, yp(k) is the hub output flow
and uEm(k) is the output storage flow. Using equation (2.2) in this case
gives:

y?p(k) = ?
L
p u?

L
r (k). (2.14)

Substituting equations (2.12) and (2.13) into (2.14), both con-
verter sides storage flows can be explicitly included in the following
input-output description:

yp(k) = ?
L
p,r

(
uLr (k)?u

E
q (k)

)
?uEm(k) = ?

L
p,ru

L
r (k) + ?

E
p,ru

E
r (k),(2.15)



16 2. Energy Hubs Modeling Framework

where ?Ep,r are the coupling factors related to storage variables u
E
r (k).

Vector y(k) contains all hub outputs yp(k) ?
{
y1(k), . . . , ynp(k)

}
and

can be extended in order to include storage elements through the stor-
age coupling matrix ?E. Such a matrix describes how changes of the
storage flows affect the converter output flows, resulting in 2.16.

?

?
?

y1(k)
...

ynp(k)

?

?
?

? ?? ?

y(k)

=

?

?
?

?L1,1 · · · ?
L
1,nr

...
...

...
?Lnp,1 · · · ?

L
np,nr

?

?
?

? ?? ?

?L

?

?
?

uL1 (k)
...

uLnr(k)

?

?
?

? ?? ?

uL(k)

(2.16)

+

?

?
?

?E1,1 · · · ?
E
1,ns

...
...

...
?Enp,1 · · · ?

E
np,ns

?

?
?

? ?? ?

?E

?

?
?

uE1 (k)
...

uEns(k)

?

?
?

? ?? ?

uE(k)

Application example
Consider the hub shown in figure 2.3, which is composed of two

converters and one storage device: photovoltaic panels, CHP and bat-
tery bank. The state x1(k) is related to the battery bank state of charge
while the input uE1 is related to the charging/discharging interface. As
described herein, state variables can be modeled as:

x1(k + 1) = x1(k) + e1(k)u
E
1 (k) (2.17)

where

e1(k) =

{
e
+
1 if u

E
1 (k) ? 0 (charging)

e
?
1 else (discharging)

(2.18)

with e+1 being the charge efficiency and e
?
1 the discharge efficiency.

Including the storage input into the equation (2.5), results in:

[
y1(k)
y2(k)

]

=

[
?L1,1 ?

L
1,2

0 ?L2,2

] [
uL1 (k)
uL2 (k)

]

+

[
?1
0

]

uE1 (k) (2.19)

when the battery bank is charging (uE1 ? 0) the direction of energy



2.2. Mixed Logical Dynamical Systems (MLD) 17

flow is from the converters to the storage, otherwise (uE1 &amp;lt;0) and the
storage is providing energy to the first output.

2.1.3 State-space Representation

Summarizing equations (2.11) and (2.16) yields to a complete
state-state representation of a generic hub:

x(k + 1) = x(k) + ?E(k)uE(k) (2.20)

y(k) = ?LuL(k) + ?EuE(k),

which can be condensed by defining the complete converter interface
efficiency matrix ?i(k), the complete coupling matrix ?i and the com-
plete hub input vector ui(k) as follows:

?(k) =
[
0 ?E(k)

]
(2.21)

? =
[
?L ?E

]

u(k) =
[
uL(k)T uE(k)T

]T
,

which results in the following representation:

x(k + 1) = x(k) + ?(k)u(k) (2.22)

y(k) = ?u(k).

Using this formulation, a generic network hub can be described
by the set of matrices H = {?(k), ?}.

2.2 Mixed Logical Dynamical Systems (MLD)

This section is a literature review about Mixed Logical Dynamic
systems based in [7]. According to [29], the state-space representation
of equation (2.22) is not linear as it includes bilinear terms related
to equation (2.7) and (2.8). In order to avoid these terms, the state
space representation can be transformed into a Mixed Logical Dynamic
system (MLD) [7], where logic, dynamics and constraints are integrated
according to:



18 2. Energy Hubs Modeling Framework

x(k + 1) = Ax(k) + B1u(k) + B2?(k) + B3z(k) (2.23)

y(k) = Cx(k) + D1u(k) + D2?(k) + D3z(k) (2.24)

E2?(k) + E3z(k) ? E1u(k) + E4x(k) + E5 (2.25)

where x(k) =
[
xc(k) xl(k)

]T
is the state vector with xc(k) ? ?

nc

and xl ? {0, 1}
nl, y(k) =

[
yc(k) yl(k)

]T
is the output vector with

yc(k) ??
pc and yl(k) ?{0, 1}

pl, u(k) =
[
uc(k) ul(k)

]T
is the input

vector with uc(k) ??
mc and ul(k) ?{0, 1}

ml, z(k) ??rc are the con-
tinuous auxiliary variables, ?(k) ?{0, 1}

rl are the binary auxiliary vari-
ables, A, B1, B2, B3, C, D1, D2, D3, E1, E2, E3 and E4 are constant
real matrices, E5 is a real vector, nc &gt; 0 and pc, mc, rc, nl, pl, ml, rl &gt; 0.
The auxiliary variables are new variables introduced in the model to
transform the original model into a MLD model.

MDL systems are able of modeling a broad class of systems, as the
energy hubs described previously. In order to transform the nonlinear
model (2.22) into an MDL description, some basics on propositional
calculus and linear integer programming [7] should be firstly revised.
To that end, consider the statement X , [f(x) ? 0], where f : Rn ? R
is linear, assume that x ? X, where X is a given bounded set, and
define:

M , max
????

x?X

f(x) (2.26)

m , min
????

x?X

f(x) (2.27)

It is easy to verify that

[f(x) ? 0]? [? = 1] is true iff f(x)? ? ??1 + m(1? ?) (2.28)

[f(x) ? 0]? [? = 1] is true iff f(x) ? M?

? [f(x) ? 0] is true iff f(x) ? ?

where ? is a small tolerance beyond which the constraint is regarded
as violated and standard Boolean algebra is utilized, which enables



2.2. Mixed Logical Dynamical Systems (MLD) 19

statements X such as “x &gt; 0” to be combined in compound statements
by means of connectives: “?” (and), “?” (or), “?” (not), “?” (implies),
“?” (if and only if). By property

X1 ? X2 is the same as ? X1 ?X2 (2.29)

and (2.28), it also follows

[f(x) ? 0] ? [? = 1] is true iff f(x) ? ? + (m? ?)? (2.30)

[f(x) ? 0] ? [? = 1] is true iff

{
f(x) ? M(1? ?)

f(x) ? ? + (m? ?)?
(2.31)

Following the reasoning, it is possible to transform products of log-
ical variables, and of continuous and logical variables, in terms of linear
inequalities, which can be done by the introduction of some auxiliary
variables. Specifically, the generic product term ?1?2 can be replaced
by an auxiliary logical variable ?3 , ?1?2. Then, [?3 = 1] ? [?1 =
1]? [?2 = 1], and therefore

?3 = ?1?2 is equivalent to

?

?

?

??1 + ?3 ? 0
??2 + ?3 ? 0

?1 + ?2 ? ?3 ? 1
(2.32)

Also, the term ?f(x), where f : ?n ? ?, can be replaced by an
auxiliary real variable y , ?f(x), which satisfies [? = 0] ? [y = 0],
[? = 1] ? [y = f(x)]. Thus, y = ?f(x) is equivalent to

y ? M? (2.33)

y ? m? (2.34)

y ? f(x)?m(1? ?) (2.35)



20 2. Energy Hubs Modeling Framework

y ? f(x)?M(1? ?) (2.36)

where M and m are defined as in (2.26) and (2.27).

2.2.1 MLD Procedure applied to Storage Modeling

According to [29], in order to convert the bilinear equation (2.7)
in the MLD form and taking into account the concepts of propositional
calculus and integer linear programming, the following steps are per-
formed:

1. Condition uEs (k) ? 0 is associated with the binary variable ?s(k)
so that

[?s(k) = 1] ?
[
uEs (k) ? 0

]
(2.37)

Using transformations (2.30) and (2.31), equation (2.37) is repre-
sented by inequalities

?ms?s(k) ? u
E
s (k)?ms

?(Ms + ?)?s(k) ??u
E
s (k)? ?

where ? is a positive scalar and

ms , min????
k??,s?Ns

uEs (k)

Ms , max????
k??,s?Ns

uEs (k)

and Ns is the storage units set.

2. A new variable is defined zs(k) = u
E
s (k)?s(k) which can be rep-

resented as

zs(k) ? Ms?s(k)

zs(k) ? ms?s(k)

zs(k) ? u
E
s (k)?ms(1? ?s(k))

zs(k) ? u
E
s (k)?Ms(1? ?s(k))



2.2. Mixed Logical Dynamical Systems (MLD) 21

3. The system evolution, (2.20), can be described by the following
linear relationships:

xs(k + 1) = xs(k) + e
?
s u

E
s (k) +

(
e+s ?e

?
s

)
zs(k)

It should be noted that when uEs (k) &gt; 0 so ?s(k) = 1 and
consequently zs(k) = u

E
s and equation results in xs(k + 1) =

xs(k) + e
+
s u

E
s (k). When u

E
s (k) &amp;lt;0 so ?s(k) = 0 and zs(k) = 0

and model results in xs(k + 1) = xs(k) + e
?
s u

E
s (k) satisfying the

imposed modeling conditions, but with a linear model.

Vector x(k+1) containing all the storage states, which was previ-
ously described by the nonlinear equation (2.10), can also be described
by the following linear relationships:

?

?
?

x1(k + 1)
...

xns(k + 1)

?

?
?

? ?? ?

x(k+1)

=

?

?
?

x1(k)
...

xns(k)

?

?
?

? ?? ?

x(k)

+

?

?
?

e
?
1

...

e?ns

?

?
?

? ?? ?

?E?

?

?
?

uE1 (k)
...

uEns(k)

?

?
?

? ?? ?

uE(k)

(2.38)

+

?

?
?

e
+
1 ?e

?
1

...

e+ns ?e
?
ns

?

?
?

? ?? ?

?E+??E?

?

?
?

z1(k)
...

zns(k)

?

?
?

? ?? ?

z(k)

?

?
?
?
?
?
?
?

?M
m
?m
M
?m

?(M + ?(·))

?

?
?
?
?
?
?
?

? ?? ?

E?

?

?
?

?1(k)
...

?ns(k)

?

?
?

? ?? ?

?

+

?

?
?
?
?
?
?
?

1(·)
?1(·)
1(·)
?1(·)
0(·)
0(·)

?

?
?
?
?
?
?
?

? ?? ?

Ez

?

?
?

z1(k)
...

zns(k)

?

?
?

? ?? ?

z(k)

?

?

?
?
?
?
?
?
?

0(·)
0(·)
1(·)
?1(·)
1(·)
?1(·)

?

?
?
?
?
?
?
?

? ?? ?

EEu

?

?
?

uE1 (k)
...

uEns(k)

?

?
?

? ?? ?

uE(k)

+

?

?
?
?
?
?
?
?

0(·)f
0(·)f
?mf
Mf
?mf
??(·)f

?

?
?
?
?
?
?
?

? ?? ?

E0



22 2. Energy Hubs Modeling Framework

where,

M =

?

?
?

M1
...

Mns

?

?
? , Mf =

?

?

M1
· · ·
Mns

?

? ,

m =

?

?
?

m1
...

mns

?

?
? , mf =

?

?

m1
· · ·
mns

?

? ,

a(·) =

?

?
?

a

...

a

?

?
? , a(·)f =

?

?

a
· · ·
a

?

?

where a(·) is a matrix with dimension ns × ns and a(·)f is a column
vector with ns rows.

Introducing equation (2.16) related to coupling factors and using
the condensed formulation (2.21), a generic hub can be expressed by the
following MDL form, which is analogous to the nonlinear state-space
representation in equation (2.22).

x(k + 1) =Ax(k) + ?E?uE(k) +
(
?E+ ??E?

)
z(k) (2.39)

y(k) =?LuL(k) + ?EuE(k) (2.40)

E??+Ezz(k) ? E
E
u u

E(k) + E0 (2.41)

2.3 Interconnected Energy Hubs

Consider a generic network composed of a set N = 1, . . . , nN of
interconnected hubs, where nN is the total number of hubs composing
the network. The dynamics of sub-network i ? N can be defined by
the following nonlinear time-invariant discrete-time state-space model:

xi(k + 1) =xi(k) + ?i(k)ui(k) (2.42)

yi(k) =?iui(k) + ?in,i?jwin,i?j(k), (2.43)

where win,i?j(k) ? R
nv is the interconnecting inputs vector and ?in,i?j ?

Rnp×nv is the input interconnecting matrix, np and nv are the total
number of hub outputs and interconnecting constraints, respectively.



2.3. Interconnected Energy Hubs 23

The ”‘?”’ indicates the power flow direction between the hub j and
the hub i. As discussed previously such a nonlinear state-space model
can be expressed in the following MDL form:

xi(k + 1) =xi(k) + ?
E?
i u

E
i (k) +

(
?E+i ??

E?
i

)
zi(k) (2.44)

yi(k) =?
L
i u

L
i (k) + ?

E
i u

E
i (k) + ?in,i?jwin,i?j(k) (2.45)

Ei,??i+Ei,zzi(k) ? E
E
i,uu

E
i (k) + Ei,0. (2.46)

Considering the interconnections among hubs, generic intercon-
necting variables between hub i and its neighbor j can be defined as
seen in figure 5.19, where win,i?j(k) and wout,i?j(k) are, respectively,
generic interconnecting input and output vectors of hub i related to its
neighboring hub j, with:

Figure 2.6: Interconnection variables between hub i and j

wout,i?j(k) = ?out,i?jyi(k) (2.47)

where ?out,i?j is the output interconnecting matrix referred to the cou-
pling of hub i with respect to its neighbor j. The ”‘?”’ indicates the
power flow direction between the hub i and the hub j. Also, win,i?j(k)
and wout,i?j(k) are defined as vectors containing, respectively, all inter-
connecting inputs and outputs of hub i with respect to its neighboring
hub set Ni = 1, . . . , nNi. Also, interconnecting constraints have to be
introduced, as the interconnecting inputs of hub i with respect to hub
j must be equal to the interconnecting outputs of hub j with respect
to hub i, which results in the following equalities:

win,i?j(k) = wout,j?i(k) (2.48)

wout,i?j(k) = win,j?i(k) (2.49)



24 2. Energy Hubs Modeling Framework

Taking into account the interconnections among hubs described
above, a generic hub i, part of network N, can then be described by
the set of matrices Hi = ?i, ?i, ?in,i?j, ?out,i?j.

2.4 Final Remarks

In this chapter a literature review about energy hubs modeling
theory and its representation by MLD equations was presented, which
is a important tool to model microgrids. In the chapter 3 a review on
model predictive control applied to hybrid systems will be presented
where the models developed here will be considered.



Chapter 3

Model Predictive
Control (MPC)

This chapter presents some concepts of model predictive control
(MPC). First the state space MPC algorithm is revisited and some
basic characteristics are broached. Then the idea of distributed MPC
is discussed and the Lagrange based DMPC algorithm is presented.
Finally a framework to Hybrid distributed MPC is proposed and a
convergence analysis is performed.

3.1 State Space MPC

MPC has emerged in the last two decades as a powerful practi-
cal control technique. It is one of the few advanced control techniques
that have achieved significant impact on industrial process control. The
main reason for this success is, perhaps, the ability of MPC to deal with
the following situations: the possibility to be applied in SISO (single
input single output) and MIMO (multiple inputs multiple outputs) sys-
tems, feedback and feedforward actions can be included directly in the
MPC formulation, soft and hard constraints can be included in the
formulation of the control law through online optimization and the in-
trinsic compensation of process dead times [84].

MPC is not a specific control strategy, but is the name given to a
very large set of control methods that have been developed considering
some common ideas and based on the concept of prediction. Figure 3.1
shows the MPC general structure. From the past values of process in-



26 3. Model Predictive Control (MPC)

put and output, future predictions can be calculated using a prediction
model. The prediction model is the most important controller element,
once it must be able to represent the process dynamics. In the linear
case, the process output prediction can be separated into two parts:
the free response that corresponds to the output prediction when only
past values of the input are considered and the future control is con-
stant and, the forced response that is obtained assuming null values for
the past inputs and variations in the future control action. With the
values of future predictions, future reference, process constraints and
objective function, an optimization module computes the control signal
to be applied to the process in the next step. Generally the purpose
of the objective function is to minimize the error between the output
prediction and the desired reference penalizing control effort [17]. The
receding horizon strategy is other important property of the MPC, as
only the first element of the obtained control vector is applied to the
plant and the procedure is repeated on the next sample.

Figure 3.1: MPC block diagram.

All MPC algorithms have some elements in common, being: the
prediction model, the objective function and a method for obtaining the
control law. Different controllers in the literature differ in the way in
which these elements are found [17]. Hereafter some of these concepts
are presented.

3.1.1 Prediction Model

The prediction model is composed of the process and disturbance
dynamics and is the most important element in predictive control al-
gorithms. As MPC bases its control law computation in the prediction
model, all the advantages of predictive control may be lost if the model
is not faithful to the process dynamics. Linear models are more common
in practice and can be input-output (impulse response, step response
and transfer function) or based on state space variables, as the one used
in this thesis.



3.1. State Space MPC 27

The main theoretical results of MPC related to stability come
from a state-space formulation, which can be used for both monovari-
able and multivariable processes and can easily be extended to nonlin-
ear processes [17]. Consider a process with nx states, nu inputs and ny
outputs is described by the following state space equations:

x(k + 1) = Ax(k) + B?u(k)

y(k) = Cx(k) + D?u(k) (3.1)

where A, B, C, D are matrices with order nx × nx, nx × nu, ny × nx,
ny × nu; x is the state vector, u the input vector and y the output
vector. In this model k represents the discrete time (the sampling time
is not written explicitly for simplicity).

The future predicted values of process state and output can be
calculated recursively until k + j according to:

x?(k + j|k) = A
j
x(k) +

j?1
?

i=0

A
j?i?1

B?u(k + i) (3.2)

y?(k + j|k) = CA
j
x(k) +

j?1
?

i=0

CA
j?i?1

B?u(k + i) + D?u(k + j) (3.3)

Considering a prediction horizon of Np and a control horizon of
Nc ? Np, the future state and output predictions are given by:

?

?
?
?
?

x?(k + 1|k)
x?(k + 2|k)

...
x?(k + Np|k)

?

?
?
?
?

? ?? ?

x?

=

?

?
?
?
?

A
A2

...
ANp

?

?
?
?
?

? ?? ?

A

x(k)+

?

?
?
?
?

B 0 · · · 0
AB B · · · 0
...

...
...

...

ANp?1B ANp?2B · · ·
?Np?Nc

i=0 A
iB

?

?
?
?
?

? ?? ?

B

?

?
?
?
?

?u(k)
?u(k + 1)

...
?u(k + Np ?1)

?

?
?
?
?

? ?? ?

u

(3.4)



28 3. Model Predictive Control (MPC)

?

?
?
?
?

y?(k + 1|k)
y?(k + 2|k)

...
y?(k + Np|k)

?

?
?
?
?

? ?? ?

y?

=

?

?
?
?
?

CA
CA2

...
CANp

?

?
?
?
?

? ?? ?

C

x(k)+

?

?
?
?
?

CB D · · · 0
CAB CB · · · D

...
...

...
...

CANp?1B CANp?2B · · ·
?Np?Nc

i=0 CA
iB

?

?
?
?
?

? ?? ?

D

?

?
?
?
?

?u(k)
?u(k + 1)

...
?u(k + Np ?1)

?

?
?
?
?

? ?? ?

u

(3.5)

or in a condensed form:

x? = Ax(k) + Bu (3.6)

y? = Cx(k) + Du (3.7)

It should be emphasized that the prediction computation depends
on the state vector measurement. As in many cases is not possible to
obtain these variables directly, a state observer based on Kalman Filter
can be used [17].

3.1.2 Objective Function

The various MPC algorithms use different cost functions for com-
puting the control law. The most common objective is to minimize the
error between the future output y and desired reference w penalizing
the control increment ?u. The standard expression for this objective
function is:

J =

Np
?

l=N1

?y?(k + l|k)??(k + l)?
2
Q
+

Nc?

l=1

??u?(k + l ?1)?
2
R

(3.8)

where N1 e Np are the minimum and maximum prediction horizons
while Nc is the control horizon. In this work the same horizons for



3.1. State Space MPC 29

all inputs and outputs was used. These indexes define the limits in
which it is desirable for the output to follow the reference and when it
is important to limit the control action. These horizons may be used
to compensate transmission delays and non-minimum phase. Chang-
ing Nc is possible to adjust the time instants where control action is
penalized. Q and R are real matrices used to weight error and control
effort.

In some systems it is possible to know future values of the refer-
ence. For these systems MPC may use this data to compute the control
law and allow the system to achieve quickly the new desired value. The
reference vector ?(k + l) used in the objective function does not neces-
sarily coincide with the current reference system. Typically, in practical
applications, strategies are used to soften the reference changes, similar
to the filters used in classical two-degree-of-freedom control structures.

In practice all processes are subject to constraints. The actuators
have a limited field of action and a determined slew rate. Constructive
reasons, safety or environmental ones can cause limits in the process
variables as states and outputs. The operational conditions are nor-
mally defined by the intersection of certain constraints, so that the
control system will operate close to the boundaries. The controller
must anticipate and correct these violations so they do not happen,
preventing the system being unstable. In this context MPC controllers
are effective, since they have the ability to predict possible violations
over the prediction horizon including constraints on the optimization
problem [17].

Generally, bounds in the amplitude and in the slew rate of the
control signal and limits in states and outputs are considered [120].
The solution of the constrained MPC is carried out by minimizing the
cost function through quadratic programming (QP) algorithms. These
algorithms solve problems like:



30 3. Model Predictive Control (MPC)

min
u

J =

Np
?

l=N1

?y?(t + l|t)??(t + l)?
2
Q
+

Nc?

l=1

??u?(t + l ?1)?
2
R

(3.9)

Subject to :

x(k + 1) = Ax(k) + Bu?(k)

y?(k) = Cx(k) + Du?(k)

u ? u?(k + l ?1) ? u

?u ? u?(k + l)? u?(k + l ?1) ? ?u

x ? x?(k + l) ? x

y ? y?(k + l) ? y

x(k) = x?(k)

where, hat (a?) over variables is used to denote variables over the pre-
diction horizon, a and a? denote minimum and maximum allowed values
respectively, and a? refers to variables whose values are supposed to be
known, for example, initial conditions.

3.1.3 Obtaining the Control Law

To compute the control action the following steps are executed:

1. update the initial conditions x?(k);

2. compute y?(k + l) as a function of future control actions;

3. substitute y? and w in the objective function J;

4. minimize J considering the system dynamics and constraints.

The result is a sequence of control actions that should be applied
to the system. It is important to emphasize the concept of receding
horizon control, i.e., despite the solution of objective function results
in an array of control actions through the horizon, only the first control
action will be applied and all control actions will be recalculated in the
next step according to new information from the real system.



3.2. Distributed MPC 31

3.2 Distributed MPC

Large scale networks, like power distribution networks, traffic and
transportation systems, water distribution networks, logistic operations
networks etc., are the pillars of our modern society. Networks of this
type are typically spread in a large geographical area, present a modular
structure consisting of many subsystems, have many actuators and sen-
sors and in some cases the dynamics evolves over different time scales
[78].

In complex or geographically-spread systems, such as large-scale
networks, the distribution of the control effort among local control
agents can be a very convenient choice. Also, for most networks, the
main obstacle to the centralized control is not only technical, but com-
mercial and/or organizational. Typically, technical issues arise from
communication delays and too high computational requirements. Com-
mercial issues include unavailability of information from one network
operator to another, restricted control access, and costs of sensors. In
many cases, parts of the network belong to different organizations,
which makes centralized control impossible to implement. Also, ro-
bustness and reliability of the network cannot be guaranteed when a
single centralized control agent breaks down [29].

In order to distribute the control effort, the network may suit-
ably be divided into exactly defined subsystems, in order to reduce the
dynamic coupling. Once partitioned, the overall control objective can
be distributed between local control agents, depending on the control
structure and the selected communication protocol. This distributed
approach results in multi-agent control structures.

The modular nature simplifies the system maintenance, allows
expansions of the control system and provides robustness in compari-
son with a centralized controller [71]. On the other hand, distributed
controllers present lower performance in comparison with a centralized
controller, that depends on the degree of interaction between the local
subsystems and the coordination mechanisms between the agents [71].

In the last years many distributed control techniques were pro-
posed in literature ([71], [72], [79], [1], [18], [100], [20]). In [29] many
distributed network control structures described in literature ([118],
[100], [67], [82]) were compared. From this assessment, the MPC con-
trol structure based on Lagrange multipliers (Lag-MPC), presented in
([78],[32]), appears as a suitable solution for the network control prob-
lem providing stability and optimality guaranties and good convergence
rate. Hereafter the Lag-MPC structure, that will be applied in chapter



32 3. Model Predictive Control (MPC)

5 to the problem of networked microgrids, is presented in detail.

3.2.1 Control Problem

According [78], in a distributed control structure, the control ef-
fort is shared by several agents and each agent solves the control prob-
lem of its respective sub-network. Considering a generic network com-
posed of a set N = 1, . . . , nN of interconnected sub-networks, and
assuming one control agent for each sub-network i, the general network
control problem can be seen as a union of local control problems:

min
?nN

i=1
Jlocal,i (x?i(k + 1), u?i(k), y?i(k))

x?1(k + 1) . . . x?nN (k + 1)
u?1(k) . . . u?nN (k)
y?1(k) . . . y?nN (k)

(3.10)

subject to local dynamics:

xi(k + 1) =Aixi(k) + Biui(k) + Bqiqi(k) + ?in1,i?jwin,i?j(k) (3.11)

yi(k) =Cixi(k) + Diui(k) + Dqiqi(k) + ?in2,i?jwin,i?j(k) (3.12)

wout,i?j(k) = ?out,i?jyi(k) (3.13)

the process constraints:

xi ? x?i(k + l + 1) ? xi (3.14)

ui ? u?i(k + l) ? ui (3.15)

y
i
? y?i(k + l) ? yi (3.16)

xi(k) = x?i(k) (3.17)

and the interconnecting constraints

win,i?j(k) = wout,j?i(k) (3.18)

wout,i?j(k) = win,j?i(k) (3.19)

where the sub-index j denotes the neighbor networks.
A typical choice for the local objective function is [78]:

Jlocal,i (x?i(k + 1), u?i(k), y?i(k)) = (3.20)

Np?1
?

l=0

?

?

x?i(k + l + 1)
u?i(k + l)
y?i(k + l)

?

?

T

Qi

?

?

x?i(k + l + 1)
u?i(k + l)
y?i(k + l)

?

? + f
T
i

?

?

x?i(k + l + 1)
u?i(k + l)
y?i(k + l)

?

?

where Qi is a positive definite weighting matrices and fi is a weighting



3.2. Distributed MPC 33

vector.

3.2.2 Information Exchange

As the use of a multi-agent control structure implies the informa-
tion exchange between agents, it is important to analyse and choose the
best way of how these agents communicate. According to [80],[81] an
agent can use different schemes for communication and decision mak-
ing:

• synchronous/asynchronous;

• iterative/non-iterative;

• serial/parallel.

In a synchronous communication scheme each agent has to wait
for the rest until all of them have finished the current stage calculations.
On the other hand, in asynchronous communication each agent runs
at its own speed, sending and receiving information and determining
what actions should be performed at any time. This mode is potentially
faster than synchronous one but the price to pay is the uncertainty of
the information updated from neighbouring agents.

Non-iterative communication protocols need smaller amount of
information exchange and are potentially faster than iterative schemes,
since the time required to take a decision is smaller and only one it-
eration is performed. However, iterative communication schemes can
potentially achieve solutions closer to the ideal. As the information
exchange is carried out during the solution of local control problems, it
is possible to satisfy the interconnection constraints.

In parallel communication schemes all agents perform the calcu-
lating step at the same time, unlike the serial schemes in which there
is only one agent, per time step, solving its local control problem. Par-
allel schemes are potentially faster than serial schemes, but the serial
schemes ensure that agents receive the most updated information from
its neighbours.

Synchronous communication have been widely studied in litera-
ture, such as synchronous non-iterative parallel schemes ([34], [60], [65])
and both serial and parallel synchronous iterative schemes ([18], [50],
[61], [78]). The multi-agent control structure discussed in this thesis
uses synchronous iterative parallel communication, which is the most
developed and utilized communication scheme in literature to solve
large-scale networked control problems.



34 3. Model Predictive Control (MPC)

3.2.3 Lagrange MPC

The Augmented Lagrange MPC used in this thesis was developed
in [78]. In MPC control structure based on Lagrange multipliers, the
general control problem presented in (3.10) and (3.20) is divided into
sub-problems and assigned to local control agents [78]. These agents
use an augmented Lagrangian formulation to solve the general control
problem. This methodology was first presented in [57] and [94] and
later new analytical convergence tests were provided in [8]. In a control
scheme based on augmented Lagrange formulation each control agent
includes terms related to the interconnection constraints in its objective
function. As described in [78] and [80], the set of local solutions ob-
tained through an iterative process at each sampling period k is equiv-
alent to the optimal solution calculated in a centralized way. Following
is presented the Augmented Lagrange MPC formulation proposed by
[78] to be implemented with a parallel communication protocol.

In order to divide the general network problem into local sub-
problems, the interconnecting constraints in (3.18), for all control agents
i = 1, . . . , nN, are removed from the set of constraints and added to the
objective function in such a way that the following augmented Lagrange
function is obtained:

Jaug
(

x?(k + 1), u?(k), y?(k), w?in(k), w?out(k), ??in(k)
)

=

nN?

i=1

[

Jlocal,i (x?i(k + 1), u?i(k), y?i(k))

+
?

j?Ni

(
??in,i,j(k)

T
(w?in,i?j(k) ? w?out,j?i(k))

+
?c
2
?w?in,i?j(k) ? w?out,j?i(k)?

2
2

)]

(3.21)

with

w?in(k) =
[
w?in,1(k)

T , . . . , w?in,nN (k)
T
]T

w?out(k) =
[
w?out,1(k)

T , . . . , w?out,nN (k)
T
]T

??in(k) =
[

??in,1(k)
T , . . . , ??in,nN (k)

T
]T

,

where ?c is a positive constant and ??in,i(k) are the Lagrange multipli-
ers associated with the interconnections of sub-network i ?N with its



3.2. Distributed MPC 35

neighboring sub-networks j ? Ni. Specifically, ??in,i,j(k) are the La-
grange multipliers related to the constraints w?in,i?j(k) = w?out,j?i(k).
Using Jaug and by duality theory, the overall control problem can be
expressed as:

max

??in(k)

?

?

?

min
x?(k + 1), u?(k), y?(k),
w?in(k), w?out(k)

Jaug

?

?

x?(k + 1), u?(k),
y?(k), w?in(k),

w?out(k), ??in(k)

?

?

?

?

?
(3.22)

subject to sub-network dynamics, constraints and initial conditions.
The optimal solution to problem (3.22) for every instant k is found

iteratively by minimizing the objective function with fixed Lagrange
multipliers and then updating Lagrange multipliers using the values
obtained after the minimization procedure [78]. The ideal solution is
found when the Lagrange multipliers converge to new values through
an iteration procedure.

This solution is equivalent to the optimal solution of the central-
ized problem, under assumptions of objective functions convexity and
sub-network models affinity [81]. Since these assumptions are satisfied
by the objective functions Jlocal,i for all i ?N and by the sub-network
model, both solutions to (3.10) and (3.22) coincide.

Finally, the problem (3.22) must be divided into sub-problems in
order to assign them to each of the local control agents. Such a di-
vision cannot be directly done due to the presence of quadratic terms
in the formulation. In order to approximate the aforementioned non-
quadratic terms, the auxiliary problem principle ([6], [66], [98]) was
utilized, whose implementation requires a parallel iterative process to
be done each time step k, where all the agents perform their local opti-
mization problems at the same time and share between them the results
of their computations. This way, the local problem can be written as
follows:

min Jlocal,i (x?i(k + 1), u?i(k), y?i(k)) +
x?i(k + 1), u?i(k), y?i(k), Jinter,i (w?in,i(k), w?out,i(k))
w?in,i(k), w?out,i(k)

(3.23)

where Jlocal,i is the local objective function defined in (3.20) and Jinter,i



36 3. Model Predictive Control (MPC)

is the following interconnection function:

Jinter,i(w?pin,i(k),w?
p
out,i

(k))=

?

?

??
p

in,i?j(k)

??
p

out,i?j(k)

?

?

T
?

?

w?
p
in,i?j

(k)

w?
p
out,i?j

(k)

?

? (3.24)

+
?c
2

?

?

?

?

?

?

?

?

w?
p?1
in,j?i

(k)?w?
p
out,i?j

(k)

w?
p?1
out,j?i

(k)?w?
p
in,i?j

(k)

?

?

?

?

?

?

?

?

2

2

+
?b??c

2

?

?

?

?

?

?

?

?

w?
p
in,i?j

(k)?w?
p?1
in,i?j

(k)

w?
p
out,i?j

(k)?w?
p?1
out,i?j

(k)

?

?

?

?

?

?

?

?

2

2

where ?c and ?b are positive constants, w?
p?1
in,i?j(k) and w?

p?1
out,i?j(k)

are the own information set of the previous iteration, w?
p?1
in,j?i(k) and

w?
p?1
out,j?i(k) are the information set collected from the neighbouring

agent j ? Ni at the previous iteration, the superscript p represents the

actual iteration at the time instant k and ??
p

in,i?j(k) and ??
p

out,i?j(k)
are the Lagrange multipliers.

At each time step k, each local agent must perform the iterative
algorithm described below with parallel communication. One of the
main drawbacks of Lagrangian methods is the slow convergence [71].
The algorithm convergence speed can be improved through the so-called
warm start by initializing the interconnecting inputs and the Lagrange
multipliers every step to the values obtained from previous decision
step rather than initializing these values arbitrarily. The algorithm is
implemented according to the following steps:

1. Make a measurement of current state x?i(k)

2. Compute the optimal control sequence u??i (k). To do so, perform
the following steps:

(a) Parameter initialization:

• for k = 0



3.2. Distributed MPC 37

p = 1

ei ? 1

??
0

in,i?j(k) = 0

??
0

out,i?j(k) = 0

w?
0
in,i?j(k) = 0

w?
0
out,i?j(k) = 0

w?
0
in,j?i(k) = 0

w?
0
out,j?i(k) = 0

• for k &gt; 0 use warm start

??
0

in,i?j(k) = ??
p

in,i?j(k ?1)

??
0

out,i?j(k) = ??
p

out,i?j(k ?1)

w?
0
in,i?j(k) = w?

p
in,i?j(k ?1)

w?
0
out,i?j(k) = w?

p
out,i?j(k ?1)

w?
0
in,j?i(k) = w?

p
in,j?i(k ?1)

w?
0
out,j?i(k) = w?

p
out,j?i(k ?1)

p = 1

ei ? 1

for all i ?N .

(b) Solve the optimization problem in equation (3.23), subject
to local dynamics and constraints.

(c) Send w?
p
in,i?j(k) and w?

p
out,i?j(k) to neighbouring agents j ?

Ni and collect w?
0
in,j?i(k) and w?

p
out,j?i(k) from them.

(d) Upgrade the multipliers:

??
p+1
in,i?j(k)=??

p

in,i?j(k)+?c(w?
p
in,i?j

(k)?w?
p
out,j?i

(k)) (3.25)

??
p+1
out,i?j(k)=??

p

out,i?j(k)+?c(w?
p
out,i?j

(k)?w?
p
in,j?i

(k)) (3.26)



38 3. Model Predictive Control (MPC)

(e) Evaluate the stopping conditions:

p &gt; p? (3.27)

ei =
?
?
???

p+1

in,i?j(k)? ??
p

in,i?j(k)
?
?
? ? e? (3.28)

where p? is the maximum number of iterations allowed and e?
is the maximum error allowed. If both conditions are false,
move on to next iteration p ? p + 1 and go to step 2b.
If (3.27) is true, go to step 3. If (3.28) is true, set agent
i termination flag flagi(k) = 1. If all neighboring agents
j ? Ni termination flags are equal to 1, go to step 3. If not,
move on to next iteration and go to step 2b [78].

3. Implement the optimal control action u??i (k).

4. Start a new control cycle k ? k + 1 and go to step 1.

Selecting ?b ? 2?c and ? sufficiently small, and due to the fact
that the overall control problem is a convex space, the iterative algo-
rithm described above converges to the minimum of the overall network
problem.

The positive scalar ?c penalizes the deviation from the intercon-
necting variable iterates that were computed during the last itera-
tion. As additional parameter this scheme uses a positive scalar ?b.
If ?b ? ?c, then the term penalizes the deviation between the inter-
connecting variables of the current iteration and the interconnecting
variables of the last iteration of agent i; it thus gives the agent less
incentive to change its interconnecting variables from one iteration to
the next. When ?b ? 2?c and ?, and moreover the overall combined
problem is convex, it can be proved that the iterations converge toward
the overall minimum for sufficiently small e? ([9], [66]).

3.3 Final Remarks

In this chapter a literature review about centralized and dis-
tributed MPC was presented. In the chapter 4 will be presented a
DMPC algorithm for hybrid systems.



Chapter 4

Hybrid Distributed
MPC

This chapter presents one of the contributions of this thesis. Hy-
brid systems are a class of dynamical systems whose evolution depends
on a coupling between continuous and binary variables. This kind of
systems has many applications, for example, in energy management
([31], [82], [12], [75]), in hydrogen production ([103]), in supermarket
applications ([99], [107]), in electric vehicles charging ([52]), in process
control ([27], [95], [21]) and in traffic light control ([102]).

In [7] a proposal was carried out to generalize MPC to hybrid
systems based on Mixed Logical Dynamical (MLD) modeling frame-
work. The solution of the hybrid MPC can be rewritten as a sequence
of optimization problems defined as Mixed Integer Quadratic Program-
ming (MIQP), which is computationally complex. The most common
methods to solve MIQP problems are cutting-plane methods, decompo-
sition methods, logic-based methods, and branch and bound methods.
Several authors report that branch and bound is the most successful
method for mixed integer programs [7]. A commonly used commercial
software is the solver CPLEX [58].

There are in literature other algorithms to deal with the presence
of binary variables. In [102] and [116], the authors use a technique
called TIO-MPC (Time Instant Optimization - MPC), where time in-
stants are introduced as control inputs in place of binary variables. The
time instants when the changes of the structure state should occur are
optimized for a selected number of changes, resulting in a real-valued
programming problem. In [99] and [27], a technique is presented that



40 4. Hybrid Distributed MPC

defines two new continuous manipulated variables for each binary ma-
nipulated variable, which corresponds to the duration of the activa-
tion/deactivation of the binary variables on the prediction horizon. In
this way the original problem is turned into a non-linear optimization
with continuous variables that can be solved using Sequential Quadratic
Programming (SQP). There are some works in literature focused on
distributed MPC to hybrid systems ([56],[13],[40]).

In networked hybrid systems, each subsystem has a certain num-
ber of binary variables that describe its discrete state. Let us assume
that controller i has nbi binary variables, which means that the con-
troller can be configured in 2nbi different ways. Considering that the
system is composed by nN subsystems, from a global point of view, this
implies that there are

?nN
i=1 2

nbi configurations for the binary variables
in the system. There are two combinatorial explosions here. One is due
to the local binary variables. Another is due to the joint action of the
local controllers. All together may make the computation intractable
even for systems with a low number of controllers.

In this section an approach is proposed to deal with both com-
binatorial explosions. First an algorithm is presented to deal with the
binary variables of the local controllers. The basic idea is to provide
an easy way to solve this kind of problem without a MIQP solver. The
proposed technique first decides about the values of the binary vari-
ables for each local controller and transforms the optimization problem
into a set of quadratic programs (QP). A finite set of instances of each
controller is created with the possible solutions.

To overcome the limitations imposed by the second combinatorial
explosion, the one derived from the joint action of the controllers, it is
assumed that a set of feasible combinations of binary decision variables
exists. From a distributed optimization perspective, we have a problem
where a set of agents must agree on the value of a set of continuous in-
terconnection variables and the binary variables are computed by each
local agent. In this work, we propose to improve the efficiency of this
approach by iterating and checking which are the instances with the
lowest performance. These instances are penalized at the next iteration
step so that their impact in the cost function is reduced. Likewise, the
instances with the best cost are rewarded with a higher weight in the
overall optimization. Eventually, some of the instances are dismissed,
e.g., when their weight is below a certain threshold or simply 0. This
procedure is repeated until there is only one instance left in each in-
stance set or after a certain number of iterations has been achieved.
In this last case the instance with the optimal cost is chosen and its



4.1. Problem setting 41

value is assigned to the binary variables of the subsystem. In this way
a solution for the hybrid DMPC problem can be attained.

4.1 Problem setting

Consider a generic network composed of a set N = 1, 2, . . . , nN
of nN interconnected sub-networks. The dynamics of each sub-network
can be described by the following MLD equations:

x(k+1)=Ax(k)+B1u(k)+B2?(k)+B3z(k)+Dq1q(k)+?in1win,i?j(k) (4.1)

y(k)=Cx(k)+D1u(k)+D2?(k)+D3z(k)+Dq2q(k)+?in2win,i?j(k) (4.2)

wout,i?j(k)=?outy(k) (4.3)

E2?(k)+E3z(k)?E1u(k)+E4x(k)+E5 (4.4)

where x(k) =
[
xc(k) xl(k)

]T
is the state vector with xc(k) ? ?

nc

and xl ? {0, 1}
nl, y(k) =

[
yc(k) yl(k)

]T
is the output vector with

yc(k) ? ?
pc and yl(k) ? {0, 1}

pl, u(k) =
[
uc(k) ul(k)

]T
is the

input vector with uc(k) ? ?
mc and ul(k) ? {0, 1}

ml, q(k) is a distur-
bance vector, win,i?j(k) is a vector of input interconnected variables,
wout,i?j(k) is a vector of output interconnected variables, z(k) ? ?

rc

are the continuous auxiliary variables, ?(k) ? {0, 1}
rl are the binary

auxiliary variables, A, B1, B2, B3, C, D1, D2, D3, Dq1, Dq2, ?in1,
?in1, ?out, E1, E2, E3 and E4 are constant real matrices, E5 is a real
vector, nc &gt; 0 and pc, mc, rc, nl, pl, ml, rl &gt; 0.

In this case, it is assumed that z(k) is defined as a product be-
tween ?(k) and u(k). This product is expressed by the mixed-integer
linear inequalities in (4.4), by using propositional logic, as explained in
chapter 2. The local objective function and constraints are the same
as the ones defined in (3.20) and (3.14).

4.2 Hybrid DMPC Framework

The optimization problem formulated previously includes binary
and continuous manipulated variables that characterize a mixed inte-
ger optimization. In this section a framework to deal with this kind
of problems in a distributed fashion will be presented. The proposed
algorithm is one of the contributions of this thesis. The main idea is
to determine a set of possible solutions for the binary variables and
create controller instances related to these solutions. These instances



42 4. Hybrid Distributed MPC

are tested by a competitive rule in an iterative procedure until the best
solution is found.

4.2.1 Binary Search Algorithm

For each physical binary condition in a subsystem there are Np
variables related to the prediction horizon. Taking into account that in
a subsystem i there exist nbi physical binary conditions, the total num-
ber of binary variables in the optimization problem is nbi ×Np, which
results in 2nbi×Np possible instances of the local controller. In practice,
this number can be reduced using some heuristics. For example it could
be assumed that the configuration should not change drastically from
one time instant to another, or that there are no changes in the value
of the binary variables after a few steps in the horizon. Another way
to deal with binary variables is performing a binary search over the
prediction horizon. The controller instances are defined considering all
possible combinations of the binary variables of the first two elements of
the horizon and assuming the remaining control actions to be constant
and equal to the second instant.

Thus,

? = ?fix (4.5)

z = ?fix ×u (4.6)

where ?fix is a matrix with fixed values for all binary variables. This
procedure transforms the original optimization problem into a QP as
the binary variables are known.

After solving the QP problems for the controller instances, a per-
formance index, for example the objective function cost, is analyzed.
The instance that provides the best performance index is fixed for the
first horizon instant and the next two time instants are tested. This
procedure is repeated until the end of the prediction horizon or can be
truncated in a certain instant called binary decision horizon Nb, which
should be lower or equal than the prediction horizon.

A previous simulation study to investigate the algorithm behavior
for different values of Nb is recommended. According to the parsimony
principle the best choice is one that provides a good compromise be-
tween the number of iterations, the calculation time, the number of
changes through the prediction horizon for binary variables, and the
performance. Depending on the nature of the application, this algo-
rithm can be applied to all binary variables together or independently,



4.2. Hybrid DMPC Framework 43

and leads a set of 4×Nb or 4×Ni×Nb controller instances respectively.
Algorithm 1 shows, the implementation used to solve the optimization
problem with all binary variables together.

Algorithm 1 Binary Search Algorithm

Input: Nb
Output: CI,FCI,FIX

Initialization :
FIX = [];
LOOP Process

2: for i = 1 to Nb do
if i = 1 {First instant} then

4: Define ?fix =

?

?
?
?

0 0{1×Np?1}
0 1{1×Np?1}
1 0{1×Np?1}
1 1{1×Np?1}

?

?
?
?

else

6: Define ?fix =

?

?
?
?

FIX 0 0{1×Np?i}
FIX 0 1{1×Np?i}
FIX 1 0{1×Np?i}
FIX 1 1{1×Np?i}

?

?
?
?

end if
8: for j = 1 to 4 do

Solve the optimization problem for ?fix{j,1...Np}
10: Compute the objective function cost Cj

Compute the controller instance CIi,j.
12: end for

Analyze Cj and choose the minimum cost Cmin = min Cj
14: Update FIX with the value of ?fix that corresponds to Cmin

end for
16: With all values of ?fix defined, compute the Final Controller In-

stance (FCI).

4.2.2 Distributed Coordination

In this sub-section an algorithm for the coordination of a set of
local controllers with continuous and binary decision variables is pre-
sented. In particular, the binary decision variables at each local con-
troller are relaxed from the original MIQP problem by considering an
instance of the controller for each feasible combination of them. The



44 4. Hybrid Distributed MPC

number of initial controller instances can be reduced by using the al-
gorithm presented in subsection 4.2.1. Then, a standard distributed
control problem in which a set of agents must agree on the value of
continuous decision variables is used iteratively.

At each iteration, the instances with lowest expected performance
are penalized and those with the best expected performance are re-
warded by modifying their corresponding weights in the overall opti-
mization problem. Eventually, instances leading to the worst perfor-
mance are dropped at each local controller. A way to determine which
instances will be dropped is to compute a cutoff index that consists
in the middle point between the minimum and the maximum costs ob-
tained by all active instances in current iteration. The process continues
until there is only one instance at each local controller. The value of
the binary variables of the corresponding instance is then implemented
in the system. This procedure is applied at each sampling period. One
important characteristic of the proposed methodology is that during
the iterations the computational effort decreases proportionally to the
decreasing of possible instances, on the other hand, this algorithm does
not guarantee the solution optimality. These steps are formalized in
Algorithm 2.

Algorithm 2 Distributed Coordination Algorithm

Input: iteration
Output: BCI

if iteration = 1 {First iteration} then
2: Solve the optimization problem using the binary search algorithm

Save the initial set of controller instances SCI
4: else

Compute the cost vector C with all active controller instances in
SCI

6: Determine the minimum Cmin and maximum Cmax costs of C
Compute cutoff index I = 0.5Cmin + 0.5Cmax

8: Deactivate the instances in SCI with higher costs than the cutoff
index
Apply the instance with best cost BCI

10: Repeat this procedure until the convergence of the distributed
algorithm

end if



4.2. Hybrid DMPC Framework 45

4.2.3 Algorithm Convergence

In order to investigate the convergence and optimality properties
of the proposed algorithm, a simulation analysis was performed. The
system under study is a generic network composed by two identical
sub-networks containing one binary variable. The sub-networks are
interconnected through two interconnection variables, and represented
by equations (4.1 - 4.4) with the following matrices:

u =
[
u1 u2 wout,i?j win,i?j ? z

]T

A = 1 Dq1 = Dq2 = C = 0 ?out =

[
0
1

]

B =

?

?
?
?

B1
?in1
B2
B3

?

?
?
?

T

=
[
0 23.75 0 0 0 ?0.75

]

D =

?

?
?
?

D1
?in2
D2
D3

?

?
?
?

T

=

[
1 ?1 ?1 1 0 0
0 0 1 0 0 0

]

Each local controller uses the following objective function:

Jlocal =
?Np?1

l=0 u?(k + l)
T Qu?(k + l)

+
?Np?1

l=0 (x?(k + l)? x?ref (k + l))
T
Qx (x?(k + l)? x?ref (k + l))

+
?Np?1

l=0 (u?(k + l)?u)
T
Qe (u?(k + l)?u) (4.7)

subject to local dynamics (4.1) and (4.4) and following constraints:

x ? x?(k + l + 1) ? x (4.8)

u ? u?(k + l) ? u (4.9)

y?(k + l) = ydem(k) (4.10)

x(k) = x?(k) (4.11)

for l = 0, . . . , Np ? 1, where Q, Qx, Qe are positive definite weight-
ing matrices, and Np is the prediction horizon. With respect to the
notation, hat (a?) over variables is used to denote variables over the
prediction horizon, a and a? denote minimum and maximum allowed



46 4. Hybrid Distributed MPC

values respectively, and a? refers to variables whose values are supposed
to be known, for example, the initial conditions.

A simulation with 24 steps was performed using the software Mat-
lab [74] with Yalmip toolbox [69] and the solver CPLEX [58]. A pre-
diction horizon of N = 6 was used totalizing 6 binary variables per
sub-network, i.e., 26 possible instances to the local controller, which
results in

?2
i=1 2

6 configurations for the binary variables in the global
optimization problem.

First, the differences between the use of binary search algorithm
(BS) and binary search with distributed coordination (BSDC) are in-
vestigated. A simulation analysis to determine the influence of Nb,
testing Nb = 1 until Nb = 6 was performed. Figure 4.1 shows the num-
ber of iterations for each time instant and the calculation time for each
Nb. The number of iterations varies between 206 and 207 for BS and
213 and 217 for BSDC, and the calculation time increases with Nb. The
BSDC provides the solution with less time than BS for all values of Nb,
which may be explained by the exclusion of instances that do not have
good performance during the iteration procedure. This way the num-
ber of optimization problems tested at each iteration is reduced. Both
algorithms presented similar dynamical behavior for all values of Nb,
as can be seen in Figure 4.2. In this case, Nb = 1 was chosen because
it provided the best compromise between the number of iterations and
the calculation time.

Table 4.1 presents a comparison between the BS, the BSDC (both
using Nb = 1), the centralized MIQP (CMIQP) solved by the CPLEX
branch and bound solver and the all instances possible combinations
(COMB). As expected, the computation time expended by BSDC was
smaller than BS and COMB, and closer to CMIPQ. Assuming that the
CMIPQ is the best solution that can be computed, the total and the
average costs can be used to compare the algorithms with respect to the
distance from the optimum. All algorithms presented similar costs, but
BS obtained the closest solution while BSDC obtained the farthest.
It is possible that, for one specific time instant, the exclusion of the
worst performance instances performed by BSDC can miss untimely an
instance that can probably be the best at the end of iteration procedure
when compared to BS. In despite of the proposed Hybrid DMPC being
a suboptimal algorithm, the reduction in calculation time provided by
BSDC can be useful in applications with a great number of binary
variables.



4.3. Final Remarks 47

(a) Binary Search

(b) Binary Search with Distributed Coordination

Figure 4.1: Number of iterations and calculation time varying Nb.

4.3 Final Remarks

In this chapter an hybrid DMPC framework was presented as
a contribution of this thesis and a discussion about convergence and
optimality was performed. In the chapter 5 these algorithms will be
applied to a microgrid energy management.



48 4. Hybrid Distributed MPC

Figure 4.2: Input, output and state variables. (blue - u1, red - y, black -
u2, magenta - wout)

Table 4.1: Performance Indexes

BS BSDC CMIQP COMB

Total Iterations 206 213 ? 207
Total time (s) 35.44 14.85 3.23 2266.9
Average time (s) 1.48 0.62 0.14 94.45
Total cost 402.99 405.25 402.82 403.22
Average cost 16.79 16.88 16.78 16.80



Chapter 5

Microgrid Control

This chapter presents some concepts of microgrid control. First
the different control levels are discussed. Then a two level MPC algo-
rithm is applied to a laboratory microgrid, and different weather con-
ditions are tested. Finally the problem of optimization of networked
microgrids is discussed and a Hybrid distributed MPC is applied.

5.1 Energy Management in Microgrids

A microgrid is a concept which refers to a small-scale power sys-
tem with a cluster of loads and distributed generators operating to-
gether with energy management, control and protection devices and
associated software [111]. A microgrid can be a DC [124], AC or even
a high frequency AC grid [19] and hybrid AC/DC [110].

Microgrids are planned to operate in grid-connected and/or is-
landed mode. For each operating mode operational requirements are
different and distinct control schemes are required [111]. In grid-connected
scenario, the microgrid sells/purchases energy with the Distribution
Network Operator (DNO), which usually produces energy from fossil
energy sources. Minimize the amount of energy purchased from DNO is
an important goal to reduce greenhouse gas emissions and promote sus-
tainable consumption practices. An interesting alternative is to connect
neighboring microgrids in a network so to cooperate each other [87].

A crucial issue in microgrid operation is the use of energy storage,
that allows to compensate imbalances between consumption and gener-
ation and ensure the energy quality. According to ([38]) and ([54]) the
possibility of hybridization among several energy storage technologies is



50 5. Microgrid Control

of great interest. In this chapter, the combination of hydrogen storage
together with electric batteries is used to reduce the energy fluctuation
and store energy in an experimental microgrid.

From the control point of view, many authors ([16], [70], [117],
[10], [86], [90], [89], [110]) agree on the existence of three control lev-
els. The primary level operates on a fast time scale and maintains
the voltage and frequency stability during changes on the generation
or load or after switching to the island mode. This control is imple-
mented locally. The secondary level is responsible for ensuring that the
voltage and frequency deviations are adjusted to zero after a load or
generation change is produced within the microgrid. It is responsible to
eliminate any steady-state error introduced by the primary control and
is also used for synchronization with the DNO during the transition
from island mode to grid connection.

The third level is related to energy management system (EMS)
and is the main topic of this thesis. This tertiary control is used to
control the power flow between the microgrid and the DNO and for the
optimal operation on large time scales. This level may include many
optimization strategies, according to the time scales, and it includes
planning and economic dispatch. For a single microgrid the energy
management is usually done by a microgrid central controller (MGCC).
In case of networked microgrids a good solution is to use an agent-based
distributed EMS.

5.2 Laboratory Microgrid Control

This section presents an economic optimization of a laboratory
microgrid located at the University of Seville (US), Spain. The system
modeling was carried out using the Energy Hubs methodology.

A hierarchical control structure is proposed based on Model Pre-
dictive Control and acting in different time scales, where the first level is
responsible for maintaining the microgrid stability and the second level
has the task of performing the management of electricity purchase and
sale to the power grid, maximize the use of renewable energy sources,
manage the use of energy storage units and perform the charge of the
parked vehicles. Practical experiments were performed with different
weather conditions of solar irradiation and wind.



5.2. Laboratory Microgrid Control 51

5.2.1 V2G Experimental Microgrid

In this work the experiments were carried out at HyLab microgrid
connected to an electric vehicle charging system. This microgrid was
designed to study control strategies applied to energy management of
a network based on renewable energy sources and hydrogen storage
([112], [113], [114]). The facility has special features that allow the
implementation and study of different operating modes and control
strategies. Figure 5.1 shows the outline of the studied system.

Figure 5.1: Hylab microgrid

To replicate renewable energy systems, the microgrid has a pro-
grammable power supply that can emulate the dynamic behavior of a
wind turbine and/or a photovoltaic field. It also includes a battery
bank, an electronic load to emulate different consumption systems and,
finally, includes a hydrogen storage system comprising a PEM (Pro-
ton Exchange Membrane) electrolyzer to produce hydrogen, a metal
hydride tank to store hydrogen and PEM fuel cell to produce energy.
The electric car charging station has the capacity to charge four cars
simultaneously. The charging station was emulated by a hardware-in-
the-loop methodology. The dynamics of the electric vehicle batteries
were simulated by a Simulink model and interfaced with the microgrid
through the programmable power supply and the electronic load. The



52 5. Microgrid Control

technical characteristics of the equipments are summarized in table 5.1.

Table 5.1: Microgrid Units

Equipment Nominal Value

Programmable Power Supply 6kW
Electronic Load 2.5kW
Electrolyzer 0.23Nm3/h at 1kW

Metal Hydride Tank 7Nm3 at 5bar
Fuel Cell 1.5kW at 20Nl

Battery Bank C120 = 367Ah

From the microgrid operation point of view, usually the energy
produced does not match the demand. Then, the excess of energy from
renewable sources can be stored in batteries or used to produce hy-
drogen through electrolysis. The hydrogen produced is stored in the
metal hydride tank. Finally, when power from renewable sources is not
available, the fuel cell uses hydrogen to supplement the lack of demand.
Additionally, the microgrid has a connection to the DNO allowing the
energy purchase and sale. The hybrid storage allows operation strate-
gies on two time scales: the battery can absorb/provide small amounts
of energy on fast transients while hydrogen storage supplements bigger
oscillations. In this sense, when the cars are parked, their batteries
can be used by the microgrid to expand the buffer capacity during fast
transients. The idea of the control system is then to compute the differ-
ent powers PRenewable (the generated renewable energy power), PDNO
(the power exchanged with the DNO), PB (the power of the battery
bank), PH2 (the power of the hydrogen storage) and PBev1, PBev2,
PBev3, PBev4 (the powers of vehicle batteries) in such a way that the
performance of the overall system is optimized.

5.2.2 System Modeling

In this section, the methodology presented in chapter 2 is applied
to the microgrid and electric vehicles charging station modeling. As
the battery bank is considered to have the same charging/discharging
efficiency it is not necessary to define binary variables for it. The bat-
teries of electric vehicles are modeled in the same way as the microgrid
battery bank, however a binary variable ? is added, which is directly
related to the physical connection between the vehicle and the charg-
ing station. This variable provides a change in the prediction model



5.2. Laboratory Microgrid Control 53

without using an hybrid modeling, as the value of ? is informed by
the vehicle connection and is not a decision variable. If the vehicle is
connected ? = 1 and a state related to electric vehicle battery SOC
is enabled in the prediction model; if it is not ? = 0, and the state is
disabled. The final state equation of the electric cars batteries is

x(k + 1) = ?x(k) + ??u(k) (5.1)

To model the hydrogen storage dynamics it is necessary to de-
fine the variable zH2(k) = PH2(k)?H2(k) that is related to charg-
ing/discharging the hydrogen storage. To manage the purchase and sale
of energy to the DNO, different weights for sale and purchase were used.
To make this possible a new variable zDNO(k) = PDNO(k)?DNO(k) was
defined and the corresponding MLD constraints were introduced. Thus,
the complete decision vector (manipulated variables) is:

u=

?

?

?

?

?

?

?

?

u
L

u
E

?

z

?

?

?

?

?

?

?

?

=

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

PRenewable

PDNO

PB

PH2

PBev1

PBev2

PBev3

PBev4

?H2

?DNO

zH2

zDNO

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

(5.2)

The model in equation (2.39) can be rewritten in a condensed
form:

x(k + 1) = Ax(k) + ?u(k) (5.3)

y(k) = ?u(k)



54 5. Microgrid Control

A =

?

?
?
?
?
?
?
?

1 0 0 0 0 0

0 1 0 0 0 0

0 0 ?1 0 0 0

0 0 0 ?2 0 0

0 0 0 0 ?3 0

0 0 0 0 0 ?4

?

?
?
?
?
?
?
?

? =

?

?
?
?
?
?
?
?

0 0 ?1 0 0 0 0 0 0 0 0 0

0 0 0 ?2 0 0 0 0 0 0 ?3 0

0 0 0 0 ?4 0 0 0 0 0 0 0

0 0 0 0 0 ?5 0 0 0 0 0 0

0 0 0 0 0 0 ?6 0 0 0 0 0

0 0 0 0 0 0 0 ?7 0 0 0 0

?

?
?
?
?
?
?
?

?1=?B ?2=?
FC
H2,e

?3=?
E
e,H2
??FCH2,e

?4=?1?Bev1 ?5=?2?Bev2 ?6=?3?Bev3 ?7=?4?Bev4

? =
[
?S
rad,e

1 ?1 ?1 ?1 ?1 ?1 ?1 0 0 0 0
]

where ? is the storage and conversion efficiency, PRenewable is the gen-
erated renewable energy power, PDNO is the power exchanged with the
DNO, PB is the power of the battery bank, PH2 is the power of the
hydrogen storage and PBev1, PBev2, PBev3 and PBev4 are the powers
of vehicle batteries. The states are the battery bank SOC (state of
charge), the MHL (metal hydrid level) of the hydrogen storage and the
SOC of each electric vehicle battery.

5.2.3 Control Algorithm

A two-level hierarchical control structure based on MPC, as shown
in figure 5.2, is proposed. Both controllers were implemented in the
tertiary level and act in different time scales. The MPC1 acts directly
on the microgrid and charging station with a sampling period of one
second (Ts = 1s), and it is responsible for ensuring the constraints,
operation conditions and power flow exchange between the microgrid
elements and the charging station, following the upper level targets.
The MPC2 is designed to achieve the microgrid economic optimization
managing the energy selling and purchasing. This controller uses a
sampling period of five minutes (Ts = 5min). The Charging Station
Management Unit runs at the second level controller and manages the
use of electric vehicles batteries as a storage and guarantees that the
charging constraints (charging type and time) are satisfied. Figure 5.3



5.2. Laboratory Microgrid Control 55

shows the flowchart containing the steps for implementation the two-
level MPC controller.

Figure 5.2: Control Structure

First Controller (MPC1)

The first MPC has the following objective function:

J1 =

Nc?1?

l=0

u?1(k + l)
T
Qu1u?1(k + l)+ (5.4)

Np?1
?

l=0

(x?1(k + l)? x?ref (k + l))
T
Qx1 (x?1(k + l)? x?ref (k + l)) +

Nc?1?

l=0

?u?1(k + l)
T
Q?u1?u?1(k + l)+

Nc?1?

l=0

(u?1(k + l)? u?T arget(k + l))
T
QT arget1 (u?1(k + l)? u?T arget(k + l))

subject to local dynamics (5.3) and the following constraints:



56 5. Microgrid Control

Figure 5.3: Implementation Flowchart

x1 ? x?1(k + l + 1) ? x1 (5.5)

u1 ? u?1(k + l) ? u1 (5.6)

y?1(k + l) = ydem(k) (5.7)

u?1(k + l) = PRenewable = PAvailable (5.8)

u?Target(1, k + l) = u?2(k + l) (5.9)

x1(k) = x?1(k) (5.10)

for l = 0, . . . , Np ? 1, where Qu1, Qx1, Q?u1 e QTarget1 are positive
definite weighting matrices, Np and Nc are the prediction and control
horizon respectively 1. With respect to the notation, hat (a?) over vari-
ables is used to denote variables over the prediction horizon, ai and
a?i denote minimum and maximum allowed values respectively, and a?i
refers to variables whose values are supposed to be known, for example,
initial conditions. In this work we have assumed a bidirectional energy
flow between the hub and the DNO so that the negative threshold is

1The weighting matrices were formulated as: Qµ =

?

?

?

qµ1 · · · 0
.
.
.

...
.
.
.

0 · · · qµnµ

?

?

?
, for

µ = {u1, x1, ?u1, Target1} where nµ is the number of variables µ.



5.2. Laboratory Microgrid Control 57

used.
Matrix Qu1 is adjusted to minimize the use of the DNO and the

storage units. Matrix Qx1 is used to maintain the value of SOC and
MHL next to 50%. Matrix Q?u1 is adjusted to minimize the control
increments in the electrolyzer and fuel cell. Weights of matrix QTarget1
are set to guarantee that the controller will follow the targets sent by
the second MPC.

Second Controller (MPC2)

The second MPC was implemented with the following objective
function:

J2 =

Nc?1?

l=0

u?2(k + l)
T
Qu2u?2(k + l) + f

T
u2u?2(k + l)+ (5.11)

Nc?1?

l=0

(u?2(k + l)? u?ref (k + l))
T
Qe2 (u?(k + l)? u?ref (k + l)) +

Np?1
?

l=0

(x?2(k + l)? x?ref (k + l))
T
Qx2 (x?2(k + l)? x?ref (k + l)) +

(x?2(k + Np) ? x?ref (k + Np))
T
QNp (x?2(k + Np) ? x?ref (k + Np))

subject to local dynamics (5.3) and the following constraints:

x2 ? x?2(k + l + 1) ? x2 (5.12)

u2 ? u?2(k + l) ? u2 (5.13)

y?2(k + l) = ydem(k) (5.14)

x2(k) = x?2(k) (5.15)

The first term of the objective function is used for the manage-
ment of renewable energy sources and purchasing power for the DNO.
The weights Qu2 and fu2 are tuned according to the price of each energy
source. The second term is responsible for ensuring the maximum use
of renewable energy sources in order to minimize the error between the
amount of power available and the amount of energy used. The third
term is responsible for maintaining the load level of storage around
50% of the maximum. This way deviations form this value are allowed
when there is need to store more energy or use the stored energy. This
term is also used to charge the batteries of electric vehicles according



58 5. Microgrid Control

to the charging type, as will be explained below. Finally, the fourth
term relative to the final state weights is introduced to ensure that the
vehicle batteries will be fully charged at the end of the charging time.

Different weights for sale and purchase were used to manage the
purchase and sale of energy to the DNO. The part of the objective
function related to the energy exchanged with the DNO is:

J2 =

Np?1
?

l=0

P?DNO(k + l)
T QsaleP?DNO(k + l)+ (5.16)

z?DNO(k + l)
T (Qpurchase ?Qsale) z?DNO(k + l)+

fsaleP?DNO(k + l) + (fpurchase ?fsale) z?DNO(k + l)

Note that when power P?DNO &gt; 0 we have ?DNO = 1 and z?DNO(k) =
P?DNO(k), which means that energy is purchased from the DNO and
therefore the purchase weight is used. Otherwise P?DNO &amp;lt;0 implies
?DNO = 0 and z?DNO(k) = 0 and the sale weight is used. This makes
it possible to use different weights for the same variable. The values of
the weights were adjusted according to the price of energy.

Charging Station Management Unit

A Charging Station Management Unit (CSMU) was designed to
manage the use of the electric vehicle batteries over the microgrid. The
CSMU decides the operation mode of each electric vehicle battery and
communicate it to the second level MPC. This supervisor was imple-
mented by the algorithm 3.

At the time of vehicle connection to the charging station, the user
must inform the charging type ChT (slow or fast), the arrival time Ta
and the parking time Tp. If slow charge is chosen the battery charges
over the parking time using low-power charge. In the case of fast charge
the battery is charged with maximum power, this is done only half an
hour before the pre-set parking time, and in the rest of the time the
battery is available for use as a storage for microgrid. During the period
of slow or fast charge the weights Qx and QNp are tuned to a positive
value in order to ensure that the load is charged on time. When the
battery is used as storage these weights assume null values.



5.2. Laboratory Microgrid Control 59

Algorithm 3 Charging Station Management

Input: Ta, Tp,ChT ,?,Time
Output: Qx, QNp,u
1: for i = 1 to nc do
2: if ?(i) = 1 {Test if there is a parked vehicle} then
3: if ChT (i) = 1 {Fast Charge} then
4: if Time ? Ta + Tp ?30 minutes then
5: Set Qx(i, i) to the fast charge value
6: Set QNp(i, i) to the fast charge value
7: else {Use the battery as a grid storage}
8: Set Qx(i, i) to zero
9: Set QNp(i, i) to zero

10: end if
11: else {Slow Charge}
12: Set Qx(i, i) to the slow charge value
13: Set QNp(i, i) to the slow charge value
14: Set u(i) to the slow charge value
15: end if
16: end if
17: end for

Switching between electrolyzer and the fuel cell

In relation to the operation of the fuel cell and electrolyzer, it
must be taken into account that both equipments have a minimum
time to reach the steady state. Another important point is that abrupt
switching between them should be avoided to maximize the useful life.
Thus an algorithm was developed to attempt the following objectives:

1. Minimal time between switch on and switch off (Ton(ez,fc)?Toff(ez,fc) ?
Tmin(ez,fc));

2. Maintain the equipment on (or off) during the longest time inter-
val;

3. Number of switching in the horizon less than a maximum (MS).

To attempt the first objective the constraint (5.17) is added to the
optimization problem while Ton(ez,fc) ? Toff(ez,fc) ? Tmin(ez,fc). This
way no switching throughout the prediction horizon is guaranteed.

??H2(k + l) = ??H2(k + l ?1) (5.17)



60 5. Microgrid Control

To satisfy the second objective, an additional variable ???H2(k +

l) = abs(??H2(k + l) ? ??H2(k + l ? 1)) is included, that is the absolute
value of the binary variable increment and the following term is added
to the objective function to minimize the number of switches:

J =

Np?1
?

l=0

???H2 (k + l)
T Q??

Np?1
?

l=0

???H2(k + l) (5.18)

Finally, the following constraint that imposes a maximum number
of switches (MS) in the prediction horizon is introduced:

Np?1
?

l=0

???H2(k + l) ? MS (5.19)

In the proposed method, practical requirements, as the minimal
operational time and reduced number of switching, are introduced ex-
plicitly in the optimization problem. As the MPC methodology consists
of solving an optimization problem for every instant of prediction hori-
zon, the switching constraints are taken into account by the MPC over
the prediction horizon, influencing future decisions of energy manage-
ment. This way the algorithm provides an optimized solution to the
hydrogen storage management problem.

5.2.4 Experimental Results

In this section, the experimental results of the proposed control
strategy applied to the physical microgrid are presented. The control
strategy was implemented using the software Matlab [74] with Yalmip
toolbox[69] and solver CPLEX [58] connected to a Programmable Logic
Controller (PLC) through OPC. The microgrid is equipped with a high
number of sensors and actuators directly controlled by a PLC (Schnei-
der M340). A hierarchical architecture is adopted for reliable microgrid
operation. A lower control level is managed by the PLC which monitors
critical variables. If any of the critical variables (bus voltage, pressure,
current, SOC etc.) is out of safety bounds, the PLC stops the oper-
ation carrying out an emergency stop. Above this control layer, the
Matlab interface allows to implement advanced controllers. This in-
terface includes the estimation of the states, such as battery state of
charge (SOC) and Metal Hydride Level (MHL). All experiments were
conducted during a period of 24 hours. Electric vehicles 1 and 3 receive



5.2. Laboratory Microgrid Control 61

fast charge while 2 and 4 receive slow charge. The microgrid control ob-
jectives are to maximize the use of renewable energy sources, make the
purchase and sale management of electricity to the DNO, coordinate
the use of the battery bank and the hydrogen storage to minimize the
oscillations between the production and demand, perform the charging
of electric vehicles and ensure the load demand at all periods of time.
All parameter values are presented in appendix A.

Three different experiments were carried out for the controller
validation. Three representative weather patterns were selected. In
particular, for the first experiment the electronic power supply was
used to emulate a solar photovoltaic generator in a sunny day as shown
in figures 5.4 and 5.5.

During the period from 0h to 8h and from 19h to 24h, the bat-
tery and the fuel cell worked uninterruptedly to provide most part of
energy required to meet the demand and reduce the amount of energy
imported from the external grid. When there is high irradiation (8h to
18h), part of energy excess is sold to the DNO and other part is used to
charge the battery and the hydrogen storage through the electrolyzer
operation. This way the proposed control strategy provides an optimal
power distribution between the batteries, the electrolyzer and exported
to the grid, which is a fundamental difference of this controller com-
pared to traditional heuristic controllers. At the end of the day (18h to
19h), when there is less irradiation, happened a switching between the
fuel cell and the electrolyzer, respecting the minimum operation time
of each equipment.

As can be seen in figure 5.5, when EV1 was parked at 7h, its
battery is used to avoid fluctuations, and after 8h EV1 was charged.
There exist some oscillations in the power of EV1 and EV3 during the
charge procedure that probably were caused by an aggressive tune of
the controller parameters. EV2 and EV4 were charged in a slow charge
mode.

The second experiment was performed in a cloudy day scenario,
as can be seen in figures 5.6 and 5.7. A cloudy day represents a great
challenge for renewable microgrids, since the control has to cope with
high power fluctuations. In this sense the storage system should have
the ability to absorb such fluctuations. As the microgrid is composed
by a hybrid storage system, it is expected that the battery bank absorbs
high frequency oscillations while the hydrogen storage provides energy
for a long time when the irradiation is not sufficient to meet the demand.
Another challenge is to minimize the switching in the hydrogen storage
which may be caused by oscillatory conditions.



62 5. Microgrid Control

Figure 5.4: Energy sources and storage units - Sunny day

Figure 5.5: Electric vehicles charge management - Sunny day

When the weather is cloudy, between 12h and 17 : 30h, the bat-
tery bank and the batteries of electric vehicles absorbed most of the
power fluctuation. It was observed a short switching between the elec-
trolyzer and the fuel cell, from 12h to 13h, that is caused by the radiance
oscillation. In the rest of the experiment the hydrogen storage provided
energy to the system at night and stored energy during the day. The
difference between the initial and the final MHL is greater than com-
pared to the sunny day experiment, that is expected once the radiance
during the day is not sufficient to replace the energy expended at night.
The radiance oscillation, caused by the clouds, affects directly the pro-
file of energy sold to the DNO and the battery life as the number of
charge/discharge cycles increase with fluctuation condition. Otherwise



5.2. Laboratory Microgrid Control 63

fuel cell and electrolyzer operation is less affected thanks to the algo-
rithm presented in section 5.2.3 that limits the switching between both
equipment.

When EV1 was parked at 7h, its battery is used to provide energy
to the load, and after 9h EV1 was charged as can be seen in figure
5.7. The batteries of EV1 and EV3 were used to mitigate the power
fluctuation during the cloudy period that caused energy oscillation,
from 12h and 16h to EV1 and from 12h and 17 : 30h to EV3. A slow
charge was applied in EV2 and EV4.

Figure 5.6: Energy sources and storage units - Cloudy day

Figure 5.7: Electric vehicles charge management - Cloudy day

The third experiment was conducted using a wind turbine as re-
newable energy source and the results are shown in figures 5.8 and 5.9.
In this experiment, the fluctuations are not so abrupt like in the cloudy



64 5. Microgrid Control

day. However, it still presents a high stochastic behavior in the wind
turbine production. There are some switching in the hydrogen storage,
at 10h when a wind fluctuation happens and after 20h when it is neces-
sary provide energy to the load. In this case the final value of MHL at
the end of the day is greater than at the beginning, as a consequence
of the electrolyzer operation in most part of the day. The batteries of
electric vehicles are scarcely used by the microgrid as can be seen in
figure 5.9.

In all experiments there are four switches between the fuel cell
and the electrolyzer. This occurs because of the effect of the proposed
constraints and the penalty function to maximize the operating time of
each equipment (once it has been switched on).

Figure 5.8: Energy sources and storage units - Windy day

Figure 5.9: Electric vehicles charge management - Windy day



5.3. Networked Microgrids 65

5.3 Networked Microgrids

The objective of this section is to present a distributed energy
management system for optimizing direct current (DC) networked mi-
crogrids where each microgrid is composed by renewable energy sources
and a V2G system to charge electric vehicles.

The microgrids are interconnected to each other and with the dis-
tribution network operator (DNO) by a physical common bus. Again
in this case the system modeling was carried out using the Energy Hubs
methodology. In normal operation the proposed energy management
system (EMS) is responsible for performing the energy management
between microgrids and purchase and sale energy to the DNO, maxi-
mizing the use of renewable energy sources, managing the use of energy
storage units and performing the charge of the parked vehicles. During
a fault the EMS has the task of ensuring that all microgrids will co-
operate to mitigate the fault effects. On the other hand the proposed
controller performs, for each microgrid, the management of the use of
renewable energy sources, energy storage units, vehicles charge and the
purchase and sale of electric power to the DNO.

5.3.1 V2G Networked Microgrids

The analyzed network is composed of four microgrids as shown
in figure 5.10, although the methodology can be used with a network
of any number of microgrids. The microgrids are connected each other
through a common physical point and it is assumed that each microgrid
can sell/purchase energy to DNO.

The microgrids are composed of a renewable energy source (so-
lar/wind), a energy storage system (bank of batteries), an electric vehi-
cle charging station and a load that represents residential or industrial
consumers. Microgrids 1 and 2 are composed of a grid of photovoltaic
panels, while, 3 and 4 are powered by wind turbines. The charging
station has capacity to charge ten vehicles simultaneously and it is pro-
vided with a photovoltaic energy source. For the battery bank and
the electric vehicle batteries different charge/discharge efficiencies were
considered as pointed in [45] and [42]. The technical characteristics of
all equipments are summarized in table 5.2.

5.3.2 System Modeling

All the modeling aspects of the microgrids are equal to the ones
presented in section 4.3. Hereafter the modeling aspects related to



66 5. Microgrid Control

Figure 5.10: Network of Microgrids

the connection between the microgrids are presented. The complete

decision vector (manipulated variables) is u =
[
uL uE ? z

]T
;

with uL = PDNO where PDNO is the power exchanged with DNO;

uE =
[
PB PBev1 . . . PBev10

]T
where PB and PBev1to10 are re-

spectively the power of battery bank and electric vehicles batteries; ? =
[
?DNO ?B ?Bev1 . . . ?Bev10

]T
where ?DNO, ?B and ?Bev1to10

are binary variables; z =
[
zDNO zB zBev1 . . . zBev10

]T
where

zDNO, zB and zBev1to10 are continuous auxiliary variables.
As all power generated by the renewable energy sources (photo-

voltaic and wind) has to be used by the system, they were modeled as
disturbances according to vector

r=

?

?

PRenewable
PPV Ch

?

? (5.20)

where PRenewable can be photovoltaic or wind energy source depending
on the microgrid and PPV Ch is the charging station photovoltaic energy
source. Interconnection variables that represent the power exchanged
among the microgrids were inserted in the model through the following
in/out interconnection vectors:



5.3. Networked Microgrids 67

Table 5.2: Microgrids Components

Photovoltaic panels Wind Turbines
Micro Grid 1: PS = 1.5MWp Micro Grid 3: PW = 2MWp
Micro Grid 2: PS = 2MWp Micro Grid 4: PW = 3MWp

Li-Ion Battery bank
Power: PB = 1MW Charge efficiency: ?Ch = 0.92

Capacity: CB = 0.5MWh Discharge efficiency:?D = 0.95

Charging Station
PV panels: PS = 0.03MWp

Li-Ion Ev Battery
Power: PB = 0.06MW Charge efficiency: ?Ch = 0.92

Capacity: CB = 0.023MWh Discharge efficiency:?D = 0.95

win,i?j=

?

?

?

?

win,i?j1
win,i?j2
win,i?j3

?

?

?

?

,wout,i?j=

?

?

?

?

wout,i?j1
wout,i?j2
wout,i?j3

?

?

?

?

(5.21)

where win,i?j is the power received by the microgrid i from the mi-
crogrid j and wout,i?j is the power sent from the microgrid i to the
microgrid j. The model can be written in a condensed form:

x(k + 1) =Ax(k) + ?u(k) (5.22)

y(k) =?u(k) + Dr(k) + ?inwin,i?j(k) (5.23)

wout,i?j(k) = ?out,i?jy(k) (5.24)

E??+Ezz(k) ? E
E
u u

E(k) + E0, (5.25)

where the states are the battery bank SOC (state of charge) and the
SOC of each electric vehicle battery.

5.3.3 Control Algorithm

This section gives details of the proposed distributed predictive
control structure focusing on optimizing the operation. In this con-
trol structure, the global optimization problem is distributed between
agents in the form of local optimization goals. Figure 5.11 shows the
control structure of each microgrid. The MPC is designed to achieve the



68 5. Microgrid Control

microgrid economic optimization managing the storage state of charge
and the energy selling and purchasing to DNO. The CSMU, described in
previous section, manages the use of electric vehicles batteries as stor-
age and guarantees that the charging constraints (charging type and
time) are satisfied. The microgrid interconnection selector is respon-
sible for analyzing if the microgrid has excess or deficiency of energy
and classifies the microgrids as an energy provider or receptor. In this
way the interconnections are selected to manage the energy flow from
providers to receptors.

Figure 5.11: Control Structure

Objective Function

The optimization problem for each microgrid uses the following
local objective function:

Jlocal =

Np?1
?

l=0

u?(k + l)
T
Qu?(k + l) + f

T
u?(k + l)+

Np?1
?

l=0

(x?(k + l)? x?ref (k + l))
T
Qx (x?(k + l)? x?ref (k + l)) +

(x?(k + Np) ? x?ref (k + Np))
T
QNp (x?(k + Np) ? x?ref (k + Np))

(5.26)

subject to local dynamics (5.22) and (5.25) and the following con-
straints:



5.3. Networked Microgrids 69

xi ? x?i(k + l + 1) ? xi (5.27)

ui ? u?i(k + l) ? ui (5.28)

y?i(k + l) = ydem(k) (5.29)

xi(k) = x?i(k) (5.30)

for l = 0, . . . , Np ? 1, where Q, Qx are positive definite weighting ma-
trices, f is a vector and Np is the prediction horizon. It was assumed a
bidirectional energy flow between the microgrid and the DNO so that
the negative threshold is used.

The first term of the objective function is used for the manage-
ment of the renewable energy sources and for purchasing power from
the DNO. The weights Q and f are tuned according to the price of each
energy source. The second term minimizes the error between the state
and the state reference and is responsible for maintaining the storage
level around 50% of the total load, and allows deviations from this
value when there is need to store more energy or use the stored energy.
The third term which weights the error between the final state and
desired value is introduced to ensure that the vehicle batteries will be
fully charged at the end of the charging time. These last two terms are
used to charge the batteries of electric vehicles according to the charg-
ing type, as will be explained below. As described in previous section
the different prices of energy sold/purchased with DNO are treated in
the optimization problem by a MLD transformation in the objective
function.

Interconnection Selector

The interaction between microgrids is only psychically possible
when there is at least one microgrid with energy excess and another or
others with deficiency of energy. To impose this physical restriction an
interconnection selector was created, that classifies the microgrids. The
algorithm performs the logic test PRenewable+PPV Ch ? PDemand; if the
test is true the microgrid is classified as a provider (Qprovider = 1 and
Qreceptor = 0) and in case the test is false the microgrid is a receptor
(Qprovider = 0 and Qreceptor = 1).

In order to ensure the energy flow direction, from providers to re-
ceptors, the following constraints were added to each local optimization



70 5. Microgrid Control

problem:

Qreceptor
?

j=1?3
wout,i?j =0 (5.31)

Qprovider
?

j=1?3 win,i?j =0 (5.32)

Qprovider
?

j=1?3 wout,i?j ??PRenewable+PPVCh?PDemand? (5.33)

Qreceptor
?

j=1?3 win,i?j ??PRenewable+PPVCh?PDemand? (5.34)

The first and second constraints were used to force null value to
the interconnection variable that will not be used. For example, if the
microgrid is a provider just the output interconnection variables will
be used and the input variables will be null. The third and fourth
constraints were used to limit the energy flow between the microgrids.

In the studied system all microgrids can communicate each other
by the interconnection variables and can buy/sell energy to the DNO.
Each microgrid optimization problem has to satisfy the interconnec-
tions constraints win,j?i = wout,i?j and wout,j?i = win,i?j. To en-
sure that these constraints will be satisfied it is necessary to apply
a distributed control algorithm based on communication between the
agents. This way, the Hybrid Distributed MPC framework presented
in chapter 4 was used.

5.4 Results

The proposed Hybrid DMPC strategy was applied to the net-
worked microgrids described in section 5.3.1. A simulation with a pe-
riod of 24 hours and a sampling time of 10 minutes was performed using
the software Matlab [74] with Yalmip toolbox[69] and solver CPLEX
[58]. The control objectives of each microgrid are to maximize the use
of renewable energy sources, make the purchase and sale management
of electricity to the DNO, use the storage to minimize the oscillations
between the production and demand, perform the charging of electric
vehicles and ensure the load demand at all periods of time. From the
interconnected systems point of view it is desired to maximize energy
exchange between microgrids in a way to reduce the amount of en-
ergy purchased from the DNO. In this simulation scenario renewable
sources data extracted from experimental microgrid described in [113]
were used. All parameter values are presented in appendix A.

As each microgrid has 12 binary variables related to the physi-
cal dynamics (one related to energy sells/purchases to DNO, another
related to battery bank and ten related to electric vehicles) and a pre-



5.4. Results 71

diction horizon of N = 6 was used, the total number of binary variables
is 72. This way each microgrid has 272 possible instances to the local
controller which results in

?4
i=1 2

72 configurations for the binary vari-
ables in the global optimization problem.

As explained in chapter 3, the proposed algorithm reduces the
set of controller instances to 4 using Nb = 1 and 24 for Nb = 6. A
simulation analysis to determine the influence of Nb, testing Nb = 1
until Nb = 6 with N = 6 and Nc = 2 was performed. Figure 5.20 shows
the number of iterations for each time instant and the calculation time
for each Nb. To facilitate the figure visualization a zoom of the first ten
hours is provided. In this case the number of iterations varies between
1839 and 3693, and the calculation time increases with Nb. As shown
in Table 5.3, Nb = 3 offers the best compromise between the number
of iterations and the calculation time, getting 1094 iterations in 13.92
minutes with an average time of 5.80 seconds per iteration. For the
other values of Nb, the system presented peaks of maximum iterations
between 17h and 20h. Hence, in this context the best choice is Nb = 3.

0 5 10 15 20

Time (h)

0

100

200

300

400

500

600
Iterations

N
b

= 1

N
b

= 2

N
b

= 3

N
b

= 4

N
b

= 5

N
b

= 6

0 5 10 15 20

Time (h)

0

50

100

150

200

250

T
im

e
 (

s
e

c
o

n
d

s
)

Calculation Time

N
b

= 1

N
b

= 2

N
b

= 3

N
b

= 4

N
b

= 5

N
b

= 6

Figure 5.12: Number of iterations and calculation time varying Nb.

Table 5.4 presents a comparison between the proposed hybrid
DMPC framework and centralized MIQP (CMIQP) solved by CPLEX
branch and bound solver. As expected, the computation time expended
by the hybrid DMPC was greater than the centralized solution and this
result is explained by the number of optimization problems solved at
each iteration. However hybrid DMPC has an average calculation time
of 5.8 seconds that is much smaller than the sampling of 10 minutes.
Both algorithms presented similar costs, a fact that shows that the
proposed DMPC can deal properly with problems composed by a great



72 5. Microgrid Control

Table 5.3: Analysis of Nb

Iterations Total time (min) Average time (s)

Nb = 1 2949 17.3 7.21
Nb = 2 1839 15.7 6.56
Nb = 3 1094 13.92 5.80
Nb = 4 3687 32.13 13.39
Nb = 5 2214 27.33 11.39
Nb = 6 3693 37.65 15.65

number of binary variables in a distributed fashion and provide a solu-
tion close to the optimal obtained by centralized algorithm.

Table 5.4: Performance Indexes

HybridDMPC CMIQP

Iterations 1094 ?
Total time (min) 13.92 2.45
Average time (s) 5.8 1.01
Total cost 1.9 ×1015 1.81 ×1015

Average cost 1.31 ×1013 1.25 ×1013

In order to investigate the interconnection advantages a compar-
ison between the networked microgrids with distributed controller and
the isolated microgrids with local centralized controllers was performed.
Figures 5.14 and 5.15 show the energy sources graphs for simulation
with interconnected and isolated microgrids respectively, while figure
5.16 shows the state of charge of each microgrid in both simulation sce-
narios. To facilitate the visualization of charging station, photovoltaic
source and battery powers were plotted multiplied by a factor of 10.
Figure 5.13 shows the sell and purchase prices of energy exchanged with
DNO.

In respect to the amount of energy exchanged with the DNO, as
shown in table 5.5, in networked arrangement all microgrids sold en-
ergy to DNO and only microgrids 1 and 2 purchased 0.067MWh and
0.047MWh respectively. However in isolated scenario microgrids 1 and
2 purchased more energy (3.85MWh and 10.02MWh) and microgrids 3
and 4 sold a great amount of energy to DNO. As the prices of energy
exchanged with DNO are variable over the day and the amount of en-



5.4. Results 73

Figure 5.13: Energy prices

ergy exchanged in both scenarios are different, there are distinct energy
costs for each microgrid. In isolated case all microgrids sold 980.41eand
purchased 618.34etotalizing a profit of 362.07ewhile in the intercon-
nected case the total profit is 932.19e. These differences between both
schemes is because when microgrids are interconnected they exchange
energy with each other and consequently minimize the amount of en-
ergy purchased from DNO, while in isolated case microgrids just had
the DNO to exchange energy. From a sustainable viewpoint the net-
worked case is better because it uses less DNO energy that is usually
generated from fossil energy sources.

Analyzing figures 5.16 it is possible to see that in the isolated
case microgrids 1 and 2 had more variability of SOC in the battery
bank than in the interconnected case. The reason of this fact is that
when microgrids are interconnected all systems cooperate to mitigate
the power fluctuations while in the isolated case there is only battery
bank for this function.

During interconnected simulation microgrids 3 and 4 had excess
of energy and were classified as providers while microgrids 1 and 2 as
receptors. The energy flow between microgrids is shown in figure 5.19
(a). Microgrids cooperate each other in periods when, for one or more
microgrids, demand is greater than power of energy source.

Figure 5.17 displays the vehicles batteries management in isolated
case. For all microgrids Vehicles 2, 3, 6 and 10 use slow charge. Other
vehicles use fast charge so that part of the time that they are connected
to the microgrid they operate as storage elements and only in the last
30 minutes the batteries are actually charged. This functionality was



74 5. Microgrid Control

Table 5.5: Energy exchanged with DNO

Energy (MWh) Cost (e)
Sold Purchased Sold Purchased

Interconnected Case

MG1 4.57 0.067 103.26 3.47
MG2 3.34 0.047 75.33 2.46
MG3 17.54 0 345.45 0
MG4 20.8 0 414.08 0
Total 46.25 0.0114 938.12 5.93

Isolated Case

MG1 4.60 3.85 103.68 168.45
MG2 3.41 10.02 77.26 449.89
MG3 21.05 0 408.11 0
MG4 30.00 0 391.36 0
Total 59.06 13.87 980.41 618.34

better used in case of isolated microgrids, as highlighted in figure 5.17,
because in this situation microgrids have only the storage units to deal
with fluctuations. In interconnected arrangement it was not necessary
to use the electric vehicles as storage units because this fluctuations are
handled through interconnection.

In the second simulation a fault in the energy source of microgrid
3 was applied starting at 10h and extinguishing at 14h. The main
purpose of this test is to investigate how distributed controller deal
with disturbances and maintain interconnected system stability. As
shown in figure 5.18, during the fault the amount of energy sold to
DNO is reduced compared with no fault case. Part of this energy is
exchanged between microgrids to support microgrid 3 as shown in figure
5.19. During the fault the number of iterations increases compared to
the simulation without fault and in few moments reaches the maximum
limit of 600 iterations (see figure 5.20).

5.5 Final Remarks

In this chapter the problem of control of microgrids integrating
renewable generation, hybrid storage technologies and an interaction
with a V2G system was presented. A hierarchical MPC structure was
proposed to perform the economic optimization and management of
storage systems. Constraints and penalty functions were introduced



5.5. Final Remarks 75

0 5 10 15 20

Time (h)

-1

0

1

2

P
o

w
e

r 
(M

W
)

Microgrid 1

0 5 10 15 20

Time (h)

-1

0

1

2

P
o

w
e

r 
(M

W
)

Microgrid 2

0 5 10 15 20

Time (h)

-4

-2

0

2

P
o

w
e

r 
(M

W
)

Microgrid 3

0 5 10 15 20

Time (h)

-8

-6

-4

-2

0

2

P
o

w
e

r 
(M

W
)

Microgrid 4

Figure 5.14: Interconnected simulation energy sources. (blue - renewable
energy sources, red - charging station photovoltaic source, black - power
exchanged with DNO, cyan - battery power, green - Demand)

in order to deal with the switching between the fuel cell and the elec-
trolyzer and to maximize the time each equipment is on. The charging
station management algorithm performed the use of the electric vehicles
batteries as a microgrid storage.

In the second part of this chapter the control of networked micro-
grids was discussed. The hybrid DMPC developed in chapter 4 was used
as energy management system to perform the economic energy man-
agement and guarantee the cooperation between microgrids in normal
and fault operation. The interconnection selector showed usefulness en-
suring the energy flow direction from providers to receptors. As shown
in the simulation results, the proposed controller presented satisfactory
results for different operating conditions.



76 5. Microgrid Control

0 5 10 15 20

Time (h)

-5

0

5
P

o
w

e
r 

(M
W

)
Microgrid 1

0 5 10 15 20

Time (h)

-5

0

5

P
o
w

e
r 

(M
W

)

Microgrid 2

0 5 10 15 20

Time (h)

-2

-1

0

1

2

P
o

w
e

r 
(M

W
)

Microgrid 3

0 5 10 15 20

Time (h)

-2

-1

0

1

2

3

P
o

w
e

r 
(M

W
)

Microgrid 4

Figure 5.15: Isolated simulation energy sources. (blue - renewable energy
sources, red - charging station photovoltaic source, black - power exchanged
with DNO, cyan - battery power, green - Demand)

To complete the study of this thesis, in the chapter 6, the Brazilian
energy scenario will be taken into account by the modeling and control
of a hybrid generation power plant on the sugar cane industry.



5.5. Final Remarks 77

0 5 10 15 20

Time (h)

20

30

40

50

S
O

C
 (

%
)

Networked Microgrids

SOC MG1

SOC MG2

SOC MG3

SOC MG4

0 5 10 15 20

Time (h)

40

50

60

70

80

90

100

S
O

C
 (

%
)

Isolated Microgrids

SOC MG1

SOC MG2

SOC MG3

SOC MG4

Figure 5.16: Battery SOC

0 5 10 15 20

Time (h)

0

20

40

60

80

100

S
O

C
 (

%
)

Ev1

Ev2

Ev3

0 5 10 15 20

Time (h)

0

20

40

60

80

100

S
O

C
 (

%
)

Ev4

Ev5

Ev6

0 5 10 15 20

Time (h)

0

20

40

60

80

100

S
O

C
 (

%
)

Ev7

Ev8

0 5 10 15 20

Time (h)

0

20

40

60

80

100

S
O

C
 (

%
)

Ev9

Ev10

Figure 5.17: Electric vehicles charge management (Isolated Microgrids)



78 5. Microgrid Control

0 5 10 15 20

Time (h)

-2

-1

0

1

2

3

P
o

w
e

r 
(M

W
)

Microgrid 1

0 5 10 15 20

Time (h)

-2

0

2

P
o

w
e

r 
(M

W
)

Microgrid 2

0 5 10 15 20

Time (h)

-4

-2

0

2

P
o

w
e

r 
(M

W
)

Microgrid 3

0 5 10 15 20

Time (h)

-2

-1

0

1

2

3

P
o

w
e

r 
(M

W
)

Microgrid 4

Figure 5.18: Energy sources during a fault. (blue - renewable energy
sources, red - charging station photovoltaic source, black - power exchanged
with DNO, cyan - battery power)



5.5. Final Remarks 79

0 5 10 15 20

Time (h)

0

0.01

0.02

0.03

0.04

P
o
w

e
r 

(M
W

)

MG1 ? MG2

MG1 ? MG3

MG1 ? MG4

0 5 10 15 20

Time (h)

0

0.02

0.04

0.06

0.08

0.1

P
o
w

e
r 

(M
W

)

MG2 ? MG1

MG2 ? MG3

MG2 ? MG4

0 5 10 15 20

Time (h)

0

0.2

0.4

0.6

P
o
w

e
r 

(M
W

)

MG3 ? MG1

MG3 ? MG2

MG3 ? MG4

0 5 10 15 20

Time (h)

0

0.2

0.4

0.6

0.8

P
o
w

e
r 

(M
W

)

MG4 ? MG1

MG4 ? MG2

MG4 ? MG3

(a) Networked Microgrids in normal operation

0 5 10 15 20

Time (h)

0

0.2

0.4

0.6

0.8

1

P
o

w
e

r 
(M

W
)

MG1 ? MG2

MG1 ? MG3

MG1 ? MG4

0 5 10 15 20

Time (h)

0

0.2

0.4

0.6

0.8

P
o

w
e

r 
(M

W
)

MG2 ? MG1

MG2 ? MG3

MG2 ? MG4

0 5 10 15 20

Time (h)

0

0.2

0.4

0.6

P
o

w
e

r 
(M

W
)

MG3 ? MG1

MG3 ? MG2

MG3 ? MG4

0 5 10 15 20

Time (h)

0

0.5

1

1.5

P
o

w
e

r 
(M

W
)

MG4 ? MG1

MG4 ? MG2

MG4 ? MG3

(b) Networked Microgrids during a fault

Figure 5.19: Interconnection variables in the two analyzed scenarios.

0 5 10 15 20

Time (h)

0

100

200

300

400

500

600

It
e

ra
ti
o

n
s

Without fault

During a fault

Figure 5.20: Number of iterations (without fault and during a fault)



80 5. Microgrid Control



Chapter 6

Sugar Cane Industry
Case

Given the importance of sugar-ethanol power plants in the Brazil-
ian energy setting and knowing that these are mostly established in
high insolation sites, they become potential candidates to be managed
as distributed power plants of hybrid sources, as seen in [39], consid-
ering biomass, biogas, solar and wind power energy and natural gas.
Thus, the control of hybrid generation and storage, including renewable
and non-renewable sources, is a significant issue to be studied in order
to allow the optimal management and operation, carrying out a coordi-
nation between legal standards, minimal environmental standards and
state of the art techniques [54], [38].

Multi-carrier systems represent a crucial need for future research.
Traditionally, energy networks have been considered employing only
one source of energy (for example, electricity or natural gas). Recent
works urge to combine modeling and scrutiny of energy systems in-
cluding various energy carriers and system intercommunication and the
integrated planning of different networks [49].

With greater demands for improvements in production and effi-
ciency, the operational requisites of energy systems are evermore re-
strict and, for that, the operation and automatic control have to aim
optimal efficiency of these energy plants. Knowing that individual op-
timal conditions of subsystems do not imply the optimal condition of
a whole system, a coordination between every subsystem of a whole
energy system becomes necessary. This coordination is typically done
by an automatic supervisor, in a higher level in the hierarchy of the



82 6. Sugar Cane Industry Case

control structure of these energy plants, and, by this, the operational
set-points of each subsystem are brought so that the operation of the
whole energy system is near its optimal operational point.

This chapter presents the proposal of a new hybrid energy genera-
tion system, with the reuse of the sugar cane residues coupled with the
use of other renewable sources, external to the plant, as photovoltaic
panels and wind turbines, that aims to prevent and, when not possible,
reduce emissions and the global environmental impact. The proposed
microgrid is based on a real sugar cane processing unit, with the addi-
tion of subsystems based on renewable generation. First some details
about the power plant will be presented and the modeling framework
will be detailed. Then an optimization of the hybrid energy system
based on MPC is proposed.

6.1 The Hybrid Generation Power System

In this section a generic hybrid energy generation system, based
on a sugar cane processing plant, that produces sugar and ethanol is
proposed. The energy power plant is based on a real Brazilian industrial
plant, whose structure is seen in figure 6.1. The proposed system, shown
in figure 6.2, is composed by the following subsystems:

• two boilers, with different efficiencies;

• two steam turbines, with different efficiencies;

• one combined heat and power system (herein denoted as CHP);

• one water chiller;

• one hot water tank;

• photovoltaic panels;

• water heating solar panels;

• one wind turbine;

• two pressure reduction valves;

• one heat exchanger;

• stocks of bagasse, straw and compressed biogas;

• a battery bank.



6.1. The Hybrid Generation Power System 83

The tendered system, being a plausible adaptation from a real
plant, is interesting in an economic and sustainable point-of-view, as
it proposes the use of renewable sources and the recycling of the sugar
cane residues. This implies directly on the increase of the total energy
generation capacity and, also, on the efficiency and the sustainability of
the system - that, herein, does not use any fossil fuel or energy source
external to the sugar-ethanol production process. The system aims
to use the best possible technology, that conducts a dynamic between
legal norms, minimum environmental standards and the state of the
art techniques. Figure 6.2 shows the outline of the proposed system.
The technical characteristics of these equipments can be seen in table
6.1. Other important data to this study, like average bagasse income
from the canebrakes, can be found in table 6.2.

Figure 6.1: Original Power Generation Plant

The two boilers, here nominated better efficiency and lower effi-
ciency, produce, respectively, higher (67kg?) and middle pressure (21kg?)
steam. They are both powered by the biomass mixture of straw and
bagasse. The lower efficiency boiler produces less amount of steam,
which is used in order to comply to the process’s (ethanol and sugar)
middle pressure steam demands. The other boiler’s steam is used to
propel the plant turbines. The turbines, likewise the boilers, are here
nominated better efficiency and lower efficiency. The better efficiency
turbine has a low pressure steam residue (1.5kg?) that is used to meet
the process low pressure steam demands, while the lower efficiency tur-
bine steam residue meets the middle pressure steam demands. Both
turbines produce electric power that, with the CHP and the renewable
energy generation, are related to the electric demands. The CHP is a



84 6. Sugar Cane Industry Case

Figure 6.2: Proposed Power Generation Plant

Figure 6.3: Biomass Mixture

gas engine that uses energy present in the biogas to drive a crankshaft,
that, through an alternator, produces electric energy. With the com-
bustion of the gas, heat is released and recovered to warm water, mak-
ing the CHP a highly efficient system. The CHP, in this scenario, is
boosted by the compressed biogas, made from the vinasse. The use of
intermediate storage units (battery bank and biomass stocks) allows the
system to accumulate energy (or biomass, that can be converted into
energy) when the renewable generation is high and use it when there
is no renewable production. All these subsystems operating points can
be seen in table 6.3. More specific data on the stocks can be found in
table 6.4.

The whole problem here studied is subject to several constraints.
Firstly, the efficiencies of the boilers fluctuate according to the mixture
of biomass that boosts them. The straw is a moist left-over from the
sugar cane, so too much straw causes problems with the ignition of



6.1. The Hybrid Generation Power System 85

Table 6.1: Microgrid Equipments

Equipment Efficiency Used Area Other

Better Eff. Boiler 87.8 % - -
Lower Eff. Boiler 76.5 % - -
Better Eff. Turbine 70 % - -
Lower Eff. Turbine 65 % - -

High-Middle Press. Reducing Valve 25 % - -
Middle-Low Press. Reducing Valve 20 % - -

CHP ? 90 % - -
Battery Bank (charge) 95 % - -

Battery Bank (discharge) 92 % - -
Photovoltaic panels 15.85 % 200m2 1.8MWpeak
Solar Water Heater 68.7 % 150m2 -

Wind Turbine 20 % - -
Heat Exchanger 60 % - -
Water Chiller 78 % - -

Table 6.2: Microgrid Data

Days of Harvest 200 days/year -
Produced Sugar Cane 1610kt?crop 335t?h
Retrieved Bagasse 450.75kt?crop 93.90t?h
Retrieved Straw 42.028kt?crop 8.756t?h

Amount of Steam used in plant processes 5000t per day -
Average Middle Pressure Steam Demand 84t?h 21kg?
Average Low Pressure Steam Demand 125t?h 1.5kg?

Average Refrigeration Demands 67t?h ? 1.6×10
6 L per day

Average Power Process Demands 8MW 192MWh per day

the boilers. It is known that the best possible mixture of bagasse and
straw to boost boilers is 50% of each ([119],[109],[64]). The static gains
of the boilers vary according to the mixture of biomass used; mixtures
with greater amount of straw have bigger calorific power, but are wet-
ter. This is an issue of optimal control, once the amount of bagasse,
available in a canebrake, is always bigger than the amount of straw -
in the studied plant, there is an average income of 93t?h of bagasse and
8.7t?h of straw. For this, this work takes into account biomass blending
factors, ?A and ?B, varying from 0.5 to 1, for each boiler, as seen in
figure 6.3.

The proposed plant has four demands to satisfy: electric power
demand, due to ethanol and sugar production process; middle and low



86 6. Sugar Cane Industry Case

Table 6.3: Microgrids Subsystems Operating Points

Better Efficiency Turbine 11 MW ? SP AT U ? 27 MW
Lower Efficiency Turbine 3 MW ? SP BT U ? 20 MW

Better Efficiency Boiler 105 t?h ?
SP

A
TU

160
+

SP
B
TU

85
+ QOutV ? 190 t?h

Lower Efficiency Boiler 18 t?h ? SP
B
C ? 58 t?h

CHP 0.8 MW ? PotCHP ? 8 MW

Table 6.4: Microgrids Storage Units

Minimum Maximum

Bagasse Stock 2000 t 20000 t
Straw Stock 0 2000 t

Compressed Biogas Stock 10 m3 120 m3

Hot Water Tank 30 m3 300 m3

Battery Bank ?3000 MWh 3000 MWh

pressure steam demands, defined by the process; refrigeration (cold wa-
ter) demands, also defined by the process. It is important to mention
that satisfying each demand alone is not adequate, as they are inextri-
cably linked. As an example: increasing the amount of power supplied
by the turbines also increases the amount of steam produced.

The electric power that has to be produced by the microgrid con-
sists of two factors: the internal power demands, to maintain the sugar
cane processing - in average 8MW, and the amount of energy that is
sold to the Distribution Network Operator (DNO) (this is defined by a
fixed contract, 11.52GWh per month). This power generation can be
continuous, maintaining an average electric power, or varied, with dif-
ferent values of electric power made available at each hour of the day.
This is placed as the main optimization problem of this study, more
deeply discussed in further sections.

The steam demands of the system correspond to the sugar and
ethanol processing steam demands. These are used to boost water
bombs, spray bombs, fans, chippers, shredders and other equipments.
The refrigeration demand of the microgrid is used to cool down gen-
erators, oil tanks from the distillery process and other systems present
on the plant.



6.2. System Modeling 87

6.2 System Modeling

In this section the system modeling methodology is explained.

6.2.1 Manipulated Variables

The system manipulated variables are:

• The lower efficiency boiler set-point, SPBC (t?h);

• The lower efficiency turbine set-point, SPBTU (kW);

• The better efficiency turbine set-point, SPATU (kW);

• The charge/discharge power the battery bank, PB (kW);

• The CHP set-point, SPCHP (kW);

• The water chiller set-point, SPch (m3?h);

• The heat exchangers set-point, SPTC (m3?h);

• The high-middle pressure reduction valve set-point, (QOutV t?h);

• The middle-low pressure reduction valve set-point, (QMBV t?h);

• The hot water escape flow, (QTankEsc m
3?h);

• The middle pressure steam escape flow, (QMEsc t?h);

• The low pressure steam escape flow, (QBEsct?h) and

• The instant electric power that is made available, by the micro-
grid, to the DNO (for sale), represented by (PNet (kW));

• The binary variable associated with battery charge/discharge,
(?B);

• The auxiliary continuous variable associated with battery charge/discharge,
(zB (kW))

These manipulated variables, will be treated as set-points by lower
level internal controls. The internal control of each subsystem is not a
concern to this work. The complete manipulated variables vector is:

u =
[
SP AT U SP

B
T U PNet SP

B
C Q

Out
V Q

M
Esc Q

B
Esc SPCHP

]
(6.1)

[
SPCh SPT C PB Q

MB
V Q

T ank
Esc ?B zB

]T
(6.2)



88 6. Sugar Cane Industry Case

6.2.2 Disturbance Vector

The external disturbances to the system are:

z =
[
Windin Irradin Bagin Strin Bgin

]T
, (6.3)

where Windin is the amount of wind (measured in km?h) present in the
microgrid area, used by the wind turbines to generate electric power,
and Irradin is the amount of solar irradiation (measured in W?m2) on
the microgrid solar panels (photovoltaic and water heating). As the
wind and the solar irradiation are considered disturbances, in the rest of
this thesis they will be referred as non-dispatchable renewable sources.
Bagin, Strin and Bgin are measured in t?h and represent the income
of bagasse, straw and compressed biogas to the respective stocks.

6.2.3 System Output

The system output vector is defined as:

y =
[
DP roc Q

M
V Q

L
V QCW PSale,

]T
(6.4)

with DProc the electric demand referred to the distillery process (kW);
QMV the flow of middle pressure steam (t?h); Q

L
V the flow of low pressure

steam (t?h); QCW the flow of cold water required by the distillery pro-
cess (m3?h); finally, PSale represents the electric power made available
for the DNO (kW).

6.2.4 Stock Flows

The system state vector is defined as:

x =
[
xB xBag xStr xBg xT

]T
, (6.5)

where xB is the battery SOC; xBag, xStr and xBg are the stored
amount of bagasse, straw and biogas in their related stocks and xT
is the hot water tank temperature. The stocks state equations were
obtained by mass conservation principles as follows.

Battery Bank

The battery bank was modeled by the MLD procedure described



6.2. System Modeling 89

in section 2.2.1. For this purpose it is necessary to define the aux-
iliary variable zbat = Pbat?bat that is related to the battery charg-
ing/discharging. The state equation for the battery SOC is

dxB

dt
= ??

bat
PB +

(
?
?
bat
??+

bat

)
zB (6.6)

where, ?+
bat

and ??
bat

are respectively the charging and discharging ef-
ficiencies, ?bat is a binary variable and zbat is a continuous auxiliary
variable.

Bagasse Stock

The percentage of bagasse in the stock xBag is defined as the
bagasse income flow Bagin minus the bagasse outcome flow Bagout:

dxBag

dt
= Bagin ?Bagout = Bagin ?

(
?AQ

A
E + ?BQ

B
E

)
(6.7)

Notice that Bagout is a linear combination of Q
A
E and Q

B
E; ?A

and ?B are the biomass blending factors, as seen in figure 6.3.

Straw Stock

The amount of straw in the stock xStr is calculated by subtracting
the straw output flow Strout from the straw input flow Strin:

dxStr

dt
= Strin ?Strout = Strin ? [(1??A)Q

A
E + (1??B)Q

B
E] (6.8)

where Bagoutis a linear combination of Q
A
E and Q

B
E that represents the

biomass mixture that runs into each boiler, in the respective order.

Compressed Biogas Stock

The rate of compressed biogas xBg can be modeled as the previous
states by calculating the balance between the biogas income Bgin and
outcome Bgout flow:



90 6. Sugar Cane Industry Case

dxBg

dt
= Bgin ?Bgout (6.9)

Notice that Bgout is a consequence of the CHP operating point,
here chosen by the manipulated variable SPCHP .

Hot Water Tank

In the same way percentage of hot water xTank in the tank is cal-
culated by the mass balance between the hot water inflow and outflow:

dxT

dt
= Tin ?Tout = (QS + QCHP + QTC)? (Q

Tank
Esc + QCh) (6.10)

where QS is the inflow of hot water from the solar panels, QCHP is the
heated water flow from the CHP; QTC is the heated water flow from the
heat exchanger; QCh is the hot water outflow to the chiller (consequence
of chiller operating point chosen by the manipulated variable SPCh) and
QTankEsc is the water tank escape flow.

6.2.5 Final State-Space Representation

The final state-space representation relates the state vector x,
seen in equation (6.5), to the decision vector u, seen in equation (6.1),
and the disturbance vector z, seen in equation (6.3) using the energy
hub methodology, already mentioned. The discrete-time state space
equations are represented by the following matrices:



6.3. Optimization Problems 91

B=

?

?

?

?

?

?

?

?

?

?

0 0 0 0 0 0 0 0 0 0 ?
?

bat
0 0 0 ?

?

bat
??

+
bat

?1 ?3 0 ?5 ?7 0 0 0 0 0 0 0 0 0 0

?2 ?4 0 ?6 ?8 0 0 0 0 0 0 0 0 0 0

0 0 0 0 0 0 0 ?9 0 0 0 0 0 0 0

0 0 0 0 0 0 0 ?10 ?11 ?12 0 0 ?13 0 0

?

?

?

?

?

?

?

?

?

?

C=

?

?

?

?

?

?

?

?

?

?

0 0 0 0 0

0 0 ?2,3 0 0

0 0 0 ?3,4 0

0 0 0 0 ?4,5

0 ?5,2 0 0 0

?

?

?

?

?

?

?

?

?

?

F=

?

?

?

?

?

?

?

?

?

?

?1,1 ?1,2 0 0 0

0 0 0 0 0

0 0 0 0 0

0 0 0 0 0

0 0 0 0 0

?

?

?

?

?

?

?

?

?

?

E=

?

?

?

?

?

?

?

?

?

?

?1 ?3 ?5 0 0 0 0 ?9 0 0 ?12 0 0 0 0

0 ?4 0 ?7 ?8 ?15 0 0 0 0 0 ?13 0 0 0

?2 0 0 0 0 0 ?16 0 0 ?11 0 ?14 0 0 0

0 0 0 0 0 0 0 0 ?10 0 0 0 0 0 0

0 0 ?6 0 0 0 0 0 0 0 0 0 0 0 0

?

?

?

?

?

?

?

?

?

?

where A is an identity matrix that relates the next (k +1) system state
vector with the previous (k) state vector. Following the Energy Hub
methodology, the variation of the stocks (between k and k + 1) is the
inwards (or outwards) flow times the time interval ?T . D is a null ma-
trix, for the system output vector has no relationship with the system
state vector, at any given instant k. B expresses the relationship be-
tween the next system state (x(k + 1)) and the manipulated variables
(u(k)). C expresses the relationship between the next system state
(x(k + 1)) and the external disturbances (z(k)). F shows the relation-
ship between the system outputs (y) and the external disturbances (z).
The matrices variables are detailed in table 6.5. KA and KB represent,
respectively, the static gains of the boilers, that vary according to ?A
and ?B.

6.3 Optimization Problems

In this section the control strategy to solve the optimization prob-
lems is explained. There are two optimization obstacles to be solved:
the biomass mixture optimization and the demand optimization.



92 6. Sugar Cane Industry Case

Table 6.5: Auxiliary Variables Index

?1 ?
?A

32000×KA

1
kW

?3 ?
?A

17000×KA

1
kW

?5 ?
?B

200×KB

h
t

?7 ?
?A

200×KA

h
t

?2 ?
(1??A)

3200×KA

1
kW

?4 ?
(1??A)

1700×KA

1
kW

?6 ?
(1??B)
20×KB

h
t

?8 ?
?A

20×KA

h
t

?9 ?0.011
1
kW

?10 0.15×10
?2 1

kW
?11 ?0.42

h
m3

?12
1
3
h
m3

?13 ?1
h
m3

? ? ?

?2,3
1

200
h
t

?3,4
1
20
h
t

?4,5 0.416×10
?2 h

t
?5,2 0.466×10

?2 m2

W

?1 1 ?3 1 ?5 ?1 ?9 1

?12 ?1 ?4 0.0117
t

kWh
?7 1 ?8 1

?13 ?1 ?2 0.625×10
?2 t

kWh
?11 ?0.025

t
m3

?14 1

?10 1 ?6 1 ?15 ?1 ?16 ?1

?1,1 100
W.h
m

?1,2 0.8km
2

? ?

6.3.1 Biomass Mixture Optimization

The mixture optimization consists in maximizing the boiler gains
(conversion factor from amount of biomass mixture to amount of pro-
duced steam t/h?t/h), that fluctuate according to the biomass mixture
composition. The more straw there is in the mixture, the greater the
gains (up to 50% of straw, due to misture); this is seen in table 6.6.
Notice that these blending factors (statistical dummy variables, ?A and
?B) are respectively related to the high efficiency boiler and the lower
efficiency boiler. QAE and Q

B
E represent the biomass mixture that runs

into each boiler, in the respective order. The amount of bagasse outflow
and straw outflow from the stocks (Bagout and Strout) are shown in
equations (6.7) and (6.8).

In the mixture optimization the boiler gains (conversion factor
from amount of biomass mixture to amount of produced steam) fluctu-
ate according to the biomass mixture composition. The optimization
here proposed is solved by the optimizer, Opt?, that has to maintain
the blending factors as close to 0.5 as possible, knowing the future straw
income predictions. This is also subject to the following constraints:

1. maintain the straw stock inside the 10 % and 100 % limits, where
the minimum of 10 % is a safety margin for one hour operation;

2. try to maintain the straw stock near a reference of 20 %, whenever
possible;

3. preserve the blending factors as dummy variables (values from 0
to 1);

4. limit the outflow of straw.



6.3. Optimization Problems 93

Table 6.6: Biomass mixtures: Boiler gains and calorific power

Mixture Calorific Power B. Eff. Boiler Gain L. Eff. Boiler Gain
100%Bagasse 2042.205 kCal?kg 2.14 t/h?t/h 1.284 t/h?t/h

90%Bagasse + 10%Straw 2074.367 kCal?kg 2.1745 t/h?t/h 1.3041 t/h?t/h
80%Bagasse + 20%Straw 2171.022 kCal?kg 2.275 t/h?t/h 1.3644 t/h?t/h
70%Bagasse + 30%Straw 2253.348 kCal?kg 2.3607 t/h?t/h 1.4158 t/h?t/h
60%Bagasse + 40%Straw 2338.029 kCal?kg 2.4487 t/h?t/h 1.4686 t/h?t/h
50%Bagasse + 50%Straw 2408.374 kCal?kg 2.5219 t/h?t/h 1.5125 t/h?t/h

100%Straw 2894.036 kCal?kg 3.026 t/h?t/h 1.8156 t/h?t/h

6.3.2 Demand Optimization

The other optimization problem, solved by the MPC controller,
MPCmain, is the main purpose of this study: the microgrid has to
produce (sell) the contract-defined amount of electric energy, while still
meeting all the system demands: internal power demand, steam de-
mands and refrigeration demands.

As explained beforehand, the contract corresponds to the gener-
ation of 11.52GWh of electric energy, per month - herein treated as
a daily production of 384MWh. The optimization has to define the
manipulated vector (6.1) so that the daily production of energy cor-
responds to the contract and the system state vector (6.5) follows a
reference state (for example: all stocks with 50 %). This is subject to
the following restrictions:

1. the manipulated variables have to stay within physical limits;

2. the system output vector (6.4) has to contemplate the system
demands;

3. the system state vector (6.5) has to stay within bounded limits -
every stock has its operational band.

6.3.3 Control Structure

The proposed control structure is comprised of two levels. The
first level is associated with optimizing the biomass blending factors.
The second (and main) level is associated with complying the process
demands and producing the contract-defined amount of electric energy,
in the most efficient and sustainable way possible.

Figure 6.4 shows the proposed two-level hierarchical control struc-
ture based on MPC. Both the optimizer Opt? and the controller MPCmain



94 6. Sugar Cane Industry Case

are operating together, on the same time scale (sampling time ?T =
1 h). The biomass mixture optimizer acts with information of the
biomass mixture flows (QAE(k) and Q

B
E(k)) and the straw stock per-

centage (XStr(k)) and transmits to the microgrid and the controller
the instant values of the blending factors (?A(k) and ?B(k)). The
main controller acts with past blending factor values (?A(k ? 1) and
?B(k ? 1)), instant disturbance, system state and system output vec-
tors values (z(k), x(k), y(k)) and handles the manipulated variables
(acting on the microgrid).

Figure 6.4: Proposed Control Structure

Main Controller (MPCMain)

The main MPC has the following objective function:

JMain =

Nc?1?

i=0

?PNet ? (Econtract ? Esum)/?T?
2
QP

(6.11)

Nc?1?

i=0

quu?(k) +

Np?1
?

l=0

?x?(k + i) ? x?ref (k + i)?
2
Qx

+ q??

where q? and qu are positive defined vectors, QP and Qx are pos-
itive definite weighting matrices, Esum represents the electric energy
that has already been produced by the microgrid, at given iteration k;
Econtract represents the daily production of 38MWh; the system state
reference is put as x?ref; ? represents a slack variable that is to be min-
imized, used in the constraints, see equation (6.15); Np represents the
prediction horizon, while Nc represents the control horizon. As it can
be seen, (Econtract ? Esum) represents how much electric energy the
microgrid still has to produce until the end of the day, due to contract

requirement. For this, when minimizing [PNet ?
(Econtract?Esum)

?T
], the



6.3. Optimization Problems 95

main controller forces the production of energy at iteration k to ap-
proach the necessary amount to end the contract requirement, so, by
the end of the day, the amount of electric energy supplied to the DNO
is the one defined by contract. The objective function (6.11) is subject
to the following constraints:

x ? x?(k + i + 1) ? x (6.12)

u ? u?(k + i) ? u (6.13)

y?(k + i) = Demands(k) (6.14)

0 ? PNet(k) ? ? + ? (6.15)

for i = 0, . . . , Np ? 1, where ? represents the contract constant power
(16MW, if maintained at every iteration k, the electric contract would
certainly be complied). The notation hat over variables (a?) is used to
denote variables over the prediction horizon, a and a? denote minimum
and maximum allowed values respectively. The matrix QP is adjusted
so that the electric energy production is prioritized; Qx is used to main-
tain the system state vector values near a referenced region of 50 % of
all stocks. The vector qu is used so that the production of energy comes
preferably from the most efficient and sustainable energy sources and
so that the use of the battery bank is minimized.

Biomass Mixture Optimizer (Opt?)

The biomass mixture optimizer was implemented with the follow-
ing objective function:

JOpt? =

Np?1
?

i=0

???A(k + i) ?0.5?
2
QA

+

Np?1
?

i=0

???B(k + i) ?0.5?
2
QB

+ (6.16)

Np?1
?

l=0

?
?
?x?Str(k + i + 1) ? x?

ref
Str

?
?
?

2

QStr

subject to the following constraints:



96 6. Sugar Cane Industry Case

xStr ? x?Str(k + i + 1) ? xStr (6.17)

? ? ??A(k + i) ? ?A (6.18)

?B ? ??B(k + i) ? ?B (6.19)

0 ? [(1??A)Q
A
E + (1??B)Q

B
E)] ? Strout (6.20)

The first two terms of this objective function (6.16) represent the
approach of the blending factors to the optimal factors (0.5 each). The
third term of (6.16) is so that the predicted future straw stock follows
a reference of 20 %, if possible. The weighting matrices QA, QB and
QStr are tuned so that the optimizers main goal is to minimize ?A and
?B.

6.3.4 Final Control Algorithm

As seen in figure 6.4, the proposed control structure is composed
of Opt? and MPCmain, working together. This is easier to grasp by
the understanding of algorithm 4. In this algorithm, it can be seen,
after the initialization of variables and the assembling of matrices, how
the control structure is iterating hourly to: reassemble matrix B (that
changes with ?A and ?B); call the main controller MPCmain (based
on the previous iteration model: ?A(k ? 1) and ?B(k ? 1)); compute
KA,KB,Q

A
E and Q

B
E; call the optimizer Opt? to divulge the new blend-

ing factors (iteration k); reassemble B (for simulation of microgrid) and
apply decision vector to the microgrid; receive (measures) output and
state vectors.

6.3.5 Simulation Results

The experimental results of the proposed control strategy, ap-
plied to a simulated model of the studied microgrid, are presented in
this section. The control strategy was implemented using the software
Matlab [74] with Yalmip toolbox[69] and solver CPLEX [58]. The ex-
periments described in this section represent the simulation of one day.
The microgrid control objectives are to maximize the use of renewable
energy sources, ensure the energy production defined by contract and
ensure the load demand at all periods of time. Figure 6.5 shows the
system disturbances. In this simulation scenario the process data was
extracted from a real power plant from state of Parana? 1.All parameter

1For confidentiality issues the company name is not mentioned.



6.3. Optimization Problems 97

Algorithm 4 Final Microgrid Control Algoritm

Input: Ts, z
Output: x, y
{Inicialize: Np, Nc, ?A[0], ?B[0], Potcontract, X,u}
{Assemble Matrixes: A, B, C, D, E, F}
{Assemble Matrixes: q?,qu, Qx, QP , QA, QB, QStr}

1: for k = 1 to 24 do
2: Assemble B with ?A[k ?1] and ?A[k ?1]

Potsum = Potsum + u3[k ?1]
3: Call: MPCmain[Potsum; X]

{MPCmain returns u[k]}
KA = lookup(?A[k ?1])
KB = lookup(?B[k ?1])

4: Compute: QAE and Q
B
E

5: Call: Opt?[Q
A
E; Q

B
E; XStr]

{Opt? returns ?A[k] and ?B[k]}
6: Assemble B with ?A[k] and ?A[k]
7: Apply u[k] to microgrid
8: Receive y[k],x[k]
9: end for

values are presented in appendix A.
Figure 6.6 shows a simulation scenario of the proposed microgrid

and the use of each subsystem: electric power generated by the CHP,
by the turbines and by the non-dispatchable renewable sources. The
presence of the CHP and the non-dispatchable renewable sources in the
proposed system implies reduction on the turbines energy production.
As can be seen in figures 6.5 and 6.6 the CHP use depends on the biogas
income behavior. The lower efficiency turbine generated around 3MW
most part of the day, increasing the production from 18h to 22h when
there is an electric demand peak and a reduction in the biogas income.
The better efficiency turbine contributed most part of the day with
around 15MW with an increasing after 21h when a demand peak and
a reduction in the non dispatchable renewable sources occurs. At the
end of the day the CHP and the non dispatchable renewable sources
contributed with 23.27 % (126.37MW) of the total daily production of
542.97MW (the sum of CHP, both turbines and the non-dispatchaple
renewable sources was considered).

On the other hand, figure 6.7 shows a scenario of the original
system. In this scenario only the turbines generated energy to attending



98 6. Sugar Cane Industry Case

Figure 6.5: System Disturbances

the demand and the energy sale contract. In both scenarios it can be
seen that the generation is enough to comply to the energy contract.
Figure 6.8 shows that both systems met all system demands.

Figure 6.9 shows the stocks behavior of the proposed system. In
this simulation the battery bank acted to mitigate small energy im-
balances between the microgrid equipments, staying around 50 %. At
the end of the day, from 18h to 22h, when a high energy fluctuation
happened as a consequence of the electric demand peak, the battery
bank presented a SOC variation of 25 % (between 50 % and 75 %) in
order to absorb the energy generated excess. The biogas stock started
with 80 % and decreased until around 50 %, that is the state reference,
and is directly related with the CHP production. The stock of bagasse
is maintained continuously loaded, due to the great amount of income,
as seen in figure 6.6. The straw stock, on the other hand, gradually
decreases, due to the biomass mixture optimization, and the smaller
amount of income.

Figure 6.10 shows the optimizer Opt? performance when applied
to the proposed and system. The optimizer Opt? is able to maximize
the gain of the boilers by reducing ?A and ?B to 0.5, whenever possi-
ble. It can be noticed that the optimizer cannot maintain the blending
factors at the optimal condition (0.5), because this forces the straw
outcome flow to be too voluminous and violate the minimum straw
stock constraint, as shown in figure 6.9. So, the blending factors are
gradually tending to 1, except the ?B in proposed scenario, that are
near 0.5 as the lower efficiency boiler production is very low, due to the
low biomass mixture flow QBE.



6.3. Optimization Problems 99

0 5 10 15 20

Time (h)

0

100

200

300

400

500

E
n

e
rg

y
 (

M
W

h
)

Contract Energy Goal (MWh)
Total Energy Produced(MWh)
CHP Energy(MWh)
Turbines Energy(MWh)
Non-dispatchable Renewable Energy(MWh)
Demand(MWh)

0 5 10 15 20

Time (h)

0

5

10

15

20

P
o

w
e

r 
(M

W
)

Better Eff. Turbine Power (MW)

Lower Eff. Turbine Power (MW)

0 5 10 15 20

Time (h)

-2

0

2

4

6

P
o

w
e

r 
(M

W
)

CHP Power(MW)
Battery Bank Use(MW)

0 5 10 15 20

Time (h)

0

1

2

3

P
o

w
e

r 
(M

W
)

Wind Turbine Power(MW)
Solar Gen. Power(MW)

Figure 6.6: Electric power generation of the proposed system

The behavior of the variables involved in steam production are
shown in figure 6.11. As shown in figure 6.8 both steam demands are
attended. As the high efficiency boiler presented a high steam produc-
tion as a consequence of the both turbines energy production, the lower
efficiency boiler is not widely used, and production was near the mini-
mum all the time. The middle pressure steam demand is attended by
the high-middle pressure reduction valve and the lower efficiency boiler.
As this production is greater than the demand, the residual steam is
converted to low pressure steam. The low pressure steam demand is
attended by the production of the lower efficiency turbine and the con-
verted middle pressure steam. The steam excess is discarded by the
middle and low pressure escape valves.

Figure 6.12 shows the variables involved to attend to the refrig-
eration demands. As can be seen the CHP, the solar water heater and



100 6. Sugar Cane Industry Case

0 5 10 15 20

Time (h)

0

200

400

600
E

n
e

rg
y
 (

M
W

h
)

Contract Energy Goal (MWh)
Total Energy Produced(MWh)
Turbines Energy(MWh)
Demand(MWh)

0 5 10 15 20

Time (h)

0

5

10

15

20

25

P
o

w
e

r 
(M

W
)

Better Eff. Turbine Power (MW)
Lower Eff. Turbine Power (MW)

Figure 6.7: Electric power generation of the original system

0 5 10 15 20

Time (h)

5000

6000

7000

8000

9000

10000

P
o
w

e
r 

(k
W

)

Power Demand
Demand Reference

0 5 10 15 20

Time (h)

60

80

100

120

140

160

180

S
te

a
m

 F
lo

w
 (

M
g
 /
 h

) Middle Pressure Steam Demand
Middle Pressure Steam Demand Reference

0 5 10 15 20

Time (h)

100

150

200

250

300

S
te

a
m

 F
lo

w
 (

M
g
 /
 h

) Low Pressure Steam Demand
Low Pressure Steam Demand Reference

0 5 10 15 20

Time (h)

40

60

80

100

120

140

160

C
o
ld

 W
a
te

r 
F

lo
w

 (
m3

/
h
)

Cold Water Flow Demand
Cold Water Flow Demand Reference

Figure 6.8: Fulfillment of the Demands

the heat exchanger are responsible for production. The water chiller is
responsible for consuming the hot water and attend the refrigeration
demand. The tank escape valve was not used because, as shown in
figure 6.9, the hot water tank level does not reach the maximum level.

Table 6.7 evidences the energy gains and approximate economic
profit of using the CHP, the photovoltaic panels, and the wind turbine
in a daily simulation. It was considered the average biogas production
of 3750?h, from the anaerobic digestion of the vinasse and the Megawatt
average price as R$386.66. As expected the gain of the non dispatch-
able sources depends on the weather condition that changes over the
year and presents stochastic behaviors as wind gusts and cloudy days.
Among the non dispatchable sources the wind turbine contributes with



6.3. Optimization Problems 101

0 5 10 15 20

Time (h)

40

60

80

Battery Bank (%)

0 5 10 15 20

Time (h)

20

40

60

80

Bagasse Stock (%)

Straw Stock (%)

0 5 10 15 20

Time (h)

40

60

80

100

Compressed Biogas Stock (%)

Hot Water Tank (%)

Figure 6.9: Stocks of the proposed system

0 5 10 15 20

Time (h)

0.4

0.6

0.8

1
Alfa

A
 (-)

Alfa
B

 (-)

0 5 10 15 20

Time (h)

0

1000

2000
QE

A
 (Mg/h)

QE
B

 (Mg/h)

0 5 10 15 20

Time (h)

0

1000

2000 Str
in

 - Straw Income Flow (Mg/h)

Str
out

 - Straw Outcome Flow (Mg/h)

Figure 6.10: Blending Factors of the proposed system

more energy and consequently more economic profit.
A series of daily simulation scenarios, considering different predic-

tion errors are detailed in table 6.8. It is important to notice that the
total energy generation, in these simulations, has been set within a lim-
ited percentage (5 %) to the reference set-point production of 384MWh
per day. Analyzing the table data it is possible to see that the predic-
tion error in the renewable energy sources practically did not affected
the total energy generation. This occurs because the turbines and the
CHP compensated the energy loss.



102 6. Sugar Cane Industry Case

0 5 10 15 20

Time (h)

0

100

200

300

S
te

a
m

 F
lo

w
 (

M
g

/h
)

High-middle pressure reduction valve
Middle-low pressure reduction valve

0 5 10 15 20

Time (h)

0

50

100

S
te

a
m

 F
lo

w
 (

M
g

/h
)

Lower Efficiency Boiler
Lower Efficiency Turbine

0 5 10 15 20

Time (h)

0

20

40

60

S
te

a
m

 F
lo

w
 (

M
g

/h
)

Middle pressure steam escape
Low pressure steam escape

Figure 6.11: Variables involved in steam production (proposed scenario)

0 5 10 15 20

Time (h)

-150

-100

-50

0

50

W
a

te
r 

F
lo

w
 (

m
3
/h

)

Water chiller
Solar Water Heater
CHP

0 5 10 15 20

Time (h)

0

50

100

150

W
a

te
r 

F
lo

w
 (

m
3
/h

) Heat exchanger
Escape tank

Figure 6.12: Variables involved in hot water production (proposed scenario)

6.4 Final Remarks

In this chapter the study of a hybrid power plant based on a sugar
cane industry was discussed. First the original process was described
and after a new structure was proposed in order to increase and diver-
sify the use of renewable energy and maximize the reuse of the sugar
cane residues. The proposed system became more complex than the
original and use the renewable sources and residues to attend a multi
carrier demands, being electrical, steam in different pressure levels and
cold water for refrigeration. The energy hubs framework was applied
to model the system. A two-level hierarchical MPC control structure
was proposed to perform the electric energy production optimization,
management of storage and subsystems and biomass blending opti-
mization. As showed by the simulation results, the proposed control



6.4. Final Remarks 103

Table 6.7: Full-Month Simulation Scenario Details

Subsystem Power Gains Economic Gains

CHP 61.39 MWh R$23, 738.00

Photovoltaic Panels

High Insolation 12.36 MWh R$4, 780.00
Medium Insolation 9.51 MWh R$3, 677.00
Low Insolation 6.34 MWh R$2, 451.00

Wind Turbine

High Wind Speed 52.62 MWh R$20, 346.00
Medium Wind Speed 29.66 MWh R$11, 470.00
Low Wind Speed 16.61 MWh R$6, 423.00

Table 6.8: Different Daily Simulation Scenarios

Error (%) Non-dispatchable Renewable Energy Total Energy Generation
1% 42.573MWh 395.60MWh
2% 42.143MWh 395.50MWh
5% 40.853MWh 395.10MWh
10% 38.703MWh 395.26MWh
15% 36.553MWh 395.33MWh
20% 34.400MWh 394.96MWh
25% 32.252MWh 394.66MWh
35% 30.108MWh 394.86MWh

structure presented satisfactory results. In the chapter 7, conclusions
about this thesis and future work are discussed.



104 6. Sugar Cane Industry Case



Chapter 7

Conclusions and Future
Works

This thesis addressed the problem of energy management in mi-
crogrids including renewable energy, which is an important research
subject and interest of many countries since increasingly seeking of a
sustainable world. Different MPC based solutions were presented tak-
ing into account the characteristic of the studied systems.

First the integration of a V2G system with an experimental mi-
crogrid was discussed. A hierarchical control structure was developed
to perform the energy management including the different equipment
dynamics and control objectives. The proposed controller got good
results under sunny, cloudy and windy weather conditions.

Other theme addressed in this thesis was the problem of con-
trolling networked microgrids. For this issue a hybrid distributed MPC
was developed. In the proposed approach the MIQP original local prob-
lem was solved by a binary search algorithm that performs a sequence
of quadratic programmings and the algorithm distributed nature was
considered to coordinate the solution of the binary variables during the
iteration procedure. The proposed framework showed a good perfor-
mance in a simulation scenario with different weather conditions and
in presence of faults.

Finally the Brazilian energy production scenario was explored.
A sugar cane industry power plant was studied and a new structure
was proposed, where non-dispatchable renewable sources and reuse of
biomass were included in the plant structure. This power system is
composed by different energy carriers which is a challenge to the con-



106 7. Conclusions and Future Works

trol algorithm. The proposed controller had the objective to manage
different energy sources, meeting the demands and performing the op-
timization of bagasse and straw mixture.

7.1 Contributions

The main contributions of this thesis can be highlighted as follows:

• The development of a hybrid distributed MPC framework, where
the effect of subsystems interaction in the binary variables deci-
sions is taken into account.

• The study of the integration of a microgrid with electric vehicles
charging stations in a V2G philosophy. The proposed charging
station management proved very useful to manage the charge of
electric vehicles and their batteries usage as a storage to help on
the energy fluctuation mitigation.

• A MPC strategy was proposed to deal with the switching between
an electrolyzer and a fuel cell in a microgrid taking into account
the switching constraints providing an optimized solution to the
hydrogen storage management problem.

• The insertion of a MLD formulation on the MPC objective func-
tion of the microgrid to manage the energy sell/purchase with
the distribution network operator (DNO), which proved to be an
interesting solution.

• The use of the hybrid DMPC as energy management system to
the problem of networked microgrids based on renewable energy
sources appeared as a good solution to perform the economic
energy management and guarantee the cooperation between mi-
crogrids in different weather and operating conditions.

• The integration of the sugar cane power plant with non-dispatcha-
ble renewable sources, the use of biogas (generated from vinasse
fermentation) with the CHP to generate energy and heat and
the mix between the bagasse and straw to improve the boilers
calorific power proved to be a sustainable solution once perform
the maximum use of the energy sources to generate electricity,
steam and cold water. The use of energy hubs to model the
proposed system was very efficient once this methodology allows
to integrate different energy carriers in the same model.



7.1. Contributions 107

• The development of a two-level hierarchical MPC strategy to per-
form the management of different energy carriers. The proposed
controller presented good results ensuring the electric energy pro-
duction, managing the use of renewable energies and performing
the biomass blending optimization.

As a result of the study of energy management of renewable energy
based microgrids presented in the thesis the following publications were
produced:

• Mendes P. R. C., Normey-Rico J. E., Bordons C.. Economic
Energy Management of a Microgrid Including Electric Vehicles.
Innovative Smart Grid Technologies Latin America, 2015, Mon-
tevideo - Uruguay.

• Mendes P. R. C., Normey-Rico J. E., Valverde L., Bordons C..
Gestio?n Energe?tica de una Micro Red acoplada a un sistema V2G.
XXXVI Jornadas de Automa?tica, 2015, Bilbao - Spain.

• Mendes P. R. C., Maestre J. M., Normey-Rico J. E., Bordons
C.. Binary Search Algorithm for Mixed Integer Optimization:
Application to energy management in a microgrid. European
Control Conference, 2016, Alborg - Denmark.

• Mendes P. R. C., Valverde L., Bordons C., Normey-Rico J. E..
Energy Management of an Experimental Microgrid coupled to a
V2G system. Journal of Power Sources.

• Mendes P. R. C., Bordons C., Normey-Rico J. E.. Distributed
MPC for Energy Management of V2G Networked Microgrids.
IEEE Transactions on Sustainable Energy. (under review)

• Mendes P. R. C., Maestre J. M., Bordons C., Normey-Rico J.
E.. Hybrid Distributed MPC. Journal of Process Control. (under
review)

• Morato M. M., Mendes P. R. C., Bertol D. W., Cembranel D.,
Bordons C., Normey-Rico J. E.. Estudo de uma Planta H??brida de
Gerac?a?o de Energia na Indu?stria da Cana-de-ac?u?car. Congresso
Brasileiro de Automa?tica, 2016, Vito?ria - Brazil.

• Morato M. M., Mendes P. R. C., Bertol D. W., Cembranel D.,
Bordons C., Normey-Rico J. E.. Efficient Hybrid Generation
Power Plants in the Sugar Cane Industry. Renewable Energy.
(under review)



108 7. Conclusions and Future Works

• Morato M. M., Mendes P. R. C., Normey-Rico J. E. , Bordons C..
Optimal Operation of Hybrid Power Systems Including Renew-
able Sources in the Sugar Cane Industry. IET Renewable Power
Generation.

During the period of Ph.D. studies about subspace predictive con-
trol were carried out and the following works were published:

• Mendes P. R. C., Normey-Rico J. E., Joa?o V. Jr.. A Bilinear FSP-
SPC in a Solar Desalination Plant Collector Field. International
Renewable Energy Congress (IREC), 2014, Hammamet - Tunisia;

• Mendes P. R. C., Normey-Rico J. E., Joa?o V. Jr., Cruz D. M..
A Filtered Smith predictor based subspace predictive controller.
19th World Congress of the International Federation of Automatic
Control, Cape Town, South Africa.

7.2 Future Work

The energy management of microgrids is an interesting and open
research area involving different fields of knowledge. With respect to
the solutions presented in this thesis remarkable future research topics
are:

• The investigation of methods to accelerate the convergence of the
proposed hybrid DMPC is an important issue thinking in the
application in a greater networked microgrids scenario.

• The comparison of the proposed hybrid DMPC with other dis-
tributed MPC algorithms.

• The investigation of the effect of weather prediction errors in the
Hybrid DMPC and integration with robust and stochastic strate-
gies to deal with this matter.

• The investigation of the energy management of charging stations
with renewable energy sources and their impact in the charge
electricity price taken into account the Brazilian market.

• The study of integrate many sugar cane power plants of the same
company to cooperate each other and attend a multi objective
contract. In many cases one company is the owner of many sugar
cane processing plants and it is expected that with this integration



7.2. Future Work 109

it is possible to attend a given contract by the overall company
instead of isolated contracts for each power plant. This way the
amount of energy sold to DNO as well as the economic gains tend
to increase.



110 7. Conclusions and Future Works



Appendix A

Simulation Parameters

A.1 Laboratory Microgrid Control

MPC1 - Model
?B = 1.08×10

?5

?FCH2,e = 8.55×10
?6

?Ee,H2 = 2.97×10
?6

?Bev1 = 2.3×10
?3

?Bev2 = 2.3×10
?3

?Bev3 = 2.3×10
?3

?Bev4 = 2.3×10
?3

MPC1 - Tuning Parameters

Np1 = 5 Nc1 = 2 Qu1 = diag

?

?

?

?

0 3 1 2 0

0 0 0 0 2

?

?

?

?

Qx1 = diag
([

5×108 1 0 0 0 0
])

Q?u1 = diag(

?

?

0 0 0 1 0

0 0 0 100 1

?

?

QTarget1 =diag

?

?

?

?

0 100 60 1000 100

10000 100 10000 0 0

?

?

?

?

Q??1 = 100

MPC1 - Constraints
x1 = diag

([

20 20 0 0 0 0
])

x1 = diag
([

95 95 100 100 100 100
])



112 A. Simulation Parameters

u1 = diag

?

?

?

?

0 ?1600 ?900 ?900 ?100

?100 ?100 ?100 0 0

?

?

?

?

u1 = diag

?

?

?

?

4650 6000 900 900 100

100 100 100 1 900

?

?

?

?

MPC2 - Model
?B = 1.1×10

?3

?FCH2,e = 0.85×10
?3

?Ee,H2 = 0.3×10
?3

?Bev1 = 2.31×10
?1

?Bev2 = 2.31×10
?1

?Bev3 = 2.31×10
?1

?Bev4 = 2.31×10
?1

MPC2 - Tuning Parameters

Np2 = 12 Nc2 = 5 Qu2 = diag

?

?

?

?

1×109 0 0 0 0 0

0 0 0 0 0 0

?

?

?

?

Qx2 = diag
([

10 1 0 0 0 0
])

Q?u2 = diag

?

?

?

?

0 0 0 0 10 10

10 10 0 0 0 0

?

?

?

?

QTarget2 = diag

?

?

?

?

1×109 0 0 0 0 0

0 0 0 0 0 0

?

?

?

?

Q??2 = 100

MPC2 - Constraints
x2 = diag

([

20 20 0 0 0 0
])

x2 = diag
([

95 95 100 100 100 100
])

u2 = diag

?

?

?

?

0 ?1600 ?900 ?900 ?100 ?100

?100 ?100 0 0 0 0

?

?

?

?

u2 = diag

?

?

?

?

4650 6000 900 900 100 100

100 100 1 1 6000 900

?

?

?

?



A.2. Networked Microgrids 113

A.2 Networked Microgrids

Tuning Parameters

Np = 6 Nc = 2 Q1,2,3,4 = diag

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

qsale 1 0 0 0

0 0 0 0 0

0 0 0 0 0

0 0 0 0 0

0 0 0 0 0

0 0 qpurchase?qsale 1 0

0 0 0 0 0

0 0 0 0 0

0 0

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

Qx1,2,3,4 = diag

?

?

?

?

0.1 0 0 0 0

0 0 0 0 0

?

?

?

?

Constraints

x1,2,3,4 = diag

?

?

?

?

20 0 0 0 0

0 0 0 0 0

?

?

?

?

x1,2,3,4 = diag

?

?

?

?

95 100 100 100 100

100 100 100 100 100

?

?

?

?

u1,2,3,4 = diag

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?50 ?1 ?0.06 ?0.06 ?0.06

?0.06 ?0.06 ?0.06 ?0.06 ?0.06

?0.06 ?0.06 0 0 0

0 0 0 0 0

0 0 0 0 0

0 0 0 1 0

0 0 0 0 0

0 0 0 0 0

0 0

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

u1,2,3,4 = diag

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

50 1 0.06 0.06 0.06

0.06 0.06 0.06 0.06 0.06

0.06 0.06 10 10 10

1 1 1 1 1

1 1 1 1 1

1 1 50 1 0.06

0.06 0.06 0.06 0.06 0.06

0.06 0.06 0.06 0.06 10

10 10

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?

?



114 A. Simulation Parameters

A.3 Sugar Cane Industry Case

Tuning Parameters

Np = 12 Nc = 5 qu =

?

?

?

?

0.3 0.6 0 10 0.4 5 5

0.01 0 10

0.5 0.35 2×106

?

?

?

?

Qx = diag
([

0.3 0 0 0 0
])

q? = 1×10
3

QP = 0.5

Constraints
x = diag

([

10 10 10 10 10
])

x = diag
([

100 100 100 100 100
])

u = diag

?

?

?

?

?

?

?

?

11×103 3×103 0 0 0

0 0 800 0 0

?3×103 0 0

?

?

?

?

?

?

?

?

u = diag

?

?

?

?

?

?

?

?

27×103 2×104 0 1×107 0

0 0 8×103 0 0

3×103 0 0

?

?

?

?

?

?

?

?



Bibliography

[1] I. Alvarado, D. Limon, D. Mun?oz de la Pen?a, J.M. Maestre, M.A.
Ridao, H. Scheu, W. Marquardt, R.R. Negenborn, B. De Schut-
ter, F. Valencia, and J. Espinosa. A comparative analysis of dis-
tributed mpc techniques applied to the hd-mpc four-tank bench-
mark. Journal of Process Control, 21(5):800 – 815, 2011. doi:
10.1016/j.jprocont.2011.03.003. Special Issue on Hierarchical and
Distributed Model Predictive Control.

[2] J. M. Alves. Paradigma te?cnico e co-gerac?a?o de energia com
bagac?o de cana de ac?u?car em goia?s / technical paradigm and
energy cogeneration from sugarcane bagasse in goia?s. Proceedings
of the 6. Encontro de Energia no Meio Rural, 2006.

[3] D. Anderson and M. Leach. Harvesting and redistributing renew-
able energy: on the role of gas and electricity grids to overcome
intermittency through the generation and storage of hydrogen.
Energy Policy, 32(14):1603 – 1614, 2004. doi: 10.1016/S0301-
4215(03)00131-9.

[4] M. Arnold, R. R. Negenborn, G. Andersson, and B. De Schutter.
Model-based predictive control applied to multi-carrier energy
systems. In Power Energy Society General Meeting, 2009. PES
’09. IEEE, pages 1–8, 2009. doi: 10.1109/PES.2009.5275230.

[5] S. Bashash and H. Fathy. Robust demand-side plug-in electric
vehicle load control for renewable energy management. Amer-
ican Control Conference (ACC), pages 929–934, 2011. doi:
10.1016/S0005-1098(98)00178-2.

[6] J. Batut and A. Renaud. Daily generation scheduling optimiza-
tion with transmission constraints: a new class of algorithms.
IEEE Transactions on Power Systems, 7:982 – 989, 1992.



116 BIBLIOGRAPHY

[7] A. Bemporad and M. Morari. Control of systems integrating logic,
dynamics, and constraints. Automatica, 35(3):407–427, 1999. doi:
10.1016/S0005-1098(98)00178-2.

[8] D. P. Bertsekas. Constrained Optimization and Lagrange Multi-
plier Methods. Athena Scientific, 1996.

[9] D. P. Bertsekas and J. N. Tsitsiklis. Distributed Computation:
Numerical Methods. Athena Scientific, New Hampshire, 1997.

[10] A. Bidram and A. Davoudi. Hierarchical structure of microgrids
control system. IEEE Transactions on Smart Grid, 3(4):1963–
1976, 2012. doi: 10.1109/TSG.2012.2197425.

[11] A. M. Borbely and J. F. Kreid. Distributed Generation: The
Power Paradigm for the New Millennium. CRC Press, Boca Ra-
ton, 2001.

[12] C. Bordons, F. Garcia-Torres, and L. Valverde. Optimal energy
management for renewable energy microgrids. Revista Iberoamer-
icana de Automatica e Informatica industrial, 12(2):117–132,
2015. doi: 10.1016/j.riai.2015.03.001.

[13] R. Bourdais and H. Gue?guen. Distributed predictive control
for complex hybrid system. the refrigeration system example.
Large Scale Complex Systems Theory and Applications, 9:388–
394, 2010. doi: 10.3182/20100712-3-FR-2020.00065.

[14] Allal M. Bouzid, Josep M. Guerrero, Ahmed Cheriti, Mohamed
Bouhamida, Pierre Sicard, and Mustapha Benghanem. A survey
on control of electric power distributed generation systems for mi-
crogrid applications. Renewable and Sustainable Energy Reviews,
44:751 – 766, 2015. doi: 10.1016/j.rser.2015.01.016.

[15] M. C. Bozchalui, S. A. Hashmi, H. Hassen, C. A. Can?izares, and
K. Bhattacharya. Optimal operation of residential energy hubs in
smart grids. Smart Grid, IEEE Transactions on, 3(4):1755–1766,
2012.

[16] K. De Brabandere, K. Vanthournout, J. Driesen, G. Deconinck,
and R. Belmans. Control of microgrids. In Power Engineer-
ing Society General Meeting, 2007. IEEE, pages 1–7, 2007. doi:
10.1109/PES.2007.386042.



BIBLIOGRAPHY 117

[17] E. Camacho and C. Bordons. Model Predictive Control. Springer,
London, 2007.

[18] E. Camponogara, D. Jia, B. H. Krogh, and S. Talukdar. Dis-
tributed model predictive control. IEEE Control Systems, 22(1):
44–52, 2002. doi: 10.1109/37.980246.

[19] S. Chakraborty, M. D. Weiss, and M. G. Simoes. Distributed
intelligent energy management system for a single-phase high-
frequency ac microgrid. IEEE Transactions on Industrial Elec-
tronics, 54(1):97–109, 2007. doi: 10.1109/TIE.2006.888766.

[20] P. D. Christofides, R. Scattolini, D. M. de la Pen?a, and
J. Liu. Distributed model predictive control: A tu-
torial review and future research directions. Comput-
ers &amp;amp; Chemical Engineering, 51:21 – 41, 2013. doi:
http://dx.doi.org/10.1016/j.compchemeng.2012.05.011.

[21] S. Cristea, C. de Prada, D. Sarabia, and G. Gutie?rrez. Aera-
tion control of a wastewater treatment plant using hybrid nmpc.
Computers &amp;amp; Chemical Engineering, 35(4):638 – 650, 2011. doi:
http://dx.doi.org/10.1016/j.compchemeng.2010.07.021.

[22] D. N. Dantas. Uso da biomassa de cana-de-ac?u?car para gerac?a?o
de energia ele?trica: ana?lise energe?tica, exerge?tica e ambiental de
sistemas de cogerac?a?o em sucroalcooleiras do interior paulista /
Use of biomass sugarcane to generate electricity: energy analysis,
exergetic and environmental cogeneration systems in sugarcane in
Sa?o Paulo State. PhD thesis, Universidade de Sa?o Paulo, 2010.

[23] Ministe?rio de Minas e Energia. Redes ele?tricas inteligentes: con-
texto nacional / smart grids: national context. Technical report,
Ministe?rio de Minas e Energia, 2012.

[24] Ministe?rio de Minas e Energia. Plano decenal de expansa?o de
energia 2024. Technical report, Ministe?rio de Minas e Energia,
2014.

[25] Ministe?rio de Minas e Energia. Redes ele?tricas inteligentes dia?logo
setorial brasil-unia?o europeia (2014)´/ smart grids dialogue sector
brazil-european union (2014). Technical report, Ministe?rio de
Minas e Energia, 2014.



118 BIBLIOGRAPHY

[26] Ministe?rio de Minas e Energia. Resenha energe?tica brasileira:
Exerc??cio de 2014 / brazilian energy review: Year 2014. Technical
report, Ministe?rio de Minas e Energia, 2015.

[27] C. de Prada, I. Grossmann, D. Sarabia, and S. Cristea. A
strategy for predictive control of a mixed continuous batch pro-
cess. Journal of Process Control, 19(1):123 – 137, 2009. doi:
http://dx.doi.org/10.1016/j.jprocont.2008.01.004.

[28] S. Deilami, A. S. Masoum, P. S. Moses, and M. Masoum.
Real-time coordination of plug-in electric vehicle charging in
smart grids to minimize power losses and improve voltage pro-
file. IEEE Trans. on Smart Grid, 2(3):456–467, 2011. doi:
10.1109/TSG.2011.2159816.

[29] A. J. del Real. An Integrated Framework for Distributed Model
Predictive Control of Large Scale Networks - Applications to
Power Networks. PhD thesis, Universidad de Sevilla, 2011.

[30] A. J. del Real, A. Arce, and C. Bordons. Hybrid model predictive
control of a two-generator power plant integrating photovoltaic
panels and fuel cell. IEEE Conference on Decision and Control,
pages 5447–5452, 2007. doi: 10.1109/CDC.2007.4434550.

[31] A. J. del Real, M. D. Galus, C. Bordons, and G. Andersson. Op-
timal power dispatch of energy networks including external power
exchange. European Control Conference (ECC), pages 3616–3621,
2009.

[32] A. J. del Real, A. Arce, and C. Bordons. An integrated frame-
work for distributed model predictive control of large-scale power
networks. IEEE Transactions on Industrial Informatics, 10(1):
197–209, 2014. doi: 10.1109/TII.2013.2273877.

[33] R. Dell and D. Rand. Energy storage: a key technology for global
energy sustainability. Journal of Power Sources, 100(1):2–17,
2001. doi: 10.1016/S0378-7753(01)00894-1.

[34] W.B. Dunbar and R.M. Murray. Model predictive control of co-
ordinated multi-vehicle formations. Proceedings of the 41st IEEE
Conference on Decision and Control, pages 4631 – 4636, 2002.

[35] F. Ekardt and H. Von Bredow. Extended emissions trading ver-
sus sustainability criteria: Managing the ecological and social



BIBLIOGRAPHY 119

ambivalences of bioenergy. Renewable Energy L. &amp;amp; Pol’y Rev.,
page 49, 2012.

[36] Z. Fan. A distributed demand response algorithm and
its application to phev charging in smart grids. IEEE
Transactions on Smart Grid, 3(3):1280–1290, 2012. doi:
10.1109/TSG.2012.2185075.

[37] M. Fathi and H. Bevrani. Adaptive energy consumption schedul-
ing for connected microgrids under demand uncertainty. IEEE
Transactions on Power Delivery, 28(3):1576–1583, 2013. doi:
10.1109/TPWRD.2013.2257877.

[38] G. Ferrari-Trecate, E. Gallestey, P. Letizia, M. Spedicato,
M. Morari, and M. Antonine. Modeling and control of co-
generation power plants: a hybrid system approach. IEEE Trans-
actions on Control Systems Technology, 12(5):694–705, 2004. doi:
10.1109/TCST.2004.826958.

[39] M. V. A. Costa Filho. Modelagem, controle e otimizac?a?o de pro-
cessos da indu?stria do etanol / Modeling, control and optimization
of processes in the ethanol industry. PhD thesis, Universidade
Federal de Santa Catarina, 2013.

[40] J. R. D. Frejo. Model Predictive Control for Freeway Traffic Net-
works. PhD thesis, University of Seville, 2015.

[41] Q. Fu, A. Hamidi, A. Nasiri, V. Bhavaraju, S. B. Krstic,
and P. Theisen. The role of energy storage in a microgrid
concept: Examining the opportunities and promise of micro-
grids. IEEE Electrification Magazine, 1(2):21–29, 2013. doi:
10.1109/MELE.2013.2294736.

[42] M. D. Galus and G. Andersson. Power system considerations
of plug-in hybrid electric vehicles based on a multi energy carrier
model. In Power Energy Society General Meeting, 2009. PES ’09.
IEEE, pages 1–8, July 2009. doi: 10.1109/PES.2009.5275574.

[43] M. D. Galus and G. A. Simon Art. A hierarchical, distributed
pev charging control in low voltage distribution grids to ensure
network security. Power and Energy Society General Meeting,
2012 IEEE, pages 1–8, 2012. doi: 10.1109/PESGM.2012.6345024.

[44] M. D. Galus, R. La Fauci, and G. Andersson. Investigating phev
wind balancing capabilities using heuristics and model predictive



120 BIBLIOGRAPHY

control. Power and Energy Society General Meeting, 2010 IEEE,
pages 1–8, 2010. doi: 10.1109/PES.2010.5589267.

[45] F. Garcia-Torres and C. Bordons. Optimal economical sched-
ule of hydrogen-based microgrids with hybrid storage using
model predictive control. Industrial Electronics, IEEE Trans-
actions on, 62(8):5195–5207, Aug 2015. ISSN 0278-0046. doi:
10.1109/TIE.2015.2412524.

[46] F. Garcia-Torres, L. Valverde, and C. Bordons. Optimal load
sharing of hydrogen-based microgrids with hybrid storage using
model predictive control. IEEE Transactions on Industrial Elec-
tronics, PP(99):1–1, 2016. doi: 10.1109/TIE.2016.2547870.

[47] M. Gautschi, O. Scheuss, and C. Schluchter. Simulation of
an agent based vehicle-to-grid (v2g) implementation. Elec-
tric Power Systems Research, 120:177 – 183, 2009. doi:
http://dx.doi.org/10.1016/j.epsr.2014.05.016.

[48] M. Geidl. Integrated Modeling and Optimization of Multi-Carrier
Energy Systems. PhD thesis, ETH, Zurich, 2007.

[49] M. Geidl, G. Koeppel, P. Favre-Perrod, B. Klockl, G. Andersson,
and K. Frohlich. Energy hubs for the future. EEE Power and
Energy Magazine, 2007.

[50] D. Georges. Decentralized adaptive control for a water distribu-
tion system. 3rd IEEE Conference on Control Applications, pages
1411 – 1416, 1999.

[51] D. Giaouris, A. I. Papadopoulos, C. Ziogou, D. Ipsakis, S. Voute-
takis, S. Papadopoulou, P. Seferlis, F. Stergiopoulos, and C. El-
masides. Performance investigation of a hybrid renewable
power generation and storage system using systemic power
management models. Energy, 61:621 – 635, 2013. doi:
http://dx.doi.org/10.1016/j.energy.2013.09.016.

[52] A. Di Giorgio, F. Liberati, and S. Canale. Electric vehicle
charging control in smartgrids: A model predictive control ap-
proach. Control Engineering Practice, 22:147–162, 2014. doi:
http://dx.doi.org/10.1016/j.conengprac.2013.10.005.

[53] J. R. P. Gonzalez. Libro Blanco de la Automatizacio?n y Con-
trol en la Industria de la Can?a de Azu?car, volume 1. Pro-
grama Iberoamericano de Ciencia y Tecnologia para el Desarrollo
(CYTED), 2011.



BIBLIOGRAPHY 121

[54] W. Greenwell and A. Vahidi. Predictive control of voltage
and current in a fuel cell-ultracapacitor hybrid. IEEE Trans-
actions on Industrial Electronics, 57(6):1954–1963, 2010. doi:
10.1109/TIE.2009.2031663.

[55] W. Gu, Z. Wu, and X. Yuan. Microgrid economic optimal op-
eration of the combined heat and power system with renewable
energy. IEEE Power and Energy Society General Meeting, pages
1–6, 2010. doi: 10.1109/PES.2010.5590140.

[56] M. Heidarinejad, J. Liu, and P. D. Christofides. Distributed
model predictive control of switched nonlinear systems with
scheduled mode transitions. AIChE Journal, 59(3):860–871, 2013.
doi: 10.1002/aic.14003.

[57] M. Hestenes. Multiplier and gradient methods. Journal of Opti-
mization Theory and Applications, 4:303 – 320, 1969.

[58] IBM ILOG. Cplex. 2007.

[59] D. Ipsakis, S. Voutetakis, P. Seferlis, F. Stergiopoulos, S. Pa-
padopoulou, and C. Elmasides. The effect of the hystere-
sis band on power management strategies in a stand-alone
power system. Energy, 33(10):1537 – 1550, 2008. doi:
http://dx.doi.org/10.1016/j.energy.2008.07.012.

[60] D. Jia and B.H. Krogh. Distributed model predictive control.
American Control Conference, pages 2767 – 2772, 2001.

[61] D. Jia and B.H. Krogh. Min-max feedback model predictive con-
trol for distributed control with communication. American Con-
trol Conference, pages 4507 – 4512, 2002.

[62] H. Jiayi, J. Chuanwen, and X. Rongi. A review on dis-
tributed energy resources and microgrid. Renewable and
Sustainable Energy Reviews, 12(9):2472 – 2483, 2008. doi:
http://dx.doi.org/10.1016/j.rser.2007.06.004.

[63] T. B. Johansson. Renewable energy: sources for fuels and elec-
tricity. Island press, 1993.

[64] R. A. Roma?o Junior. Ana?lise da viabilidade do aproveitamento
da palha da cana de ac?u?car para cogerac?a?o de energia numa usina
sucroalcooleira / feasibility analysis of the use of straw of sugar
cane for energy cogeneration in sugar and alcohol plant. Master’s
thesis, Universidade Estadual Paulista, 2009.



122 BIBLIOGRAPHY

[65] T. Keviczky, F. Borrelli, and G. J. Balas. A study on decentral-
ized receding horizon control for decoupled systems. American
Control Conference, 6:4921 – 4926, 2004.

[66] B. Kim and R. Baldick. Coarse-grained distributed optimal power
flow. IEEE Transactions on Power Systems, 12:932 – 939, 1997.

[67] T. Knudsen, K. Trangbk, and C. Kallese. Plug and play pro-
cess control applied to a district heating system. IFAC World
Congress, 2008.

[68] R. H. Lasseter. Microgrids. IEEE Power Engineer-
ing Society Winter Meeting, 1:305–308, 2002. doi:
10.1109/PESW.2002.985003.

[69] J. Lofberg. Yalmip: A toolbox for modeling and optimiza-
tion in matlab. IEEE International Symposium on Computer
Aided Control Systems Design, pages 284–289, 2004. doi:
10.1109/CACSD.2004.1393890.

[70] J.A. Pec?as Lopes, N. Hatziargyriou, J. Mutale, P. Djapic, and
N. Jenkins. Integrating distributed generation into electric power
systems: A review of drivers, challenges and opportunities. Elec-
tric Power Systems Research, 77(9):1189 – 1203, 2007. doi:
http://dx.doi.org/10.1016/j.epsr.2006.08.016.

[71] J. M. Maestre and R. R. Negenborn. Distributed Model Predictive
Control Made Easy. Springer-Verlag, London, 2014.

[72] J. M. Maestre, M. A. Ridao, A. Kozma, C. Savorgnan, M. Diehl,
M. D. Doan, A. Sadowska, T. Keviczky, B. De Schutter, H. Scheu,
W. Marquardt, F. Valencia, and J. Espinosa. A comparison
of distributed mpc schemes on a hydro-power plant benchmark.
Optimal Control Applications and Methods, 36(3):306–332, 2015.
ISSN 1099-1514. doi: 10.1002/oca.2154.

[73] G. S. C. Magalha?es. Comercializac?a?o de energia ele?trica no ambi-
ente de contratac?a?o livre: Uma ana?lise regulato?rio-institucional a
partir dos contratos de compra e venda de energia ele?trica / Elec-
tricity trading in the free market: a regulatory and institutional
analysis from the purchase and sale of electricity. PhD thesis,
Universidade de Sa?o Paulo, 2009.

[74] Mathworks. Matlab. 2009.



BIBLIOGRAPHY 123

[75] P.R.C. Mendes, J. E. Normey-Rico, and C. Bordons. Economic
energy management of a microgrid including electric vehicles.
Innovative Smart Grid Technologies Latin America ISGT-LA,
pages 869–874, 2015. doi: 10.1109/ISGT-LA.2015.7381269.

[76] H. Morais, P. Ka?da?r, P. Faria, Z. A. Vale, and H.M.
Khodr. Optimal scheduling of a renewable micro-grid in
an isolated load area using mixed-integer linear program-
ming. Renewable Energy, 35(1):151 – 156, 2010. doi:
http://dx.doi.org/10.1016/j.renene.2009.02.031.

[77] N. Nikmehr and S. N. Ravadanegh. Reliability evaluation of
multi-microgrids considering optimal operation of small scale en-
ergy zones under load-generation uncertainties. International
Journal of Electrical Power &amp;amp; Energy Systems, 78:80–87, 2016.
doi: doi:10.1016/j.ijepes.2015.11.094.

[78] R. R. Negenborn. Multi-Agent Model Predictive Control with Ap-
plications to Power Networks. PhD thesis, Delft University of
Technology, 2007.

[79] R. R. Negenborn and J. M. Maestre. Distributed model pre-
dictive control: An overview and roadmap of future research
opportunities. IEEE Control Systems, 34(4):87–97, 2014. doi:
10.1109/MCS.2014.2320397.

[80] R. R. Negenborn, B. De Schutter, and J. Hellendoorn. Multi-
agent model predictive control: A survey. Technical Report, Delft
Center for Systems and Control, 2004.

[81] R. R. Negenborn, B. De Schutter, and J. Hellendoorn. Multi-
agent model predictive control of transportation networks. IEEE
International Conference on Networking, Sensing and Control,
2006.

[82] R. R. Negenborn, M. Houwing, B. De Schutter, and J. Hellen-
doorn. Model predictive control for residential energy resources
using a mixed-logical dynamic model. International Conference
on Networking, Sensing and Control, pages 702–707, 2009. doi:
10.1109/ICNSC.2009.4919363.

[83] N. Nikmehr and S. N. Ravadanegh. Optimal power dis-
patch of multi-microgrids at future smart distribution grids.
IEEE Transactions on Smart Grid, 6(4):1648–1657, 2015. doi:
10.1109/TSG.2015.2396992.



124 BIBLIOGRAPHY

[84] J. E. Normey-Rico and E. F. Camacho. Control of Dead-Time
Processes. Springer, Berlin, 2007.

[85] H.S.V.S.K. Nunna and S. Doolla. Demand response in
smart distribution system with multiple microgrids. IEEE
Transactions on Smart Grid, 3(4):1641–1649, 2012. doi:
10.1109/TSG.2012.2208658.

[86] D. E. Olivares, A. Mehrizi-Sani, A. H. Etemadi, C. A. Canizares,
R. Iravani, M. Kazerani, A. H. Hajimiragha, O. Gomis-
Bellmunt, A. Saeedifard, R. Palma-Behnke, G. A. Jimenez-
Estevez, and N. D. Hatziargyriou. Trends in microgrid control.
IEEE Transactions on Smart Grid, 5(4):1905–1919, 2014. doi:
10.1109/TSG.2013.2295514.

[87] A. Ouammi, H. Dagdougui, L. Dessaint, and R. Sacile. Coordi-
nated model predictive-based power flows control in a cooperative
network of smart microgrids. IEEE Transactions on Smart Grid,
6(5):2233–2244, 2015. doi: 10.1109/TSG.2015.2396294.

[88] A. Ouammi, H. Dagdougui, and R. Sacile. Optimal control
of power flows and energy local storages in a network of mi-
crogrids modeled as a system of systems. IEEE Transac-
tions on Control Systems Technology, 23(1):128–138, 2015. doi:
10.1109/TCST.2014.2314474.

[89] O. Palizban and K. Kauhaniemi. Hierarchical control
structure in microgrids with distributed generation: Is-
land and grid-connected mode. Renewable and Sus-
tainable Energy Reviews, 44:797 – 813, 2015. doi:
http://dx.doi.org/10.1016/j.rser.2015.01.008.

[90] O. Palizban, K. Kauhaniemi, and J. M. Guerrero. Microgrids in
active network management part i: Hierarchical control, energy
storage, virtual power plants, and market participation. Renew-
able and Sustainable Energy Reviews, 36:428 – 439, 2014. doi:
http://dx.doi.org/10.1016/j.rser.2014.01.016.

[91] A. Parisio and L. Glielmo. A mixed integer linear formulation
for microgrid economic scheduling. In Smart Grid Communica-
tions (SmartGridComm), 2011 IEEE International Conference
on, pages 505–510. IEEE, 2011.



BIBLIOGRAPHY 125

[92] A. Parisio, E. Rikos, and L. Glielmo. A model predictive control
approach to microgrid operation optimization. Control Systems
Technology, IEEE Transactions on, 22(5):1813–1827, 2014. doi:
10.1109/TCST.2013.2295737.

[93] M. Petrollese. Optimal Generation Scheduling for Renewable Mi-
crogrids Using Hydrogen Storage Systems. PhD thesis, University
of Cagliari, 2015.

[94] M. Powell. Ch. A method for nonlinear constraints inminimiza-
tion problems. Academic Press, New York, 1969.

[95] C. Prada, M. Rodriguez, and D. Sarabia. On-line scheduling
and control of a mixed continuous batch plant. Industrial &amp;amp;
Engineering Chemistry Research, 50(9):5041–5049, 2011. doi:
10.1021/ie1014298.

[96] E. E. Rego and F. M. Hernandez. Eletricidade por digesta?o
anaero?bica da vinhac?a de cana-de-ac?u?car: contornos te?cnicos,
econo?micos e ambientais de uma opc?a?o / electricity through
anaerobic digestion of vinasse from sugarcane: technical, eco-
nomic and environmental contours of an option. Proceedings of
the 6. Encontro de Energia no Meio Rural, 2006.

[97] P. Richardson, D. Flynn, and A. Keane. Optimal charging of elec-
tric vehicles in low-voltage distribution systems. IEEE Transac-
tions on Power Systems, 27(1):268–279, 2012. doi: 10.1109/TP-
WRS.2011.2158247.

[98] C. Royo. Generalized Unit Commitment by the Radar Multiplier
Method. PhD thesis, Technical University of Catalonia, 2001.

[99] D. Sarabia, F. Capraro, L. F.S. Larsen, and C. Prada.
Hybrid nmpc of supermarket display cases. Con-
trol Engineering Practice, 17(4):428 – 441, 2009. doi:
http://dx.doi.org/10.1016/j.conengprac.2008.09.003.

[100] R. Scattolini. Architectures for distributed and hierarchical model
predictive control - a review. Journal of Process Control, 19:723
– 731, 2009.

[101] M. Schulze and P. C. Del Granado. Multi-period optimization
of cogeneration systems: Considering biomass energy for district
heating. In 2nd Power Systems Modeling Conference, 2009.



126 BIBLIOGRAPHY

[102] B. De Schutter and B. De Moor. Optimal traffic light control for a
single intersection. European Journal of Control, 4(3):260 – 276,
1998. doi: http://dx.doi.org/10.1016/S0947-3580(98)70119-0.

[103] A. Serna, J. E. Normey-Rico, and F. Tadeo. Model predictive
control of hydrogen production by renewable energy. In Renew-
able Energy Congress (IREC), 2015 6th International, pages 1–6,
2015. doi: 10.1109/IREC.2015.7110959.

[104] S. Shafiee and E. Topal. When will fossil fuel reserves be dimin-
ished. Energy policy, 37(1):181–189, 2009.

[105] W. Shi, X. Xie, C. C. Chu, and R. Gadh. Distributed optimal
energy management in microgrids. IEEE Transactions on Smart
Grid, 6(3):1137–1146, 2015. doi: 10.1109/TSG.2014.2373150.

[106] J. B. M. Sa?nchez. Optimizacio?n de metodolog??as para la carac-
terizacio?n de biocombustibles so?lidos procedentes de la industria
del olivar / optimization methods for the characterization of solid
biofuels from the olive industry, 2015.

[107] C. Sonntag, A. Devanathan, S. Engell, and O. Stursberg. Hy-
brid nonlinear model-predictive control of a supermarket re-
frigeration system. In Control Applications, 2007. CCA 2007.
IEEE International Conference on, pages 1432–1437, 2007. doi:
10.1109/CCA.2007.4389437.

[108] C. Tiba. Atlas Solarimerico do Brasil. Ed. Universita?ria da
UFPE, Recife, Brazil, 2000.

[109] G. Tolentino, H. O. Florentino, and M. M. P. Sartori. Mode-
lagem matema?tica para o aproveitamento da biomassa residual
de colheita da cana-de-ac?u?car com menor custo / mathematical
modeling for the use of residual biomass harvesting of sugarcane
at lower cost. Bragantia, pages 729–735, 2007.

[110] E. Unamuno and J. A. Barrena. Hybrid ac/dc microgridspart
ii: Review and classification of control strategies. Renewable
and Sustainable Energy Reviews, 52:1123 – 1134, 2015. doi:
http://dx.doi.org/10.1016/j.rser.2015.07.186.

[111] T. S. Ustun, C. Ozansoy, and A. Zayegh. Recent developments in
microgrids and example cases around the worlda review. Renew-
able and Sustainable Energy Reviews, 15(8):4030 – 4041, 2011.
doi: http://dx.doi.org/10.1016/j.rser.2011.07.033.



BIBLIOGRAPHY 127

[112] L. Valverde, C. Bordons, and F. Rosa. Power management using
model predictive control in a hydrogen-based microgrid. Annual
Conference on IEEE Industrial Electronics Society, pages 5669–
5676, 2012. doi: 10.1109/IECON.2012.6389059.

[113] L. Valverde, F. Rosa, and C. Bordons. Design, planning and
management of a hydrogen-based microgrid. IEEE Transac-
tions on Industrial Informatics, 9(3):1398–1404, 2013. doi:
10.1109/TII.2013.2246576.

[114] L. Valverde, F. Rosa, A. Del Real, A. Arce, and C. Bor-
dons. Modeling, simulation and experimental set-up of
a renewable hydrogen-based domestic microgrid. Jour-
nal of Hydrogen Energy, 38(27):11672–11684, 2013. doi:
http://dx.doi.org/10.1016/j.ijhydene.2013.06.113.

[115] L. Valverde, C. Bordons, and F. Rosa. Integration of fuel cell tech-
nologies in renewable-energy-based microgrids optimizing opera-
tional costs and durability. IEEE Transactions on Industrial Elec-
tronics, 63(1):167–177, 2016. doi: 10.1109/TIE.2015.2465355.

[116] H. van Ekeren, R. R. Negenborn, P. J. van Overloop, and B. De
Schutter. Hybrid model predictive control using time-instant op-
timization for the rhine-meuse delta. In Networking, Sensing and
Control (ICNSC), 2011 IEEE International Conference on, pages
215–220, 2011.

[117] J. C. Vasquez, J. M. Guerrero, J. Miret, M. Castilla, and L. Gar-
cia de Vicuna. Hierarchical control of intelligent microgrids.
IEEE Industrial Electronics Magazine, 4(4):23–29, 2010. doi:
10.1109/MIE.2010.938720.

[118] A. Venkat, J. Rawlings, and S. Wright. ch. Distributed Model
Predictive Control of Large-Scale Systems Assessment and Future
Directions. Springer-Verlag, Berlin, 2007.

[119] L. F. Viana. Potencial energe?tico do bagac?o e palhic?o de cana-
de-ac?u?car, cv. SP80-1842, em a?rea de alambique artesanal / En-
ergy potential of bagasse and straw of sugarcane cv. SP80-1842
in handmade alembic area. PhD thesis, Universidade Federal de
Lavras, 2014.

[120] L. Wang. Model Predictive Control System Design and Imple-
mentation Using MATLAB. Springer, London, 2009.



128 BIBLIOGRAPHY

[121] Z. Wang, B. Chen, J. Wang, M.M. Begovic, and C. Chen. Co-
ordinated energy management of networked microgrids in distri-
bution systems. IEEE Transactions on Smart Grid, 6(1):45–53,
2015. doi: 10.1109/TSG.2014.2329846.

[122] Z. Wang, B. Chen, J. Wang, and C. Chen. Networked micro-
grids for self-healing power systems. IEEE Transactions on Smart
Grid, 7(1):310–319, 2016. doi: 10.1109/TSG.2015.2427513.

[123] C. Wei, Z.M. Fadlullah, N. Kato, and A. Takeuchi. Gt-
cfs: A game theoretic coalition formulation strategy for reduc-
ing power loss in micro grids. IEEE Transactions on Par-
allel and Distributed Systems, 25(9):2307–2317, 2014. doi:
10.1109/TPDS.2013.178.

[124] X. Xu and X. Zha. Overview of the researches on distributed
generation and microgrid. In International Power Engineering
Conference (IPEC 2007), pages 966–971, 2007.

[125] M. Yazdanian and A. Mehrizi-Sani. Distributed control tech-
niques in microgrids. IEEE Transactions on Smart Grid, 5(6):
2901–2909, 2014. doi: 10.1109/TSG.2014.2337838.

[126] C. Ziogou, D. Ipsakis, C. Elmasides, F. Stergiopoulos, S. Pa-
padopoulou, P. Seferlis, and S. Voutetakis. Automation in-
frastructure and operation control strategy in a stand-alone
power system based on renewable energy sources. Jour-
nal of Power Sources, 196(22):9488 – 9499, 2011. doi:
http://dx.doi.org/10.1016/j.jpowsour.2011.07.029.


</field>
	</doc>
</add>