<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.06119</field>
		<field name="filename">10631_7500.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">Departamento de
Universidade de Aveiro Electrónica, Telecomunicações e Informática
Diogo Rafael Castanheira Santos Soares
Um ambiente para a integração de dados de prescrição eletrónica
Departamento de
li! Universidade de Aveiro Electrónica, Telecomunicações e Informática
□ 2012
Diogo Rafael Castanheira Santos Soares
Um ambiente para a integração de dados de prescrição eletrónica
Dissertação apresentada à Universidade de Aveiro para cumprimento dos requisitos necessários à obtenção do grau de Mestre em Engenharia de Computadores e Telemática (M.I.E.C.T.), realizada sob a orientação científica do Professor Doutor João Paulo Trigueiros da Silva Cunha, Professor Associado com Agregação do Departamento de Engenharia Eletrotécnica e de Computadores da Faculdade de Engenharia da Universidade do Porto e do Mestre Ilídio Fernando de Castro Oliveira, Professor Assistente Convidado do Departamento de Eletrónica, Telecomunicações e Informática da Universidade de Aveiro
o júri/thejury
presidente / president	Professora Doutora Maria Beatriz Alves de Sousa Santos Professora Associada com Agregação da Universidade de Aveiro
vogais / examiners committee	Doutora Liliana da Silva Ferreira Investigadora Sénior, Instituto Fraunhofer - Portugal (Arguente Principal) Prof. Doutor João Paulo Trigueiros da Silva Cunha Professor Associado com Agregação do Departamento de Engenharia Eletrotécnica e de Computadores da Faculdade de Engenharia da Universidade do Porto (orientador) Mestre Ilídio Fernando de Castro Oliveira Professor Assistente Convidado do Departamento de Eletrónica, Telecomunicações e Informática da Universidade de Aveiro (co-orientador)
agradecimentos / acknowledgements	Agradeço à minha família pelo apoio que sempre me deram, por me terem proporcionado todas as condições que me possibilitaram a obtenção de uma formação académica. À Mestre Lúcia Mota, pelo apoio e disponibilidade ao longo de todo o projeto. Ao Prof. Ilídio Oliveira e ao Prof. João Paulo Cunha, pelo apoio e disponibilidade fulcrais à elaboração deste trabalho.
Palavras-chave	Engenharia de software, sistemas de informação, portais web, e-Saúde, prescrição eletrónica, resumo clínico do utente
Resumo	Hoje em dia não é possível, no sistema de saúde português, ter uma visão integrada da prescrição de medicamentos de um utente. O histórico da medicação, por si só, pode dar a um profissional clínico as pistas suficientes para aferir o contexto clínico de um utente que observa pela primeira vez ou num contacto de emergência, por exemplo. Este tipo de informação é frequentemente incluído em iniciativas de redes de partilha de sumários clínicos, como é o caso do projeto epSOS, visando a transmissão transfronteiriça de informação clínica essencial dos utentes, atendidos num país diferente daquele em que recebem cuidados habitualmente. A Rede Telemática da Saúde (RTS) é uma plataforma eletrónica que permite a agregação de informação clínica dos utentes, de forma controlada. É possível, nesta plataforma, obter uma lista de episódios de tratamento para um utente e, a partir de cada um, procurar informação de prescrição de medicamentos. Paralelamente, no contexto da iniciativa nacional para prescrição eletrónica, existe já um repositório de prescrições (mais especificamente, receitas aviadas) de âmbito nacional. Este repositório não inclui, contudo, algumas prescrições resultantes de episódios de tratamento de agudos. No âmbito deste trabalho, propomos uma extensão à RTS, proporcionando uma vista orientada às prescrições. O profissional clínico tem, nesta vista, uma agregação das prescrições encontradas em várias instituições (que participam na RTS) e no repositório nacional (cuja integração foi simulada). Adicionalmente, implementamos os métodos necessários para exportar a vista agregada de prescrições no formato esperado na rede de interoperabilidade do epSOS, segundo as especificações públicas disponíveis.
Keywords	Software engineering, information systems, web portals, e-Health, eprescribing, clinical summary
Abstract	Nowadays, in the Portuguese health care system, it is not possible to have an integrated view of drugs prescribed to a patient. The history of the medication, by itself, can provide to a health care professional enough clues to evaluate the clinical context of a patient who is observed in a first emergency contact, for example. This type of information is often included in networking initiatives for clinical summary sharing, as in the epSOS project, aiming at crossborder transmission of patient's essential clinical information, receiving care in a country other than the one where he/she usually receives care. The Health Telematic Network RTS is an electronic platform that allows the aggregation of patient clinical information in a controlled manner. It is possible, in this platform, to obtain a list of episodes of treatment to a patient and, from each episode search prescribed medication. Meanwhile, in the context of the portuguese national initiative for electronic prescribing, there is already a repository of prescriptions (more specifically, prescriptions dispensed) nationwide. This repository does not include, however, some prescriptions resulting from treatment of acute episodes. In this work, we propose an extension to the RTS, providing a view oriented to the medication. The medical professional has, in this view, an aggregation of the prescriptions found in several institutions (involved in RTS) and the national repository (which integration was simulated). Additionally, we have implemented the necessary methods to export the aggregated view of prescriptions in the expected format of the epSOS interoperability network, according to public available specifications.
Conteúdos
1	Introdução...................................................................1
1.1	Motivação e contextualização......................................1
1.2	Objetivos.........................................................2
1.3	Estrutura da Dissertação..........................................3
2	Revisão do Estado da Arte....................................................5
2.1	Utilização das tecnologias de informação em	saúde.................5
2.2	Implementação da prescrição eletrónica	em Portugal................6
2.2.1	Caraterização funcional de um sistema de prescrição eletrónica 7
2.2.2	Visão geral do processo de prescrição eletrónica...............8
2.2.3	A Base de Dados Nacional de Prescrições.......................9
2.3	Redes e tecnologias para a troca de informação em saúde..........10
2.3.1	O projeto RTS (Rede Telemática de Saúde).....................10
2.3.2	O projeto epSOS..............................................11
2.3.3	O papel do HL7 na comunicação clínica........................12
2.3.4	Bibliotecas para o tratamento de informação de saúde.........13
2.4	Tecnologias para o desenvolvimento de portais....................14
2.4.1	O modelo J2EE................................................14
2.4.2	Transporte baseado em XML....................................16
3	Casos de utilização suportados na agregação de informação de prescrição de
medicamentos ....................................................................19
4	Arquitetura de Sistema......................................................23
4.1	Visão geral da solução ..........................................23
4.2	Semântica da informação..........................................26
4.3	Integração com a RTS.............................................29
4.4	Integração com a BDNP (simulador)................................30
5	Implementação...............................................................33
5.1	Serviços implementados............................................33
5.1.1	WS Prescriptions.............................................33
5.1.2	BDNP (Base de Dados Nacional de Prescrições) simulador.......35
5.2	Incrementos à RTS.................................................37
5.3	Exportação de prescrições no formato epSOS........................40
6	Conclusões.................................................................45
6.1	Resultados........................................................45
6.2	Trabalho Futuro...................................................46
7	Referências................................................................47
Lista de Figuras
Figura 1 - Ciclo da Prescrição Eletrónica e Métodos Complementares de Diagnóstico e Terapêuticas [11]...................................................................7
Figura 2 - Fluxo de informação orientada ao projeto MDHT [30]......................13
Figura 3 - Modelo J2EE [32]........................................................15
Figura 4 - RTS a agregar informação das unidades de saúde que a compõe mais o repositório nacional de prescrições................................................19
Figura 5 - Casos de uso............................................................20
Figura 6 - Entidades envolvidas na obtenção de informação de pacientes e episódios no atual modelo da RTS................................................................25
Figura 7 - Visão geral da solução apresentada......................................25
Figura 8 - Troca de Mensagens entre o WS Prescriptions e o simulador da BDNP.......26
Figura 9 - Estruturas de dados a retornar pelo servidor............................26
Figura 10 - Estrutura de uma Receita...............................................27
Figura 11 - Modelo de dados que representa um episódio na	RTS...................28
Figura 12 - Modelo de dados que representa uma carta de alta de um episódio........28
Figura 13 - Modelo de dados de uma Prescrição na RTS...............................29
Figura 14 - Diagrama de Sequencia que ilustra a obtenção de dados por parte do WS Prescriptions......................................................................31
Figura 15 - Pesquisar um utente no servidor na interface Web da BDNP...............36
Figura 16 - Página com todas as prescrições associadas ao utente...................36
Figura 17 - Página para adicionar prescrições......................................37
Figura 18 - Novo campo para aceder ao historial de medicação do utente.............38
Figura 19 - Vista de medicamentos prescritos em grelha (grid)......................38
Figura 20 - Janela do prontuário terapêutico, aberta após clique no nome do medicamento........................................................................39
Figura 21 - Botões para alternar entre as vistas de grid e timeline................39
Figura 22 - Vista em cronologia de medicamentos prescritos.........................40
Figura 23 - Informação de um medicamento no documento clínico......................41
Figura 24 - Exportar medicamentos no formato epSOS, exemplificação.................41
Figura 25 - Receita no formato epSOS...............................................42
Figura 26 - Validação do CDA com o epSOS - ePrescription - Friendly Schematron.....43
Figura 27 - Validação do CDA com o epSOS - ePrescription - Pivot Schematron........43
iv
Lista de Tabelas
Tabela 1 - Serviços Desenvolvidos...........................................33
Tabela 2 - Métodos implementados pelo WS das prescrições....................34
Tabela 3 - Métodos implementados pelo WebService da BDNP....................35
vi
Lista de Acrónimos
ACSS	Administração Central do Sistema de Saúde
ANSI	American National Standards Institute
API	Aplication Programming Interface
ATC	Anatomical Therapeutic Chemical
BDNP	Base de Dados Nacional de Prescrições
CCF	Centro de Conferência de Faturas
CDA	Clinical Document Architecture
DOM	Document Object Model
EHR	Electronic Health Record
EJB	Enterprise java Beans
epSOS	Smart Open Services for European Patients
HL7	Health Level 7
HTML	HyperText Markup Language
HTTP	Hypertext Transfer Protocol
IEETA	Instituto de Engenharia Eletrónica e Telemática de Aveiro
IHE	Integrating the Healthcare Enterprise
IIOP	Internet Inter-Orb Protocol
JAXP	Java API for XML Processing
J2EE	Java Enterprise Edition
J2SE	Java Platform Standard Edition
JDBC	Java Database Connectivity
JMS	Java Message Service
JNDI	Java Naming and Directory Interface
JPA	Java Persistence API
JSP	Java Server Pages
JTA	Java Transaction
OHT	Open-Health-Tools
PCER	Processo Clínico Eletrónico Resumido
PEM	Prescrição Eletrónica de Medicamentos
MCDT	Meio Complementar de Diagnóstico Terapêutico
MDHT	Model-Driven Health Tools
NCP	National Contact Point
RIM	Reference Information Model
RMI	Remote Method Invocation
RNIS	Rede Nacional de Informação de Saúde
RSE	Registo de Saúde Eletrónico
RTS	Rede Telemática de Saúde
SNS	Serviço Nacional de Saúde
TIC	Tecnologias de Informação e Comunicação
SOA	Service-Oriented Architecture
SOAP	Simple Object Access Protocol
SSL	Secure Shell
UML	Unified Modeling Language
W3C	World Wide Web Consortium
WS	Web Service
WSDL	Web Service Definition Language
XML	eXtensible Markup Language
1	Introdução
1.1	Motivação e contextual ização
Hoje em dia, é importante que um profissional de saúde possa em qualquer lugar onde se encontre ter a possibilidade de aceder ao processo clínico de um determinado paciente. Esta necessidade de ter acesso a informação de qualidade disponibilizada de forma simples, uniforme e segura, vem revelar a importância da existência de um sistema eletrónico de acesso a dados de saúde, disponível a profissionais e entidades do sistema de saúde.
A aplicação de Tecnologia de Informação em Saúde, genericamente designada por e-Saúde, tem como por finalidade tornar os sistemas de saúde mais eficientes. A adoção de um Electronic Health Record (EHR) ou Registo de Saúde Eletrónico (RSE), seria desejável com o intuito de melhorar o acesso dos utentes aos serviços de saúde e elevar os níveis de qualidade e a celeridade dos serviços prestados, assim como reduzir significativamente o risco de erros advindos da falta da informação indispensável ao profissional no momento e no local da decisão clínica, bem como diminuir o tempo necessário à disponibilização de relatórios clínicos e laboratoriais com a integração no sistema das entidades produtoras de Meios Complementares de Diagnóstico e Terapêuticas (MCDT), também promoveria uma redução de custos, evitando a replicação de esforços e recursos, e melhorar de forma significativa os indicadores de gestão [1].
Outra das expressões desta digitalização da saúde foi a Prescrição de Medicamentos, que também passou a ser digital. A Prescrição Eletrónica de Medicamentos (PEM) é vista como um estímulo à comunicação entre os profissionais das diferentes instituições. Diminui o risco de erro ou confusão na prescrição, facilita a auditoria da venda de medicamentos e reforça a capacidade do Ministério da Saúde de combater a fraude no circuito do medicamento [2].
No entanto, em Portugal, até ao momento, é apenas possível a profissionais de saúde submeter a prescrição eletronicamente, e consultar alguma informação de prescrição medicamentos prescritos para um utente, contudo essa informação é incompleta não existe uma interface que permita ao utilizador consultar informação agregada de prescrição de medicamentos a partir de diferentes fontes. Nesta dissertação
abordaremos esse cenário, pois um diagnóstico médico correto implica que o médico tenha em conta o histórico de fármacos prescritos ao utente.
Os dados utilizados na prestação de serviços de cuidados de saúde estão dispersos nos mais variados recursos de informação (Bases de Dados e outro tipo de documentos). Os sistemas modernos são distribuídos e altamente heterogéneos, isto implica que cada vez que sempre que houver integração dados de diferentes fontes seja necessário aplicar procedimentos de compatibilização desses mesmos dados [3].
Neste trabalho vamos ter como base a Rede Telemática de Saúde [4] [5], uma plataforma de agregação e uniformização de dados clínicos e implementar nessa plataforma um cenário de extração e agregação de informação de prescrição de medicamentos, assim como o tratamento desses mesmos dados para que possam ser trocados com outras entidades de prestação de cuidados de saúde. Até ao momento, não existe nenhuma aplicação ou sistema que disponibilize uma vista agregada de informação de prescrição de medicamentos de forma generalizada e, nesse contexto, propomos um sistema que contemple essa utilidade de forma a permitir uma melhor prestação de cuidados de saúde a um utente num primeiro contacto.
1.2	Objetivos
Esta dissertação tem como objetivo o desenvolvimento de serviços de extração e agregação de informação de prescrição de medicamentos disponível em sistemas de informação clínicos e a sua apresentação consolidada aos profissionais. Para isso, pretende-se utilizar a Rede Telemática da Saúde (RTS) como caso de estudo, suplementando os processos existentes com novas capacidades para obter e apresentar a informação de prescrição de medicamentos.
Adicionalmente pretende-se a implementação de métodos de transformação de dados de prescrição para o formato de dados da rede epSOS de acordo com as especificações públicas disponíveis [6].
O principal resultado será uma extensão do ambiente de exploração da RTS, apresentando uma nova perspetiva que permita aos profissionais de saúde, aquando da prestação de cuidados médicos a um utente, ter acesso a informação de medicamentos prescritos a esse mesmo utente.
1.3	Estrutura da Dissertação
Este documento encontra-se dividido nos seguintes capítulos:
Capítulo 1 - Introdução, onde se apresenta e contextualiza a temática do projeto, assim como os principais objetivos.
Capítulo 2 - Estado de Arte, que apresenta uma vista das tecnologias existentes e soluções no âmbito desta dissertação, numa tentativa de reunir informação relevante ao desenho e implementação do projeto.
Capítulo 3 - Casos de utilização suportados na agregação de informação de prescrição de medicamentos.
Capítulo 4 - Arquitetura de sistema, descreve a arquitetura do projeto e seus módulos.
Capítulo 5 - Implementação, descrição da implementação do sistema.
Capítulo 6 - Conclusões e Resultados, nesta secção apresentamos as conclusões sobre o trabalho realizado. Apresentamos também, linhas para eventual trabalho futuro.
4
2	Revisão do Estado da Arte
Neste capítulo abordaremos algumas áreas e conceitos relevantes à elaboração desta dissertação, assim como tecnologias e ferramentas a usar.
2.1	Utilização das tecnologias de informação em saúde
Quase todos os sectores públicos hoje em dia dependem de dados informatizados que correm sobre sistemas de informação e plataformas de comunicação, a saúde não é exceção, pois esta é uma área em que a tecnologia desempenha um papel mais crítico.
O termo e-Healh, eHealth, e-Saúde, ou até Saúde Digital, é vulgarmente utilizado para o para o uso de tecnologias de comunicação e informação como suporte para a saúde [7], e aponta para um novo modo de relacionamento entre o paciente e o profissional de saúde assente na partilha de decisões e de informação. O conceito eHealth [8] engloba o potencial de criar:
•	Maior eficiência nos cuidados de saúde.
•	Melhoria na qualidade do serviço prestado.
•	Maior autonomia por parte dos utentes.
•	Melhorar a relação paciente/profissional de saúde.
•	Padronização da informação disponível.
A e-Health promete obter ganhos e reduzir custos, contudo, também levanta alguns riscos e desafios, no que diz respeito aos limites da informação a disponibilizar aos utentes, o que sugere uma reflexão em torno da privacidade de cada um.
Então, sistemas de informação em saúde são ferramentas para as autoridades e profissionais de saúde, assim como sistemas de saúde personalizados para os utentes, tais como:
•	Registo eletrónico dos utentes.
•	Telemedicina.
•	Todo um conjunto de instrumentos de base tecnológica desenhada para a prevenção, diagnóstico, tratamento, monitorização e gestão da saúde do utente.
•	Prescrição Eletrónica.
Estes sistemas são sistemas de informação destinados a instituições na área da saúde com o intuito de prestação de cuidados de saúde, fins administrativos ou até de gestão de unidades médicas (hospitais, clínicas, consultórios, farmácias, métodos auxiliares de diagnóstico, serviços de enfermagem e de terapias de apoio aos tratamentos, etc...). O utente pode, opcionalmente ser ou não ser, utilizador desses sistemas [8].
Em Portugal, já existem várias aplicações de tecnologias de informação na saúde, portais de saúde disponibilizados por organizações públicas e privadas com o objetivo de informar a população, como são os casos do portal do Ministério da Saúde e da Direção Geral da Saúde. Ambos fornecem informação sobre hospitais, centros de saúde, direitos dos pacientes, plano nacional de saúde, diagnósticos, prevenção de doenças, tratamentos, nutrição e bem-estar. Existem linhas telefónicas informativas no sentido de aconselhar e orientar os utentes, como a “Saúde 24” [9]. A maior parte dos hospitais já contam com aplicações para suporte médico, assim como várias aplicações da telemática, telediagnóstico, telemedicina e teleconferência, principalmente nas áreas da cardiologia e neurologia. Também estão a ser desenvolvidas redes de comunicação entre instituições de saúde como por exemplo a RTS na região de Aveiro. A implementação do circuito de Prescrição Eletrónica de Medicamentos está a ser implementada assim como o desenvolvimento de Centro de Dados Nacional que inclui a base de dados do Serviço Nacional de Saúde (SNS) que contém a informação de dados pessoais e clínicos dos utentes e a Base de Dados Nacional de Prescrições (BDNP) que vai agregar informação de bases de dados distribuídas a nível local, regional e nacional. Existe uma preocupação em estender a banda larga a todas as regiões do país, para prestar cuidados médicos a populações mais remotas com o uso da Telemedicina [10].
2.2	Implementação da prescrição eletrónica em Portugal
A prescrição eletrónica de medicamentos, e-Prescribing, ou até e-Rx é um procedimento efetuado com recurso às Tecnologias de Informação e Comunicação (TIC). O papel é substituído por um formulário digital. Trata-se de uma forma de e-Saúde a emergir em Portugal. A prescrição eletrónica promove uma diminuição de erros inerentes à leitura incorreta da escrita nas receitas manuscritas, assim como a informação dirigida ao paciente a quem é prescrita a receita, é mais completa.
2.2.1	Caraterização funcional de um sistema de prescrição eletrónica
Um sistema de prescrição eletrónica completamente implementado consistiria num sistema sem recurso a papel. O profissional de saúde preenchia a prescrição num formulário digital com suporte à decisão clínica e financeira sobre a escolha do medicamento. Assim que preenchido o formulário com a prescrição seria enviado para a Rede Nacional de Informação de Saúde (RNIS) - Passo 1 figura 1. O utente ficaria na posse de um token (um identificador da receita) que posteriormente seria usado na farmácia como identificador da receita. No sistema da farmácia, com o token a dar pelo utente, o farmacêutico lia a receita da RNIS. Após dispensar a receita o farmacêutico informaria a RNIS da dispensa da mesma - Passo 2 figura 1.
A PEM, também permite melhorar a eficácia do Centro de Conferência de Faturas (CCF) e reduzir a vulnerabilidade a falsificações e fraudes assim como uma melhor gestão financeira da despesa do medicamento. É também um incremento da capacidade de intervenção no ciclo de vida do medicamento [11] - Passo 3, figura 1 - em que o CCF acede á RNIS e verifica se as dispensas de medicamentos correspondem às prescrições efetuadas e - Passo 4, figura 1 - a Administração Regional de Saúde (ARS) informa a RNIS do pagamento das faturas.
w
- Consulta do Utente com Médico (SNS/privado)
-Receita / Requisição tem associado um token para garantir a “assinatura" do utente na dispensa/realização
Envia dispensa
C. Conferência de Factu
	r RNIS - Rede Nacional de Informação da Saúde	
Lé Requisição MCDT
Le Prescrições Lé Dispensas
Envia Realização MCDTi Envia Resultados MCDT:
Figura 1 - Ciclo da Prescrição Eletrónica e Métodos Complementares de Diagnóstico e Terapêuticas [11]
Ainda na figura 1, todo este processo de desmaterialização da prescrição eletrónica, ocorre em simultâneo o processo de desmaterialização de MCDTs outra medida adotada para digitalizar o Sistema de Saúde em Portugal.
2.2.2	Visão geral do processo de prescrição eletrónica em Portugal
Em Portugal, desde 2004 (altura em que se iniciou eHealth Action Plan na União Europeia), que Hospitais Públicos e centros de Saúde e outros adotaram sistemas informáticos de suporte clínico [10]. Foram estabelecidos protocolos entre instituições para permitir o acesso direto à informação do paciente entre instituições.
Em 2006, foi iniciado um processo de certificação para aplicações de prescrição eletrónica e a 1 de Outubro de 2010 [12], o Ministério da Saúde, em Diário da República, estabeleceu um conjunto de novas medidas no acesso aos medicamentos, consagrando o princípio da obrigatoriedade da prescrição eletrónica de medicamentos, para efeitos de comparticipação.
A 17 de Maio de 2011, é assinado o memorando com a troika [13] no qual é definida a obrigatoriedade da prescrição eletrónica de medicamentos e meios de diagnóstico abrangidos por sistemas de comparticipação pública, para todos os médicos tanto no sector público como no sector privado. Nesse mesmo documento, também se pretende melhorar o sistema de monitorização da prescrição de medicamentos e meios de diagnóstico assim como pôr em prática uma avaliação sistemática de cada médico em termos de volume e valor, em comparação com normas de orientação de prescrição e de outros profissionais da área de especialização.
A PEM de medicamentos em Portugal foi declarada obrigatória em Agosto de 2011 [14] e desde então tem crescido até números muito muito satisfatórios, superiores a 90% [15]. O facto da prescrição eletrónica não se generalizar a 100% das receitas deve-se a exceções contempladas pelo Ministério da Saúde:
•	Inadaptação comprovada do prescritor para a utilização de meios eletrónicos.
•	Prescrições realizadas no domicílio do paciente.
•	A profissionais com volume de prescrição igual ou inferior a 50 receitas por mês.
•	Falência do sistema eletrónico.
No entanto, a prescrição eletrónica ainda não é totalmente “eletrónica”: a prescrição é preenchida digitalmente e enviada para a Base de Dados Nacional de Prescrições mas é impressa e assinada pelo médico, para posteriormente ser entregue na farmácia pelo paciente. Contudo o utente ainda tem que se deslocar à farmácia com uma receita física. E para proceder à sua renovação, ainda tem que consultar um médico,
isto porque o processo de desmaterialização da prescrição [11] ainda está em curso, apenas estando prevista a sua total implementação em meados de 2013, segundo o Plano Tecnológico [16], aprovado em finais de 2010.
Em Portugal, a PEM, já é um negócio e existem várias empresas a disponibilizar sistemas de prescrição eletrónica [17].
2.2.3	A Base de Dados Nacional de Prescrições
Para que haja uma Rede Nacional de Informação de Saúde com suporte a PEM, é necessário um repositório de informação, para que o papel seja totalmente dispensado. A Base de Dados Nacional de Prescrições (BDNP) é uma base de dados para onde são submetidas todas as prescrições eletrónicas no nosso país.
A BDNP é uma das bases de dados integradas no Centro de Dados Nacional, que contém as receitas prescritas a um qualquer utente do SNS, à exceção da medicação administrada em episódios de urgência.
É um centro de conferência de receitas médicas. A partir da BDNP, é possível controlar o ciclo da receita médica, se foi aviada ou não e se foi anulada. É portanto uma peça chave no combate à fraude no ciclo dos medicamentos.
Uma interface de prescrição eletrónica que esteja de acordo com as especificações da Administração Central do Sistema de Saúde (ACSS) [18] ao efetuar a prescrição ao utente já envia a prescrição para a BDNP. Nesse contexto, a BDNP não só é importante para completar o processo de prescrição eletrónica de medicamentos, mas também poder constituir uma fonte de informação que pode vir a ser usada como meio auxiliar de diagnóstico, com a obtenção do historial de fármacos prescritos ao utente por parte do profissional de saúde. Há que ter em conta o regime de comparticipação de medicamentos em Portugal, em que uma receita titulada a um utente beneficiário de um regime de comparticipação (uma parte do medicamento é suportada pela entidade beneficente) de medicamentos avie os medicamentos para estes serem administrados a uma terceira pessoa.
A BDNP, segundo o plano tecnológico, está concluída desde o final do primeiro semestre de 2011.
2.3	Redes e tecnologias para a troca de informação em saúde
Podemos definir uma rede para troca de informação em saúde como um conjunto de entidades ou instituições de saúde que estabelecem canais de comunicação entre elas e efetuam trocas de informação clínica. As redes para troca de informação em saúde têm como objetivo melhorar a comunicação entre instituições, a principal finalidade é a troca de informação clínica entre profissionais de Saúde de diferentes unidades de saúde. A adoção destas redes vem permitir a um utente ser assistido fora da sua entidade de saúde local e o profissional que lhe presta de cuidados de saúde ter acesso à informação clínica do paciente. Também evitam a replicação desnecessária de exames médicos [1].
2.3.1	O projeto RTS (Rede Telemática de Saúde)
A RTS [4] [5] foi um projeto iniciado em 2004, desenvolvido pelo Instituto de Engenharia Eletrónica e Telemática de Aveiro (IEETA), da Universidade de Aveiro, no âmbito do programa Aveiro Digital. A RTS foi inspirada em algumas implementações mundiais de redes regionais de comunicação clínica, como a MedCom [19].
A RTS integra um conjunto de instituições médicas formado pelo Hospital Infante D.Pedro (Aveiro), Hospital Distrital de Águeda e a Sub-Região de Saúde de Aveiro.
A principal ideia da RTS está explicita no slogan “Ligados por uma saúde melhor”, ou seja, melhorar o acesso a informação clínica e promover a comunicação entre profissionais de saúde credenciados, também permite o envolvimento do cidadão na gestão da sua saúde.
Desenvolvida com recurso a tecnologias abertas e baseadas em standards do W3C, a RTS implementa um "Processo Clínico Eletrónico Regional" resumido (PCER), que agrega informação clínica do utente, proveniente de várias fontes de informação clínica geograficamente distribuídas pelas várias instituições de saúde regionais que constituem a RTS [20]. A RTS disponibiliza acesso a:
•	Cartas de alta de episódios;
•	Boletins de análises clínicas;
•	Relatórios de exames de imagiologia;
•	Boletins de vacinas;
Atualmente apenas é possível ao profissional de saúde consultar informação de medicamentos prescritos, na secção das cartas de alta dos episódios. A comunicação entre as várias instituições da rede, devido ao cariz sensível da informação, decorre de forma segura, como tal o profissional de saúde necessita de ter credenciais para aceder à plataforma.
2.3.2	O projeto epSOS
A mobilidade das pessoas, entre o seu país de origem e um outro qualquer país, é uma realidade desde há muito. Muitas vezes uma determinada pessoa dá entrada numa unidade médica fora do seu país de origem, e como tal, são-lhe prestados cuidados médicos sem que o profissional de saúde tenha acesso ao historial médico do paciente. Esse fator desencadeou uma necessidade de implementar uma plataforma europeia para troca de informação clínica. Em Julho de 2008 a Comunidade Europeia emitiu recomendações referentes à interoperabilidade entre sistemas de registo eletrónico de dados clínicos de vários países [21]. Ainda em 2008 foi iniciado o projeto Smart Open Services for European Patients (epSOS), que tem a finalidade de projetar, construir e avaliar uma infraestrutura de serviço que demonstra a interoperabilidade transfronteiriça para a troca de informação entre sistemas EHR de diferentes países europeus [22].
O epSOS tem em vista uma melhoria na prestação de cuidados médicos com a troca de informação clínica transfronteiriça. Os principais documentos usados na troca de informação são os seguintes:
•	Patient Summary [23];
•	e-Prescription [24];
O epSOS tem uma arquitetura em que cada país implementa um componente de comunicação, National Contact Poin (NCP); este componente serve como uma espécie de proxy da informação clínica de cada país e a restante rede, é aqui efetuada toda a transformação de dados num standard que possa ser transmitido no epSOS. O NCP também assegura que a comunicação é feita de forma segura.
2.3.3	O papel do HL7 na comunicação clínica
O Health Level 7 International (HL7) foi fundado em 1987. É uma organização sem fins lucrativos, creditada pela American National Standards Institute (ANSI), dedicase a fornecer um quadro global e padrões relacionados para o intercâmbio, integração, partilha e recuperação de EHRs que suporta a prática clínica e da gestão, execução e avaliação dos serviços de saúde [25].
O HL7 fornece padrões de interoperabilidade que visam melhorar a prestação de cuidados clínicos, otimizar fluxo de trabalho, reduzir a ambiguidade e melhorar a transferência de conhecimento entre prestadores de cuidados de saúde de diferentes organizações e pacientes [25].
No domínio da e-Health, a norma Clinical Document Architecture (CDA) do HL7 foi introduzido para fornecer um modelo de troca de documentos clínicos. O CDA ao fazer uso do Reference Information Model (RIM) do HL7 e vocabulário codificados fornece documentos clínicos que possam ser facilmente analisados e processados eletronicamente, recuperados e usados por pessoas que deles necessitem [26]. O RIM da versão 3 do HL7 é a base de informação utilizada nas especificações HL7. Foi criado para responder à necessidade de garantir a interoperabilidade entre os sistemas utilizados em diferentes entidades prestadoras de cuidados de saúde. É um modelo de informação de referência, baseado num modelo orientado a objetos, que representa de uma forma genérica e lógica os dados que são trocados entre sistemas de diferentes entidades prestadores de cuidados de saúde, assim como os fluxos de informação estabelecidos, através de mensagens HL7. Os documentos especificados pelo epSOS para troca de informação usam o RIM do HL7v3 [27].
Os documentos CDA são codificados em XML e derivam do HL7v3 RIM, como tal, usam os modelos de dados HL7v3. O CDA especifica a estrutura e a semântica de documentos clínicos, para posteriormente estes serem trocados entre aplicações. A complexidade de cada documento representado num CDA depende da complexidade de informação tratada.
2.3.4	Bibliotecas para o tratamento de informação de saúde
No processo de troca documentos clínicos digitais entre instituições de diferentes países é necessário que a informação trocada respeite os standards internacionais de modo a que os dados trocados possam ser percetíveis por ambos os interlocutores.
A Open Health Tools (OHT) [28] é uma organização que desenvolve ferramentas open source para fornecer suporte para a modelação de mensagens HL7v3. A OHT tem como objetivos ao disponibilizar as suas ferramentas, promover uma melhoria na qualidade do atendimento ao utente, uma melhoria qualidade da informação trocada entre sistemas e promover a interoperabilidade transfronteiriça [29]. Todo o processo de modelação de documentos clínicos com especificações longas e complexas é precedido por uma curva de aprendizagem que representa toda a familiarização com documentos clínicos, foi assim que surgiu o projeto Model-Driven Health Tools (MDHT) [30], um projeto open source que fornece ferramentas de apoio à conceção e implementação de modelos clínicos. Este modelo engloba uma série de bibliotecas baseadas em Java, para gerar e validar documentos.
Na figura 2, é ilustrado o projeto MDHT, em que o programador dispõe de um conjunto de requisitos e ao fazer uso das boas práticas HL7 CDA modela um documento clínico que pode ser usado por pessoas e usado por aplicações.
/eb Content
Software
Java API
Business Analyst
Requirements
gner
Implementation
Gt ide
Des
HL7 CDA Best Practices
CDA Runtime Application
Developer
CDA Web-Based Validation
Developer \ Documentation
Online Help
J Publication
CDA Model
Figura 2 - Fluxo de informação orientada ao projeto MDHT [30]
2.4	Tecnologias para o desenvolvimento de portais
Neste subcapítulo abordaremos algumas das tecnologias e modelos usados para o desenvolvimento de portais.
2.4.1	O modelo J2EE
O modelo J2EE [31], ou Java Platform Enterprise Edition, é uma plataforma que representa um standard para implementar e desenvolver aplicações empresariais. O modelo J2EE apresenta-se como uma boa solução para o programador face ao facto de muitas complicações inerentes ao desenvolvimento de aplicações empresariais serem geridas pela própria plataforma, o que simplifica todo o processo de implementação, libertando o programador para se focar nas especificações do projeto.
Uma aplicação empresarial necessita de implementar serviços complexos para ser bem-sucedida, e a implementação de serviços de baixo nível iria representar uma infinidade de tempo extra para o desenvolvimento do projeto. No J2EE, esses serviços de baixo nível já estão implementados e documentados, ou seja, o programador só tem de invocar esses serviços, o que se traduz numa redução de tempo.
O modelo J2EE é um modelo que decompõe a aplicação em camadas, como é possível constatar na figura 3, o modelo é constituído por 3 camadas. A camada, Enterprise Information System (EIS), é a que contém as bases de dados da aplicação. A camada do meio, business layer, é onde está contida toda a lógica da aplicação, os Enterprise Java Beans (EJB), esta camada pode conter subcamadas. E por fim camada mais alta, a camada Cliente, onde é estabelecida a interação com o cliente.
A camada mais baixa, a das bases de dados que contêm a informação da aplicação corre no respetivo servidor EIS. A business layer, assim como os componentes Web da aplicação que interagem com o cliente (Java Servlets e Java Server Pages (JSP)), estão contidas no servidor J2EE. A camada Cliente (Web Browsers, Applets, aplicações cliente) corre na máquina do cliente. A informação trocada entre as várias camadas pode ser efetuada com recurso a HTML, XML, HTTP, SOAP, SSL etc...
Client-Side Presentation
Enterprise Information System
Server-Side Business Logic
EJB
Container
Java Application
Desktop
J2EE Client	
	
Figura 3 - Modelo J2EE [32]
Esta decomposição em
camadas está associada a
uma melhor qualidade do
software desenvolvido, a uma melhor estratégia para o desenvolvimento do software e um aumento da produtividade do programador. É também mais fácil todo o processo de
manutenção do software, assim como a possibilidade de interoperabilidade com outros
sistemas.
Existem muitas APIs e tecnologias que compõem o J2EE. Essas APIs e tecnologias são sucintamente descritas abaixo:
•	Java Database Connectivity (JDBC) API: O JDBC é um conjunto de interfaces que permite a aplicações Java aceder a qualquer base de dados. Semelhante à Microsoft ODBC.
•	Remote Method Invocation (RMI): O RMI é uma API que permite a um objeto Java comunicar remotamente com outros objetos. Semelhante ao CORBA da OMG.
•	Java IDL: O IDL é um standard de plataforma independente, que permite que um objeto Java comunique com outro objeto de qualquer linguagem por IDL.
•	Entreprise Java Beans: O EJB é uma estrutura padrão de objetos distribuídos e modelo de componentes para o Java. São componentes usados na camada de negócio do J2EE.
•	Servlets e Java Server Pages (JSP): Servlets são programas Java a correr num Web Server que processa pedidos dinamicamente e respostas. Um Servlet é um módulo que estende a funcionalidade de um servidor Web, através de módulos de aplicação implementados em Java.
•	Java Message Service (JMS): A API JMS é standard de mensagens que permite aos componentes do J2EE criar, enviar, receber e ler mensagens. Permite a comunicação distribuída entre componentes.
•	Java Transaction(JTA): O JTA permite aos componentes J2EE realizar transações distribuídas.
•	Java Mail: O JavaMail permite aos componentes Java enviar e receber e-mails numa forma plataforma-independente.
•	Java API para processamento XML (JAXP): JAXP permite manipular documentos XML. O XML é muito utilizado em J2EE como formato de dados.
•	Java Naming and Directory Interface (JNDI): O JNDI é um protocolo que permite a aplicações Java descobrir e procurar dados e objetos através de um nome.
2.4.2	Transporte baseado em XML
O eXtensible Markup Language (XML), é uma linguagem standard para especificação de dados Web. Permite que os dados sejam envolvidos por tags que e consequentemente ser ao mesmo tempo percetível por maquinas e humanos. Tags XML podem ter qualquer termo definido pelo utilizador, é uma linguagem extensível e não requer qualquer significado (semântica) associado aos termos / tags [33].
O XML tem um vasto uso na programação Web, por dispor de uma enorme variedade de ferramentas para a sua edição. O XML permite estruturar dados altamente complexos num documento simples. Como o XML é um documento de texto e facilmente transportável por HTTP ou HTTPS tem sido adotado como uma forma de transportar dados estruturados pela Internet. No entanto, o uso de XML traz algumas desvantagens associadas ao formato das mensagens, ao facto de estas se poderem tornar demasiado pesadas para a rede e dispendiosas em recursos para o seu processamento.
A necessidade da troca de documentos em formato padrão estruturado tem vindo a ganhar importância ao longo dos anos, e a saúde não é alheia a essa necessidade. A troca digital de dados clínicos requer um documento estruturado e que possa ser lido por pessoas e ao mesmo tempo processável por máquinas, tudo isto foi facilitado com o desenvolvimento de linguagens de especificação de dados como o XML. Os documentos clínicos HL7v3 são definidos em XML [34].
18
3	Casos de utilização suportados na agregação de informação de prescrição de medicamentos
O cenário de agregação de informação de prescrição de medicamentos é uma das dimensões de grande utilidade aos profissionais de saúde.
Constatamos que atualmente já existe informação relativamente a prescrição de medicamentos dentro da RTS. No entanto, essa informação apenas poderá ser encontrada dentro de cartas de alta por episódio clínico. Contudo, só com esse acesso indireto, é mais complicado ao médico tirar ilações na altura do diagnóstico do paciente.
A solução passa por, para cada paciente, extrair toda a medicação existente dentro do sumário dos vários episódios clínicos e agregar essa informação, numa só vista. Ainda assim, apesar de ser informação relevante para o profissional de saúde, não basta restringir essa informação à existente na RTS, é conveniente adicionar a informação de prescrição de medicamentos da rede nacional. Como tal, é necessário utilizar a informação da BDNP. Muito embora se possa questionar o motivo de agregar duas fontes RTS e BDNP, se o segundo caso engloba o primeiro. A explicação é simples, a RTS contém episódios de urgência, ou seja, quando um utente dá entrada no hospital, e são lhe administrados medicamentos, essa medicação, não requer uma receita, nem vai ser submetida para a base de dados nacional de prescrições, vão unicamente ficar registadas no sumário do episódio, e faz todo o sentido ser integrada na solução.
Logicamente que a RTS também contém medicamentos que foram submetidos para a base de dados nacional de prescrições, o que levaria a uma replicação de dados, situação que deverá ser tratada.
Figura 4 - RTS a agregar informação das unidades de saúde que a compõe mais o repositório nacional de prescrições
A figura 4 ilustra a agregação de informação que a RTS passará a ter no final desta dissertação. A RTS já agrega a informação dos Hospitais (HIP - Hospital Infante D.Pedro e HDA - Hospital Distrital de Águeda) e Centros de Saúde (CSA - Centro de Saúde de Aveiro, CSV - Centro de Saúde de Vagos, etc...) pertencentes ao consórcio RTS e passa a agregar informação da Base de Dados Nacional de Prescrições (BDNP).
A informação dentro da RTS é orientada à partilha de informação a nível regional, contudo não está orientada a sistemas baseados em Health Level Seven International (HL7) Clinical Document Architecture (CDA). Um utente proveniente da região abrangida pelo consórcio RTS, que se desloque a um país estrangeiro e necessite de cuidados médicos nesse mesmo país, o médico que lhe vai prestar cuidados de saúde, não tem acesso ao historial médico do utente, exatamente pelo facto de os dados da RTS não estarem orientados à partilha de dados transfronteiriça e consequentemente e consequentemente não integrarem a rede de partilha de informação clínica epSOS. A RTS deve ter a possibilidade de exportar os dados de informação de prescrições de medicamentos em formato epSOS, podendo futuramente ser ligada com o National Contact Point (NCP), e exportar informação além-fronteiras.
Com os requisitos apresentados, foram definidos os seguintes casos de utilização para o projeto a desenvolver:
•	Consultar Prescrições - A RTS passa a disponibilizar métodos que permitem a obtenção de informação de prescrição de medicamentos agregada das várias fontes (RTS+BDNP) por utente e consultar detalhes dos medicamentos prescritos. O Profissional de Saúde acede a essa informação através do Portal dos Profissionais. Esta informação é também acessível a sistemas externos que façam a invocação de um serviço a desenvolver.
•	Exportar Prescrições - Também a rede epSOS tem a possibilidade de exportar os dados de prescrição de medicamentos disponibilizado pela RTS (RTS+BDNP) num formato de dados orientado à troca de dados transfronteiriça.
22
4	Arquitetura de Sistema
Neste capítulo descreveremos detalhadamente a solução a adotar, a arquitetura e as tecnologias escolhidas para a sua implementação.
4.1	Visão geral da solução
Esta dissertação propõe uma extensão à Rede Telemática de Saúde (RTS), que em relação à sua versão atual disponibiliza duas novas funcionalidades a desenvolver:
•	Extração e agregação de informação de Prescrição eletrónica de várias fontes.
•	Exportar informação de prescrição de medicamentos em formato epSOS.
A solução a implementar passa por dotar a RTS de uma vista para consulta de prescrição de medicamentos, assim como o uso da sua atual estrutura para a obtenção de dados de prescrição de medicamentos. Passa também, por integrar a base de dados nacional de prescrições. No entanto, a BDNP não foi disponibilizada para a realização deste projeto, foi necessário implementar um serviço extra para simular. O simulador deverá ser implementado com base nas especificações de receitas médicas descrito pela ACSS [18], deverá ser orientado a serviço, a fim de emular o repositório nacional de prescrições de receitas médicas.
Por fim, é necessário permitir ao utilizador selecionar um conjunto de prescrições por forma a exportar essas mesmas prescrições para o formato epSOS. É necessário desenvolver um módulo dentro da RTS que permita transformar os atuais formatos de dados da RTS, que não estão orientados ao Reference Information Model do epSOS, para que estes possam vir a ser exportados para o epSOS.
Para alcançar as novas funcionalidades a RTS requer que a sua atual camada Web seja alterada/incrementada. Para construir a informação de prescrições de medicamentos, é necessário recorrer aos WebServices da RTS, nomeadamente aos que contêm a informação dos pacientes e dos episódios, esta etapa passa por se construir um serviço (WebService) interno à RTS que faça a extração e agregação de dados de prescrição de medicamentos internos à RTS e também que inclua o repositório nacional, no nosso caso, o simulador da BDNP.
Também se pretende disponibilizar o acesso aos detalhes dos medicamentos conforme a informação já disponível (base de dados própria, não investigada) nas instituições clínicas, por forma a enriquecer a vista a desenvolver que vai mostrar a informação no Portal dos Profissionais.
Como a RTS foi desenvolvida em J2EE, todo o projeto será igualmente desenvolvido em J2EE, por forma a homogeneizar o projeto no que toca a tecnologias. A camada Web será forçosamente desenvolvida em Apache Struts [35] e JSP com recurso a JavaScript [36]. Para a manipulação dos modelos de dados, serão usadas as bibliotecas da Open-Health-Tools (OHT) [28].
Podemos dividir a implementação de todo o projeto em várias etapas:
1.	Projetar e desenvolver o simulador da Base de Dados Nacional de Prescrições (BDNP).
2.	Criar um módulo dentro da RTS, que faça a invocação do WebService dos Pacientes e do WebService dos Episódios, por forma a obter informação de prescrição de medicamentos dentro da RTS.
3.	Integrar nesse novo módulo, o simulador da Base de Dados Nacional de Prescrições.
4.	Criar no Portal dos Profissionais uma secção para consulta de informação de prescrição de medicamentos e consequentemente integrar o módulo desenvolvido que retornará os dados a apresentar.
5.	Criar um módulo que permita exportar os formatos de dados atuais da RTS em formato epSOS.
É importante garantir que a comunicação entre estes serviços decorra de forma segura. O conteúdo das mensagens tem que estar cifrado e estas têm de estar assinadas. Como já existe um mecanismo implementado na RTS para garantir a segurança das mensagens trocadas, o modelo, Mutual Certificate Autentication, será este o mecanismo a implementar. Este mecanismo contempla o uso de um certificado X.509 para identificação do cliente [37]. A utilização de um certificado por parte de uma aplicação cliente não se restringe apenas à sua identificação, contêm também um par de chaves assimétricas. Estas chaves são utilizadas para cifar e assinar as mensagens trocadas. As mensagens serão cifradas com recurso a chaves assimétricas, existentes nos certificados de cada interveniente.
Na RTS existem vários Módulos Internos, desses módulos iremos recorrer a dois, nomeadamente aos WebServices WS Patient, que contém informação relativamente aos utentes e WS Episode, que contém a informação relativamente aos episódios clínicos.
Figura 6 - Entidades envolvidas na obtenção de informação de pacientes e episodios no atual modelo da RTS
A figura 6 representa parte da arquitetura atual da RTS. Na camada mais abaixo (HIP - Hospital Infante D.Pedro, HDA - Hospital Distrital de Águeda, CSA - Centro de Saúde de Aveiro etc...), estão representadas as entidades que compõem o consórcio RTS. Na camada do meio, estão representados os WebServices dos Pacientes e dos Episódios e, na camada mais acima, o Portal dos Profissionais. Os WSs obtêm os dados de pacientes e episódios das várias instituições da RTS, posteriormente estes WS são invocados pelo Portal dos profissionais de modo a construir o processo clínico do paciente.
Figura 7 - Visão geral da solução apresentada
A figura 7 representa a arquitetura da solução apresentada, com a criação de um novo WebService, o WS Prescriptions, que vai consumir os dados de outros dois
WebServices já existentes na RTS, mais os dados provenientes do simulador da BDNP. Este WS Prescriptions, disponibiliza uma estrutura de dados que representam prescrições, disponível à rede epSOS e ao Portal dos Profissionais da RTS.
4.2	Semântica da informação
A tecnologia usada para a troca de mensagens entre os serviços é SOAP (Simple Object Access Protocol), que é um protocolo que descreve uma norma para troca de mensagens em WebServices. O SOAP é uma recomendação do W3C (World Wide Web Consortium) para a implementação de WS. É baseado em mensagens XML, é protocolo simples e altamente expansível.
WS Prescription
BDNP
Simulador
Figura 8 - Troca de Mensagens entre o WS Prescriptions e o simulador da BDNP
As mensagens trocadas entre a BDNP e o WS Prescriptions são mensagens SOAP (figura 8) que encapsulam objetos estruturados em XML. Esses objetos podem ser uma única receita acompanhada pelo código obtida através do identificador dela própria, ou podem ser um conjunto de receitas (Figura 9 e Figura 10), obtidas através de um identificador do utente, neste caso retorna todas as receitas associadas ao utente.
ListaReceitasBodyOutput
ReceitaBodyOutput
Figura 9 - Estruturas de dados a retornar pelo servidor
f ReceHaiype —&lt;***}-*•
HUttlCIOLIKll-J type üd ihi
Medicamento tpe ar WediçarnentoTvpe
l&gt;as cr tc aoDta pnn s j ♦«se red: string
CabecalhoRecelta	¡
Type erCabecalhoReceitaType
' Lista LinhasReceita	¡
¡type erUstaUnhasReceitaType
B nitrosPesquis-a	I
■ type erFíltrcsPesquísaType
Figura 10 - Estrutura de uma Receita
O WS Prescriptions recorre ao WS Patients para procurar o utente, e caso o utente exista, obter a lista de episódios clínicos associados ao paciente. Com essa informação o WS Prescriptions acede ao WS Episodes para obter episódios associados ao utente, dentro dos episódios é possível obter as cartas de alta dos mesmos e consequentemente obter a medicação prescrita que aí consta. As figuras 11 e 12 representam os dados trocados entre WS Prescriptions com os outros dois WSs (Episódios e Pacientes), ao pedir a lista de episódios associados a um utente, ao WebService dos utentes, obtém uma lista de Episódios. E posteriormente pelo id do Episódio obtém a respetiva carta de alta do mesmo do WS dos Episódios, esta carta de alta tem informação de medicamentos prescritos ao utente.
Figura 11 - Modelo de dados que representa um episódio na RTS
Figura 12 - Modelo de dados que representa uma carta de alta de um episódio
Figura 13 - Modelo de dados adotado para representar uma Prescrição na RTS
A figura 13 ilustra o modelo de dados a usar para construir a prescrição após recebida a informação proveniente da BDNP. É também este o modelo de dados que será adotado para representar as prescrições internamente à RTS, por abranger a informação relevante de uma prescrição. Os dados provenientes dos WS dos Pacientes e Episódios serão convertidos para este modelo de dados no WS Prescriptions. O modelo de dados interno à RTS (Figura 11 e Figura 12) abrange aspetos essenciais de uma prescrição, no entanto há aspetos relevantes que não são especificados.
4.3	Integração com a RTS
O bVS Prescriptions é um novo serviço para extrair e agregar informação de prescrição de medicamentos por utente e normalizar essa informação num formato que
permita interoperabilidade semântica. Este WS será um serviço, que disponibiliza dados para a RTS e epSOS, pode também vir no futuro a disponibilizar informação a outras aplicações. No entanto como é um serviço que essencialmente afeta utentes da rede RTS faz todo o sentido ser implementado dentro da RTS. Como tal, será desenvolvido na camada de serviços da RTS, RTS.WS, à semelhança daquilo que já acontece com o WS dos Pacientes e com o WS dos Episódios. Posteriormente no portal dos profissionais é somente necessário fazer a sua invocação.
O mecanismo para o tratamento de dados de prescrição de medicamentos com o intuito de tornas esses mesmos dados exportáveis para a rede epSOS será implementado no WS Prescriptions, também será um módulo interno à RTS. Este WS implementará métodos acessíveis via WSDL, que retornam um conjunto de prescrições no formato CDA HL7v3, que é um ficheiro XML usado para especificar dados clínicos na rede de epSOS, por um identificador do utente, ou uma única prescrição, com base no ID da mesma. Estes dados destinam-se ao epSOS.
4.4	Integração com a BDNP (simulador)
No início desta dissertação, tínhamos como objetivo criar uma vista de informação agregada de prescrição de medicamentos, pretendia-se obter medicação administrada ao utente em episódios de urgência da RTS, que não são submetidos para BDNP, mais a informação da BDNP. No entanto, o repositório nacional de prescrições não foi disponibilizado para este projeto, pelo fato de conter informação que é considerada privada. A disponibilização desse serviço para uma dissertação podia levantar uma série de questões éticas. Então, foi decidido implementar um simulador que emulasse o efeito pretendido. Para tal foram consultadas as especificações públicas da ACSS, com o formato de uma receita e foi à volta desse formato que se projetou o simulador da BDNP.
O simulador da BDNP é um projeto orientado a serviço. Como contextualmente representa a base de dados nacional de prescrições e, um serviço externo à RTS, será implementado fora da RTS, acessível via SOAP. A sua integração com RTS é através do módulo WS Prescriptions, que implementará o cliente do simulador da BDNP, e posteriormente só tem que invocar os métodos disponibilizados por ele. A comunicação como já referimos é via SOAP e a segurança das mensagens é assegurada por um
protocolo de Certificação Mutua, é necessário fazer a configuração de segurança entre ambos os serviços por forma a garantir a comunicação.
Como os dados trocados são XML, o bVS Prescriptions tem que dispor de ferramentas para extração do XML e posteriormente usar um tipo de dados de acordo com o formato das receitas exportadas pelo BDNP.
	 W S P r e s c r i p t i o n			 WS Patient			 WS Episode		B DNP s iiciu 1 ato r^j
loop		qetEpisodesbyPatientw r-L-,	I * 1&amp;lt;	 1 returns an array	LrJ	( of of episodes	( I	1 for each episode request the summary discharge letter 1		1 1 1 1 1 1 1	
		1 qetSummaryDischanqeUetter			1 1 1 1 1
		returns a aischarqe letter			
		&amp;lt;1			
		getPrescriptionsBySNS			_ A
		i	1	 i returns an xml with prescription^			
		&lt;	¡	=	-	LI 1	1	i			
Figura 14 - Diagrama de Sequencia que ilustra a obtenção de dados por parte do WS Prescriptions
Na figura 14, é possível constatar que há dados distintos oriundos de diferentes plataformas
Neste caso, a informação proveniente da BDNP, apresenta-se mais completa, e na questão da eventual replicação de informação, ao ter que se eliminar informação duplicada, a informação proveniente da RTS será preterida. A informação de prescrição de medicamentos será duplicada quando a data da prescrição, o código identificador do medicamento e o responsável pela prescrição forem iguais, e nessa circunstância a prescrição proveniente da BDNP será aquela que prevalece.
32
5	Implementação
Neste capítulo descreveremos os serviços implementados, e a camada de interface desenvolvida no portal dos profissionais da RTS.
As ilustrações fornecidas com captura de ecrã utilizaram dados fictícios, em ambiente de laboratório.
5.1	Serviços implementados
Tal como especificado, foram implementados dois serviços:
Tabela 1 - Serviços Desenvolvidos
Serviço	Descrição
WS Prescriptions	Extensão à plataforma RTS Módulo responsável por efetuar extração e agregação de informação de prescrição eletrónica e transformar essa informação para ser exportável para a rede epSOS
BDNP	Módulo responsável por simular o repositório nacional de prescrições de receitas médicas
5.1.1	WS Prescriptions
O primeiro módulo que temos referido como WS Prescriptions, foi implementado dentro da RTS na sua camada de serviços, RTS.WS.
Este serviço foi implementado segundo o protocolo SOAP, permitindo a sua invocação pelo Portal dos Profissionais, como a também permitir a sua invocação por serviços externos à RTS (por exemplo: epSOS). O WS Prescriptions faz a invocação de outros serviços que integram a RTS, presentes na mesma camada, o WS dos Pacientes e o WS dos Episódios. A comunicação com estes é feita através do RTS.IENGINE que é um middleware que permite a invocação de outros serviços, disponibilizando a informação no modelo de dados da RTS. O WS Prescriptions pede ao WS dos Pacientes todos os episódios para um dado paciente. Este retorna uma lista de episódios (Figura
11)	. Para cada episódio, pelo atributo “episodeSummaryld”, é feito um novo pedido ao WS mas dos Episódios, para obter a carta de alta do episódio, DischargeResume (Figura
12)	.
Para a interação com serviços externos, como o caso do projeto europeu, epSOS, e com o repositório nacional de prescrições de receitas médicas, a BDNP, foram utilizados modelos de dados específicos de acordo com as especificações de interoperabilidade de cada projeto.
Tabela 2 - Métodos implementados pelo WS das prescrições
Método	Descrição	Parametro(s) de entrada	Retorno
getPrescriptionsBySNS	Retorna uma lista de prescrições por utente	Identificador do utente (SNS - ID do Serviço Nacional de Saúde)	Retorna uma lista de prescrições (Prescription)
getPrescriptionByID	Retorna uma prescrição pelo seu identificador	Identificador da receita	Retorna uma prescrição (Prescription)
getEPSOSPrescription	Retorna uma prescrição no formato epSOS	Identificador da receita	Retorna um XML, (Prescrição em CDA HL7v3)
A interação com o simulador da BDNP foi feita através de um cliente criado a partir do WSDL desse mesmo serviço. Posteriormente foi somente invocar os seus métodos.
A comunicação segura entre o bVS Prescriptions e o simulador da BDNP, foi assegurada por um protocolo de Mutual Certifícate. Foram gerados certificados com recurso ao OpenSSL [38] para a RTS e aplicações clientes, neste caso para o simulador da BDNP. O processo de cifra de mensagens decorre com recurso a chaves assimétricas, apoiado nos certificados configurados nas entidades intervenientes. Como a BDNP retorna mensagens XML, para a extração da informação obtida, foi usado o DOM [39].
Para a criação de documentos clínicos orientados a operações de interoperabilidade transfronteiriça, foi necessário recorrer às bibliotecas Model-Driven Health Tools da Open Health Tools [35]. Estas bibliotecas permitem a representação dos dados de prescrição de medicamentos em documentos clínicos de acordo com as
especificações do reference model HL7v3. Estas bibliotecas possuem uma estrutura que vai sendo preenchida com os dados da prescrição. Contudo nem sempre os dados podem estar na mesma notação da rede epSOS, estas bibliotecas possuem também um conjunto métodos, códigos e terminologias para efetuar essa tradução. Foi no entanto necessário criar um conjunto de terminologias extra, que não tinham suporte nessas ferramentas, para especificar alguns dados relevantes da prescrição, para que todos os campos do documento ficassem preenchidos corretamente no formato epSOS [6].
5.1.2	BDNP (Base de Dados Nacional de Prescrições) simulador
Este segundo módulo implementado, a BDNP, foi um serviço implementado por forma a recriar o repositório nacional de prescrições de receitas médicas. Este serviço foi criado externamente à RTS como um serviço independente. Foi orientado a serviço e implementado segundo o protocolo SOAP, por forma a ser reutilizável e acessível a terceiros.
Foi criada uma base de dados PostgreSQL [40] num servidor do IEETA, com o intuito de armazenar informação de prescrição de medicamentos. A base de dados foi desenvolvida com base no modelo de dados descrito no modelo de referência da ACSS
[18]. A geração da base de dados e manipulação dos mesmos foi conseguido, com recurso a Java Persistence API (JPA).
Foi criado um WebService que implementa os métodos descritos abaixo:
Tabela 3 - Métodos implementados pelo WebService da BDNP
Método	Descrição	Parametro(s) de entrada	Retorno
getReceitasBySNS	Retorna uma lista de receitas por utente	Identificador do utente (SNS - ID do Serviço Nacional de Saúde)	Retorna um XML que contém uma lista de receitas
getReceitaBylD	Retorna uma receita pelo ID da mesma	Identificador da Receita	Retorna uma receita codificada em XML
O primeiro método, obtenção de receitas por utente, destina-se a aplicações como a RTS, que pretendam obter todas as receitas de medicamentos por utente. O segundo método, obter uma receita com base no seu identificador, destina-se a aplicações como a RTS, mas também, a farmácias para poderem dispensar o medicamento de uma
determinada receita, como descrito num processo de prescrição eletrónica. A construção dos documentos XML que representam a(s) receita(s), foi efetuada através das bibliotecas DOM [39].
Foi desenvolvida uma camada Web, para funcionar como uma espécie de interface minimalista de prescrição eletrónica de medicamentos, por forma a facilitar a escrita na base de dados. A informação relativa a medicamentos foi obtida com recurso a uma base de dados Oracle [41], base de dados dos medicamentos disponível. A camada de interface foi desenvolvida em JSP com recurso a JavaScript, fazendo uso do jQuery [42] para pesquisa de medicamentos. As seguintes figuras ilustram o processo de adição de uma prescrição à BDNP.
Figura 15 - Pesquisar um utente no servidor na interface Web da BDNP
Na figura 15, o utilizador introduz o número do serviço nacional de saúde do utente numa SearchBox e posteriormente é redirecionado para uma página com todas prescrições associadas ao utente, de realçar que isto é um ambiente simulado daí, existirem poucas prescrições (Figura 16).
Base de Dados Nacional de Prescrições ieeta
Home Prescrições Administradores About Contacts
Presotoes
Utente: 200000777
A prescrição foi inserida com sucesso!
902
Remover Detalhes
952
Remover Detalhes
Adicionar Prescrição
Designed by
Figura 16 - Página com todas as prescrições associadas ao utente
Ao clicar no botão “Adicionar Prescrição” somos redirecionados para uma nova página, para adicionar uma prescrição.
Henovavei: Número de Vias:
bim ;
Observações: Nenhuma
Linhas da Receita
Medicamento:
[Tromalyt- 5091400- 300 mg- e|
Quantidade:
Diploma:
Posologia:
1 cp 12/12h
Descrição Dispensa:
DCI t Remover Linha
Medicamento:
Zovirax - 4641981 - 200 mg - Blil
Quantidade:
Diploma:
Posologia:
[lcp12/12h|	—
Descrição Dispensa:
DCI Z Remover Linha
Adicionar Linha Adicionar Prescrição
Figura 17 - Página para adicionar prescrições
Todas estas páginas foram criadas somente para facilitar o processo de adição de prescrições à BDNP. Para o preenchimento dos dados do medicamento como é possível verificar na figura 17, o mesmo não é preenchido manualmente, o utilizador escreve o nome do medicamento na TextBox, que faz uso do jQuery para autocomplete com a informação proveniente da base de dados dos medicamentos, os parâmetros retornados são os suficientes, para preencher a tabela com a informação do medicamento.
5.2	Incrementos à RTS
Os incrementos efetuados sobre a RTS, para além do serviço desenvolvido na sua camada de serviços, o WS Prescriptions, foram sobretudo na sua camada Web, no Portal dos Profissionais.
Após o utilizador concluir o processo de autenticação, tem a possibilidade de procurar um utente. Após pesquisar o utente, o utilizador tem a possibilidade consultar algumas informações relevantes ao utente, assim como o seu processo clinico, boletins de vacinas e agora, passa a ter a possibilidade de poder aceder ao historial de medicação prescrita ao utente (Figura 18).
Figura 18 - Novo campo para aceder ao historial de prescrições na informação do utente
Ao selecionar essa opção, o utilizador é remetido para uma nova página. Nesta nova página, é mostrada uma tabela com informação de medicamentos prescritos. A informação disposta nesta página são medicamentos obtidos através da invocação do módulo desenvolvido, o bVS Prescriptions.
@ Aplicações Locais Sistema «O
V - a Prescrições - Mozilla Firefox
Ficheiro Editar Ver Histórico Marcadores Ferramentas Ajuda ’	’	’ ' lfiL_ ’	’
I ¡si Prescrições
I gg) http://localho5t:8080/rts/m_prescricoes/prescricao.jsp?d-16544-s=1&amp;amp;d-16544-0=1 &amp;amp;d-16544-px1&amp;amp;rtsid=824£.Ci	▼ G	Google
&amp;amp;	&amp;amp;
DralWs	Estado
		I Responsável			I Forma Farmacêutica	Posologia					
□	2012-10-11	DrDIogo Soares		1	Comprimido de libertação prolongada	1 cp ao jantar	225 mg	false			BDNP
□	2012-10-04	DrDIogo Soares	Tromalyt 150 mg	2	Cápsula de libertação modificada	1 comprimido de 12 em 120	150 mg	false	nld	Não-disponível	BDNP
r	2012-10-02	DrDIogo Soares	Filotempo	1	Comprimido de libertação prolongada	1 cp 12/1211	225 mg	false	s	Nãod.sponível	BDNP
□	2006-12-16	DR SU SANA COSTA	Filotempo	2	Comprimido de libertação prolongada	1 cp de 12/120		false			RTS
□	2006-12-16	DR SU SANA COSTA	Tromalyt	2	Cápsula de libertação modificada	1 cp de 12/120		false	[U +(i)	y Consultar	RTS
□	2006-12-16	DR SUSANA COSTA	s	2	Comprimido	1 cp de 12/120		false	|fcS *(1&gt;		RTS
□	2006-06-19	DR MARIA CARMO	cover syl	2	Comprimido	1 cp de 12/12h		false	s	y Consultar	RTS
□	2005-11-13	DR AMÉRICO SANTOS	Lasl»	1	Comprimido	1 cp de 12/120		false	nld	y Consultar	RTS
□	2005-11-13	DR AMÉRICO SANTOS	[Eig	1	Comprimido	1 cp de 12/120		false		pig Consultar	RTS
□	2005-11-13	DR AMÉRICO SANTOS	cover syl	1	Comprimido	1 cp de 12/120		false	nld	y consultar	RTS
□	2004-12-21	DR DANIEL PINTO	I™"*1!	1	Cápsula de libertação modificada	1 cp de 12/120		false	[U -»(3&gt;	J consultar	RTS
□	2004-12-16	DR MARIA CARMO		2	Comprimido	1 cp de 12/120		false	nld	y consultar	RTS
n	2004-12-16	DR MAR IA CARMO		1	Comprimido de libertação prolongada	1 cp de 12/120		false		y consultar	RTS
□	2004-10-14	DR DANIEL PINTO	Lasix)	1	Comprimido	1 cp de 12/120		false	nld	y consultar	RTS
□	2004-02-17	DR MAR IA CARMO		1	Comprimido	1 cp de 12/120		false	[tS~Tw1	y consultar	RTS
Figura 19 - Vista de medicamentos prescritos em grelha (grid)
Os medicamentos prescritos são dispostos por ordem cronológica (Figura 19). Informações como o nome comercial do medicamento prescrito, o prescritor, a quantidade prescrita, forma farmacêutica do medicamento, posologia, dosagem, entre outras informações são aqui dispostas. Optou-se por utilizar o nome comercial do medicamento em detrimento da substância ativa, pois através do nome comercial é possível obter a substância ativa já o inverso não se verifica pois diferentes medicamentos podem ter a mesma substância ativa. É também possível determinar o tipo de fonte da prescrição, RTS, no caso de ser um medicamento prescrito num episódio de contacto da RTS ou BDNP, no caso de ser um medicamento de uma prescrição do repositório nacional. No caso de ser um medicamento oriundo da RTS, é possível ainda relacionar esse medicamento, com o episódio clínico onde foi feita a sua administração ao paciente, daí existir a opção de consulta do resumo do episódio, assim como eventuais detalhes do episódio.
Também é permitido ao utilizador obter detalhes sobre o medicamento, ao clicar sobre o nome comercial do mesmo. É aberta uma janela com informações do prontuário terapêutico do medicamento (Figura 20).
Figura 20 - Janela do prontuário terapêutico, aberta após clique no nome do medicamento
No canto superior direito, é possível verificar que existe dois tipos de vista (Figura
21). Neste caso é a vista em grelha que está selecionada, vista selecionada por omissão.
Figura 21 - Botões para alternar entre as vistas de grid e timeline
Ao selecionar a outra vista, a vista em cronologia (timeline), o utilizador pode agora consultar a informação de medicamentos prescritos e os seus detalhes numa perspetiva temporal.
Médico: Dr.Diogo Soares
Nome comercial: Tromalyt 150 mg
Posologia: 1 comprimido de 12 em 12h
Dosagem: 150 mg
Forma Farmacêutica: Cápsula de libertação modificada
Quantidade: 2
&amp;amp;	ft,
Detalhes	Estado
® Prescrições - Mozilla F... '
Figura 22 - Vista em cronologia de medicamentos prescritos
Nesta vista (Figura 22), os medicamentos são distribuídos numa barra temporal de acordo com a sua data de prescrição. Esta vista é uma página JSP implementada com recurso a código ativo, JavaScript. A informação dos medicamentos é obtida através do módulo implementado bVS Prescriptions.
5.3	Exportação de prescrições no formato epSOS
Uma prescrição para ser exportada para a rede epSOS tem que estar orientada a um modelo de referência de troca de documentos clínicos. Como tal, foi necessário identificar o formato do documento, e desenvolver uma funcionalidade para executar essa conversão. No módulo bVS Prescriptions foi desenvolvido um método denominado “getEPSOSPrescription”, em que lhe é passado como parâmetro o identificador da receita a converter, e é retornado um ficheiro XML válido na rede epSOS. Ao receber o identificador da receita, o módulo constrói a respetiva Prescrição e faz a sua conversão. No processo de conversão, são usadas as bibliotecas da Open-Health-Tools. É criado um
documento clínico orientado à arquitetura HL7, posteriormente convertido para XML. O documento é preenchido com os respetivos códigos, que o identificam como um documento clínico de prescrição de medicamentos. São também preenchidos os campos com a informação do utente, e de o autor da prescrição. Posteriormente é criada uma secção para inserir a informação de medicamentos prescritos (Figura 23).
LUU&lt;- X.O.U.X.-X.X.XX.OOC.XX.XU.X.O.X.O.X
cmanufacturedM aterial &gt;
-&lt;code code="R03DA05" codeSystem="2.16.840.1.113883.6.73" codeSystemName=''ATC" displayName="ammophylline"&gt;
-	&lt;originalText&gt;
«^reference value="#med.0"/&gt; c/originalText&gt;
&lt;/code&gt;
cname&gt;Filotempo&amp;lt;/name &gt;
cepsos:formCode code="10227000" codeSystem="l.3.6.1.4.1.12559.11.10.1.3.1.44.1" codeSystemName="EDQM" displayName="Modified-release tablet"/&gt;
-	ceps os: as Content classCode="CONT"&gt;
-	&lt;epsos:containerPackagedMedicine classCode="CONT" determinerCode="INSTANCE"&gt;
ceps os: n ame &gt;Filotempo&amp;lt;/eps os: n ame &gt; ceps os: f ormC o de nullFlavor=" NI"/&gt; cepsos:capacityQuantity value="l cp 12/12h" unit="l"/&gt;
&lt;/epsos:containerPackagedMedicine&gt;
c/epsos:asContent&gt;
—	cepsos:ingredient classCode="ACTI"&gt;
-	cepsos:quantity&gt;
&lt;epsos:numerator value="225 " unit="mg"/&gt; cepsos: denominator nullFlavor="UNK"/&gt;
&lt;/epsos :quantity&gt;
-cepsosdngredient classCode="MMAT" detennineiCode="KIND"&gt;
&lt;epsos:code xsi:type="CE" code="R03DA05" codeSystem="2.16.840.1.113883.6.73" codeSystemName="ATC" displayName="a minophylline"/&gt;
ceps os: n ame &gt;aminophyllin.e&lt;/eps os: n ame &gt;
c/epsos:ingredient&gt;
c/epsos:ingredient&gt; c/manufacturedMaterial&gt;
Figura 23 - Informação de um medicamento no documento clínico
Para preencher corretamente os campos do medicamento é necessário fazer algumas normalizações aos seus dados. Para isso recorreu-se à cópia base de dados dos medicamentos, para se obter o código Anathomical Therapeutical Chemical (ATC) [43] do medicamento, assim como o nome da respetiva substância ativa.
Voltando à vista em grelha, foi adicionada uma funcionalidade, com o intuito de demonstrar a construção de um documento clínico orientado ao formato epSOS, com base no modelo de dados usados. A funcionalidade consiste, em selecionar um conjunto de medicamentos, e carregar no botão “Exportar Prescrições".
		* I Responsável	CH Al&lt;
□	2012-10-11	DrDiogo Soares	
■	2012-10-04	Dr.Diogo Soares	Tto
□	2012-10-02	Dr.Diogo Soares	
□	2006-12-16	DR SUSANA COSTA	
0	2006-12-16	DR SUSANA COSTA	12°
□	2006-12-16	DR SUSANA COSTA	La;
0	2006-06-19	DR MARIA CARMO	
□	2005-11-13	DR AMÉRICO SANTOS	La!
□	2005-11-13	DR AM ER ICO SANTOS	
□	2005-11-13	DR AMERICO SANTOS	
■	2004-12-21	DR DANIEL PINTO	
□	2004-12-16	DR MARIA CARMO	Las
o	2004-12-16	DR MARIA CARMO	Pih
□	2004-10-14	DR DANIEL PINTO	La,
□	2004-02-17	DR MARIA CARMO	La,
Exportar Prescrição(ões) |
Figura 24 - Exportar medicamentos no formato epSOS, exemplificação
Selecionamos um conjunto de medicamentos, e carregamos no botão para exportar os mesmos (Figura 24). Posteriormente, a RTS reúne as receitas onde esses medicamentos foram prescritos e, são essas receitas que vão ser exportadas para CDA Hl7v3 (Figura 25), uma vez que estamos a exportar receitas e não medicamentos.
|B http://localhost:8080/rts/Ret:urnEpsosDocumentXML?receitalD=BDNP:1002&amp;amp;sns=200000777&amp;amp;rtsicl=824	v|e| Google	&lt;Ç|	’
-&amp;lt;ClinicalDocument xsi:schemaLocation="urn:hl7-org:v3 ..\schema\CDA_extended.xsd"&gt;
dypeldroot="2.16.840.1.113883.1.3" extension="P0CDHD000040’7&gt;
demplateld root=" 1.3.6.1.4.1.12559.11.10.1.3.1.1. l'/&gt;
ddroot="2.16.840.1.113883.19.4" extension= 'epSOS.EPrescription.PT.1002.200000777’7&gt;
ccode code="57833-6" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC" displayName="ePrescription"/&gt;
&lt;title&gt;epSOS Receita Electronica - epSOS ePrescription&lt;/titIe&gt;
&lt;effectiveTime value=”20121024"/&gt;
cconfidentialityCode code="N" code System="2.16.840.1.113883.5.25" codeSystemName= "HL7 Confidentiality" displayName="normal7&gt; danguageCode code="pt-PT’7&gt;
&lt;versionNumber value=" 17&gt;
—&amp;lt;recordTarget&gt;
-	&lt;patientRole&gt;
dd root="2.16.840.1.113883.19.4" extension="200000777’7&gt;
&lt;addr null Flavor = "NI /&gt;
&lt;telecom nullFIavor="NI'7&gt;
-	&lt;patient&gt;
—	&lt;name&gt;
&amp;lt;given&gt; MARTIN&lt;/given&gt;
&lt;family&gt;CUNHA&lt;/family&gt;
&lt;/name&gt;
&lt;administrativeGenderCode code="M" codeSystem="2.16.840.1.113883.5.1" codeSystemName="HL7 AdministrativeGender" displayName="Male’7&gt; cbirthTime value=”19650407"/&gt;
&lt;/patient&gt;
&lt;/patientRole&gt;
c/recordTarget&gt;
-&lt;author&gt;	n
dime value="2D1210247&gt;	W
-	-cassignedAuthor classCode="ASSIGNED"&gt;
-	&lt;assignedAuthoringDevice&gt;
&lt;	m anuf actur erMo delN am e&gt; EpS OS. PT. NationalC onne ctor&lt;/m anuf actur erMo delN am e&gt;
&lt;	softwdreName&gt;Portuguese National Connectorc/softwareNamea-
&lt;/assignedAuthoringDevice&gt;
-	&lt;representedOrganization&gt;
dd nullFlavor="NA’7&gt;
&lt;name&gt;IEETA-UA&lt;/name&gt;
-	&lt;addr&gt;
Ü [RTS.PRO-NetBeans I...	® Mozilla Firefox
Figura 25 - Receita no formato epSOS
Finalmente para garantir a integridade do mesmo foram feitos testes de validação sobre o documento gerado com o intuito de garantir a conformidade do mesmo com as “regras” de interoperabilidade entre sistemas de saúde. A validação de CDAs é feita através de Schematrons, um Schematron é uma linguagem baseada em regras de validação para fazer asserções sobre a presença ou ausência de padrões em documentos XML. Neste caso o Schematron define os requisitos a testar num CDA com base nos Schemas do epSOS. São validadas, a estrutura e os campos do XML produzido. Foi utilizado a página da IHE - Integrating the Healthcare Enterprise [44] para efetuar a verificação [45].
Existem dois tipos de Schematrons para efectuar a verificação de CDAs de prescrições:
•	epSOS ePrescription Friendly
•	epSOS ePrescription Pivot
No primeiro caso (Figura 26), é validado somente a arquitetura do documento, no segundo (Figura 27) é feita a validação da arquitetura do documento assim como os códigos. Muito embora o segundo Schematron seja mais completo que o primeiro, foram ambos usados para validar os CDAs produzidos.
Figura 26 - Validação do CDA com o epSOS - ePrescription - Friendly Schematron
Figura 27 - Validação do CDA com o epSOS - ePrescription - Pivot Schematron
44
6	Conclusões
A proposta de trabalho visava o desenvolvimento de serviços de extração e agregação de informação de prescrição disponível em sistemas de informação clínicos e a sua apresentação consolidada a profissionais de saúde, estendendo a RTS com novas capacidades para obter e apresentar a informação de prescrição. Assim como o desenvolvimento de uma fonte de dados que representasse a base de dados nacional de prescrições de medicamentos, e por fim desenvolvimento de métodos necessários para exportar informação de prescrição de medicamentos para a rede epSOS.
6.1 Resultados
Primeiro, face ao fato de não estar disponível o acesso à base de dados nacional de prescrições, foi implementado um serviço que emulasse o efeito, ou seja, que retornasse prescrições de medicamentos por utente. Posteriormente foi criado um módulo interno à RTS para fazer a extração, agregação e transformação da informação de prescrição, e finalmente estendemos o Portal dos Profissionais da RTS para a apresentação das mesmas.
Assim a RTS passa a dispor de mecanismos que permitam a consulta de informação agregada de prescrição de medicamentos. O Profissional de Saúde ao aceder ao Portal dos Profissionais da RTS passa a dispor de uma secção onde poderá consultar o historial de medicamentos prescritos ao utente no momento da avaliação do contexto clínico do utente, assim como poderá consultar informações sobre o medicamento tais como a sua substância ativa e eventuais contraindicações.
No entanto, faltou testar a interface desenvolvida junto de profissionais clínicos. A apreciação de profissionais de saúde seria importante para eventuais melhorias a efetuar sobre o trabalho desenvolvido.
6.2	Trabalho Futuro
Apesar dos objetivos da dissertação terem sido alcançados, há sempre melhorias a fazer. A melhoria que salta mais à vista, é a substituição da fonte de dados que simula o repositório nacional de prescrições, pelo repositório real. Contudo não é a única modificação a fazer. A RTS contém modelos de dados orientados à interoperabilidade clínica, no entanto as interfaces dos centros de saúde e hospitais da RTS usam outros modelos de dados para submeter dados para a rede. Um caso concreto é por exemplo a descrição dos medicamentos prescritos, encontrados no sumário de um episódio clínico. Estes dados não contemplam toda a informação relevante a uma prescrição. Uma melhoria significativa passaria por adicionar mais campos a esses modelos de dados e logicamente estender as interfaces já existentes nos centros de saúde e hospitais da RTS, a suportar operações que preencham esses mesmos campos.
7	Referências
[1]	Ministério da Saúde. RSE - Registo de Saúde Electrónico, R1: Documento do Estado de arte. [Online]. Available: http://www.portaldasaude.pt/NR/rdonlyres/4156EEEF-E601-4ADA-AEB7-14E01F5F52FC/0/RSE R1 Estado da Arte V3.pdf Accessed Oct, 2012.
[2]	Ana Jorge. Comissão Parlamentar da Saúde, Audição na Comissão Parlamentar da Saúde, intervenção da Ministra da Saúde. [Online]. Available: http://www.portaldasaude.pt/Portal/Templates/Generic.aspx?NRMODE=Published &amp;amp;NRNODEGUID={4BF5E1E0-67FE-49CF-84A5-1466A46E9141}&amp;amp;NRORIGINALURL=%2Fportal%2Fconteudos%2Fa%2Bsaude% 2Bem%2Bportugal%2Fministerio%2Fcomunicacao%2Fdiscursos%2Be%2Binterve ncoes%2Fcomiss Accessed Oct, 2012.
[3]	A. Hasman, Ubiquity: Technologies for Better Health in Aging Societies, Proceedings of Mie2006 vol. 124. Amsterdam: IOS Press, 2006, pp. 57-71.
[4]	Rede Telemática de Saúde. http://rtsaude.pt Accessed Oct, 2012.
[5]	IC Oliveira and JP Cunha. “Integration Services to Enable Regional Shared Electronic Health Records” in User Centred Networked Health Care - Proceedings of MIE 2011, Oslo, Norway, 2011, pp. 310-314.
[6]	epSOS. Smart Open Services for European Patients - Semantic Services - Pivot Document Specifications. [Online]. Available:
http://www.epsos.eu/uploads/tx epsosfileshare/D3.5.2 Appendix C Pivot Docum ent Specifications 01.pdf Accessed Oct, 2012.
[7]	World Health Organization. Building Foundations in Europe. Report of the WHO Global Observatory for eHealth. [Online]. Available: http://www.who.int/goe/BFeuroFull.pdf Accessed Oct, 2012.
[8]	Alto Comissariado da Saúde. Plano Nacional de Saúde 2011-2016 “Tecnologias de Informação e Comunicação”. [Online]. Available: http://ser.cies.iscte.pt/index ficheiros/TIC.pdf Acessed Oct, 2012.
[9]	Saúde 24. http://www.saude24.pt Accessed Oct, 2012.
[10]	JL Monteagudo and O Moreno. eHealth Strategy and implementation activities in Portugal. Report in the framework of the eHealth ERA Project, 2011.
[11]	Administração Central do Sistema de Saúde. Desmaterialização da Receita de Medicamentos e da Requisição de MCDTs. [Online]. Available:
http://www.acss.min-saude.pt/Portals/O/Desmaterializacao MM.pdf Accessed Oct,
2012.
[12]	Governo da Republica Portuguesa, Decreto de Lei n.° 106A/2010. 2010
[13]	Governo da Republica Portuguesa. Memorando de entendimento sobre as condicionalidades de política económica. [Online]. Available: http://www.portugal.gov.pt/media/371372/mou pt 20110517.pdf Accessed Oct, 2012.
[14]	Ministério da Saúde. Despacho n.° 9186/2011. 2011.
[15]	Ministério da Saúde. Monotorização da Prescrição de Medicamentos de Ambulatório. [Online]. Available: http://www.portaldasaude.pt/NR/rdonlyres/C1FC69DF-4E63-486C-B726-A6E15ACF7DAE/0/RelatMonitPrescripMedsIndNacionaisLocaisJAN2012.pdf Accessed Oct, 2012.
[16]	Plano Tecnológico. Agenda Digital: Desmaterialização da Prescrição de Medicamentos e dos MCDTS. [Online]. Available: http://www.planotecnologico.pt/en/lisbon-strategy/priority-lines/4.%20proximity%20healthcare/paper-free-prescriptions/innerpage.aspx?idcat=756&amp;amp;idmastercat=738&amp;amp;idlang=1 Accessed Oct, 2012.
[17]	Administração Central do Sistema de Saúde. (2012). Software para Meios Complementares de Diagnóstico e Terapêutica. Lista de Fornecedores de MCDT ao abrigo da Declaração de Conformidade do Fabricante. [Online]. Available: http://www.acss.min-saude.pt/Portals/0/Fornecedores%20MCDT 21nov2012.pdf Accessed Oct, 2012.
[18]	Administração Central do Sistema de Saúde. Base de Dados Nacional de Prescrições, Interface para recepção de receitas médicas. [Online]. Available: http://www.acss.min-saude.pt/Portals/0/ET ACSS 20 2011 REV2.pdf Acessed Oct, 2012.
[19]	MedCom. http://www.medcom.dk Accessed Oct, 2012.
[20]	JP Cunha, I Cruz, IC Oliveira, AS Pereira, CT Costa, AM Oliveira and A Pereira, “The RTS Project: Promoting Secure and Effective Clinical Telematic Communication within Aveiro Region” in eHealth 2006 High Level Conferênce, Málaga, 2006.
[21]	Comission of The European Communities. European Commission Recommendation on cross-border interoperability of eletronic health record
systems. [Online]. Available:
http://ec.europa.eu/information society/newsroom/cf/document.cfm?action=display &amp;amp;doc id=513 Accessed Oct, 2012.
[22]	Smart Open Services for European Patients (epSOS). http://www.epsos.eu Accessed Oct, 2012.
[23]	epSOS. Final definition of functional service requirements - Patient Summary. [Online]. Available:
http://www.epsos.eu/uploads/tx epsosfileshare/D3.2.2 Final Definition Functional Service Req Patient Summary.pdf Accessed Oct, 2012.
[24]	epSOS. Final definition of functional service requirements - ePrescription. [Online]. Available:
http://www.epsos.eu/uploads/tx epsosfileshare/D3.1.2 Final Definition of Functio nal Service Requirements ePrescription 01.pdf Accessed Oct, 2012.
[25]	Health Level 7. http://www.hl7.org/ Accessed Oct, 2012.
[26]	F Amato, AR Fasolino, A Mazzeo, V Moscato, A Picariello, S Romano and P Tramontana, “Ensuring Semantic Interoperability for e-Health Applications” in International Conference on Complex, Intelligent and Software Intensive Systems, CISIS 2011, Seoul, 2011.
[27]	epSOS. epSOS: eDispensation Service. [Online]. Available: http://www.epsos.eu/technical-background/systems-standards/edispensation-service.html Accessed Oct, 2012.
[28]	Open Health Tools (OHT). http://www.openhealthtools.org/ Acessed Oct, 2012.
[29]	M Skip and R.Ken, “Open Health Tools: Tooling for Interoperable Healthcare” in Talent First Network, Ottawa, 2008
[30]	Model Driven Health Tools. https://www.projects.openhealthtools.org/sf/projects/mdht/ Accessed on Oct 2012.
[31]	W Crawford and J Kaplan, J2EE Design Patterns, Sebastopol, CA: O'Reilly Media,
2003.
[32]	Oracle. Java 2 Platform, Entreprise Edition (J2EE) Overview. [Online] Available: http://www.oracleimg.com/technetwork/java/javaee/appmodel-135059.html Accessed Oct, 2012.
[33]	extensible Markup Language (XML). http://www.w3.org.org/standards/xml/ Accessed Oct, 2012.
[34]	GI Paterson, M Shepherd, X Wang, C Watters and D Zitner, “Using the XML-based Clinical Document Architecture for Exchange Structured Discharge Summaries” in 35th Hawaii International Conference on System Sciences, Island of Hawaii, 2002.
[35]	Apache Struts. http://struts.apache.org/ Accessed Oct, 2012.
[36]	JavaScript. https://developer.mozilla.org/en-US/docs/JavaScript Accessed Oct, 2012.
[37]	R. Housley, W. Polk, W. Ford, and D. Solo, Internet x.509 public key infrastructure certificate and certificate revocation list (crl) profile. RFC3280, 66, 2002.
[38]	OpenSSL. www.openssl.org Accessed Oct, 2012.
[39]	WC3 DOM. www.w3.org/dom/ Accessed Oct, 2012.
[40]	PostgreSQL. www.postgresql.org/ Accessed Oct, 2012.
[41]	Oracle SQL. www.oracle.com/technetwork/developer-tools/sql-developer/overview/index.html/ Accessed Oct, 2012.
[42]	jQuery. http://jquery.com/ Accessed Oct, 2012.
[43]	World Health Organization Collaborating Centre for Drug Statistics Methodology. ATC, Structure and Principles. [Online]. Available: http://www.whocc.no/atc/structure and principles/ Accessed Oct, 2012.
[44]	IHE. www.ihe.net/ Accessed Oct, 2012.
[45]	Gazelle IHE. External Validation Service Front-End. [Online]. Available: http://gazelle.ihe.net/EVSClient/cda/validator.seam?cid=467 Accessed Oct, 2012.
51</field>
	</doc>
</add>