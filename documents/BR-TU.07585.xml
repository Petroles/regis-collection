<?xml version="1.0" encoding="utf-8"?>
<add>
	<doc>
		<field name="docid">BR-TU.07585</field>
		<field name="filename">12304_Macedo_DanielLeal_D.pdf</field>
		<field name="filetype">PDF</field>
		<field name="text">UNICAMP
DANIEL LEAL MACEDO
SCATTERING-BASED DECOMPOSITION OF
SENSITIVITY KERNELS OF ACOUSTIC FULL WAVEFORM INVERSION
DECOMPOSIÇÃO BASEADA EM TEORIA DE ESPALHAMENTO DOS NÚCLEOS DE SENSIBILIDADES DA INVERSÃO DE ONDA COMPLETA ACÚSTICA
CAMPINAS, SP 2014
ii

U&amp;amp;MICAMP
UNIVERSIDADE ESTADUAL DE CAMPINAS
FACULDADE DE ENGENHARIA MECÂNICA
E INSTITUTO DE GEOCIÊNCIAS
DANIEL LEAL MACEDO
SCATTERING-BASED DECOMPOSITION OF SENSITIVITY OF ACOUSTIC FULL WAVEFORM INVERSION
DECOMPOSIÇÃO BASEADA EM TEORIA DE ESPALHAMENTO DOS NÚCLEOS DE SENSIBILIDADES DA INVERSÃO DE ONDA COMPLETA ACÚSTICA
Thesis presented to the Mechanical Engineering Faculty and Geosciences Institute of the University of Campinas in partial fulfillment of the requirements for the degree of Doctor in Petroleum Sciences and Engineering in the area of Reservoirs and Management.
Tese apresentada à Faculdade de Engenharia Mecânica e Instituto de Geociências da Universidade Estadual de Campinas como parte dos requisitos exigidos para a obtenção do título de Doutor em Ciências e Engenharia de Petróleo na área de Reservatórios e Gestão.
Orientador: Prof. Dr. Joerg Dietrich Wilhelm Schleicher
Este exemplar corresponde à versão final da tese defendida pelo aluno Daniel Leal Macedo, e orientada pelo Prof. Dr. Joerg Dietrich Wil-
Macedo, Daniel Leal, 1975-
M151s Scattering-based decomposition of sensitivity kernels of acoustic full waveform inversion / Daniel Leal Macedo. - Campinas, SP : [s.n.], 2014.
Orientador: Joerg Dietrich Wilhelm Schleicher.
Tese (doutorado) - Universidade Estadual de Campinas, Faculdade de Engenharia Mecânica e Instituto de Geociências.
1. Propagação de ondas. 2. Ondas sísmicas. 3. Inversão (Geofísica). I. Schleicher, Joerg Dietrich Wilhelm,1964-. II. Universidade Estadual de Campinas. Faculdade de Engenharia Mecânica. III. Título.
Informações para Biblioteca Digital
Título em outro idioma: Decomposição baseada em teoria de espalhamento dos núcleos de sensibilidade da inversão de onda completa acústica
Palavras-chave em inglês:
Wave propagation
Seismic waves
Inversion (Geophysics)
Área de concentração: Reservatórios e Gestão
Titulação: Doutor em Ciências e Engenharia de Petróleo
Banca examinadora:
Joerg Dietrich Wilhelm Schleicher [Orientador]
Jesse Carvalho Costa
Ricardo Caetano Azevedo Biloti
Claudio Guerra Cardoso
Djalma Manoel Soares Filho
Data de defesa: 29-08-2014
Programa de Pós-Graduação: Ciências e Engenharia de Petróleo
UNICAMP
UNIVERSIDADE ESTADUAL DE CAMPINAS
FACULDADE DE ENGENHARIA MECÂNICA
E INSTITUTO DE GEOCIÊNCIAS
TESE DE DOUTORADO
SCATTERING-BASED DECOMPOSITION OF THE
SENSITIVITY KERNELS FOR ACOUSTIC FULL
WAVEFORM INVERSION
Autor: Daniel Leal Macedo
Orientador: Prof. Dr. Joerg Dietrich Wilhelm Schleicher
A banca examinadora composta pelos membros abaixo aprovou esta tese:
Prof. Dr. Ricardo Caetano Azevedo Biloti
DMA/IMECC/l JNICAMP
Dr. Claudio Guerra Cardoso
PETROBRAS/RJ
Campinas, 29 de agosto de 2014.
Manoel Soares Filho
PETROBRAS/RJ
vi
Acknowledgements
My sister Karla, and brother Eduardo, I thank you for the unshakeable belief in my potential, which helped me to face those few moments when dark clouds prevented me from seeing the clear sky. I love you.
Luciana e my daughter Clara, I thank you for all the happy moments I shared with you. You being part of my life is one of the most valuable gifts life gave me during my PhD. You are going to be part of me forever.
I would like to thank my advisor, Joerg Schleicher, for the unwearying disposition to help, discuss and collaborate with me since before the PhD itself.
I would like to thank Ivan Vasconcelos for opening many doors on my professional life; for being, together with Joerg, the corner stone of my academic development, with enlightening discussions; and for being a good friend in foreign lands.
I would like to thank all the friends I made at the Computational Geophysics Laboratory (LGC), the ones that are already gone and the newcomers. Among the students and the technical staff I could find valuable discussions, helpful technical support and, most important of all, good friends.
I would like to thanks the Petroleum Science and Engineering Program staff, in special, Sonia and Michelle. They were always helpful, thoughtful and competent.
Last, but not the least, I would like to thank also the Brazilian National Research Council (CNPq) and the Science and Technology National Institute for Petroleum Geophysics (INCT-GP), as well as Petrobras, Schlumberger, and the sponsors of the Wave Inversion Technology (WIT) Consortium for The financial support.
viii
Abstract
While in principle nonlinear gradient-based full-waveform inversion (FWI) is capable of handling all aspects of wave propagation contained in the data, including full nonlinearity, in practice, it is limited due to its notorious sensitivity to the choice of the starting model. To help addressing model-convergence issues in FWI, we study a decomposition based on the scattering theory that allows to break the acoustic-wavefield sensitivity kernels with respect to model parameters into background and singular parts. The estimates for both background perturbation and/or singularpart perturbation obtained with the subkernels' adjoints are components of the estimate obtained with the total kernel's adjoint. Our numerical experiments shows the feasibility of our main claim: the decomposition into subkernels allows to backproject the scattered-wavefield residuals only so as to obtain reasonable background-model perturbation estimates. In an experiment with restricted acquisition geometry (reflection data, narrow offset), the multiple-scattering subkernels take advantage of medium self-illumination provided by the scattered wavefields. This self- illumination provides better estimates, with longer wavelengh content.
Key words: Inverse theory; Full waveform inversion; Wave scattering and diffraction; Computational seismology; Theoretical seismology; Wave propagation
x
Resumo
A inversão de onda completa (FWI, do inglês “full waveform inversión”) nãolinear baseada em gradientes (métodos de descida) é, a princípio, capaz de levar em conta todos os aspectos da propagação de onda contida nos dados sísmicos. Porém, FWI baseada em gradientes é limitada pela sua bem conhecida sensibilidade no que diz respeito à escolha do modelo inicial. Com o intuito de melhor entender algumas questões relacionadas à convergência do modelo na FWI, nós estudamos uma decomposição baseada na teoria de espalhamento que permite dividir os núcleos de sensibilidade dos campos de onda acústica em função dos parâmetros do modelo em duas partes: uma relativa ao componente de fundo, outra relativa à componente singular do modelo. Estimativas para a perturbação de fundo, bem como para a perturbação da parte singular do modelo obtidas com os adjuntos destes subnúcleos são componentes da estimativa obtida com o adjunto do núcleo total de sensibilidade. Os experimentos numéricos suportam a tese de que a decomposição em subnúcleos permite que se retroprojete somente os resíduos do campo de onda espalhado de modo a obter estimativas razoáveis da perturbação de fundo do modelo. Em um experimento com geometria de aquisição restrita (dados de reflexão com afastamento curto), os subnúcleos baseados em espalhamento múltiplo se aproveitam da autoiluminação do meio devido às ondas multiplamente espalhadas. A autoiluminação fornece estimativas melhores com conteúdo espectral mais rico nas baixas frequências.
Palavras-chave: Problemas inversos; Inversão de onda completa; espalhamento de onda e difração; Sísmica computacional; Teoria sísmica; Propagação de onda
xii
Contents
List of Tables	xxvii
List of Symbols, Variables and	their	Definitions	xxix
1	Introduction	1
1.1	FWI overview................................................................. 2
1.1.1	Forward Modelling..................................................... 3
1.1.2	Multiscale approach................................................... 5
1.1.3	Optimisation methods ................................................. 7
1.1.4	Adjoint-state methods ............................................... 12
1.1.5	Challenges........................................................... 14
1.2	Kernel decomposition........................................................ 16
2	Kernel Decomposition	21
2.1	Full-waveform inversion and sensitivity kernels............................. 21
2.1.1	Conventional formulation ............................................ 22
2.1.2	Decomposed perturbation.............................................. 26
2.2	Physical interpretation of the forward decomposition........................ 33
2.2.1	Old information,	brand new point of view............................. 33
2.2.2	Multiple scattering/internal reflection uncovered ................... 33
2.2.3	Background and singular-part contributions........................... 36
2.2.4	Physical interpretation of the kernels: naming the terms............. 38
2.3	Inversion: backprojecting the residuals into model space.................... 41
2.3.1	Conventional formulation .............................................. 41
2.3.2	Decomposed formulation................................................. 42
2.3.3	Residual information leakage .......................................... 43
3	Numerical Experiments and Discussion	45
3.1	Experimental Procedure......................................................... 45
3.1.1	Forward Decomposition.................................................. 45
3.1.2	Backprojecting residuals............................................... 46
3.2	Model gallery.................................................................. 47
3.3	Experiment gallery ............................................................ 51
3.3.1	Experiment 1: Constant background perturbation of Model I,
forward decomposition ................................................. 51
3.3.2	Experiment 2: Lens-shaped background perturbation of Model I,
backprojecting residuals............................................... 58
3.3.3	Experiment 3: Constant background perturbation of Model II,
forward decomposition ................................................. 64
3.3.4	Experiment 4: Perturbing the scatterers’ position of Model II,
forward decomposition ................................................. 68
3.3.5	Experiment 5: Perturbing the scatterers’ position of Model II,
backprojecting residuals .............................................. 71
3.3.6	Experiment 6: Lens-shaped background perturbation of Model III,
forward decomposition ................................................. 76
3.3.7	Experiment 7: Lens-shaped background perturbation of Model III,
backprojecting residuals............................................... 80
3.3.8	Experiment 8: Lens-shaped background perturbation of Model IV,
backprojecting residuals .............................................. 87
4	Application: Scattering-based Sensitivity Kernels for Time-lapse Differential Waveform Inversion	93
4.1	Time-lapse survey as a FWI scattering problem.................................. 94
4.2	Numerical experiments.......................................................... 95
4.2.1	Large offset surveys .................................................. 96
4.2.2	Narrow offset surveys .................................................104
5	Final Remarks	111
5.1	Thesis'follow-ups ..........................................................115
References	117
A	Mathematical Definitions	125
B	Generalised decomposition and its relation to the proposed decomposition	127
B.1 Generalised decomposition.....................................................127
B.2 Four-fold decomposition of a perturbed model and wavefield....................128
B.	3 Linearisation of the fourfold decomposition.................................131
C Estimates for the Model Perturbations	135
C.	1	Estimate	of the background perturbation SKBtBS ...........................135
C.2	Estimate	of the background perturbation SpBtBS............................136
C.3	Estimate	of the background perturbation SKBstbVB..........................138
C.4	Estimate	of the background density perturbation SpBsbVB...................140
D Superposition of Subkernels of the Singular-wavefield Residual	143
List of Figures
1.1	[Extracted fromBunks et al. (1995)] Heuristic illustration of the multigrid method applied to a nonlinear problem. Frame (a) illustrates a 1-D objective function and frames (b)-(e) illustrate the same objective function at ever increasing scale lengths. A gradient method applied to the shortest scale succeeds in finding the local minimum closest to the starting point, whereas the gradient method applied to the longest scale finds the global minimum (at that scale) regardless of the starting point. A fining up procedure helps find the estimate of the position of the global
minimum for the fine scale problem..................................... 6
1.2	Line search with three trial step lengths and a second-order polynomial interpolation. The parabola vertex defines the efficient step length............. 8
1.3	Convergence in the steepest descent method for a quadratic objective function. ...	11
1.4	Conventionally, the exact model (top) is thought of as being decomposed into a smooth background (bottom left), supposedly known, and a singular scattering part (bottom right), to be determined under the assumption that it is small against
the background............................................................... 17
1.5	Here, the exact model (top) is thought of as being decomposed into a slightly wrong
estimate of the smooth background (centre left), and a slightly wrong singular scattering part (bottom left), both supposed to be known, plus perturbations to the background (centre right) and the singular part (bottom right), to be determined under the assumption that they are small against their known estimates........19
2.1	A sketch of the proposed decomposition. The components of the reference model are thought to represent a (smooth) background model and an estimate of the singular part of the model (m0 = mB + mS). The two components of the perturbation part are the perturbations of these two model components ()m = JmB + 6mS). . 28
2.2	Different terms showing different levels of interaction of single- and multiple- scat-tered/reflected information. The colour code is the one adopted in eqs. (2.35), (2.36), (2.37) and (2.38). From top left, in clockwise direction: (a) and (b) show contribution from single-scattering events, difference between them resting on which operator is used to generate the secondary source to be extrapolated; (c) brings contribution from multiple-scattering events from receiver-side; (d) shows
the contribution of the strong multiple-scattering events........................34
2.3	Subkernels obtained from the decomposition of the sensitivity kernel U for bulkmodulus perturbation. Kernel V for density perturbation is decomposed analogously. 37
2.4	Physical meaning of the subkernels. Each one of the cartoons shows three ele-
ments: source-side wavefield; the operator generating the secondary source; and the receiver-side wavefield extrapolator. Subcaptions indicate the new name and correspondence to the previous, numbered nomenclature............................40
3.1	Unperturbed velocity Model I (velocity in m/s).The first layer has a velocity of
1500 m/s, and the second layer a velocity of 2500 m/s. Density is kept constant (2200kg/m3). The source and receiver positions are indicated by black star and triangle respectively. ......................................................... 48
3.2	Unperturbed velocity Model II (velocity in m/s) containing 40 randomly dis-
tributed scatterers, with constant background velocity (2205 m/s) and density (2200 kg/m3). One source (black star) and two control receivers (black triangles) - named as cr154 (top) and cr283 (bottom) - were used in the forward decompositions experiments. The other sources and receivers (white stars and triangles respectively) were used in the backpropagation experiment....................... 48
3.3	Unperturbed velocity Model III (velocity in m/s) containing 60 randomly distributed scatterers, with constant background velocity (2205 m/s) and density (2200 kg/m3). For the numerical experiments, we used the same acquisition ge-
ometry as in Model II. .................................................. 50
3.4	Unperturbed velocity Model IV (velocity in m/s) containing 150 randomly distributed scatterers, with constant background velocity (2205 m/s) and density (2200 kg/m3). ................................................................ 50
3.5	Experiment 1. True total wavefield residual Sptrue = p — p0 at cr550. Ob-
serve two distinct signals: the direct wavefield residual (peak at 0.27 s) and the reflected/scattered wavefield residual (peak at 0.36 s)......................... 52
3.6	Experiment 1. Linearised background-wavefield residuals SpB (blue line) evaluated at cr550 as compared to the true one (red line), SpB........................... 53
3.7	Experiment 1. Terms related to single-scattering effects at the medium perturbations (blue lines): SpS-BLB (top), SpSyBBB (centre), and their sum (bottom). The red line true singular residual Spg^. Separately, SpS—BLB and SpStBBB carry the largest energy. Their sum demonstrates that they are approximately complementary. 53
3.8	Experiment 1. Multiple-scattering contributions (blue lines), from top to bottom: SpS,BBS, SpSySBB and SpS,SBS. In all figures, SpSue is depicted in red lines for comparison. The first two terms carry most of the energy of the singular residual
SpS............................................................................. 54
3.9	Experiment 1. Non-symmetrical contributions (blue lines), first four traces from
top to bottom: Sps-bls, Sps,bVB, Sps,bvs and Sps,bVB + Sps,bvs respectively. In these traces, Spgue is depicted in red lines for comparison. The last trace show both — SpS, BLS (black line) and SpS,bVB + SpS,bVS (dark green line) contributions normalised to their respective maximum absolute value........................... 56
3.10	Experiment 1. Comparing Sptrue (red line) with evaluated counter-parts. In black, Sp (evaluated with eq. (2.14)) and, in blue, SpB + SpS (evaluated with eq. (2.25) and all but the 1st, 2nd and 7th terms of eq. (2.33) respectively). See
the perfect match between blue and black lines.................................. 57
3.11	Experiment 2. Perturbation in the bulk-modulus background model, SKB. The
scalebar shows, in percentage, the perturbation magnitude....................... 58
3.12	Experiment 2. Top: Bulk modulus estimate SKest. The others are all background bulk-modulus-estimate contributions. From left to right, top to bottom: SKBfB;
SKf^BcB; SKBfi-BS; SKBfi-SB; SKBf_BB and SKBfi-SS. The first of them in the
upper-left corner, SKBfB, is result of background residual backprojection; the rest of them are result of singular residual backprojection. The subtraction of SKBstB (upper-left corner) with SKBst-BLB (upper-right corner) yields the conventional estimate SK^v (Figure 3.13, upper-left corner).................................... 60
3.13	Experiment 2. Top: Bulk modulus estimate SKest. Upper-left corner: Bulk
modulus estimate SK^ obtained with the conventional approach. The others are all background bulk-modulus-estimate contributions. Upper-right corner: the background estimate sKB' = SKB^ + SKBsts. Lower-left corner: SK^p, result of background residual backprojection. Lower-right corner: SK^s, result of singular residual backprojection (sum of all five contributions)........................61
3.14	Experiment 2. First four estimates are obtained by backprojecting the background residual with the adjoint sub-kernels USj, i.e., SKj^) (cross-terms). From left to right, top to bottom: SK^(b) = Us,bs Spb; ^KeBB(B) = Usbb Spb; SKSS(B) = US,ss Spb ; SkSB(b) = USsb Spb. The next two figures are each one of the sums seen in the right-hand side of eq. (3.11). From left to right: (j2j U J SpB and j U J Sps. At the lower-left corner is displayed the sum-
---est
mation of the previous sums, i.e. , SK of eq. (3.11). At the lower-right corner, the bulk-modulus estimate SKest for comparison................................ 62
3.15	Experiment 3. Linearised background-wavefield residuals SpB (blue line) evaluated at cr154 as compared to the true ones (red line), SpBue.......................65
3.16	Experiment 3. Terms related to single-scattering effects at the medium pertur-
bations evaluated at cr154 (blue lines): Sps-.BLB (top), Sps,BBB (centre), and their sum (bottom). The red line true singular residual Sp^6. Separately, Sps-BLB and Sps,BBB carry the largest energy. Their sum, Sps-BWB, demonstrates that they are approximately complementary................................................... 66
3.17	Experiment 3.: First two traces from top to bottom: Sps_BLs and Sps,bVB +
Sps,bVs, respectively. In these traces, Sp^6 is depicted in red lines for comparison. The last trace show both 6ps,BLs (black line) and Sps&gt;bVB + Sps,bvs (dark green line) contributions normalised to their respective absolute maximum value..... 67
3.18	Experiment 3. Comparing Sptrue (red line) with evaluated counter-parts at cr154.
In black, Sp (evaluated with eq. (2.14)); in dark green, SpB + Sps (evaluated with eq. (2.25) and all terms of eq. (2.33) respectively); and in blue, SpB+Sps (evaluated with eq. (2.25) and all but the 1st, 2nd and 7th terms of eq. (2.33) respectively). The blue and black lines are indistinguishable.................................... 68
3.19	Experiment 3. Multiple-scattering contributions (blue lines), from top to bot-
tom: Sps,BBS, $Ps,sbb and $Ps,sbs. These are the terms that carry most of the energy of the singular residual Sps. In the last trace we can see the summation of the first two traces depicted above (dark green line) and the Sps evaluated with all five contributions (BBB, SBB, SBS, BBS and —BLB). In all figures, Jpt™e is depicted in red lines for comparison...........................................69
3.20	Experiments 4 and 5. Only the singular part of the model is perturbed, i.e.,
SKs = 0. This is achieved by modifying the vertical and horizontal coordinates of the scatterers randomly within a given range. The cool (blue) spots show the unperturbed positions, while the hot (red) ones tell us the new positions. The intensity of the spots is related to the magnitude of the perturbation. The green background corresponds to no perturbation......................................70
3.21	Experiment 4. Traces evaluated at cr154. Total residual, Sp, given by equation (2.14), in black, and singular-wavefield residual, Sps, equation (2.32), in blue, match almost perfectly. Good match between linearised and true residual, Sps (in blue) and Sp1™ (in red) indicates the good quality of the Born approximation in
this case, which is a consequence of the small perturbations in the model......71
3.22	Experiment 4. All four terms that contribute to the total singular residual at cr154. From top to bottom: Sps,BSB, Sps,ssB, Sps,Bss, Sps,sss. The singlescattering term, 6ps,BSB, accounts for almost all of the complete singular residual. . 72
3.23	Experiment 5. Backprojecting the total (singular) wavefield residual, Jptrue = Jpsue. Cartoons indicate the (sub)kernels used. Top: Bulk modulus perturbation estimate, JKest, obtained with the first equation of (2.49). Bottom: Singular part of bulk modulus perturbation estimate, JKss, obtained with the second equation
of (3.14). Colour scale clipped at 0.6 for better comparison.................. 73
3.24	Experiment 5. Each one of the contributions to the singular perturbation estimate. From top to bottom: SKssBs, aK*BB, SKssss and SKsssB...........................74
3.25	Experiment 5. Top: Singular part of Bulk modulus estimate,	, obtained
with the single-scattering related kernel.Center: Conventional Bulk modulus estimate, iK,eonv, obtained with the background-wavefield related kernel. Note that these estimates are very similar to the true perturbation observed in Figure 3.20, the convetional one being a little better. Bottom: Background bulk-modulus estimate, 5KBst, obtained with first equation of (3.14) (residual leakage). Colour scale
clipped at 0.6 for better comparison......................................... 75
3.26	Experiments 6 and 7. Perturbation in the bulk-modulus background model,
6Kb. The scalebar shows, in percentage, the perturbation magnitude............77
3.27	Experiment 6. Comparison between the total wavefield residual, 8p (black lines)
and sum of background and singular residuals, SpB + 8pS (blue lines). Top: Evaluated at control receiver cr154. Bottom: Evaluated at control receiver cr283. 77
3.28	Experiment 6. Single-scattering terms evaluated at control receiver cr154 (blue
lines): 6pStBBB (top), 6pS-BLB (centre), and their sum ipS;BWB, compared to the true singular-wavefield residual 8pSe (red lines). As expected, these terms are very small because the Fresnel zone of the direct wavefield does not intersect with the lens-shaped perturbed area. Compare with Figure 3.29.................................79
3.29	Experiment 6. Single-scattering terms evaluated at control receiver cr283 (blue lines): 6pStBBB (top), 6pS-BLB (centre), and their sum ipS;BWB, compared to the true singular-wavefield residual 8pSe (red lines). Each of these terms carries much energy, but their sum contributes very little to the singular-wavefield residual.
Compare with Figure 3.28...................................................... 80
3.30	Experiment 6. Terms with the most important contributions to the singular residual evaluated at cr154. From top to bottom: 8pStBBS, 6pS,SBB and 6pStSBS. . . 81
3.31	Experiment 6. Terms with the most important contributions to the singular residual evaluated at cr283. From top to bottom: 8pStBBS, 6pS,SBB and 6pStSBS. . . 82
3.32	Experiment 7. Backprojecting residuals. From top to bottom: Bulk modulus
perturbation estimate, 6Kest, from the total wavefield residual, 5ptrue (equation (2.49)); Background bulk-modulus perturbation estimate, SKBStB, from background residual, 8pB?e (first contribution in first equation of (3.7)); Background bulk-modulus perturbation estimate, 8KBstS, from singular residual, 8pSe (second contribution in first equation of (3.7)); and the sum SK^b + 8K^S.................................. 83
3.33	Experiment 7. Backprojecting residuals. Estimates related to eq. (3.11). From
top to bottom:	U j dps, Ej 6KBj = (Ej u S,j) 'Ps and
their sum. The last is the total perturbation estimate 8Kest, put here for comparison. 84
3.34	Experiment 7. Backprojecting singular-wavefield residual 8pSue. Top: Subker-
nel UB,BS used for backprojection. Bottom: Subkernel UB,SB used for backprojec-tion. Note the very strong similarity between both estimates apart from the region delimited by the receiver and source lines. It suggests a redundancy that might be explored........................................................................ 85
3.35	Experiment 7. Backprojecting singular- wavefield residual 8pSue recorded at
cr283 from the source at 1000 m (black star). Top: Subkernel UB,BS used for backprojection. The singularities act as receivers. Bottom: Subkernel UB,SB used for backprojection. Here, the singularities act as sources. This gives us further insight into the congruence of the parts of Figure 3.34..........................86
3.36	Experiment 8. Backprojecting residuals from “surface” receivers. Top: Bulkmodulus perturbation estimate 8Kest from total wavefield residual 'ptrue, Center: Bulk-modulus perturbation estimate 6KBsB from background residual 8pB?e, Bot-
tom: Bulk-modulus perturbation estimate 8KBsS from singular residual 5pt™e. ...	88
3.37	Experiment 8. Cross-term estimate resulting from the sum (Ej	6Pb.	. . 89
3.38	Experiment 8. Single-scattering contribution 'KBst_BLB....................89
3.39	Experiment 8. Bulk-modulus perturbation estimates. From top to Bottom: $KlB,BS ’ 'KB'tSB ’ 'KB'tBB and conventional estimate ''EE (backpropagation of
complete residual 8p with only background model)...............................90
3.40	Experiment 8. From top to bottom: Single pair source-receiver contributions to
conventional estimate 'K^, 'K es'Bs, 'KBB^B, and SKB^BB........................92
4.1	Center parts of the baseline (a and b) and monitor (c and d) models for Model Sets
1 (a and c) and 2 (b and d)................................................... 95
4.2	Set 1 - large offset. Estimates for bulk-modulus perturbation in the absence of a strong reflector. (a) Singular part estimate according to equation (4.1); (b) Conventional perturbation estimate using wave propagation in the background model. The last is substantially close to contribution 6KeSstBB (see Figure 4.4c, right). Both figures are normalised to their common maximum for comparison ................................. 97
4.3	Set 1 - large offset. The same estimates seen in Figure 4.2 (8KeSst and ¿K^v)
but now each one is normalised to their own maximum................................ 98
4.4	Set 1 - large offset. Individual contributions to 5KSst are shown in the left column. In the right column we see the results of succesively summing up the contributions. Thus, the last one is the result of summing up all four contributions. 99
4.5	Set 1 - large offset. Top: the norm of the residual (as a measure of the energy)
at the receivers (horizontal axis) as a function of shots (vertical axis). Bottom: Result of stacking (integrating) the above function over sources. The energy of the residuals concentrate between 500 to 1000 m and 2000 to 2500 m.....................101
4.6	Set 2 - large offset. Estimates for bulk-modulus perturbation in the presence of a strong reflector. (a) Singular part estimate according to equation (4.1);
(b) Conventional perturbation estimate using wave propagation in the background model. The last is substantially close to contribution 6KSsBB (see Figure 4.7c, right); (c) Same as before, but with dashed ray paths indicating the back-illumination from the strong reflector..........................................................102
4.7	Set 1 - large offset. Individual contributions to 5KSst are shown in the left column. In the right column the result of summing up the current contribution with all the previous ones. which makes, for instance, the first estimate in the left to be no more than 6KSstBS; on its turn, the last one is the result of summing up all
four contributions.................................................................103
4.8	Set 2 - large offset. Top: the norm of the residual (as a measure of the energy)
at the receivers (horizontal axis) as a function of shots (vertical axis). Bottom: Result of stacking (integrating) the above function over sources...................104
4.9	Set 1 - narrow offset. Narrow-offset estimates of the perturbation in the ab-
sence of a strong reflector. (a) Singular estimate with all contributions; (b) conventional estimate....................................................................105
4.10	Set 1 - narrow offset. From top to bottom, left column: contributions to singular perturbation estimate 8KeSstBS, SKSBB ,	and 8KSSSB. Right column:
Cumulative summation of individual contributions..................................106
4.11	Set 1 - narrow offset. Summation of the multiple-scattering contributions
6K$SS and 6KS£sb..................................................................107
4.12	Set 2 - narrow offset. Narrow-offset estimates of the perturbation in the pres-
ence of a strong reflector. (a) Singular estimate with all contributions; (b) conventional estimate................................................................108
4.13	Set 2 - narrow offset. Summation of the multiple-scattering contributions
Kps and KSB....................................................................109
4.14	Set 2 - narrow offset. From top to bottom, right column: contributions to
singular perturbation estimate SKSBs, SkS,Bb , SKSSs and SKSSSB. Left column: Cumulative summation of individual contributions...............................110
List of Tables
3.1	Unperturbed model gallery. n# stands for the number of samples in the #-axis. d#
is the sampling interval in the #-axis; x- and z-axis are given in meters; t-axis is given in milliseconds. the origin for all axis was always o# = 0...............49
3.2	Experiment gallery............................................................ 51
3.3	Experiment 3: L2-norm as a measure of energy of all observed terms at cr154. The
terms are sorted in descending order of energy. The terms related to single scattering effects are the strongest, followed by the ones related to multiple-scattering. The braces with attached values show the energy of the corresponding summed traces, indicating destructive interference of the individual contributions (see also Figures 3.16)................................................................. 67
3.4	Experiment 6: L2-norm as a measure of energy at cr154 and cr283. The braces in-
dicate summation of the related traces, the value attached to them being the energy
of the resulting trace........................................................ 78
List of Symbols, Variables and their definitions
Here, all the variable dependencies are shown. Throughtout the text some dependencies of the variables may be (partially) ommited. The terms in parenthesis are usually ommited for sake of simplicity.
Basic Variables
x	Spatial position
xs	Point-source position
xg t	Point-receiver position Time
ix S (t)	Angular frenquency Source wavelet
Wavefields p(x, t; x') po(x,t; x') Ps(x,t; x') Pb(x,t; x') Ps(x,t; x') 6rp(x, t; x') 6rpB(x, t; x') 5ps(x,t; x') 6ps,i(x,t; x') G0(x, t; x')	Total pressure wavefield Reference wavefield Scattered wavefield Background (part of the reference) wavefield Singular (part of the reference) wavefield Total-wavefield perturbation/residual Background-wavefield perturbation/residual Singular-wavefield perturbation/residual Singular-wavefield residual term/component/contribution Reference (medium) Green’s function
Gb(x,t; x')
Gs(x,t; x')
Background (medium) Green’s function
Singular (part of the reference medium) Green’s function
Wavefield superscripts Used in any wavefield residual.
K
P
Residual is caused by bulk modulus perturbation
Residual is caused by density perturbation
Model parameters
m(x) mo(x) ¿m(x) K (x) Ko(x) Kb (x) Ks (x) Ki(x) P(x) Po(x) PB (x) PS (x) Pi(x) 5K (x) 5Kb (x) 8Ks (x) 5KB,b (x)	Model parameter vector Reference model parameter vector Reference model perturbation vector Bulk modulus Reference bulk modulus Background (part of the reference) bulk modulus Singular (part of the reference) bulk modulus i-th part of bulk modulus Density Reference density Background (part of the reference) density Singular (part of the reference) density i-th part of density Reference bulk modulus perturbation Background bulk modulus perturbation Singular bulk modulus perturbation Background bulk modulus perturbation estimate from background wavefield residual backprojection
5KB ts (x)	Background bulk modulus perturbation estimate from singular wavefield residual backprojection
5KSS (x)	Singular bulk modulus perturbation estimate from singular wavefield residual backprojection
LIST OF SYMBOLS AND VARIABLES
K' (x)	i-th background bulk modulus perturbation estimate contribution from singular wavefield residual backprojection with i-th component of the first derivatives of singular wavefield w.r.t. background/singular bulk modulus
skbWx)	i-th background bulk modulus perturbation estimate contribution from background wavefield residual backprojection with i-th component of the first derivatives of singular wavefield w.r.t. background/singular bulk modulus
SKSsi(x)	i-th singular bulk modulus perturbation estimate contribution from singular wavefield residual backprojection with i-th component of the first derivatives of singular wavefield w.r.t. background/singular bulk modulus
Sp(x) SpB(x) Sps (x)	Reference density perturbation Background bulk modulus perturbation Singular bulk modulus perturbation
Model parameter superscripts
Used in any model parameter perturbation.
est	The perturbation is an estimate from wavefield backprojection
Operators
They can be applied onto any wavefield. Their space-dependency is inherited from the model parameters they are function of.
(Acoustic) wave operator
Reference (acoustic) wave operator Background (acoustic) wave operator j-th level (acoustic) wave operator (Acoustic) scattering potential
Reference (acoustic) scattering potential j-th level (acoustic) scattering potential (Acoustic) secondary potential
Background (acoustic) secondary potential Background part of (acoustic) secondary potential Singular part of (acoustic) secondary potential
L(K,p)[ • ]
Lo(Ko, Po)[ • ]
L (kb ,Pb )[ •]
Lj (Ki=0,...j, pi=O,...,j) [ • ]
Frechet derivatives and its components
xs, xg)
U (xi,t; xs, Xg)
V	(Xi,t; xs, Xg)
UB (xi,t; xs, xg)
V	b (xi,t; xs, xg)
__b
U s (xi ,t; xs, xg)
__s
Us(xi,t; xs, xg)
__b
Vs (xi,t; xs, xg)
__s
Vs(xi,t; xs, xg)
First derivatives of wavefield w.r.t. full model parameters
First derivatives of wavefield w.r.t. full bulk modulus
First derivatives of wavefield w.r.t. full density
First derivatives of background wavefield w.r.t. background bulk modulus
First derivatives of background wavefield w.r.t. background density
First derivatives of singular wavefield w.r.t. background bulk modulus
First derivatives of singular wavefield w.r.t. singular bulk modulus
First derivatives of singular wavefield w.r.t. background density
First derivatives of singular wavefield w.r.t. singular density
Us,i(xi, t; xs, xg) i-th component of the first derivatives of singular wavefield
w.r.t. background/singular bulk modulus
Vsi(xi, t; xs, xg) i-th component of the first derivatives of singular wavefield
w.r.t. background/singular density
1.	Introduction
For many years, the most common imaging techniques were based on ray theory, such as Kirchhoff migration. Lately, as the industry has been facing geologically more complex areas, migration methods based on wavefield extrapolation have been usually applied. This is because in such areas the ray theory is not capable of describing the complexity of wavefield propagation. The development started with one-way wave-equation migration and culminated more recently with two-way wave-equation techniques. All this became possible because of new acquisition techniques which give better illumination of the subsurface, and more powerful computational resources.
Those new imaging methods require more and more refined earth models. Even though migration has advanced quickly with the raise of available computer power, constructing these models is still mostly ray- and traveltime-based. However, in recent years, one model-building tool, based on the two-way wave- equation, has been extensively studied and developed for Earth modelling: full waveform inversion (FWI).
The basic idea behind FWI is optimisation: minimisation of an objective function1 that measures, somehow, the difference between the observed seismic data and synthetic data, numerically modelled using an estimated earth model. In the last decades, many studies on FWI were carried out. Something that was impractical for industrial applications some years ago is now becoming a established element of the seismic processing flow in the exploration and monitoring stages of the oil and gas production. For an overview and the state of the art, the reader is referred to the works of Virieux and Operto (2009), Plessix (2012) and Asnaashari et al. (2013).
A series of papers published in the eighties (Lailly, 1983; Tarantola, 1984a, 1986) introduced the gradient-based FWI method in applied geophysics. In essence, these methods rely on the fact that a model can be updated iteratively with the help of so-called sensitivity kernels (Tromp et al., 2005). The sensitivity kernels are the volumetric density of misfit function derivatives with
1Also known as misfit or objective functional.
respect to the model parameters. These sensitivity kernels are related to the Frechet derivatives of the seismogram with respect to the model parameters. Under the framework of the adjoint statemethod (Tromp et al., 2005; Plessix, 2006; Fichtner and Trampert, 2011), the construction of these sensitivity kernels involves the interaction between the forward wavefield from the survey sources with the backward-modelled adjoint residuals.
Before outlining the decomposition proposed here and the reasons behind it we make a brief overview on the main topics on FWI related to the subjects discussed in the coming chapters.
1.1	FWI overview
Two general approaches can be used when dealing with nonlinear inversion methods: global optimisation or local iterative descent methods.
Global optimisation techniques, such as Monte Carlo, although able to avoid local-minima, have limited application in solving seismic inversion problems due to the huge amount of parameters to be determined (Gauthier et al., 1986). As a matter of fact, even with the great improvement on the computational capabilities of the Oil and Gas Industry in the last thirty years, we are far from seeing this methods applied successfully.
Lailly (1983) and Tarantola (1984a) presented a nonlinear gradient- based local optimisation which is considered the cornerstone of the least- squares based inversion in the geophysics community. Besides the techniques itself, these works are important because they showed the relation of gradient- based methods with the well known two-way wave equation reverse-time migration (RTM). The main goal of nonlinear inversion is to deal with not only primary reflections but with the full information content in the seismogram such as diving waves, supercritical reflections, refractions and multiple-scattered waves.
While in principle capable of handling all aspects of wave propagation that influence the data, including full nonlinearity, in practice nonlinear gradient-based FWI is limited by its notorious sensitivity to the choice of the starting model. This is so because for short-offset acquisition of reflection data, the seismic wavefield is rather insensitive to high/intermediate wavelengths (Gauthier et al., 1986; Mora, 1987) which prevents the gradient-based local optimisation from circumventing the existence of innumerous local minima in the usual highly non-convex objective function. Thus, the initial model, usually assumed to be smooth, must, at least, kinematically explain the obeserved data.
1.1.1	Forward Modelling
Modelling plays a key role in FWI. The main steps of gradient-based inversion rely critically in the ability of the modelling scheme to predict all non-linear events taking place in a geologically complex area. Two opposing forces come into play when choice must be made: accuracy and computational cost.
Three main questions must be answered before choosing the modeller: which physics theory behind wave equation will be used to approximate the real wave propagation phenomena in the subsurface, which numerical discretisation method better fits the problem, and in which domain we will implement the method. All three aspects are interconnected.
As FwI intent to use the full seismic information recorded, the physical theory describing the modelled wavefield is very important. If, for instance, one chooses acoustic wave equation to describe the wavefield propagation, information about the subsurface carried by shear and converted waves would not be put to use, not helping or even leading the inversion process to a wrong solution. On the other hand, the higher the complexity of the physical theory describing the wavefield propagation (no doubt the visco-elastic model would do a better job than the acoustic approximation), the higher the number of variables. In Section 1.1.5, we comment on the challenges that multiparameter inversion brings up. Nowadays, 2D elastic and 3D acoustic inversion are the most common approach.
Among the main discretisation methods, finite-difference is, no doubt, the most popular one although other more sophisticated methods such as finite-element or finite-volume may be used. Marfurt (1984) quantitatively compares finite- difference and finite-element solutions of the scalar and elastic hyperbolic wave equations for the most popular implicit and explicit finite-difference and finite-element methods. Infrastructural criteria (such as computational cost, accuracy, available machine and memory, flexibility) and model-related criteria (Poisson’s ratio, medium and/or mesh inhomogeneity, structural complex boundary conditions) must be taken into account when choosing the discretisation to be used.
Time domain versus frequency domain
Along with the choice of discretisation method, we also must define its domain. Although time-domain and frequency-domain methods are analytically equivalent - to some extent the nonspecialist (or end user) need not be concerned in which domain the results are obtained (Pratt, 1999) - this choice depends on the size of the problem and on the available computational power.
Both early theoretical developments and practical applications were done in time domain (Taran-tola, 1984a; Gauthier et al., 1986; Mora, 1987). Pratt and Worthington (1990) first brought the development of inversion in the frequency domain, and Pratt et al. (1996) showed one of the first real data application of this approach.
The frequency-domain implementation has shown important advantages over time-domain approach:
•	It introduces a natural multiscale approach by progressing from the lowest frequencies to the higher ones which helps to mitigate the notorious non-linearity of the inverse problem (Pratt et al., 1996; Bunks et al., 1995; Virieux and Operto, 2009).
•	It allows to decimate the data by performing the inversion with a limited number of frequency components of wide-aperture/wide-azimuth surveys which helps to manage and process smaller volumes of data with large number of sources (Pratt et al., 1996; Sirgue and Pratt, 2004)
Beside these advantages which are independent of the discretisation method used, we can identify other advantages when finite-difference methods are applied in the frequency domain. According to Plessix (2007), in 2D problems the linear system resulting from the frequency-domain scheme can be solved with a direct solver, and the frequency-domain multishot migration algorithm is about one order of magnitude faster than its time-domain counterpart, because the LU decomposition of the matrix of the system has to be performed only once per frequency.
On the other hand, with realistic 3D problems, the linear system from a frequency-domain implementation may be difficult to solve with a direct solver, because of the high memory requirements. Plessix (2007) discuss many possible alternative approaches to solve large 3D problems in the frequency domain and evaluate the result given by Helmholtz preconditioned iterative solver.
As a matter of fact, the 3D problems brought the time-domain implementations back into use. The time-domain method is expensive: the forward and time- reversed wavefield propagation may have high computational cost depending on the time interval needed to avoid dispersion and aliasing. However, as pointed out by Vigh et al. (2009), the fact that cluster computers are getting more and more efficient for most processing steps, including time-domain RTM, indicates that it is feaseble to perform time-domain waveform inversion of large 3D data sets on current hardware.
Preconditioning is another issue that influences the choice of the inversion domain. According to the domain, specific methodologies can be applied to precondition either the data residuals or the
gradient, so that they improve the convergence and/or the linearity of the inverse problem (Shipp and Singh, 2002).
The main advantages frequency-domain implementations naturally introduce (multiscale approach and frequency decimation) can be achieved by time-domain approaches, if one, for instance, extracts the monochromatic solution by discrete Fourier transform over the time steps (Sirgue et al., 2008). This permits the data to be decimated by choosing an arbitrary number of frequencies, allowing the multiscale approach to be applied.
1.1.2	Multiscale approach
It is well known that the main theoretical difficulty for nonlinear seismic inversion is the presence of numerous local minima in the objective function (Gauthier et al., 1986; Mora, 1987; Bunks et al., 1995; Pratt et al., 1996; Clement et al., 2001; Virieux and Operto, 2009; Asnaashari et al., 2013). These local minima prevent iterative techniques from finding the global minimum unless the initial model for the inverted parameter is already near enough from the global solution.
Among the various approaches developed to circumvent this problem, the proposal by Bunks et al. (1995) of decomposing the seismic inversion problem by scale proved itself very effective. It is based on the observation that the complexity of the objective function is directly related to the dominant length scale of the subsurface model. In other words, at smooth models where long wavelengths are dominant there are fewer local minima and those that remain are further apart from each other. Rough models with dominant short wavelengths generate rough objective functions with numerous local minima (see Figure 1.1). Using iterative inversion methods, one must start inverting with the long-period data used to constrain the long wavelength component of the model. The final model of this first step is used as initial model for the next round of iterations performed with higher frequency data, so that shorter wavelength structures are included in the model updates. This process may go on until the data with the highest frequency have been used in the inversion process.
Note that performing waveform inversion in a multiscale manner, lower frequencies can provide several scalable options, such as changing the shots in conjunction with incrementing the bin sizes in all directions (Vigh et al., 2009). Beside this, the forward modelling can benefit with the change of scale which also helps in decreasing the computational cost in the first stages of the inversion process.
There is one important thing to note: the success of the multi-scale approach is empirical,
Figure 1.1: [Extracted fromBunks et al. (1995)] Heuristic illustration of the multigrid method applied to a nonlinear problem. Frame (a) illustrates a 1-D objective function and frames (b)-(e) illustrate the same objective function at ever increasing scale lengths. A gradient method applied to the shortest scale succeeds in finding the local minimum closest to the starting point, whereas the gradient method applied to the longest scale finds the global minimum (at that scale) regardless of the starting point. A fining up procedure helps find the estimate of the position of the global minimum for the fine scale problem.
meaning that there is no guarantee that it works under different circumstances. in other words, there is no theoretical proof that the transitions from one scale length to the other have the property that the global solution at one scale is in the convex neighbourhood of the global minimum at the next scale (Bunks et al., 1995; Fichtner, 2010).
1.1.3	Optimisation methods
As pointed out before, due to the huge size of the seismic inversion problems, the nonlinear minimisation of the objective function must rely on gradient- based iterative methods also known as descent methods. We do not intent to make a detailed review of all the known descent methods but to give a brief overview of some of them. For further, deeper references the reader is referred to Fichtner (2010) and Luemberger and Ye (2010).
General descent method
For this brief overview we are going to use the notation found in Fichtner (2010). Let us consider a model m and as objective function x(m) that must be minimised. The idea behind iterative optimisation method is, starting from the best known initial model m0, to successively update the current model m. to a new model mi+1 such that
m»+i = mi + Yihi with x(m+i) &amp;lt;x(mi),	(1.1)
where the particular choice of the descent direction, hi, and the step length, Yi &gt; 0 depends on the minimisation scheme and are not arbitrary. The condition x(mi+1) &amp;lt;x(mi) in necessary but not sufficient to garantee convergence. In this matter the choice of the step length iss crutial.
in the general case, the descent direction hi is given by
hi = —A -Vmx(mi),	(1.2)
where A is a positive definite matrix whose choice depends on the descent method. Therefore, the key point of any descent method is the evaluation of the gradient Vmx(m). The most efficient way of doing it is using the Adjoint-state method (see Section 1.1.4).
Figure 1.2: Line search with three trial step lengths and a second-order polynomial interpolation. The parabola vertex defines the efficient step length.
Step length and line search
Besides the gradient evaluation, finding an optimal/efficient step length is also very important. It is this choice that ensures the convergence process and the correctness regarding unit dimensionality.
The optimal value for Yi in a convex minimisation problem is given by
Yi =
hi •
hi •	• hi
(1.3)
where Hx(mi) is the Hessian of the objective function x.
An alternative way to evaluate the step length is usually used to avoid the expensive task of evaluating the Hessian: the line search. The idea behind this procedure is simple (see Figure 1.2): once given the current model mi and the descent direction h at the i-th iteration, we must evaluate the objective function x(mi + Yikh) for some trial step lengths, Y^ (k = 1 ,...,n), and use this points to interpolate a polynomial of degree n — 1 as an approximation of x(mi + Yh). The minimum of this polynomial defines the efficient step length Yf.
Some well-established descent methods
As said before, the main difference between descent methods is how the descent direction hi is defined/evaluated.
Steepest descent. In the steepest descent method we define h = —Vmx(mi), i.e, the steepest descent direction is in the opposite direction of the gradient of the objective function. Or, put in another way, one must define the matrix A as the identity. The step length is defined through a line search.
Newton's method. In this method, both first- and second-derivative information are used to define the descent direction what significantly improving the convergence speed given that the initial model is near enough of the (supposedly) global minimum. The descent direction is determined by the solution of the linear system
Hx(mi) • hi = —Vmx(mi),	(1.4)
where the Hessian Hx(mi) brings the objective function second- derivative information. Note that this is equivalent to choosing the matrix A from eq. (1.2) as
A = H. m).	(1.5)
The model update is, then, given by mi+1 = mi + hi (y = 1).
Regularised Newton's method. Usually, the Hessian is nearly singular what requires some kind of regularisation for its inversion. Hence, the model update in regularised Newton's method is done by:
mi+i = mi — [Hx(mi) + @I ]-1 • Vmx(mi),	(1.6)
where the parameter 0 can be found through a line search. Note that for big values of 0 this methods tends to behave as the steepest descent, while, for small values of 0 the Hessian tends to be dominant which makes the method closer to Newton's.
Gauss-Newton method. Variations on the Newton's method are commonly used to avoid the expensive cost of evaluating the full Hessian when dealing with non-linear least-square problems.
One of these is the Gauss-Newton method which uses the approximate Hessian. For instance, as seen in Fichtner and Trampert (2011), for the least-square objective function
X(d(m)) = |(d(m) - do)T(d(m) - do),	(1.7)
with synthetic data d and observed data d0, the Hessian matrix is given by
Hx = Gt • G + (d(m) - do)T • VmG,	(1.8)
here G = Vmd is the jacobian matrix of d. In the Gauss-Newton method we use the inverse of the approximate Hessian //, = Gt • G to update the model in this method:
m+i = mi - H-1 •Vmx(mi),	(1.9)
Pratt et al. (1998) presents a very instructive comparison between three gradient- based optimisations techniques presented here: steepest descent, Gauss-Newton and Newton’s methods. He developed the formulation of these methods in the discretised frequency-space domain using a finite-difference approach.
Gauss-Newton method variations: Levenberg and Levenberg-Marquardt methods. We can use regularised variations of the Gauss-Newton method. The Levenberg method uses the identity matrix for regularisation:
mi+i = mi -
Hx(mi)+ ¡31
-i
^mX(mi).
(1.10)
In the Levenberg-Marquardt method the identity matrix is replaced by the diagonal of the approximate Hessian:
mi+i = mi
(mi) + ft diagHx(mi)
-i
^mX(mi).
(1.11)
Conjugate-gradient methods. The steepest descent method may suffer from slow convergence. The successive descent directions may not be linear independent (or even parallel indeed) causing the minimisation path to “zig-zag”, increasing the number of iterations in the minimisation process to reach a point close enough to the minimum (see Figure 1.3). On the other hand, Newton’s
Figure 1.3: Convergence in the steepest descent method for a quadratic objective function.
method can accelerate the convergence if the initial model is close enough to the minimal solution but at the high expense of evaluating and storing the Hessian.
The conjugate-gradient (C-G) methods can be considered as being somewhat intermediate between the steepest descent method and the Newton’s method. The C-G method was originally designed and analysed for the quadratic problem where the Hessian is a constant positive definite matrix, but extensions and approximations have been made to deal with more general nonlinear problems (Hestenes and Stielfel, 1952; Fletcher and Reeves, 1964; Polak and Ribiere, 1969).
The idea behind this method is to build descent directions that satisfy the orthogonality conditions below:
hi	) = 0,	(1.12)
hi • Hx • hj = 0,	(1.13)
for any 0 &amp;lt;i &amp;lt;j &amp;lt;n, where n is the dimension of the model space. Eq. (1.12) states that the gradient of the objective function at the current model has to be orthogonal to all previous descent directions. Eq. (1.13) states that the current descent direction must be Hx-orthogonal to all the previous descent directions. In other words, the directions h. and hj are conjugate with respect to Hx. These relations guarantee that, in a pure quadratic problem, the solution would be found in, at most, n iterations.
The C-G method is based on the update of the model according to eq. (1.1)
mi+i = mi + Yihi,	(1.14)
where the first descent direction is given by the steepest one, h0 = -Vmx(m0). The step length at each iteration is given by eq. (1.3) in the case of quadratic problem where the Hessian is known.
The key element, though, is how the next descent direction is evaluated. The next direction hi+1 depends on the current direction hi and is given by
hi+1 — V'mx(^mi+1) + fiihi,
(1.15)
where the parameter pi is given by
l|VmX(mi+1)ll2
l|Vmx(mi)ll2
Pi =
(1.16)
In the more general case of a nonlinear objective function, the orthogonality relations stated in eqs. (1.12) and (1.13) do not hold and convergence may be achieved in more than n iterations. The process above can be applied in the general case with a line search to evaluate the step length yi since the Hessian is not easily available. In this case, it is commonly referred as the Fletcher-Reeves method (Fletcher and Reeves, 1964). One well-known variation of the method is the Polak-Ribiere method (Polak and Ribiere, 1969) where Pi is defined as
Pi =
Vmx(mi+i) • [VmX(mi+i) - Vmx(mi)]
(1.17)
Vmx(mi) • Vmx(mi)
Another one is the Hestenes-Stiefel method (Hestenes and Stielfel, 1952) where Pi is given by
Pi =
VmX(m-i+i) • [VmX(mi+i) - Vmx(mi)] hi • [Vmx(mi+i) - Vmx(mi)]
(1.18)
1.1.4	Adjoint-state methods
As seen above, all the descent optimisations techniques require the computation of the gradient of the objective function with respect to the model parameters in order to define the descent direction at each iteration.
Usually, the objective function depends on the model parameters via the state variables (in case of wave propagation, the wavefield u), i.e, x(m) = x(u(m)). It means that, due to the chain rule, the gradient of the objective function depends on the gradient of the wavefield with respect to the model parameter, Vmu. The latter gradient is known as the Frechet derivatives, Jacobian or
Sensitivity matrix. The computation of this gradient may be very expensive.
The adjoint-state method is a mathematical tool that allows us to compute the gradient of an objective functional with respect to the model parameters very efficiently without the need of explicitly building the sensitivity matrix (Virieux and Operto, 2009; Fichtner, 2010). Its formulation can be developed with the help of the perturbation theory (Fichtner and Trampert, 2011) or with the Lagrange multiplier method for constrained optimisation (Bunks et al., 1995). Plessix (2006) presents a very good review of the adjoint state method and the development of its formulations.
It is not the scope of this introduction to develop the formalism of the adjoint state method. But to clarify the relation of this method with the our proposed decomposition we summarise one example of the application of time domain adjoint-state method for a constant-density acoustic problem found in Plessix (2006). In this case the wave operator is L = \ — V2. With initial boundary conditions, the pressure wavefield p due to the source f satisfies:
p(x, 0)	=	0,	(1.19)
=	0,	(1.20)
c[p(x,t')]	=	f (x,t).	(1.21)
The objective function is defined
1	rT
x	{Ss,rp(x,t) — p^(x,t))2 dt,	(1.22)
2	s,r
where T is the observed time, and Ss,r is the restriction operator onto the reciver position. The model parameter is the squared slowness, m =	.
The adjoint-state system reads
q(x, 0) = 0,	(1.23)
x	= °-	(1.24)
L[q(x,t)] =	SSr (Ss,rp(x,T — t) — p^(x,T — t)) .	(1.25)
r
q satisfies the same wave equation that p, but with a different source term. In this case L is self-
adjoint. Ssrp(x,T — t) — pSbrs(x, T — t) is the residual in reverse time. The gradient of x reads:
q(x,T — t)d p(X'/! dt.
(1.26)
Generally speaking, the evaluation of the objective function gradient for waveform inversion with the aid of the adjoint state method may be summarised in three steps (Tromp et al., 2005):
•	Modelling the direct (regular) wavefield from the source with the current model.
•	Time-reversed modelling (backpropagation) of the residual between observed and modelled wavefield with the current model. The resulting wavefield is known as adjoint wavefield.
•	Cross-correlate the appropriate temporal/spatial derivatives of the regular and adjoint wave-
fields.
Note that this procedure is very similar to that of RTM. The main difference is that the recorded wavefield is backpropagated in RTM instead of the wavefield residuals. Lailly (1983) was the first one to draw this connection between wave-equation migration and waveform inversion.
1.1.5	Challenges
Great theoretical and practical improvements have been achieved, since the first papers on FWI in the 80's. But many challenges still remain. If we could summarise all the challenges in just one sentence it would be: "Perform a 3D elastic FWI in realistic data set from a not so accurate initial model with reasonable time and computational cost."
3D
The main limitation regarding the 3D FWI is the the computational cost in processing and/or memory requirements of the forward modelling.
Some successful studies with 3D cases were made both with time-domain finite- difference methods (Sirgue et al., 2008) or frequency-domain finite-difference direct solvers (Ben-Hadj-Ali et al., 2008) for synthetic data. Differently from the 2D case where frequency-domain solvers proved to be the best option due to the smaller processing requirements, the extensive memory ne of eds of the frequency-domain finite-difference modellers push towards the time-domain approach
for 3D problems (Sirgue et al., 2008). Efforts to circumvent the high memory costs are being made with the use of frequency-domain iterative solvers (Plessix, 2007, 2009).
Nevertheless, nowadays most of the 3D FWI implementations in industry are done in the timedomain, at least when it comes to modelling, seizing all the expertise and infrastructure (software and hardware) already avilable for RTM.
Monoparameter versus multiparameter FWI
Due to the current computational limitations, only monoparameter acoustic FWI is feasible when dealing with real-sized 3D problems (Plessix, 2012).
Such underlying physical assumption definitely restrain all the potential high resolution that FWI can offer. According to Barnes and Charara (2009), acoustic full-waveform inversion is applicable only when the S-wave velocity and the density fields are smooth enough to reduce the amplitude-versus-offset (AVO) effect, or when the near-offset seismograms are inverted with a good starting model. This exclude the most realistic cases, specially marine reflection surveys where wide-aperture seismic data is a common place and significant AVO and azimuthal anisotropic effects should be observed in the data (Virieux and Operto, 2009). As mentioned before, the seismic modelling used in the FWI algorithm should, in principle, honour all the physics of wave propagation because.
When dealing with more than one parameter class, the ill-posedness of the inversion problem increases either because more degrees of freedom come into play, or because the sensitivity of the inversion with respect to each parameter may vary, or still because these parameters can be more or less coupled (Virieux and Operto, 2009). Studying the radiation pattern of each parameter class as a function of the aperture angle (Wu and Aki, 1985; Tarantola, 1986) can help understanding the parameters coupling in order to devise the best set of parameter class to be used in the inversion. This will also help to design hierarchical strategies to reduce the ill-posedness of FWI.
Nevertheless, multiparameter FWI with extensions to elasticity, attenuation and anisotropy remains challenging (Plessix, 2012; Virieux et al., 2009). Most of the successful examples of elastic FWI found in the literature are 2D cases (see, e.g., Crase et al., 1990; Shipp and Singh, 2002; Sears et al., 2008; Brossier and Operto, 2009). Either in acoustic or elastic assumption, density proved itself a parameter difficult to reconstruct. Some works involving density inversion are found in literature (Choi et al., 2008; Bae et al., 2012; Jeong et al., 2012). Reconstruction of anisotropic parameters by FWI is probably one of the most undeveloped and challenging fields of investigation
(Virieux and Operto, 2009). Some studies on this subjects were published very recently (Warner et al., 2013; Kamath and Tsvankin, 2013).
New objective functions
Classically, the objective function in FwI is based on the least-squared norm. This norm assumes that the noise distribution is Gaussian (Tarantola, 1987) which may not always be true. Crase et al. (1990) was the first one to drive a study on using more robust minimisation criteria in the inversion process to handle many types of noise. After that many others tried to use alternative minimisation criteria such as the Huber norm (Guitton and Symes, 2003; Ha et al., 2009) and Logarithmic objective functions (Shin and Min, 2006; Shin et al., 2007; Bednar et al., 2007; Pyun et al., 2007).
Initial model construction
The ultimate goal of FwI would be to obtain a high definition final model from a poorly detailed initial model. Unfortunately, even with all the development in acquisition technology which provide denser data, especially at low frequencies, we are far from that. In this way, an approach that simultaneously inverts for the transmission, reflection and refraction data in complex terrains without a good initial model is still under research (Plessix, 2012).
It implies that before performing the full waveform inversion itself, we must build a initial model as accurate as possible. Nowadays, the most usual approaches to build a starting model are reflection tomography (Woodward et al., 2008), migration-based velocity analysis (Sava and Biondi, 2004; Symes, 2008), first-arrival traveltime tomography (Hole, 1992), stereotomography (Lambare, 2008), and Laplace- or Laplace-Fourier-domain inversion (Shin and Cha, 2008; Shin and Ha, 2008; Shin and Ho Cha, 2009).
1.2	Kernel decomposition
To help addressing model convergence issues in FWI, we analyse the role of nonlinearity in the sensitivity kernels. We demonstrate that the above-mentioned insensitivity to high/intermediate wavelengths (Gauthier et al., 1986; Mora, 1987) is partly caused by the conventional choice of smooth initial models, considering all singular parts of the model as unknown (see Figure 1.4).
0
E, -C
Q.
CD Q
0
500
1000
1500
2500
2000
-500
0
500	1000
Distance (m)
i3000
|3000
500
1500
E^
1000 Q.
CD
Q
2500
2000
20-0%00	-500	0	500
Distance (m)
1500
1000
1500
Distance (m)
m/s
I
I
E


E
Figure 1.4: Conventionally, the exact model (top) is thought of as being decomposed into a sr background (bottom left), supposedly known, and a singular scattering part (bottom right), determined under the assumption that it is small against the background.
to
To do so, we use a scattering-based approach (Vasconcelos et al., 2009). Assuming an acoustic medium, we reparameterise the subsurface model in terms of background and singular components for both bulk modulus and density. This leads to a decomposition of the data into a background wavefield that is sensitive only to the background model, and a singular wavefield sensitive to both background and singular model components. Both the background and singular parts of the model are then subject to perturbations that cause wavefield residuals (see Figure 1.5). This decomposition is motivated by the fact that conventional initial models, for example obtained from tomographic or migration-velocity-analysis methods, are only imperfect estimates of the true smooth background, but that initial estimates for the singular part are available, for example from migrated images or a priori geologic information. Focusing on the model backprojections from the singular data only, we provide expressions for the Frechet-derivative sensitivity kernels for all four model parameters (perturbations of both smooth and singular parts of compressibility and density).
We demonstrate that the forward decomposition is successful in bringing out subkernels that unravel different levels of non-linearity with respect to data and model. This, in turn, can be translated into different levels of interaction between non-, single-, and multiple-scattered information that otherwise would be hidden in the undecomposed sensitivity kernels. Moreover, we predict that part of the answer to the problem of lacking low-frequency information on the model should lie in utilising scattered wavefields, because these travel through the medium long enough to carry this information (Snieder et al., 2002). Moreover, we show numerical results of using those subkernels to backproject the scattered residual only into model space and obtain model perturbation estimates.
We envision broad potential applications for the scattering-based FWi kernel decomposition we propose in this work. These include devising multiscale FWi algorithms, and improving velocity model building in the image domain using extended image (EI) gathers (Rickett and Sava, 2002; Sava and Fomel, 2003; Symes, 2008; Sava and Vasconcelos, 2009, 2011). As shown by Vasconcelos et al. (2009, 2010), there is a connection between extended image conditions and the interferometry formalism: the Extended images behave like locally scattered wavefields in the image domain.
important to say that we do not present nor perform an inversion in this thesis. in a fully iterative implementation, the gradient of the objective function is evaluated, a descent direction is defined, a step length is computed that minimises the objective function when the parameters are varied along the descent direction and, in this way a new model estimate is generated and used in the next iteration. As done in pratt and Worthington (1990), we restrict the calculations to a single
0
0
500
1500
1000 Q.
CD
Q
2500
2000
-500
0
500
Distance (m)
I
|3000

E
500
1500
E^
1000 Q.
CD
Q
2000
2500
E
-500	0	500
Distance (m)
I
3000
I
1500
1000
E
1500
1000
w
E
Figure 1.5: Here, the exact model (top) is thought of as being decomposed into a slightly wrong estimate of the smooth background (centre left), and a slightly wrong singular scattering part (bottom left), both supposed to be known, plus perturbations to the background (centre right) and the singular part (bottom right), to be determined under the assumption that they are small against their known estimates.
iteration only, evaluating and decomposing the sensitivity kernels which, as mentioned before, has connections with the objective function gradient.
The thesis is organised as follows. In Chapter 2 we present the mathematical development of the forward decomposition and discuss its physical meaning. We also present its adjoint formulation in order to obtain expressions of the decomposed estimates of model perturbations. When discussing the role of the scattering theory in our decomposition we developed a N-fold generalised decomposition of the complete wave operator in N — 1 scattering potentials.
In Chapter 3, we perform numerical experiments to validate both the forward and the backpro-jection decompositions. Using different models and acquisition geometries, we gain further insight in the physical interpretation of the previous chapter which helped gaining insight in the possible application of the proposed decomposition.
In Chapter 4 we present an application of the decomposed subkernels in a time-lapse problem. In this examples we show how the enhanced illumination due to the backscattered waves can help delineating the time-lapse change. Chapter 5 summarises our conclusions and presents our final remarks.
Appendix A brings some mathematical definitions used in this thesis. Appendix ?? presents the derivation of the secondary sources for the singular-wavefield residuals, a key concept to the decompositions of the Frechet derivatives kernels. In Appendix C, we developed the mathematical expressions for components of the bulk modulus and density perturbation estimates. Appendix D shows the result of the superposition of two related single-scattering subkernels and discuss its physical meaning. Finally, in Appendix B, we present the relation of the N-fold generalised decomposition in scattering theory with the one proposed here.
2.	Kernel Decomposition
In this chapter, we present the mathematical derivation and physical interpretation of the proposed decomposition. Rather than a complex mathematical reinterpretation, our proposition requires from the reader an exercise of change of perspective when using the scattering theory in the inversion process. In an effort of making things clearer we avoided to use known terms with meanings different from the established one. Therefore, unusual but meaningful terms are used when referring to concepts and phenomena similar to well established ones (see Page xxix).
This chapter is organised as follows. In Section 2.1, we present the forward decomposition. To do so we first briefly review the conventional formulation of Tarantola (1984a) and relate this to the classical scattering theory (Section 2.1.1). Next, we generalise the conventional model and wavefield decomposition to an N-fold decomposition (Section ??), before entering the topic of our proposed sensitivity-kernel decomposition with two perturbed parts (Section 2.1.2).
Section 2.2 is devoted to the physical interpretation and discussion of the result from the previous section. We discuss the new insights our approach allows (Section 2.2.1), in particular regarding the role of multiple internal reflections/scattering in the decomposition (Section 2.2.2), and we identify the individual contributions of background and singular perturbations to the total singular-wavefield residual (Section 2.2.3).
In Section 2.3, we use the adjoint of the subkernels derived in the previous section to obtain expressions for the model-perturbation estimates.
2.1	Full-waveform inversion and sensitivity kernels
Sensitivity kernels are the core of the iterative gradient-based FWI schemes. They are used to backproject the difference between the observed and modeled data (residuals) into the model space in order to obtain parameter estimates used to iteratively update from a starting model.
2.1.1	Conventional formulation
In the conventional formulation of FWI, the residual is considered as a wavefield scattered by unknown perturbations in the known reference model. If these perturbations are considered small, linearisation is possible. In that case, one can find an expression for the Frechet derivatives of the wavefield with respect to the model parameters which leads to the sensitivity kernel.
Wave equation
The acoustic wave equation describes the propagation of a pressure wavefield throughout a medium characterised by two model parameters, the bulk modulus, and density. For a point source and given the initial conditions, the acoustic wavefield p is uniquely defined by
L [p(x,t; Xs)] = 8(x - xs)S(t) ,	(2.1)
where the right-hand side is the source term, with xs denoting the source position and S(t) describing the source wavelet. On the left-hand side of eq. (2.1), the acoustic wave-equation differential operator L, also simply referred to as the wave operator, is given by
L = KX)	-v'( P(X)v)-	(22)
Here the bulk modulus K and the density p are the model parameters that constitute the model parameter vector m. In most parts of the theoretical description we will use the closed form of eq. (2.1). In this way, the general considerations apply in the same way to any other form of the wave equation. For specific examples and the numerical tests, we will use the explicit form of the acoustic wave equation.
The solution of eq. (2.1) constitutes a non-linear relation with respect to the model parameters that can be represented as
p = f (m),	(2.3)
where f denotes the functional relating the wavefield p and the model vector m. Ideally, f depends on the model parameters only, but in practice, this functional also depends on the method used to solve the forward problem.
Scattering theory: medium and wavefield decomposition
In the classical scattering theory (Rodberg and Thaler, 1967; Newton, 1982; Bleistein et al., 2001; Stolt and Weglein, 2012), the total wavefield p propagating in a medium with bulk modulus K and density p is interpreted as being composed of two components: a reference wavefield, p0, and a scattered wavefield, ps, such that p = p0 + ps. The reference wavefield p0 is generated by the original source S(x — xs)S(t), but propagates in a known (usually assumed smooth) reference medium, described by bulk modulus K0 and density p0. The scattered wavefield ps is generated when the reference wavefield runs into the unknown (scattering) part of the medium, described by Ks and ps, satisfying K = K0 + Ks and p = p0 + ps. In most practical applications, it is assumed that the known part of the medium contains only low-frequency information, i.e., no sharp contrasts, reflectors and/or diffractors. On the other hand, the unknown part contains the complete high-frequency information.
This medium and wavefield decomposition transforms equation (2.1) into the following set of differential equations,
	L0 [p0(x,t; xs)] = L [ps(x,t; xs)] =	S(x — xs)S (t), —V [P0(x,t; xs)],	(2.4) (2.5)
where	1	d2	( 1 A	
	r = 0	K0(x) dt2	V (p0(x) J	(2.6)
is the wave operator in the reference medium, and where the difference between the wave operators in the total and reference models,
V = L — L0 ,	(2.7)
is known as the scattering potential. For brevity, we will refer to L and L0 as the total and reference wave operators, respectively. Note that the source term in eq. (2.4) is the original one of eq. (2.1), while the one in eq. (2.5) describes secondary sources excited by the reference wavefield p0. These secondary sources are non-zero only at points where Ks = 0 and/or ps = 0.
Alternatively, eq. (2.5) can be expressed as
L0 [ps(x,t; Xs)] = —V [P0(x,t; xs) + pa(x,t; xs)],	(2.8)
with the physical interpretation that the illuminated contrasts that act as the scattered-wavefield
sources are illuminated by the total wavefield to generate a scattered wavefield propagating in the reference medium.
Eq. (2.8) is nothing more than a wave-equation describing the propagation of the scattered wavefield. The secondary sources can be forward propagated with the help of the Green’s function of eq. (2.4), Go(x,t; xs). In other words, with the knowledge of this Green’s function in the reference medium, the scattered wavefield is described by
ps(x,t; xs ) = -	d'x' Go(x,t; x') *V [po(x',t; xs) + ps(x' ,t; xs)].	(2.9)
Jv
Here, the symbol * denotes time-convolution, and V is a volume that contains all scatterers. Eq. (2.9) is an exact integral equation for the scattered wavefield ps. The assumption ps p0 at all points x' within volume V leads to the Born approximation, which replaces the total wavefield in the integrand by the reference wavefield to approximate ps(x, t; xs) by its single-scattering contributions.
As mentioned above, in most practical applications the reference model is taken to be a smooth background model. In that case, all high-frequency contributions to the model make part of the scattering potential. Note, however, that other interpretations of p0 and ps are also possible without changing the theory above. By no means we are constrained to considering the reference and scattering potential as the low and high spatial frequency components of the subsurface model. Actually, this decomposition can be completely arbitrary: once the reference model is defined, the scattering potential is set by its definition - eq. (2.7) - and the wavefields are determined by eqs. (2.4) and (2.5). In the same way, there are no restrictions regarding the order of magnitude of the scattering potential with respect to the reference model and, therefore, of the scattering wavefield with respect to the reference wavefield. Obviously, this is not true when approximations are done (see Section 2.1.2).
Linearisation and sensitivity kernel representation
The most common way to make practical use of the classical medium and wavefield decomposition described in Section 2.1.1 is to assume that the scattering parts of the medium can be considered small perturbations to the known reference model. Then, ps p0 and the problem can be linearised (Tarantola, 1984a; Bleistein et al., 2001). To describe this in terms of eq. (2.3), let us denote these small perturbations in the model parameters by 5m, i.e., m = m0 + 5m. Then, we
can write according to eq. (2.3)
P = Po + Ps = f(mo + 6m) = f(mo) + $6m + O(||6m2||) ,	(2.10)
where $ are the first derivatives of the wavefield with respect to the model parameters, also known as Frechet derivatives. If only first-order terms in the model perturbations are taken into account, the scattered wavefield is approximately equal to the linearised wavefield perturbation, i.e.,
ps &amp;amp; 6p = $ 6m.
(2.11)
The expression for $ is obtained with the help of secondary or adjoint sources. These can be understood as pseudo-sources that give rise to the wavefield residual, seen as a wavefield itself. The secondary sources are, of course, functions of the perturbations in the model parameters. Their expressions are obtained when small model parameter perturbations Ks « 6K and ps « 6p are introduced in the wave operator L of eq. (2.2). As shown by Tarantola (1984a), introducing these perturbations and retaining only first-order contributions yields
Lo [6p(x, t; Xs)] = — 6L [po(x, t; xs)],
(2.12)
where the secondary potential, 6L, is defined for the acoustic wave equation as
6=
6K(x) d2
K02(x) dt2
6P(x)X7'\
p0(x)	J
(2.13)
- V •
Eq. (2.12) is nothing else but the linearised version of eqs. (2.5) or (2.8), i.e., 6L of eq. (2.13) is the linearised version of operator V in eq. (2.7). Thus, in full analogy to eq. (2.9), the linearised wavefield perturbation can be represented using the Green’s function of eq. (2.4) as
6p(xg ,t; xs) = —	d3x' Go(xg ,t; x') * 6L [po(x',t; xs)],	(2.14)
Jv
In other words, this equation represents the Born approximation mentioned above.
The discretised version of eq. (2.14) can be written in the frequency domain as
6p = $ 6m =
6K
6p
= U6K + V 6p = 6pK + 6pp .
(2.15)
U V
) G0(xl,t; xg) *
5pK(xg,t; xs) =	d3x'
Jv
(x1 ,t; xs) 6K(x'),
(2.16)
This equation defines the Frechet derivatives of the total wavefield with respect to bulk modulus and density, U and V, respectively. Superscripts K and p denote the bulk-modulus and density contributions. Moreover, a hat indicates that the variable is in the frequency domain and the overline characterises a discretised scalar quantity (see Appendix A for further details).
The components of eq. (2.14) express the wavefield perturbation at a receiver at xg due to bulkmodulus and density perturbations. For example, in the time domain the bulk-modulus contribution reads explicitly
1
where we have used the reciprocity property of the Green’s function. In eq. (2.16), we can identify the expression in brackets as the integral-operator kernel of the bulk-modulus Frechet derivative,
i.e., the bulk-modulus sensitivity kernel for the source-receiver pair (xsxg), which is defined as volumetric density of the corresponding Frechet derivative (Fichtner and Trampert, 2011)1. Its Fourier transform is U in eq. (2.15). A similar procedure provides the corresponding expression for the Frechet derivative and sensitivity kernel with respect to density.
As mentioned before, the separation of the model and wavefields is completely arbitrary. Therefore, the linearised treatment remains valid as long as the reference model is sufficiently close to the true model. This means, however, that validity problems may arise in practice because of the choice of the reference model. In complex geological settings, the conventional choice of a smooth version of the model as the reference model and all high-frequency contributions as the scattering part may fail, because these model parts, and consequently also the resulting wavefields, may be of the same order. In such a situation, the above linearisation is no longer valid. To proceed with a linearised inversion, we must decompose the model in other ways.
2.1.2	Decomposed perturbation
Note that the approach described above - considering the the unknown part of the model as the scattering potential and linearizing it to obtain an expression for the scattered wavefield which,
1 Actually Fichtner and Trampert (2011) define the sensitivity kernel as the volumetric density of the Frechet deriva-
tive of the objective function w.r.t. the model parameters. But if the L2-norm of the residual is used as objective function its Frechet derivative has direct relation with the Frechet derivatives of the wavefield w.r.t the model parameters
(Pratt et al., 1998). Thus, we extended the concept of sensitivity kernel to the volumetric density of the wavefield Frechet derivative w.r.t the model parameters.
thus, become the residual - is not the only way to use the scattering theory in FWI. An alternative way is to further decompose the reference and perturbation parts themselves. For the linearised inversion this is the simpler procedure because it allows to start from the linearised equations. Therefore, we will develop this type of decomposition in more detail below.
Actually, such a redecomposition could be done in as many parts as convenient. In Appendix B, Section B.1, we show that the decomposition described by eqs. (2.4) and (2.5) can be immediately generalised, because eq. (2.4) is of the same type as eq. (2.1) and can be decomposed in the same way into two equations and so on. Of these, we consider the most basic one, i.e., a decomposition into two components each (see Figure 2.1). The components of the reference model are, in principle, completely arbitrary for we fully known the reference model. For convenience, from an application point of view, we think of them as representing a (smooth) background model and an estimate of the singular part of the model. The two components of the perturbation part are the perturbations of these two model components. Correspondingly, we will have four wavefield components, being the background and singular-part wavefields and their respective perturbations. For the purpose of linearised inversions, we will consider the perturbations small in comparison to the reference components.
In principle, it is also possible to decompose the model into several parts according to eq. (B.8) and consider perturbations to all model and corresponding wavefield contributions. Such a generalisation to a perturbation of all terms to an N-fold decomposition is conceptually straightforward, but the resulting mathematical treatment is too extensive and will be left as a possible thesis follow up.
Moreover, the case of two medium and wavefield components is the most practical one. We often have access to initial approximations for both a background and a singular part of the medium, e.g., a smooth migration velocity model and the reflector positions in the corresponding migrated image. Then, the appropriate procedure is to invert for perturbations of these two model parts using the corresponding wavefield perturbations.
Therefore, we assume from now on that the reference model can be decomposed into background and singular parts as
Ko = Kb + Ks and p0 = pb + ps,	(2.17)
which are of the same order. Correspondingly, the reference wavefield will be separated into background and singular parts, i.e., p0 = pB + pS, also assumed to be of the same order. For
Figure 2.1: A sketch of the proposed decomposition. The components of the reference model are thought to represent a (smooth) background model and an estimate of the singular part of the model (m0 = mB + mS). The two components of the perturbation part are the perturbations of these two model components (5m = 6mB + 6mS).
brevity, we will refer to the background and singular parts of the reference model and wavefield as the background and singular models and wavefields, respectively.
With decomposition (2.17), we are ready to investigate how perturbations of both parts of the reference model affect the set of equations in Section 2.1.1. In other words, we are interested in answering the following questions: Once perturbations are introduced in the background and/or in the singular model, what will be the resulting residuals 5pB and 5pS of the background and singular wavefields, pB and pS? What are the sensitivity kernels for these wavefields? And what is the expression for the individual secondary sources for each of these wavefields?
After a similar analysis as outlined above for the perturbation of the undecomposed wavefield, we find that the background and singular wavefield residuals as a function of the new background
and singular model perturbations can be written in discretised form in the frequency domain as
^PB
8ps
U B V B 0	0
ub vb US Vs
U S V S U S V S
8K b
8pB 8K s
8Ps
(2.18)
Here, 8KB, 8pB, 8KS and 8 pS are the discretised versions of the perturbations of the background model parameters 8KB and 8pB, and the perturbations of the singular model parameters 8KS and 8pS, which are defined in such a way that
8K = 8KB + 8KS	and 8p = 8pB + 8pS.
(2.19)
Moreover, UB and VB are the discretised sensitivity kernels of the background wavefield with
__B	__b
respect to the background bulk modulus and density, US and VS are the discretised sensitivity
__S
kernels of the singular wavefield with respect to the background bulk modulus and density, and US _______S
and VS are the discretised sensitivity kernels of the singular wavefield with respect to the singular bulk modulus and density, respectively.
Sensitivity subkernels
Let us now demonstrate how we arrive at eq. (2.18). In full analogy to subsection 2.1.1, the decomposition of eq. (2.4) with po = pB + pS leads to the system
Lb [pb(x,t; xs)] = 8(x — xs)S(t),	(2.20)
Lo [ps(x,t; xs)] = —Vo [pb(x,t; xs)] ,	(2.21)
where Vo = Lo — LB is the reference scattering potential. Note that the background wavefield pB excites the secondary sources for the singular wavefield pS. With the help of the Green's function Go in the reference medium, the singular wavefield is
ps(x,t; xs) = — I d3x Go(x,t; x') * Vo [pbxs)].	(2.22)
Jv
Each line of eq. (2.18) is a consequence of introducing medium parameter perturbations in eqs. (2.20) and (2.21). Perturbing the former equation will lead us to the secondary sources of the
background-wavefield residual which, in the end, will give us the first line of eq. (2.18). Perturbing the latter will lead us to the secondary sources of the singular-wavefield residual which will give us the second line of the same equation.
Secondary sources for the background-wavefield residual
We note that eq. (2.20), which describes the most basic component of the wavefield in any decomposition, has the same functional form of that for the total wavefield, eq. (2.1). Therefore, small perturbation of KB and pB leads to the situation discussed in Subsection 2.1.1 with subscripts o replaced by B; 8p by 8pB; 8K by 8Kb; and 8L by 8Lb in eqs. (2.12) and (2.13). As a consequence, the equation for the corresponding linearised residual 8pB of the background wavefield has the form of eq. (2.12), i.e.,
Lb [8&gt;Pb(x, t; xs)] = -8Lb [pb(x, t; xs)],
(2.23)
where LB denotes the acoustic wave operator in the background medium. Moreover, the background secondary potential, 8Lb, is defined as
\8Kb(x) a2 B	t KB (x) dt2
- V-
SpB(x)^\ \ pB(x) J J ■
(2.24)
The solution to equation (2.23) can again be found by convolution with a Green’s function. With the help of the Green’s function GB in the background medium, we can evaluate the backgroundwavefield residual as
8&gt;Pb(x,t; xs) = -
d3xd Gb(x, t; x') * 8Lb [pB(x', t; xs)]
•&gt;
(2.25)
of which the first line of eq. (2.18) is the discrete representation in the frequency domain.
Using the Green’s function’s reciprocity, the explicit expression for the bulk-modulus part of the sensitivity kernel in eq. (2.25) becomes
8pB (xg ,t; xs)
[ d3x'
Jv
1
KB (x')
Gb (x',t; xg) *
d 2Pb
dt2
(x , t; xs)
8Kb (x'),
(2.26)
where the expression in brackets is the sensitivity kernel of the background wavefield with respect to the background bulk modulus for the source-receiver pair (xs, xg). In other words, its Fourier
transform is represented by UB in eq. (2.18). Correspondingly, an expression for VB in eq. (2.18) can be obtained from the density part of SLB in eq. (2.25).
Secondary sources for the singular-wavefield residual
The derivation of the second line in eq. (2.18) starts from the linearised eq. (2.12). To derive the secondary sources of the singular-wavefield residual, we decompose the perturbed wavefield as Sp = SpB + SpS, where SpB is the background residual which satisfies equation (2.23). From the linearised equation (2.12), taking into account the wavefield decomposition, i.e., p = pB + pS,
we find
Lo [SpB + Sps]	=	—SL [pb + ps],	(2.27)
Lo [SpB] + Lo [Sps]	=	— SL [pb] — SL [ps],	(2.28)
Lo [Sps]	=	—SL [pb] — SL [ps]	—	Lo	[SpB].	(2.29)
Using the identity Lo = Vo + LB yields
Lo [Sps] = —SL [pb] — SL [ps] — Vo [Spb] — Lb [Spb].	(2.30)
Upon the use of equation (2.23), this can be recast into the form
Lo [Sps] = —Vo [Spb] — SL [pb] — SL [ps] + SLb [pb] .	(2.31)
Here, SL is the linearised secondary potential given by eq. (2.13), with the model parameters and perturbations decomposed according to eqs. (2.17) and (2.19), respectively. Note that in linear approximation, equations (2.30) and (??) are equivalent. However, since LB [SpB] and SLB [pB] are different operators applied to different wavefields, practical results may slightly differ when calculating one or the other. The size of the difference allows to assess the importance of nonlinear effects.
An alternative, more tedious way to derive eq. (2.31) is to introduce the model perturbations SKb, SKS, SpB, and SpS in eq. (2.21). Other possibility is shown is Appendix ??.
Eq. (2.31) allows us to evaluate the singular-wavefield residual, SpS, resulting in
SpS(x,t; xs)=	d3x' Go(x,t; x') * As(x',t; xs) ,	(2.32)
Jv
where Go(x, t; x') is the Green’s function of the reference wave operator Lo as before. Discretisation of this expression under consideration of the contributions to Gs leads to the second line of eq. (2.18).
Decomposition of the singular-wavefield residual
Let us now make the contributions to these sensitivity kernels more explicit. For this purpose we consider the Green’s function Go, too, as composed by background and singular-part wavefields, i.e. Go = Gb + GS, where GB satisfies eq. (2.20) with an impulsive point source, and where GS satisfies eq. (2.21) for secondary sources excited by GB. In other words, GB is the Green’s function in the background medium, and GS is its difference to the Green’s function in the reference medium. We will refer to GB and GS as background and singular Green’s functions, respectively.
With this notation, expression (2.32) can be decomposed into 8 terms as
n=8
tips(xg,t; Xs) =	sPs,i(Xgxs) =
i=1
-	d3x' Gs (Xg ,t; x') * Vo [ópB (x',t; xs)]
Jv
-	d3x' Gb (xg ,t; x') * Vo [$Pb (x',t; xs)] jv
-	d3x'Gs(xg,t; x') * óC [pb(x',t; xs)]
Jv
-	d3x' Gb (xg ,t; x') * óC [pb (x',t; xs)] Jv
-	d3x' Gs (xg ,t; x') * óC [ps (x',t; xs)]
Jv
-	d3x' Gb (xg ,t; x') * óC [ps (x',t; xs)]
Jv
+ / d3x' Gs (xg ,t; x') * óCb [pb (x' ,t; xs)]
Jv
+ / d3x' Gb (xg ,t; x1) * ÓCb [pb (x',t; xs)] ,
Jv
(2.33)
(2.33.1)
(2.33.2)
(2.33.3)
(2.33.4)
(2.33.5)
(2.33.6)
(2.33.7)
(2.33.8)
where Green’s function reciprocity was used once again. The terms are provisionally numbered from top to bottom, i.e., term 6ps,i is given in line (2.33.1) and so forth. In the next section, we
will analyse and name these terms more appropriately based on their physical meaning.
2.2	Physical interpretation of the forward decomposition
2.2.1	Old information, brand new point of view
It is important to recognise that splitting the wavefield residual, 8p, into separate background and singular terms, 'pB and 6pSyi, does not add new contributions as compared to the classical form of the undecomposed wavefield residual given by expression (2.14), if the unperturbed medium m0 is assumed to contain both a background and a singular part. The significance of the splitting lies on the possibility to analyse the contributions individually, and to recognise the importance of multiple-scattering contributions originating from the non-smooth part in the reference model.
First of all, we immediately recognise that the eighth term (2.33.8) of eq. (2.33) is the negative of the background-wavefield residual, eq. (2.25). This leads to
5ps(Xg,t; xs) - 8'ps,s(Xg,t; xs) = 8ps(xg,t; xs) + 'pb(xg,t; xs)
n=7
= 8p(xg,t; xs) =	'ps,i(xg,t; xs),	(2.34)
i=1
where we have used that 8p = 'pB + 8pS. In other words, the sum of the first seven terms above yields the same total wavefield perturbation as the conventional formulation.
2.2.2	Multiple scattering/internal reflection uncovered
All of the contributions of eq. (2.33) have the very same structure that reveals the physics and the importance of each one of these terms. They consist of a convolution of an extrapolator term with a secondary-source term. The extrapolator describes the wave process that takes the energy from the secondary sources to the receiver. The secondary sources are constituted by the potential operator of the involved scattering mechanism and the source wavefield that excited this mechanism in the first place.
The meaning and importance of the contribution depends on the specific model decomposi-
(b) Sps,4
(C) Sps,6
Figure 2.2: Different terms showing different levels of interaction of single- and multiple- scat-tered/reflected information. The colour code is the one adopted in eqs. (2.35), (2.36), (2.37) and (2.38). From top left, in clockwise direction: (a) and (b) show contribution from single-scattering events, difference between them resting on which operator is used to generate the secondary source to be extrapolated; (c) brings contribution from multiple-scattering events from receiver-side; (d) shows the contribution of the strong multiple-scattering events.
(d) Sps,5
tion. Here, we assume the decomposition to follow the classical approach, i.e., in a background model carrying the low spatial-frequency components and a singular model carrying the high ones. Then, the decomposition will make explicit the different levels of interaction between single- and multiple-scattered/reflected information within the data. Below, we will analyse the respective physics behind some of the individual terms (see also Figure 2.2).
It is worth noting that decomposing the linearised expressions means that there is still a singlescattering assumption involved. While the decomposed approach considers full multiple scattering in the (singular part of the) reference model, it considers only single scattering at the (unknown) model perturbations. In other words, both in the conventional approach and in the one proposed here, the wavefield residuals are evaluated with the help of the Born approximation, i.e., the extrap-olators G0(xg,t; x'), GB(xg,t; x'), and GS(xg,t; x') = G0(xg,t; x') GB(xg,t; x') in eqs. (2.14)
and (2.33) are wavefields propagating in the unperturbed models. No higher-order interactions among the model perturbations are taken into account.
We are now ready to analyse the individual terms of the wavefield residuals. Note that there are terms based solely on single scattering at model perturbations without scattering at singular parts of the reference model. Two examples are the background residual, SpB of eq. (2.25), and the singular-residual contribution, 6pSy4 of eq. (2.33.4). These are given by
background-wavefield	background-wavefield excited
extrapolator	background secondary source
¿pB(xg ,t; xs)	= -	d3x'	Gb(xg ,t; x')	*	[pb(x',t; xs)]	(2.35)
Jv
and
background-wavefield background-wavefield excited extrapolator	total secondary source
6ps,4(xg,t; xs) = -	d3x'	Gb(xg,t; x')	*	5C [pb(x',t; xs)]	, (2.36)
JV
respectively. Figures 2.2(a) and (b) display cartoons that graphically explain these single-scattering phenomena, showing that for these terms both the source-side wavefield exciting the secondary sources and the receiver-side extrapolator are wavefields that propagate in the unperturbed background model. These figures also highlight with a colour code the difference between them: the operator involved in the scattering mechanism. For SpB, only the relative background perturbations KB and KB generate secondary sources, while for Jps&gt;4, the relative total medium perturbations 5Kb+5Ks and dpB+dpS do so.
Ko	po
Parts (c) and (d) of Figure 2.2 represent examples of terms that are single scattered at the model perturbations and multiple scattered at the singularities of the unperturbed model. The contribution Sps,6 of term (2.33.6) has the form
background-wavefield singular-wavefield excited extrapolator	total secondary source
6ps,e(xg,t; xs) = - d x'	Gb(xg,t; x')	*	5C [ps(x',t; xs)]	.	(2.37)
Jv
Here, multiple scattering is observed in the source-side wavefield as indicated in its graphical representation in Figure 2.2c. The difference to the single-scattering term 6ps,4 (Figure 2.2b) is
that the wavefield that excites the secondary source at x' now originates at the singularities in the reference medium described by the operator difference V0 = L0 — LB.
An example of strongly multiple-scattered events is the term (2.33.5), i.e.,
singular-wavefield extrapolator
singular-wavefield excited total secondary source
bps,s(xg,t; xs)
d3x'
V
/ -----\ ----------------------\
Gs(xg,t; x') *	bL [ps(x',t; xs)]
(2.38)
Both the secondary source and the extrapolator are built up by unperturbed singular wavefields (see Figure 2.2d) generated by the differences between the reference medium and its background part.
Similar analyses can be done for the remaining terms to understand the physical meaning of each contribution. However, before rewriting eq. (2.33) accordingly, we need to recognise that terms 5pSti (i = 3, 4, 5, 6) can be further decomposed. We discuss this in the next section. In Section 2.2.4, we will then be ready to rewrite eq. (2.33) in a form that allows to see all different levels of interaction among the single and multiple scattered/reflected wavefield existing in each one of the terms.
2.2.3	Background and singular-part contributions
Actually, the secondary potential bL, defined in eq. (2.13), consists of two components. Explicitly, it reads
= -
Kb + 5Ks (Kb + Ks )2
B — v.
dt2 v
Pb + bPs (Pb + Ps)2	.
(2.39)
In other words, the secondary potential can be written as bL = bB + bS, with
d 2
and
Kb (Kb + Ks )2
dt2
be	bKs	\ d2
(Kb + Ks )2 dt2
V-
Pb (Pb + Ps)2
ps (Pb + ps)2
V
V
5
(2.40)
(2.41)
=
V •
where both bB and bS depend on both unperturbed parts of the model, but only on the perturbation of one of them. Particularly, notice that bB = bLB (compare to eq. (2.24)). The operator bB
Ub 5Kb
U§6KB&amp;amp; s+ ~
Ug SKs ©
Figure 2.3: Subkernels obtained from the decomposition of the sensitivity kernel U for bulkmodulus perturbation. Kernel V for density perturbation is decomposed analogously.
is called background part of secondary potential, and 3S is called singular part of secondary potential.
Therefore, each of the terms 8pS,3 to 8pS,6 possesses two contributions, corresponding to the parts 8B and 8S of 8C. As an example, let us take the third contribution 5pS,3. It can be written as a sum of a background and a singular part, viz.,
8ps,3(xg,t; xs) = 8ps,3B(Xg,t; xs) + Jps,3S(xg,t; xs),	(2.42)
where each of the two terms on the right side still consists of two contributions, corresponding to the bulk-modulus and density perturbations. The background bulk-modulus contribution has the form
1
^pK3B (xg ,t; xs)=	d3x'
V
d 2p	1
L(Kb&lt;x') + Ks(x'))2 Gs(x''t; xg’ * -at^(x' t; xs&gt; SKb&lt;x?) • (2.43)
The term in brackets describes the JpS;3 part of the sensitivity kernel of the singular-wavefield residual with respect to the background of the bulk modulus, the discretised Fourier transform of
__B	_B
which is US of eq. (2.18). Thus, we denote this contribution by US3. Correspondingly, there are parts of the sensitivity kernel of the singular-wavefield residual with respect to the singular part of the bulk modulus, US, and therefore called UB3, and to the background and singular parts
__B	_s
of the density, VS 3 and VS 3. The terms JpB 4, JpB 5, and 8pS,6 can be decomposed analogously, giving rise to corresponding contributions to both sensitivity kernels. Note that in all four cases,
the contribution to the background sensitivity kernel is equal to that to the singular-part sensitivity
__B ______s	___ ________B ______S	__
kernel, i.e., UB, = UB,, = UB , and VB, = VB, = Vs,, (i = 3,4,5,6).
In this way, we arrive at thirteen subkernels (Figure 2.3) for each parameter of the model, i.e.,
bulk modulus and density. These are one subkernel to evaluate the background-wavefield residual and twelve subkernels to evaluate the singular-wavefield residual. Of the latter, eight depend on perturbations of the smooth part of the model and four depend on perturbations of the singular part. Therefore, eq. (2.18) can be rewritten as
U B V B 0	0
ub VB us Vs
U S V S U S V S
6K b SpB
K s
Tps
U B	VB	0
HiUs,i	HiVs,i	HjUs,j
0
EjV S,j
SK b
SpB
SK s
Tps
(2.44)
with i = 1,2, 3, 4, 5, 6, 7, 8 and j = 3, 4, 5, 6, the numbering referred to the one displayed in eq. (2.33).
2.2.4	Physical interpretation of the kernels: naming the terms
The provisional numbered notation was useful to count the contributions to the wavefield residuals, but it is not very helpful to identify them. For completeness, we even needed to introduce another subscript to identify the individual contributions to 5pSji (i = 3, 4, 5,6) as indicated in eq. (2.42). For this reason, we rename all terms based on their physical meaning as SpSapY, where each of the three subscripts a, ft, and y stands for a physical action involved in the generation of the contribution. The first subscript, a, represents the wavefield responsible for the propagation of the contribution on the source side, the second subscript, ft, stands for the potential operator describing the secondary sources, and the third subscript, y, designates the wavefield responsible for the propagation of the contribution on the receiver side. The receiver-wavefield subscript y is either B for the background wavefield or S for the singular wavefield. The source-wavefield subscript a can, in addition to B and S, also be b, representing the wavefield residual due to the background perturbation, SpB. The potential index ft can take the values L, B, S and V, representing the background secondary potential 5LB, background part SB and singular part 5S of the secondary potential, and the scattering potential V0, respectively. For instance, the background contribution 5pS,3B to 5pS,3, the bulk-modulus contribution of which is explicited in eq. (2.43),
becomes bpS,BBS, indicating that the background wavefield (B) excites secondary sources at the background perturbations of the reference medium (B), which are propagated to the receiver by the singular Green's function (S). Correspondingly, its singular-part contribution 5pSy3S becomes bps.BSS.
Figure 2.4 shows cartoons representing the physical interpretation of all thirteen bulk-modulus subkernels of eq. (2.33). The subcaptions state the new name of each term and its old one in the previous, numbered nomenclature of eq. (2.33). We still need an additional index (for example, a superscript K or p) to indicate whether the contribution originates from a perturbation of the bulk modulus or density. However, in our numerical examples below, where we restrict ourselves to bulk-modulus perturbations, we will omit this additional index for the sake of simplicity.
The subscripts of the Frechet derivatives contributions Us,i and Vs,i to the sensitivity kernels can be replaced accordingly. However, as seen in the previous section, what would be the contributions US&gt;BBS and US&gt;BSS are the same, making the potential subscript ft needless for this pair. The same happens to the pairs: Us.bbb and Us,bsb; Us,sbs and Us,sss; and Us,sbs and Us.sss. So, for these 4 pairs we simplify the notation dropping the potential subscript when referring to the corresponding discretised Frechet derivative. Therefore, we restate the following definitions from (2.44):
U S = £ U s,i,	(2.45)
i
U'S = E Us.l,	(2.46)
j
where i = bVS, bVB, BS, BB, SS, SB, -BLS, -BLB, and j = BS, BB, SS, SB. By analogy, _________________________________________________B	__b
the same can be done to the Frechet derivatives Vs and Vs.
Two examples of the use of the new nomenclature are
¿Ps,bV s bpS,BSB
U s,bv s bK b ,
V S,BB bps .
(2.47)
(2.48)
Let us analyse the sub- and superscripts of the first example (2.47). There, we have one of the contributions to the singular-wavefield residual (s.) due to perturbation in the bulk-modulus model (K). The perturbation refers to the background model (b indicates dependence on the backgroundwavefield residual which is present only if the background model is perturbed). the contribution is
Figure 2.4: Physical meaning of the subkernels. Each one of the cartoons shows three elements: source-side wavefield; the operator generating the secondary source; and the receiver-side wavefield extrapolator. Subcaptions indicate the new name and correspondence to the previous, numbered nomenclature.
individualised by the subscript s which details the elements involved in its generation. Firstly, we identify the source-side wavefield index (b) which indicates the wavefield that excites the secondary source. in this case, it is the background-wavefield residual. Secondly, the scattering mechanism index (v) which represent the potential operator applied onto the source-side wavefield. Here, it is the reference scattering potential. And finally, the extrapolator index (s) showing the wavefield that propagates the secondary source to the receivers. in this example, we have the singular Green’s function.
On the second example (2.48) we have again one of the contributions to the singular-wavefield residual (s&gt;), but now due to perturbation in the density model (p). The perturbation is done in the singular model (the index S stands for operator SS which depends only on the singular- model perturbation). The contribution is label with the subscript ,BSB. This indicates that the secondary source is excited by the background wavefield (,B), the singular part of the secondary potential operator SS as scattering mechanism operator, and the background wavefield as extrapolator (B).
2.3 Inversion: backprojecting the residuals into model space
The purpose of deriving expressions for the individual contributions to the wavefield residuals is their use in linearised inversion in order to update the model. This is achieved by backproject-ing the residuals into the model space with the help of the adjoint Frechet derivatives (sensitivity kernels) and using them to obtain estimates of the perturbation with the technique known as adjoint-state method (Tromp et al., 2005; Fichtner, 2010; Fichtner and Trampert, 2011).
2.3.1	Conventional formulation
From the total wavefield residual Sp, estimates for the bulk-modulus and density perturbations, SKest and Spest, respectively, are obtained by the adjoint operation to eq. (2.15). This is achieved by backprojecting the wavefield residual according to
SKest		\u fl
Spest		V \
where superscript t denotes adjoint operator.
2.3.2	Decomposed formulation
Under the separation into background and singular components proposed here, estimates of background and singular model perturbations can be evaluated individually by backprojecting the residuals. The perturbation estimates are given by the adjoint to eq. (2.44) as follows
5Kf
8Kf
SpS
skb'b + E, 'K-	'		' uB	Si US,i		
Sp&amp;amp;B,B + Si Sp&amp;amp;B,i		v B	Si VS,i		SPB
S '		0	^j U S,j		. Sps _
Sj	'		0	Sj v.		
(2.50)
where the summation indices again take the values i = bVS, bVB, BS, BB, SS, SB, -BLS, —BLB and j = BB, BS, SB, SS.
The explicit meaning of these expressions is analogous to the representation of the estimate in Tarantola (1984a). At each point x of the model, each contribution to the perturbation estimate is
the cross-correlation between the direct wavefield from source with the backpropagated residual from the receivers. For example, estimates SK^Bg and SKe,bVB reads explicitly (see derivation in Appendix C)
direct wavefield
skb,bs(x) = ^^2	— \P*B(x,x; xs) GS(x,x; xg)SPS(xg,x; xs)
s g J	(x)	a--------------''--------------'
back-propagation of &amp;amp;ps
(2.51)
and
sKB\bVB(x) =—y^ y^
sg
direct wavefield
scattering potential at X
,---------------'a---------------s
d3 x! GB (x, x; x') —x2\T,(.. —	) G*B (x', x; xg )5ps (xg ,x; xs). (2.52)
JV a-------------v-------'	\K0(x)	KB (x) J a-------------------v-----------------'
1st back-propagation of &amp;amp;ps to X
2nd back-prop.
Note that there are singular-wavefield residuals that must be backpropagated once, e.g., from xg to x as for estimate SKBstBS, or twice, e.g., from xg to x' and from there to x as seen for estimate SKB\VB. To get the explicit expressions of the other sensitivity kernels, one just needs to do the proper substitutions of the wavefields and potentials.
It is to be noted in this context that in analogy to the wavefields p0 and G0 in the conventional
approach, the wavefields pB, GB, ps, and Gs in the decomposed approach are known, because all of them are calculated in the known reference model. We stress once more that the decomposition of reference model into background and singular parts is completely arbitrary, not relying on any kind of approximation.
2.3.3	Residual information leakage
Ideally, one part of the model is perfectly known, so that only perturbations of the other part need to be considered. However, backprojecting the wavefield residuals may lead to non-zero perturbation estimates for unperturbed parameters. We call this effect residual information leakage. Generally speaking, when backprojected into the model space, data residuals caused by a perturbation of the background model can leak to the estimates of the singular part and vice-versa. From expression (2.50), it is clear that there will be non-zero estimates for both 5KB and 6Ks independently of whether only the singular-wavefield residual or both, background and singular residuals are non-zero (there is no way to have only a non-zero background-wavefield residual). The only way to avoid the leakage would be to use the inverse that would correctly distribute the power among the estimates. Unfortunately this is not the usual scenario in practice when we are dealing with non-invertible operators.
This matter is particularly important under the present decomposition. Since the sensitivity subkernels related to the terms Sps,BBB and 5ps,BsB are identical (Us&gt;BB), so will be the estimates for both singular and background perturbations G\B'BB and SKesstBB, irrespective of whether the backprojecting residuals are due to a perturbation of the background model alone or of both parts. Additional criteria will be needed to decide which of these parameter perturbations really caused the wavefield perturbations.
3.	Numerical Experiments and Discussion
We performed numerical experiments using the open-source software package Madagascar to study and validate the proposed decomposition, and to better understand the individual contributions, particularly when used to backproject residuals to build perturbation estimates. For this purpose, we constructed a set of different models with different perturbations and used different acquisition geometries (see Tables 3.1 and 3.2).
3.1	Experimental Procedure
For each of the models used in the numerical experiments we evaluated either the forward decomposition (direct problem - Section 2.1.2) only, the backprojection of the residuals (inverse problem - Section 2.3) only, or both.
All numerical experiments rely on bulk-modulus perturbations only and use a constant density of 2200 kg/m3. The wavefield modelling was carried out with staggered-grid vector-acoustic time-domain finite difference second-order in time, fourth-order in space. The input medium parameters were bulk modulus and density. Thus, the displayed velocity values in all figures hereafter were calculated from the bulk-modulus and density values used in the computations, using the relationship vp = y/K/p. We used monopole point-sources of volume density injection rate with a Ricker signal with a peak frequency of 30 Hz as source signature.
3.1.1	Forward Decomposition
All forward-modelling decomposition experiments followed these basic steps:
i.	We defined an unperturbed reference model and its background part, and modelled the corresponding reference and background wavefields p0 and pB (the singular wavefield was evaluated by its definition, pS = p0 — pB).
ii.	After model perturbation, we modelled the corresponding perturbed wavefields and determined the true residuals 5ptrue, 8pB?e, and 8pSae from the differences.
iii.	Using the model perturbation, we calculated the linearised residuals 8p, 8pB, and 8pS of the total, background and singular wavefields according to eqs. (2.14), (2.25), and (2.33) respectively, and compared them to the true ones.
In all forward experiments we performed single-shot simulations. The point-source position is indicated in the corresponding model figures by a black star. The wavefields were recorded at control receivers represented in the model figures by black triangles.
All the linearised wavefield residuals are result of Born approximation and have the general format below:
/ d3x'G(xg,t; x') * s(x',t; xs),	(3.1)
Jv
where G(xg ,t; x') is the Green’s function of the acoustic wave operator for a given set of known model parameters, and s(x', t; xs) is the secondary source, result of a differencial operator applied onto a known wavefield. As an analytic solution of such integral is impossible, we evaluate this expression numerically by modeller injection. In other words, whenever needed, we applied the appropriate differential operator on the known wavefield to build the secondary source s and injected it as source input at all grid points in the modeler with the appropriate set of model parameters related to the Green’s function G(xg ,t; x').
In the figures related to the forward-decomposition experiments (Experiments 1, 3, 4 and 6), red lines represent the true residuals and blue lines the corresponding linearly approximated ones. To the left of the wavefield comparisons, we place the associated cartoons of Figure 2.4 showing the corresponding Green’s function and secondary source to help recall the physical meaning of the studied residual. The modelling of the linearised wavefield residual introduces an amplitudeerror factor. For better comparison, we scaled the linearised residuals to match the amplitude of the corresponding true wavefield residuals. We then used the same scale factor for the display of all individual contributions.
3.1.2	Backprojecting residuals
Correspondingly, all the residual-backprojection experiments followed a procedure consisting of the following steps:
i.	True-residual backprojection: By means of the proper extrapolator in the time domain, we backpropagated (once or twice) the true total, background, and singular residuals (see Section 3.1.1, item ii) for a given source from a given receiver into the target area.
ii.	Cross-correlation with direct wavefield: We cross-correlated in the frequency domain the backpropagated wavefield with the proper direct wavefield (reference, background, or singular) from the corresponding source.
iii.	Stack: We stacked the resulting wavefield over frequency, sources, and receivers.
In the backprojecting experiments we performed non-simultaneous multiple-shot experiments. Source and receiver positions are marked in all models by white stars and triangles, respectively.
In the figures that depict the results of backprojecting experiments (Experiments 2, 5, 7 and 8) we employ variations of the cartoons of Figure 2.4 to indicate which (sub)kernel is used to backproject the residuals and obtain the bulk-modulus estimates. Each cartoon exibits the kind of source-side wavefield (reference, background or singular), the kind of receiver-side Green's function used to backpropagate the residual (some of them are built with two backpropagations), and the differential operator applied before the cross-correlation between wavefields. For better comparison, we normalised the total Bulk-modulus perturbation estimates to their maximum absolute value. Individual contributions to the estimates are depicted using the same scale factor.
3.2	Model gallery
The numerical experiments presented in this chapter were performed departing from four different unperturbed models summarised in Table 3.1. This table also contains the description of the discretisation in each model and the acquisition geometry used in each experiment involving such model.
Figure 3.1 shows the unperturbed velocity Model I. It consists of a single planar reflector at 350 m depth, separating two homogeneous halfspaces with velocities 1500 m/s and 2500 m/s. We chose a simple model for the first numerical experiment because, in this way, it is easy to recognise and understand each of the decomposition components.
For our decomposition , we chose the background part of Model I to be a constant velocity model with the first layer's velocity. The unperturbed singular part is then a Heaviside step function in the vertical direction with magnitude of 1000 m/s and step at 350 m. The vertical and horizontal
350
500
x (m)
50-
100-
150-
200-
250-
300-
!2500
2400
2300
2200
-2100
-2000
-1900
400
450
-1700
1600
Figure 3.1: Unperturbed velocity Model I (velocity in m/s).The first layer has a velocity of 1500 m/s, and the second layer a velocity of 2500 m/s. Density is kept constant (2200kg/m3). The source and receiver positions are indicated by black star and triangle respectively.
-1800
1500
o
o
Q)

[3100
3000
2 9 0 0
-2800 B
-2700
-2600 o
°
-2500
[2400
2300
Figure 3.2: Unperturbed velocity Model II (velocity in m/s) containing 40 randomly distributed scatterers, with constant background velocity (2205 m/s) and density (2200 kg/m3). One source (black star) and two control receivers (black triangles) - named as cr154 (top) and cr283 (bottom) - were used in the forward decompositions experiments. The other sources and receivers (white stars and triangles respectively) were used in the backpropagation experiment.
Model	Name	References	Acquisition geometry	Sample Sampling number	interval
I	Single reflector	Fig. 3.1	Single receiver	nx = 701 dx = 1.0 nz = 501 dz = 1.0 nt = 2151 dt = 0.2
II	40 scatterers	Fig. 3.2	Surronding	nx = 651 dx = 2.0 nz = 701 dz = 1.0 nt = 4001 dt = 0.2
III	60 scatterers	Fig. 3.3	Surronding	nx = 651 dx = 2.0 nz = 701 dz = 1.0 nt = 4001 dt = 0.2
IV	150 scatterers	Fig. 3.4	Surface	nx = 651 dx = 2.0 nz = 701 dz = 1.0 nt = 4001 dt = 0.2
Table 3.1: Unperturbed model gallery. n# stands for the number of samples in the #-axis. d# is the sampling interval in the #-axis; x- and z-axis are given in meters; t-axis is given in milliseconds. the origin for all axis was always o# = 0.
grid spacing was 1 m, and the time-marching step 0.2 ms. The recorded wavefields were then resampled to a 2 ms interval.
The next three models were set to see the role of multiple-scattering effect in the proposed decomposition.
Figure 3.2 shows the unperturbed multiple-scatterers velocity Model II. It consists of a background part with a constant velocity of 2205 m/s, and a singular part composed of 40 randomly distributed scatterers. Each of these scatterers consists of a 16 m x16 m perturbation that was smoothed horizontal and vertically to create a bell-shaped high-velocity zone with a maximum velocity difference of 798 m/s (some of the scatterers overlap partially, possibly resulting in larger velocity difference). The full acquisition geometry was used to study the effects of multiple scattering independently of the ones due to a lack of illumination. The vertical grid spacing was 1 m, the horizontal one 2 m, and the time-marching step was 0.2 ms. We resampled the recorded wavefields to a 6 ms interval. Sources were spaced by 55 m and the receivers by 4 m.
Figure 3.3 shows the unperturbed velocity Model III. It resembles the previous unperturbed model, the only difference being the larger number of scatterers: 60. This is done to enhance the multiple- scattering phenomena, increasing the amount of information on the background pertur-
[3200
3100
3000 I- 2900 -2800 -2700 - 2600 - 2500 ^2400 k2300

o
o
CL)
&gt;
Figure 3.3: Unperturbed velocity Model III (velocity in m/s) containing 60 randomly distributed scatterers, with constant background velocity (2205 m/s) and density (2200 kg/m3). For the numerical experiments, we used the same acquisition geometry as in Model II.
-3300	
-3200	
-3100	
-3000	
-2900	
-2800	
-2700	O
-2600	O
-2500 -2400 -2300	&gt;
Figure 3.4: Unperturbed velocity Model IV (velocity in m/s) containing 150 randomly distributed scatterers, with constant background velocity (2205 m/s) and density (2200 kg/m3).
Experiment	Unperturbed model	Perturbation	Modality
1	Model I	Constant background	Forward Decomposition
2		Lens-shaped background	Backprojecting Residuals
3	Model II	Constant background	Forward Decomposition
4		Scatterers’ positions	Forward Decomposition
5			Backprojecting Residuals
6	Model III	Lens-shaped background	Forward Decomposition
7			Backprojecting Residuals
8	Model IV	Lens-shaped background	Backprojecting Residuals
Table 3.2: Experiment gallery.
bation carried by the singular wavefield. We used the same grid spacing, time-marching step and resampling interval.
Finally, in Figure 3.4 we can see the unperturbed Model IV. It consists of 150 randomly distributed scatterers with the same grid spacing, time-marching step, resampling interval as the two previous models. The main difference between this and the previous ones lies in the acquisition geometry: source and receivers are restricted to the top portion of the model, simulating a surface acquisition. This was done to study the influence of the uneven illumination on our results.
3.3	Experiment gallery
Table 3.2 summarises all the experiments in the four models presented in this chapter. For each experiment is indicated which model was used, the kind of perturbation imposed (details will be seen in the coming sections) and which experiment modality was performed (forward decomposition or residual backprojection). Each next subsection is devoted to one of the eight experiments.
3.3.1	Experiment 1: Constant background perturbation of Model I, forward decomposition
In Experiment 1, we kept the singular part of the model unperturbed and introduced a 10% perturbation to the complete background part of Model I, i.e., 8Kb = 0.1Kb = 150 m/s and 8Ks = 0 m/s everywhere in the model. According to equation (2.44), this yields a perturbation in
Figure 3.5: Experiment 1. True total wavefield residual 'ptrue = p — p0 at cr550. Observe two distinct signals: the direct wavefield residual (peak at 0.27 s) and the reflected/scattered wavefield residual (peak at 0.36 s).
both the background and singular wavefields,
'Pb 'ps
U B Ui US,i
(3.2)
'Kb ,
where the subscript i takes the values BB, BS, SB, SS, — BLB, —BLS, bVB and bVS. These contributions correspond to the terms represented graphically by Figures 2.4a to 2.4i.
We recorded the true and calculated wavefields at a receiver (hereafter called a control receiver) named cr550 (black triangle in Figure 3.1). The true total wavefield residual can be seen in Figure 3.5. Two events can be clearly distinguished: the direct wavefield residual (peak at 0.27 s) and the reflected/scattered wavefield residual (peak at 0.36 s).
We start by comparing the true and estimated values of the wavefield perturbations at the control receiver and their individual contributions according to the decomposed expression (3.2).
The first contribution to be studied is the background-wavefield residual 'pB (Figure 3.6). We observe a good match between both waveforms at the receiver.
Next, we address the singular-wavefield residual 5pS at the control receiver. As shown in eq. (2.33) and illustrated in Figure 2.4, 5pS consists of twelve contributions, four of which are due to perturbations of the singular part of the model (see Figures 2.4j to 2.4m). Since we have not perturbed the singular part in Experiment 1, we have only eight non-zero contributions.
Based on the conventional practice of representing the reference model with the background model alone, it might be expected that the single-scattering contributions SpS_BLB and SpSiBBB to the singular residual should be the most important ones. But when we inspect Figure 3.7 we can see that they are closely related to the background residual rather than to the singular one.
Figure 3.6: Experiment 1. Linearised background-wavefield residuals 5pB (blue line) evaluated at cr550 as compared to the true one (red line), ¿pBue.
1.0e-02
0.0e + 00
-1.0e-02
0.00	0.05	0.10	0.15	0.20	0.25	0.30	0.35	0.40
Figure 3.7: Experiment 1. Terms related to single-scattering effects at the medium perturbations (blue lines): 8ps,-BLB (top), Sps,BBB (centre), and their sum (bottom). The red line true singular residual SpSe. Separately, Sps-BLB and Sps,BBB carry the largest energy. Their sum demonstrates that they are approximately complementary.
Actually, as stated before, the term Sps,-BLB is the opposite of the background residual, 6pB.
0.00	0.05	0.10	0.15	0.20	0.25	0.30	0.35	0.40
Figure 3.8: Experiment 1. Multiple-scattering contributions (blue lines), from top to bottom: Sps,BBs, Sps,sBB and 6ps,sBs. In all figures, Sp1™ is depicted in red lines for comparison. The first two terms carry most of the energy of the singular residual Sps.
From the mathematical expressions of Sps-BLB and Sps,BBB, we know that both terms slightly differ in the secondary-source potential operator applied to the source-side background wavefield. Because of the negative sign of Sps—BLB, they are almost complementary to one another and, in this experiment, end up canceling almost completely their main contribution. In Appendix D we show the resulting expression of the superposition of these terms, Sps-BW B. The physical reason for this behaviour is that the influence of the background perturbation is already accounted for in the perturbation of the background wavefield SpB. As we going to see later in this chapter, Sps-BWB is non zero only when the background perturbation overlaps the singular component of the model within the Fresnel zone of the total wavefield, which is not the case in this experiment.
The next terms we analyse are the multiple-scattering contributions Sps&gt;BBs, 6ps,sBB and Sps,sBs. In Figure 3.8 we see that the first two terms are the ones that answer for most of the
energy carried by the singular residual, 8pS. The small contribution coming from the strong multiple-scattering term $Ps,sbs is explained by the lack of other scatterers/reflectors the single reflector could interact with, leaving the very weak self-interaction of the reflector the only source of energy to this term.
Finally, we analyse the remaining three non-symmetrical contributions 8pS-LS,, 8pSybVB and SpS,bvS for which no corresponding contributions are present in eq. (2.33) and Figure 2.4. These contributions are depicted in the Figure 3.9. At first view, they seem to bear no resemblance to each other. The contribution 5pS-BLS carries about as much energy as the related contribution 5pS,BBS, though with a different signal. Actually they have the same relation as terms SpS-BLB and dpS,BBB have with each other: both terms are almost complementary to each other, differing only slightly in the secondary-source potential operator applied to the source-side singular wavefield. As in the single-scattering situation above, the superposition term $pS-BWS carries energy only if the background perturbations overlap with the medium singularities (Appendix D). On the other hand, the terms 5pS,bVB and SpSibVS (second and third plots in Figure 3.9) apparently carry no energy.
That being said, let’s take a closer look in these two terms: 8pSybVB and SpS,bVS. Their summation in the frequency domain yields (angular frequency u omitted):
(3.3) Recognising GB + GS = G0 and inserting dpB from the Fourier transform of eq. (2.25) yields
:,bVB(xg; xs)	+ 8ps,bvs(xg;	xs)	= - j	d3x'	(Gb(xg; x')	+ Gs(xg;	x')^	Vo	frpB(x';	xs)	.
I d3 x Gb(x1; x)5Cb [Pb(x; xs)] .
V
SpJs,bVB(xg; xs) + 5ps,bvs(xg;xs) =	d3x' Go(xg; x")VQ
Jv
(3.4) Note that V0 acts on x', so it can be brought into the integral on x and be applied only onto GB. After changing the order of integration, we find
dps,bVB(xg; xs) + dps,bvs(xg;xs)= d3x / d3x'G0(xg; x')V0 Gb(x1; x) 6Cb [Pb(x; xs)]
Jv	Jv	L	J
'-----------—X--------------'
-Gs(xg ;x)
•&gt;
(3.5) where we recognise the inner integral highlighted by the curly braces to be the Fourier transform
0.00	0.05	0.10	0.15	0.20	0.25	0.30	0.35	0.40
0.00	0.05	0.10	0.15	0.20	0.25	0.30	0.35	0.40
Figure 3.9: Experiment 1. Non-symmetrical contributions (blue lines), first four traces from top to bottom: bps,-Bls, bps,bvb , $ps,bvs and 8ps,bvb + $Ps,bvs respectively. In these traces, bpSue is depicted in red lines for comparison. The last trace show both —bpSj-BLS (black line) and 8pS,bVB + 8pS,bVS (dark green line) contributions normalised to their respective maximum absolute value.
Figure 3.10: Experiment 1. Comparing bptrue (red line) with evaluated counter-parts. In black, bp (evaluated with eq. (2.14)) and, in blue, bpB + bps (evaluated with eq. (2.25) and all but the 1st, 2nd and 7th terms of eq. (2.33) respectively). See the perfect match between blue and black lines.
of — Gs(xg,t; x) in full analogy to eq (2.22). Therefore, according to eq. (2.33.7) and Figure 2.4c:
bps,bVB(xg; xs) + bpsbvs(xg; xs) = —	d3xGs(xg; x)bLB [pb(x; xs)]
V
= — bps,BLs(xg; xs).	(3.6)
How to explain the disagreement between the theoretical prediction above and the numerical results depicted in Figure 3.9 (first and fourth traces)? The evaluation of the Born approximation via modeller injection introduces an amplitude error. The contribution 6ps,BLs is evaluated with one injection of the secondary source from the source at the background perturbation position
x.	On their turn, both contributions bps,bVB and bps,bvs are evaluated with the injection of two secondary sources: the first is done at the background perturbation position x with the secondary source generated by the wavefield coming from the source; the second at the scattering potential position x' with the secondary source generated by the wavefield coming from x. Thus, these contributions suffer twice from the amplitude error of the modeller. To compare the contributions without the influence of the amplitude error, the last part of Figure 3.9 shows both — bps-BLs (black line) and bpsjbVB + bps,bVB (dark gree line) normalised to their maximum value. We can observe that the normalised contributions agree very well.
Another way to verify the result seen in eq. (3.6) is by comparing bptrue, bp (evaluated with eq. (2.14)), bpB + bps (evaluated with eq. (2.25) and all but the 1st, 2nd and 7th terms of eq. (2.33) respectively). This is shown in Figure 3.10. When 6ps,BLs, bps,bVB and bps,bVB are not taken into account the match between p and pB + ps is perfect.
X (ill)
14
12
10
8
6
4
2°
OJ no cs
4
OJ u
OJ a
2
0
Figure 3.11: Experiment 2. Perturbation in the bulk-modulus background model, 3KB. The scalebar shows, in percentage, the perturbation magnitude.
3.3.2	Experiment 2: Lens-shaped background perturbation of Model I, backprojecting residuals
In Experiment 2 we departed from the same unperturbed, single-reflector Model I as the previous one (see Figure 3.1) but introduced a spatially limited (lens-shaped) perturbation in its background as shown in Figure 3.11. As in the previous experiment, we kept the singular part unperturbed. Again, we have perturbations in both the background and singular wavefields according to equation (3.2).
In this experiment, we are interested in the behaviour of the contributions in the backprojec-tions. Therefore, we backproject both the true background and singular residuals, SpB and 8pSue with the proper adjoint kernel as seen in eq. (2.50). Based on the result presented in eq. (3.6) we can restate that equation as:
’ 8Kf '		' iK$B + Ei Kti’		' u B	EiU si		3pb
6KeSst		E, SK’£,		0	E, u S, _		. bps _
where the summation indices take only the values i = BS, BB, SS, SB, -BLB and j = BB, BS, SB, SS. Notice, as previouly determined, that the estimates 8KBtbVS, 6KBtbVB and 8KeBt_BLS
cancel each other out.
Despite its simplicity, this is a most elucidative experiment which clearly exemplifies the decomposition discussed here. The first result is displayed in Figure 3.12. There we can see the bulk-modulus estimate SKest (top). Here and in the following residual-backprojection experiments, SKest is always obtained with the backpropagation of the total wavefield residual Sp according to the first equation of (2.49), i.e., it is evaluated using the reference Green’s function in the adjoint to equation (2.16). In this experiment, SKest is the estimate to be decomposed. After that, from left to right, from top to bottom in Figure 3.12, we observe the six components of the background bulk modulus estimate SKBst expressed in the first equation of (3.7). In the upper-left corner we have the bulk modulus estimate SKBstB result of backprojecting the background residual SpB followed by the contributions resulting from the backprojection of the singular residual SpS with the five adjoint sub- kernels: SKeBr_BCB; SKB_bs; SKB_sb; SKBs'_bb and SKe¿s_SS respectively. Comparing each contribution with the estimate SKest in the top figure one can clearly identify all the different “pieces” that compose the complete estimate.
Analysing each one of the contributions shown in Figure 3.12, we can draw some conclusions about their physical meaning. Term SKBstB is related to the direct-wave Fresnel zone. Both SKBst_BLB and SKBst_BB are related to the RTM migration operator, their difference residing in the presence or not of the singular part of the reference model, i.e., which of the factors, J, or K, is used in the scattering mechanism operator. The contribution SKB_sb is related to the receiverside reflecting Fresnel zone; SKBst_BS to the source-side reflecting Fresnel zone; and SKBst_SS to the reflector self-interaction Fresnel zone.
This simple example can be used to give more insight into the differences of three important estimates:
•	the conventional perturbation estimate SKcotnv obtained with the conventional approach, i.e., backprojecting the total residual Sp with the adjoint kernel based on the background wavefields;
•	the total perturbations estimate SKest obtained with aid of first line of eq. (2.49); and
•	the background perturbation estimate SKBst = SKBstB + SKBstS obtained as seen in the first line of eq. (2.50).
Figure 3.13 shows these estimates for comparison. In the top, we can see the total estimate SKest. In the upper-left corner we can see the conventional estimate	obtained with the conventional
Figure 3.12: Experiment 2. Top: Bulk modulus estimate 5Kest. The others are all background bulk-modulus-estimate contributions. From left to right, top to bottom: 5 KBB;
5KB_BS; 5KB_SB; 3KB-bb and 5KB_SS. The first of them in the upper-left corner, 5KBB, is result of background residual backprojection; the rest of them are result of singular residual backprojection. The subtraction of 5KBstB (upper-left corner) with 5KBst_BLB (upper-right corner) yields the conventional estimate 5KBnv (Figure 3.13, upper-left corner).
x (m)
x (m)	x (m)
0	100	200	300	400	500	600	700	0	100	200	300	400	500	600	700
x (m)	x (m)
0	100	200	300	400	500	600	700	0	100	200	300	400	500	600	700
Figure 3.13: Experiment 2. Top: Bulk modulus estimate SKest. Upper-left corner: Bulk modulus estimate SK^f™ obtained with the conventional approach. The others are all background bulk-modulus-estimate contributions. Upper-right corner: the background estimate SKBf = SK^B + SKffs. Lower-left corner: SK^B, result of background residual backprojection. Lower-right corner: SKBfS, result of singular residual backprojection (sum of all five contributions).
approach. It is constructed by backprojecting the total residual Sp with the adjoint kernel based on the background wavefields, which, according to our definition, would be UB. Mathematically:
SKL = uBSp = UB fpB + Sps) = UBSpb — U\-blbSps
= SK B,B — SK B,-B LB
(3.8)
X (m)
0	100	200	300	400	500	600	700
x (m)
0	100	200	300	400	500	600	700
x (m)
0	100	200	300	400	500	600	700
x (m)
0	100	200	300	400	500	600	700
0
50
100
150
_ 200
250
N 300
350
400
450
500
x (m)
0	100	200	300	400	500	600	700
x (m)
x (m)
0	100	200	300	400	500	600	700
0
50
100
150
200
250
N 300
350
400
450
500
Figure 3.14: Experiment 2. First four estimates are obtained by backprojecting the background residual with the adjoint sub-kernels USj, i.e., SKjB (cross-terms). From left to right, top to bottom': 5Kbs(b) = us,bs $pB ; $Kbb(b) = Us,bb ^Pb ; ^Kss(b) = Us,ss ^Pb ; $ksb(b) = US,SB ^PB• The next two figures are each one of the sums seen in the right-hand side of eq. (3.11). From left to right:	j USpB and j US,^ 3pS. At the lower-left corner is displayed the
summation of the previous sums, i.e. , 6Kest of eq. (3.11). At the lower-right corner, the bulkmodulus estimate 6Kest for comparison.
for we know that UB = — Us,_BLB. It show that the conventional estimate is obtained with the subtractions of the two contributions depicted in the second row of Figure 3.12. Definitely, there is a lot of information missing in bK^ when compared to bKest. From this observation we can already conclude that it is important to include an estimate of Ks in the starting model.
Next, in the upper-right corner of Figure 3.13, we can see the background estimate bKBst which is the summation of the estimate b KB^ (lower-left corner) with the estimate bKBsts (lower-right corner). The former is the result of background residual backprojection (seen also if Figure 3.12), the last is the sum of all five contributions bKB^ with i = BS, BB, SS, SB, —BLB, result of the singular residual backprojection. As the contributions bKBstBB and bKBst_BLB are almost complementary, almost all information of bKB\s comes from the estimates bKB\Bs, bKB\ss, bKBstsB.
The most important difference between the conventional estimate Kcostnv and the background estimate bKBst (upper-left and -right corners of Figure 3.13) resides in the illuminated region by each estimate. The conventional estimates practically does not see the subsurface. The only information from deep region comes from the short-wavelength migration-related contribution —bKBst_BLB. On the other hand, the estimate bKB1 benefits from the back-illumination provided by the single reflector, which allows the estimate to see a broader, deeper area with a larger wavelength.
As in this experiment only perturbation in the background was introduced, i.e., bK = bKB, one might expect that bKest and bKBst = bKBstB + bKBsts would give the same estimate which is not true when we compare the first (top) and the last (lower-right) estimates of Figure 3.13. To understand why these two estimates do not agree, we must go back to the forward problem formulation. As bp = bpB + bps, from equations (2.15) and (3.2) we have that
bp = bpB + bps = USKb = Ub JKb + Us_BLB bKB + U j bKB,	(3.9)
where j = BS, BB, SS, SB. Because UB = — Us,_bcb, we have
U = J2 U,j.	(3.10)
j
Thus we obtain from bKest = U (bpB + bps) and bKB = UB bpB + ^li uB^ bps:
bKest
(3.11)
SK B
UB SpB + U]s,-BLB Sps
(3.12)
where i = BS, BB, SS, SB, -BLB and j = BS, BB, SS, SB. We see that, besides the terms -----------------------------------------------------------------------------------------est already known, some new cross-terms come into play in the expression of the estimate SK : U sj SpB. We are going to refer to these cross-terms as SKjB) indicating that these are components -----------------------------------------------------------------------------------------est
of the total bulk-modulus estimate (SK ) obtained by backprojecting the background residual (thus, the index (B)) with the subkernel Us,j.
In Figure 3.14, we analyse the components of SKest in eq. (3.11) (SKB\ in eq. (3.12), was already displayed in Figure 3.13, lower-left corner). The first conclusion, comparing the last two estimates, is that the decomposition in equation (3.11) correctly accounts for all components of SKest: the first four estimates of Figure 3.14 correspond to the first sum in the right-hand side; and the last four estimates of Figure 3.12 correspond to the second sum. Nevertheless, the one relevant contribution among those resulting of background residual backpropagation - first four estimate of the Figure - is SKBb(B) = UB,bb SpB which, in this case, is exactly the same as SK&lt;B,b = UB SpB. Therefore the actual difference between sKB' and SKest is the presence (or not) of the contribution SKB-BLB which, if present, cancels the migration- related contribution SKB\bb.
3.3.3	Experiment 3: Constant background perturbation of Model II, forward decomposition
In the first experiment with this model, we kept the scatterers in place and introduced a 10% perturbation to the complete background part of Model II, i.e., SKB = 0 and SKs = 0. As in the previous experiment, this yields a perturbation in both the background and singular wavefields.
We fired a single source and recorded the calculated wavefields at two control receivers (black star and triangles in Figure 3.2, respectively). The control receivers are named cr154 (above the scatterers) and cr283 (below the scatterers).
First, we compare the true and estimated values of the wavefield perturbations and its components at the control receiver. In this experiment, we are focusing our analysis on the response at cr154.
The first contribution to be studied is the background-wavefield residual SpB. We observe a very good match between waveforms at receiver cr154 (Figure 3.15) located relatively close to the source. There are, though, some small fluctuation in the linearised residual SpB (blue line) at 0.15
1.0e-02
O.Oe + OO -1.0e-02
0.00	0.10	0.20	0.30	0.40	0.50	0.60	0.70	0.80
Figure 3.15: Experiment 3. Linearised background-wavefield residuals SpB (blue line) evaluated at cr154 as compared to the true ones (red line), 8pB?e.
(right after the main signal), 0.50 and 0.70 s. These are none but the residual reflections at the top border, bottom and right borders (overlapping), and left border, respectively, despite the absorbing bondaries conditions used in the modeller.
Next, we address the singular-wavefield residual 8pS and its eight components due to perturbations of the background model.
We start by analysing the terms 6pS-BLB and 6pStBBB. An indication of the importance of each contributing term is the energy it carries. Table 3.3 shows the energy carried by each of the eight terms contributing to the singular residual observed at cr154 as measured by means of its L2-norm. The table shows that the most energetic contributions correspond to single-scattering terms represented by these two terms. But this is by no means a rule. Here, as in Experiment 1, we can see that these terms are related to the background residual rather than to the singular one. if, by any reason, the background residual carries little energy, so will these terms or, at least, the estimate SpS-BLB. However, differently from the previous forward experiment, their summation, 8pS-BWB, has small but non-negligible contribution (Figure 3.16, last trace). This happens because in this example the background perturbation that overlaps the singular part of the model (scatterers) lies within the Fresnel zone of the complete non-perturbed wavefield. Nevertheless, its contribution is secondary.
As seen in Experiment 1, we expected the terms 8pS, BLS and 8pStbVS + 8pS,bvB (first two traces of Figure 3.17) to cancel each other, although, due to numerical issues already discussed, this does not happen. As before, we normalise both terms to their respective maximum value and compare them (last trace of the same figure). The match, although good, is not as perfect as seen in the last trace of Figure 3.9 indicating that numerically they do not cancel each other out completely. However, in order to support that this fact is due to numerical issues rather than a theoretical flaw, we can compare 'ptrue, 8p (evaluated with eq. (2.14)), 8pB + 8pS (evaluated with eq. (2.25) and all
2.0e —03
0.0e + 00
— 2.0e —03
0.00	0.10	0.20	0.30	0.40	0.50	0.60	0.70	0.80
Figure 3.16: Experiment 3. Terms related to single-scattering effects at the medium perturbations evaluated at cr154 (blue lines): frpSy-BLB (top), 8pSyBBB (centre), and their sum (bottom). The red line true singular residual 5pS?ue- Separately, Sps-BLB and 8pSyBBB carry the largest energy. Their sum, 8pSy-BWB, demonstrates that they are approximately complementary.
terms of eq. (2.33) respectively) and 8pB + 8pS (evaluated with eq. (2.25) and all but the 1st, 2nd and 7th terms of eq. (2.33) respectively). This is shown in Figure 3.18. When SpSyBLS, 8pSybVB and 6pSybVB are not taken into account the match between 8p and 8pB + 8pS is close to perfect.
Therefore, hereafter, we refer only to the terms 8pSyi with i = BBS, BBB, SBS, SBB, —BLB as the background-dependent contributions to the singular residual.
That leaves the last three terms, 8pSyBBS, 6pSySBS and 8pSySBB as the most important contributions to the total singular-wavefield residual 6pS. The upper three parts of Figure 3.19 compare these source-side multiple-scattering contributions (blue lines) individually to 5pSue (red lines). We see that the contributions 8pSyBBS and 8pSySBB do similar jobs trying to match the true singular residual. The strong multiple-scattering contribution 8pSySBS apparently plays a secondary role.
Term	L2-norm (x 10 5)	Term	L2-norm (x 10 5)
3Ps,B BB	387-59	1	dPs,B Bs	65.40
dPs,-B LB	386.67 j 9.65	Sps,sbs	17.27
^Ps,s BB	80.32	&amp;amp;Ps,bV B	2.38
^Ps,-B Ls	70.59	$Ps,bV s	1.64
Table 3.3: Experiment 3: L2-norm as a measure of energy of all observed terms at cr154. The terms are sorted in descending order of energy. The terms related to single scattering effects are the strongest, followed by the ones related to multiple-scattering. The braces with attached values show the energy of the corresponding summed traces, indicating destructive interference of the individual contributions (see also Figures 3.16).
Figure 3.17: Experiment 3.: First two traces from top to bottom: 8ps-BLs and 5psb)V B+bps,bvs, respectively. In these traces, 5ptSue is depicted in red lines for comparison. The last trace show both Sps,BLs (black line) and 6ps,bVB + Spsb&gt;vs (dark green line) contributions normalised to their respective absolute maximum value.
Figure 3.18: Experiment 3. Comparing bptrue (red line) with evaluated counter-parts at cr154. In black, 8p (evaluated with eq. (2.14)); in dark green, SpB + 8pS (evaluated with eq. (2.25) and all terms of eq. (2.33) respectively); and in blue, SpB + 8pS (evaluated with eq. (2.25) and all but the 1st, 2nd and 7th terms of eq. (2.33) respectively). The blue and black lines are indistinguishable.
The last trace of Figure 3.19 demonstrates that the sum of the individual contributions SpSyBBS and $pS,SBB carry practically all the information contained in the sum of all five contributions.
The main conclusion from this experiment is that the multiple-scattering contributions to the perturbed wavefield can carry important information on the perturbation of the background model. Therefore, it might be very helpful to include the singular-part information into the reference model, even for an inversion of the background model only.
3.3.4	Experiment 4: Perturbing the scatterers' position of Model II, forward decomposition
Here, in opposition to the previous experiment, we kept the background of Model II unchanged and perturbed the singular part by randomly dislocating the scatterers up to 6 m in both the vertical and horizontal directions. Figure 3.20 shows the normalised values of the medium perturbations, where a value of -1 indicates the strongest reduction in velocity and +1 the strongest increase. In other words, in this experiment we have 8KB = 0 and 8KS = 0.
According to equation (2.44), this yields a perturbation only of the singular wavefield as
3pB		0
8ps		. fej' S SKs -
with j = BSB, BS S, SSB, and SS S. These individual contributions correspond to the cartoons in Figures 2.4j to 2.4m. Source and control receivers for the single-shot modelling are in the same position as in the constant background perturbation experiment (black star and triangles in
Figure 3.19: Experiment 3. Multiple-scattering contributions (blue lines), from top to bottom: Sps,bbs, $Ps,SBB and $Ps,sbs. These are the terms that carry most of the energy of the singular residual 8pS. In the last trace we can see the summation of the first two traces depicted above (dark green line) and the 8pS evaluated with all five contributions (BBB, SBB, SBS, BBS and —BLB). In all figures, 8pSue is depicted in red lines for comparison.
Figure 3.2). In this experiment we analyse the wavefield residuals at cr154.
Figure 3.21 compares the decomposed singular-wavefield residual 8pS (blue line) to its undecomposed counterpart 8p = 8pS (black line) and to the true residual 8pSue (red line) calculated by the difference of the wavefields in the perturbed and unperturbed models. Since in Experiment 4
x (m)
Figure 3.20: Experiments 4 and 5. Only the singular part of the model is perturbed, i.e., 8KS = 0. This is achieved by modifying the vertical and horizontal coordinates of the scatterers randomly within a given range. The cool (blue) spots show the unperturbed positions, while the hot (red) ones tell us the new positions. The intensity of the spots is related to the magnitude of the perturbation. The green background corresponds to no perturbation.
-0.4
-0.2
-0.0
- -0.2
- -0.4
i—0.6
-0.8
-1.0
the total model perturbation 8K is equal to the singular-part perturbation 8KS, we have 8pB = 0 and, therefore, the true total residual Jptrue equals the true singular residual Jp^. The good match between JpS and JpSu indicates that the Born approximation is valid in this situation, as expected.
In Figure 3.22, we see all four terms that contribute to JpS at cr154. As we can see, in terms of energy, all of them are of the same order, JpS,SSS being a little weaker than the other three. None of the contribution cancels another one, and their sum yields a good match with the true singular residual (Figure 3.21, blue line). The individual best match is doubtlessly achieved by the singlescattering term 8pS,BSB (Figure 3.22, top), but the importance of the other terms to improve the match with the true residual is visible.
Figure 3.21: Experiment 4. Traces evaluated at cr154. Total residual, bp, given by equation (2.14), in black, and singular-wavefield residual, bps, equation (2.32), in blue, match almost perfectly. Good match between linearised and true residual, bps (in blue) and bp1™ (in red) indicates the good quality of the Born approximation in this case, which is a consequence of the small perturbations in the model.
3.3.5	Experiment 5: Perturbing the scatterers’ position of Model II, backprojecting residuals
In this experiment, using the same unperturbed and perturbed models of the previous experiment, we estimate the total model perturbation K which, as mentioned before, is equal to the singular-part perturbation bKs. Therefore, we have bpB = 0 and the true total residual bptrue equals the true singular residual ptsrue. Thus, this is the residual we need to backproject in this experiment. We simulated 44 shots and recorded the wavefields at a receiver array surrounding the scatterers (white stars and triangles in Figure 3.2 respectively). According to eq. (3.7), the bulk-modulus estimates are then given by
KBest		' Ei uB/pT '
Ksest		. E, uI,, ip&lt;s“ .
(3.14)
where the summation indices i and j take the values explained in connection with equation (3.7).
Figure 3.23 compares bKss to the bulk-modulus perturbation estimate bKest obtained with the undecomposed approach using the first equation of (2.49). As expected, the summation of the four terms yielding Ksest (Figure 3.23, bottom) almost exactly leads to the same result as the total bulkmodulus perturbation estimate, bKest (Figure 3.23, top). This indicates that the decomposition was successful in the sense that the summation of all components recovers the complete estimate. This
Figure 3.22: Experiment 4. All four terms that contribute to the total singular residual at cr154. From top to bottom: Sps,bsb, &amp;amp;Ps,ssb, &amp;amp;Ps,bss, &amp;amp;Ps,sss. The single-scattering term, Sps,bsb, accounts for almost all of the complete singular residual.
was expected since SpB = 0 which, from eq. (3.11), yields
But when we compare SKS (Figure 3.23, bottom) with the true perturbation SKS (Figure 3.20)
-0.6
-0.4
-0.2
-0.0
- -0.2
-	-0.4
-	-0.6
-0.6
-0.4
-0.2
-0.0
- -0.2
-	-0.4
—	0.6
Figure 3.23: Experiment 5. Backprojecting the total (singular) wavefield residual, Sptrue = SpSue. Cartoons indicate the (sub)kernels used. Top: Bulk modulus perturbation estimate, SKest, obtained with the first equation of (2.49). Bottom: Singular part of bulk modulus perturbation estimate, 6KSst, obtained with the second equation of (3.14). Colour scale clipped at 0.6 for better comparison.
we see that the estimate is somewhat far from the true perturbation.
To better understand this issue, we must inspect each contribution separately. Figure 3.24 displays all four of them. Comparing SKgBB with 6KS (Figure 3.20), we see that the single- scattering contribution alone gives a better perturbation estimate. In Figure 3.25, top, we can see the the estimate SK^ which is traditionally used when performing conjugate gradient FWI. Comparing this estimate with the single-scattering contribution SKS^BB (displayed also in Figure 3.25, top, for better comparison) we can observe that the former gives an even better image when compared
x (m)
0	200	400	600	800	1000	1200
x (m)
x (m)
0	200	400	600	800	1000	1200
x (m)
0	200	400	600	800	1000	1200
Figure 3.24: Experiment 5. Each one of the contributions to the singular perturbation estimate. From top to bottom: 'KSS,bs ,	B, 'KSsSS and 'KSS,sb .
0.6
0.4
0.2
0.0
-0.2
-0.4
— 0.6
0.6
0.4
0.2
0.0
-0.2
-0.4
— 0.6
kJ at2	kJ at2	kJ di-
+ + +
x (m)
0.6
0.4
0.2
0.0
-0.2
-0.4
— 0.6
Figure 3.25: Experiment 5. Top: Singular part of Bulk modulus estimate, SKfsBB, obtained with the single-scattering related kernel.Center: Conventional Bulk modulus estimate, SK^, obtained with the background-wavefield related kernel. Note that these estimates are very similar to the true perturbation observed in Figure 3.20, the convetional one being a little better. Bottom: Background bulk-modulus estimate, SKBst, obtained with first equation of (3.14) (residual leakage). Colour scale clipped at 0.6 for better comparison.
with the true perturbation JKS (Figure 3.20). This is not by chance. Many works (Mora, 1987, 1988; Jannane et al., 1989; Pratt, 1999) show that reflection data are able to properly resolve only the high frequency information of the model with the single- scattering term. Results like this one motivate the conventional choice of letting the background medium alone represent the reference medium. Its high quality is expected for this example, because the assumption that the background medium is fully known and all perturbations only affect the singular part, is exactly satisfied.
Finally note that in this experiment, only JKSst should be non-zero. However, we see from eq. (3.14) that JKBst look quite similar to JKSst. Numerical evaluation confirms that 8KBl is indeed non-zero, too (see Figure 3.25b). This is a consequence of residual information leakage since JpS is generated by a singular-part perturbation only. Surprisingly, this estimate is way more focussed and clean from artefacts than all the other estimates, although its polarity is reversed.
Residual leakage occurs because the inversion uses the adjoint operation instead of the inverse. In the estimate of JKB, the dominant contributions are JKBstBB (Figure 3.25, top) and 8KBt_BLB. They are constructed with background wavefields both in the source- and receiver-sides. These contributions cancel each other except at scatterer positions, because in the former the scale factor of the backscattering mechanism is — and in the latter —. Since in our example K0 &gt; KB, the estimate values in 8KB_bcb are boosted at the scatterer positions which explains the polarity and apparent focussing of the leakage estimate.What we actually see is basically the modified scattering potential WK (see Appendix D).
3.3.6	Experiment 6: Lens-shaped background perturbation of Model III, forward decomposition
For the next two experiments we kept the singular part unperturbed and introduced a spatially limited (lens-shaped), relatively strong background perturbation, as shown in Figure 3.26. Again, we have perturbations in both the background and singular wavefields according to eq. (3.2). Source and control receiver distribution in this particularly experiment are the same used in Section 3.3.3.
We are going to analyse the response at both control receivers. Receiver cr154 records almost exclusively backscattered wavefields, because the Fresnel zone of the direct arrival does not cross the lens-shaped perturbation (we say this control receiver is in the backscattering domain). Conversely, receiver cr283 records transmitted and forward scattered energy (it is in the transmission domain).
x (m)
0	200	400	600	800	1000	1200
0
100
200
300
400
500
600
700
a;
L 4
- 2
- 0
Figure 3.26: Experiments 6 AND 7. Perturbation in the bulk-modulus background model, 8KB. The scalebar shows, in percentage, the perturbation magnitude.
1.0e-03
0.0e + 00 -1.0e-03
Figure 3.27: Experiment 6. Comparison between the total wavefield residual, 8p (black lines) and sum of background and singular residuals, SpB + 8pS (blue lines). Top: Evaluated at control receiver cr154. Bottom: Evaluated at control receiver cr283.
	cr154		cr283
Term	L2-norm (x 10-6)	Term	L2-norm (x10-5)
$Ps,sBB	339.28	$Ps,sbb	147.34
$Ps,BBs	262.27	$Ps,BBs	175.72
$Ps,sbs	214.88	8ps,sBs	100.91
$Ps,BBB	55.21	1 53 21	&amp;amp;Ps,-BLB	330.81	1 3870
8ps,-BCB	26.48 53.21	$Ps,BBB	294.00 38.70
Table 3.4: Experiment 6: L2-norm as a measure of energy at cr154 and cr283. The braces indicate summation of the related traces, the value attached to them being the energy of the resulting trace.
Figure 3.27 compares total linearised wavefield residual (black lines) with the sum of all nonzero contributions of its decomposed counterpart SpB + 8ps (blue lines) and the true residual 5ptrue (red lines) at control receivers cr154 and cr283. We see, at a first look, that at both control receivers the summation SpB + 8ps and the evaluated residual 8p match nicely; and both are a good approximation to the true residual. As expected at a receiver in the backscattering domain, the amplitudes of the first arrivals at cr154 are of the same order of magnitude as coda. On the other hand, at the transmission-domain receiver cr283 the first arrival is one order of magnitude greater then the coda.
To see if Experiment 6 confirms the results of Experiment 3, we compiled Table 3.4 with the wavefield energies for all contributions at both control receivers. As before, the negative interference of the single-scattering terms reduces their combined importance, leaving 8ps,sBB, $ps,BBs and Sps,sBs as the most important contributions. To be noted is the different importance of the single-scattering terms Sps,BBB and 8ps-BLB:
•	At cr154, where only scattering information due to perturbation reaches the receiver, they carry little energy. Moreover, their sum yields a value very close to the the energy carried by Sps,BBB alone. This means that the small energy carried by th contributions is related to the background residual; most of it is related to the interference term Sps,BWB (see also Figure 3.28).
•	At cr283, where transmitted energy is recorded, these are the most energetic terms. However, most of the energy, which is related to the background residual, cancels when these terms are summed, leaving only the part related to the interference term which is of the same order of magnitude as at cr154 (see also Figure 3.29).
1.0e-03
O.Oe + OO
-1.0e-03
0.00	0.10	0.20	0.30	0.40	0.50	0.60	0.70	0.80
Figure 3.28: Experiment 6. Single-scattering terms evaluated at control receiver cr154 (blue lines): bps,BBB (top), bpB,_BLB (centre), and their sum bps,BWB, compared to the true singularwavefield residual bp1™ (red lines). As expected, these terms are very small because the Fresnel zone of the direct wavefield does not intersect with the lens-shaped perturbed area. Compare with Figure 3.29.
In both cases, however, the combined term bps,BWB is a order of magnitude smaller than the most important terms 6ps,sBB and bps,BBs.
Figures 3.30 and 3.31 compare the most important multiple-scattering contributions bps,sBB, bps,BBs and bpssBs (blue lines) individually to bp1™ (red lines). We see that different parts of the trace are matched by different contributions. However, it is not possible to infer a general rule so as to which contribution will appear at which part of the trace. For instance, at cr154, the first part of the trace is well matched by 6ps,sBB; the central part by 6ps,BBs; and the coda by bps,sBs (see Figure 3.30). At cr283, different contributions match different parts (see Figure 3.31). The best guess is that the distribution is determined by the general disposition of the scatterers with
1.0e-02
O.Oe + OO
-1.0e-02
0.00	0.10	0.20	0.30	0.40	0.50	0.60	0.70	0.80
Figure 3.29: Experiment 6. Single-scattering terms evaluated at control receiver cr283 (blue lines): bpS,BBB (top), 8pSy-BLB (centre), and their sum bpSyBWB, compared to the true singularwavefield residual bpSue (red lines). Each of these terms carries much energy, but their sum contributes very little to the singular-wavefield residual. Compare with Figure 3.28.
respect to the sources and receivers. Due to its strong multiple-scattering nature, the contribution 8pSyBBS tends to determine the coda of the trace, while 6pSySBB or 8pSyBBS usually define earlier and stronger events.
3.3.7	Experiment 7: Lens-shaped background perturbation of Model III, backprojecting residuals
Here, we backproject the true background and singular residuals, bp^ and bptSue generated in the above forward decomposition experiment with a lens-shaped background perturbation only, i.e., 8K = 8Kb . As we will see, this perturbation yields the most significant result of our set of
0.00	0.10	0.20	0.30	0.40	0.50	0.60	0.70	0.80
Figure 3.30: Experiment 6. Terms with the most important contributions to the singular residual evaluated at cr154. From top to bottom: SpS,BBS, SpSySBB and SpStSBS.
experiments, namely that meaningful information on the background perturbation can be extracted from the singular-wavefield residual. The perturbation estimates are calculated with the help of equation (3.7).
Figure 3.32 displays, from top to bottom: the total perturbation estimate, SKest of equation (2.49); the two contributions, SKBsB and SKBsS of equation (3.7); and finally their sum. The first thing to be noted is that the sum SKBstB + SKBstS does not resembles the total perturbation estimate SKest. This means that the cross-term contributions SKjsB) (first sum of the right hand-side of eq. (3.11)) are not negligible. In Figure 3.33 we can see the sum of these cross-terms and how, when taken into account, they lead to the exact total perturbation estimate SKest.
Secondly, we see in Figure 3.32 that both SKB1b and SKBstS fairly account for the true perturbation SKb. Doubtless, the estimate SKB1b from the background residual (second estimate of Figure 3.32) is the one that best represents the true medium perturbation. The inversion done in
	1	Wr/\		 -
	
-1.0e-02-
Figure 3.31: Experiment 6. Terms with the most important contributions to the singular residual evaluated at cr283. From top to bottom: $pS,BBS, $Ps,sbb and $Ps,sbs.
this case is basically a transmission waveform tomography, which is known to recover very well the low-frequency information, specially when the target region is enclosed by both, sources and receivers (see, e.g., Pratt and Shipp, 1999; Brenders and Pratt, 2007).
But the really important feature here is that a reasonable background perturbation estimate SKBlS (Figure 3.32, bottom), even better that the total perturbation estimate 8Kest, can be obtained from singular-wavefield residuals. When transmission tomography fails (surface acquisition, for example) the background estimate obtained with the singular residual stands as a possible option (see also Experiment 8, Section 3.3.8).
The most significant contributions to 8KeBsS are 8KBsBS and 8KeBsSB, displayed in Figure 3.34. Note that, except for the boundary regions close to sources and receivers, the terms 8KBsBS and SKB1sb give practically the same estimate. None of the other contributions alone provides an image of similar quality.
x (m)
0	200	400	600	800	1000	1200
1.0
0.8
0.6
0.4
0.2
0.0
-0.2
-0.4
-0.6
-0.8
-1.0
x (m)
0	200	400	600	800	1000	1200
x (m)
Figure 3.32: Experiment 7. Backprojecting residuals. From top to bottom: Bulk modulus perturbation estimate, JKest, from the total wavefield residual, Jptrue (equation (2.49)); Background bulk-modulus perturbation estimate, JK^B, from background residual, JpBue (first contribution in first equation of (3.7)); Background bulk-modulus perturbation estimate,	, from singular
residual, JpSue (second contribution in first equation of (3.7)); and the sum
x (m)
x (m)
0	200	400	600	800	1000	1200
x (m)
0	200	400	600	800	1000	1200
1.0
0.8
0.6
0.4
0.2
0.0
-0.2
-0.4
-0.6
-0.8
-1.0
1.0
0.8
0.6
0.4
0.2
0.0
-0.2
-0.4
-0.6
-0.8
-1.0
1.0
0.8
0.6
0.4
0.2
0.0
-0.2
-0.4
-0.6
-0.8
-1.0
x (m)
0	200	400	600	800	1000	1200
1.0
0.8
0.6
0.4
0.2
0.0
-0.2
-0.4
-0.6
-0.8
-1.0
Figure 3.33: Experiment 7. Backprojecting residuals. Estimates related to eq. (3.11). From top
est	est
to bottom:^ 5Kj(b) = j USyj Spb^2, 5KByj = j Us, 6pS and their sum. The last is the total perturbation estimate 6Kest, put here for comparison.
x (m)
0	200	400	600	800	1000	1200
p 1.0
-0.8
-0.6
-0.4
-0.2
-0.0
--0.2
-	-0.4
-	-0.6
- -0.8
--1.0
p 1.0
-0.8
-0.6
-0.4
-0.2
-0.0
- -0.2
-	-0.4
-	-0.6
--0.8
--1.0
Figure 3.34: Experiment 7. Backprojecting singular-wavefield residual SpSue. Top: Subkernel UB,BS used for backprojection. Bottom: Subkernel UB,SB used for backprojection. Note the very strong similarity between both estimates apart from the region delimited by the receiver and source lines. It suggests a redundancy that might be explored.
The congruence of the two estimates in Figure 3.34 is a consequence of both the sources and receivers completely enclosing the target region. For a single source-receiver pair, these two contributions are actually complementary (see Figure 3.35). The source where the direct wavefield originates from is marked with a star. The receiver where the residual is observed and backprop-agated from is cr283, marked by the triangle in the bottom right corner. In Figure 3.35, top, subkernel UB,BS is used to backproject residuals and the singularities can be seen as acting as receivers, i.e., the residuals seem to be backpropagated from there. On the other hand, in Figure 3.35, bottom, subkernel UB,SB is used. There, the singularities act as sources, i.e., the wavefields seem
e
x (m)
0	200	400	600	800	1000	1200
0
100
200
300
400
500
600
700
i0.5
0.4
0.3
-0.2
-0.1
-0.0
--0.1
[-0.2
-0.3
-0.4
-0.5
x (m)

0.5
0.4
0.3
0.2
-0.1
-0.0
--0.1
i-0.2
-0.3
-0.4
-0.5
Figure 3.35: Experiment 7. Backprojecting singular- wavefield residual 5pSue recorded at cr283 from the source at 1000 m (black star). Top: Subkernel UB,BS used for backprojection. The singularities act as receivers. Bottom: Subkernel UB,SB used for backprojection. Here, the singularities act as sources. This gives us further insight into the congruence of the parts of Figure 3.34.
to originate from there. Full coverage of sources and receivers around the area of interest and the proximity among them complete the congruence of the estimates shown in Figure 3.34. This analysis indicates that surrounding the target area partly with sources and partly with receivers might be sufficient to recover the perturbations.
3.3.8	Experiment 8: Lens-shaped background perturbation of Model IV, backprojecting residuals
In this last example we restrict our analysis to the backprojection problem, for the results of the forward decomposition problem resemble the ones obtained for cr154 as reported in the forward decomposition experiment of the Section 3.3.6 (full acquisition geometry). In this experiment, we restrict the acquisition geometry to investigate the role it plays in the inverse problem.
The next experiment uses the same perturbation as Experiments 6 and 7, i.e., lens-shaped background perturbation (see Figure 3.26) and the unperturbed Model IV.
Experiment 8: backprojecting Residuals. Figure 3.36 shows the backprojection results together with the acquisition geometry. Source and receivers are marked as white stars and triangles, respectively. From top to bottom, the parts show the undecomposed result 8Kest from backprojecting the total residual in the reference model, the estimate SKeBtB obtained using only the backgroundwavefield residual, and the estimate SKeBtS using only the singular-wavefield residual.
The restriction of the acquisition geometry strongly affects the estimate from the total residual, 8Kest (Figure 3.36, top), which is not as good as the one in Figure 3.32. But it is still better than the estimate SKeBtB from the background residual (Figure 3.36, centre) which fails completely. The reason is that this estimate is based on transmission waveform tomography, where only residuals of wavefields that originate at one far side and were recorded at the other far side contribute to the estimate. In other words, in this acquisition geometry, there is not enough far offset for the background residual to yield a good estimate. This is frequently the case in conventional practical inversions that operate with a smooth reference model only. Note, however, that estimate SKBlS (Figure 3.36, bottom) from the singular residual provides much better quality even from this geometry with rather short offsets when compared to 5Kest. The difference between them is not explained by the cross-terms 8KesB) as seen in the previous experiment. Actually, both j	&amp;amp;PB (Figure 3.37) and SKB^ (Figure 3.36, centre) contribute almost
nothing to 8Kest and 5KBst respectively (see eqs. (3.11) and (3.12)). The contribution that make them differ is 8KB1_blb (see Figure 3.38).
In the same way as in the last experiment, we inspect the contributions 8KBtBS and SKBBsb (Figure 3.39). Although at first sight, they are rather similar to each other, there are some small but visible differences. They do not resemble each other as closely as the corresponding results in Figure 3.34 for Experiment 2, because the spatial coverage of the sources differs slightly from that
x (m)
0	200	400	600	800	1000	1200
p 1.0
-0.8
-0.6
-0.4
-0.2
-0.0
- -0.2
-	-0.4
-	-0.6
--0.8
--1.0
p 1.0
-0.8
-0.6
-0.4
-0.2
-0.0
--0.2
--0.4
--0.6
- -0.8
--1.0
Figure 3.36: Experiment 8. Backprojecting residuals from “surface” receivers. Top: Bulkmodulus perturbation estimate 5Kest from total wavefield residual 5ptrue, Center: Bulk-modulus perturbation estimate 6KBtB from background residual 5pBue, Bottom: Bulk-modulus perturbation estimate 6KB\s from singular residual 5p*ue.
p 1.0
-0.8
-0.6
-0.4
-0.2
-0.0
--0.2
-	-0.4
-	-0.6
- -0.8
--1.0
Figure 3.37: Experiment 8. Cross-term estimate resulting from the sum (US,j) SpB.
x (m.)
0	200	400	600	800	1000	1200
Figure 3.38: Experiment 8. Single-scattering contribution 5KBB_bcb
of the receivers.
However, as before, the contributions tiKB^ and SKB^B provide the best image of a single contribution, the last being the best one (see Figure 3.39, top and centre top). We compare this contribution to the single-scattering contribution, 6KB1jBB (see Figure 3.39, centre bottom). This latter contribution is comparable to the result of the conventional approach (see Figure 3.39, bottom), where the complete true residual 6p is backpropagated with a Green’s function of a smooth background initial model.
It is worthwhile to observe that Experiment 8 is an example where conventional inversion pro-
K2 dt2
X (ill)
0	200	400	600	800	1000	1200
x (m)
0	200	400	600	800	1000	1200
x (m)
0	200	400	600	800	1000	1200
x (m)
0	200	400	600	800	1000	1200
Figure 3.39: Experiment 8. Bulk-modulus perturbation estimates. From top to Bottom: SK^Bs, SKBssB, SKBbb and conventional estimate SKfonv (backpropagation of complete residual Sp with only background model).
duces a fast-varying sensitivity kernel in the sense of Zhu et al. (2009). This happens because the conventional approach is based on the assumption that the background is known and all perturbations happen in the scatterers. Thus, the inversion tries to blame the scatterers for all necessary model updates, even if, as in this example, the error is in the background model.
According to Zhu’s work, when dealing with reflection/scattered data, the occurrence of fastvarying sensitivity kernels is more frequent for narrower offsets (or reflection angles), while slowly-varying ones are more often observed in large-offset acquisitions. This is consistent with the results of our numerical experiments. Fast-varying sensitivity kernels cause slower convergence of the inversion procedure.
Why the multiple-scattering contribution SKeBtSB (Figure 3.39, centre top) based in a surface acquisition of reflection/scattered data is smoother and closer to the undecomposed estimate 8Kest when compared to the conventional estimate (Figure 3.39, bottom)? This is an important observation, because it derives from the very purpose of the decomposition presented we mention before: the singular wavefield when properly handled can provide information on background perturbations. The singular wavefield origins at the singular component of the medium which acts as sources enhancing the illumination of the perturbation. in other words, this experiment allows to conclude that a medium can “illuminate” itself by means of scatterers, so that the need for long offsets is reduced.
Figure 3.40 shows the contributions from a single pair source-receiver (black star and triangle) of the same estimates seen in Figure 3.39. The self-illumination of the medium can be clearly seen when we compare the conventional estimate (Figure 3.40, top) with the other three estimates. While the perturbation estimates are distributed symmetrically around the Fresnel zone of the direct source-to-receiver wavefield, in the other images the estimate perturbations are placed in the scattering area preferably over the perturbed area.
K2 dt2
K2 dt2
0
100
200
—	300
E
n 400
500
600
700
0
100
200
—	300
n 400
500
600
700
0
100
200 -300 n 400
500
600
700
0
100
200
—	300
E
n 400
500
600
700
x (m)
0	200	400	600	800	1000	1200
0	200	400
x (m)
600 800 1000 1200
x (m)
0	200	400	600	800	1000	1200
Figure 3.40: Experiment 8. From top to bottom: Single pair source-receiver contributions to conventional estimate bK^, b KB\Bs, b KB\sB, and bKBstBB.
4.	Application: Scattering-based Sensitivity Kernels for Time-lapse Differential Waveform Inversion
Over the past few years, time-lapse seismic surveys have become a powerful tool used to monitor the fluid-flow in a producing reservoir. Generally speaking, such a survey consists in acquiring and analysing multiple seismic data, repeated at the same site over time in order to look for differences from which one can infer the changes in the reservoir due to production. This is possible because, as fluid saturations and pressures in the reservoir change, the seismic reflection properties change accordingly.
A seismic image contains information on reflections that depends on both the geological structure and its fluid contents. On single-time images these contributions are coupled and difficult to separate. The basic approach in time-lapse surveys is to image the changes in the reservoir by subtracting subsequent time-lapse seismic images of the reservoir from one another. Assuming that geology is time-invariant during production and that repeatability in the seismic data acquisition is, in some way, assured, the image difference from a time-lapse survey would indicate the changes due only to the fluid-flow since, to first order, the geology part subtracts out since it is time invariant (Lumley, 2001).
Recently, full waveform inversion (FWI) has been used as an alternative time-lapse monitoring tool (Queifler and Singh, 2013; Yang et al., 2011; Zheng et al., 2011). FWI allows the reconstruction of high-resolution velocity models of the subsurface through the extraction of the full information content of seismic data (Tarantola, 1984a; Virieux and Operto, 2009). Since the FWI approach delivers high resolution quantitative images of the macro-scale physical parameter, it ought to be a good candidate for monitoring applications to reconstruct the parameter variation through time evolution (Asnaashari et al., 2012).
Asnaashari et al. (2012) studied the robustness of three different FWI methods applied to time-lapse problems: differential method, parallel difference method and the sequential difference method. In the differential method, instead of minimising the difference between the observed and modelled data, the difference of the data between two sets of data is minimised to obtain the time-lapse change estimate (Watanabe et al., 2004). The parallel difference method considers independent inversion of two subsequent data sets, the so called baseline and monitor data-sets, using a similar starting model (Plessix et al., 2010). The sequential difference method uses the recovered baseline model as a starting model for the monitor data inversion.
In this Chapter we apply our scattering-based decomposition to the time-lapse problem, considering the time-lapse change as a perturbation of the singular part of the model, i.e., perturbation of the scattering potential. Under the differential-method framework, we demonstrate that the scattering-based decomposition of the sensitivity kernels allows to take advantage of the illumination of the time-lapse change due to multiple-scattering phenomena in order to improve the perturbation estimates from FWI.
4.1	Time-lapse survey as a FWI scattering problem
To apply the decomposition theory developed in this thesis to a time-lapse survey, we think of the baseline model as decomposed into a background and a singular part. We consider both parts of the baseline model as known. The background part could be, for instance, the best smooth velocity model from a conventional inversion technique, and the singular part could be determined by the reflector positions in the corresponding migrated image. Then, the time-lapse changes can be considered as (unknown) perturbations to the singular and/or background parts.
The situation is the simplest, if we consider the time-lapse change as a perturbation of the singular part only. According to equation (2.44), the data difference between baseline and monitor is then the singular-wavefield residual, i.e., Jp = JpS. It means that the data residual Jptrue from the difference between the baseline and monitor surveys is going to be backprojected as JpSe according to eq. (3.7), that is, the model perturbation estimates are
JKS" = £ JKSj = £ USj SpT,	(4.1)
j	j
where j takes the values explained in connection with eq. (3.7).
600-
700-
800-.
(1500
2000
-2500
-3000
-3500
1-4000
600-
700-
800-1
(1500
2000
-2500
-3000
-3500
1-4000
(a) B1
600-
700-
800-.
(1500
2000
-2500
-3000
-3500
1-4000
(b) B2
600-
700-
800-1
(1500
2000
-2500
-3000
-3500
1-4000
(c) Ml
(d) M2
Figure 4.1: Center parts of the baseline (a and b) and monitor (c and d) models for Model Sets 1 (a and c) and 2 (b and d).
4.2	Numerical experiments
To test our approach, we have set up four synthetic time-lapse experiments with simple layered models. These experiments used two sets of baseline and monitor models named as Set 1 (Figures 4.1a and 4.1c, respectively) and Set 2 (Figures 4.1b and 4.1d, respectively) and two types of acquisition geometry. The two baseline models are identical except for the velocity contrast at the deepest interface. in the first model, this interface is a weak reflector and in the second model, a strong one. The monitor models differ from the baseline models in both sets by a 5% velocity perturbation in a rectangular lens of 400 m width within the 4th layer. The density was considered constant in all models (2200 kg/m3). We used two passes of a 20-point triangular moving-average filter on the bulk-modulus baseline models to create the corresponding background models. The singular models are the differences between the complete and background models. For each model
set we performed two experiments with different acquisition geometry at the surface: long and narrow offsets.
In this study we consider both the background and singular parts of the baseline velocity model as fully known.
The numerical experiments consisted of the following basic steps:
1.	Simulation of the seismic acquisition by modelling the wavefields in the baseline and monitor models. We used the same modeller as in the numerical experiments of the previous chapter. In the simulations the vertical grid spacing was 2 m, the horizontal grid spacing was 4 m, and the time-marching step 0.2 ms. The recorded wavefields were then resampled to a 6 ms interval.
2.	Computation of the true singular-wavefield residual, which in this case is identical to the true full-wavefield residual, i.e., the difference between the wavefields in the monitor and baseline models.
3.	Modelling the wavefield in the smooth background model.
4.	Computation of the baseline singular wavefield, i.e., the difference between the wavefields in the baseline and background models.
5.	Backpropagation of the true singular-wavefield residual using the receiver-side reference and singular wavefields.
6.	Determination of the four contributions to equation (4.1) by crosscorrelation of the back-propagated wavefield residual with the source-side reference and singular wavefields as exemplified in equation (2.51).
7.	Stack of the resulting contributions over sources and receivers.
As in Chapter 3, we normalised the total bulk-modulus perturbations estimates to their maximum absolute value. Other estimates, as also individual contributions, are depicted using the same scale factor.
4.2.1	Large offset surveys
The first acquisition geometry consisted of 87 shot gather with 726 receivers each, placed at 10 m depth, spaced at 4 m, and covering the distance between 0 m and 2900 m. Sources were placed at 40 m depth spaced at 32 m, and covering the distance between 80 m and 2832 m earth’s
x (m)
500	1000	1500	2000	2500
(a) SKf
1.0
0.5
0.0
-0.5
-1.0
o
100
200 _ 300
400
N 500
600
700
800
x (m)
500	1000	1500	2000	2500
(b) iK«
Figure 4.2: Set 1 - large offset. Estimates for bulk-modulus perturbation in the absence of a strong reflector. (a) Singular part estimate according to equation (4.1); (b) Conventional perturbation estimate using wave propagation in the background model. The last is substantially close to contribution SKesstBB (see Figure 4.4c, right). Both figures are normalised to their common maximum for comparison
surface. In other words, the survey was positioned almost symmetrically over the rectangular perturbation, centred at 1500 m. Figure 4.2 indicates the source positions by white stars and every 10th receiver position by a downward-pointing triangle.
Set1
In Figure 4.2a, we show the estimate for the singular-part bulk-modulus perturbation in Model Set 1 with all four contributions according to equation (4.1). For comparison, Figure 4.2b shows the corresponding estimate from the conventional approach as in eq. (3.8), i.e., the result that would be obtained from inversion with a smoothed background model. In Figure 4.2 both estimates are normalised to the same factor which is the maximum value of 8Kest. We see, then, that the
K2b dt2
(a) SKe?
x (m)
o 0	500	1000	1500	2000	2500
(b) SKest
conv
Figure 4.3: SET 1 - LARGE OFFSET. The same estimates seen in Figure 4.2 (¿KeSst and ¿K^v) but now each one is normalised to their own maximum.
amplitude the perturbation estimates in ¿K^ are smaller giving the impression that the artefacts there are weaker.
We see that in the absence of a strong reflector in the bottom of the model, the conventional sensitivity kernel gives a satisfactory estimate. One can also argue that it is even better to the one from the summed contributions. This last one has the time-lapse change better delineated but shows artefacts (“wings”) connecting the acquisition surface to the time-lapse change.
However when we inspect Figure 4.3 we see that the artefacts are equivalent in both conventional and singular part estimates. But in Figure 4.3 we depicted the very same estimates, each one now normalised to their own maximum. In this way, we can see that, proportionally, they are equivalent.
Aside the artefacts (we discuss the futher in the text) we can compare the estimates depicted in Figure 4.3. Definitely, ¿KeSst is better than ¿K^: the perturbation is better delineated, specially at its top, where the conventional one has an non-desired oscillatory behaviour. As a matter of
x (m)
0
1.0	0-
-0.5	200-
-0.0	5 400-
	N
--0.5	600-
--1.0	800-
x (m)
0	500	1000	1500	2000	2500
0.5
-0.0
t—0.5
-1.0
5 400
N
600
200
800
0	500	1000	1500	2000	2500
1.0	0-
-0.5	200-
-0.0	5 400-
	N
--0.5	600-
--1.0	800-
(b) SKSBb
x (m)
0	500	1000	1500	2000	2500
	Oil1'"'	
	—	
0.5
-0.0
t—0.5
-1.0
(c) 6K^bs
(d) SKSbb + SK^bs
0
200
400
600
800
6,
N
(e) SKSsSb
x (m)
0	500	1000	1500	2000	2500
r 1.0	0-
-0.5	200-
-0.0	5 400-
	N
--0.5	600-
--1.0	800-
(f) SKSbb + SKSbs + SKSSb
X (m)
0	500	1000	1500	2000	2500
r°
-0.5
-0.0
t—0.5
-1.0
I
I
(g)
(h) sksBb + sksbs + skssSb + sks?ss
Figure 4.4: Set 1 - large offset. Individual contributions to SKSSs are shown in the left column. In the right column we see the results of succesively summing up the contributions. Thus, the last one is the result of summing up all four contributions.
fact, the combination of two individual contributions,	and ÓKSbb (Figure 4.4c, left) gives,
we believe, the best estimate. SK^bb gives nice estimate of perturbation (format of the retangle correctly recovered) and SKesstBS delineates top and bottom, consistent of being a scattering contribution.
The artefacts in both estimates shown in Figure 4.3 are very similar. The actual difference is that in 5KeSst the artefacts show abrupt amplitude changes while in ¿KS^v they are smoother. This is easily explained by the weighting factors of the scattering operator:	and • Let us compare
the estimates ÓK&lt;e&lt;|tiv (Figure 4.2b) and SKeSstBB (Figure 4.4a). The only difference between them is the different factor used. Comparing the two estimates we can see the imprint of the ¡ in SKeSsBB. As expected, the intensity of the artefacts decreases as we go deeper because the factors get smaller. The factor decreases in a smooth fashion, while contains the full layer information. Note that their magnitude are comparable.
These artefacts are also present in the other contributions. In Figure 4.4 we see each of the individual contributions (left column) and the results of successively adding them up (right column). We can see that these artefacts are comparable in SKeSstBS and óKSSSb (Figures 4.4c and 4.4e) as in the single scattering contribution.
The cause of the artefacts is the uneven illumination due to the combination of surface acquisition and a horizontally stratified medium. In Figure 4.5 we can see the norm of the residual (as a measure of the energy) at the receivers as a function of shots. As expected, due to horizontal stratification of the medium, for shots at the left side of the model (around shot number 20) the most energetic residuals are recorded between 2000 and 2500 m. In the reverse case, most energetic residuals are recorded between 500 and 1000 m. These two ranges are the exact location of the artefacts.
Set 2
The corresponding results for Model Set 2 with the strong bottom reflector are depicted in Figure 4.6. While the estimate from all contributions (Figure 4.6a) together looks similar to the one in Figure 4.2a, the conventional estimate is visibly different (compare Figure 4.2b and 4.6b), indicating that in this situation, the use of a smooth background model to simulate the backpropagation is insufficient. We conclude that in this case, multiple-scattering contributions carry important information that cannot be neglected. We may think of the scatterers contributing to the inversion by back-illumination. There are two overlapping V-shaped features (see Figure 4.6c) with negative
x (m)
Figure 4.5: Set 1 - large offset. Top: the norm of the residual (as a measure of the energy) at the receivers (horizontal axis) as a function of shots (vertical axis). Bottom: Result of stacking (integrating) the above function over sources. The energy of the residuals concentrate between 500 to 1000 m and 2000 to 2500 m.
amplitude superimposed in the figure. These features are due to the background wavefield trying to deal with the inverted-phase residual due to the deep reflection at the strong reflector. Since reflections are not accounted for in the smooth background model, they appear in the wrong place, with the wrong sign. Note that they coincide nicely with the ray paths of the main primary reflections (see Figure 4.6c).
These features are also present in the background contribution bKSstBB (see Figure 4.7a) which is also single-scattering based. But the multiple-scattered based contributions (see Figures 4.7c, 4.7e and 4.7g) correct this problem. For in the same regions they show positive values which cancel out the negative parts of bKeSstBB. This become evident when we inspect the right column of Figure 4.7 and see the effect of successive addition.
Here, even more than the previous example, the estimate resulting from the sum of bKSsBB and bKS,BS seems to give the best estimate as we can verify in Figure 4.7d.
The artefacts are present in the estimates as before. In Figure 4.6a we can see that the width of each wing of the artefact is larger then the previous example. However, the cause is still the same. In Figure 4.8, the perturbation illumination is increased with the aid of the strong bottom reflector
200
300
400
500
600
700
800
x (m)
0	500	1000	1500	2000	2500
p 1.0
-0.5
-0.0
[—0.5
-1.0
(a) SKf
1 000
2000	2500
(b) 6Kcst
conv
X (m
1.0
0.5
0.0
-0.5
-1.0
0	500	1000	1500	2000	2500
0
100
200
_ 300
M 400
N 500
600
700
800
p 1.0
-0.5
-0.0
1—0.5
-1.0
I
(c) ¿Kcolnv with reflection ray paths
Figure 4.6: Set 2 - large offset. Estimates for bulk-modulus perturbation in the presence of a strong reflector. (a) Singular part estimate according to equation (4.1); (b) Conventional perturbation estimate using wave propagation in the background model. The last is substantially close to contribution SKSstBB (see Figure 4.7c, right); (c) Same as before, but with dashed ray paths indicating the back-illumination from the strong reflector.
x (m)
0	500	1000	1500	2000	2500
					x (mJ	
1.0			0	500	1000	1500	2000	2500	10
							
0.5		200-				|-0.5
0.0		400-				-0.0
	N					
-0.5		600-				r~0-5
-1.0		800-				^-1.0
(a) SK$BB
(b) ix$BB
x (m)
0	500	1000	1500	2000	2500
aoo
0
200
600
5 400
N
x (m)
0	500	1000	1500	2000	2500
.0
-0.5
-0.0
t-0.5
-1.0
(d) SK’SBb + SK’SBs
5 400
600
0
200
800
(c) iK$Bs
x (m)
0	500	1000	1500	2000	2500
1.0
0.5
-0.0
-0.5
-1.0
x (m)
0	500	1000	1500	2000	2500
0
200
5 400
N
600
800
.0
-0.5
-0.0
t-0.5
-1.0
(e) ¿KSsSb
x (m)
0	500	1000	1500	2000	2500
	On				1 Jio		0-
	200-	-0.5		200-
			n	
	400-	-0.0		400-
N			N	
	600-	L—0.5		600-
	800-		 ■- - 1.0		800-
(f) IK^Bb + sksbs + SKSSSb
x (m)
0	500	1000	1500	2000	2500
-0.0
—- 1.0
-0.5
t-0.5
-1.0
0
n
u
(g) SKSSs
(h) SKSBb + SKSBs + SKSSb + SKSSs
Figure 4.7: Set 1 - large offset. Individual contributions to SKf1 are shown in the left column. In the right column the result of summing up the current contribution with all the previous ones. which makes, for instance, the first estimate in the left to be no more than 6KsstBs; on its turn, the last one is the result of summing up all four contributions.
x (m)
Figure 4.8: Set 2 - large offset. Top: the norm of the residual (as a measure of the energy) at the receivers (horizontal axis) as a function of shots (vertical axis). Bottom: Result of stacking (integrating) the above function over sources.
indicated by the enlargement of the “bright spots” in the graphic.
4.2.2	Narrow offset surveys
It is known in the literature on FWI that the acquisition geometry has a strong influence on the inversion result. When inversion is done with enclosing source and receiver arrays, it behaves as in transmission tomography, which is known to recover very well the low-frequency information (see, e.g., Pratt and Shipp, 1999; Brenders and Pratt, 2007). On the other hand, according to Zhu et al. (2009), when dealing with reflection/scattered data, narrower offsets (or reflection angles) may lead to fast-varying sensitivity kernels, in opposition to slow-varying ones in large-offset acquisitions. Fast-varying sensitivity kernels cause slower convergence of the inversion procedure.
To investigate this effect in the case of the decomposed inversion, we repeated the above experiments with a shorter survey. The new acquisition geometry consisted of 48 shot gathers with 251 receivers each, and covering the distance between 0 m and 1000 m. Sources were spaced at 20 m and covering the distance between 48 m and 948 m earth’s surface, Thus, the survey was positioned almost symmetrically over the rectangular perturbation, now centred at 500 m. All other
x (m)
(a) SKf
500
x (m)
200	400	600	800	1000
(b) JKest
Figure 4.9: Set 1 - narrow offset. Narrow-offset estimates of the perturbation in the absence of a strong reflector. (a) Singular estimate with all contributions; (b) conventional estimate.
parameters were the same as in the first survey. Figure 4.9 indicates the source positions by white stars and every 10th receiver position by a downward-pointing triangle.
Figure 4.9 shows the resulting perturbation estimates for the model with the weak bottom reflector. To avoid problems with inversion near the sources we muted down to a depth of 90 m.
x (m)	x (m)
(a) 6KfBB	(b) 6KfBB
x (m)	x (m)
0	200	400	600	800	1000	0	200	400	600	800	1000
(c) SKSBs
(d) SKSBb + KBs
x (m)
0	200	400	600	800	1000
0
0
100
200
300
Jt 400
N 500
600
700
800
x (m)
200	400	600	800	1000
1
-0.2
0.6
0.4
-0.0
-0.2
-0.4
-0.6
(e) 6KfSB
(f) sksBb
+ SKSBs + 6KfSB
x (m)
0	200	400	600	800	1000
* ▼
K$dt2
600-
700-
800-
0
100
200
300
400
N 500
600
700
800
x
0	200	400
(m)
600 800 1000
0.6
0.4
-0.0
I
-0.2
-0.2
-0.4
-0.6


(g) SKSSs
(h) SKSBb + SKSBs + 6KfSB + 6Kfss
Figure 4.10: Set 1 - NARROW offset. From top to bottom, left column: contributions to singular perturbation estimate ¿KftBS, ¿K|stBB, ¿KflSS and ¿K|stSB. Right column: Cumulative summation of individual contributions.
Figure 4.11: Set 1 - narrow offset. Summation of the multiple-scattering contributions SKftss and SK^b .
Set 1
Figure 4.9a shows the narrow-offset estimate for the singular-part bulk-modulus perturbation in the absence of strong reflector. Figure 4.9b depicts the corresponding conventional estimate. As expected, the figures display fast-varying estimates due to the narrow-offset illumination. In the time-lapse perturbation area, the conventional estimate is rather similar to the four-contributions estimate. Actually, it can be considered a better estimate because it presents fewer artefacts than the four-contribution estimate.
In Figure 4.10 we see in the left column the four individual contributions to the singular estimate, SKssbs, SKs^BB, SKssss, SKsssB and their successive sums (right column). We see that the dominant term is the single-scattering based contribution SKsstBB. This characterises the narrowoffset case. We can compare this result with Figure 4.4, left column, where we can see the individual contributions in the long-offset case. There, in contrast, we see that the weight of each contribution is more balanced.
Although much weaker than the dominant contribution, the multiple-scattering based contributions yield estimates that will definitely lead to a better convergence in the inversion. In Figure 4.11, we see the sum of two multiple-scattering based contributions: SKesstss and SKesstsB. There we see that the top and bottom of the time-lapse perturbation are nicely delineated. Moreover, the overall estimate does not present the fast-varying behaviour commonly seen in surveys
x (m)
I 000
-0.2
-0.4
-0.6
(a) SKf
k2b dt2
N
100
200
300
400
500
600
700
800
x (m)
0	200	400	600	800	1000
(b) SKSnv
Figure 4.12: Set 2 - narrow offset. Narrow-offset estimates of the perturbation in the presence of a strong reflector. (a) Singular estimate with all contributions; (b) conventional estimate.
a
0
like this.
The drawback of the multiple-scattering contributions is the introduction of artefacts not present in the conventional result.
Set 2
Figure 4.12a shows the narrow-offset estimate for the singular-part bulk-modulus perturbation for the model with the strong bottom reflector. Figure 4.12b depicts the corresponding conventional estimate. The latter, in the same way as in the previous example, displays fast-varying estimates due to the narrow-offset illumination. However, the four-contributions estimate is a bit better with
x (m)

Figure 4.13: Set 2 - NARROW offset. Summation of the multiple-scattering contributions 5KfSs and 5K^Sb •
the strong reflector present, indicating the importance of self-illumination. The multiply-scattered information improves the perturbation estimates, providing a less varying and more delineated response. This indicates that the multiple-scattering contribution perceives both the low- and high-frequency content of the perturbation.
But the best result is seen in Figure 4.13, which shows the summation of the contributions to the singular estimate calculated with the source-side singular wavefield: iK|stSB and iK|stSS. We see that these contributions alone do a better job then the conventional estimate of Figure 4.12b, nicely delineating the top and bottom of the medium perturbation. The reason is that in this case not the source array alone, but also the singularities contribute to the source-side wavefield in the kernel. Physically, this can be interpreted as the strong reflector illuminating the time-lapse change from bottom to top.
Again, the drawback is the introduction of artefacts that come from the multiple-scattering contributions as can be verified inspecting Figure 4.14.
These narrow-offset experiments demonstrate that it is even more important than for long offset surveys to include the singular part into the model used for backpropagation, since it enhances the self-illumination due to scattering and leads to better perturbation estimates.
x (m)	x (m)
(b) KBb
(a) KBb
x (m)
0	200	400	600	800	1000
0
x (m)
0	200	400	600	800	1000
Kg di2
(c) 6KSBs
(d) SKSBb + 6KSBs
* ▼
Kgdt2
(e) KBb
+ KBs + Ksb
(f) kBb
(g) SKSBs
(h) SKSBb + KBs + KBb + 6KSBs
Figure 4.14: Set 2 - NARROW offset. From top to bottom, right column: contributions to singular perturbation estimate dKS^Bg, SKfBB, 5K|stSS and 5KS?sb . Left column: Cumulative summation of individual contribution s.
5.	Final Remarks
We have presented a decomposition of standard full-waveform inversion (FWI) sensitivity kernels into several sub-kernels. We understand as standard FWi the least-square gradient-based nonlinear iterative local optimisation of the full recorded data where the sensitivity kernels are used to evaluate the gradient of the objective function in order to define the descending direction in the minimisation process. For this purpose, we have developed a scattering formulation that decomposes the model parameters into a background and a singular component. We assume that the model decomposition is based on its spatial-frequency content, that is, the smooth background model carries the low-frequency content while the singular component carries the high-frequency information. Both model parts are then perturbed instead of considering the scattering potential as a perturbation of the background and inverting for it. As a consequence, the single sensitivity kernel of the standard formulation of FWI is decomposed into a sum of subkernels.
By including a singular part in the unperturbed reference model, the present approach describes multiple-scattering phenomena. Nonetheless, the resulting subkernels are still based on the Born approximation, in the sense that the residuals are predicted based on single-scattering of the unperturbed wavefields at the model perturbations, which thus must be small compared to the unperturbed model parts. Once the model component perturbations lie in the range of validity of the decomposition approximation, the superposition of all our sub-kernels yields the total Frechet gradient as in the standard formulations of FWI. The asset of the decomposition is that it uncovers the underlying different levels of interaction between the model components within the data that else are hidden in the sensitivity kernel for the total wavefield, allowing to select the most useful ones depending on the problem and/or model decomposition used. We have used the decomposition to analyse the interplay of the background wavefield and the internally multiple-scattered or reflected wavefield in each subkernel to understand their role in the forward problem.
The forward-problem numerical experiments showed that the linearised total-wavefield residual 8p can be accounted as a summation of ten different contributions: one component to the
background wavefield residual and nine components to the singular-wavefield residual from which five depend on background perturbations and four depend on singular-part perturbations. Each contribution is symmetrical to another one or to itself. In our mathematical development of the decomposition we found three non-symmetrical contributions which, latter, turned out to cancel each other.
The importance of each component of the singular-wavefield residual varies from case to case. But, in general, we verified that when the background perturbations are present, the main contributions come from the multiple- scattering term bpS,BBS and bpS,SBB. The single-scattering term bpS,BBB carries information, though not only, on the background-wavefield residual already accounted for by the term bpB. This information is cancelled by the component bps,--BLB and the remaining information is carried by the superposition term bpBWB. This last term is relevant only when the background perturbation overlaps the singular component of the model within the Fresnel zone of the total wavefield. When it does, it usually has the same order of magnitude than the strong multiple-scattering term bpSiSBS. When singular-part perturbations are present, there is not a most dominant component in term of energy (as a matter of fact the strong multiple-scattering component carries a little less energy than the others as it might be expected). But the singlescattering component is the single most representative in term of waveform.
The backprojection numerical experiments helped us to understand the role and importance of including an estimate of the singular part of the model in the starting model. The smooth starting model that are usually used in the conventional approach leads to estimates that do not incorporate deep- subsurface information, or at least, not with the desired long wavelength. the shallow part of the subsurface is illuminated by diving waves: the broader the acquisition offset is, the deeper the subsurface is illuminated. The only information from deep region comes from the short-wavelength migration-related contribution. When singular estimates are included in the starting model the back-illumination provided by the scattered/reflected waves allows the estimate to see a broader, deeper area with a larger wavelength. And the estimates evaluated using the subkernels from the decomposition allow us to individualise the most important contribution for a particular problem.
When there are perturbations only in the singular part of the model the summation of the estimates obtained with the adjoint of subkernels correspond to the estimate obtained with the adjoint of the undecomposed kernel. This is not true when there are background perturbations involved. This is so because we are dealing with adjoint and not with inverse operations. The estimate from the undecomposed kernel exhibits cross-terms that are not present in the background
perturbation estimate obtained with our formulation.
The backprojection numerical experiments have shown the feasibility of our main claim: the decomposition into subkernels allows to backproject only the singular-wavefield residuals so as to obtain reasonable background-model perturbation estimates. In our numerical experiments with background perturbation, we obtained the single best estimates with multiple-scattering subkernels. This was particularly important in an experiment with a restricted acquisition geometry (reflection data, narrow offset). In this case, the multiple-scattering subkernels take advantage of medium self-illumination provided by the singular wavefields. These results are in clear connection with the ones of the forward problem experiments. In those with background perturbations, the multiple-scattering based terms give the most relevant contribution to the evaluated singularwavefield residual. This points towards the possibility that FWI can be successfully applied to short-offset data, if a reasonable estimate of the singular part of the model is available and included in the reference model.
On the other hand, we observed that multiple-scattering based subkernels do a poorer job than their undecomposed counterpart when used to update the singular part of the model alone. If the assumptions of undecomposed FWI are satisfied (known smooth reference model, unknown small scatterers), then it is superior to decomposed inversion.
An immediate application of the proposed decomposition of the reference model is as a followup of standard model building in connection with imaging. Classically, the initial reference model used in the FWI process is the best, yet smooth, velocity model obtained from some sort of migration velocity analysis and tomography. In the decomposed inversion, this model could play the role of the smooth background part of the initial reference model. However, in conventional FWI, the information provided from the migrated image with this smooth model is not made use of. The positions of key reflectors in this image (possibly with reflectivity estimates from true-amplitude migration) could be taken as the singular part of the initial reference model. Under that framework, our formalism provides an explicit method for jointly using velocity models and migrated seismic images in FWI as well as for understanding their interplay in the model-building process. The analysis we made here indicates that such a procedure should have better convergence properties than the conventional approach.
Another possibility that arises with the discussed decomposition regards the use of selected kernel contributions instead of their complete sum. Synthetic data studies may help to decide which subkernels carry the most significant information for a given data set, so that contributions that carry no or even misleading information can be eliminated from the inversion.
It is important to observe that the initial model decomposition based on the spatial-frequency content done here is not, by all means, the only possible choice. Being completely arbitrary as long as the initial model is fully known, the decomposition allows for a problem-based decision on which features will be part of the background model and which will be considered by means of the singular part. Different decompositions lead to different interpretation of each of the subkernels. This implies a broad range of possible applications of the proposed approach, e.g., frequency-band or layer-stripping-based decompositions.
As an example, we have applied the scattering decomposition of the sensitivity kernels to the time-lapse problem, considering the time-lapse change as a perturbation of the singular part of the model, i.e., perturbation of the scattering potential. Under the differential-method framework, we have demonstrated that the scattering-based decomposition of the sensitivity kernels allows to take advantage of the illumination of the time-lapse change due to multiple-scattering phenomena in order to improve the perturbation estimates from FWI.
We employed the FWI differential method. By considering the baseline model fully known, the data difference between baseline and monitor surveys is the residual to be minimized in order to obtain time-lapse change estimates using the baseline as starting model. Considering the timelapse change as a perturbation of only the singular part of the model, we circumvented the problem of separating the reference wavefield from the scattered field.
our numerical experiments demonstrated that it is beneficial to include the singular part into the model used for the necessary back propagations. In the presence of a strong reflector below the time-lapse change, the use of the multiple-scattering-based sensitivity kernels yielded better estimates in both large- and narrow-offset surveys compared to estimates obtained with the conventional sensitivity kernel. In the large-offset case, it better handled the backscattered information coming from the deep reflector which would, otherwise, give rise to spurious estimates. In the narrow-offset case, the scattering-based sensitivity kernels help to bring out the low-frequency spacial information carried by the back-scattered wavefield coming up from the deep reflector. In other words, in the subkernels (e.g., Us&gt;sB) where the scattered wavefield acts as source-side wavefield, the singularities or reflectors that originate the scattered wavefield act as sources of illumination, enhancing and broadening the spatial spectral content of the estimate.
5.1 Thesis' follow-ups
5.1	Thesis' follow-ups
This thesis helped to understand the role of scattering information within one iteration. A natural next step is to test the effectiveness of the proposed decomposition is a full inversion process. Obviously, it is not practical to use all the subkernels at each iteration. The cost of evaluating each individual contribution is prohibitive, and would overcome any possible gain in the convergence velocity. The idea is to choose one of the scattering-based subkernels and use it instead of the single-scattering conventional subkernel. The choice would be case-dependent but the illumination study done in every survey design could also be used to help the decision of with subkernel would be more suitable for each case.
One case that can benefit from the multiple-scattering subkernels are the complex velocity models with strong shadow areas. In this situation the back- illumination provided by such subkernels could help to individualize the updates in the shadow areas coming from the scattered waves in the reference model that would be otherwise blinded out by the strongest contributions coming from the single-scattering based subkernels.
Another path that can be undertaken is to combine the single-scattering conventional approach with the proposed multiple-scattering decomposition. Ideally, the first iterations should update the long-wavelength component and gradually including higher and higher wavelength information as the process goes on. But as we know, in the conventional approach, the iterations apart from the first generates velocity models components with potential of generating scattered waves. with the use of multiple-scattering subkernels, this drawback can be used in our favour. The first update, may be seen as the singular part for the next iteration. In the second iteration we can use the one of the subkernels proposed in our decomposition to use the scattered waves generated by this components just included in the reference model to update the background model. In the third iteration with the new background component added we can use the conventional kernel to update the singular part. Alternating the updates of the singular part of the model with the ones of background component, we believe better results could be achieved.
The formalism we presented here was based a a twofold decomposition of the reference model. As seen, it is also possible to decompose the model into several parts and consider perturbations to all model and corresponding wavefield contributions. Such a generalisation to a perturbation of all terms to an N-fold decomposition is conceptually straightforward and should be more explored. The threefold decomposition, as next logical step, could be used to explore the relations between the intermediate wavelength spectral content of the model, to which the seismic waves are rather
insensitive, with the low and high wavelength components of the model.
This study was based in the formalism developed in Tarantola (1984b). We decomposed the kernel resulting from the minimization of a L2-norm objective function of the full wavefield. Another way perform the decomposition is to design objective functions with residuals, regularisation and pre-conditioning terms that take into account the reference wavefield decomposition form the start. With these new objective functions the decomposition can be extended the the Hessian kernels that will open the perspective of a resolution analysis and inversion that take into consideration the multiple-scattering information.
Finally, with the recent developments on the acquisition technology, now we can access high quality vector-acoustic data. Extending the decomposition to the vector-acoustic formalism will allow us to take advantage on the natural decoupling of the influence of bulk-modulus and density perturbations have on the pressure and velocity wavefield residuals.
References
Asnaashari, A., Brossier, R., Garambois, S., Ludovic, M., Operto, S., Ribodetti, A., and Virieux, J. (2013). Full waveform inversion : challenges. SEG FWI workshop.
Bae, H. S., Pyun, S., Chung, W., Kang, S.-G., and Shin, C. (2012). Frequency-domain acousticelastic coupled waveform inversion using the Gauss-Newton conjugate gradient method. Geophysical Prospecting, 60(3):413-432.
Barnes, C. and Charara, M. (2009). The domain of applicability of acoustic full-waveform inversion for marine seismic data. Geophysics, 74(6):WCC91.
Bednar, J. B., Shin, C., and Pyun, S. (2007). Comparison of waveform inversion, part 2: phase approach. Geophysical Prospecting, 55(4):465-475.
Ben-Hadj-Ali, H., Operto, S., and Virieux, J. (2008). Velocity model building by 3D frequencydomain, full-waveform inversion of wide-aperture seismic data. Geophysics, 73(5):VE101-VE117.
Bleistein, N., Cohen, J. K., and Stockwel, J. W. J. (2001). Mathematics of Multidimensional Seismic Imaging, Migration, and Inversion. Springer Verlag, New York.
Brenders, A. J. and Pratt, R. G. (2007). Efficient waveform tomography for lithospheric imaging: implications for realistic, two-dimensional acquisition geometries and low-frequency data. Geophysical Journal International, 168(1):152-170.
Brossier, R. and Operto, S. (2009). Seismic imaging of complex onshore structures by 2D elastic frequency-domain full-waveform inversion. Geophysics, 74(6).
Bunks, C., Saleck, F., Zaleski, S., and Chavent, G. (1995). Multiscale seismic waveform inversion. Geophysics, 60(5):1457.
Choi, Y., Min, D.-J., and Shin, C. (2008). Two-dimensional waveform inversion of multicomponent data in acoustic-elastic coupled media. Geophysical Prospecting, 56(6):863-881.
Clement, F., Chavent, G., and Gomez, S. (2001). Migration-based traveltime waveform inversion of 2-D simple structures: A synthetic example. Geophysics, 66(3):845.
Crase, E., Pica, A., Noble, M., McDonald, J. A., and Tarantola, A. (1990). Robust elastic nonlinear waveform inversion: Application to real data. Geophysics, 55(5):527-538.
Fichtner, A. (2010). Full Seismic Waveform Modelling and Inversion. Springer Verlag.
Fichtner, A. and Trampert, J. (2011). Hessian kernels of seismic data functionals based upon adjoint techniques. Geophysical Journal International, 185(2):775-798.
Fletcher, R. and Reeves, C. (1964). Function minimization by conjugate gradients. The Computer Journal, 7(2):149-154.
Gauthier, O., Virieux, J., and Tarantola, A. (1986). Two-dimensional nonlinear inversion of seismic waveforms: numerical results. Geophysics, 51(7):1387-1403.
Guitton, A. and Symes, W. W. (2003). Robust inversion of seismic data using the Huber norm. Geophysics, 68(4):1310-1319.
Ha, T., Chung, W., and Shin, C. (2009). Waveform inversion using a back-propagation algorithm and a Huber function norm. Geophysics, 74(3):R15-R24.
Hestenes, M. R. and Stielfel, E. (1952). Methods of conjugate gradients for solving linear systems. Journal of Research of the National Bureau of Standards, 49(6):409 - 436.
Hole, J. A. (1992). Nonlinear high-resolution three-dimensional seismic travel time tomography. Journal of Geophysical Research: Solid Earth, 97(B5):6553-6562.
Jannane, M., Beydount, W., Crase, E., Cao, D., Koren, Z., Landa, E., Mendes, M., Pica, A., Noble, M., Roeth, G., Singh, S. C., Snieder, R., Tarantola, A., Trezeguet, D., and Xie, M. (1989). Wavelengths of earth structures that can be resolved from seismic reflection data. Geophysics, 54(7):906.
Jeong, W., Lee, H.-Y., and Min, D.-J. (2012). Full waveform inversion strategy for density in the frequency domain. Geophysical Journal International, 188(3):1221—1242.
Kamath, N. and Tsvankin, I. (2013). Full-waveform inversion of multicomponent data for horizontally layered VTI media. Geophysics, 78(5):WC113-WC121.
Lailly, P. (1983). The seismic inverse problem as a sequence of before stack migrations. In Inverse Scattering Theory and Application, pages 206-220. Society for Indistrial and Applied Mathematics (SIAM).
Lambare, G. (2008). Stereotomography. Geophysics, 73(5).
Luemberger, D. G. and Ye, Y. (2010). Linear and nonlinear programming. International Series in Operations Research and Management Science. Springer, New York, third edit edition.
Lumley, D. E. (2001). Time-lapse seismic reservoir monitoring. Geophysics, 66(1):50-53.
Marfurt, K. J. (1984). Accuracy of finite-difference and finite-element modeling of the scalar and elastic wave equations. Geophysics, 49(5):533-549.
Mora, P (1987). Nonlinear two-dimensional elastic inversion of multioffset seismic data. Geophysics, 52(9):1211-1228.
Mora, P. (1988). Elastic wave-field inversion of reflection and transmission data. Geophysics, 53(6):750-759.
Newton, R. G. (1982). Scattering Theory of Waves and Particles. Springer, New York, Heidelberg.
Plessix, R.-E. (2006). A review of the adjoint-state method for computing the gradient of a functional with geophysical applications. Geophysical Journal International, 167(2):495-503.
Plessix, R.-E. (2007). A Helmholtz iterative solver for 3D seismic-imaging problems. Geophysics, 72(5):SM185-SM194.
Plessix, R.-E. (2009). Three-dimensional frequency-domain full-waveform inversion with an iterative solver. Geophysics, 74(6).
Plessix, R.-E. (2012). Waveform Inversion Overview: Where Are We? And What Are the Challenges? 74th EAGE Conference &amp;amp; Exhibition-Workshops, (June 2012):4-7.
Plessix, R.-E., Michelet, S., Rynja, H., Kuehl, H., de Maag, J. W., and Hatchell, P (2010). Some 3D applications of full waveform inversion. 72nd EAGE Conference Extended Abstracts.
Polak, G. and Ribiere, E. (1969). Note sur la convergence de methodes de directions conjuguees. ESAIM: Mathematical Modelling and Numerical Analysis - Modelisation Mathematique et Analyse Numerique, 3(R1):35-43.
Pratt, R. G. (1999). Seismic waveform inversion in the frequency domain, Part 1: Theory and verification in a physical scale model. Geophysics, 64(3):888-901.
Pratt, R. G., Shin, C., and Hicks, G. J. (1998). Gauss-Newton and full Newton methods in frequency-space seismic waveform inversion. Geophysical Journal International, 133:341-362.
Pratt, R. G. and Shipp, R. M. (1999). Seismic waveform inversion in the frequency domain , Part 2 : Fault delineation in sediments using crosshole data. Geophysics, 64(3):901-913.
Pratt, R. G., Song, Z.-M., Williamson, P., and Warner, M. (1996). Two-dimensional velocity models from wide-angle seismic data by wavefield inversion. Geophysical Journal International, 124(2):323-340.
Pratt, R. G. and Worthington, M. H. (1990). Inverse theory applied to multi-source crosshole tomography. Part1: acoustic wave-equation method. Geophysical Prospecting, 38(July 1989):287-310.
Pyun, S., Shin, C., and Bednar, J. B. (2007). Comparison of waveform inversion, part 3: amplitude approach. Geophysical Prospecting, 55(4):477-485.
QueiBer, M. and Singh, S. C. (2013). Full waveform inversion in the time lapse mode applied to CO$_2$ storage at Sleipner. Geophysical Prospecting, 61(3):537-555.
Rickett, J. E. and Sava, P (2002). Offset and angle-domain common image-point gathers for shot-profile migration. Geophysics, 67(3):883.
Rodberg, L. S. and Thaler, R. M. (1967). Introduction to the Quantum Theory of Scattering. Academic Press, New York.
Sava, p. and Biondi, B. (2004). Wave-quation migration velocity analysis. i. Theory. Geophysical Prospecting, (January):593-606.
Sava, P. and Fomel, S. (2003). Angle-domain common-image gathers by wavefield continuation methods. Geophysics, 68(3):1065.
Sava, P. and Vasconcelos, I. (2009). Extended common-image-point gathers for wave-equation migration. 71st EAGE Conference &amp;amp; Exhibition, (June 2009):8-11.
Sava, p. and Vasconcelos, i. (2011). Extended imaging conditions for wave-equation migration. Geophysical Prospecting, 59(1):35-55.
Sears, T. J., Singh, S. C., and Barton, P. (2008). Elastic full waveform inversion of multi-component OBC seismic data. Geophysical Prospecting, 56(6):843-862.
Shin, C. and Cha, Y. H. (2008). Waveform inversion in the Laplace domain. Geophysical Journal International, 173(3):922-931.
Shin, C. and Ha, W. (2008). A comparison between the behavior of objective functions for waveform inversion in the frequency and Laplace domains. Geophysics, 73(5):VE119-VE133.
Shin, C. and Ho Cha, Y. (2009). Waveform inversion in the Laplace-Fourier domain. Geophysical Journal International, 177(3):1067-1079.
Shin, C. and Min, D.-J. (2006). Waveform inversion using a logarithmic wavefield. Geophysics, 71(3):R31-R42.
Shin, C., Pyun, S., and Bednar, J. B. (2007). Comparison of waveform inversion, part 1: conventional wavefield vs logarithmic wavefield. Geophysical Prospecting, 55(4):449-464.
Shipp, R. M. and Singh, S. C. (2002). Two-dimensional full wavefield inversion of wide-aperture marine seismic streamer data. Geophysical Journal International, 151(2):325-344.
Sirgue, L., Etgen, J., and Albertin, U. (2008). 3D frequency domain waveform inversion using time domain finite difference methods. 70th EAGE Conference &amp;amp; Exhibition, (June 2008):9-12.
Sirgue, L. and Pratt, R. G. (2004). Efficient waveform inversion and imaging: A strategy for selecting temporal frequencies. Geophysics, 69(1):231.
Snieder, R., Gret, A., Douma, H., and Scales, J. (2002). Coda wave interferometry for estimating nonlinear behavior in seismic velocity. Science, 295:2253.
Stolt, R. H. and Weglein, A. B. (2012). Seismic Imaging and Inversion. Cambridge University Press, Cambridge, UK.
Symes, W. W. (2008). Migration velocity analysis and waveform inversion. Geophysical Prospecting, 56(6):765-790.
Tarantola, A. (1984a). Inversion of seismic reflection data in the acoustic approximation. Geophysics, 49(8):1259-1266.
Tarantola, A. (1984b). Linearized Inversion of Seismic Reflection Data. Geophysical prospecting, 32(6):998-1015.
Tarantola, A. (1986). A strategy for nonlinear elastic inversion of seismic reflection data. Geophysics, 51(10):1893-1903.
Tarantola, A. (1987). Inverse problem theory: Methods for data fitting and model parameter estimation.
Tromp, J., Tape, C., and Liu, Q. (2005). Seismic tomography, adjoint methods, time reversal and banana-doughnut kernels. Geophysical Journal International, 160(1):195-216.
Vasconcelos, I., Sava, P., and Douma, H. (2010). Nonlinear extended images via image-domain interferometry. Geophysics, 75(6):SA105-SA115.
Vasconcelos, I., Snieder, R., and Douma, H. (2009). Representation theorems and Green’s function retrieval for scattering in acoustic media. Physical Review E, 80(3):1-14.
Vigh, D., Starr, E. W., and Kapoor, J. (2009). Developing Earth models with full waveform inversion. The Leading Edge, pages 432-435.
Virieux, J. and Operto, S. (2009). An overview of full-waveform inversion in exploration geophysics. Geophysics, 74(6):WCC1.
Virieux, J., Operto, S., and Ben-Hadj-Ali, H. (2009). Seismic wave modeling for seismic imaging. The Leading Edge, 28:538-544.
Warner, M., Ratcliffe, A., Nangoo, T., Morgan, J., Umpleby, A., Shah, N., Vinje, V., Stekl, I., Guasch, L., Win, C., Conroy, G., and Bertrand, A. (2013). Anisotropic 3D full-waveform inversion. Geophysics, 78(2):R59-R80.
Watanabe, T., Shimizu, S., Asakawa, E., and Matsuoka, T. (2004). Differential waveform tomography for time-lapse crosswell seismic data with application to gas hydrate production monitoring. SEG Technical Program Expanded Abstracts, (October):1-4.
Woodward, M. J., Nichols, D., Zdraveva, O., Whitfield, P., and Johns, T. (2008). A decade of tomography. Geophysics, 73(5):VE5-VE11.
Wu, R. and Aki, K. (1985). Scattering characteristics of elastic waves by an elastic heterogeneity. Geophysics, 50(4):582-595.
Yang, D., Fehler, M., Malcolm, A., and Huang, L. (2011). Carbon sequestration monitoring with acoustic double-difference waveform inversion: A case study on SACROC walkaway VSP data. SEG Technical Program Expanded Abstracts, pages 4273-4277.
Zheng, Y., Barton, P., and Singh, S. C. (2011). Strategies for elastic full waveform inversion of time-lapse ocean bottom cable (OBC) seismic data. SEG Technical Program Expanded Abstracts, pages 4195-4200.
Zhu, H., Luo, Y., Nissen-Meyer, T., Morency, C., and Tromp, J. (2009). Elastic imaging and time-lapse migration based on adjoint methods. Geophysics, 74(6):WCA167.
A.	Mathematical Definitions
Fourier Transform. The fourier transform convention used here is defined as follows.
gM = F [g(i)] =
g(t)e-iutdt.
g(t) = F 1 [gM]
g(^)eiWidw.
(A.1)
(A.2)
Scalar and vector quantities. Bold letters indicate vector or discretized quantities, for instance, m(x). Scalar discretized quantities were denoted by overlined symbols, for instance, 5KB(xi). Matrix are denoted by a bold capital letter, for instance, M1.
Diferential Operators. Caligrafic letters indicate differential operators, as in L(K(x'), p(x'))[ • ]. Here the diferential operators are composed by time and spatial derivatives and can be applied onto any wavefield. The spatial derivatives are done with respect to the spacial variable inherited from the model parameters the operator are function of. In this example, x'. The time derivatives are done with respect to the time variable inherited from the wavefield the operator are applied onto.
When the derivative is neither with respect to space nor time, the subscript used with operator V indicates which vector variable the derivative are done with respect to as, for instance, in Vm\.
Time Convolution. Time convolution operation is indicated with the symbol ’*’ and defined as
g *f (t)
T)f(t)dT
(A.3)
Delta function. The function1 5(x — x') is defined as follows
8(x — x') = 0 for x = x'	(A.4)
and
g(x') = [ g(x)8(x — x')d3x.	(A.5)
JR3
Adjoint operators, conjugate transpose matriz. The symbol t indicates the adjoint of an operator or the conjugate transpose of a matrix.
1 Actually this is a distribution.
B.	Generalised decomposition and its
relation to the proposed decomposition
In this appendix, we generalise to a N-fold decomposition the one seen in eqs. (2.4) and (2.5) (See Section B.1). In Sections B.2 and B.3, we show that the Expression for the secondary sources in the proposed decomposition presented in this thesis can be derived from appling Born approximation in a fourfold decomposition.
B.1 Generalised decomposition
The twofold decomposition can be immediately generalised, because eq. (2.4) is of the same type as eq. (2.1) and can be decomposed in the same way into two equations.
Denoting ps by pN and Lo by LN_x in eqs. (2.4) and (2.5), we can write
Ln_i [Pon(x,t,; Xs)] = 6(x - Xs)S(t),
L [pn(x,t; Xs)]	= -Vn [Pon(x,t; Xs)]
(B.1)
(B.2)
where Vn = L — LN_x and poN = p — pN is the remainder of the wavefield after separation of part pN. Decomposing eq. (B.1) again with ps denoted by pN_x, L by LN_x, and Lo by LN_2 in eqs. (2.4) and (2.5) leads to
Ln_2 [Pon_x(x,t,; Xs)] = 6(x — Xs)S(t),
Ln_x [Pn_x(x,t; Xs)] = —Vn_x [Pon_x(x,t; xs)|
(B.3)
(B.4)
where now Vn_x = LN_x — LN_2 and poN_x = poN — pN_x = p — pN — pN_x. In the same way,
eq. (B.3) can be decomposed again to yield the system
Ln-3 [Pon; xs)] = 6(x - xs)S(t),	(B.5)
Ln-2 [Pn-2(x,t; xs)] = -Vn-2 [Pon-2(x,t; xs)|,	(B.6)
where Vn-2 = Ln-2 - Ln-3 and Pon-2 = Pon-1 - Pn-2 = p - Pn - Pn-1 - Pn-2. It is not difficult to observe that this decomposition principle can be applied N times to finally yield the following system of N +1 equations,
Lo [po(x,t,; Xs)]
Lj [pj(x,t; xs)]
6(x - xs)S(t),
■j-1
-V^2 Pi(x,t; xs)
(B.7)
(j = 1,...,N),	(B.8)
_i=0
where p	VN=0 pi. The wave operators Lj are given by
1	d2
Li = ——---------L-n - V J .
ELo Ki(x)	-	Pi(x)
V)’
(B.9)
1
with Ln = L. Moreover, the scattering potentials are
E = Lj	Lj-i;
(B.10)
and K = ^N=o Ki and P = EN=o Pi-
Being completely arbitrary, such N + 1-fold decomposition could be used, for instance, to describe a complex geological model one layer at a time or to decompose it into contributions from several frequency bands.
B.2 Four-fold decomposition of a perturbed model and wavefield
From Section ?? we have the N-fold decomposition represented by:
Lo [po(x,t; xs)| = S(x - xs)S(t),	(B.11)
where
Lj \Pj(x,t; xs)]
Vj
j-1
^2pi(x,t; Xs)
_i=0
Lj
N
LKi-
i=0
N
i=0
N
IDpi,
i=0
1
Vj
j Ki(x) at2
Lj — Lj-1
_v(	v)
\Ej=o Pi(x) )
•&gt;
(B.12)
(B.13)
(B.14)
(B.15)
(B.16)
(B.17)
(j = 1,...,N).
K
P
p
d 2
1
Note that from (B.17) we can write that
Lj — Vj + Vj-i + • • • + Vi + Lq.
(B.18)
Suppose we want to decompose a perturbed model K (we are considering perturbation only in bulk modulus) in four parts superimposed in such order: at the “bottom” a background model KB; over it the background perturbation 8Kb; on top of it, a singular model Ks; and on the top most the corresponding perturbation 8KS, such that
K — Kb + 8Kb + Ks + 8KS.
(B.19)
Comparing eqs. (B.19) and (B.13) we can consider Ko = KB, K1 = 8Kb, K2 = Ks, and K3 = 8Ks and perform a fourfold decomposition of K. Setting p0 = p and pi = 0 for i — 1, 2, 3, we have (dependency of the wavefields on (x, t; xs) is omitted for simplicity)
Lb \pb]	— 8(x - Xs)S(t),	(B.20)
(Lb + VB) \8pB]	— -VB \pb] ,	(B.21)
(LB + VB + V0) [pS + ^b]	— -Vo \pb + 8p'b ] ,	(B.22)
(LB +	VB	+ V'	+ VS)	[Sp's,s]	=	— VS	\?B	+ SpB	+ pS	+	Sp's,b]	&gt;
(B.23)
with (omitting the x-dependency for simplicity)
Lb
Vb
V'
Vs
1 d2 KB dt2
1
Kb + SKb
1
Kb + SKb + Ks
1
Kb + SKb + Ks + SKs
1	\ d2
Kb + SKb) dt2’
1	\ d2
Kb + SKb + KJ dt2 ’
(B.24)
(B.25)
(B.26)
(B.27)
which imply
Lb + Vb
Lb + Vb + Vq
Lb + Vb + Vo + Vs
1	d2
Kb + SKb dt2
1	d2
Kb + SKb + Ks dt2
— V-
- V-
1	d2
Kb + SKb + Ks + SKs dt2
- V •
(B.28)
(B.29)
(B.30)
It is important to note that no approximation has been made at all, i.e., Kb, SKb, Ks, and SKs can hold any magnitude relation among them as long they sum up to K. The prime symbol' indicates the non-linearised version of the corresponding wavefields and/or operators.
The Physical interpretation of eqs. (B.20) to (B.23) is as plain as the twofold decomposition:
Eq. (B.20) A background wavefield pB propagates in a background medium Kb excited by a point-source at xs.
Eq. (B.21) A perturbation SKb in the background medium is introduced; when the background wavefield pB runs into the background perturbation it excites a wavefield perturbation Sp'B (a wavefield itself) that propagates in the perturbed background medium Kb + SKb .
Eq. (B.22) A singular component of the reference medium1 Ks is introduced in the perturbed
1The unperturbed reference medium K0 is defined as KB + KS.
background medium; when the perturbed background wavefield pB + 8p( runs into the singular component it excites a background-perturbed singular wavefield pS + 6p'S B that propagates in the background-perturbed reference medium K( + 8Kb + KS.
Eq. (B.23) A perturbation 8Ks on the singular component of the background-perturbed reference medium is introduced; when the background-perturbed reference wavefield2 pB + 8p( + pS + SpStB runs into the singular-component perturbation it excites a singular-wavefield perturbation 8p'S S that propagates in the perturbed reference medium K(+8Kb+KS+8Ks.
B.3 Linearisation of the fourfold decomposition
Now let us consider that 8Kb ,8Ks	K( ,KS. This allows us to use linear approximations in
the set of eqs. (B.20) to (B.23).
From (B.25) we can write
Vb ~

d2
8 Lb ,
(B.31)
also seen at eq. (2.24). From eq. (B.26) we have
V0




(
(
[kb + Ks
Kb + Ks
Kb + Ks
Vo
1 - 8Kb
8K(
(Kb + Ks )2	K(
1
K(
Kb J
' - '
1 - 8Kb (
+K()
{kb + Ks ' Kb
8Kb^
+ k2b
1
at2,
(Kb + Ks )2	K(
1	1	d2
+Kb]
Kb + Ks	Kb
dt2’
1
1
B
1
1
1
d 2
',


Vo - 8Kb W
(B.32)
where we have used eq. (D.4) with the superscript K dropped. Finally, from (B.27) we can write
(	1	8Kb + 8Ks	1	8K(	\ d2
S	\K(	+	Ks	(Kb	+ Ks)2	K(	+	Ks	(Kb	+	Ks)2) dt2'
2 The unperturbed reference wavefield p0 is defined as pB + pS.
Vs «
/ 8Ks	\ d2
\(Kb + Ksy) dt2
(B.33)
Using eqs. (B.31), (B.32) and (B.33) we can restate eqs. (B.21) to (B.23) as
(Lb + 8Lb) [8pb]	—	-8Lb [pb] ,	(B.34)
(Lb +	8 Lb + Vo - 8KbW) [ps + 6ps,B]	—	- (Vo - 8Kb W) [pb + 8pb],	(B.35)
(Lb +	8Lb + Vo - 8KbW + 8S) [6ps,s]	—	-8S [pb + 8pb + ps + 8ps,B].	(B.36)
Note we dropped the primes on the wavefields denoting that these are the their linearised versions.
Hereafter we are going to neglect all second order terms denoted by a perturbation operator, such as 8Lb, applied onto a wavefield perturbation, such as 8pB. Doing so eq. (B.34) becomes
Lb [8pb] — -8Lb [pb].	(B.37)
This equation describes the propagation of the (linearised) background residual. Corresepondingly, considering LB + Vo — L0, eq. (B.35), on its turn, becomes
Lo [ps] + Lo [8ps,b] + 8Lb [ps] - 8KbW [ps] — -Vo [pb] - Vo [8pb] + 8KbW [pb].	(B.38)
In a two-fold decomposition where there were no model perturbations, i.e. , 8Kb , 8Ks — 0 but only the two components of the reference medium such that K0 — KB + KS the equation that describes the progation of the singular wavefield pS is given by eq. (2.21):
Lo [ps] — -Vo [pb].	(B.39)
As a Born approximation we can consider the perturbed wavefield as a linear superposition of the unperturbed singular wavefield pS and its residuals. This allows us to subtract eq. (B.39) from eq. (B.38) which yields
Lo [8ps,b] — -8Lb [ps] + 8KbW [ps] - Vo [8pb] + 8KbW [pb].	(B.40)
Finally, eq. (B.36) can be written as
Lo [8ps,s] — -8S [pb] - 8S [ps]	(B.41)
We know that
8Kb W — 8 Lb
8Kb
1
(Kb + Ks )2
(Kb )2)
1 ’
+ /U K b
d 2
dt2
/ 8Kb	X d2
\(Kb + Ks)2J dt2
(B.42)
according to eq. (2.40). Using this in eq. (B.40) leads us to
Lo [8ps,b] = — 8B [ps] — Vo [8pb] + 8KbW [pb].	(B.43)
From (B.42) we have 8KbW = 8Lb — 8B. So, the previous equation becomes
Lo [8ps,b] = —Vo [8pb] — 8B [pb] — 8B [ps] + 8Lb [pb].	(B.44)
Summing up eqs. (B.41) and (B.44) we arrive at
Lo [8ps,b + 8ps,s] = —Vo [8pb] — (8B + 8S) [pb] — (8B + 8S) [ps] + 8Lb [pb].	(B.45)
upon doing that 8pS,B + 8pS,S = 8pS and 8B + 8S = 8L.
In summary eq. (B.37) correspond to (2.23) and describes the linearised background-wavefield residual propagation. Eq. (B.45) correspond to eq. (??) and describes the linearised singularwavefield residual propagation.
C.	Estimates for the Model Perturbations
In this appendix, we derive the expressions for some of the contributions to the model perturbation estimates based on the adjoint subkernel seen in equation 2.50. For each one of the model parameters KB and pB, we choose one estimate based on single-backpropagation (8KBbs and ^Pbbs) and one based on a double-backpropagation (#KBstbVB and SpBtbVB).
To arrive at the expression for the other estimate contributions, we have only to perform the proper substitution of the source- and receiver-side wavefields and the potential operator. In all derivations below, the dependency on u is omitted for simplicity, since all quantities in the frequency domain are easily identified by a hat over the symbol.
C.1 Estimate of the background perturbation 5KBstBS
In the frequency domain, the contribution due to perturbation on the background model of the term (2.33.3) is
&amp;amp;PS,BBS(xg; xs)
d3x' Gs(x'; xg)8B [pB(x'; xs)].
(C.1)
Considering only bulk-modulus perturbations, we have
(C.2)
which is equation (2.43) in the frequency domain. Discretising the volume integral in this equation
yields
$Ps,bbs(xg; xs) =
’ -a? - mgs(x1;xg)pB(x1;xs) ••• K0 (x1)		8Kb (x1)
kernel of U BBS		5Kb (xN)
(C.3)

where UB,BS is the one of the components of the Frechet derivative of the singular-wavefield with respect to the medium perturbations 8Kb at x'.
Therefore, the adjoint to equation (C.3) constitutes, for each pair (xg, xs), the vector
5KB,BS(xg, xs) =
"K,~
B,BS(xN \xs, xg) _
_a2
K	) GS (x1; xg )pB (xi; xs)
K0 (x1)
_a2
K2(x )&lt;^S(xN; xg)pB(xN; xs)
K0 (xN)
8ps(xg; xs).
(C.4)
5KB(bs(x'i\xs, xg)

Finally, summation over all sources and receivers and integration over all frequencies yields, at each point x in the target area, the overall estimate of the medium perturbation as represented in equation (2.51).
C.2 Estimate of the background perturbation bp^Bs
Correspondingly, we can also derive the expressions for the density subkernel VBBS and the perturbation estimate 8pBsBS(x). The equation corresponding to expression (C.1) for density reads
&amp;amp;Ps,bbs(xg; xs) = -	d3x' Gs(x'; xg) V •
Jv
Upon the use of the identity
a(x)V • v(x) = — [Va(x)] • v(x) + V • [a(x)v(x)],	(C.6)
V pBxx- :	(C.5)
with
a(x) = Gs(x; xg)
and
v(x) =
dpB (x) p2(x)
equation (C.5) can be recast into the form
^pS,BBS
(xg- xs)
[ d3xZ
Jv
d3xZ Vx'
Vx'GS (x - xg ) ’ Vx'PB (x - xs )
GS (x - xg ) Vx'pB (x - xs)
dpB (XZ)
P2(x')
dpB(x'y
pl(x) _ ’
(C.8)
Using Gauss’ Theorem, the last term can be written as an surface integral over the earth. Considering homogeneous bondary conditions this term becomes
/ d3x Vx'
Jv
/ d2xZ
7s
Gs (x - xg ) Vx'pB (x - xs)
dpB(x'y po(xl) _
GS(x - xg) Vx'pB (x - xs)
dpB (xZ)
p2(x')
• n = 0,
(C.9)
where n is the unitary normal vector to the surface S pointing in the outward direction. Therefore
^Ps,BBS(xg; xs) =	dix'
Jv
V x' GS (x - xg ) • Vx'pB (x - xs)
dpB (xZ)
p2(x') ’
(C.10)
After discretisation of the volume integral, we obtain
$pPS,BBS
(xg- xs)
2/ z\Vx'GS(x1; xg)	Vx/pB(xi■ xs) p0(x1)		dpB (x1)
kernel of V b BS		5pB (xZn )
(C.11)
Thus, the adjoint provides, for each pair (xg, xs), the vector
$pB,BS(xg, xs)
SpBl,BS(x1|xs, xg)
_ ^pB\BS(xN |xs, xg) _
1
P0(x1)
Vx'GS(x1; xg) • Vx'PB (x1; xs)
8pS(xg; xs).	(C.12)
pOUN)Vx' *^S(xN;
xg) • Vx'PB(xZN; xs)
Finally, summation over all sources and receivers and integration over all frequencies provides, at each point x in the target area, the density-perturbation estimate contribution
source-side wavefield
^peB,Bs(x)	/ d'~ pJx)	(x’	Xs) ’&amp;lt;VGS(x u; xg)Sps(xg,w; xs).
backpropagation of ¿ps
(C.13)
C.3 Estimate of the background perturbation 8KBhVB
Since the wave phenomena for 8pStbV0 involve two different scattering mechanisms, the derivation of the expression for the contribution 8KBstbVB and the corresponding subkernel UBBBB is slightly more complicated. Substituting equation (2.25) in expression (2.33.2), we have
8pS,bVB (xg; xs)
I d3x' Gb(x'; xg)Vo
Jv
d3
,7v
x'' Gb(x''; x')6Cb [pb(x''; xs)] ,(C.14)
the bulk-modulus contribution of which reads
8pS,bVB(xg; xs)
[d[x: Gb(x';xg)V0K
Jv
[ d3 x Jv
KB (x")
Gb(x''; x')pB(x''; xs) 8Kb(x'')
•&gt;
(C.15)
Here, the bulk-modulus part of the scattering potential is
V	(x) Kb (x))
(C.16)
Discretising the bulk-modulus part of equation (2.33.2) yields
8ps,bVB (xg; xs)
Gb (x1; xg) V0K • • • Gb (x'N; xg) V'
Mi
8pb(xi; xs)
8pb (xN; xs)
Correspondingly, discretisation of equation (C.15) yields
	SPK,bVB (xg; xs) — M.1JM2 U B,bVB	SKb (xi) SKb (x'N)		(C.18)
in which				
m2 —	kb(x1) Gb (xi; x1)pB (xi; xs)	••• K2"x/N) gb (xN; x1)pB (xN; xs) \_ Kl(x'OGb(x";xN)pB(x";xs) ••• K^x,^Gb(xN;xN)pB(xNxs) \			.	(C.19)
From equation (C.18) follows its adjoint vector
SKB,bVB(xgi xs) —
SKBtbVB (xi|xs, xg)
— m2 m2 Sps(Xg; Xs) ,
(C.20)
in which
m2 —
SKB,bVB(xN lxs, xg)
&lt;^B (xi; x1 )pB (xi; xs)	•••
gb (xi; xN )pB (xi; xs)
(C.21)
kB(Xn)GB(xN;xi)pB(x''n;xs) •••
K2g(xN) GB(xN; xNBBB(xN; xs)
and
&lt;^B (x1; xg V
Mi —
(C.22)
&lt;^B (xN; xg)VK
Therefore, the complete contribution for this Frechet subkernel reads
direct wavefield
sKB,bv b (x) = - ^2 J duK-(x)pB (x,u; Xs) x
scattering potential at x'
,-------------*-------------s
d3x' GB(x u;x) -U\„(lX	,	)&amp;lt;^B(x&gt;, u; x)Sps(xg,u; xs) .
Jv	'------v'	\K0(x')	Kb(x')J '----------------v--------------'
2nd back-prop.	1st back-propagation of &amp;amp;pa to x'
(C.23)
1
This result is shown in equation (2.52).
C.4 Estimate of the background density perturbation SpeBtbVB
Finally, we derive the corresponding expression for the background density perturbation SpeBlbVB and the associated sub-kernel VB,bBB. Analogously to equation (C.16), we , considering only perturbations in the density model, we define
K = -v •
\Po(x)
—1— PB(x)J
(C.24)
V .
With this notation, we have from equation (C.14)
$pS,bVB
(xg; xs)
d3x' Gb(x'; xg)Vp
i d3x''_____1____
7v	x PB (x'')
Vx''Gb(x''; x')
Vx''pB(x"; xs)
SpB (x") .
(C.25)
where we substituted 6pB (x'; xs) by the expressing corresponding to equation (C.10). Discretisation of the volume integrals in equation (C.25) leads to
$pS,bV0
(xg; xs) = M3M4
V B,bBB
6pB (x'O
spB (x'N)
where
M3 =
Gb(x1; xa)V0
Gb(xN; Xg
(C.27)
and
1 pB (xi )
Vx"Gb(x'/;x'x) -Vx"Pb(xx;xs)	•••
Pb(xZZ) Vxzz GB (xN; x1) • VxzzpB (xn; Xs)
M4 =
Pb (x/) VxZZ GB (x1 ; XN ) • VxzzPB (x1 ; Xs )	• • •	p^	) Vxzz GB (xN; XN ) * VxzzpB (xN ; Xs )
(C.28)
Thus, the adjoint operation to equation (C.26) provides
x^est ®pB,bV B
(Xg; Xs)
SpBpbVB(x1Ixs, Xg)
= M4 m3 5ps(Xg; xs),
(C.29)
SpBpbVB(xN |xs, Xg)
which, after summation over all sources and receivers and integration over all frequencies, yields
direct wavefield
1
5peBtbvo(x) =	//3x/p2 (Xi VpB(x; xs) • vGb(x; x'\V0 [GB(x'; Xg)5ps(xg; xs) .
S g	2nd back-prop.	'	v _	'
1st back-propagation of dps to x'
(C.30)
D.	Superposition of Subkernels of the Singular-wavefield Residual
In this appendix, we derive and analyse the superposition of the contributions ¿&gt;Ps,bbb and Sps,-BCB to the singular-wavefield residual. This is motivated by the destructive interference between these terms observed in the Experiments 3 and 6. For simplicity, we will carry out the analysis in the frequency domain for the bulk-modulus estimate components 5pKBBB and dpg_BLB.
The two contributions in question are given by the background part of equation (2.33.4) and by equation (2.33.8). Their bulk-modulus parts read in the frequency domain
5Ps,bbb(xg; xs) = -	dx
Jv
^2
MGb(x'; Xg)pB(x'; xs) 5Kb(x') Ko (x )
(D.1)
and
5Ps,-BLB(xg; xs)=	d3x'
Jv
^2
K2 (x') Gb(x'; xg)Pb(x'; xs) 5Kb(x') .
(D.2)
Thus, their sum defines the combined contribution
5pS,BWB (xg; xs)	= 5pS,BBB (xg; xs) + 5pS,-BLB (xg; xs)
=	d3x'	K2(x' ) - K 21(x') ) *^B (x'; xg )pB (x'; xs) 5KB (x')
=	[ d3x' Gb(x'; xg)WK [Pb(x'; xs)] 5Kb(x') ,
Jv
(D.3)
where WK is the bulk-modulus part of a modified scattering potential. It is defined as
W	(x') KB(x')) V° (ko(x') + Kb(x')) ’
(D.4)
where VK is given by equation (C.16). Analogous considerations lead to the definitions of the combined contributions 8ppSBWB(xg; xs) as well as ¿PKbws(xg; xs) and 3ppS BWS(xg; xs).
Equation (D.3) demonstrates that these combined contributions carry scattered energy only from that part of V where background perturbations overlap the singularities within the reference
model. Consequently, we can conclude from this property that the background perturbation estimate obtained with the adjoint kernel of equation (D.3) will be non-zero only at the singularities in
the reference model. In other words, if the reference model is chosen as the smooth background,
these parts do not contribute at all.</field>
	</doc>
</add>